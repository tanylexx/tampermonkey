{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"AC-baidu:重定向优化百度搜狗谷歌必应搜索_favicon_双列","options":{"awareOfChrome":false,"check_for_updates":true,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["www.baidu.com"],"orig_excludes":["*://*.google*/sorry*"],"orig_includes":["*://ipv6.baidu.com/*","*://www.baidu.com/*","*://www1.baidu.com/*","*://m.baidu.com/*","*://xueshu.baidu.com/s*","*://www.so.com/s?*","*://*.bing.com/*","*://encrypted.google.*/search*","*://*.google*/search*","*://*.google*/webhp*","*://*.zhihu.com/*","*://*duckduckgo.com/*","*://*.dogedoge.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"Config":"s{\"isRedirectEnable\":false,\"isAdsEnable\":false,\"isAutopage\":true,\"isBlockEnable\":false,\"isBlockDisplay\":false,\"isBlockBtnNotDisplay\":false,\"AdsStyleEnable\":true,\"baidu\":{\"name\":\"baidu\",\"AdsStyleMode\":\"2\",\"HuYanMode\":false},\"google\":{\"name\":\"google\",\"AdsStyleMode\":\"3\",\"HuYanMode\":false},\"bing\":{\"name\":\"bing\",\"AdsStyleMode\":\"3\",\"HuYanMode\":false},\"duck\":{\"name\":\"duck\",\"AdsStyleMode\":\"3\",\"HuYanMode\":false},\"doge\":{\"name\":\"doge\",\"AdsStyleMode\":\"3\",\"HuYanMode\":false},\"sogou\":{\"name\":\"sogou\",\"AdsStyleMode\":\"3\",\"HuYanMode\":false},\"Style_BaiduLite\":false,\"defaultHuYanColor\":\"#DEF1EF\",\"isUserColorEnable\":true,\"isFaviconEnable\":true,\"defaultFaviconUrl\":\"https://ae01.alicdn.com/kf/HTB1dRY0X8OD3KVjSZFFq6An9pXay.jpg\",\"doDisableSug\":true,\"isRightDisplayEnable\":false,\"isCounterEnable\":false,\"isALineEnable\":false,\"isUserStyleEnable\":false,\"normalizeDuck\":true,\"isEnLang\":false,\"isGooleInBaiduModeEnable\":false,\"UserBlockList\":[],\"UserStyleText\":\"/**计数器的颜色样式*/\\ndiv .AC-CounterT{\\n  background: #FD9999;\\n}\\n/**右侧栏的样式-其实不开启更好看一些*/\\n#content_right{\\n  padding: 20px 15px 15px;\\n  border-radius: 5px;\\n  background-color: #fff;\\n  box-sizing: border-box;\\n  box-shadow: 0 0 20px 2px rgba(0, 0, 0, .1);\\n  -webkit-box-shadow: 0 0 20px 2px rgba(0, 0, 0, .1);\\n  -moz-box-shadow: 0 0 20px 2px rgba(0, 0, 0, .1);\\n}\\n/****可以加一些自己的背景图片,替换引号内的内容为可外链的图片即可****/\\nbody[baidu]{\\n  background-repeat: repeat-y;\\n  background-size: 100%;\\n  background-attachment:fixed;\\n  background-image: url('https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1564756277250&di=868b9eac9be14df1dedd8c7d6a710844&imgtype=0&src=http%3A%2F%2Fphotocdn.sohu.com%2F20130530%2FImg377502333.jpg');\\n}\\n/*****窗口背景的透明虚化效果*****/\\nbody>#wrapper,body>.wrap,body>#main,body #appbar,body #hdtbSum{\\n  background: rgba(225,225,225,0.8);\\n}\\n/**隐藏首页的大图标-修复可能导致外援样式异常**/\\nbody[baidu] #s_lg_img_new{\\n  display:none !important;\\n}\\n#wrapper #content_left .result, #wrapper #content_left .c-container{\\n  border-radius: 5px;\\n}\",\"oldVersion\":\"24.12\",\"lastSaveTime\":1604039190545}"},"ts":1604039194922},"enabled":true,"position":1,"file_url":"https://greasyfork.org/scripts/14178-ac-baidu-%E9%87%8D%E5%AE%9A%E5%90%91%E4%BC%98%E5%8C%96%E7%99%BE%E5%BA%A6%E6%90%9C%E7%8B%97%E8%B0%B7%E6%AD%8C%E5%BF%85%E5%BA%94%E6%90%9C%E7%B4%A2-favicon-%E5%8F%8C%E5%88%97/code/AC-baidu:%E9%87%8D%E5%AE%9A%E5%90%91%E4%BC%98%E5%8C%96%E7%99%BE%E5%BA%A6%E6%90%9C%E7%8B%97%E8%B0%B7%E6%AD%8C%E5%BF%85%E5%BA%94%E6%90%9C%E7%B4%A2_favicon_%E5%8F%8C%E5%88%97.user.js","uuid":"cfac0ede-9cb2-4aab-a0e5-fc7d3ec59c3a","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgQUMtYmFpZHU66YeN5a6a5ZCR5LyY5YyW55m+5bqm5pCc54uX6LC35q2M5b+F5bqU5pCc57SiX2Zhdmljb25f5Y+M5YiXCi8vIEBuYW1lOmVuICAgIEFDLWJhaWR1Omdvb2dsZV9zb2dvdV9iaW5nX1JlZGlyZWN0UmVtb3ZlX2Zhdmljb25fYWRhd2F5X1R3b0xpbmUKLy8gQG5hbWU6emggICAgQUMtYmFpZHU66YeN5a6a5ZCR5LyY5YyW55m+5bqm5pCc54uX6LC35q2M5b+F5bqU5pCc57SiX2Zhdmljb25f5Y+M5YiXCi8vIEBuYW1lOnpoLUNOICBBQy1iYWlkdTrph43lrprlkJHkvJjljJbnmb7luqbmkJzni5fosLfmrYzlv4XlupTmkJzntKJfZmF2aWNvbl/lj4zliJcKLy8gQG5hbWU6amEgICAgQUMtYmFpZHU66YeN5a6a5ZCR5pyA6YGp5YyWQmFpZHXjga7mkJzni5fjga5Hb29nbGXjga5CaW5n5qSc57Si57WQ5p6c44Gu44Oq44OA44Kk44Os44Kv44OI6Zmk5Y67K2Zhdmljb24KLy8gQGRlc2NyaXB0aW9uICAxLue5numBjueZvuW6puOAgeaQnOeLl+OAgeiwt+atjOOAgeWlveaQnOaQnOe0oue1kOaenOS4reeahOiHquW3seeahOi3s+i9iemPiOaOpe+8jOebtOaOpeioquWVj+WOn+Wni+e2sumggS3lj43mraPpg73og73nnIvmh4IgMi7mlrDlop7oh6rlrprkuYnnvZHnq5nmi6bmiKrlip/og70gM+a3u+WKoEZhdmljb27mmL7npLogNC7pobXpnaJDU1MgNS7mt7vliqDorqHmlbAgNi7lvIDlhbPpgInmi6nku6XkuIrlip/og70gNy7oh6rliqjnv7vpobXlip/og70KLy8gQGRlc2NyaXB0aW9uOmVuICAxLmJ5cGFzcyB0aGUgcmVkaXJlY3QgbGluayBhdCBiYWlkdVxzb2dvdVxnb29nbGVcaGFvc291OyAyLnJlbW92ZSBhZHMgYXQgYmFpZHU7IDMuYWRkIEZhdmljb24gZm9yIGVhY2ggd2Vic2l0ZTsgNC5yZW5kZXIgeW91ciBvd24gc3R5bGU7IDUuY291bnRlcjsgNi5Td2l0Y2ggdG8gaGFuZGxlIGFsbCA3LkF1dG8gUGFnZXIKLy8gQGRlc2NyaXB0aW9uOmphICAxLui/guWbnkJhaWR144CBU29nb3XjgIFHb29nbGXjgIFIYW9zb3XmpJzntKLmpJzntKLntZDmnpzjga7kuK3jga7oh6rliIbjga7pgbfnp7vjg6rjg7Pjgq87IDIuQmFpZHXjga7kvZnliIbjgarluoPlkYrjgpLlj5bjgorpmaTjgY87IDMu44Kz44Oh44Oz44OI44KS6L+95YqgOyA0LuODmuODvOOCuOOBruOCq+OCueOCv+ODoENTUDsgNS7jgqvjgqbjg7Pjg4jjgpLov73liqA7IDYu44K544Kk44OD44OB44Gv5Lul5LiK44Gu5qmf6IO944KS6YG45oqe44GX44G+44GZOyA3LuiHquWLleODmuODvOOCuOOCgeOBj+OCii4KLy8gQGljb24gICAgaHR0cHM6Ly9hZTAxLmFsaWNkbi5jb20va2YvSGFjMWE1ODA1NWM1MDQ3Y2RiOTEzNDllOTFhYTIwOGQ1ay5qcGcKLy8gQGF1dGhvciAgICBBQwovLyBAbGljZW5zZSAgICBHUEwtMy4wLW9ubHkKLy8gQGNyZWF0ZSAgICAgMjAxNS0xMS0yNQovLyBAcnVuLWF0ICAgICBkb2N1bWVudC1zdGFydAovLyBAdmVyc2lvbiAgICAyNC4xMgovLyBAY29ubmVjdCAgICB3d3cuYmFpZHUuY29tCi8vIEBpbmNsdWRlICAgICo6Ly9pcHY2LmJhaWR1LmNvbS8qCi8vIEBpbmNsdWRlICAgICo6Ly93d3cuYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgICAgKjovL3d3dzEuYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgICAgKjovL20uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgICAgKjovL3h1ZXNodS5iYWlkdS5jb20vcyoKLy8gQGluY2x1ZGUgICAgKjovL3d3dy5zby5jb20vcz8qCi8vIEBpbmNsdWRlICAgICo6Ly8qLmJpbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgKjovL2VuY3J5cHRlZC5nb29nbGUuKi9zZWFyY2gqCi8vIEBpbmNsdWRlICAgICo6Ly8qLmdvb2dsZSovc2VhcmNoKgovLyBAaW5jbHVkZSAgICAqOi8vKi5nb29nbGUqL3dlYmhwKgovLyBAaW5jbHVkZSAgICAqOi8vKi56aGlodS5jb20vKgovLyBAaW5jbHVkZSAgICAqOi8vKmR1Y2tkdWNrZ28uY29tLyoKLy8gQGluY2x1ZGUgICAgKjovLyouZG9nZWRvZ2UuY29tLyoKLy8gQGV4Y2x1ZGUgICAgKjovLyouZ29vZ2xlKi9zb3JyeSoKLy8gQG5hbWVzcGFjZSAgMTM1MzQ2NDUzOUBxcS5jb20KLy8gQHN1cHBvcnRVUkwgIGh0dHBzOi8vYWMudHVqaWR1LmNvbS8KLy8gQGhvbWUtdXJsICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy96aC1UVy9zY3JpcHRzLzE0MTc4Ci8vIEBob21lLXVybDIgIGh0dHBzOi8vZ2l0aHViLmNvbS9sYW5ncmVuMTM1My9HTV9zY3JpcHQKLy8gQGhvbWVwYWdlVVJMICBodHRwczovL2dyZWFzeWZvcmsub3JnL3poLVRXL3NjcmlwdHMvMTQxNzgKLy8gQGNvcHlyaWdodCAgMjAxNS0yMDIwLCBBQwovLyBAbGFzdG1vZGlmaWVkICAyMDIwLTA5LTI3Ci8vIEBmZWVkYmFjay11cmwgIGh0dHBzOi8vYWMudHVqaWR1LmNvbQovLyBAbm90ZSAgICAyMDIwLjEwLTE5LVYyNC4xMiDmi6bmiKrml7bmlK/mjIFVUkzlnLDlnYDnmoTljLnphY3vvIzosIPmlbRmYXZpY29u5Lya5b2x5ZON5qCH6aKY5paH5a2X6YCJ5Lit55qE6Zeu6aKY77yb5L+u5aSN6LC35q2M5oum5oiq5qih5byP5aSx5pWI55qE6Zeu6aKY77yM5L+u5aSN6LC35q2M57yW5Y+36Zeu6aKY77yb5L+u5aSN5b+F5bqU5Zu+54mH5YGP5Y+z55qE6Zeu6aKYCi8vIEBub3RlICAgIDIwMjAuMDktMjktVjI0LjExIOmSiOWvueeZvuW6puW+i+W4iOWHveWGheWuueWvueiEmuacrOi/m+ihjOiwg+aVtO+8jOaJqeWxleKAnOeZvuW6puS8mOWMluKAneW3sue7j+awuOS5heS4i+e6vwovLyBAbm90ZSAgICAyMDIwLjA5LTI3LVYyNC4xMCDkv67lpI3nmb7luqbmi6bmiKrmqKHlvI/nmoTpl67popjku6Xlj4rlsI/lnLDlnYDlsL7ms6jvvJvkv67lpI3lpb3mkJznmoTmi6bmiKrlip/og73vvJvkv67lpI3pg6jliIbmoLflvI/pl67popgKLy8gQG5vdGUgICAgMjAyMC4wOS0xMi1WMjQuMDkg5L+u5aSN57+76aG15aSx5pWI55qE6Zeu6aKY77yb5pu05paw6YOo5YiG5qC35byP5YaF5a65Ci8vIEBub3RlICAgIDIwMjAuMDktMTEtVjI0LjA4IOabtOaNolZ1ZeeahGNkbuWcsOWdgO+8jOWwvemHj+WKoOW/q+aVsOaNrueahOi9veWFpemAn+W6pu+8m+S4uuS6huWFvOWuuXNhZmFyaeWwhueZvuW6pueahGh0dHBz5Zyw5Z2A5pu/5o2i5Li65LqGaHR0cOWcsOWdgO+8m+S/ruWkjWZhdmljb27ojrflj5bnmoTpl67popjvvJvlop7liqBmYXZpY29u5Yqo5oCB5Yi35paw77yb5L+u5aSN6YOo5YiG5qC35byP6Zeu6aKYCi8vIEBub3RlICAgIDIwMjAuMDgtMDYtVjI0LjA3IOS/ruWkjeS/neWtmOaXoOaViOeahOmXrumimO+8m+S/ruWkjeeZvuW6puWcqOWNleWIl+WxheS4reeahOaXtuWAmemUmeS9jeeahOmXrumimAovLyBAbm90ZSAgICAyMDIwLjA4LTA1LVYyNC4wNiDkv67lpI3oh6rlrprkuYnlgbblsJTmiZPkuI3lvIDnmoTpl67popjvvJvkv67lpI3lrprml7blmajlj6/og73kvJrpgKDmiJDnmoTlpLHmlYjnmoTpl67popjvvJvkv67lpI3lvZPlrZjlnKjlpJrkuKrohJrmnKzlj6/og73pgKDmiJDnmoTlhrLnqoHpl67popgKLy8gQG5vdGUgICAgMjAyMC4wOC0wMy1WMjQuMDUg5pu05paw5L+u5aSN5oqk55y85qih5byP55qE6Zeu6aKY77yb5L+u5aSN5omp5bGV5LiK5YG25bCU5aSx5pWI55qE6Zeu6aKY77yb5penRWRnZeS8vOS5jue7j+W4uOacieS/neWtmOS4jeeUn+aViOeahOmXrumimO+8jOa1i+ivleS4jeaYr+aIkeeahOWOn+WboAovLyBAbm90ZSAgICAyMDIwLjA4LTAyLVYyNC4wNCDliqjmgIHmoLflvI/liIfmjaLvvIzlpJrliJfmlYjmnpzkuIDplK7liIfmjaLvvIzml6DpnIDliLfmlrAg5L+u5aSN5ZCE56eN5qC35byP6Zeu6aKYIOS/ruWkjeW/heW6lOe/u+mhtemXrumimCDmtYvor5XlhbzlrrlHTeWSjFZNLuW9u+W6leS4jeaUr+aMgeaQnOeLl+aQnOe0oi0t5Yir6Zeu5Li65LuA5LmI77yM5oiR6L+Y5oOz5aSa5rS75Yeg5bm0Ci8vIEBub3RlICAgIDIwMjAuMDctMjctVjI0LjImMyDmm7TmjaJWdWXkuLo3NeWboueahOWcsOWdgCDkv67lpI3nmb7luqbnmoRsaXRl5qih5byP5YiH5o2i5peg5pWI55qE6Zeu6aKYCi8vIEBub3RlICAgIDIwMjAuMDctMjctVjI0LjAxIOabtOaWsOaUr+aMgUxpbnV45LiL55qERmlyZWZveCBlbW3kv67lpI3kuIrmrKHmj5DkuqTov4fkuo7nnYDmgKXlr7zoh7TnmoTmoLflvI/mnKrmj5DkuqQg5pu05paw5pSv5oyBRG9nZURvZ2XlpJrlkInmkJzntKIt5L2G5LiN5aSE55CG6YeN5a6a5ZCRCi8vIEBub3RlICAgIDIwMjAuMDctMjYtVjI0LjAwIOmDqOWIhuWGheWuueabtOaNouS4ulZ1ZeWIneWni+WMlu+8jOWHj+WwkeS4gOWumueahOi1hOa6kOWNoOeUqCAmJiDmlrDlop5EdWNrR29Hb+eahOagt+W8j+aViOaenCAtIOiAg+iZkeWIsER1Y2tHb0dv55qE54m55oCn77yM5LiN5a+55YW26L+b6KGM5bm/5ZGK6L+H5rukCi8vIEBub3RlICAgIDIwMjAuMDctMDktVjIzLjMzIOS/ruWkjWJpbmfnmoTpobbpg6jliIfmjaLplJnkvY3nmoTpl67popjvvJvlop7liqB3dzEuYmFpZHUuY29t5Z+f77yb5L+u5aSN5ZCE56eN5qC35byPKOeZvuW6puOAgeiwt+atjOOAgeWlveaQnOOAgeW/heW6lCnplJnkvY3nmoTpl67popgKLy8gQG5vdGUgICAgMjAyMC4wNC0yNC1WMjMuMzIg54mI5pys5YCS6YCA77ya5a6J5YWo6LW36KeB77ya6buY6K6k5YWz6Zet5pCc54uX55qE6Ieq5a6a5LmJ5Z+f5ZCN5oum5oiq5Yqf6IO95ZKM6YeN5a6a5ZCR5Yqf6IO9LeS7peWQjuiAg+iZkeabtOaNouaWueW8j++8m+m7mOiupOS4jeW8gOWQr+mHjeWumuWQkeWKn+iDveOAgem7mOiupOS4jeW8gOWQr+W5v+WRiuaLpuaIquWKn+iDve+8m+abtOaWsOmDqOWIhuivtOaYjuWGheWuue+8m+WQjOaXtuS5n+WvuemDqOWIhuaUr+aMgeS4jeWIsOS9jeeahO+8jOWFvOWuueS4jeWlveeahOaViOaenOWQkeWkp+WutuivtOS4gOWjsOaKseatie+8jOS5i+WQjuaIkeS8muabtOWKoOWKquWKm+iuqeaQnOe0oue7k+aenOabtOWKoOaWueS+v+afpeeci+WSjOS9v+eUqAovLyBAbm90ZSAgICAyMDIwLjAzLTI3LVYyMy4zMSDkv67lpI1nb29nbGXnlLHkuo7pobXpnaLnu5PmnoTmm7TmlrDlr7zoh7TnmoRibG9ja+WKn+iDveWkseaViOeahOmXrumimO+8jOWQjOaXtuS/ruWkjeiwt+atjOaKpOecvOaooeW8j+S5n+WkseaViOeahOmXrumimOOAguaWsOWinue/u+mhteeahOaMiemSruS6i+S7tu+8jOaWsOWinuS9v+eUqOWcqOe6v2NvbmZpZ++8jOmBv+WFjeeUseS6jumhtemdoue7k+aehOaUueWKqOWPiOmcgOimgemHjeaWsOaPkOS6pOiEmuacrOabtOaWsAovLyBAbm90ZSAgICAyMDE3LjA1LjEyIC0+IDIwMjAuMDMtMjYgJiYgVjguNiAtPiBWMjMuMzAg5ZCE56eN5ZCE5qC355qE5Y6G5Y+y5pu05paw6K6w5b2V77yM5LuO5LiA5Liq54mI5pys6L+t5Luj5Yiw5Y+m5LiA5Liq54mI5pysCi8vIEBub3RlICAgIDIwMTcuMDUuMTItVjguNCDmlrDlop7vvJrpu5jorqTlsY/olL3osLfmrYznmoTlronlhajmkJzntKLlip/og70KLy8gQG5vdGUgICAgMjAxNy4wNS4wNS1WOC4zIOS/ruWkjWluY2x1ZGXojIPlm7TlpKrlsI/lr7zoh7TnmoTnmb7luqbnn6XpgZPnmoTlsY/olL3pl67popgKLy8gQG5vdGUgICAgMjAxNy4wNS4wNC1WOC4yIOe7iOS6juS/ruWkjeS6hueZvuW6puefpemBk+WbvueJh+abv+aNouS6huaWh+Wtl+eahOi/meS4quWkp0JVRzsg6aG65L6/5aSE55CG5LqGc3VwZXJhcGkuemhpZGFvLmJhaWR1LmNvbTsg5paw5aKe6LC35q2M5pCc57Si57uT5p6c6YeN5a6a5ZCR5Y676ZmkCi8vIEBub3RlICAgIDIwMTcuMDUuMDQtVjguMSDnu4jkuo7kv67lpI3kuobnmb7luqbnn6XpgZPlm77niYfmm7/mjaLkuobmloflrZfnmoTov5nkuKrlpKdCVUfvvIzpobrkvr/lpITnkIbkuoZzdXBlcmFwaS56aGlkYW8uYmFpZHUuY29tCi8vIEBub3RlICAgIDIwMTcuMDUuMDQtVjguMCDnu4jkuo7kv67lpI3kuobnmb7luqbnn6XpgZPlm77niYfmm7/mjaLkuobmloflrZfnmoTov5nkuKrlpKdCVUfvvIzlvoXmtYvor5UKLy8gQG5vdGUgICAgMjAxNy4wMy4yOC1WNy42IOS/ruWkjeWcqFZpb2xlbnRNb25rZXnkuIrnmoTkuI3mlK/mjIHnmoTpl67popgKLy8gQG5vdGUgICAgMjAxNy4wMy4yOC1WNy41IOWwneivleS/ruWkjWNocm9tZeS4iueahOmXrumimAovLyBAbm90ZSAgICAyMDE3LjAzLjIxLVY3LjQg5bCd6K+V5aSE55CGRWRnZeS4iuS4jeaUr+aMgeeahOmXrumimO+8jOe7k+aenOWPkeeOsOaYr0VkZ2XmnKzouqvnmoRUYW1wZXJNb25rZXnmlK/mjIHmnInpl67popgKLy8gQG5vdGUgICAgMjAxNy4wMy4xOS1WNy4zIOS/ruWkjeaJk+W8gOeZvuW6puS5i+WQjuWGjeasoeeCueWHu+KAnOeZvuW6puS4gOS4i+KAneWvvOiHtOeahOaXoOazleabtOaWsOmHjeWumuWQkemXrumimAovLyBAbm90ZSAgICAyMDE3LjAzLjE5LVY3LjIg5pyq55+l5Y6f5ZugY2hyb21l55qETXV0YXRpb25PYnNlcnZlcuaXoOazleS9v+eUqOS6hu+8jOe7p+e7reWbnuW9kuS7peWJjeeahERPTU5vZGVJbnNlcnRlZAovLyBAbm90ZSAgICAyMDE3LjAyLjE3LVY3LjAg5L+u5aSN5pCc54uX55qE5pCc57Si57uT5p6c6YeN5a6a5ZCR6Zeu6aKYK+aUueS4quWQjeWtlwovLyBAbm90ZSAgICAyMDE3LjAyLjE3LVY2Ljkg5L+u5aSN5pCc54uX55qE5pCc57Si57uT5p6c6YeN5a6a5ZCR6Zeu6aKYCi8vIEBub3RlICAgIDIwMTYuMTAuMjctVjYuNyDkv67lpI3kuobku6XliY3nmoTph43lpI3or7fmsYLvvIznjrDlnKjnmoTor7fmsYLmlbDlupTor6XlsI/kuoblvojlpJrvvIznvZHnu5zkuZ/lsLHkuI3ljaHkuobvvIzmhJ/op4nokIzokIzlk5IKLy8gQG5vdGUgICAgMjAxNi4wNC4yNC1WNi42IOaBouWkjeS7peWJjeeahOeJiOacrO+8jOWboOS4uuWFvOWuueaAp+mXrumimAovLyBAbm90ZSAgICAyMDE1LjEyLjAxLVY1LjAg5Yqg5YWl5pCc54uX55qE5pSv5oyB77yM5L2G5piv5pSv5oyB5LiN5piv5b6I5aW9Ci8vIEBub3RlICAgIDIwMTUuMTEuMjUtVjIuMCDkvJjljJbvvIzlt7Lnu4/mmK/nnJ/lrp7lnLDlnYDnmoTkuI3lho3lsJ3or5Xojrflj5YKLy8gQG5vdGUgICAgMjAxNS4xMS4yNS1WMS4wIOWujOaIkOWOu+aOieeZvuW6pumHjeWumuWQkeeahOWKn+iDvQovLyBAcmVzb3VyY2UgIGJhaWR1Q29tbW9uU3R5bGUgICBodHRwOi8vaWJhaWR1Lm50YW93LmNvbS9uZXdjc3MvYmFpZHVDb21tb25TdHlsZS5jc3M/dD0yNC4xMgovLyBAcmVzb3VyY2UgIGJhaWR1T25lUGFnZVN0eWxlICBodHRwOi8vaWJhaWR1Lm50YW93LmNvbS9uZXdjc3MvYmFpZHVPbmVQYWdlU3R5bGUuY3NzP3Q9MjQuMTIKLy8gQHJlc291cmNlICBiYWlkdVR3b1BhZ2VTdHlsZSAgaHR0cDovL2liYWlkdS5udGFvdy5jb20vbmV3Y3NzL2JhaWR1VHdvUGFnZVN0eWxlLmNzcz90PTI0LjEyCi8vIEByZXNvdXJjZSAgYmFpZHVMaXRlU3R5bGUgICAgIGh0dHA6Ly9pYmFpZHUubnRhb3cuY29tL25ld2Nzcy9iYWlkdUxpdGVTdHlsZS5jc3M/dD0yNC4xMgovLyBAcmVzb3VyY2UgIGdvb2dsZUNvbW1vblN0eWxlICBodHRwOi8vaWJhaWR1Lm50YW93LmNvbS9uZXdjc3MvZ29vZ2xlQ29tbW9uU3R5bGUuY3NzP3Q9MjQuMTIKLy8gQHJlc291cmNlICBnb29nbGVPbmVQYWdlU3R5bGUgaHR0cDovL2liYWlkdS5udGFvdy5jb20vbmV3Y3NzL2dvb2dsZU9uZVBhZ2VTdHlsZS5jc3M/dD0yNC4xMgovLyBAcmVzb3VyY2UgIGdvb2dsZVR3b1BhZ2VTdHlsZSBodHRwOi8vaWJhaWR1Lm50YW93LmNvbS9uZXdjc3MvZ29vZ2xlVHdvUGFnZVN0eWxlLmNzcz90PTI0LjEyCi8vIEByZXNvdXJjZSAgYmluZ0NvbW1vblN0eWxlICAgIGh0dHA6Ly9pYmFpZHUubnRhb3cuY29tL25ld2Nzcy9iaW5nQ29tbW9uU3R5bGUuY3NzP3Q9MjQuMTIKLy8gQHJlc291cmNlICBiaW5nT25lUGFnZVN0eWxlICAgaHR0cDovL2liYWlkdS5udGFvdy5jb20vbmV3Y3NzL2JpbmdPbmVQYWdlU3R5bGUuY3NzP3Q9MjQuMTIKLy8gQHJlc291cmNlICBiaW5nVHdvUGFnZVN0eWxlICAgaHR0cDovL2liYWlkdS5udGFvdy5jb20vbmV3Y3NzL2JpbmdUd29QYWdlU3R5bGUuY3NzP3Q9MjQuMTIKLy8gQHJlc291cmNlICBkdWNrQ29tbW9uU3R5bGUgICAgaHR0cDovL2liYWlkdS5udGFvdy5jb20vbmV3Y3NzL2R1Y2tDb21tb25TdHlsZS5jc3M/dD0yNC4xMgovLyBAcmVzb3VyY2UgIGR1Y2tPbmVQYWdlU3R5bGUgICBodHRwOi8vaWJhaWR1Lm50YW93LmNvbS9uZXdjc3MvZHVja09uZVBhZ2VTdHlsZS5jc3M/dD0yNC4xMgovLyBAcmVzb3VyY2UgIGR1Y2tUd29QYWdlU3R5bGUgICBodHRwOi8vaWJhaWR1Lm50YW93LmNvbS9uZXdjc3MvZHVja1R3b1BhZ2VTdHlsZS5jc3M/dD0yNC4xMgovLyBAcmVzb3VyY2UgIGRvZ2VDb21tb25TdHlsZSAgICBodHRwOi8vaWJhaWR1Lm50YW93LmNvbS9uZXdjc3MvZG9nZUNvbW1vblN0eWxlLmNzcz90PTI0LjEyCi8vIEByZXNvdXJjZSAgZG9nZU9uZVBhZ2VTdHlsZSAgIGh0dHA6Ly9pYmFpZHUubnRhb3cuY29tL25ld2Nzcy9kb2dlT25lUGFnZVN0eWxlLmNzcz90PTI0LjEyCi8vIEByZXNvdXJjZSAgZG9nZVR3b1BhZ2VTdHlsZSAgIGh0dHA6Ly9pYmFpZHUubnRhb3cuY29tL25ld2Nzcy9kb2dlVHdvUGFnZVN0eWxlLmNzcz90PTI0LjEyCi8vIEByZXNvdXJjZSAgTWFpbkh1WWFuU3R5bGUgICAgIGh0dHA6Ly9pYmFpZHUubnRhb3cuY29tL25ld2Nzcy9IdVlhblN0eWxlLmNzcz90PTI0LjEyCi8vIEByZXNvdXJjZSAgU2l0ZUNvbmZpZ1J1bGVzICAgIGh0dHA6Ly9pYmFpZHUubnRhb3cuY29tL25ld2Nzcy9TaXRlQ29uZmlnUnVsZXMuY29uZj90PTI0LjEyCi8vIEByZXF1aXJlIGh0dHBzOi8vY2RuLnN0YXRpY2ZpbGUub3JnL3Z1ZS8yLjYuMTEvdnVlLmpzCi8vIEByZXF1aXJlIGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vdnVlQDIuNi4xMi9kaXN0L3Z1ZS5qcwovLyBAZ3JhbnQgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgIEdNLmdldFZhbHVlCi8vIEBncmFudCAgICBHTV9zZXRWYWx1ZQovLyBAZ3JhbnQgICAgR00uc2V0VmFsdWUKLy8gQGdyYW50ICAgIEdNX2FkZFN0eWxlCi8vIEBncmFudCAgICBHTV9nZXRSZXNvdXJjZVVybAovLyBAZ3JhbnQgICAgR00uZ2V0UmVzb3VyY2VVcmwKLy8gQGdyYW50ICAgIEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBncmFudCAgICBHTV9nZXRSZXNvdXJjZVRleHQKLy8gQGdyYW50ICAgIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQKLy8gQGdyYW50ICAgIHVuc2FmZVdpbmRvdwovLyA9PS9Vc2VyU2NyaXB0PT0KCgohZnVuY3Rpb24gKCkgewogIGxldCBpc2RlYnVnID0gZmFsc2U7CiAgbGV0IGlzTG9jYWxEZWJ1ZyA9IGlzZGVidWcgfHwgZmFsc2U7CiAgbGV0IGRlYnVnID0gaXNkZWJ1ZyA/IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSkgOiBmdW5jdGlvbiAoKSB7CiAgfTsKICBsZXQgYWNDc3NMb2FkRmxhZyA9IGZhbHNlOwoKICBsZXQgaW5FeHRNb2RlID0gdHlwZW9mIChpc0V4dGVuc2lvbikgIT09ICJ1bmRlZmluZWQiOwogIGxldCBpbkdNTW9kZSA9IHR5cGVvZiAoR01faW5mby5zY3JpcHRIYW5kbGVyKSAhPT0gInVuZGVmaW5lZCI7IC8vID0gIkdyZWFzZW1vbmtleSIgfHwgIlRhbXBlcm1vbmtleSIgfHwgIlZpb2xlbnRNb25rZXkiCiAgLy8g5paw54mI5pys55qER3JlYXNlTW9ua2V55piv5bim5pyJc2NyaXB0SGFuZGxlcu+8jOS9huaYr+ayoeaciUdNX2dldFJlc291cmNlVGV4dO+8m+aXp+eJiOacrOS4jeW4pnNjcmlwdEhhbmRsZXLvvIzkvYbmmK/mnIlHTV9nZXRSZXNvdXJjZVRleHQKICAvLyBsZXQgaXNOZXdHTSA9IHR5cGVvZihHTV9pbmZvLnNjcmlwdEhhbmRsZXIpICE9PSAidW5kZWZpbmVkIiAmJiBHTV9pbmZvLnNjcmlwdEhhbmRsZXIudG9Mb3dlckNhc2UoKSA9PT0gImdyZWFzZW1vbmtleSI7CiAgbGV0IGlzTmV3R00gPSBmYWxzZTsKICAvLyBpbkV4dE1vZGUgJiBpbkdNTW9kZQogIC8vIHRydWUgICAgdHJ1ZSA95omp5bGV5LiL55qER03ku6PnoIEg5LiN5omn6KGMCiAgLy8gdHJ1ZSAgICBmYWxzZT3mianlsZXkuIvku6PnoIEg5omn6KGMCiAgLy8gZmFsc2UgIHRydWUgPeS7hUdN5Luj56CBIOaJp+ihjAogIC8vIGZhbHNlICBmYWxzZT3lvILluLgg5L2G5piv6L+Y5piv6KaB5omn6KGM5Luj56CBCiAgZGVidWcoIueoi+W6j+W8gOWniyIpOwogIGlmIChpbkV4dE1vZGUgPT09IHRydWUgJiYgaW5HTU1vZGUgPT09IHRydWUgfHwgdHlwZW9mKHdpbmRvdy5BQzY2NkluaXQpICE9PSAndW5kZWZpbmVkJykgewogICAgY29uc29sZS5sb2coIuaJqeWxleaooeW8jy3ohJrmnKzkuI3lkK/nlKgiKTsKICAgIHJldHVybjsKICB9CiAgd2luZG93LkFDNjY2SW5pdCA9IHRydWUKICBpZiAodHlwZW9mIChHTSkgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAvLyDov5nkuKrmmK9WaW9sZW50TW9ua2V555qE5pSv5oyB6YCJ6aG5CiAgICBHTSA9IHt9OwogICAgR00uc2V0VmFsdWUgPSBHTV9zZXRWYWx1ZTsKICAgIEdNLmdldFZhbHVlID0gR01fZ2V0VmFsdWU7CiAgfQogIChmdW5jdGlvbiAoKSB7CiAgICBkZWJ1Zygi56iL5bqP5omn6KGMIik7CiAgICBsZXQgbmVlZERpc3BsYXlOZXdGdW4gPSB0cnVlOyAvLyDmnKzmrKHmm7TmlrDmmK/lkKbmnInmlrDlip/og73pnIDopoHlsZXnpLoKICAgIGlmICh3aW5kb3cuTm9kZUxpc3QgJiYgIU5vZGVMaXN0LnByb3RvdHlwZS5mb3JFYWNoKSB7CiAgICAgIE5vZGVMaXN0LnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24gKGNhbGxiYWNrLCB0aGlzQXJnKSB7CiAgICAgICAgdGhpc0FyZyA9IHRoaXNBcmcgfHwgd2luZG93OwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzQXJnLCB0aGlzW2ldLCBpLCB0aGlzKTsKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICBpZiAoIUFycmF5LnByb3RvdHlwZS5hY3B1c2gpIHsKICAgICAgLyoqCiAgICAgICAqIOi/m+ihjOS4jemHjeWkjeaPkuWFpe+8jOaPkuWFpeWQjuaJp+ihjOWbnuiwg+WHveaVsAogICAgICAgKiBAcGFyYW0gZGF0YSDlvoXmj5LlhaXmlbDmja4KICAgICAgICogQHBhcmFtIGNhbGxiYWNrIOWbnuiwg+WHveaVsAogICAgICAgKi8KICAgICAgQXJyYXkucHJvdG90eXBlLmFjcHVzaCA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykgewogICAgICAgIC8vIOWmguaenOaYr+Weg+WcvuaVsOaNru+8jOmCo+S5iOWPr+S7peS4ouW8g+eahAogICAgICAgIGlmIChkYXRhID09IG51bGwgfHwgZGF0YSA9PSAiIikgcmV0dXJuOwogICAgICAgIC8vIOWmguaenOaVsOaNruS4reacieWbnui9pu+8jOmCo+aVsOaNruS5n+aYr+aXoOaViOeahOato+aWh+iAjOW3sgogICAgICAgIGlmIChkYXRhLnJlcGxhY2UoLyh7fH18LHxcK3zvvJp844CCfFxuKS8pICE9PSBkYXRhKSByZXR1cm47CiAgICAgICAgaWYgKHRoaXMuZmluZEluZGV4KG0gPT4gbSA9PT0gZGF0YSkgPCAwKSB7CiAgICAgICAgICB0aGlzLnB1c2goZGF0YSk7CiAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh0aGlzKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIEFycmF5LnByb3RvdHlwZS5hY3JlbW92ZSA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykgewogICAgICAgIGxldCBkZWxJZCA9IHRoaXMuZmluZEluZGV4KG0gPT4gbSA9PT0gZGF0YSk7CiAgICAgICAgaWYgKGRlbElkID49IDApIHsKICAgICAgICAgIHRoaXMuc3BsaWNlKGRlbElkLCAxKTsKICAgICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHRoaXMpOwogICAgICAgIH0gLy8g5Yig6ZmkZGVsSWTnmoTmlbDmja7vvIzliKDpmaTkuIDkuKoKICAgICAgfTsKICAgIH0KICAgIC8vIGxldCBSZWRpcmVjdE1hcCA9IG5ldyBNYXAoKTsKICAgIGxldCBBQ0NvbmZpZyA9IHt9OwogICAgbGV0IERCQ29uZmlnID0ge307IC8vIOS7heS9nOS4uuaZrumAmkFDQ29uZmln55qE5Y6f5aeL5aSH5Lu977yM5Zyo5YW25LuW6Z2e5YWz6ZSu5L2N572u5pe26L+b6KGM5L+d5a2Y5L2/55SoCiAgICAvKuWtmOWcqOWvueacquWIneWni+WMluWPmOmHj+eahOWIneWni+WMlui1i+WAvC3ml6DpnIDmi4Xlv4Pov63ku6Plhbzlrrnpl67popgqLwogICAgbGV0IERlZmF1bHRDb25maWcgPSB7CiAgICAgIGlzUmVkaXJlY3RFbmFibGU6IGZhbHNlLCAgLy8g5piv5ZCm5byA5ZCv6YeN5a6a5ZCR5Yqf6IO9CiAgICAgIGlzQWRzRW5hYmxlOiBmYWxzZSwgLy8g5piv5ZCm5byA5ZCv5Y675bm/5ZGK5qih5byPCiAgICAgIGlzQXV0b3BhZ2U6IHRydWUsICAvLyDmmK/lkKblvIDlkK/oh6rliqjnv7vpobXlip/og70KICAgICAgaXNCbG9ja0VuYWJsZTogZmFsc2UsIC8vIOaYr+WQpuW8gOWQr+WOu+aLpuaIquaooeW8jwogICAgICBpc0Jsb2NrRGlzcGxheTogZmFsc2UsIC8vIOaYr+WQpuWIoOmZpOW3suaLpuaIqueahOadoeebrgogICAgICBpc0Jsb2NrQnRuTm90RGlzcGxheTogZmFsc2UsIC8vIOaYr+WQpuaYvuekumJsb2Nr5oyJ6ZKuCiAgICAgIEFkc1N0eWxlRW5hYmxlOiB0cnVlLCAvLyDmmK/lkKblvIDlkK/oh6rlrprkuYnmoLflvI/mqKHlvI8KCiAgICAgIGJhaWR1OiB7CiAgICAgICAgbmFtZTogJ2JhaWR1JywgIC8vIENTUyBsb2FkIOeahOWJjee8gOagh+W/lwogICAgICAgIEFkc1N0eWxlTW9kZTogJzEnLCAvLyAwLeS4jeW4pmNzc++8mzEt5Y2V5YiX6Z2g5bem77ybMi3ljZXliJflsYXkuK3vvJszLeWPjOWIl+WxheS4rQogICAgICAgIEh1WWFuTW9kZTogZmFsc2UsIC8vIOaKpOecvOaooeW8jy3nmb7luqYKICAgICAgfSwKICAgICAgZ29vZ2xlOiB7CiAgICAgICAgbmFtZTogJ2dvb2dsZScsCiAgICAgICAgQWRzU3R5bGVNb2RlOiAnMycsIC8vIDAt5LiN5bimY3Nz77ybMS3ljZXliJfpnaDlt6bvvJsyLeWNleWIl+WxheS4re+8mzMt5Y+M5YiX5bGF5LitCiAgICAgICAgSHVZYW5Nb2RlOiBmYWxzZSwgLy8g5oqk55y85qih5byPLeiwt+atjAogICAgICB9LAogICAgICBiaW5nOiB7CiAgICAgICAgbmFtZTogJ2JpbmcnLAogICAgICAgIEFkc1N0eWxlTW9kZTogJzMnLCAvLyAwLeS4jeW4pmNzc++8mzEt5Y2V5YiX6Z2g5bem77ybMi3ljZXliJflsYXkuK3vvJszLeWPjOWIl+WxheS4rQogICAgICAgIEh1WWFuTW9kZTogZmFsc2UsIC8vIOaKpOecvOaooeW8jy3lv4XlupQKICAgICAgfSwKICAgICAgZHVjazogewogICAgICAgIG5hbWU6ICdkdWNrJywKICAgICAgICBBZHNTdHlsZU1vZGU6ICczJywgLy8gMC3kuI3luKZjc3PvvJsxLeWNleWIl+mdoOW3pu+8mzIt5Y2V5YiX5bGF5Lit77ybMy3lj4zliJflsYXkuK0KICAgICAgICBIdVlhbk1vZGU6IGZhbHNlLCAvLyDmiqTnnLzmqKHlvI8tRHVja0dPR08KICAgICAgfSwKICAgICAgZG9nZTogewogICAgICAgIG5hbWU6ICdkb2dlJywKICAgICAgICBBZHNTdHlsZU1vZGU6ICczJywgLy8gMC3kuI3luKZjc3PvvJsxLeWNleWIl+mdoOW3pu+8mzIt5Y2V5YiX5bGF5Lit77ybMy3lj4zliJflsYXkuK0KICAgICAgICBIdVlhbk1vZGU6IGZhbHNlLCAvLyDmiqTnnLzmqKHlvI8tRHVja0dPR08KICAgICAgfSwKICAgICAgc29nb3U6IHsKICAgICAgICBuYW1lOiAnc29nb3UnLAogICAgICAgIEFkc1N0eWxlTW9kZTogJzEnLCAvLyAwLeS4jeW4pmNzc++8mzEt5Y2V5YiX6Z2g5bem77ybMi3ljZXliJflsYXkuK3vvJszLeWPjOWIl+WxheS4rQogICAgICAgIEh1WWFuTW9kZTogZmFsc2UsIC8vIOaKpOecvOaooeW8jy3mkJzni5cKICAgICAgfSwKCiAgICAgIFN0eWxlX0JhaWR1TGl0ZTogZmFsc2UsIC8vIEJhaWR1X0xpdGXmoLflvI/ooagKCiAgICAgIGRlZmF1bHRIdVlhbkNvbG9yOiAiI0RFRjFFRiIsCiAgICAgIGlzVXNlckNvbG9yRW5hYmxlOiB0cnVlLCAvLyDmmK/lkKblvIDlkK9mYXZpY29u5Zu+5qCH5Yqf6IO9CiAgICAgIGlzRmF2aWNvbkVuYWJsZTogdHJ1ZSwgLy8g5piv5ZCm5byA5ZCvZmF2aWNvbuWbvuagh+WKn+iDvQogICAgICBkZWZhdWx0RmF2aWNvblVybDogImh0dHBzOi8vYWUwMS5hbGljZG4uY29tL2tmL0hUQjFkUlkwWDhPRDNLVmpTWkZGcTZBbjlwWGF5LmpwZyIsIC8vIOm7mOiupOWbvuagh+WcsOWdgAogICAgICBkb0Rpc2FibGVTdWc6IHRydWUsIC8vIOaYr+WQpuemgeatoueZvuW6puaQnOe0oumihOa1iwogICAgICBpc1JpZ2h0RGlzcGxheUVuYWJsZTogdHJ1ZSwgLy8g5piv5ZCm5byA5ZCv5Y+z5L6n6L655qCPCiAgICAgIGlzQ291bnRlckVuYWJsZTogZmFsc2UsIC8vIOaYr+WQpuaYvuekuuiuoeaVsOWZqAogICAgICBpc0FMaW5lRW5hYmxlOiBmYWxzZSwgLy8g5piv5ZCm56aB5q2i5LiL5YiS57q/CiAgICAgIGlzVXNlclN0eWxlRW5hYmxlOiBmYWxzZSwgLy8g5piv5ZCm5byA5ZCv6Ieq5a6a5LmJ5qC35byPCiAgICAgIG5vcm1hbGl6ZUR1Y2s6IHRydWUsIC8vIOaYr+WQpuaMieeFp+W4uOeUqOS5oOaDr+WOu+mFjee9rkR1Y2tEdWNrR28KICAgICAgaXNFbkxhbmc6IGZhbHNlLAogICAgICBpc0dvb2xlSW5CYWlkdU1vZGVFbmFibGU6IGZhbHNlLCAvLyDmmK/lkKblvIDlkK/osLfmrYzmkJzntKLnu5PmnpzpobXnmoTnmb7luqblm77moIfmmL7npLoKICAgICAgVXNlckJsb2NrTGlzdDogW10sCiAgICAgIFVzZXJTdHlsZVRleHQ6CiAgICAgICAgYC8qKuiuoeaVsOWZqOeahOminOiJsuagt+W8jyovCmRpdiAuQUMtQ291bnRlclR7CiAgYmFja2dyb3VuZDogI0ZEOTk5OTsKfQovKirlj7PkvqfmoI/nmoTmoLflvI8t5YW25a6e5LiN5byA5ZCv5pu05aW955yL5LiA5LqbKi8KI2NvbnRlbnRfcmlnaHR7CiAgcGFkZGluZzogMjBweCAxNXB4IDE1cHg7CiAgYm9yZGVyLXJhZGl1czogNXB4OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICBib3gtc2hhZG93OiAwIDAgMjBweCAycHggcmdiYSgwLCAwLCAwLCAuMSk7CiAgLXdlYmtpdC1ib3gtc2hhZG93OiAwIDAgMjBweCAycHggcmdiYSgwLCAwLCAwLCAuMSk7CiAgLW1vei1ib3gtc2hhZG93OiAwIDAgMjBweCAycHggcmdiYSgwLCAwLCAwLCAuMSk7Cn0KLyoqKirlj6/ku6XliqDkuIDkupvoh6rlt7HnmoTog4zmma/lm77niYcs5pu/5o2i5byV5Y+35YaF55qE5YaF5a655Li65Y+v5aSW6ZO+55qE5Zu+54mH5Y2z5Y+vKioqKi8KYm9keVtiYWlkdV17CiAgYmFja2dyb3VuZC1yZXBlYXQ6IHJlcGVhdC15OwogIGJhY2tncm91bmQtc2l6ZTogMTAwJTsKICBiYWNrZ3JvdW5kLWF0dGFjaG1lbnQ6Zml4ZWQ7CiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCdodHRwczovL3RpbWdzYS5iYWlkdS5jb20vdGltZz9pbWFnZSZxdWFsaXR5PTgwJnNpemU9Yjk5OTlfMTAwMDAmc2VjPTE1NjQ3NTYyNzcyNTAmZGk9ODY4YjllYWM5YmUxNGRmMWRlZGQ4YzdkNmE3MTA4NDQmaW1ndHlwZT0wJnNyYz1odHRwJTNBJTJGJTJGcGhvdG9jZG4uc29odS5jb20lMkYyMDEzMDUzMCUyRkltZzM3NzUwMjMzMy5qcGcnKTsKfQovKioqKirnqpflj6Pog4zmma/nmoTpgI/mmI7omZrljJbmlYjmnpwqKioqKi8KYm9keT4jd3JhcHBlcixib2R5Pi53cmFwLGJvZHk+I21haW4sYm9keSAjYXBwYmFyLGJvZHkgI2hkdGJTdW17CiAgYmFja2dyb3VuZDogcmdiYSgyMjUsMjI1LDIyNSwwLjgpOwp9Ci8qKumakOiXj+mmlumhteeahOWkp+Wbvuaghy3kv67lpI3lj6/og73lr7zoh7TlpJbmj7TmoLflvI/lvILluLgqKi8KYm9keVtiYWlkdV0gI3NfbGdfaW1nX25ld3sKICBkaXNwbGF5Om5vbmUgIWltcG9ydGFudDsKfQojd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQsICN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVyewogIGJvcmRlci1yYWRpdXM6IDVweDsKfWAsCiAgICAgIG9sZFZlcnNpb246ICIiLAogICAgICBsYXN0U2F2ZVRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgfTsKICAgIGxldCBDT05TVCA9IHsKICAgICAgaGFzTmV3RnVuY05lZWREaXNwbGF5OiB0cnVlLAogICAgICBzb3J0SW5kZXg6IDEsCiAgICAgIGlzR29vZ2xlSW1hZ2VVcmw6IGZhbHNlLAogICAgICB1c2VJdGVtOiB7fSwKICAgICAgU3R5bGVNYW5nZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgfSwKICAgIH07CgogICAgdmFyIGN1clNpdGUgPSB7CiAgICAgIFNpdGVUeXBlSUQ6IDEsICAvLyDlvZPliY3nq5nngrnnmoRJRAogICAgICBNYWluVHlwZTogIiIsICAgIC8vIOS4u+S9k+iKgueCue+8jOW+iOWkmuS4queahOeItuiKgueCuQogICAgICBTdHlwZV9Ob3JtYWw6ICIiLCAvLyDph43lrprlkJHpgInmi6nlmajvvIzlj6rmnInnmb7luqYt5pCc54uXLeWlveaQnAogICAgICBGYXZpY29uVHlwZTogIiIsICAvLyBmYXZpY29u55qE5Z+f5ZCN5qOA5p+l5ZmoY2l0Ze+8jOeUqOS6juiOt+WPlmhvc3TnlKgKICAgICAgRmF2aWNvbkFkZFRvOiAiIiwgLy8gZmF2aWNvbumAieaLqeWZqO+8jOeUqOS6juaPkuWFpeWIsHRpdGxl5LmL5YmN55qECiAgICAgIENvdW50ZXJUeXBlOiAiIiwgIC8vIOiuoeaVsOWZqOa3u+WKoOeahOS9jee9ru+8jOS4gOiIrOWSjGZhdmljb27kvY3nva7kuIDoh7QKICAgICAgQmxvY2tUeXBlOiAiIiwgIC8vIOWxj+iUveaMiemSrueahOS9jee9ru+8jOS4gOiIrOWcqHRpdGxl5LmL5ZCOCiAgICB9OwogICAgbGV0IERCU2l0ZSA9IHsKICAgICAgYmFpZHU6IHsKICAgICAgICBTaXRlVHlwZUlEOiAxLAogICAgICAgIE1haW5UeXBlOiAiI2NvbnRlbnRfbGVmdCAuYy1jb250YWluZXIiLAogICAgICAgIFN0eXBlX05vcm1hbDogImgzLnQ+YSwgLmMtY29udGFpbmVyIGFydGljbGUgYSIsCiAgICAgICAgRmF2aWNvblR5cGU6ICIuYy1zaG93dXJsIiwKICAgICAgICBGYXZpY29uQWRkVG86ICJoMyIsCiAgICAgICAgQ291bnRlclR5cGU6ICIjY29udGVudF9sZWZ0PiNkb3VibGU+ZGl2W3NyY2lkXSAqW2NsYXNzfj10XSxbY2xhc3N+PW9wX2Jlc3RfYW5zd2VyX3F1ZXN0aW9uXSwjY29udGVudF9sZWZ0PmRpdltzcmNpZF0gKltjbGFzc349dF0sW2NsYXNzfj1vcF9iZXN0X2Fuc3dlcl9xdWVzdGlvbl0iLAogICAgICAgIEJsb2NrVHlwZTogImgzIGEiLAogICAgICAgIHBhZ2VyOiB7CiAgICAgICAgICBuZXh0TGluazogJy8vZGl2W0BpZD0icGFnZSJdLy9hW2NvbnRhaW5zKHRleHQoKSwi5LiL5LiA6aG1IildW0BocmVmXScsCiAgICAgICAgICBwYWdlRWxlbWVudDogImNzcztkaXYjY29udGVudF9sZWZ0ID4gKiIsCiAgICAgICAgICBIVF9pbnNlcnQ6IFsiY3NzO2RpdiNjb250ZW50X2xlZnQiLCAyXSwKICAgICAgICAgIHJlcGxhY2VFOiAiY3NzOyNwYWdlIiwKICAgICAgICAgIHN0eWxpc2g6ICIuYXV0b3BhZ2VyaXplX3BhZ2VfaW5mbywgZGl2LnNwLXNlcGFyYXRvciB7bWFyZ2luLWJvdHRvbTogMTBweCAhaW1wb3J0YW50O30iLAogICAgICAgIH0KICAgICAgfSwKICAgICAgc29nb3U6IHsKICAgICAgICBTaXRlVHlwZUlEOiAyLAogICAgICAgIE1haW5UeXBlOiAiI21haW4gLnJlc3VsdHM+ZGl2IiwKICAgICAgICBTdHlwZV9Ob3JtYWw6ICJoMy5wdD5hLCBoMy52clRpdGxlPmEiLAogICAgICAgIEZhdmljb25UeXBlOiAiY2l0ZVtpZCo9J2NhY2hlcmVzdWx0X2luZm9fJ10iLAogICAgICAgIEZhdmljb25BZGRUbzogImgzIiwKICAgICAgICBDb3VudGVyVHlwZTogIi5yZXN1bHRzPmRpdiIsCiAgICAgICAgQmxvY2tUeXBlOiAiaDMgYSIsCiAgICAgICAgcGFnZXI6IHsKICAgICAgICAgIG5leHRMaW5rOiAiLy9kaXZbQGlkPVwicGFnZWJhcl9jb250YWluZXJcIl0vL2FbQGlkPVwic29nb3VfbmV4dFwiXSIsCiAgICAgICAgICBwYWdlRWxlbWVudDogIi8vZGl2W0BjbGFzcz1cInJlc3VsdHNcIl0vZGl2IiwKICAgICAgICAgIEhUX2luc2VydDogWyIvL2RpdltAY2xhc3M9XCJyZXN1bHRzXCJdIiwgMl0sCiAgICAgICAgICByZXBsYWNlRTogImlkKFwicGFnZWJhcl9jb250YWluZXJcIikiCiAgICAgICAgfQogICAgICB9LAogICAgICBoYW9zb3U6IHsKICAgICAgICBTaXRlVHlwZUlEOiAzLAogICAgICAgIE1haW5UeXBlOiAiLnJlcy1saXN0IiwKICAgICAgICBTdHlwZV9Ob3JtYWw6ICIucmVzLWxpc3QgaDM+YSIsCiAgICAgICAgRmF2aWNvblR5cGU6ICJjaXRlIiwKICAgICAgICBGYXZpY29uQWRkVG86ICJoMyIsCiAgICAgICAgQ291bnRlclR5cGU6ICIucmVzdWx0cz5kaXYiLAogICAgICAgIEJsb2NrVHlwZTogImgzIGEiLAogICAgICAgIHBhZ2VyOiB7CiAgICAgICAgICBuZXh0TGluazogIi8vZGl2W0BpZD0ncGFnZSddLy9hW3RleHQoKT0n5LiL5LiA6aG1PiddIHwgaWQoJ3NuZXh0JykiLAogICAgICAgICAgcGFnZUVsZW1lbnQ6ICIvL2RpdltAaWQ9J2NvbnRhaW5lciddL2RpdiIsCiAgICAgICAgICBIVF9pbnNlcnQ6IFsiLy9kaXZbQGlkPSdjb250YWluZXInXSIsIDJdLAogICAgICAgICAgcmVwbGFjZUU6ICJpZCgncGFnZScpIgogICAgICAgIH0KICAgICAgfSwKICAgICAgZ29vZ2xlOiB7CiAgICAgICAgU2l0ZVR5cGVJRDogNCwKICAgICAgICBNYWluVHlwZTogIiNyc28gLmciLAogICAgICAgIEZhdmljb25UeXBlOiAiLmlVaDMwIiwKICAgICAgICBGYXZpY29uQWRkVG86ICJoMyIsCiAgICAgICAgQ291bnRlclR5cGU6ICIjcnNvIC5nIGgzLC5feUU+ZGl2W2NsYXNzfj1fa2tdIGgzIiwKICAgICAgICBCbG9ja1R5cGU6ICIucmM+LnI+YSIsCiAgICAgICAgcGFnZXI6IHsKICAgICAgICAgIG5leHRMaW5rOiAnaWQoInBubmV4dCIpIHwgaWQoIm5hdmJhciBuYXZjbnQgbmF2IikvL3RkW3NwYW5dL2ZvbGxvd2luZy1zaWJsaW5nOjp0ZFsxXS9hIHwgaWQoIm5uIikvcGFyZW50OjphJywKICAgICAgICAgIHBhZ2VFbGVtZW50OiAnLy9kaXZbQGlkPSJyZXMiXScsCiAgICAgICAgICBIVF9pbnNlcnQ6IFsiY3NzOyNyZXMiLCAyXSwKICAgICAgICAgIHJlcGxhY2VFOiAnLy9kaXZbQGlkPSJuYXZjbnQiXSB8IC8vZGl2W0BpZD0iZm9vdCJdW0Byb2xlPSJuYXZpZ2F0aW9uIl0nCiAgICAgICAgfQogICAgICB9LAogICAgICBiaW5nOiB7CiAgICAgICAgU2l0ZVR5cGVJRDogNSwKICAgICAgICBNYWluVHlwZTogIiNiX3Jlc3VsdHM+bGkiLAogICAgICAgIEZhdmljb25UeXBlOiAiLmJfYXR0cmlidXRpb24+Y2l0ZSIsCiAgICAgICAgRmF2aWNvbkFkZFRvOiAiaDIiLAogICAgICAgIENvdW50ZXJUeXBlOiAiI2JfcmVzdWx0cz5saVtjbGFzc349Yl9hbnNdPmgyLCNiX3Jlc3VsdHM+bGlbY2xhc3N+PWJfYWxnb10+aDIsI2JfcmVzdWx0cz5saVtjbGFzc349Yl9hbGdvXT5oMiIsCiAgICAgICAgQmxvY2tUeXBlOiAiaDIgYSIsCiAgICAgICAgcGFnZXI6IHsKICAgICAgICAgIG5leHRMaW5rOiAiLy9hW2NvbnRhaW5zKEBjbGFzcyxcInNiX3BhZ05cIildIiwKICAgICAgICAgIHBhZ2VFbGVtZW50OiAiaWQoXCJiX3Jlc3VsdHNcIikvbGlbbm90KGNvbnRhaW5zKEBjbGFzcyxcImJfcGFnXCIpIG9yIGNvbnRhaW5zKEBjbGFzcyxcImJfYW5zIGJfdG9wXCIpKV0iLAogICAgICAgICAgSFRfaW5zZXJ0OiBbImlkKFwiYl9yZXN1bHRzXCIpL2xpW0BjbGFzcz1cImJfcGFnXCJdIiwgMV0sCiAgICAgICAgICByZXBsYWNlRTogImlkKFwiYl9yZXN1bHRzXCIpLy9uYXZbQHJvbGU9XCJuYXZpZ2F0aW9uXCJdIiwKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGR1Y2s6IHsKICAgICAgICBTaXRlVHlwZUlEOiAxMCwKICAgICAgICBNYWluVHlwZTogIiNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIiwKICAgICAgICBGYXZpY29uVHlwZTogIi5yZXN1bHRzX2xpbmtzX2RlZXAgLnJlc3VsdF9fdXJsX19kb21haW4iLAogICAgICAgIEZhdmljb25BZGRUbzogImgyIiwKICAgICAgICBDb3VudGVyVHlwZTogIiNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIGgyIiwKICAgICAgICBCbG9ja1R5cGU6ICJoMiBhIiwKICAgICAgICBwYWdlcjogewogICAgICAgICAgbmV4dExpbms6ICIvL2FbY29udGFpbnMoQGNsYXNzLFwic2JfcGFnTlwiKV0iLAogICAgICAgICAgcGFnZUVsZW1lbnQ6ICJpZChcImJfcmVzdWx0c1wiKS9saVtub3QoY29udGFpbnMoQGNsYXNzLFwiYl9wYWdcIikgb3IgY29udGFpbnMoQGNsYXNzLFwiYl9hbnMgYl90b3BcIikpXSIsCiAgICAgICAgICBIVF9pbnNlcnQ6IFsiaWQoXCJiX3Jlc3VsdHNcIikvbGlbQGNsYXNzPVwiYl9wYWdcIl0iLCAxXSwKICAgICAgICAgIHJlcGxhY2VFOiAiaWQoXCJiX3Jlc3VsdHNcIikvL25hdltAcm9sZT1cIm5hdmlnYXRpb25cIl0iLAogICAgICAgIH0KICAgICAgfSwKICAgICAgZG9nZTogewogICAgICAgIFNpdGVUeXBlSUQ6IDExLAogICAgICAgIE1haW5UeXBlOiAiI2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAiLAogICAgICAgIEZhdmljb25UeXBlOiAiLnJlc3VsdHNfbGlua3NfZGVlcCAucmVzdWx0X191cmxfX2RvbWFpbiIsCiAgICAgICAgRmF2aWNvbkFkZFRvOiAiaDIiLAogICAgICAgIENvdW50ZXJUeXBlOiAiI2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgaDIiLAogICAgICAgIEJsb2NrVHlwZTogImgyIGEiLAogICAgICAgIHBhZ2VyOiB7CiAgICAgICAgICBuZXh0TGluazogIi8vYVtjb250YWlucyhAY2xhc3MsXCJzYl9wYWdOXCIpXSIsCiAgICAgICAgICBwYWdlRWxlbWVudDogImlkKFwiYl9yZXN1bHRzXCIpL2xpW25vdChjb250YWlucyhAY2xhc3MsXCJiX3BhZ1wiKSBvciBjb250YWlucyhAY2xhc3MsXCJiX2FucyBiX3RvcFwiKSldIiwKICAgICAgICAgIEhUX2luc2VydDogWyJpZChcImJfcmVzdWx0c1wiKS9saVtAY2xhc3M9XCJiX3BhZ1wiXSIsIDFdLAogICAgICAgICAgcmVwbGFjZUU6ICJpZChcImJfcmVzdWx0c1wiKS8vbmF2W0Byb2xlPVwibmF2aWdhdGlvblwiXSIsCiAgICAgICAgfQogICAgICB9LAogICAgICBtQmFpZHU6IHsKICAgICAgICBTaXRlVHlwZUlEOiA2LAogICAgICAgIE1haW5UeXBlOiAiI2JfcmVzdWx0cz5saSIsCiAgICAgICAgRmF2aWNvblR5cGU6ICIuYl9hdHRyaWJ1dGlvbj5jaXRlIiwKICAgICAgICBGYXZpY29uQWRkVG86ICJoMiIsCiAgICAgICAgQ291bnRlclR5cGU6ICIjYl9yZXN1bHRzPmxpW2NsYXNzfj1iX2Fuc10+aDIsI2JfcmVzdWx0cz5saVtjbGFzc349Yl9hbGdvXT5oMiwjYl9yZXN1bHRzPmxpW2NsYXNzfj1iX2FsZ29dPmgyIiwKICAgICAgICBCbG9ja1R5cGU6ICJoMiBhIiwKICAgICAgfSwKICAgICAgemhpaHU6IHsKICAgICAgICBTaXRlVHlwZUlEOiA3LAogICAgICB9LAogICAgICBiYWlkdV94dWVzaHU6IHsKICAgICAgICBTaXRlVHlwZUlEOiA4LAogICAgICAgIE1haW5UeXBlOiAiI2NvbnRlbnRfbGVmdCAucmVzdWx0IiwKICAgICAgICBTdHlwZV9Ob3JtYWw6ICJoMy50PmEsICNyZXN1bHRzIC5jLWNvbnRhaW5lcj4uYy1ibG9ja2EiLAogICAgICAgIEZhdmljb25UeXBlOiAiLnJlc3VsdC1vcCwgLmMtc2hvd3VybCIsIC8vIGJhaWR1IOS8vOS5juimgeaUueeJiOS6hu+8nwogICAgICAgIEZhdmljb25BZGRUbzogImgzIiwKICAgICAgICBDb3VudGVyVHlwZTogIiNjb250ZW50X2xlZnQ+I2RvdWJsZT5kaXZbc3JjaWRdICpbY2xhc3N+PXRdLFtjbGFzc349b3BfYmVzdF9hbnN3ZXJfcXVlc3Rpb25dLCNjb250ZW50X2xlZnQ+ZGl2W3NyY2lkXSAqW2NsYXNzfj10XSxbY2xhc3N+PW9wX2Jlc3RfYW5zd2VyX3F1ZXN0aW9uXSIsCiAgICAgICAgQmxvY2tUeXBlOiAiaDMgYSIsCiAgICAgIH0sCiAgICAgIG90aGVyOiB7CiAgICAgICAgU2l0ZVR5cGVJRDogOSwKICAgICAgfQogICAgfTsKICAgIGxldCBTaXRlVHlwZSA9IHsKICAgICAgQkFJRFU6IERCU2l0ZS5iYWlkdS5TaXRlVHlwZUlELAogICAgICBNQkFJRFU6IERCU2l0ZS5tQmFpZHUuU2l0ZVR5cGVJRCwKICAgICAgU09HT1U6IERCU2l0ZS5zb2dvdS5TaXRlVHlwZUlELAogICAgICBTTzogREJTaXRlLmhhb3NvdS5TaXRlVHlwZUlELAogICAgICBHT09HTEU6IERCU2l0ZS5nb29nbGUuU2l0ZVR5cGVJRCwKICAgICAgQklORzogREJTaXRlLmJpbmcuU2l0ZVR5cGVJRCwKICAgICAgRFVDSzogREJTaXRlLmR1Y2suU2l0ZVR5cGVJRCwKICAgICAgRE9HRTogREJTaXRlLmRvZ2UuU2l0ZVR5cGVJRCwKICAgICAgWkhJSFU6IERCU2l0ZS56aGlodS5TaXRlVHlwZUlELAogICAgICBCQUlEVV9YVUVTSFU6IERCU2l0ZS5iYWlkdV94dWVzaHUuU2l0ZVR5cGVJRCwKICAgICAgT1RIRVJTOiA4CiAgICB9OwogICAgbGV0IG90aGVyRGF0YSA9IHsKICAgICAgb3RoZXI6IHsKICAgICAgICBzaG93U2Vjb25kUGFuZWw6IGZhbHNlLCAvLyDlsZXnpLrnrKzkuoxwYW5lbAogICAgICAgIHNob3dCbG9ja0xpc3RBcmVhOiBmYWxzZSwgLy8gYmxvY2tMaXN05bGV56S65L2NdGV4dGFyZWEKICAgICAgICBhZGRCbG9ja0l0ZW06ICIiLCAgICAgLy8g55So5oi35omL5Yqo6L6T5YWl55qE5oum5oiq6KeE5YiZCiAgICAgICAgY3VySG9zdHM6IFtdLCAgICAgICAgIC8vIOWtmOaUvuW3sue7j+iuv+mXrueahGhvc3Rz5pWw5o2u5YaF5a65CiAgICAgIH0KICAgIH07ICAvLyDliLDml7blgJnmjILovb3liLBvdGhlcuS4igogICAgbGV0IEFsbERhdGEgPSB7CiAgICAgIEFDQ29uZmlnOiB7fSwKICAgICAgb3RoZXI6IG90aGVyRGF0YS5vdGhlciwKICAgICAgQ09OU1Q6IENPTlNULAogICAgICBsYW46IHsKICAgICAgICB1c2U6IHt9LAogICAgICAgIHpoX2NuOiB7CiAgICAgICAgICBtZW51X3RleHQ6ICLoh6rlrprkuYkiLAogICAgICAgICAgY3VyTGFuZzogInpoX2NuIiwKICAgICAgICAgIGZpZWxkc2V0X3BhbmVsOiB7CiAgICAgICAgICAgIHBhbmVsX3RpdGxlOiAiQUMt6YeN5a6a5ZCR6K6+572uICIgKyBHTV9pbmZvLnNjcmlwdC52ZXJzaW9uICsgKGluRXh0TW9kZT8gJ0V4dCc6JycpLAogICAgICAgICAgICBzZXR0aW5nX3BhbmVsOiB7CiAgICAgICAgICAgICAgcmVkaXJlY3RfdGV4dDogIuS4u+WKn+iDvS3ph43lrprlkJHlip/og70iLAogICAgICAgICAgICAgIHJlZGlyZWN0X3RpdGxlOiAi6YeN5a6a5ZCR5Yqf6IO955qE5byA5ZCv5LiO5ZCmIiwKICAgICAgICAgICAgICB1c2VFbl90ZXh0OiAiRW4tTGFuZ3VhZ2UiLAogICAgICAgICAgICAgIHVzZUVuX3RpdGxlOiAiVXNpbmcgRW5nbGlzaCBsYW5ndWFnZSB0byBkaXNwbGF5IiwKICAgICAgICAgICAgICBhZHNfdGV4dDogIumZhOWKoDEt5Y675bm/5ZGK5Yqf6IO9IiwKICAgICAgICAgICAgICBhZHNfdGl0bGU6ICLljrvpmaTpg6jliIbpobXpnaLnmoTlub/lkYrkv6Hmga/vvIzov5jkvaDkuIDkuKrlubLlh4DmlbTmtIHnmoTpobXpnaIiLAogICAgICAgICAgICAgIGF1dG9wYWdlX3RleHQ6ICLoh6rliqjnv7vpobUiLAogICAgICAgICAgICAgIGF1dG9wYWdlX3RpdGxlOiAi6Ieq5Yqo57+76aG1IiwKICAgICAgICAgICAgICBibG9ja2VuYWJsZV90ZXh0OiAi6ZmE5YqgMi3oh6rkuLvmi6bmiKrln5/lkI0iLAogICAgICAgICAgICAgIGJsb2NrZW5hYmxlX3RpdGxlOiAi54K55Ye76aG16Z2iYmxvY2vmjInpkq7mt7vliqDkvaDmg7PopoHpmpDol4/nmoTlnLDlnYDvvIzohJrmnKzlsIboh6rliqjpmpDol4/pg6jliIbnu5PmnpzkuLrlsI/mqKrluYXvvIxESVnmjInpkq7kuK3ngrnlh7vooajmoLzlhoXlrrnlj6/ku6Xlj5bmtojpmpDol48iLAogICAgICAgICAgICAgIGJsb2NrRGl5QnRuX3RleHQ6ICJESVkiLAogICAgICAgICAgICAgIGJsb2NrRGl5QnRuX3RpdGxlOiAi6Ieq5a6a5LmJQkxPQ0siLAogICAgICAgICAgICAgIGJsb2NrQXV0b1JlbW92ZV90ZXh0OiAi6ZqQ6JeP57uT5p6cIiwKICAgICAgICAgICAgICBibG9ja0F1dG9SZW1vdmVfdGl0bGU6ICLoh6rliqjpmpDol4/lt7Lnu4/lsY/olL3nmoTln5/lkI0iLAogICAgICAgICAgICAgIGJsb2NrQnRuU2hvd190ZXh0OiAi6ZqQ6JePJ2Jsb2NrJ+aMiemSriIsCiAgICAgICAgICAgICAgYmxvY2tCdG5TaG93X3RpdGxlOiAi6ZqQ6JeP5o6JYmxvY2vmjInpkq7nmoTmmL7npLoiLAoKICAgICAgICAgICAgICB1c2VyU3R5bGVfdGV4dDogIumZhOWKoDMt6Ieq5a6a5LmJ5qC35byPIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmFpZHVfbGFibGU6ICLlsZXlvIDnmb7luqborr7nva4+PiIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2JhaWR1X29yaWdpbjogIueZvuW6pi3ljp/lp4vmqKHlvI8iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iYWlkdV9odXlhbjogIueZvuW6pi3miqTnnLzmqKHlvI8iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iYWlkdV9iYWlkdUxpdGU6ICLnmb7luqZMaXRl5qC35byPIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmFpZHVfMWxpbmU6ICLljZXliJciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iYWlkdV8xbGluZV9lbnRlcjogIuWNleWIl+WxheS4rSIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2JhaWR1XzJsaW5lOiAi5Y+M5YiXIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmFpZHVfM2xpbmU6ICLkuInliJciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iYWlkdV80bGluZTogIuWbm+WIlyIsCgogICAgICAgICAgICAgIHVzZXJTdHlsZV9nb29nbGVfbGFibGU6ICLlsZXlvIDosLfmrYzorr7nva4+PiIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV9vcmlnaW46ICLosLfmrYwt5Y6f5aeL5qih5byPIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZ29vZ2xlX2h1eWFuOiAi6LC35q2MLeaKpOecvOaooeW8jyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV9nb29nbGVMaXRlOiAi6LC35q2MLeS8quijheeZvuW6piIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV8xbGluZTogIuWNleWIlyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV8xbGluZV9lbnRlcjogIuWNleWIl+WxheS4rSIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV8ybGluZTogIuWPjOWIlyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV8zbGluZTogIuS4ieWIlyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV80bGluZTogIuWbm+WIlyIsCgogICAgICAgICAgICAgIHVzZXJTdHlsZV9iaW5nX2xhYmxlOiAi5bGV5byA5b+F5bqU6K6+572uPj4iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iaW5nX29yaWdpbjogIuW/heW6lC3ljp/lp4vmqKHlvI8iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iaW5nX2h1eWFuOiAi5b+F5bqULeaKpOecvOaooeW8jyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2JpbmdfMWxpbmU6ICLljZXliJciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iaW5nXzFsaW5lX2VudGVyOiAi5Y2V5YiX5bGF5LitIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmluZ18ybGluZTogIuWPjOWIlyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2JpbmdfM2xpbmU6ICLkuInliJciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iaW5nXzRsaW5lOiAi5Zub5YiXIiwKCiAgICAgICAgICAgICAgdXNlclN0eWxlX3NvZ291X2xhYmxlOiAi5bGV5byA5pCc54uX6K6+572uPj4iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9zb2dvdV9vcmlnaW46ICLmkJzni5ct5Y6f5aeL5qih5byPIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfc29nb3VfaHV5YW46ICLmkJzni5ct5oqk55y85qih5byPIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfc29nb3VfMWxpbmU6ICLljZXliJciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9zb2dvdV8xbGluZV9lbnRlcjogIuWNleWIl+WxheS4rSIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX3NvZ291XzJsaW5lOiAi5Y+M5YiXIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfc29nb3VfM2xpbmU6ICLkuInliJciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9zb2dvdV80bGluZTogIuWbm+WIlyIsCgogICAgICAgICAgICAgIHVzZXJTdHlsZV9kdWNrX2xhYmxlOiAi5bGV5byA6bit6bit5pCc6K6+572uPj4iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kdWNrX29yaWdpbjogIum4rem4rS3ljp/lp4vmqKHlvI8iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kdWNrX2h1eWFuOiAi6bit6bitLeaKpOecvOaooeW8jyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2R1Y2tfbm9ybWFsOiAi6bit6bitLeW4uOingemFjee9riIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2R1Y2tfMWxpbmU6ICLljZXliJciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kdWNrXzFsaW5lX2VudGVyOiAi5Y2V5YiX5bGF5LitIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZHVja18ybGluZTogIuWPjOWIlyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2R1Y2tfM2xpbmU6ICLkuInliJciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kdWNrXzRsaW5lOiAi5Zub5YiXIiwKCiAgICAgICAgICAgICAgdXNlclN0eWxlX2RvZ2VfbGFibGU6ICLlsZXlvIDlpJrlkInorr7nva4+PiIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2RvZ2Vfb3JpZ2luOiAi5aSa5ZCJLeWOn+Wni+aooeW8jyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2RvZ2VfaHV5YW46ICLlpJrlkIkt5oqk55y85qih5byPIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZG9nZV9ub3JtYWw6ICLlpJrlkIkt5bi46KeB6YWN572uIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZG9nZV8xbGluZTogIuWNleWIlyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2RvZ2VfMWxpbmVfZW50ZXI6ICLljZXliJflsYXkuK0iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kb2dlXzJsaW5lOiAi5Y+M5YiXIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZG9nZV8zbGluZTogIuS4ieWIlyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2RvZ2VfNGxpbmU6ICLlm5vliJciLAoKICAgICAgICAgICAgICBodXlhbk1vZGVfdGV4dDogIumZhOWKoDQt5oqk55y86aKc6Imy6YWN572uLeiHquWumuS5iTPkuK3pnIDlr7nlupTlvIDlkK8iLAogICAgICAgICAgICAgIGh1eWFuTW9kZV90aXRsZTogIu+8gemcgOimgeWcqOiHquWumuS5ieagt+W8j+S4reWQr+eUqOaKpOecvOaooeW8jyIsCiAgICAgICAgICAgICAgaHV5YW5Db2xvcl90ZXh0OiAi6buY6K6k5oqk55y86aKc6Imy77yaIiwKICAgICAgICAgICAgICBodXlhbkNvbG9yX3RpdGxlOiAi6Ieq5a6a5LmJ55qE5oqk55y86aKc6Imy77yaIiwKICAgICAgICAgICAgICBodXlhbkNvbG9yTW9yZV90ZXh0OiAi5pu05aSa6aKc6Imy6YCJ5oupIiwKCiAgICAgICAgICAgICAgZmF2aWNvbl90ZXh0OiAi6ZmE5YqgNS1GYXZpY29u5Yqf6IO9IiwKICAgICAgICAgICAgICBmYXZpY29uX3RpdGxlOiAiQUMt5re75YqgRmF2aWNvbiIsCiAgICAgICAgICAgICAgZmF2aWNvbl9kZWZhdWx0SWNvbl90ZXh0OiAiRmF2aWNvbum7mOiupOWbvuagh++8miIsCgogICAgICAgICAgICAgIHNlYXJjaE9yaWdpbl90ZXh0OiAi6ZmE5YqgNi3np7vpmaTnmb7luqbmkJzntKLpooTmtYso5paH5a2X6Ieq5Yqo5pCc57SiKSIsCiAgICAgICAgICAgICAgc2VhcmNoT3JpZ2luX3RpdGxlOiAiQUMt56e76Zmk5pCc57Si6aKE5rWLIiwKCiAgICAgICAgICAgICAgc2hvd1JpZ2h0X3RleHQ6ICLpmYTliqA3LeaYvuekuuWPs+S+p+agjyIsCiAgICAgICAgICAgICAgc2hvd0NvdW50ZXJfdGV4dDogIumZhOWKoDgt57yW5Y+35Yqf6IO9IiwKICAgICAgICAgICAgICBzaG93QUxpbmVfdGV4dDogIumZhOWKoDkt5paH5a2X5LiL5YiS57q/IiwKICAgICAgICAgICAgICBzaG93VXNlclN0eWxlX3RleHQ6ICLpmYTliqAxMC3oh6rlrprkuYnmoLflvI8iLAoKICAgICAgICAgICAgICBjb250YWN0TWVfdGV4dDogIuiBlOezu+S9nOiAhSzmj5Dlu7rorq4s5a+75rGC5biu5YqpLOiHquWumuS5ieagt+W8jyzohJrmnKzlrprliLbngrnmiJEiLAogICAgICAgICAgICAgIGNvbnRhY3RNZV91cmw6ICJodHRwczovL2FjLnR1amlkdS5jb20iLAoKICAgICAgICAgICAgICBzZXR0aW5nX3BhbmVsX3NlY29uZDogewogICAgICAgICAgICAgICAgYmFja0J0bl90ZXh0OiAiPC3ov5Tlm54iLAogICAgICAgICAgICAgICAgYmxvY2tMYWJlbF90ZXh0OiAiIOaLpuaIquWIl+ihqCAg5oOz6KaB55Sf5pWI55qE6K+d6ZyA6KaB5omL5Yqo5L+d5a2YIiwKICAgICAgICAgICAgICAgIGJsb2NrRWRpdEJ0bl90ZXh0OiAi57yW6L6R5YiX6KGoIiwKICAgICAgICAgICAgICAgIGJsb2NrRWRpdEJ0bkVuZF90ZXh0OiAi57uT5p2f57yW6L6RIiwKICAgICAgICAgICAgICAgIGFkZEJsb2NrTGFiZWxfdGV4dDogIuWFqOWMuemFjeaLpuaIqu+8miIsCiAgICAgICAgICAgICAgICBhZGRCdG5MYWJlbF90ZXh0OiAi5re75YqgIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNhbmNlbEJ0bl90ZXh0OiAi5Y+W5raIIiwKICAgICAgICAgICAgICBva0J0bl90ZXh0OiAi5L+d5a2YIiwKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZW46IHsKICAgICAgICAgIG1lbnVfdGV4dDogIkNVU1RPTSIsCiAgICAgICAgICBjdXJMYW5nOiAiZW4iLAogICAgICAgICAgZmllbGRzZXRfcGFuZWw6IHsKICAgICAgICAgICAgcGFuZWxfdGl0bGU6ICJBQyBSZWRpcmVjdCBTZXR0aW5ncyAiICsgR01faW5mby5zY3JpcHQudmVyc2lvbiArIChpbkV4dE1vZGU/ICdFeHQnOicnKSwKICAgICAgICAgICAgc2V0dGluZ19wYW5lbDogewogICAgICAgICAgICAgIHJlZGlyZWN0X3RleHQ6ICJNYWluLVJlZGlyZWN0RnVuYyIsCiAgICAgICAgICAgICAgcmVkaXJlY3RfdGl0bGU6ICJUdXJuIG9uIG9yIG9mZiByZWRpcmVjdCIsCiAgICAgICAgICAgICAgdXNlRW5fdGV4dDogIkVuLUxhbmd1YWdlIiwKICAgICAgICAgICAgICB1c2VFbl90aXRsZTogIuS9v+eUqOiLseaWh+aYvuekuumhtemdoiIsCiAgICAgICAgICAgICAgYWRzX3RleHQ6ICJBZGQxLVJlbW92ZSBBZHMiLAogICAgICAgICAgICAgIGFkc190aXRsZTogIlJlbW92ZSB0aGUgYWRzIG9uIHRoZSBwYWdlLCBhbmQgcmV0dXJuIHlvdSBhIGNsZWFuIHBhZ2UiLAogICAgICAgICAgICAgIGF1dG9wYWdlX3RleHQ6ICJBdXRvIFBhZ2VyIiwKICAgICAgICAgICAgICBhdXRvcGFnZV90aXRsZTogIkF1dG8gUGFnZXIiLAogICAgICAgICAgICAgIGJsb2NrZW5hYmxlX3RleHQ6ICJBZGQyLUJsb2NrIGhvc3QiLAogICAgICAgICAgICAgIGJsb2NrZW5hYmxlX3RpdGxlOiAiQ2xpY2sgdGhlIEJsb2NrIGJ1dHRvbiB0byBhZGQgdGhlIGFkZHJlc3Mgd2hpY2ggeW91IHdhbnQgdG8gaGlkZS4gVGhlIHNjcmlwdCB3aWxsIGhpZGUgaXQgd2l0aCBzbWFsbCBiYW5uZXIgYXV0b21hdGljYWxseS4gRElZIGJ1dHRvbiBmb3IgZWRpdHRpbmcgdGhlIGhpZGluZyBsaXN0IiwKICAgICAgICAgICAgICBibG9ja0RpeUJ0bl90ZXh0OiAiRElZIiwKICAgICAgICAgICAgICBibG9ja0RpeUJ0bl90aXRsZTogIkVkaXQgQkxPQ0siLAogICAgICAgICAgICAgIGJsb2NrQXV0b1JlbW92ZV90ZXh0OiAiQXV0byByZW1vdmUiLAogICAgICAgICAgICAgIGJsb2NrQXV0b1JlbW92ZV90aXRsZTogInJlbW92ZSB0aGUgYmxvY2sgcmVzdWx0cyBhdXRvbWF0aWNhbGx5IiwKICAgICAgICAgICAgICBibG9ja0J0blNob3dfdGV4dDogIkhpZGUgJ0Jsb2NrJyBidXR0b24iLAogICAgICAgICAgICAgIGJsb2NrQnRuU2hvd190aXRsZTogIkhpZGUgJ0Jsb2NrJyBidXR0b24iLAoKICAgICAgICAgICAgICB1c2VyU3R5bGVfdGV4dDogIkFkZDMtQ3VzdG9tU3R5bGUiLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iYWlkdV9sYWJsZTogIkV4cGFuZCBCYWlkdSBTZXR0aW5ncz4+IiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmFpZHVfb3JpZ2luOiAiQmFpZHUtT3JpZ2luIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmFpZHVfaHV5YW46ICJCYWlkdS1FeWVTYXZlIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmFpZHVfYmFpZHVMaXRlOiAiQmFpZHVMaXRlU3R5bGUiLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iYWlkdV8xbGluZTogIlNpbmdsZVJvdyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2JhaWR1XzFsaW5lX2VudGVyOiAiU2luZ2xlQ2VudGVyIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmFpZHVfMmxpbmU6ICJUd28iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iYWlkdV8zbGluZTogIlRocmVlIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmFpZHVfNGxpbmU6ICJGb3VyIiwKCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV9sYWJsZTogIkV4cGFuZCBHb29nbGUgU2V0dGluZ3M+PiIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV9vcmlnaW46ICJHb29nbGUtT3JpZ2luIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZ29vZ2xlX2h1eWFuOiAiR29vZ2xlLUV5ZVNhdmUiLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9nb29nbGVfZ29vZ2xlTGl0ZTogIkZha2UgQmFpZHUiLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9nb29nbGVfMWxpbmU6ICJTaW5nbGVSb3ciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9nb29nbGVfMWxpbmVfZW50ZXI6ICJTaW5nbGVDZW50ZXIiLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9nb29nbGVfMmxpbmU6ICJUd28iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9nb29nbGVfM2xpbmU6ICJUaHJlZSIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2dvb2dsZV80bGluZTogIkZvdXIiLAoKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmluZ19sYWJsZTogIkV4cGFuZCBCaW5nIFNldHRpbmdzPj4iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iaW5nX29yaWdpbjogIkJpbmctT3JpZ2luIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmluZ19odXlhbjogIkJpbmctRXllU2F2ZSIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2JpbmdfMWxpbmU6ICJTaW5nbGVSb3ciLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9iaW5nXzFsaW5lX2VudGVyOiAiU2luZ2xlQ2VudGVyIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfYmluZ18ybGluZTogIlR3byIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2JpbmdfM2xpbmU6ICJUaHJlZSIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2JpbmdfNGxpbmU6ICJGb3VyIiwKCiAgICAgICAgICAgICAgdXNlclN0eWxlX3NvZ291X2xhYmxlOiAiRXhwYW5kIFNvR291IFNldHRpbmdzPj4iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9zb2dvdV9vcmlnaW46ICJTb0dvdS1PcmlnaW4iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9zb2dvdV9odXlhbjogIlNvR291LUV5ZVNhdmUiLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9zb2dvdV8xbGluZTogIlNpbmdsZVJvdyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX3NvZ291XzFsaW5lX2VudGVyOiAiU2luZ2xlQ2VudGVyIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfc29nb3VfMmxpbmU6ICJUd28iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9zb2dvdV8zbGluZTogIlRocmVlIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfc29nb3VfNGxpbmU6ICJGb3VyIiwKCiAgICAgICAgICAgICAgdXNlclN0eWxlX2R1Y2tfbGFibGU6ICJFeHBhbmQgRHVja0R1Y2tHbyBTZXR0aW5ncz4+IiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZHVja19vcmlnaW46ICJEdWNrRHVjay1PcmlnaW4iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kdWNrX2h1eWFuOiAiRHVja0R1Y2stRXllU2F2ZSIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2R1Y2tfbm9ybWFsOiAiRHVja0R1Y2stTm9ybWFsIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZHVja18xbGluZTogIlNpbmdsZVJvdyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2R1Y2tfMWxpbmVfZW50ZXI6ICJTaW5nbGVDZW50ZXIiLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kdWNrXzJsaW5lOiAiVHdvIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZHVja18zbGluZTogIlRocmVlIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZHVja180bGluZTogIkZvdXIiLAoKICAgICAgICAgICAgICB1c2VyU3R5bGVfZG9nZV9sYWJsZTogIkV4cGFuZCBEb2dlRG9nZSBTZXR0aW5ncz4+IiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZG9nZV9vcmlnaW46ICJEb2dlRG9nZS1PcmlnaW4iLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kb2dlX2h1eWFuOiAiRG9nZURvZ2UtRXllU2F2ZSIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2RvZ2Vfbm9ybWFsOiAiRG9nZURvZ2UtTm9ybWFsIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZG9nZV8xbGluZTogIlNpbmdsZVJvdyIsCiAgICAgICAgICAgICAgdXNlclN0eWxlX2RvZ2VfMWxpbmVfZW50ZXI6ICJTaW5nbGVDZW50ZXIiLAogICAgICAgICAgICAgIHVzZXJTdHlsZV9kb2dlXzJsaW5lOiAiVHdvIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZG9nZV8zbGluZTogIlRocmVlIiwKICAgICAgICAgICAgICB1c2VyU3R5bGVfZG9nZV80bGluZTogIkZvdXIiLAoKICAgICAgICAgICAgICBodXlhbk1vZGVfdGV4dDogIkFkZDQtRXllU2F2ZSBDb2xvciBTZXR0aW5nLU5lZWQgb3BlbmVkIGluIEFkZDMiLAogICAgICAgICAgICAgIGh1eWFuTW9kZV90aXRsZTogIu+8gU9wZW4gRXllU2F2ZSBNb2RlIGluIEN1c3RvbVN0eWxlIGlzIE11c3QiLAogICAgICAgICAgICAgIGh1eWFuQ29sb3JfdGV4dDogIkRlZmF1bHQgRXllU2F2ZSBDb2xvcu+8miIsCiAgICAgICAgICAgICAgaHV5YW5Db2xvcl90aXRsZTogIlRoZSBjb2xvciBvZiBFeWVTYXZl77yaIiwKICAgICAgICAgICAgICBodXlhbkNvbG9yTW9yZV90ZXh0OiAiTW9yZSBDb2xvciIsCgogICAgICAgICAgICAgIGZhdmljb25fdGV4dDogIkFkZDUtRmF2aWNvbi5GdW5jIiwKICAgICAgICAgICAgICBmYXZpY29uX3RpdGxlOiAiQUMtQWRkRmF2aWNvbiIsCiAgICAgICAgICAgICAgZmF2aWNvbl9kZWZhdWx0SWNvbl90ZXh0OiAiRmF2aWNvbkZhaWxlZEltZ++8mu+8miIsCgogICAgICAgICAgICAgIHNlYXJjaE9yaWdpbl90ZXh0OiAiQUMtUmVtb3ZlIEJhaWR1IEF1dG9QcmVkaWN0IGluIHRleHQgc2VhcmNoIiwKICAgICAgICAgICAgICBzZWFyY2hPcmlnaW5fdGl0bGU6ICJBZGQ2LVJlbW92ZSBCYWlkdSBBdXRvUHJlZGljdCBpbiB0ZXh0IHNlYXJjaCIsCgogICAgICAgICAgICAgIHNob3dSaWdodF90ZXh0OiAiQWRkNy1SaWdodCBTaWRlIENvbHVtbiIsCiAgICAgICAgICAgICAgc2hvd0NvdW50ZXJfdGV4dDogIkFkZDgtTnVtRnVuYyIsCiAgICAgICAgICAgICAgc2hvd0FMaW5lX3RleHQ6ICJBZGQ5LVRleHRVbmRlckxpbmUiLAogICAgICAgICAgICAgIHNob3dVc2VyU3R5bGVfdGV4dDogIkFkZDEwLVlvdXIgb3duIFN0eWxlIiwKCiAgICAgICAgICAgICAgY29udGFjdE1lX3RleHQ6ICJGb3IgY29udGFjdCB0aGUgd3JpdHRlciwgc3VnZ2VzdHMsIGFzayBmb3IgaGVscCB0aGVuIGNsaWNrIG1lIiwKICAgICAgICAgICAgICBjb250YWN0TWVfdXJsOiAiaHR0cHM6Ly9naXRodWIuY29tL2xhbmdyZW4xMzUzL0dNX3NjcmlwdC8iLAoKICAgICAgICAgICAgICBzZXR0aW5nX3BhbmVsX3NlY29uZDogewogICAgICAgICAgICAgICAgYmFja0J0bl90ZXh0OiAiPC1CYWNrIiwKICAgICAgICAgICAgICAgIGJsb2NrTGFiZWxfdGV4dDogIiZuYnNwO0Jsb2NrIExpc3QmbmJzcDsmbmJzcDtDbGljayBTYXZlIEJ1dHRvbiBpZiB5b3Ugd2FudCB3byBzYXZlIHRoZSBsaXN0IiwKICAgICAgICAgICAgICAgIGJsb2NrRWRpdEJ0bl90ZXh0OiAiRWRpdCBMaXN0IiwKICAgICAgICAgICAgICAgIGJsb2NrRWRpdEJ0bkVuZF90ZXh0OiAiRW5kIEVkaXQiLAogICAgICAgICAgICAgICAgYWRkQmxvY2tMYWJlbF90ZXh0OiAiQWRkIEJsb2NrIGl0ZW3vvJoiLAogICAgICAgICAgICAgICAgYWRkQnRuTGFiZWxfdGV4dDogIkFkZCIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjYW5jZWxCdG5fdGV4dDogIkNhbmNlbCIsCiAgICAgICAgICAgICAgb2tCdG5fdGV4dDogIlNhdmUiLAogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgbGV0IHZ1ZVZNID0gbnVsbDsKICAgIC8qKuWIneWni+WMluaJgOacieeahOiuvue9rioqLwogICAgUHJvbWlzZS5hbGwoW0dNLmdldFZhbHVlKCJDb25maWciKV0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgaWYgKGRhdGFbMF0gIT0gbnVsbCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBBQ0NvbmZpZyA9IEpTT04ucGFyc2UoZGF0YVswXSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgQUNDb25maWcgPSBkYXRhWzBdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBBQ0NvbmZpZyA9IERlZmF1bHRDb25maWc7CiAgICAgIH0KICAgICAgZm9yICh2YXIga2V5IGluIERlZmF1bHRDb25maWcpIHsKICAgICAgICBpZiAodHlwZW9mIChBQ0NvbmZpZ1trZXldKSA9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgQUNDb25maWdba2V5XSA9IERlZmF1bHRDb25maWdba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKEFDQ29uZmlnLmlzVXNlclN0eWxlRW5hYmxlID09PSBmYWxzZSAmJiAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSBBQ0NvbmZpZy5sYXN0U2F2ZVRpbWUgPiAyNTkyMDAwMDAwKSkgeyAvLyDlpKfnuqYzMOWkqeaXtumXtAogICAgICAgIC8vIOWmguaenOeUqOaIt+WPlua2iOS6huiuvue9ru+8jOW5tuS4lOmVv+aXtumXtCgz5aSpKeayoeaciei/m+ihjOi/h+WkhOeQhu+8jOmCo+S5iOebtOaOpeWwhuaVsOaNrue9ruepuiAtPiDnlKjkuo7liLfmlrDmlbDmja4KICAgICAgICBjb25zb2xlLmxvZygiYWMtYmFpZHUgY3NzIHJlc2V0IGZvciB0aW1lIik7CiAgICAgICAgQUNDb25maWcubGFzdFNhdmVUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgQUNDb25maWcuVXNlclN0eWxlVGV4dCA9IERlZmF1bHRDb25maWcuVXNlclN0eWxlVGV4dDsKICAgICAgfQogICAgICBBbGxEYXRhLkFDQ29uZmlnID0gQUNDb25maWc7CiAgICAgIERCQ29uZmlnID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShBQ0NvbmZpZykpOyAvLyDmmoLml7bkvZzkuLrkuIDkuKrljp/lp4vkv53lrZgKICAgICAgQWxsRGF0YS5sYW4udXNlID0gQUNDb25maWcuaXNFbkxhbmcgPyBBbGxEYXRhLmxhbi5lbiA6IEFsbERhdGEubGFuLnpoX2NuOwogICAgICAvLyDliJ3lp4vljJblrozmiJDkuYvlkI7miY3og73osIPnlKjmraPluLjlh73mlbAKICAgICAgY2FsbGJhY2soKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChleGNlcHQpIHsKICAgICAgY29uc29sZS5sb2coZXhjZXB0KTsKICAgIH0pOwoKICAgIGZ1bmN0aW9uIFJlZ19HZXQoSFRNTCwgcmVnKSB7CiAgICAgIGxldCBSZWdFID0gbmV3IFJlZ0V4cChyZWcpOwogICAgICB0cnkgewogICAgICAgIHJldHVybiBSZWdFLmV4ZWMoSFRNTClbMV07CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBnZXRFbGVtZW50QnlYcGF0aChlLCB0LCByKSB7CiAgICAgIHIgPSByIHx8IGRvY3VtZW50LCB0ID0gdCB8fCByOwogICAgICB0cnkgewogICAgICAgIHJldHVybiByLmV2YWx1YXRlKGUsIHQsIG51bGwsIFhQYXRoUmVzdWx0LkZJUlNUX09SREVSRURfTk9ERV9UWVBFLCBudWxsKS5zaW5nbGVOb2RlVmFsdWU7CiAgICAgIH0gY2F0Y2ggKHQpIHsKICAgICAgICByZXR1cm4gdm9pZCBjb25zb2xlLmVycm9yKCLml6DmlYjnmoR4cGF0aCIpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0QWxsRWxlbWVudHMoZSwgdCwgciwgbiwgbykgewogICAgICBsZXQgZ2V0QWxsRWxlbWVudHNCeVhwYXRoID0gZnVuY3Rpb24oZSwgdCwgcikgewogICAgICAgIHJldHVybiByID0gciB8fCBkb2N1bWVudCwgdCA9IHQgfHwgciwgci5ldmFsdWF0ZShlLCB0LCBudWxsLCBYUGF0aFJlc3VsdC5PUkRFUkVEX05PREVfU05BUFNIT1RfVFlQRSwgbnVsbCk7CiAgICAgIH0KCiAgICAgIHZhciBpLCBzID0gW107CiAgICAgIGlmICghZSkgcmV0dXJuIHM7CiAgICAgIGlmIChyID0gciB8fCBkb2N1bWVudCwgbiA9IG4gfHwgd2luZG93LCBvID0gbyB8fCB2b2lkIDAsIHQgPSB0IHx8IHIsICJzdHJpbmciID09IHR5cGVvZiBlKSBpID0gMCA9PT0gZS5zZWFyY2goL15jc3M7L2kpID8gZnVuY3Rpb24gZ2V0QWxsRWxlbWVudHNCeUNTUyhlLCB0KSB7CiAgICAgICAgcmV0dXJuICh0IHx8IGRvY3VtZW50KS5xdWVyeVNlbGVjdG9yQWxsKGUpOwogICAgICB9KGUuc2xpY2UoNCksIHQpIDogZ2V0QWxsRWxlbWVudHNCeVhwYXRoKGUsIHQsIHIpOyBlbHNlIHsKICAgICAgICBpZiAoIShpID0gZShyLCBuLCBvKSkpIHJldHVybiBzOwogICAgICAgIGlmIChpLm5vZGVUeXBlKSByZXR1cm4gc1swXSA9IGksIHM7CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIG1ha2VBcnJheShlKSB7CiAgICAgICAgdmFyIHQsIHIsIG4sIG8gPSBbXTsKICAgICAgICBpZiAoZS5wb3ApIHsKICAgICAgICAgIGZvciAodCA9IDAsIHIgPSBlLmxlbmd0aDsgdCA8IHI7IHQrKykgKG4gPSBlW3RdKSAmJiAobi5ub2RlVHlwZSA/IG8ucHVzaChuKSA6IG8gPSBvLmNvbmNhdChtYWtlQXJyYXkobikpKTsKICAgICAgICAgIHJldHVybiBhKCkobyk7CiAgICAgICAgfQogICAgICAgIGlmIChlLml0ZW0pIHsKICAgICAgICAgIGZvciAodCA9IGUubGVuZ3RoOyB0Oykgb1stLXRdID0gZVt0XTsKICAgICAgICAgIHJldHVybiBvOwogICAgICAgIH0KICAgICAgICBpZiAoZS5pdGVyYXRlTmV4dCkgewogICAgICAgICAgZm9yICh0ID0gZS5zbmFwc2hvdExlbmd0aDsgdDspIG9bLS10XSA9IGUuc25hcHNob3RJdGVtKHQpOwogICAgICAgICAgcmV0dXJuIG87CiAgICAgICAgfQogICAgICB9KGkpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxiYWNrKCkgewogICAgICBpZiAoQUNDb25maWcub2xkVmVyc2lvbiA9PT0gR01faW5mby5zY3JpcHQudmVyc2lvbikgewogICAgICAgIENPTlNULmhhc05ld0Z1bmNOZWVkRGlzcGxheSA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIENPTlNULmhhc05ld0Z1bmNOZWVkRGlzcGxheSA9IG5lZWREaXNwbGF5TmV3RnVuOwogICAgICB9CgogICAgICAhZnVuY3Rpb24gKCkgewogICAgICAgIGxldCBpbnNlcnRMb2NrZWQgPSBmYWxzZTsKICAgICAgICBpZiAodHlwZW9mIEdNX2dldFJlc291cmNlVGV4dCA9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgR00uZ2V0UmVzb3VyY2VUZXh0ID0gR01fZ2V0UmVzb3VyY2VUZXh0ID0gYXN5bmMgZnVuY3Rpb24gKGFSZXNvdXJjZU5hbWUpIHsKICAgICAgICAgICAgbGV0IHJlcyA9IGF3YWl0IChhd2FpdCBmZXRjaChhd2FpdCBHTS5nZXRSZXNvdXJjZVVybChhUmVzb3VyY2VOYW1lKSkpLnRleHQoKTsKICAgICAgICAgICAgbGV0IHNhdmVSZXMgPSBhd2FpdCBHTS5nZXRWYWx1ZShhUmVzb3VyY2VOYW1lKTsKICAgICAgICAgICAgaWYgKHR5cGVvZiAoc2F2ZVJlcykgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgR00uc2V0VmFsdWUoYVJlc291cmNlTmFtZSwgcmVzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gc2F2ZVJlczsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoR01fZ2V0UmVzb3VyY2VUZXh0KSB7CiAgICAgICAgICAvLyDku4XlnKjmlK/mjIFHTV9nZXRSZXNvdXJjZVRleHTnmoTlrrnlmajkuIrov5vooYzliqjmgIHmlbDmja7mm7TmlrAKICAgICAgICAgIC8vIOS4lOiDvemYsuatouiwt+atjOeZvuW6pumhtemdouinhOWImeWkp+WPmOWKqOWPiOmcgOimgeabtOaWsOiEmuacrCAtIOeJueWIq+aYr+a2ieWPiue/u+mhteWPguaVsAogICAgICAgICAgbGV0IGNvbmZpZyA9IEdNX2dldFJlc291cmNlVGV4dCgiU2l0ZUNvbmZpZ1J1bGVzIik7CiAgICAgICAgICBldmFsKGNvbmZpZyk7CiAgICAgICAgICBpZiAodHlwZW9mIChvbmxpbmVEQikgPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigi57q/5LiK5pWw5o2u5Li656m6Iik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBEQlNpdGUgPSBvbmxpbmVEQjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGxvY2F0aW9uLmhvc3QuaW5jbHVkZXMoInh1ZXNodS5iYWlkdS5jb20iKSkgewogICAgICAgICAgY3VyU2l0ZSA9IERCU2l0ZS5iYWlkdV94dWVzaHU7CiAgICAgICAgfSBlbHNlIGlmIChsb2NhdGlvbi5ob3N0LmluY2x1ZGVzKCIuYmFpZHUuY29tIikpIHsKICAgICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnJlcGxhY2UoLyhhbmRyb2lkfG1vYmlsZXxpcGhvbmUpL2lnbSwgIiIpICE9PSBuYXZpZ2F0b3IudXNlckFnZW50KSB7CiAgICAgICAgICAgIGN1clNpdGUgPSBEQlNpdGUubUJhaWR1OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3VyU2l0ZSA9IERCU2l0ZS5iYWlkdTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGxvY2F0aW9uLmhvc3QuaW5jbHVkZXMoInpoaWh1LmNvbSIpKSB7CiAgICAgICAgICBjdXJTaXRlID0gREJTaXRlLnpoaWh1OwogICAgICAgIH0gZWxzZSBpZiAobG9jYXRpb24uaG9zdC5pbmNsdWRlcygic29nb3UiKSkgewogICAgICAgICAgY3VyU2l0ZSA9IERCU2l0ZS5zb2dvdTsKICAgICAgICB9IGVsc2UgaWYgKGxvY2F0aW9uLmhvc3QuaW5jbHVkZXMoInNvLmNvbSIpKSB7CiAgICAgICAgICBjdXJTaXRlID0gREJTaXRlLmhhb3NvdTsKICAgICAgICB9IGVsc2UgaWYgKGxvY2F0aW9uLmhvc3QuaW5jbHVkZXMoImdvb2dsZSIpKSB7CiAgICAgICAgICBjdXJTaXRlID0gREJTaXRlLmdvb2dsZTsKICAgICAgICB9IGVsc2UgaWYgKGxvY2F0aW9uLmhvc3QuaW5jbHVkZXMoImJpbmciKSkgewogICAgICAgICAgY3VyU2l0ZSA9IERCU2l0ZS5iaW5nOwogICAgICAgIH0gZWxzZSBpZiAobG9jYXRpb24uaG9zdC5pbmNsdWRlcygiZHVja2R1Y2tnbyIpKSB7CiAgICAgICAgICBjdXJTaXRlID0gREJTaXRlLmR1Y2s7CiAgICAgICAgfSBlbHNlIGlmIChsb2NhdGlvbi5ob3N0LmluY2x1ZGVzKCJkb2dlZG9nZSIpKSB7CiAgICAgICAgICBjdXJTaXRlID0gREJTaXRlLmRvZ2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1clNpdGUgPSBEQlNpdGUub3RoZXI7CiAgICAgICAgfQogICAgICAgIGN1clNpdGUucGFnZU51bSA9IDE7IC8vIOW9k+WJjemhteaVsAogICAgICAgIGN1clNpdGUucGFnZUxvYWRpbmcgPSBmYWxzZTsKICAgICAgICBjdXJTaXRlLnBhZ2VVcmwgPSAiIjsKICAgICAgICBpZiAoCiAgICAgICAgICAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5HT09HTEUgJiYgbG9jYXRpb24uaHJlZi5yZXBsYWNlKC90Ym09KGlzY2h8bGNsfHNob3B8ZmxtKS8sICIiKSAhPT0gbG9jYXRpb24uaHJlZiApIHx8CiAgICAgICAgICAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5CSU5HICYmIGxvY2F0aW9uLmhyZWYucmVwbGFjZSgvaW1hZ2VzXC9zZWFyY2gvLCAiIikgIT09IGxvY2F0aW9uLmhyZWYgKQogICAgICAgICkgewogICAgICAgICAgLy8g5Zu+54mH56uZIOOAgeWcsOWbvuermeOAgei0reeJqeermQogICAgICAgICAgY29uc29sZS5sb2coIueJueauiuermSzkuI3liqDovb3moLflvI/vvIzkuI3mt7vliqBtZW51Iik7CiAgICAgICAgICBDT05TVC5pc0dvb2dsZUltYWdlVXJsID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkJBSURVKSB7CiAgICAgICAgICBDT05TVC51c2VJdGVtID0gQUNDb25maWcuYmFpZHU7CiAgICAgICAgfSBlbHNlIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkdPT0dMRSkgewogICAgICAgICAgQ09OU1QudXNlSXRlbSA9IEFDQ29uZmlnLmdvb2dsZTsKICAgICAgICB9IGVsc2UgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuQklORykgewogICAgICAgICAgQ09OU1QudXNlSXRlbSA9IEFDQ29uZmlnLmJpbmc7CiAgICAgICAgfSBlbHNlIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkRVQ0spIHsKICAgICAgICAgIENPTlNULnVzZUl0ZW0gPSBBQ0NvbmZpZy5kdWNrOwogICAgICAgIH0gZWxzZSBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5ET0dFKSB7CiAgICAgICAgICBDT05TVC51c2VJdGVtID0gQUNDb25maWcuZG9nZTsKICAgICAgICB9IGVsc2UgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuU09HT1UpIHsKICAgICAgICAgIENPTlNULnVzZUl0ZW0gPSBBQ0NvbmZpZy5zb2dvdTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgQ09OU1QudXNlSXRlbSA9IEFDQ29uZmlnLmJhaWR1OwogICAgICAgIH0KCiAgICAgICAgaWYoY3VyU2l0ZS5TaXRlVHlwZUlEID09IFNpdGVUeXBlLkJBSURVX1hVRVNIVSl7CiAgICAgICAgICBDT05TVC51c2VJdGVtLkFkc1N0eWxlTW9kZSA9IDI7IC8vIOWNleWIl+WxheS4reWNs+WPrwogICAgICAgIH0KCiAgICAgICAgaWYgKEFDQ29uZmlnLkFkc1N0eWxlRW5hYmxlKSB7CiAgICAgICAgICBDT05TVC5TdHlsZU1hbmdlciA9IEZTQmFpZHUoKTsgLy8g5re75Yqg6K6+572u6aG5LeWNleWPjOWIl+aYvuekugogICAgICAgIH0KCiAgICAgICAgY29uc29sZS5sb2coIiVjW0FDLVJlZGlyZWN0XSAlY0xldCBNZSBJbnRyb2R1Y2UgeW91IGEgVmVyeSBHb29kIFNlYXJjaCBFbmdpbmXvvJolYyAlcyAlY1NlYXJjaCBFbmdpbmUuIiwgImZvbnQtd2VpZ2h0OmJvbGQ7Y29sb3I6Y29ybmZsb3dlcmJsdWUiLCAiY29sb3I6MCIsICJmb250LXdlaWdodDpib2xkO2NvbG9yOmRhcmtvcmFuZ2UiLCBDT05TVC51c2VJdGVtLm5hbWUucmVwbGFjZShDT05TVC51c2VJdGVtLm5hbWVbMF0sIENPTlNULnVzZUl0ZW0ubmFtZVswXS50b1VwcGVyQ2FzZSgpKSwgImZvbnQtd2VpZ2h0Om5vcm1hbDtjb2xvcjowIik7CgogICAgICAgIGxldCBTaXRlQmxvY2sgPSB7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIOWIneWni+WMlkJsb2Nr5qC35byPCiAgICAgICAgICAgKi8KICAgICAgICAgIGluaXRTdHlsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBBQ19hZGRTdHlsZSgiYnV0dG9uLmdoaGlkZXIuZ2hoYlthYy11c2VyLWFsdGVyPScxJ106OmJlZm9yZXtjb250ZW50Oiflj5bmtoggLSAnO30jc3AtYWMtY29udGFpbmVyIC5hYy1ibG9jay1pdGVte2NvbG9yOiNBQUE7bWFyZ2luLWxlZnQ6NDhweDt9I3NwLWFjLWNvbnRhaW5lciAuYWMtYmxvY2staXRlbWRlbHtmbG9hdDpyaWdodDttYXJnaW4tbGVmdDowO3BhZGRpbmc6MCAyMHB4O2N1cnNvcjpwb2ludGVyO30jc3AtYWMtY29udGFpbmVyIC5hYy1ibG9jay1pdGVtZGVsOmhvdmVye2NvbG9yOnJlZDt9I3NwLWFjLWNvbnRhaW5lciAuYWMtYmxvY2staGlnaHtjb2xvcjojMDAwO30uYWMtYmxvY2tMaXN0IGxpOmhvdmVye2JhY2tncm91bmQtY29sb3I6I2EzY2FmZjtjb2xvcjp3aGl0ZSAhaW1wb3J0YW50O2N1cnNvcjpwb2ludGVyO30gKlthYy1uZWVkaGlkZV0gKntkaXNwbGF5Om5vbmV9ICpbYWMtbmVlZGhpZGVdIC5ibG9ja1Nob3d7ZGlzcGxheTp1bnNldDtjdXJzb3I6cG9pbnRlcjt9ICpbYWMtbmVlZGhpZGVdIC5ibG9ja1Nob3c6aG92ZXJ7Ym9yZGVyOjFweCBzb2xpZCAjREREfWJ1dHRvbi5naGhpZGVye2NvbG9yOiM1NTU7YmFja2dyb3VuZC1jb2xvcjojZmNmY2ZjO2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7bWFyZ2luOmF1dG8gMnB4O2JvcmRlcjoxcHggc29saWQgI2NjYztib3JkZXItcmFkaXVzOjRweDtwYWRkaW5nOjJweCAzcHh9YnV0dG9uLmdoaGlkZXJ7Zm9udC1zaXplOjEycHh9YnV0dG9uLmdoaGlkZXI6aG92ZXJ7Y29sb3I6IzAwNmFmZjtiYWNrZ3JvdW5kOiNmZmZ9IiwKICAgICAgICAgICAgICAiQUMtQmxvY2tTdHlsZSIpOwogICAgICAgICAgfSwKICAgICAgICAgIC8qKgogICAgICAgICAgICog5Yid5aeL5YyW5bGP6JS95oyJ6ZKu5Yqg6L29CiAgICAgICAgICAgKi8KICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbGV0IGNoZWNrTm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGN1clNpdGUuTWFpblR5cGUgKyAiOm5vdChbYWNibG9ja10pIik7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hlY2tOb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgY3VyTm9kZSA9IGNoZWNrTm9kZXNbaV07CiAgICAgICAgICAgICAgICBsZXQgZmF2aWNvbk5vZGUgPSBjdXJOb2RlLnF1ZXJ5U2VsZWN0b3IoY3VyU2l0ZS5GYXZpY29uVHlwZSk7CiAgICAgICAgICAgICAgICAvLyBpZihjdXJOb2RlLmhhc0F0dHJpYnV0ZSgiYWNibG9jayIpKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGxldCBob3N0ID0gZ2V0Tm9kZUhvc3QoZmF2aWNvbk5vZGUpLmN1ckhvc3Q7CiAgICAgICAgICAgICAgICAvLyBpZihob3N0ID09IG51bGwpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgbGV0IGZhTm9kZSA9IGN1ck5vZGUucXVlcnlTZWxlY3RvcihjdXJTaXRlLkJsb2NrVHlwZSk7CiAgICAgICAgICAgICAgICBsZXQgbm9kZVN0eWxlID0gImRpc3BsYXk6dW5zZXQ7IjsKICAgICAgICAgICAgICAgIGlmIChBQ0NvbmZpZy5pc0Jsb2NrQnRuTm90RGlzcGxheSkgewogICAgICAgICAgICAgICAgICBub2RlU3R5bGUgPSAiZGlzcGxheTpub25lOyI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmYU5vZGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCJhZnRlcmVuZCIsIGA8YnV0dG9uIHN0eWxlPScke25vZGVTdHlsZX0nIGNsYXNzPSdnaGhpZGVyIGdoaGInIGhyZWY9IiR7ZmF2aWNvbk5vZGUuaHJlZiB8fCBmYXZpY29uTm9kZS5pbm5lclRleHR9IiBtZXRhPSIke2hvc3R9IiBkYXRhLWhvc3Q9IiR7aG9zdH0iIHRpdGxlPScke3RoaXMuZ2V0QmxvY2tCdG5UaXRsZShob3N0KX0nPmJsb2NrPC9idXR0b24+YCk7CgogICAgICAgICAgICAgICAgY3VyTm9kZS5zZXRBdHRyaWJ1dGUoImFjYmxvY2siLCAiMCIpOwogICAgICAgICAgICAgICAgY3VyTm9kZS5zZXRBdHRyaWJ1dGUoImFjYmxvY2siLCAiMCIpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pbml0TGlzdGVuZXIoKTsKICAgICAgICAgICAgdGhpcy5yZW5kZXJEaXNwbGF5KCk7CiAgICAgICAgICB9LAogICAgICAgICAgZ2V0QmxvY2tCdG5UaXRsZShob3N0KXsKICAgICAgICAgICAgcmV0dXJuIGDngrnlh7vljbPlj6/lsY/olL0gJHtob3N0fSDmlL7lvIDvvIzpnIDopoHlnKjoh6rlrprkuYnkuK3miYvliqjphY3nva7mlL7lvIBgOwogICAgICAgICAgfSwKICAgICAgICAgIGluaXRMaXN0ZW5lcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBsZXQgY2hlY2tOb2RlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImJ1dHRvbi5naGhpZGVyOm5vdChbYWNFbnZdKSIpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNoZWNrTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBjaGVja05vZGVzW2ldLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgdGhpcy5kb0hpZGVFbnYpOwogICAgICAgICAgICAgIGNoZWNrTm9kZXNbaV0uc2V0QXR0cmlidXRlKCJhY0VudiIsICIwIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICBkb0hpZGVFbnY6IGZ1bmN0aW9uIChlbnYpIHsKICAgICAgICAgICAgLy8g5YWI5o+S5YWl5pWw5o2uLS0t6K6w5b6X6L+Y6KaB5YaZ5YWl5a2Y5YKoCiAgICAgICAgICAgIGxldCBub2RlID0gZW52LnNvdXJjZVRhcmdldCB8fCBlbnYudGFyZ2V0OwogICAgICAgICAgICBsZXQgaG9zdCA9IG5vZGUuZGF0YXNldC5ob3N0OwogICAgICAgICAgICBpZiAobm9kZS5nZXRBdHRyaWJ1dGUoImFjLXVzZXItYWx0ZXIiKSA9PSAxKSB7CiAgICAgICAgICAgICAgLy8g5bey57uP5bGP6JS95LmL5ZCO77yM5YaN5qyh54K55Ye7YmxvY2vlupTor6XmmK/lj5bmtojnirbmgIEKICAgICAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZSgiYWMtdXNlci1hbHRlciIpOwogICAgICAgICAgICAgIEFDQ29uZmlnLlVzZXJCbG9ja0xpc3QuYWNyZW1vdmUoaG9zdCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8g5q2j5bi45bGP6JS95pON5L2cCiAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoImFjLXVzZXItYWx0ZXIiKTsKICAgICAgICAgICAgICBBQ0NvbmZpZy5Vc2VyQmxvY2tMaXN0LmFjcHVzaChob3N0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBEQkNvbmZpZy5Vc2VyQmxvY2tMaXN0ID0gQUNDb25maWcuVXNlckJsb2NrTGlzdDsKICAgICAgICAgICAgR01fc2V0VmFsdWUoIkNvbmZpZyIsIEpTT04uc3RyaW5naWZ5KERCQ29uZmlnKSk7IC8vIOeCueWHu+S4gOasoe+8jOS/neWtmOS4gOasoQogICAgICAgICAgICBTaXRlQmxvY2sucmVuZGVyRGlzcGxheSgpOwogICAgICAgICAgICBlbnYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICB9LAogICAgICAgICAgLy8g5Yi35paw5pi+56S65pWI5p6cLS3ogJfml7bmk43kvZwKICAgICAgICAgIHJlbmRlckRpc3BsYXk6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbGV0IGNoZWNrTm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGN1clNpdGUuTWFpblR5cGUpOwogICAgICAgICAgICBsZXQgZmxhZyA9ICJhYy1uZWVkaGlkZSI7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hlY2tOb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsZXQgY3VyTm9kZSA9IGNoZWNrTm9kZXNbaV07CiAgICAgICAgICAgICAgICBsZXQge2N1ckhvc3QsIGN1clVybH0gPSBnZXROb2RlSG9zdChjdXJOb2RlLnF1ZXJ5U2VsZWN0b3IoY3VyU2l0ZS5GYXZpY29uVHlwZSkpOwogICAgICAgICAgICAgICAgY3VyVXJsID0gY3VyVXJsIHx8ICIiOwogICAgICAgICAgICAgICAgaWYgKGN1ckhvc3QgPT0gbnVsbCkgY29udGludWU7CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGxldCBCbG9ja0J0biA9IGN1ck5vZGUucXVlcnlTZWxlY3RvcigiLmdoaGlkZXIuZ2hoYiIpOwogICAgICAgICAgICAgICAgICBCbG9ja0J0bi5kYXRhc2V0Lmhvc3QgPSBCbG9ja0J0bi5kYXRhc2V0Lm1ldGEgPSBjdXJIb3N0OwogICAgICAgICAgICAgICAgICBCbG9ja0J0bi50aXRsZSA9IHRoaXMuZ2V0QmxvY2tCdG5UaXRsZShjdXJIb3N0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjdXJOb2RlLnF1ZXJ5U2VsZWN0b3IoImJ1dHRvblthYy11c2VyLWFsdGVyXSIpICE9IG51bGwpIGNvbnRpbnVlOyAvLyDnlKjmiLfmiYvliqjngrnov4fmmL7npLrnmoTvvIzpgqPkuYjot7Pov4djaGVjawogICAgICAgICAgICAgICAgbGV0IHJlZ0xpc3QgPSB2dWVWTS5jYWxfVXNlckJsb2NrTGlzdFJlZ2V4OyAvLyDkvb/nlKhWdWXnmoRjb21wdXRlZOWxnuaAp+iuoeeul+eahOaVsOaNruWAvO+8jOS4gOiIrOagueacrOS4jeabtOaWsAogICAgICAgICAgICAgICAgaWYgKCFjdXJVcmwuaW5jbHVkZXMoInd3dy5iYWlkdS5jb20vbGluayIpICYmIHJlZ0xpc3QuZmluZEluZGV4KG9uZSA9PiB7CiAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9uZS50ZXN0KGN1ckhvc3QpIHx8IG9uZS50ZXN0KGN1clVybCk7IC8vIOiAl+aXtuaTjeS9nAogICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0gPT09IGN1ckhvc3Q7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pID49IDApIHsKICAgICAgICAgICAgICAgICAgLy8g5Y+q5qOA5p+l5Zyo5bGP6JS96KGo5Lit55qE5pWw5o2uCiAgICAgICAgICAgICAgICAgIGlmICghY3VyTm9kZS5oYXNBdHRyaWJ1dGUoZmxhZykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoQUNDb25maWcuaXNCbG9ja0Rpc3BsYXkpIHsgLy8g5a+55LqO5LiN5pi+56S655qE5pWw5o2u5Y+v5Lul6L+b6KGM56e76Zmk5pON5L2cCiAgICAgICAgICAgICAgICAgICAgICBjdXJOb2RlLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxldCBjdXJUaXRsZSA9IGN1ck5vZGUucXVlcnlTZWxlY3RvcihjdXJTaXRlLkJsb2NrVHlwZSk7CiAgICAgICAgICAgICAgICAgICAgY3VyVGl0bGUgPSBjdXJUaXRsZS5pbm5lclRleHQgfHwgY3VyVGl0bGUudGV4dENvbnRlbnQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChjdXJOb2RlLmhhc0F0dHJpYnV0ZShmbGFnKSkgewogICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIuWGsueqgeS6hu+8ge+8ge+8gSIpOwogICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjdXJOb2RlLnNldEF0dHJpYnV0ZShmbGFnLCAiMSIpOwogICAgICAgICAgICAgICAgICAgIGN1ck5vZGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCJhZnRlckJlZ2luIiwgYDxzcGFuIGNsYXNzPSJibG9ja1Nob3ciIHRpdGxlPSLlpoLmnpzpnIDopoHkuIDnm7TmmL7npLrvvIzor7flnKjoh6rlrprkuYnkuK1ESVnnm67lvZXnp7vpmaTmnKzlnLDlnYAiPiR7Y3VyVGl0bGV9Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7IC1ibG9jayBieSAke2N1ckhvc3R9PC9zcGFuPmApOwoKICAgICAgICAgICAgICAgICAgICAoZnVuY3Rpb24gKHhjdXIpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIOW3sue7j+Wxj+iUveS5i+WQjueahOWGheWuue+8jOeCueWHu+S4gOS4i+aYvuekuuWOn+Wni+WGheWuuQogICAgICAgICAgICAgICAgICAgICAgeGN1ci5xdWVyeVNlbGVjdG9yKCIuYmxvY2tTaG93IikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoZW52KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCJidXR0b24uZ2hoaWRlciIpLnNldEF0dHJpYnV0ZSgiYWMtdXNlci1hbHRlciIsICIxIik7IC8vIOi/meS4quWxnuaAp+eUqOS6juS/neaMgeWcqERPTeabtOaWsOaXtu+8jOaMiemSruS4jeWPmAogICAgICAgICAgICAgICAgICAgICAgICB4Y3VyLnJlbW92ZUF0dHJpYnV0ZShmbGFnKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2FmZUZ1bmN0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB4Y3VyLnF1ZXJ5U2VsZWN0b3IoIi5ibG9ja1Nob3ciKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pKGN1ck5vZGUpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBjdXJOb2RlLnJlbW92ZUF0dHJpYnV0ZShmbGFnKTsKICAgICAgICAgICAgICAgICAgc2FmZUZ1bmN0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjdXJOb2RlLnF1ZXJ5U2VsZWN0b3IoIi5ibG9ja1Nob3ciKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGFkZFN0eWxlKGNzcykgeyAvL+a3u+WKoENTU+eahOS7o+eggS0tY29weeeahAogICAgICAgICAgbGV0IHBpID0gZG9jdW1lbnQuY3JlYXRlUHJvY2Vzc2luZ0luc3RydWN0aW9uKAogICAgICAgICAgICAneG1sLXN0eWxlc2hlZXQnLAogICAgICAgICAgICAndHlwZT0idGV4dC9jc3MiIG11c3Q9ImZhbHNlIiBocmVmPSJkYXRhOnRleHQvY3NzO3V0Zi04LCcgKyBlbmNvZGVVUklDb21wb25lbnQoY3NzKSArICciJwogICAgICAgICAgKTsKICAgICAgICAgIHJldHVybiBkb2N1bWVudC5pbnNlcnRCZWZvcmUocGksIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoQUNDb25maWcuaXNBZHNFbmFibGUpIHsKICAgICAgICAgIC8vIGRpc3BsYXnlt7Lnu4/ml6Dms5XpmpDol4/ku5bku6zkuobvvIzpnIDopoHnlKjnu53lr7nnmoTpmpDol48KICAgICAgICAgIGFkZFN0eWxlKCIjYm90dG9tYWRze2Rpc3BsYXk6bm9uZTt9ICNjb250ZW50X2xlZnQ+ZGl2Om5vdChbaWRdKT5kaXZbY21hdGNoaWRdLCAjY29udGVudF9sZWZ0PmRpdltpZCo9JzMwMCddOm5vdChbY2xhc3MqPSdyZXN1bHQnXSksI2NvbnRlbnRfcmlnaHQgdGQ+ZGl2Om5vdChbaWRdKSwjY29udGVudF9yaWdodD5icntwb3NpdGlvbjphYnNvbHV0ZTt0b3A6LTY2NjZweDt9Iik7CiAgICAgICAgfQogICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkdPT0dMRSAmJiBBQ0NvbmZpZy5pc0dvb2xlSW5CYWlkdU1vZGVFbmFibGUpIHsKICAgICAgICAgIHNhZmVXYWl0RnVuYygiI2xvZ28gaW1nLCAjbG9nb2NvbnQgaW1nIiwgZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgICAgbGV0IGZhTm9kZSA9IG5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgICBmYU5vZGUuY2xhc3NMaXN0LmFkZCgiYmFpZHUiKTsKICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoInNyYyIpOwogICAgICAgICAgICBub2RlLnNyYyA9ICJodHRwczovL3BpYy5ybWIuYmRzdGF0aWMuY29tL2M4NjI1NWU4MDI4Njk2MTM5ZDNlM2U0YmI0NGMwNDdiLnBuZyI7CiAgICAgICAgICAgIG5vZGUud2lkdGggPSAiMTI1IjsKICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoImhlaWdodCIpOwogICAgICAgICAgfSk7CiAgICAgICAgICBzYWZlV2FpdEZ1bmMoIiNtYWluIC5sb2dvIGltZ1thbHQ9J0dvb2dsZSddIiwgZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoInNyY3NldCIpOwogICAgICAgICAgICBub2RlLnNyYyA9ICJodHRwczovL3d3dy5iYWlkdS5jb20vaW1nL2JkX2xvZ28xLnBuZz93aGVyZT1zdXBlciI7CiAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJoZWlnaHQiLCAiNTkiKTsKICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgICBzYWZlV2FpdEZ1bmMoImZvcm1bcm9sZT0nc2VhcmNoJ10gLmxvZ28gaW1nIiwgZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoInNyY3NldCIpOwogICAgICAgICAgICBub2RlLnNyYyA9ICJodHRwczovL3d3dy5iYWlkdS5jb20vaW1nL2JkX2xvZ28xLnBuZz93aGVyZT1zdXBlciI7CiAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJoZWlnaHQiLCAiNTkiKTsKICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGRvY3VtZW50LnRpdGxlLnJlcGxhY2UoL15Hb29nbGUvLCAi55m+5bqm5LiA5LiL77yM5L2g5bCx55+l6YGTIikKICAgICAgICAgIC5yZXBsYWNlKC8gLSBHb29nbGUg5pCc57SiLywgIl/nmb7luqbmkJzntKIiKQogICAgICAgICAgLnJlcGxhY2UoLyAtIEdvb2dsZSBTZWFyY2gvLCAiX+eZvuW6puaQnOe0oiIpOwogICAgICAgICAgc2FmZVdhaXRGdW5jKCJoZWFkIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBsZXQgbGlua1RhcmdldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImxpbmtbdHlwZT0naW1hZ2UveC1pY29uJ10iKSB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7CiAgICAgICAgICAgIGxpbmtUYXJnZXQudHlwZSA9ICdpbWFnZS94LWljb24nOwogICAgICAgICAgICBsaW5rVGFyZ2V0LnJlbCA9ICdzaG9ydGN1dCBpY29uJzsKICAgICAgICAgICAgbGlua1RhcmdldC5ocmVmID0gJ2h0dHBzOi8vd3d3LmJhaWR1LmNvbS9mYXZpY29uLmljbyc7CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQobGlua1RhcmdldCk7CiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICBpZiAoQUNDb25maWcubm9ybWFsaXplRHVjayAmJiBjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkRVQ0spIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIERERy5zZXR0aW5ncy5zZXQoImtuIiwgMSwgeyAgLy8g5paw56qX5Y+j5omT5byA6aG16Z2iCiAgICAgICAgICAgICAgICBzYXZlVG9DbG91ZDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZvcmNlVGhlbWU6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBEREcuc2V0dGluZ3Muc2V0KCJrYXYiLCAxLCB7IC8vIOi/nue7reaYvuekuuaQnOe0oue7k+aenAogICAgICAgICAgICAgICAgc2F2ZVRvQ2xvdWQ6IHRydWUsCiAgICAgICAgICAgICAgICBmb3JjZVRoZW1lOiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgNTAwMCk7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEICE9PSBTaXRlVHlwZS5PVEhFUlMpIHsKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgTWFpbkNhbGxiYWNrLCBmYWxzZSk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgTWFpbkNhbGxiYWNrLCBmYWxzZSk7CiAgICAgICAgICAgIFJBRkludGVydmFsKGZ1bmN0aW9uICgpewogICAgICAgICAgICAgIGlmIChkb2N1bWVudC5ib2R5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICFkb2N1bWVudC5ib2R5Lmhhc0F0dHJpYnV0ZShDT05TVC51c2VJdGVtLm5hbWUpICYmIGRvY3VtZW50LmJvZHkuc2V0QXR0cmlidXRlKENPTlNULnVzZUl0ZW0ubmFtZSwgIjEiKTsKICAgICAgICAgICAgICAgICFkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucyhDT05TVC51c2VJdGVtLm5hbWUpICYmIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChDT05TVC51c2VJdGVtLm5hbWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoQUNDb25maWcuQWRzU3R5bGVFbmFibGUpIHsgLy8g5Y2V54us5LiN6ZyA6KaB5a6a5pe25ZmoLemgu+e5geinpuWPkS3ovb3lhaVjc3MKICAgICAgICAgICAgICAgIEZTQmFpZHUoKTsKICAgICAgICAgICAgICAgIEFkZEN1c3RvbVN0eWxlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAyMzApOwogICAgICAgICAgICBSQUZJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmFwaWREZWFsKCk7IC8vIOWumuacn+iwg+eUqO+8jOmBv+WFjeacieaXtuWAmURPTeaPkuWFpeayoeacieaJp+ihjOWvvOiHtOeahOmXrumimAogICAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkJBSURVICYmIGxvY2F0aW9uLmhyZWYuaW5jbHVkZXMoInRuPW5ld3MiKSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zZXRBdHRyaWJ1dGUoIm5ld3MiLCAiMSIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUF0dHJpYnV0ZSgibmV3cyIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgODAwKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICB9CiAgICAgICAgc2FmZVdhaXRGdW5jKCIjc3AtYWMtY29udGVudCIsIGZ1bmN0aW9uIChjaGVja05vZGUpIHsKICAgICAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgICAgICBlbDogY2hlY2tOb2RlLAogICAgICAgICAgICBkYXRhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIEFsbERhdGE7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1ldGhvZHM6IHsKICAgICAgICAgICAgICBsYWJlbFNob3dIaWRlRW52KGUpIHsKICAgICAgICAgICAgICAgIGxldCBjdXIgPSBlLnNyY0VsZW1lbnQgfHwgZS50YXJnZXQ7CiAgICAgICAgICAgICAgICBsZXQgY2xhc3NOYW1lID0gY3VyLnBhcmVudE5vZGUuY2xhc3NOYW1lLnJlcGxhY2UoImNvbnRhaW5lci1sYWJlbCAiLCAiIik7CiAgICAgICAgICAgICAgICBBQ19hZGRTdHlsZSgiLlhYPmxhYmVsLC5YWD5icntkaXNwbGF5OnVuc2V0ICFpbXBvcnRhbnQ7fS5YWD4ubGFiZWxfaGlkZXtkaXNwbGF5Om5vbmUgIWltcG9ydGFudDt9Ii5yZXBsYWNlKC9YWC9nbSwgY2xhc3NOYW1lKSwKICAgICAgICAgICAgICAgICAgIkFDLVNob3dIaWRlSXRlbS0iICsgY2xhc3NOYW1lLCAiYm9keSIpOwogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHN5bmNUb0Jsb2NrTGlzdChlbnYpIHsKICAgICAgICAgICAgICAgIHRoaXMuQUNDb25maWcuVXNlckJsb2NrTGlzdCA9IGVudi50YXJnZXQudmFsdWUuc3BsaXQoIlxuIikuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gJycpOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcmVtb3ZlQUJsb2NrTGlzdEl0ZW0oZSkgewogICAgICAgICAgICAgICAgLy8g54K55Ye756e76Zmk5p+Q5LiqaG9zdOaVsOaNruaXtgogICAgICAgICAgICAgICAgbGV0IHRhcmdldCA9IGUuc3JjRWxlbWVudCB8fCBlLnRhcmdldDsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAibGFiZWwiKSB7CiAgICAgICAgICAgICAgICAgIGxldCBob3N0ID0gdGFyZ2V0LmRhdGFzZXQuaG9zdDsKICAgICAgICAgICAgICAgICAgQUNDb25maWcuVXNlckJsb2NrTGlzdC5hY3JlbW92ZShob3N0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNrQWRkUnVsZSgpIHsKICAgICAgICAgICAgICAgIC8vIOaJi+WKqOWinuWKoOenu+mZpOinhOWImQogICAgICAgICAgICAgICAgQUNDb25maWcuVXNlckJsb2NrTGlzdC5hY3B1c2godGhpcy5vdGhlci5hZGRCbG9ja0l0ZW0pOwogICAgICAgICAgICAgICAgdGhpcy5vdGhlci5hZGRCbG9ja0l0ZW0gPSAiIjsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGxvYWRDdXN0b21TdHlsZSgpIHsKICAgICAgICAgICAgICAgIEFDX2FkZFN0eWxlKEFDQ29uZmlnLlVzZXJTdHlsZVRleHQsICJBQy11c2VyU3R5bGUiLCAiaGVhZCIsIHRydWUpOyAvLyDnlKjmiLfoh6rlrprkuYnnmoTmoLflvI/ooagKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNhdmVDb25maWcoKSB7CiAgICAgICAgICAgICAgICB0aGlzLkFDQ29uZmlnLmxhc3RTYXZlVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgR01fc2V0VmFsdWUoIkNvbmZpZyIsIEpTT04uc3RyaW5naWZ5KHRoaXMuQUNDb25maWcpKTsKICAgICAgICAgICAgICAgIGlmKCF0aGlzLkFDQ29uZmlnLmRvRGlzYWJsZVN1Zyl7CiAgICAgICAgICAgICAgICAgIGFjU2V0Q29va2llKCJPUklHSU4iLCAxLCAid3d3LmJhaWR1LmNvbSIsIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gODY0MDAwMDApOwogICAgICAgICAgICAgICAgICBhY1NldENvb2tpZSgiSVNTVyIsIDEsIG51bGwsIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gODY0MDAwMDApOwogICAgICAgICAgICAgICAgICBhY1NldENvb2tpZSgiSVNTVyIsIDEsICJ3d3cuYmFpZHUuY29tIiwgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSA4NjQwMDAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgfSwgMjAwKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHVzZVRoaXNIdXlhbkNvbG9yKGVudikgewogICAgICAgICAgICAgICAgdGhpcy5BQ0NvbmZpZy5kZWZhdWx0SHVZYW5Db2xvciA9IGVudi50YXJnZXQudmFsdWUgfHwgZW52LnRhcmdldC5kYXRhc2V0LnZhbHVlOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5BQ0NvbmZpZy5kZWZhdWx0SHVZYW5Db2xvcik7CiAgICAgICAgICAgICAgICBDT05TVC5TdHlsZU1hbmdlci5sb2FkSHVZYW5TdHlsZSh0aGlzLkFDQ29uZmlnLmRlZmF1bHRIdVlhbkNvbG9yKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGdldFVzZXJCbG9ja0xpc3RSZWdleCgpIHsKICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gW107CiAgICAgICAgICAgICAgICB0aGlzLkFDQ29uZmlnLlVzZXJCbG9ja0xpc3QuZm9yRWFjaChvbmUgPT4gewogICAgICAgICAgICAgICAgICBvbmUgIT09IG51bGwgJiYgbGlzdC5wdXNoKG5ldyBSZWdFeHAob25lLnJlcGxhY2UoIioiLCAiLioiKSkpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKHRoaXMub3RoZXIuYWRkQmxvY2tJdGVtKSAhPT0gInVuZGVmaW5lZCIgJiYgdGhpcy5vdGhlci5hZGRCbG9ja0l0ZW0gIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChuZXcgUmVnRXhwKHRoaXMub3RoZXIuYWRkQmxvY2tJdGVtLnJlcGxhY2UoIioiLCAiLioiKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGxpc3Q7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjb21wdXRlZDogewogICAgICAgICAgICAgIGdldEJsb2NrTGlzdCgpIHsgLy8g5Lya6Ieq5Yqo55qEcmVuZGVy5YiwaHRtbOS4iuWOu++8jOS4jeeUqOaJi+WKqOWOu+a4suafk+S4gOmBjQogICAgICAgICAgICAgICAgbGV0IGluc0hUTUwgPSAiIjsKICAgICAgICAgICAgICAgIGxldCBVc2VyQmxvY2tSZWdMaXN0ID0gdGhpcy5jYWxfVXNlckJsb2NrTGlzdFJlZ2V4OwogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLkFDQ29uZmlnLlVzZXJCbG9ja0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgbGV0IGluc0NsYXNzID0gdGhpcy5vdGhlci5jdXJIb3N0cy5maW5kSW5kZXgobSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgIGxldCBbY3VySG9zdCwgY3VyVXJsXSA9IG0uc3BsaXQoIiMjIyIpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFVzZXJCbG9ja1JlZ0xpc3RbaV0udGVzdChjdXJIb3N0KSB8fCBVc2VyQmxvY2tSZWdMaXN0W2ldLnRlc3QoY3VyVXJsKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbSA9PT0gQUNDb25maWcuVXNlckJsb2NrTGlzdFtpXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pID49IDAgPyAiIGFjLWJsb2NrLWhpZ2giIDogIiI7IC8vIOWmguaenOW9k+WJjemhtemdouWtmOWcqO+8jOWImemrmOS6rgogICAgICAgICAgICAgICAgICBpbnNIVE1MICs9IGA8bGk+PGxhYmVsIGNsYXNzPSJhYy1ibG9jay1pdGVtJHtpbnNDbGFzc30iIGRhdGEtaG9zdD0iJHt0aGlzLkFDQ29uZmlnLlVzZXJCbG9ja0xpc3RbaV19Ij4ke3RoaXMuQUNDb25maWcuVXNlckJsb2NrTGlzdFtpXX08L2xhYmVsPjxsYWJlbCBjbGFzcz0iYWMtYmxvY2staXRlbSBhYy1ibG9jay1pdGVtZGVsIiBkYXRhLWhvc3Q9IiR7dGhpcy5BQ0NvbmZpZy5Vc2VyQmxvY2tMaXN0W2ldfSI+eDwvbGFiZWw+PC9saT5cbmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gaW5zSFRNTDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNhbF9kaXlCbG9ja0xpc3RCdG4oKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5vdGhlci5zaG93QmxvY2tMaXN0QXJlYSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuc2V0dGluZ19wYW5lbF9zZWNvbmQuYmxvY2tFZGl0QnRuRW5kX3RleHQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuc2V0dGluZ19wYW5lbF9zZWNvbmQuYmxvY2tFZGl0QnRuX3RleHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjYWxfVXNlckJsb2NrTGlzdFJlZ2V4KCkgewogICAgICAgICAgICAgICAgdmFyIGxpc3QgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuQUNDb25maWcuVXNlckJsb2NrTGlzdC5mb3JFYWNoKG9uZSA9PiB7CiAgICAgICAgICAgICAgICAgIG9uZSAhPT0gbnVsbCAmJiBsaXN0LnB1c2gobmV3IFJlZ0V4cChvbmUucmVwbGFjZSgiKiIsICIuKiIpKSk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAodGhpcy5vdGhlci5hZGRCbG9ja0l0ZW0pICE9PSAidW5kZWZpbmVkIiAmJiB0aGlzLm90aGVyLmFkZEJsb2NrSXRlbSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgbGlzdC5wdXNoKG5ldyBSZWdFeHAodGhpcy5vdGhlci5hZGRCbG9ja0l0ZW0ucmVwbGFjZSgiKiIsICIuKiIpKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbGlzdDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIEFkc1N0eWxlTW9kZUNoYW5nZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7djE6IENPTlNULnVzZUl0ZW0uQWRzU3R5bGVNb2RlLCB2MjogQ09OU1QudXNlSXRlbS5IdVlhbk1vZGUsIHYzOiBBQ0NvbmZpZy5TdHlsZV9CYWlkdUxpdGUsIHY0OiBBQ0NvbmZpZy5pc0Zhdmljb25FbmFibGV9OwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgQ29uZmlnQ2hhbmdlKCl7CiAgICAgICAgICAgICAgICByZXR1cm4ge3YxOiBBQ0NvbmZpZy5pc0VuTGFuZ307CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB3YXRjaDogewogICAgICAgICAgICAgIEFkc1N0eWxlTW9kZUNoYW5nZShkYXRhKSB7CiAgICAgICAgICAgICAgICAvLyDpnIDopoHlhYjliKDpmaTljp/mnInnmoToioLngrnmlbDmja4KICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHtyZXMsIG5vZGV9ID0gY2hlY2tEb2NtZW50SGFzTm9kZSgiQUMtIikKICAgICAgICAgICAgICAgICAgaWYgKHJlcykgbm9kZS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgZWxzZSBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNhZmVSZW1vdmUoInN0eWxlW2NsYXNzPSdBQy1TdHlsZS1leHBhbmQnXSxzdHlsZVtjbGFzcz0nQUMtVHdvUGFnZUV4U3R5bGUnXSxzdHlsZVtjbGFzcz0nQUMtVGhyZWVQYWdlRXhTdHlsZSddLHN0eWxlW2NsYXNzPSdBQy1Gb3VyUGFnZUV4U3R5bGUnXSxzdHlsZVtjbGFzcz0nQUMtc3R5bGUtbG9nbyddLHN0eWxlW2NsYXNzPSdBQy1iYWlkdUxpdGVTdHlsZSddLHN0eWxlW2NsYXNzPSdBQy1iYWlkdUh1WWFuU3R5bGUtRmlsZSddIik7CiAgICAgICAgICAgICAgICBhY0Nzc0xvYWRGbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICBDT05TVC5TdHlsZU1hbmdlci5pbml0KCk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBDb25maWdDaGFuZ2UoKXsKICAgICAgICAgICAgICAgIEFsbERhdGEubGFuLnVzZSA9IEFDQ29uZmlnLmlzRW5MYW5nID8gQWxsRGF0YS5sYW4uZW4gOiBBbGxEYXRhLmxhbi56aF9jbjsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNteXVzZXIiKS5yZW1vdmUoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICBpZiAodHlwZW9mIChWdWUpICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGlmIChWdWUudmVyc2lvbi5jaGFyQXQoMCkgPT0gMikgewogICAgICAgICAgICAgIHZ1ZVZNID0gbmV3IFZ1ZShvcHRpb25zKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2dWVWTSA9IFZ1ZS5jcmVhdGVBcHAob3B0aW9ucykubW91bnQoY2hlY2tOb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiVnVlIOacquWujOaIkOWIneWni+WMli0t56iL5bqP5peg5rOV5pyJ5pWI5omn6KGMIik7CiAgICAgICAgICB9CiAgICAgICAgfSwgMjUwKTsKCiAgICAgICAgZnVuY3Rpb24gTWFpbkNhbGxiYWNrKGUpIHsKICAgICAgICAgIGlmIChlLnRhcmdldCAhPSBudWxsICYmIHR5cGVvZiAoZS50YXJnZXQuY2xhc3NOYW1lKSA9PSAic3RyaW5nIiAmJiBlLnRhcmdldC5jbGFzc05hbWUudG9VcHBlckNhc2UoKS5pbmRleE9mKCJBQy0iKSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy/lsY/olL3mjonlm6DkuLrlop7liqBjc3Plr7zoh7TnmoTop6blj5FpbnNlcnTliqjkvZwKICAgICAgICAgIHJhcGlkRGVhbCgpOwogICAgICAgICAgSW5zZXJ0U2V0dGluZ01lbnUoKTsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBTaG93U2V0dGluZygpOwogICAgICAgICAgfSwgMTAwMCkgLy8g5rue5ZCO56qX5Y+j55qE5Yqg6L2977yM5YeP5bCR5YmN5pyfQ1BV5LqJ55SoCiAgICAgICAgfQoKICAgICAgICAvKuS7peS4i+S7o+eggeWkp+mDqOWIhuadpea6kOS6jlN1cHJlUHJlbG9hZGVyIOaEn+iwoiBzd2R5aCAmJiB5d3poYWlxaSAmJiBOTEYg5Lul5Y+KIG1hY2g2IOWkp+S9rCovCiAgICAgICAgZnVuY3Rpb24gYWNfc3BmdW5jKGUpIHsKICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICB2YXIgdCwgciA9IGUuY3VycmVudFRhcmdldDsKICAgICAgICAgIHZhciBUd2VlbiA9IHsKICAgICAgICAgICAgICAgIExpbmVhcjogZnVuY3Rpb24gTGluZWFyKGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgKiBlIC8gbiArIHQ7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgUXVhZDogewogICAgICAgICAgICAgICAgICBlYXNlSW46IGZ1bmN0aW9uIGVhc2VJbihlLCB0LCByLCBuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgKiAoZSAvPSBuKSAqIGUgKyB0OwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBlYXNlT3V0OiBmdW5jdGlvbiBlYXNlT3V0KGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLXIgKiAoZSAvPSBuKSAqIChlIC0gMikgKyB0OwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBlYXNlSW5PdXQ6IGZ1bmN0aW9uIGVhc2VJbk91dChlLCB0LCByLCBuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChlIC89IG4gLyAyKSA8IDEgPyByIC8gMiAqIGUgKiBlICsgdCA6IC1yIC8gMiAqICgtLWUgKiAoZSAtIDIpIC0gMSkgKyB0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgQ3ViaWM6IHsKICAgICAgICAgICAgICAgICAgZWFzZUluOiBmdW5jdGlvbiBlYXNlSW4oZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByICogKGUgLz0gbikgKiBlICogZSArIHQ7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VPdXQ6IGZ1bmN0aW9uIGVhc2VPdXQoZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByICogKChlID0gZSAvIG4gLSAxKSAqIGUgKiBlICsgMSkgKyB0OwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBlYXNlSW5PdXQ6IGZ1bmN0aW9uIGVhc2VJbk91dChlLCB0LCByLCBuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChlIC89IG4gLyAyKSA8IDEgPyByIC8gMiAqIGUgKiBlICogZSArIHQgOiByIC8gMiAqICgoZSAtPSAyKSAqIGUgKiBlICsgMikgKyB0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgUXVhcnQ6IHsKICAgICAgICAgICAgICAgICAgZWFzZUluOiBmdW5jdGlvbiBlYXNlSW4oZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByICogKGUgLz0gbikgKiBlICogZSAqIGUgKyB0OwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBlYXNlT3V0OiBmdW5jdGlvbiBlYXNlT3V0KGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLXIgKiAoKGUgPSBlIC8gbiAtIDEpICogZSAqIGUgKiBlIC0gMSkgKyB0OwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBlYXNlSW5PdXQ6IGZ1bmN0aW9uIGVhc2VJbk91dChlLCB0LCByLCBuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChlIC89IG4gLyAyKSA8IDEgPyByIC8gMiAqIGUgKiBlICogZSAqIGUgKyB0IDogLXIgLyAyICogKChlIC09IDIpICogZSAqIGUgKiBlIC0gMikgKyB0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgUXVpbnQ6IHsKICAgICAgICAgICAgICAgICAgZWFzZUluOiBmdW5jdGlvbiBlYXNlSW4oZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByICogKGUgLz0gbikgKiBlICogZSAqIGUgKiBlICsgdDsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZWFzZU91dDogZnVuY3Rpb24gZWFzZU91dChlLCB0LCByLCBuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHIgKiAoKGUgPSBlIC8gbiAtIDEpICogZSAqIGUgKiBlICogZSArIDEpICsgdDsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZWFzZUluT3V0OiBmdW5jdGlvbiBlYXNlSW5PdXQoZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoZSAvPSBuIC8gMikgPCAxID8gciAvIDIgKiBlICogZSAqIGUgKiBlICogZSArIHQgOiByIC8gMiAqICgoZSAtPSAyKSAqIGUgKiBlICogZSAqIGUgKyAyKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBTaW5lOiB7CiAgICAgICAgICAgICAgICAgIGVhc2VJbjogZnVuY3Rpb24gZWFzZUluKGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLXIgKiBNYXRoLmNvcyhlIC8gbiAqIChNYXRoLlBJIC8gMikpICsgciArIHQ7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VPdXQ6IGZ1bmN0aW9uIGVhc2VPdXQoZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByICogTWF0aC5zaW4oZSAvIG4gKiAoTWF0aC5QSSAvIDIpKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VJbk91dDogZnVuY3Rpb24gZWFzZUluT3V0KGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLXIgLyAyICogKE1hdGguY29zKE1hdGguUEkgKiBlIC8gbikgLSAxKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBFeHBvOiB7CiAgICAgICAgICAgICAgICAgIGVhc2VJbjogZnVuY3Rpb24gZWFzZUluKGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA9PSBlID8gdCA6IHIgKiBNYXRoLnBvdygyLCAxMCAqIChlIC8gbiAtIDEpKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VPdXQ6IGZ1bmN0aW9uIGVhc2VPdXQoZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBlID09IG4gPyB0ICsgciA6IHIgKiAoMSAtIE1hdGgucG93KDIsIC0xMCAqIGUgLyBuKSkgKyB0OwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBlYXNlSW5PdXQ6IGZ1bmN0aW9uIGVhc2VJbk91dChlLCB0LCByLCBuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAgPT0gZSA/IHQgOiBlID09IG4gPyB0ICsgciA6IChlIC89IG4gLyAyKSA8IDEgPyByIC8gMiAqIE1hdGgucG93KDIsIDEwICogKGUgLSAxKSkgKyB0IDogciAvIDIgKiAoMiAtIE1hdGgucG93KDIsIC0xMCAqIC0tZSkpICsgdDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIENpcmM6IHsKICAgICAgICAgICAgICAgICAgZWFzZUluOiBmdW5jdGlvbiBlYXNlSW4oZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAtciAqIChNYXRoLnNxcnQoMSAtIChlIC89IG4pICogZSkgLSAxKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VPdXQ6IGZ1bmN0aW9uIGVhc2VPdXQoZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByICogTWF0aC5zcXJ0KDEgLSAoZSA9IGUgLyBuIC0gMSkgKiBlKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VJbk91dDogZnVuY3Rpb24gZWFzZUluT3V0KGUsIHQsIHIsIG4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGUgLz0gbiAvIDIpIDwgMSA/IC1yIC8gMiAqIChNYXRoLnNxcnQoMSAtIGUgKiBlKSAtIDEpICsgdCA6IHIgLyAyICogKE1hdGguc3FydCgxIC0gKGUgLT0gMikgKiBlKSArIDEpICsgdDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIEVsYXN0aWM6IHsKICAgICAgICAgICAgICAgICAgZWFzZUluOiBmdW5jdGlvbiBlYXNlSW4oZSwgdCwgciwgbiwgYSwgbykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwID09IGUgPyB0IDogMSA9PSAoZSAvPSBuKSA/IHQgKyByIDogKG8gfHwgKG8gPSAuMyAqIG4pLCAhYSB8fCBhIDwgTWF0aC5hYnMocikgPyAoYSA9IHIsCiAgICAgICAgICAgICAgICAgICAgICBpID0gbyAvIDQpIDogaSA9IG8gLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKHIgLyBhKSwgLWEgKiBNYXRoLnBvdygyLCAxMCAqIChlIC09IDEpKSAqIE1hdGguc2luKChlICogbiAtIGkpICogKDIgKiBNYXRoLlBJKSAvIG8pICsgdCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VPdXQ6IGZ1bmN0aW9uIGVhc2VPdXQoZSwgdCwgciwgbiwgYSwgbykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwID09IGUgPyB0IDogMSA9PSAoZSAvPSBuKSA/IHQgKyByIDogKG8gfHwgKG8gPSAuMyAqIG4pLCAhYSB8fCBhIDwgTWF0aC5hYnMocikgPyAoYSA9IHIsCiAgICAgICAgICAgICAgICAgICAgICBpID0gbyAvIDQpIDogaSA9IG8gLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKHIgLyBhKSwgYSAqIE1hdGgucG93KDIsIC0xMCAqIGUpICogTWF0aC5zaW4oKGUgKiBuIC0gaSkgKiAoMiAqIE1hdGguUEkpIC8gbykgKyByICsgdCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VJbk91dDogZnVuY3Rpb24gZWFzZUluT3V0KGUsIHQsIHIsIG4sIGEsIG8pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMCA9PSBlID8gdCA6IDIgPT0gKGUgLz0gbiAvIDIpID8gdCArIHIgOiAobyB8fCAobyA9IG4gKiAoLjMgKiAxLjUpKSwgIWEgfHwgYSA8IE1hdGguYWJzKHIpID8gKGEgPSByLAogICAgICAgICAgICAgICAgICAgICAgaSA9IG8gLyA0KSA6IGkgPSBvIC8gKDIgKiBNYXRoLlBJKSAqIE1hdGguYXNpbihyIC8gYSksIGUgPCAxID8gYSAqIE1hdGgucG93KDIsIDEwICogKGUgLT0gMSkpICogTWF0aC5zaW4oKGUgKiBuIC0gaSkgKiAoMiAqIE1hdGguUEkpIC8gbykgKiAtLjUgKyB0IDogYSAqIE1hdGgucG93KDIsIC0xMCAqIChlIC09IDEpKSAqIE1hdGguc2luKChlICogbiAtIGkpICogKDIgKiBNYXRoLlBJKSAvIG8pICogLjUgKyByICsgdCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBCYWNrOiB7CiAgICAgICAgICAgICAgICAgIGVhc2VJbjogZnVuY3Rpb24gZWFzZUluKGUsIHQsIHIsIG4sIGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBhICYmIChhID0gMS43MDE1OCksIHIgKiAoZSAvPSBuKSAqIGUgKiAoKGEgKyAxKSAqIGUgLSBhKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VPdXQ6IGZ1bmN0aW9uIGVhc2VPdXQoZSwgdCwgciwgbiwgYSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsID09IGEgJiYgKGEgPSAxLjcwMTU4KSwgciAqICgoZSA9IGUgLyBuIC0gMSkgKiBlICogKChhICsgMSkgKiBlICsgYSkgKyAxKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGVhc2VJbk91dDogZnVuY3Rpb24gZWFzZUluT3V0KGUsIHQsIHIsIG4sIGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBhICYmIChhID0gMS43MDE1OCksIChlIC89IG4gLyAyKSA8IDEgPyByIC8gMiAqIChlICogZSAqICgoMSArIChhICo9IDEuNTI1KSkgKiBlIC0gYSkpICsgdCA6IHIgLyAyICogKChlIC09IDIpICogZSAqICgoMSArIChhICo9IDEuNTI1KSkgKiBlICsgYSkgKyAyKSArIHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBCb3VuY2U6IHsKICAgICAgICAgICAgICAgICAgZWFzZUluOiBmdW5jdGlvbiBlYXNlSW4oZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByIC0gVHdlZW4uQm91bmNlLmVhc2VPdXQobiAtIGUsIDAsIHIsIG4pICsgdDsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZWFzZU91dDogZnVuY3Rpb24gZWFzZU91dChlLCB0LCByLCBuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChlIC89IG4pIDwgMSAvIDIuNzUgPyByICogKDcuNTYyNSAqIGUgKiBlKSArIHQgOiBlIDwgMiAvIDIuNzUgPyByICogKDcuNTYyNSAqIChlIC09IDEuNSAvIDIuNzUpICogZSArIC43NSkgKyB0IDogZSA8IDIuNSAvIDIuNzUgPyByICogKDcuNTYyNSAqIChlIC09IDIuMjUgLyAyLjc1KSAqIGUgKyAuOTM3NSkgKyB0IDogciAqICg3LjU2MjUgKiAoZSAtPSAyLjYyNSAvIDIuNzUpICogZSArIC45ODQzNzUpICsgdDsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZWFzZUluT3V0OiBmdW5jdGlvbiBlYXNlSW5PdXQoZSwgdCwgciwgbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBlIDwgbiAvIDIgPyAuNSAqIFR3ZWVuLkJvdW5jZS5lYXNlSW4oMiAqIGUsIDAsIHIsIG4pICsgdCA6IC41ICogVHdlZW4uQm91bmNlLmVhc2VPdXQoMiAqIGUgLSBuLCAwLCByLCBuKSArIC41ICogciArIHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIFR3ZWVuTSA9IFsiTGluZWFyIiwgIlF1YWQiLCAiQ3ViaWMiLCAiUXVhcnQiLCAiUXVpbnQiLCAiU2luZSIsICJFeHBvIiwgIkNpcmMiLCAiRWxhc3RpYyIsICJCYWNrIiwgIkJvdW5jZSJdLAogICAgICAgICAgICAgIFR3ZWVuRWFzZSA9IFsiZWFzZUluIiwgImVhc2VPdXQiLCAiZWFzZUluT3V0Il07CiAgICAgICAgICB2YXIgcHJlZnMgPSB7CiAgICAgICAgICAgIHNfbWV0aG9kOiAzLAogICAgICAgICAgICBzX2Vhc2U6IDIsCiAgICAgICAgICAgIHNfRlBTOiA2MCwKICAgICAgICAgICAgc19kdXJhdGlvbjogMzMzLAogICAgICAgICAgfTsKCiAgICAgICAgICBmdW5jdGlvbiBnZXRSZWxhdGl2ZURpdihlKSB7CiAgICAgICAgICAgIHZhciB0ID0gci5pZDsKICAgICAgICAgICAgcmV0dXJuICh0ID0gdC5yZXBsYWNlKC8oc3Atc2VwYXJhdG9yLSkoLispLywgKGZ1bmN0aW9uICh0LCByLCBuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHIgKyBTdHJpbmcoTnVtYmVyKG4pICsgKCJwcmUiID09IGUgPyAtMSA6IDEpKTsKICAgICAgICAgICAgfSkpKSA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHQpIDogbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzcF90cmFuc2l0aW9uKGUsIHQpIHsKICAgICAgICAgICAgdmFyIHIgPSBzcF90cmFuc2l0aW9uLlR3ZWVuRjsKICAgICAgICAgICAgciB8fCAociA9IChyID0gVHdlZW5bVHdlZW5NW3ByZWZzLnNfbWV0aG9kXV0pW1R3ZWVuRWFzZVtwcmVmcy5zX2Vhc2VdXSB8fCByLCBzcF90cmFuc2l0aW9uLlR3ZWVuRiA9IHIpOwogICAgICAgICAgICB2YXIgbiA9IDFlMyAvIHByZWZzLnNfRlBTLCBhID0gMCwgbyA9IGUsIGkgPSB0IC0gZSwgcyA9IE1hdGguY2VpbChwcmVmcy5zX2R1cmF0aW9uIC8gbiksCiAgICAgICAgICAgICAgICBjID0gd2luZG93LnNjcm9sbFg7CiAgICAgICAgICAgICFmdW5jdGlvbiB0cmFuc2l0aW9uKCkgewogICAgICAgICAgICAgIHZhciBlID0gTWF0aC5jZWlsKHIoYSwgbywgaSwgcykpOwogICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGwoYywgZSksIGEgPCBzICYmIChhKyssIHNldFRpbWVvdXQodHJhbnNpdGlvbiwgbikpOwogICAgICAgICAgICB9KCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2Nyb2xsSXQoZSwgdCkgewogICAgICAgICAgICBzcF90cmFuc2l0aW9uKGUsIHQpOwogICAgICAgICAgfQoKICAgICAgICAgIHN3aXRjaCAoZS50YXJnZXQuaWQpIHsKICAgICAgICAgICAgY2FzZSAic3Atc3AtZ290b3AiOgogICAgICAgICAgICAgIHNjcm9sbEl0KHdpbmRvdy5zY3JvbGxZLCAwKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgInNwLXNwLWdvcHJlIjoKICAgICAgICAgICAgICB2YXIgbiA9IGdldFJlbGF0aXZlRGl2KCJwcmUiKTsKICAgICAgICAgICAgICBpZiAoIW4pIHJldHVybjsKICAgICAgICAgICAgICB0ID0gd2luZG93LnNjcm9sbFk7CiAgICAgICAgICAgICAgdmFyIGEgPSBuLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDsKICAgICAgICAgICAgICBhID0gdCAtIChyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIGEpOwogICAgICAgICAgICAgIHNjcm9sbEl0KHQsIGEpOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAic3Atc3AtZ29uZXh0IjoKICAgICAgICAgICAgICB2YXIgbyA9IGdldFJlbGF0aXZlRGl2KCJuZXh0Iik7CiAgICAgICAgICAgICAgaWYgKCFvKSByZXR1cm47CiAgICAgICAgICAgICAgdCA9IHdpbmRvdy5zY3JvbGxZOwogICAgICAgICAgICAgIHZhciBpID0gby5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7CiAgICAgICAgICAgICAgaSA9IHQgKyAoLXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgaSk7CiAgICAgICAgICAgICAgc2Nyb2xsSXQodCwgaSk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJzcC1zcC1nb2JvdHRvbSI6CiAgICAgICAgICAgICAgc2Nyb2xsSXQod2luZG93LnNjcm9sbFksIE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQsIGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0KSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiB3aW5kb3dzY3JvbGwoZm4pIHsKICAgICAgICAgIHZhciBiZWZvcmVTY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wLAogICAgICAgICAgICAgIGZuID0gZm4gfHwgZnVuY3Rpb24gKCkge307CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgLy8g5bu25pe25omn6KGM77yM6YG/5YWN5Yia6L295YWl5Yiw6aG16Z2i5bCx6Kem5Y+R57+76aG15LqL5Lu2CiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJzY3JvbGwiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHZhciBhZnRlclNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AsCiAgICAgICAgICAgICAgICAgIGRlbHRhID0gYWZ0ZXJTY3JvbGxUb3AgLSBiZWZvcmVTY3JvbGxUb3A7CiAgICAgICAgICAgICAgaWYgKGRlbHRhID09IDApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICBmbihkZWx0YSA+IDAgPyAiZG93biIgOiAidXAiLCBlKTsKICAgICAgICAgICAgICBiZWZvcmVTY3JvbGxUb3AgPSBhZnRlclNjcm9sbFRvcDsKICAgICAgICAgICAgfSwgZmFsc2UpOwogICAgICAgICAgfSwgMTAwMCkKICAgICAgICB9CgogICAgICAgIHdpbmRvd3Njcm9sbChmdW5jdGlvbiAoZGlyZWN0aW9uLCBlKSB7CiAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAiZG93biIpIHsgLy8g5LiL5ruR5omN5YeG5aSH57+76aG1CiAgICAgICAgICAgIGxldCBzcGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc3AtZnctYV9lbmFibGUiKTsKICAgICAgICAgICAgLy8g5byA5ZCv5ZCO77yM5LiU5Zyo6Z2e77yIc3VwcmVwcmVsb2FkZXLlkK/nlKjvvInml7blnYflj68KICAgICAgICAgICAgaWYgKEFDQ29uZmlnLmlzQXV0b3BhZ2UgPT09IHRydWUgJiYgIShzcGwgJiYgc3BsLmNoZWNrZWQgPT09IHRydWUpKSB7CiAgICAgICAgICAgICAgdmFyIHNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOwogICAgICAgICAgICAgIGxldCBzY3JvbGxEZWx0YSA9IDY2NjsKICAgICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5HT09HTEUpIHNjcm9sbERlbHRhID0gMTAyNDsgLy8g5q+V56uf6LC35q2M5Yqg6L2957yT5oWi55qE6Zeu6aKYCiAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQgPD0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCArIHNjcm9sbFRvcCArIHNjcm9sbERlbHRhICYmIGN1clNpdGUucGFnZUxvYWRpbmcgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBjdXJTaXRlLnBhZ2VMb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkRVQ0spIHsgLy8g5Y+v5Lul55So5bey5pyJ55qE5pa55rOV5p2l5a6e546w5LqGCiAgICAgICAgICAgICAgICAgIGlmICghQUNDb25maWcubm9ybWFsaXplRHVjayB8fCBwYXJzZUludChBQ0NvbmZpZy5kdWNrLkFkc1N0eWxlTW9kZSkgPj0gMykgeyAgLy8g5aaC5p6c5rKh5pyJ5byA5ZCv77yM6YKj5LmI5omL5Yqo57+76aG1IHx8IOWmguaenOaYr+WPjOWIl+eahOaXtuWAme+8jOS8vOS5juW5tuS4jeS8muiHquWKqOinpuWPkee/u+mhteaViOaenAogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNsaW5rcyAucmVzdWx0LS1tb3JlIGEiKS5jbGljaygpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgY3VyU2l0ZS5wYWdlTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0sIDUwMDApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBTaG93UGFnZXIubG9hZE1vcmVQYWdlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdmFyIFNob3dQYWdlciA9IHsKICAgICAgICAgIGdldEZ1bGxIcmVmOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZihlID09IG51bGwpIHJldHVybiAnJzsKICAgICAgICAgICAgInN0cmluZyIgIT0gdHlwZW9mIGUgJiYgKGUgPSBlLmdldEF0dHJpYnV0ZSgiaHJlZiIpKTsKICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmdldEZ1bGxIcmVmLmE7CiAgICAgICAgICAgIHJldHVybiB0IHx8ICh0aGlzLmdldEZ1bGxIcmVmLmEgPSB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpKSwgdC5ocmVmID0gZSwgdC5ocmVmOwogICAgICAgICAgfSwKICAgICAgICAgIGNyZWF0ZURvY3VtZW50QnlTdHJpbmc6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChlKSB7CiAgICAgICAgICAgICAgaWYgKCJIVE1MIiAhPT0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm5vZGVOYW1lKSByZXR1cm4gKG5ldyBET01QYXJzZXIpLnBhcnNlRnJvbVN0cmluZyhlLCAiYXBwbGljYXRpb24veGh0bWwreG1sIik7CiAgICAgICAgICAgICAgdmFyIHQ7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHQgPSAobmV3IERPTVBhcnNlcikucGFyc2VGcm9tU3RyaW5nKGUsICJ0ZXh0L2h0bWwiKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0KSByZXR1cm4gdDsKICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KSB0ID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCJBRG9jdW1lbnQiKTsgZWxzZSB0cnkgewogICAgICAgICAgICAgICAgKHQgPSBkb2N1bWVudC5jbG9uZU5vZGUoITEpKS5hcHBlbmRDaGlsZCh0LmltcG9ydE5vZGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCAhMSkpLAogICAgICAgICAgICAgICAgICB0LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0LmNyZWF0ZUVsZW1lbnQoImhlYWQiKSksIHQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKHQuY3JlYXRlRWxlbWVudCgiYm9keSIpKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0KSB7CiAgICAgICAgICAgICAgICB2YXIgciA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAgICAgICByLnNlbGVjdE5vZGVDb250ZW50cyhkb2N1bWVudC5ib2R5KTsKICAgICAgICAgICAgICAgIHZhciBuID0gci5jcmVhdGVDb250ZXh0dWFsRnJhZ21lbnQoZSk7CiAgICAgICAgICAgICAgICB0LmJvZHkuYXBwZW5kQ2hpbGQobik7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBhLCBvID0gewogICAgICAgICAgICAgICAgICBUSVRMRTogITAsCiAgICAgICAgICAgICAgICAgIE1FVEE6ICEwLAogICAgICAgICAgICAgICAgICBMSU5LOiAhMCwKICAgICAgICAgICAgICAgICAgU1RZTEU6ICEwLAogICAgICAgICAgICAgICAgICBCQVNFOiAhMAogICAgICAgICAgICAgICAgfSwgaSA9IHQuYm9keSwgcyA9IGkuY2hpbGROb2RlcywgYyA9IHMubGVuZ3RoIC0gMTsgYyA+PSAwOyBjLS0pIG9bKGEgPSBzW2NdKS5ub2RlTmFtZV0gJiYgaS5yZW1vdmVDaGlsZChhKTsKICAgICAgICAgICAgICAgIHJldHVybiB0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGNvbnNvbGUuZXJyb3IoIltBQy1TY3JpcHRdIiwgIuayoeacieaJvuWIsOimgei9rOaIkERPTeeahOWtl+espuS4siIpOwogICAgICAgICAgfSwKICAgICAgICAgIGxvYWRNb3JlUGFnZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoY3VyU2l0ZS5wYWdlcikgewogICAgICAgICAgICAgIGxldCBjdXJQYWdlRWxlID0gZ2V0RWxlbWVudEJ5WHBhdGgoY3VyU2l0ZS5wYWdlci5uZXh0TGluayk7CiAgICAgICAgICAgICAgdmFyIHVybCA9IHRoaXMuZ2V0RnVsbEhyZWYoY3VyUGFnZUVsZSk7CiAgICAgICAgICAgICAgaWYoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5HT09HTEUgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdtYWNpbnRvc2gnKSkgewogICAgICAgICAgICAgICAgLy8gTUFSSyDkuLrkuoblhbzlrrnnmb7luqblnKhzYWZhcmnkuIvnmoQKICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCdodHRwczovLycsICdodHRwOi8vJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmKHVybCA9PT0gJycpIHJldHVybjsKICAgICAgICAgICAgICB2YXIgc2VwSW1ncyA9IHsKICAgICAgICAgICAgICAgIHRvcDogImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQllBQUFBV0NBWUFBQURFdEd3N0FBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBV3RKUkVGVWVOcmNsRTByUkdFVXg4YzFHVXBSSklWSVpHZGhaQ1ZyMzhHR2hhSTBaWHdDa2xpZ2xDaFpFY3ZKeGhkZ1lXT2pMRVVwbS9FeWlMenplK284ZFR6ZE8zUGxqb1ZUdjdyUGM4LzVkKzY1NTV4WXJFaFdvcDZib2RhNSs2bDl3aldjV3BGK1dJYnFDSko5aEZSY0RyM1FBSWtJaEt1Z3o1UERma1NpeGtwaHo1YWlBbnFnRThyZ1dSeEdvU09QeUJrc3dRdVV3eXNjdzRIcm1GQ1pMOEt0L0pBZzdtRUZQRW1vNEZkUHdrMEJVY3NkeklhcDBUUThxTUFQdUlDY0VqTG5kK1ZqU2pjZkpOZ0ljL0RrWkdTeW1ZR3NuSzlFWk1yeGU0TUZhTkdpWmpDMmZUNXpRM3A3UURLMWRSMkdTbGp6aWNsQXZSVWU4bkhZVkE0amp2QzQzTmZBdWsvc21CMlFOcWNzV3hLY0xiQUtURm5TMGhXRDZuMjdGZDZGTHFpREk1aVFtUTlqcGlWVDBzTko2YVlkN2RBRTNRSEJiaW5TQVg1SldXYXh1TG84RjM1amgvYkJLOVkrL3IvQ2w2cExjbm5hOE52dURHTW5zbHBiWlJwWFpZVC8zcjRFR0FDWkwzWkwyYWZORkFBQUFBQkpSVTVFcmtKZ2dnPT0iLAogICAgICAgICAgICAgICAgYm90dG9tOiAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCWUFBQUFXQ0FZQUFBREV0R3c3QUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUFYRkpSRUZVZU5yTTFjOHJCR0VjeC9GZHRDRWtMcVl0cGR3a0tTVUhVaHh3SVRkSytaM3lNMmNPTG5KMzlDYzQ0U2dIU2NtSndsRnhzSWRsQ1NjTzYvMnQ3Nk9ucDUyZFhUdGJubm8xTTgrUHo4NCt6ek16a2NnL0tBM29SVHpNMEE0Y0k0VlRkSVVWUElNM3BQR081YUFCSlRrR3gxQnFqWW1GRlp4VzdubkJ3WG1Yb2dXWDZiRUdjMmpFSVU3K2tOV0RVU1N3WnlxbmRTdkozTjFnMkJtMG9MdEIyait3N3JRUDRNcHFYelJUMFlSYVBXL0J0aE1lZFlMczYwSHNvRTJ2cTlCc1B3QUphOFhGTFVhMGZVcnZST28vc2FUMVE5YWRHaW1kbHQ4eWo2VFQ2UTZkMnZhaWRhOVlSYnRQNkVxbUJaQzVmSEE2WCtBQXoxYndFYzZjZms5K29hWk00Tm9aSkw3MCtKMmhUYVp0TnBldDA0MXpLOHlQL01nbCtyT0YxZW1yMFVNMXhuQWZFUHlJU2QwSm5vNnZ0eCtRdU02UFoyMmxwTzdkYkVWMlNpdjZyUGVJak5zMUhkWUM3aXhmRytZQnFkVFZEcVBJdjZpSVd2TzdpWEdVRnhBcWk3MlByYUo5SUg4RUdBQ1FjWWpZUmQ1R0h3QUFBQUJKUlU1RXJrSmdnZz09IiwKICAgICAgICAgICAgICAgIHByZTogImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQllBQUFBV0NBWUFBQURFdEd3N0FBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBU2xKUkVGVWVOcGlZQmpPb0JpSXJ3SnhGUkF6VXN2UVZpRCtDTVQvZ2ZnVEVQZFJ5OUJQVUVOaCtBc1E5MUppYUF1U1M5SHhaM0lOYjhIaTB2K1V1cndGNnFML1JPQnZRTnhEcktGZmtUVCtBK0puUVB3QktmSkEvTDlJYW43aWM3a01FSGNDOFE4MEYzVUFjUnNRdjRieTMwSU5hVUpUOXdlYVdoU1FEUlVCNHVWWXZMa1lpQVdBT0JvcHZFRkJsQXJFUEVBOEc0dWU5VUFzQVRNNEVZdUNKVWdLTXRBTUxvU0tDd1B4WEN4NmMxaWdDbFRRZ21VWlZQTnJITUVHeTNtZ1lDa0NZaVlnVGtDU1Y0VVp2QTJJallCWURJZ3ZRYlB2T3lKVEVDaWQ1d0h4YnlBMkJ1TDNRTHdSV1lFc0VKdmcwSXdlRkVVNDFJRU1sZ2N4V0pBRUgwTXhKZUFzak1GRXE2SncrQnI4QmltVmZNQ1RERWtHN0VCY0E4VDNvV1VKeDREVll3QUJCZ0Nhbm5uU3piZ3dJUUFBQUFCSlJVNUVya0pnZ2c9PSIsCiAgICAgICAgICAgICAgICBuZXh0OiAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCWUFBQUFXQ0FZQUFBREV0R3c3QUFBQUdYUkZXSFJUYjJaMGQyRnlaUUJCWkc5aVpTQkpiV0ZuWlZKbFlXUjVjY2xsUEFBQUFUMUpSRUZVZU5yYzFiMUtBMEVZaGVFbC9pQVJGRkVrS2w2RDBVSzhDckVWckN3RWV4RkN0QklsUldJanNmRWlMTDBGS3pzN1FVV3hNMnBpRk1Va3ZoUE93TEFzMlRHdUNuN3drTmxsNWpDNyt3MEpndjlhdmRqQU9iYlFuMVR3Q3U3UXdoV1c0eGFrUElPSE1LenhHQ2FTQ202aW9YSExaMEhxcHo3S3J3UlBJdnZOdkJsTTJ6WXlOWThjTWpoREhvOWZDQnpFcm5JcUtOamdSU3hwdklBQmJPTGVzMk1LV0hmdVhkaFhjUjJhdktySjR6R2hJOWdMaFFicTlYYVpnR08xa3V0SU96SUhwS3A3TmF3aGpZT0lOU2VZNmxGd0hhY3cxN1A2TlRXSGQ0eHFuTmJjUzgzTE9idHNhQ1BiRVcrZ1hVVzhPRHN3QzI3eG9Pc24zT0REbWZPR3NzOVhMdUU1NGpHanZQcUd1dUcxbUZEelpJZmROSHlubmRlN0RiVzFyNUR3VHN0SkhQMmlFNTVZcUQzNmViWFpEdnIrN0wvc1U0QUJBSXBWWldub0E1R2tBQUFBQUVsRlRrU3VRbUNDIiwKICAgICAgICAgICAgICAgIG5leHRfZ3JheTogImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQllBQUFBV0NBWUFBQURFdEd3N0FBQUFHWFJGV0hSVGIyWjBkMkZ5WlFCQlpHOWlaU0JKYldGblpWSmxZV1I1Y2NsbFBBQUFBdHhKUkVGVWVOcmNsYzlMMm1FY3g3LzZOYlZacVJWajdwSU9sSVV1WjFITWd2MEJEY3FUN0pyc2tIMTNFTFBCRjdlVHZ6MTBIem5XUUJsQlJJZkJYSWZCTG1xWHNjdllaV1BLck1OSVU5QXBtcnIzNC93Nmkwb3ZNWmp3K0gwK3ovTjhYdCtQbi9mbjgwaFIvK1dIWVJoQklwRndSS1BSei9GNC9LbkQ0UkIyOHhIMEFoNGNISHlvVUNqc0lwRklJWlBKSGttbDBtOVlmbjJaRDc4WGNMMWVINnJWYWxJTUNtTVV0cUtiRDcvSGJOUXhhcTE1b3hjSC9sWHBjbVhndG5oMnUvMm1YQzYvRHFFK3NTeExsVXFsbmlFMFRWUEJZSkFxRm90NitHVjlQdCtQSnRobXM4MHNMUzJ4RW9ua2hsZ3Mvamd3TU9CY1hWM041ZlA1cmxDY3A5YlgxeVdMaTR1ZWNyazhVNmxVc2hEWTN3UmJMSllGR0tac05rc3E0Tjc4L0x3WTloT24wNWs1T2pxaStQelRHZVB4ZUZ3WlVsNnZkOGhrTXZrUERnNnNaSjJNNWVYbHIxd3FVdTJrQTVKT3B5MklBTytvTzlmVzFuNW1NcGsybkRqbWNqa0tOVTI1WEM2NTJXeDJwVklwNjVtWEoybnlqVVBwcWFrcE5aeHVBOFk1VDg3T3pzb2JqY1lIcFZLcEdoc2JlMUN0VmtYWXF4UUtoVGRxdGZxTDFXcjFKcFBKeHh5VTVMcS92ejhhQ29YOFRURGF0WWlGaEY2dnh4NXRBSndtOE9QajQ4bTV1Ym1LU3FVYUFXd1NhOWVRdzZKR28vbHVOQm9OaDRlSGJBZTBKaEFJTnNMaDhMTkFJSkNpdWRoeEIrUWgybHVkVGlmREFRTHZJM0FJY2grUmtsOGpKbHJoQ2JPcWdmb0xtRGVwT0YvQmZHTnJhMnNGRlpGdHZxZ3pNYkZZakFpeXA5VnFoNFZDNGNUSnlZbVE5MGVwSVFKdEhSTzFiQTVhUmhBdmRuWjJHSS9IODdjRXo1WVBnZU9TMlJzZkh4OUI3dStnT2k2OHlRQXRZWDl6ZDNlWGdaQ25hL3M4Qnk1eXBHVVV6aE9JU0hnTzlCZldYd0c2Y2haNkliaVZjNkx3bnNGZ0dJVkFlcEx6ams0cllXMXplM3ViY2J2ZDUzZmpaVjJGYXFHUTYzZlQwOVBETU85aTlCRW9vbjBKOVJtLzMzOXhtM2RyMmYzOWZWTFg3d0Z2b01Wdm9ZV2ZSeUlSRm5kRC9aLzhuZjBXWUFBOEVDMVovWk5tNGdBQUFBQkpSVTVFcmtKZ2dnPT0iLAogICAgICAgICAgICAgICAgcHJlX2dyYXk6ICJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJZQUFBQVdDQVlBQUFERXRHdzdBQUFBR1hSRldIUlRiMlowZDJGeVpRQkJaRzlpWlNCSmJXRm5aVkpsWVdSNWNjbGxQQUFBQXNsSlJFRlVlTnJjbFR0TVdtRVV4ei91dlR6bElVaHBOTVIwYUdOanJOSFNtSFRxUkp5YWR1alFEYlNHUndKVWFZQ21EaXpxVUV3Nk9EVk5HZ2JwWUNmU3BGSU5DUXpGUjlveU1YUnNYRkNzQVhrSUtOTC9SN2dHV3hPc1NkUEVrNXpjM08rZTg3dm4rNTl6djB2SXBiU0ppUW15dWJuNUxCS0pwTmJYMTErNFhDNUJ1eHkyWFlETlppTU9oMk9XNHppUFRDYlRpOFhpa2VIaDRTc1NpZVFUWG5JeHNOMXVKMWFyZFZZZ0VEZ1BEdytWOVhxZDFHbzFNY3V5ZzdBdXVWeStzcmEyOW5kZ1ZFbkd4OGRuaEVLaHMxcXRLZ0UvZVhaOGZDekMrcTMrL242dFNxVmFTU1FTNXdNN25VNWlNcGxtc0YxWHBWSTVCZVh0Nk9oSUJGa0dBZTlTS3BWL3dObXpLaldielJUNnRGd3VLODZDVXFQcmtJVldQalF3TUtCV0tCU240T3p2MExHeHNSbVJTRFNGU2p1YTBEbzhUUldBUytCNStCNjhnL0loaXhDTnZRUE4xV2p1aWVac1MvZjFhTlEwd3pCdWFDcWxVQ1FSdFZyOUVzMUs0a1ZEV0pOaHJRakFJaXFNbGtxbGU4MDRGbmtqQm9PaEV6djR2ckd4a1cyQUxSYUxGcnErUW9BVjJuRTh0TGUzZHpFWURFNXZiMjkzOXZYMVBjQmtpS1ZTYVExakZvckZZcStOUnFNdW04M2Vic1l6bUpxN3NHdTR4aGtLeHNEZkIvQXhuTzg2MGV2MW9lWGxaVThnRU1nbWswa0ZxbXc4bzlkVUtpV2ZuNTh2aE1QaDU0aDdTK09wUVhOU0xCWWZlanllUjF5enc5ZGJSb24wOVBTOFcxMWRuZkw1ZkpsOFBrKzBXaTNoazV2eUNOQlk0dlY2ZjBJbTkram9LSk5PcDgxOG84RzcwYWg0YVducEl6U0tZQ2EvZFhkM0IrUHh1SE55Y2pLenM3TnpBbXMxK3FGUXkrVnlkRFJ6MFdqVXBkUHAzdEI4VEZNMEZBcUZHeFhQemMxOXBsSnJOSnFyYU1vWHQ5dE50M1N1YytUZzRJQ2VKZm1GaFFWTG9WQXdvS0c3ZnIvL0I4Y0hBTDZGeTlaRkRpbmFHL3I1dzc3eWE4eS9PaEV2S1JoanRJdXAyWU1UZUJiM21YWTUzSG5BbU5rUCsvdjdOekhUVHdBTzRmNzlmL3VkL1JKZ0FPTGNSTlpxTG9qTUFBQUFBRWxGVGtTdVFtQ0MiLAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgQUNfYWRkU3R5bGUoIi5zcC1zZXBhcmF0b3J7bGluZS1oZWlnaHQ6MS44ICFpbXBvcnRhbnQ7b3BhY2l0eToxICFpbXBvcnRhbnQ7cG9zaXRpb246cmVsYXRpdmUgIWltcG9ydGFudDtmbG9hdDpub25lICFpbXBvcnRhbnQ7dG9wOjAgIWltcG9ydGFudDtsZWZ0OjAgIWltcG9ydGFudDttaW4td2lkdGg6MzY2cHg7d2lkdGg6YXV0bzt0ZXh0LWFsaWduOmNlbnRlciAhaW1wb3J0YW50O2ZvbnQtc2l6ZToxNHB4ICFpbXBvcnRhbnQ7ZGlzcGxheTpibG9jayAhaW1wb3J0YW50O3BhZGRpbmc6M3B4IDAgIWltcG9ydGFudDttYXJnaW46NXB4IDEwcHggOHB4O2NsZWFyOmJvdGggIWltcG9ydGFudDtib3JkZXItc3R5bGU6c29saWQgIWltcG9ydGFudDtib3JkZXItY29sb3I6I2NjY2NjYyAhaW1wb3J0YW50O2JvcmRlci13aWR0aDoxcHggIWltcG9ydGFudDstbW96LWJvcmRlci1yYWRpdXM6MzBweCAhaW1wb3J0YW50O2JvcmRlci1yYWRpdXM6MzBweCAhaW1wb3J0YW50O2JhY2tncm91bmQtY29sb3I6I2ZmZmZmZiAhaW1wb3J0YW50O30uc3Atc2VwYXJhdG9yOmhvdmVye2JveC1zaGFkb3c6MCAwIDExcHggcmdiYSgzMywzMywzMywwLjIpO30jc3Atc2VwYXJhdG9yLWhvdmVye2Rpc3BsYXk6bm9uZTt9LnNwLXNlcGFyYXRvcjpob3ZlciAjc3Atc2VwYXJhdG9yLWhvdmVye2Rpc3BsYXk6YmxvY2s7fS5zcC1zZXBhcmF0b3IgLnNwLXNvbWVpbmZve3Bvc2l0aW9uOmFic29sdXRlICFpbXBvcnRhbnQ7cmlnaHQ6MTBweCAhaW1wb3J0YW50O2ZvbnQtc2l6ZToxMnB4ICFpbXBvcnRhbnQ7Zm9udC1zdHlsZTppdGFsaWMgIWltcG9ydGFudDtiYWNrZ3JvdW5kOm5vbmUgIWltcG9ydGFudDt9LnNwLXNlcGFyYXRvciBzcGFue3ZlcnRpY2FsLWFsaWduOiBtaWRkbGU7Y3Vyc29yOiBwb2ludGVyO3BhZGRpbmc6IDA7bWFyZ2luOiAwIDVweDtkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHdpZHRoOjIycHg7aGVpZ2h0OjIycHg7fS5zcC1zZXBhcmF0b3IgYXttYXJnaW46MCAyMHB4IDAgLTZweCAhaW1wb3J0YW50O2Rpc3BsYXk6aW5saW5lICFpbXBvcnRhbnQ7dGV4dC1zaGFkb3c6I2ZmZiAwIDFweCAwICFpbXBvcnRhbnQ7YmFja2dyb3VuZDpub25lICFpbXBvcnRhbnQ7Y29sb3I6IzU5NTk1OSAhaW1wb3J0YW50O30uc3Atc2VwYXJhdG9yIGlucHV0e3BhZGRpbmc6MCAhaW1wb3J0YW50O2xpbmUtaGVpZ2h0OjIzcHggIWltcG9ydGFudDt9LnNwLXNlcGFyYXRvciAuc3AtbWQtc3Bhbntmb250LXdlaWdodDpib2xkICFpbXBvcnRhbnQ7bWFyZ2luOjAgMjBweCAhaW1wb3J0YW50O30jc3Atc3AtbWQtbnVtYmVye3dpZHRoOjZjaCAhaW1wb3J0YW50O3ZlcnRpY2FsLWFsaWduOm1pZGRsZSAhaW1wb3J0YW50O2Rpc3BsYXk6aW5saW5lLWJsb2NrICFpbXBvcnRhbnQ7dGV4dC1hbGlnbjpsZWZ0ICFpbXBvcnRhbnQ7fSIgKwogICAgICAgICAgICAgICAgYC5hY19zcF90b3B7YmFja2dyb3VuZC1pbWFnZTp1cmwoJyR7c2VwSW1ncy50b3B9Jyl9YCArCiAgICAgICAgICAgICAgICBgLmFjX3NwX3ByZXtiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHtzZXBJbWdzLnByZX0nKX1gICsKICAgICAgICAgICAgICAgIGAuYWNfc3BfbmV4dHtiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHtzZXBJbWdzLm5leHR9Jyl9YCArCiAgICAgICAgICAgICAgICBgLmFjX3NwX2JvdHRvbXtiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHtzZXBJbWdzLmJvdHRvbX0nKX1gICsKICAgICAgICAgICAgICAgIGAuYWNfc3BfbmV4dF9ncmF5e2JhY2tncm91bmQtaW1hZ2U6dXJsKCcke3NlcEltZ3MubmV4dF9ncmF5fScpfWAgKwogICAgICAgICAgICAgICAgYC5hY19zcF9wcmVfZ3JheXtiYWNrZ3JvdW5kLWltYWdlOnVybCgnJHtzZXBJbWdzLnByZV9ncmF5fScpfWAsCiAgICAgICAgICAgICAgICAiQUMtUHJlbG9hZCIpCiAgICAgICAgICAgICAgaWYgKGN1clNpdGUucGFnZVVybCA9PT0gdXJsKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJbQUMtU2NyaXB0XSIsICLnv7vpobXliLDovr7lupXpg6jkuoYgLSDmiJbogIXlvILluLggLSDlh7rnjrDlvILluLjor7fnm7TmjqXlj43ppojkvZzogIXkv67mlLkiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9Ly8g5LiN5Lya6YeN5aSN5Yqg6L2955u45ZCM55qE6aG16Z2iCiAgICAgICAgICAgICAgY3VyU2l0ZS5wYWdlVXJsID0gdXJsOwogICAgICAgICAgICAgIC8vIOWvuXVybOeahOaVsOaNrui/m+ihjOivu+WPlgogICAgICAgICAgICAgIGN1clNpdGUucGFnZXIuc3RhcnRGaWx0ZXIgJiYgY3VyU2l0ZS5wYWdlci5zdGFydEZpbHRlcigpOwogICAgICAgICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0KHsKICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDUwMDAsCiAgICAgICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHZhciBuZXdCb2R5ID0gU2hvd1BhZ2VyLmNyZWF0ZURvY3VtZW50QnlTdHJpbmcocmVzcG9uc2UucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICAvLyB4eC5ldmFsdWF0ZSh4cGF0aCwgeHgpCiAgICAgICAgICAgICAgICAgICAgbGV0IHBhZ2VFbGVtcyA9IGdldEFsbEVsZW1lbnRzKGN1clNpdGUucGFnZXIucGFnZUVsZW1lbnQsIG5ld0JvZHksIG5ld0JvZHkpOwogICAgICAgICAgICAgICAgICAgIGxldCB0b0VsZW1lbnQgPSBnZXRBbGxFbGVtZW50cyhjdXJTaXRlLnBhZ2VyLkhUX2luc2VydFswXSlbMF07CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VFbGVtcy5sZW5ndGggPj0gMCkgewogICAgICAgICAgICAgICAgICAgICAgLy8g5aSE55CG5pyA5ZCO5LiA5Liq57+76aG15oyJ6ZKuCiAgICAgICAgICAgICAgICAgICAgICBsZXQgbmV4dEVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3NwLXNwLWdvbmV4dCIpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRFcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsYXN0RSA9IG5leHRFc1tuZXh0RXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RFLmNsYXNzTGlzdC5yZXBsYWNlKCJhY19zcF9uZXh0X2dyYXkiLCAiYWNfc3BfbmV4dCIpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgLy8g5o+S5YWl57+76aG15oyJ6ZKu5YWD57SgCiAgICAgICAgICAgICAgICAgICAgICBjdXJTaXRlLnBhZ2VOdW0rKzsKICAgICAgICAgICAgICAgICAgICAgIGxldCBhZGRUbyA9ICJiZWZvcmVlbmQiOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGN1clNpdGUucGFnZXIuSFRfaW5zZXJ0WzFdID09IDEpIGFkZFRvID0gImJlZm9yZWJlZ2luIjsKICAgICAgICAgICAgICAgICAgICAgIHRvRWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoYWRkVG8sIGA8ZGl2IGNsYXNzPSdzcC1zZXBhcmF0b3IgQUMnIGlkPSdzcC1zZXBhcmF0b3ItQUNYJz4KICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0nc3Atc3AtbmV4dGxpbmsnIHRhcmdldD0nX2JsYW5rJz48Yj7nrKwgPHNwYW4gc3R5bGU9J2NvbG9yOiM1OTU5NTkhaW1wb3J0YW50Oyc+QUNYPC9zcGFuPiDpobU8L2I+PC9hPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJzcC1zcC1nb3RvcCIgY2xhc3M9J2FjX3NwX3RvcCcgdGl0bGU9J+WOu+WIsOmhtumDqCc+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJzcC1zcC1nb3ByZSIgY2xhc3M9JyR7Y3VyU2l0ZS5wYWdlTnVtIDw9IDIgPyAiYWNfc3BfcHJlX2dyYXkiIDogImFjX3NwX3ByZSJ9JyB0aXRsZT0n5LiK5rua5LiA6aG1JyA+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJzcC1zcC1nb25leHQiIGNsYXNzPSdhY19zcF9uZXh0X2dyYXknIHRpdGxlPSfkuIvmu5rkuIDpobUnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3Atc3AtZ29ib3R0b20iIGNsYXNzPSdhY19zcF9ib3R0b20nIHRpdGxlPSfljrvliLDlupXpg6gnID48L3NwYW4+PC9kaXY+YAogICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL0FDWC9nbSwgY3VyU2l0ZS5wYWdlTnVtKSk7CiAgICAgICAgICAgICAgICAgICAgICAvLyDmj5LlhaXmlrDpobXpnaLlhYPntKAKICAgICAgICAgICAgICAgICAgICAgIHBhZ2VFbGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdG9FbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudChhZGRUbywgb25lKTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnNwLXNlcGFyYXRvci5BQzpub3QoW2JpbmRdKSIpLmZvckVhY2goZnVuY3Rpb24gKHBlcikgewogICAgICAgICAgICAgICAgICAgICAgICBwZXIuc2V0QXR0cmlidXRlKCJiaW5kIiwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBlci5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFjX3NwZnVuYyk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIC8vIOabv+aNouW+heabv+aNouWFg+e0oAogICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG9yaUUgPSBnZXRBbGxFbGVtZW50cyhjdXJTaXRlLnBhZ2VyLnJlcGxhY2VFKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlcEUgPSBnZXRBbGxFbGVtZW50cyhjdXJTaXRlLnBhZ2VyLnJlcGxhY2VFLCBuZXdCb2R5LCBuZXdCb2R5KTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9yaUUubGVuZ3RoID09PSByZXBFLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3JpRS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpRVtpXS5vdXRlckhUTUwgPSByZXBFW2ldLm91dGVySFRNTDsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgY3VyU2l0ZS5wYWdlTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9uZXJyb3I6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgY3VyU2l0ZS5wYWdlTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIEFkZEN1c3RvbVN0eWxlKCkgewogICAgICAgICAgaWYgKCFBQ0NvbmZpZy5pc1JpZ2h0RGlzcGxheUVuYWJsZSkgewogICAgICAgICAgICAvLyDnp7vpmaTlj7PovrnmoI8gLeazqOaEj+WcqCN3cmFwcGVyPiNjb24tYXQ+I3Jlc3VsdC1vcCB4cGF0aC1sb2fmnInml7blgJnlvojph43opoHvvIzkuI3og73pmpDol48KICAgICAgICAgICAgQUNfYWRkU3R5bGUoIiNjb250ZW50X3JpZ2h0e2Rpc3BsYXk6bm9uZSAhaW1wb3J0YW50O30jY29udGVudF9yaWdodCB0ZD5kaXY6bm90KFtpZF0pe2Rpc3BsYXk6bm9uZTt9I2NvbnRlbnRfcmlnaHQgLnJlc3VsdC1vcDpub3QoW2lkXSl7ZGlzcGxheTpub25lIWltcG9ydGFudDt9I3Joc3tkaXNwbGF5Om5vbmU7fSIsCiAgICAgICAgICAgICAgIkFDLVJpZ2h0UmVtb3ZlIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoQ09OU1QudXNlSXRlbS5BZHNTdHlsZU1vZGUgPT0gMikgewogICAgICAgICAgICAgIC8vIOmdnuWPjOWIl+aooeW8j+S4i+WwveWPr+iDveeahOaYvuekuuWPs+S+p+agjwogICAgICAgICAgICAgIEFDX2FkZFN0eWxlKCJAbWVkaWEgc2NyZWVuIGFuZCAobWluLXdpZHRoOiAxMjUwcHgpIHsjY29udGFpbmVye3dpZHRoOiA4MCUgIWltcG9ydGFudDt9LmNvbnRhaW5lcl9sICNjb250ZW50X3JpZ2h0e21hcmdpbi1yaWdodDogY2FsYygxOCUgLSAyMTBweCk7cG9zaXRpb246IGFic29sdXRlO3JpZ2h0OiAtMjAwcHg7ZGlzcGxheTpibG9jayAhaW1wb3J0YW50O292ZXJmbG93OmhpZGRlbjt3aWR0aDogMjJ2dyAhaW1wb3J0YW50O30iLAogICAgICAgICAgICAgICAgIkFDLVJpZ2h0UmVtb3ZlIik7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgIHNhZmVSZW1vdmUoInN0eWxlW2NsYXNzPSdBQy1SaWdodFJlbW92ZSddIikKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFBQ0NvbmZpZy5pc0FMaW5lRW5hYmxlKSB7CiAgICAgICAgICAgIEFDX2FkZFN0eWxlKCJhLGEgZW17dGV4dC1kZWNvcmF0aW9uOm5vbmV9IiwgIkFDLU5vTGluZSIsICJib2R5Iik7Ly8g56e76Zmk6L+Z5Lqb5Liq5LiL5YiS57q/CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoQUNDb25maWcuaXNVc2VyU3R5bGVFbmFibGUpIHsKICAgICAgICAgICAgQUNfYWRkU3R5bGUoQUNDb25maWcuVXNlclN0eWxlVGV4dCwgIkFDLXVzZXJTdHlsZSIpOy8vIOeUqOaIt+iHquWumuS5ieeahOagt+W8j+ihqAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g5Li65LqG5pa55L6/6LCD5pW05qC35byP5ZKM5p+l55yL5pWI5p6c77yM5pqC5pe25LiN56e76ZmkCiAgICAgICAgICAgIC8vIHNhZmVSZW1vdmUoInN0eWxlW2NsYXNzPSdBQy11c2VyU3R5bGUnXSIpCiAgICAgICAgICB9CiAgICAgICAgICBBQ19hZGRTdHlsZSgKICAgICAgICAgICAgIi5vcHItcmVjb21tZW5kcy1tZXJnZS1pbWd0ZXh0e2Rpc3BsYXk6bm9uZSFpbXBvcnRhbnQ7fSIgKyAvLyDnp7vpmaTnmb7luqbmtY/op4jlmajmjqjlub8KICAgICAgICAgICAgIi5yZXNfdG9wX2Jhbm5lcntkaXNwbGF5Om5vbmUhaW1wb3J0YW50O30iICsgLy8g56e76Zmk5Y+v6IO955qE55m+5bqmSFRUUFPliqvmjIHmmL7npLrpl67popgKICAgICAgICAgICAgIi5oZWFkQmxvY2ssIGJvZHk+ZGl2LnJlc3VsdC1vcHtkaXNwbGF5Om5vbmU7fSIgLy8g56e76Zmk55m+5bqm55qE5pCc57Si57uT5p6c6aG26YOo5LiA5p2h55qE5bu66K6u5paH5a2XICYg56e76Zmk5Y+v6IO95Ye6546w55qE55m95bGP546w6LGhCiAgICAgICAgICAgICwgIkFDLXNwZWNpYWwtQkFJRFUiCiAgICAgICAgICApOwogICAgICAgICAgLyoi6Ieq5a6a5LmJIuaMiemSruaViOaenCovCiAgICAgICAgICBBQ19hZGRTdHlsZSgiLmFjaGlkZXtkaXNwbGF5Om5vbmU7fSAubmV3RnVuY0hpZ2hMaWdodHtjb2xvcjpyZWQ7Zm9udC13ZWlnaHQ6IDEwMDtiYWNrZ3JvdW5kLWNvbG9yOiB5ZWxsb3c7Zm9udC13ZWlnaHQ6IDYwMDt9I3NwLWFjLWNvbnRhaW5lciBsYWJlbHtkaXNwbGF5OmlubGluZTt9I3V7d2lkdGg6MzE5cHh9I3UgI215dXNlcntkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW46IDEzcHggLTEwcHggMCAyNHB4O30uc2l0ZS13cmFwcGVyICNteXVzZXIsLnNvZ291LXNldC1ib3ggI215dXNlciwjZ2J3ICNteXVzZXJ7bWFyZ2luLXJpZ2h0OjE1cHg7fSAjbXl1c2VyLCNteXVzZXIgLm15dXNlcmNvbmZpZ3twYWRkaW5nOjA7bWFyZ2luOjB9I215dXNlcntkaXNwbGF5OmlubGluZS1ibG9jazt9I215dXNlciAubXl1c2VyY29uZmlne2Rpc3BsYXk6aW5saW5lLWJsb2NrO2xpbmUtaGVpZ2h0OjEuNTtiYWNrZ3JvdW5kOiM0ZTZlZjI7Y29sb3I6I2ZmZjtmb250LXdlaWdodDo3MDA7dGV4dC1hbGlnbjpjZW50ZXI7cGFkZGluZzo2cHg7Ym9yZGVyOjJweCBzb2xpZCAjRTVFNUU1O30jbXl1c2VyIC5teXVzZXJjb25maWd7Ym94LXNoYWRvdzowIDAgMTBweCAzcHggcmdiYSgwLDAsMCwuMSk7Ym9yZGVyLXJhZGl1czogNnB4fSNteXVzZXIgLm15dXNlcmNvbmZpZzpob3ZlcntiYWNrZ3JvdW5kOiM0NjYyZDkgIWltcG9ydGFudDtjb2xvcjojZmZmO2N1cnNvcjpwb2ludGVyO2JvcmRlcjoycHggc29saWQgIzczQTZGODt9Ym9keVtkb2dlXSAjaGVhZGVye21heC13aWR0aDogdW5zZXQ7fWJvZHlbZG9nZV0gI215dXNlcntwb3NpdGlvbjogYWJzb2x1dGU7cmlnaHQ6IDQwcHg7fSIsCiAgICAgICAgICAgICJBQy1NRU5VX0J0biIpOwogICAgICAgICAgLyroh6rlrprkuYnpobXpnaLlhoXlrrnmlYjmnpwqLwogICAgICAgICAgQUNfYWRkU3R5bGUoJ2JvZHlbYmFpZHVdICNzcC1hYy1jb250YWluZXIgLmNvbnRhaW5lci1sYWJlbDpub3QoW2NsYXNzKj0iYmFpZHUiXSk+bGFiZWw6bm90KFtjbGFzcz0ibGFiZWxfaGlkZSJdKSxcbicgKwogICAgICAgICAgICAnICBib2R5W2dvb2dsZV0gI3NwLWFjLWNvbnRhaW5lciAuY29udGFpbmVyLWxhYmVsOm5vdChbY2xhc3MqPSJnb29nbGUiXSk+bGFiZWw6bm90KFtjbGFzcz0ibGFiZWxfaGlkZSJdKSxcbicgKwogICAgICAgICAgICAnICBib2R5W2JpbmddICNzcC1hYy1jb250YWluZXIgLmNvbnRhaW5lci1sYWJlbDpub3QoW2NsYXNzKj0iYmluZyJdKT5sYWJlbDpub3QoW2NsYXNzPSJsYWJlbF9oaWRlIl0pLFxuJyArCiAgICAgICAgICAgICcgIGJvZHlbc29nb3VdICNzcC1hYy1jb250YWluZXIgLmNvbnRhaW5lci1sYWJlbDpub3QoW2NsYXNzKj0ic29nb3UiXSk+bGFiZWw6bm90KFtjbGFzcz0ibGFiZWxfaGlkZSJdKSxcbicgKwogICAgICAgICAgICAnICBib2R5W2R1Y2tdICNzcC1hYy1jb250YWluZXIgLmNvbnRhaW5lci1sYWJlbDpub3QoW2NsYXNzKj0iZHVjayJdKT5sYWJlbDpub3QoW2NsYXNzPSJsYWJlbF9oaWRlIl0pLFxuJyArCiAgICAgICAgICAgICcgIGJvZHlbZG9nZV0gI3NwLWFjLWNvbnRhaW5lciAuY29udGFpbmVyLWxhYmVsOm5vdChbY2xhc3MqPSJkb2dlIl0pPmxhYmVsOm5vdChbY2xhc3M9ImxhYmVsX2hpZGUiXSksXG4nICsKICAgICAgICAgICAgJyAgYm9keVtiYWlkdV0gI3NwLWFjLWNvbnRhaW5lciAuY29udGFpbmVyLWxhYmVsOm5vdChbY2xhc3MqPSJiYWlkdSJdKT5icixcbicgKwogICAgICAgICAgICAnICBib2R5W2dvb2dsZV0gI3NwLWFjLWNvbnRhaW5lciAuY29udGFpbmVyLWxhYmVsOm5vdChbY2xhc3MqPSJnb29nbGUiXSk+YnIsXG4nICsKICAgICAgICAgICAgJyAgYm9keVtiaW5nXSAjc3AtYWMtY29udGFpbmVyIC5jb250YWluZXItbGFiZWw6bm90KFtjbGFzcyo9ImJpbmciXSk+YnIsXG4nICsKICAgICAgICAgICAgJyAgYm9keVtkdWNrXSAjc3AtYWMtY29udGFpbmVyIC5jb250YWluZXItbGFiZWw6bm90KFtjbGFzcyo9ImR1Y2siXSk+YnIsXG4nICsKICAgICAgICAgICAgJyAgYm9keVtkb2dlXSAjc3AtYWMtY29udGFpbmVyIC5jb250YWluZXItbGFiZWw6bm90KFtjbGFzcyo9ImRvZ2UiXSk+YnIsXG4nICsKICAgICAgICAgICAgJyAgYm9keVtzb2dvdV0gI3NwLWFjLWNvbnRhaW5lciAuY29udGFpbmVyLWxhYmVsOm5vdChbY2xhc3MqPSJzb2dvdSJdKT5icixcbicgKwogICAgICAgICAgICAnICBib2R5W2JhaWR1XSAjc3AtYWMtY29udGFpbmVyIC5jb250YWluZXItbGFiZWxbY2xhc3MqPSJiYWlkdSJdPi5sYWJlbF9oaWRlLFxuJyArCiAgICAgICAgICAgICcgIGJvZHlbZ29vZ2xlXSAjc3AtYWMtY29udGFpbmVyIC5jb250YWluZXItbGFiZWxbY2xhc3MqPSJnb29nbGUiXT4ubGFiZWxfaGlkZSxcbicgKwogICAgICAgICAgICAnICBib2R5W2JpbmddICNzcC1hYy1jb250YWluZXIgLmNvbnRhaW5lci1sYWJlbFtjbGFzcyo9ImJpbmciXT4ubGFiZWxfaGlkZSxcbicgKwogICAgICAgICAgICAnICBib2R5W3NvZ291XSAjc3AtYWMtY29udGFpbmVyIC5jb250YWluZXItbGFiZWxbY2xhc3MqPSJzb2dvdSJdPi5sYWJlbF9oaWRlLFxuJyArCiAgICAgICAgICAgICcgIGJvZHlbZHVja10gI3NwLWFjLWNvbnRhaW5lciAuY29udGFpbmVyLWxhYmVsW2NsYXNzKj0iZHVjayJdPi5sYWJlbF9oaWRlLFxuJyArCiAgICAgICAgICAgICcgIGJvZHlbZG9nZV0gI3NwLWFjLWNvbnRhaW5lciAuY29udGFpbmVyLWxhYmVsW2NsYXNzKj0iZG9nZSJdPi5sYWJlbF9oaWRlXG4nICsgLy8g5rOo5oSP5bC+6YOo6YCX5Y+3CiAgICAgICAgICAgICd7JyArCiAgICAgICAgICAgICdkaXNwbGF5Om5vbmU7XG4nICsKICAgICAgICAgICAgJ30jc3AtYWMtY29udGFpbmVyIC5sYWJlbF9oaWRle2N1cnNvcjpwb2ludGVyO21hcmdpbi1sZWZ0OjglO2NvbG9yOmJsdWV9I3NwLWFjLWNvbnRhaW5lciAubGlua2hyZWYsI3NwLWFjLWNvbnRhaW5lciAubGFiZWxfaGlkZTpob3Zlcntjb2xvcjpyZWR9I3NwLWFjLWNvbnRhaW5lciAubGlua2hyZWY6aG92ZXJ7Zm9udC13ZWlnaHQ6Ym9sZH0jc3AtYWMtY29udGFpbmVyIGxhYmVsLm1lbnUtYm94LXNtYWxse21heC13aWR0aDoxNnB4O21heC1oZWlnaHQ6MTZweDtjdXJzb3I6cG9pbnRlcjtkaXNwbGF5OmlubGluZS1ibG9ja30uQUMtQ291bnRlclR7YmFja2dyb3VuZDojRkQ5OTk5fWJvZHkgICNzcC1hYy1jb250YWluZXJ7cG9zaXRpb246Zml4ZWQ7dG9wOjMuOXZ3O3JpZ2h0OjguOHZ3fSNzcC1hYy1jb250YWluZXJ7ei1pbmRleDo5OTk5OTk7dGV4dC1hbGlnbjpsZWZ0O2JhY2tncm91bmQtY29sb3I6d2hpdGV9I3NwLWFjLWNvbnRhaW5lciAqe2ZvbnQtc2l6ZToxM3B4O2NvbG9yOmJsYWNrO2Zsb2F0Om5vbmV9I3NwLWFjLW1haW4taGVhZHtwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6MDtsZWZ0OjB9I3NwLWFjLXNwYW4taW5mb3twb3NpdGlvbjphYnNvbHV0ZTtyaWdodDoxcHg7dG9wOjA7Zm9udC1zaXplOjEwcHg7bGluZS1oZWlnaHQ6MTBweDtiYWNrZ3JvdW5kOm5vbmU7Zm9udC1zdHlsZTppdGFsaWM7Y29sb3I6IzVhNWE1YTt0ZXh0LXNoYWRvdzp3aGl0ZSAwcHggMXB4IDFweH0jc3AtYWMtY29udGFpbmVyIGlucHV0e3ZlcnRpY2FsLWFsaWduOm1pZGRsZTtkaXNwbGF5OmlubGluZS1ibG9jaztvdXRsaW5lOm5vbmU7aGVpZ2h0OmF1dG87cGFkZGluZzowcHg7bWFyZ2luLWJvdHRvbTowcHg7bWFyZ2luLXRvcDowcHh9I3NwLWFjLWNvbnRhaW5lciBpbnB1dFt0eXBlPSJudW1iZXIiXXt3aWR0aDo1MHB4O3RleHQtYWxpZ246bGVmdH0jc3AtYWMtY29udGFpbmVyIGlucHV0W3R5cGU9ImNoZWNrYm94Il17Ym9yZGVyOjFweCBzb2xpZCAjQjRCNEI0O3BhZGRpbmc6MXB4O21hcmdpbjozcHg7d2lkdGg6MTNweDtoZWlnaHQ6MTNweDtiYWNrZ3JvdW5kOm5vbmU7Y3Vyc29yOnBvaW50ZXI7dmlzaWJpbGl0eTp2aXNpYmxlO3Bvc2l0aW9uOnN0YXRpY30jc3AtYWMtY29udGFpbmVyIGlucHV0W3R5cGU9ImJ1dHRvbiJde2JvcmRlcjoxcHggc29saWQgI2NjYztjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kOm5vbmU7d2lkdGg6YXV0bztoZWlnaHQ6YXV0b30jc3AtYWMtY29udGFpbmVyIGxpe2xpc3Qtc3R5bGU6bm9uZTttYXJnaW46M3B4IDA7Ym9yZGVyOm5vbmU7ZmxvYXQ6bm9uZTtjdXJzb3I6ZGVmYXVsdDt9I3NwLWFjLWNvbnRhaW5lciBmaWVsZHNldHtib3JkZXI6MnB4IGdyb292ZSAjY2NjOy1tb3otYm9yZGVyLXJhZGl1czozcHg7Ym9yZGVyLXJhZGl1czozcHg7cGFkZGluZzo0cHggOXB4IDZweCA5cHg7bWFyZ2luOjJweDtkaXNwbGF5OmJsb2NrO3dpZHRoOmF1dG87aGVpZ2h0OmF1dG99I3NwLWFjLWNvbnRhaW5lciBsZWdlbmR7bGluZS1oZWlnaHQ6MjBweDttYXJnaW4tYm90dG9tOjBweH0jc3AtYWMtY29udGFpbmVyIGZpZWxkc2V0ID4gdWx7cGFkZGluZzowO21hcmdpbjowfSNzcC1hYy1jb250YWluZXIgdWwjc3AtYWMtYV91c2VpZnJhbWUtZXh0ZW5ke3BhZGRpbmctbGVmdDo0MHB4fSNzcC1hYy1yZWN0e3Bvc2l0aW9uOnJlbGF0aXZlO3RvcDowO2xlZnQ6MDtmbG9hdDpyaWdodDtoZWlnaHQ6MTBweDt3aWR0aDoxMHB4O3BhZGRpbmc6MDttYXJnaW46MDstbW96LWJvcmRlci1yYWRpdXM6M3B4O2JvcmRlci1yYWRpdXM6M3B4O2JvcmRlcjoxcHggc29saWQgd2hpdGU7LXdlYmtpdC1ib3gtc2hhZG93Omluc2V0IDAgNXB4IDAgcmdiYSgyNTUsMjU1LDI1NSwwLjMpLDAgMCAzcHggcmdiYSgwLDAsMCwwLjgpOy1tb3otYm94LXNoYWRvdzppbnNldCAwIDVweCAwIHJnYmEoMjU1LDI1NSwyNTUsMC4zKSwwIDAgM3B4IHJnYmEoMCwwLDAsMC44KTtib3gtc2hhZG93Omluc2V0IDAgNXB4IDAgcmdiYSgyNTUsMjU1LDI1NSwwLjMpLDAgMCAzcHggcmdiYSgwLDAsMCwwLjgpO29wYWNpdHk6MC44fSNzcC1hYy1kb3QsI3NwLWFjLWN1ci1tb2Rle3Bvc2l0aW9uOmFic29sdXRlO3otaW5kZXg6OTk5OTt3aWR0aDo1cHg7aGVpZ2h0OjVweDtwYWRkaW5nOjA7LW1vei1ib3JkZXItcmFkaXVzOjNweDtib3JkZXItcmFkaXVzOjNweDtib3JkZXI6MXB4IHNvbGlkIHdoaXRlO29wYWNpdHk6MTstd2Via2l0LWJveC1zaGFkb3c6aW5zZXQgMCAtMnB4IDFweCByZ2JhKDAsMCwwLDAuMyksaW5zZXQgMCAycHggMXB4IHJnYmEoMjU1LDI1NSwyNTUsMC4zKSwwcHggMXB4IDJweCByZ2JhKDAsMCwwLDAuOSk7LW1vei1ib3gtc2hhZG93Omluc2V0IDAgLTJweCAxcHggcmdiYSgwLDAsMCwwLjMpLGluc2V0IDAgMnB4IDFweCByZ2JhKDI1NSwyNTUsMjU1LDAuMyksMHB4IDFweCAycHggcmdiYSgwLDAsMCwwLjkpO2JveC1zaGFkb3c6aW5zZXQgMCAtMnB4IDFweCByZ2JhKDAsMCwwLDAuMyksaW5zZXQgMCAycHggMXB4IHJnYmEoMjU1LDI1NSwyNTUsMC4zKSwwcHggMXB4IDJweCByZ2JhKDAsMCwwLDAuOSl9I3NwLWFjLWRvdHtyaWdodDotM3B4O3RvcDotM3B4fSNzcC1hYy1jdXItbW9kZXtsZWZ0Oi0zcHg7dG9wOi0zcHg7d2lkdGg6NnB4O2hlaWdodDo2cHh9I3NwLWFjLWNvbnRlbnR7cGFkZGluZzowO21hcmdpbjowcHg7LW1vei1ib3JkZXItcmFkaXVzOjNweDtib3JkZXItcmFkaXVzOjNweDtib3JkZXI6MXB4IHNvbGlkICNBMEEwQTA7LXdlYmtpdC1ib3gtc2hhZG93Oi0ycHggMnB4IDVweCByZ2JhKDAsMCwwLDAuMyk7LW1vei1ib3gtc2hhZG93Oi0ycHggMnB4IDVweCByZ2JhKDAsMCwwLDAuMyk7Ym94LXNoYWRvdzotMnB4IDJweCA1cHggcmdiYSgwLDAsMCwwLjMpfSNzcC1hYy1tYWlue3BhZGRpbmc6NXB4O2JvcmRlcjoxcHggc29saWQgd2hpdGU7LW1vei1ib3JkZXItcmFkaXVzOjNweDtib3JkZXItcmFkaXVzOjNweDtiYWNrZ3JvdW5kLWNvbG9yOiNGMkYyRjc7YmFja2dyb3VuZDotbW96LWxpbmVhci1ncmFkaWVudCh0b3AsI0ZDRkNGQywjRjJGMkY3IDEwMCUpO2JhY2tncm91bmQ6LXdlYmtpdC1ncmFkaWVudChsaW5lYXIsMCAwLDAgMTAwJSxmcm9tKCNGQ0ZDRkMpLHRvKCNGMkYyRjcpKX0jc3AtYWMtZm9vdHtwb3NpdGlvbjpyZWxhdGl2ZTtsZWZ0OjA7cmlnaHQ6MDttaW4taGVpZ2h0OjIwcHh9I3NwLWFjLXNhdmVidXR0b257cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7cmlnaHQ6MnB4fSNzcC1hYy1jb250YWluZXIgLmVuZGJ1dHRvbnttYXJnaW4tdG9wOjhweH0jc3AtYWMtY29udGFpbmVyIC5zcC1hYy1zcGFuYnV0dG9ue2JvcmRlcjoxcHggc29saWQgI2NjYzstbW96LWJvcmRlci1yYWRpdXM6M3B4O2JvcmRlci1yYWRpdXM6M3B4O3BhZGRpbmc6MnB4IDNweDtjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kLWNvbG9yOiNGOUY5Rjk7LXdlYmtpdC1ib3gtc2hhZG93Omluc2V0IDAgMTBweCA1cHggd2hpdGU7LW1vei1ib3gtc2hhZG93Omluc2V0IDAgMTBweCA1cHggd2hpdGU7Ym94LXNoYWRvdzppbnNldCAwIDEwcHggNXB4IHdoaXRlfSNzcC1hYy1jb250YWluZXIgLnNwLWFjLXNwYW5idXR0b246aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojREREfWxhYmVsW2NsYXNzPSJuZXdGdW5jIl17Y29sb3I6Ymx1ZX0nLAogICAgICAgICAgICAiQUMtTUVOVV9QYWdlIik7CiAgICAgICAgfQoKICAgICAgICBBZGRDdXN0b21TdHlsZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICBHTV9yZWdpc3Rlck1lbnVDb21tYW5kKCdBQy3ph43lrprlkJHohJrmnKzorr7nva4nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzcC1hYy1jb250ZW50Iikuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgfQoKICAgICAgICAvKirov5nkuJzopb/ku6XlkI7kvJrnlKjkuIoqKi8KICAgICAgICBmdW5jdGlvbiBnZXRTZWFyY2hWYWx1ZSgpIHsKICAgICAgICAgIGxldCBrdmwgPSBsb2NhdGlvbi5zZWFyY2guc3Vic3RyKDEpLnNwbGl0KCImIik7CiAgICAgICAgICBsZXQgc2VhcmNoViA9ICIiOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrdmwubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbGV0IHZhbHVlID0ga3ZsW2ldLnJlcGxhY2UoL14od2R8cXVlcnl8cSk9LywgIiIpOwogICAgICAgICAgICBpZiAodmFsdWUgIT09IGt2bFtpXSkgewogICAgICAgICAgICAgIHNlYXJjaFYgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gICcrJyDnmb7luqbjgIHmkJzni5fjgIHlv4XlupTjgIHosLfmrYzjgIHlpb3mkJwKICAgICAgICAgIHNlYXJjaFYgPSBzZWFyY2hWLnJlcGxhY2UoIisiLCAiICIpOwogICAgICAgICAgcmV0dXJuIHNlYXJjaFY7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByYXBpZERlYWwoKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoaW5zZXJ0TG9ja2VkID09PSBmYWxzZSAmJiBjdXJTaXRlLlNpdGVUeXBlSUQgIT09IFNpdGVUeXBlLk9USEVSUykgewogICAgICAgICAgICAgIGluc2VydExvY2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgQUNIYW5kbGUoKTsgLy8g5aSE55CG5Li76YeN5a6a5ZCRCiAgICAgICAgICAgICAgaWYgKEFDQ29uZmlnLmlzRmF2aWNvbkVuYWJsZSkgeyAvLyDmmL7npLpmYXZpY29u5Zu+5qCHCiAgICAgICAgICAgICAgICBBQ19hZGRTdHlsZSgiaDM6OmJlZm9yZSwgaDI6OmJlZm9yZSB7Y29udGVudDogJyAnO2Rpc3BsYXk6aW5saW5lLWJsb2NrfSIsICJBQy1TdHlsZS1GYXZpY29uIiwgImhlYWQiKTsKICAgICAgICAgICAgICAgIGFkZEZhdmljb24oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjdXJTaXRlLkZhdmljb25UeXBlKSk7IC8vIOa3u+WKoEZhdmljb27mmL7npLoKICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIHNhZmVSZW1vdmUoImltZy5BQy1mYXZpY29uVCIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjdXJTaXRlLkZhdmljb25UeXBlKS5mb3JFYWNoKChvbmUpID0+IHsKICAgICAgICAgICAgICAgICAgb25lLnJlbW92ZUF0dHJpYnV0ZSgiYWNfZmF2aWNvbnN0YXR1cyIpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKEFDQ29uZmlnLmlzQWRzRW5hYmxlKSB7IC8vIOenu+mZpOWkmuS9meeahOW5v+WRiuWGheWuuQogICAgICAgICAgICAgICAgcmVtb3ZlQURfYmFpZHVfc29nb3UoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKEFDQ29uZmlnLmlzQ291bnRlckVuYWJsZSkgeyAvLyDmmL7npLrorqHmlbDlmagKICAgICAgICAgICAgICAgIGFkZENvdW50ZXIoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjdXJTaXRlLkNvdW50ZXJUeXBlKSk7CiAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuQUMtQ291bnRlclQiKS5mb3JFYWNoKG9uZSA9PiB7CiAgICAgICAgICAgICAgICAgIG9uZS5wYXJlbnRFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnU29ydEluZGV4Jyk7CiAgICAgICAgICAgICAgICAgIG9uZS5yZW1vdmUoKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKEFDQ29uZmlnLmRvRGlzYWJsZVN1ZykgeyAvLyDkuI3lkK/nlKjnp7vliqjpooTmtYtb6buY6K6kXQogICAgICAgICAgICAgICAgYWNTZXRDb29raWUoIk9SSUdJTiIsIDIsICJ3d3cuYmFpZHUuY29tIik7CiAgICAgICAgICAgICAgICBhY1NldENvb2tpZSgiSVNTVyIsIDEpOwogICAgICAgICAgICAgICAgYWNTZXRDb29raWUoIklTU1ciLCAxLCAid3d3LmJhaWR1LmNvbSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoQUNDb25maWcuaXNCbG9ja0VuYWJsZSAmJiBjdXJTaXRlLlNpdGVUeXBlSUQgIT09IFNpdGVUeXBlLlNPR09VKSB7IC8vIOWQr+eUqOWxj+iUveWKn+iDvS0g5a+55q+P5LiA5Liq5paw5aKe55qE5Zyw5Z2A6YO96KaB5aSE55CGCiAgICAgICAgICAgICAgICBTaXRlQmxvY2suaW5pdFN0eWxlKCk7CiAgICAgICAgICAgICAgICBTaXRlQmxvY2suaW5pdCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGluc2VydExvY2tlZCA9IGZhbHNlOwogICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhY1NldENvb2tpZShjbmFtZSwgY3ZhbHVlLCBkb21haW4sIGV4ZGF5cykgewogICAgICAgICAgZXhkYXlzID0gZXhkYXlzIHx8IDMwOwogICAgICAgICAgbGV0IGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgZG9tYWluID0gKGRvbWFpbiA/ICJkb21haW49IiArIGRvbWFpbiA6ICIiKSArICI7IjsKICAgICAgICAgIGQuc2V0VGltZShkLmdldFRpbWUoKSArIChleGRheXMgKiAyNCAqIDYwICogNjAgKiAxMDAwKSk7CiAgICAgICAgICBsZXQgZXhwaXJlcyA9ICJleHBpcmVzPSIgKyBkLnRvVVRDU3RyaW5nKCk7CiAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBjbmFtZSArICI9IiArIGN2YWx1ZSArICI7ICIgKyBkb21haW4gKyBleHBpcmVzICsgIjtwYXRoPS8iOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXROb2RlSG9zdChzaXRldHBOb2RlKSB7CiAgICAgICAgICBpZihzaXRldHBOb2RlIGluc3RhbmNlb2YgSFRNTEFuY2hvckVsZW1lbnQpewogICAgICAgICAgICByZXR1cm4ge2N1ckhvc3Q6IHNpdGV0cE5vZGUuaG9zdCwgY3VyVXJsOiBzaXRldHBOb2RlLmhyZWZ9OwogICAgICAgICAgfQogICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuQkFJRFUpIHsKICAgICAgICAgICAgdmFyIGhyZWYgPSBudWxsOwogICAgICAgICAgICBpZiAoc2l0ZXRwTm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7CiAgICAgICAgICAgICAgaHJlZiA9IHNpdGV0cE5vZGUuZ2V0QXR0cmlidXRlKCJocmVmIikKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaHJlZiAhPSBudWxsICYmIGhyZWYuaW5jbHVkZXMoImJhaWR1LmNvbS9saW5rIikpIHsKICAgICAgICAgICAgICAvLyDlt7Lnu4/op6PmnpDlh7rmnaXkuoYKICAgICAgICAgICAgICByZXR1cm4gIHtjdXJIb3N0OiBnZXRUZXh0SG9zdChocmVmKSwgY3VyVXJsOiBocmVmfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHtjdXJIb3N0OiBnZXRUZXh0SG9zdChzaXRldHBOb2RlLmlubmVyVGV4dCB8fCBzaXRldHBOb2RlLnRleHRDb250ZW50KSwgY3VyVXJsOiBudWxsfTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEFDSGFuZGxlKCkgewogICAgICAgICAgLy8g5aSE55CG5Li76YeN5a6a5ZCRCiAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5PVEhFUlMgfHwgY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5TT0dPVSkgcmV0dXJuOwogICAgICAgICAgaWYgKEFDQ29uZmlnLmlzUmVkaXJlY3RFbmFibGUpIHsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU3R5cGVfTm9ybWFsICE9PSBudWxsICYmIGN1clNpdGUuU3R5cGVfTm9ybWFsICE9PSAiIikgewogICAgICAgICAgICAgIC8vIOeZvuW6puaQnOeLl+WOu+mHjeWumuWQkS3mma7pgJrmqKHlvI/jgJDms6jmhI/kuI3og73kuLpkb2N1bWVudC5xdWVyeS4u44CRCiAgICAgICAgICAgICAgcmVzZXRVUkxOb3JtYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjdXJTaXRlLlN0eXBlX05vcm1hbCkpOwogICAgICAgICAgICAgIGlmIChjaGVja0lTQmFpZHVNYWluKCkpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5zX2Zvcm0gLmluZGV4LWxvZ28tc3JjW3NyYyo9J2dpZiddLCAuc19mb3JtIC5pbmRleC1sb2dvLXNyY25ld1tzcmMqPSdnaWYnXSIpLmZvckVhY2goZnVuY3Rpb24gKHBlcikgewogICAgICAgICAgICAgICAgICBwZXIuc3JjID0gImh0dHBzOi8vcGljLnJtYi5iZHN0YXRpYy5jb20vYzg2MjU1ZTgwMjg2OTYxMzlkM2UzZTRiYjQ0YzA0N2IucG5nIjsKICAgICAgICAgICAgICAgICAgLy8g56We5aWH55qE55m+5bqm55m+5a625Y+3CiAgICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vaW1nc2EuYmFpZHUuY29tL2ZleC9waWMvaXRlbS84NzE4MzY3YWRhYjQ0YWVkY2M5MWFiMmJiZTFjODcwMWEwOGJmYjI2LmpwZwogICAgICAgICAgICAgICAgICAvLyBodHRwczovL2JhaWR1Lm50YW93LmNvbS9uZXdjc3MvYmFpZHUucG5nCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuR09PR0xFKSByZW1vdmVPbk1vdXNlRG93bkZ1bmMoKTsgLy8g56e76Zmkb25Nb3VzZURvd27kuovku7bvvIzosLfmrYzljrvph43lrprlkJEKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuTUJBSURVKSByZW1vdmVNb2JpbGVCYWlkdURpcmVjdExpbmsoKTsgLy8g5aSE55CG55m+5bqm5omL5py654mI5pys55qE6YeN5a6a5ZCR5Zyw5Z2ACiAgICAgICAgICAgIHJlbW92ZVJlZGlyZWN0TGlua1RhcmdldCgpOyAvLyDlj6rnp7vpmaTnn6XkuY7nmoTph43lrprlkJHpl67popggJiDnmb7luqblrabmnK/ph43lrprlkJHpl67popgKICAgICAgICAgICAgc2FmZVJlbW92ZSgiLnJlc190b3BfYmFubmVyIik7IC8vIOenu+mZpOeZvuW6puWPr+iDveaYvuekuueahOWKq+aMgQogICAgICAgICAgfQoKICAgICAgICAgIHRyeSB7IC8vIOaUvuWFpeW8guW4uOaNleiOt++8jOmYsuatoueUseS6jmh0bWzmj5LlhaXov4fmhaLlr7zoh7TnmoRqc+e7iOatogogICAgICAgICAgICBpZiAoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzcC1hYy1zdHlsZSIpLmNoZWNrZWQpIHsKICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJpbnB1dFtuYW1lKj0nc3AtYWMtYV9mb3JjZV9zdHlsZV8nXSIpLmZvckVhY2gocGVyID0+IHsKICAgICAgICAgICAgICAgIHBlci5zZXRBdHRyaWJ1dGUoImRpc2FibGVkIiwgImRpc2FibGVkIik7CiAgICAgICAgICAgICAgICBwZXIucGFyZW50Tm9kZS5zZXRBdHRyaWJ1dGUoInRpdGxlIiwgIuivt+W8gOWQr+iHquWumuS5ieagt+W8jyIpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiaW5wdXRbbmFtZSo9J3NwLWFjLWFfZm9yY2Vfc3R5bGVfJ10iKS5mb3JFYWNoKHBlciA9PiB7CiAgICAgICAgICAgICAgICBwZXIucmVtb3ZlQXR0cmlidXRlKCJkaXNhYmxlZCIpOwogICAgICAgICAgICAgICAgcGVyLnBhcmVudE5vZGUuc2V0QXR0cmlidXRlKCJ0aXRsZSIsICJBQy3oh6rlrprkuYnmoLflvI/lhoXlrrkiKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NwLWFjLWJsb2NrIikuY2hlY2tlZCkgewogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIiNzcC1hYy1yZW1vdmVCbG9jaywgI3NwLWFjLWJsb2NrQnRuRGlzcGxheSIpLmZvckVhY2gocGVyID0+IHsKICAgICAgICAgICAgICAgIHBlci5zZXRBdHRyaWJ1dGUoImRpc2FibGVkIiwgImRpc2FibGVkIik7CiAgICAgICAgICAgICAgICBwZXIucGFyZW50Tm9kZS5zZXRBdHRyaWJ1dGUoInRpdGxlIiwgIuivt+W8gOWQr+iHquWumuS5ieagt+W8jyIpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3NwLWFjLXJlbW92ZUJsb2NrLCAjc3AtYWMtYmxvY2tCdG5EaXNwbGF5IikuZm9yRWFjaChwZXIgPT4gewogICAgICAgICAgICAgICAgcGVyLnJlbW92ZUF0dHJpYnV0ZSgiZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgIHBlci5wYXJlbnROb2RlLnNldEF0dHJpYnV0ZSgidGl0bGUiLCAiQUMt6Ieq5Li75oum5oiq5Yqf6IO9IikKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gQUN0b2dnbGVTZXR0aW5nRGlzcGxheShlKSB7CiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgLy8g5pi+56S677yf6ZqQ6JeP6K6+572u55WM6Z2iCiAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmlmcmFtZS1mYXRoZXIgaWZyYW1lIikgPT0gbnVsbCkgewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuaWZyYW1lLWZhdGhlciIpLmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlZW5kIiwgIjxpZnJhbWUgc3JjPSdodHRwczovL2doYnRucy5jb20vZ2l0aHViLWJ0bi5odG1sP3VzZXI9bGFuZ3JlbjEzNTMmcmVwbz1HTV9zY3JpcHQmdHlwZT1zdGFyJmNvdW50PXRydWUnIGZyYW1lYm9yZGVyPScwJyBzY3JvbGxpbmc9JzAnIHN0eWxlPSdoZWlnaHQ6IDIwcHg7bWF4LXdpZHRoOiAxMDhweDtwYWRkaW5nLWxlZnQ6NXB4O2JveC1zaXppbmc6IGJvcmRlci1ib3g7bWFyZ2luLWJvdHRvbTogLTVweDtkaXNwbGF5OnVuc2V0ICFpbXBvcnRhbnQ7Jz48L2lmcmFtZT4iKTsKICAgICAgICAgIH0KICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NwLWFjLWNvbnRlbnQiKS5zdHlsZS5kaXNwbGF5ID09PSAnYmxvY2snKSB7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NwLWFjLWNvbnRlbnQiKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIERCQ29uZmlnLm9sZFZlcnNpb24gPSBBQ0NvbmZpZy5vbGRWZXJzaW9uID0gR01faW5mby5zY3JpcHQudmVyc2lvbjsgLy8g5Y+q6ZyA6KaB5YaZ5Ye65LiA6YOo5YiG55qE5YWz6ZSu5pWw5o2u5Y2z5Y+vCiAgICAgICAgICAgICAgR01fc2V0VmFsdWUoIkNvbmZpZyIsIEpTT04uc3RyaW5naWZ5KERCQ29uZmlnKSk7CiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmFjLW5ld3ZlcnNpb25EaXNwbGF5Iikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc3AtYWMtY29udGVudCIpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gU2hvd1NldHRpbmcoKSB7CiAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5PVEhFUlMpIHJldHVybjsKICAgICAgICAgIC8vIOWmguaenOS4jeWtmOWcqOeahOivne+8jOmCo+S5iOiHquW3seWIm+W7uuS4gOS4qi1jb3B5IGZyb20gc3VwZXJQcmVsb2FkCiAgICAgICAgICBpZiAoZG9jdW1lbnQuYm9keSAhPT0gbnVsbCAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc3AtYWMtY29udGFpbmVyIikgPT09IG51bGwpIHsKICAgICAgICAgICAgbGV0IENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICBDb250YWluZXIuaWQgPSAic3AtYWMtY29udGFpbmVyIjsKICAgICAgICAgICAgQ29udGFpbmVyLmlubmVySFRNTCA9CiAgICAgICAgICAgICAgYDxkaXYgaWQ9InNwLWFjLWNvbnRlbnQiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJzcC1hYy1tYWluIj4KICAgICAgICAgICAgICAgICAgPGZpZWxkc2V0IGlkPSJzcC1hYy1hdXRvcGFnZXItZmllbGQiIHN0eWxlPSJkaXNwbGF5OmJsb2NrOyI+CiAgICAgICAgICAgICAgICAgICAgPGxlZ2VuZCBjbGFzcz0iaWZyYW1lLWZhdGhlciI+CiAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImxpbmtocmVmIiBocmVmPSJodHRwczovL3d3dy5udGFvdy5jb20vYWJvdXRzY3JpcHQuaHRtbCIgdGFyZ2V0PSJfYmxhbmsiIHYtdGV4dD0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5wYW5lbF90aXRsZSI+PC9hPgogICAgICAgICAgICAgICAgICAgIDwvbGVnZW5kPgogICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ic2V0dGluZy1tYWluIiB2LXNob3c9IiFvdGhlci5zaG93U2Vjb25kUGFuZWwiPgogICAgICAgICAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgOnRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwucmVkaXJlY3RfdGl0bGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3AtYWMtcmVkaXJlY3QiIG5hbWU9InNwLWFjLWFfc2VwYXJhdG9yIiB0eXBlPSJjaGVja2JveCIgIHYtbW9kZWw9IkFDQ29uZmlnLmlzUmVkaXJlY3RFbmFibGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5yZWRpcmVjdF90ZXh0IH19CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InNwLWFjLWlzRW5MYW5nIiBuYW1lPSJzcC1hYy1hX2ZvcmNlIiB0eXBlPSJjaGVja2JveCIgdi1tb2RlbD0iQUNDb25maWcuaXNFbkxhbmciPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VFbl90ZXh0IH19CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgOnRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuYWRzX3RpdGxlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InNwLWFjLWFkcyIgbmFtZT0ic3AtYWMtYV9mb3JjZSIgdHlwZT0iY2hlY2tib3giIHYtbW9kZWw9IkFDQ29uZmlnLmlzQWRzRW5hYmxlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuYWRzX3RleHQgfX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmF1dG9wYWdlX3RpdGxlIiBjbGFzcz0iIj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InNwLWFjLWlzQXV0b3BhZ2UiIG5hbWU9InNwLWFjLWFfZm9yY2UiIHR5cGU9ImNoZWNrYm94IiB2LW1vZGVsPSJBQ0NvbmZpZy5pc0F1dG9wYWdlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuYXV0b3BhZ2VfdGV4dCB9fQogICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIHRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuYmxvY2tlbmFibGVfdGl0bGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3AtYWMtYmxvY2siIG5hbWU9InNwLWFjLWFfZm9yY2UiIHR5cGU9ImNoZWNrYm94IiB2LW1vZGVsPSJBQ0NvbmZpZy5pc0Jsb2NrRW5hYmxlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuYmxvY2tlbmFibGVfdGV4dCB9fQogICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3AtYWMtYmxvY2tkaXlidXR0b24iIGNsYXNzPSJzcC1hYy1zcGFuYnV0dG9uIiBAY2xpY2s9Im90aGVyLnNob3dTZWNvbmRQYW5lbCA9IHRydWUiIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmJsb2NrRGl5QnRuX3RpdGxlIiBzdHlsZT0ibWFyZ2luLWxlZnQ6IDVweDtjb2xvcjogIzg4ODg4ODsiIHYtdGV4dD0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmJsb2NrRGl5QnRuX3RleHQiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmJsb2NrZW5hYmxlX3RleHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCA6dGl0bGU9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5ibG9ja0F1dG9SZW1vdmVfdGl0bGUiIHYtbW9kZWw9IkFDQ29uZmlnLmlzQmxvY2tEaXNwbGF5IiBpZD0ic3AtYWMtcmVtb3ZlQmxvY2siIHR5cGU9ImNoZWNrYm94Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuYmxvY2tBdXRvUmVtb3ZlX3RleHQgfX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmJsb2NrQnRuU2hvd190aXRsZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmJsb2NrQnRuU2hvd190aXRsZSIgIHYtbW9kZWw9IkFDQ29uZmlnLmlzQmxvY2tCdG5Ob3REaXNwbGF5IiBpZD0ic3AtYWMtYmxvY2tCdG5EaXNwbGF5IiB0eXBlPSJjaGVja2JveCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmJsb2NrQnRuU2hvd190ZXh0IH19CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgOnRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX3RleHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3AtYWMtc3R5bGUiIG5hbWU9InNwLWFjLWFfZm9yY2UiIHR5cGU9ImNoZWNrYm94IiB2LW1vZGVsPSJBQ0NvbmZpZy5BZHNTdHlsZUVuYWJsZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV90ZXh0IH19CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgICAgICAgICA8IS0tLS0tLS0tLS0tLeeZvuW6puagt+W8jy0tLS0tLS0tLS0tLS0tPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImNvbnRhaW5lci1sYWJlbCBiYWlkdSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbF9oaWRlIiB2LXRleHQ9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfYmFpZHVfbGFibGUiIEBjbGljaz0ibGFiZWxTaG93SGlkZUVudiI+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1sZWZ0OjIwcHgiPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2JhaWR1IiB2YWx1ZT0iMCIgdi1tb2RlbD0iQUNDb25maWcuYmFpZHUuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9iYWlkdV9vcmlnaW4gfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgIG5hbWU9J3NwLWFjLWh1eWFuX3N0eWxlX2JhaWR1JyB0eXBlPSdjaGVja2JveCcgdi1tb2RlbD0iQUNDb25maWcuYmFpZHUuSHVZYW5Nb2RlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2JhaWR1X2h1eWFuIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9IiI+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmFpZHVsaXRlIiB0eXBlPSJjaGVja2JveCIgdi1tb2RlbD0iQUNDb25maWcuU3R5bGVfQmFpZHVMaXRlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2JhaWR1X2JhaWR1TGl0ZSB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLWxlZnQ6MjBweCI+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmFpZHUiIHZhbHVlPSIxIiB2LW1vZGVsPSJBQ0NvbmZpZy5iYWlkdS5BZHNTdHlsZU1vZGUiIHR5cGU9InJhZGlvIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2JhaWR1XzFsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmFpZHUiIHZhbHVlPSIyIiB0eXBlPSJyYWRpbyIgdi1tb2RlbD0iQUNDb25maWcuYmFpZHUuQWRzU3R5bGVNb2RlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2JhaWR1XzFsaW5lX2VudGVyIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmFpZHUiIHZhbHVlPSIzIiB0eXBlPSJyYWRpbyIgdi1tb2RlbD0iQUNDb25maWcuYmFpZHUuQWRzU3R5bGVNb2RlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2JhaWR1XzJsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmFpZHUiIHZhbHVlPSI0IiB0eXBlPSJyYWRpbyIgdi1tb2RlbD0iQUNDb25maWcuYmFpZHUuQWRzU3R5bGVNb2RlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2JhaWR1XzNsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmFpZHUiIHZhbHVlPSI1IiB0eXBlPSJyYWRpbyIgdi1tb2RlbD0iQUNDb25maWcuYmFpZHUuQWRzU3R5bGVNb2RlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2JhaWR1XzRsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0tLS0tLS0tLS0t55m+5bqm5qC35byPLS0tLS0tLS0tLS0tLS0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDogMXB4O3dpZHRoOjI2N3B4O21hcmdpbi1sZWZ0OjI1cHg7YmFja2dyb3VuZC1jb2xvcjojZDhkOGQ4O21hcmdpbi10b3A6MXB4OyI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwhLS0tLS0tLS0tLS0t6LC35q2M5qC35byPLS0tLS0tLS0tLS0tLS0+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iY29udGFpbmVyLWxhYmVsIGdvb2dsZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbF9oaWRlIiB2LXRleHQ9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZ29vZ2xlX2xhYmxlIiBAY2xpY2s9ImxhYmVsU2hvd0hpZGVFbnYiPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJtYXJnaW4tbGVmdDoyMHB4Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgbmFtZT0ic3AtYWMtYV9mb3JjZV9zdHlsZV9nb29nbGUiIHZhbHVlPSIwIiB0eXBlPSJyYWRpbyIgdi1tb2RlbD0iQUNDb25maWcuZ29vZ2xlLkFkc1N0eWxlTW9kZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9nb29nbGVfb3JpZ2luIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgOnRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2dvb2dsZV9odXlhbiI+PGlucHV0IG5hbWU9InNwLWFjLWh1eWFuX3N0eWxlX2dvb2dsZSIgdi1tb2RlbD0iQUNDb25maWcuZ29vZ2xlLkh1WWFuTW9kZSIgdHlwZT0iY2hlY2tib3giPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZ29vZ2xlX2h1eWFuIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgOnRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2dvb2dsZV9nb29nbGVMaXRlIiBzdHlsZT0iIj48aW5wdXQgbmFtZT0ic3AtYWMtZ29vZ2xlX2luX2JhaWR1bW9kZSIgdi1tb2RlbD0iQUNDb25maWcuaXNHb29sZUluQmFpZHVNb2RlRW5hYmxlIiB0eXBlPSJjaGVja2JveCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9nb29nbGVfZ29vZ2xlTGl0ZSB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLWxlZnQ6MjBweCI+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfZ29vZ2xlIiB2YWx1ZT0iMSIgdi1tb2RlbD0iQUNDb25maWcuZ29vZ2xlLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZ29vZ2xlXzFsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfZ29vZ2xlIiB2YWx1ZT0iMiIgdi1tb2RlbD0iQUNDb25maWcuZ29vZ2xlLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iIGNoZWNrZWQ9IiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9nb29nbGVfMWxpbmVfZW50ZXIgfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgbmFtZT0ic3AtYWMtYV9mb3JjZV9zdHlsZV9nb29nbGUiIHZhbHVlPSIzIiB2LW1vZGVsPSJBQ0NvbmZpZy5nb29nbGUuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9nb29nbGVfMmxpbmUgfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgbmFtZT0ic3AtYWMtYV9mb3JjZV9zdHlsZV9nb29nbGUiIHZhbHVlPSI0IiB2LW1vZGVsPSJBQ0NvbmZpZy5nb29nbGUuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9nb29nbGVfM2xpbmUgfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD48aW5wdXQgbmFtZT0ic3AtYWMtYV9mb3JjZV9zdHlsZV9nb29nbGUiIHZhbHVlPSI1IiB2LW1vZGVsPSJBQ0NvbmZpZy5nb29nbGUuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9nb29nbGVfNGxpbmUgfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxicj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3osLfmrYzmoLflvI8tLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iaGVpZ2h0OiAxcHg7d2lkdGg6MjY3cHg7bWFyZ2luLWxlZnQ6MjVweDtiYWNrZ3JvdW5kLWNvbG9yOiNkOGQ4ZDg7bWFyZ2luLXRvcDoxcHg7Ij48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3lv4XlupTmoLflvI8tLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJjb250YWluZXItbGFiZWwgYmluZyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbF9oaWRlIiB2LXRleHQ9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfYmluZ19sYWJsZSIgQGNsaWNrPSJsYWJlbFNob3dIaWRlRW52Ij48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLWxlZnQ6MjBweCI+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmluZyIgdi1tb2RlbD0iQUNDb25maWcuYmluZy5BZHNTdHlsZU1vZGUiIHZhbHVlPSIwIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9iaW5nX29yaWdpbiB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9iaW5nX2h1eWFuIj48aW5wdXQgbmFtZT0ic3AtYWMtaHV5YW5fc3R5bGVfYmluZyIgdi1tb2RlbD0iQUNDb25maWcuYmluZy5IdVlhbk1vZGUiIHR5cGU9ImNoZWNrYm94Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2JpbmdfaHV5YW4gfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxicj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1sZWZ0OjIwcHgiPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2JpbmciIHYtbW9kZWw9IkFDQ29uZmlnLmJpbmcuQWRzU3R5bGVNb2RlIiB2YWx1ZT0iMSIgdHlwZT0icmFkaW8iPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfYmluZ18xbGluZSB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2JpbmciIHZhbHVlPSIyIiB2LW1vZGVsPSJBQ0NvbmZpZy5iaW5nLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfYmluZ18xbGluZV9lbnRlciB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2JpbmciIHZhbHVlPSIzIiB2LW1vZGVsPSJBQ0NvbmZpZy5iaW5nLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iIGNoZWNrZWQ9IiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9iaW5nXzJsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmluZyIgdmFsdWU9IjQiIHYtbW9kZWw9IkFDQ29uZmlnLmJpbmcuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9iaW5nXzNsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfYmluZyIgdmFsdWU9IjUiIHYtbW9kZWw9IkFDQ29uZmlnLmJpbmcuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9iaW5nXzRsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3lv4XlupTmoLflvI8tLS0tLS0tLS0tLS0tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImhlaWdodDogMXB4O3dpZHRoOjI2N3B4O21hcmdpbi1sZWZ0OjI1cHg7YmFja2dyb3VuZC1jb2xvcjojZDhkOGQ4O21hcmdpbi10b3A6MXB4OyI+PC9kaXY+LS0+CjwhLS0gICAgICAgICAgICAgICAgICAgICAgICAmbHQ7ISZuZGFzaDsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1O+aQnOeLl+agt+W8jyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyZuZGFzaDsmZ3Q7LS0+CjwhLS0gICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImNvbnRhaW5lci1sYWJlbCBzb2dvdSI+LS0+CjwhLS0gICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ibGFiZWxfaGlkZSIgdi10ZXh0PSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX3NvZ291X2xhYmxlIiBAY2xpY2s9ImxhYmVsU2hvd0hpZGVFbnYiPjwvbGFiZWw+LS0+CjwhLS0gICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLWxlZnQ6MjBweCI+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfc29nb3UiIHYtbW9kZWw9IkFDQ29uZmlnLnNvZ291LkFkc1N0eWxlTW9kZSIgdmFsdWU9IjAiIHR5cGU9InJhZGlvIj4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9zb2dvdV9vcmlnaW4gfX0tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9zb2dvdV9odXlhbiI+PGlucHV0IG5hbWU9InNwLWFjLWh1eWFuX3N0eWxlX3NvZ291IiB2LW1vZGVsPSJBQ0NvbmZpZy5zb2dvdS5IdVlhbk1vZGUiIHR5cGU9ImNoZWNrYm94Ij4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9zb2dvdV9odXlhbiB9fS0tPgo8IS0tICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPi0tPgo8IS0tICAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+LS0+CjwhLS0gICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLWxlZnQ6MjBweCI+LS0+CjwhLS0gICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX3NvZ291IiB2YWx1ZT0iMSIgdi1tb2RlbD0iQUNDb25maWcuc29nb3UuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+LS0+CjwhLS0gICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfc29nb3VfMWxpbmUgfX0tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX3NvZ291IiB2YWx1ZT0iMiIgdi1tb2RlbD0iQUNDb25maWcuc29nb3UuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+LS0+CjwhLS0gICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfc29nb3VfMWxpbmVfZW50ZXIgfX0tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX3NvZ291IiB2YWx1ZT0iMyIgdi1tb2RlbD0iQUNDb25maWcuc29nb3UuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyIgY2hlY2tlZD0iIj4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9zb2dvdV8ybGluZSB9fS0tPgo8IS0tICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPi0tPgo8IS0tICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfc29nb3UiIHZhbHVlPSI0IiB2LW1vZGVsPSJBQ0NvbmZpZy5zb2dvdS5BZHNTdHlsZU1vZGUiIHR5cGU9InJhZGlvIj4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9zb2dvdV8zbGluZSB9fS0tPgo8IS0tICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPi0tPgo8IS0tICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfc29nb3UiIHZhbHVlPSI1IiB2LW1vZGVsPSJBQ0NvbmZpZy5zb2dvdS5BZHNTdHlsZU1vZGUiIHR5cGU9InJhZGlvIj4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9zb2dvdV80bGluZSB9fS0tPgo8IS0tICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPi0tPgo8IS0tICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4tLT4KPCEtLSAgICAgICAgICAgICAgICAgICAgICAgICZsdDshJm5kYXNoOyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU75pCc54uX5qC35byPJiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7Jm5kYXNoOyZndDstLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iaGVpZ2h0OiAxcHg7d2lkdGg6MjY3cHg7bWFyZ2luLWxlZnQ6MjVweDtiYWNrZ3JvdW5kLWNvbG9yOiNkOGQ4ZDg7bWFyZ2luLXRvcDoxcHg7Ij48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3puK3puK3mkJzmoLflvI8tLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJjb250YWluZXItbGFiZWwgZHVjayI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbF9oaWRlIiB2LXRleHQ9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZHVja19sYWJsZSIgQGNsaWNrPSJsYWJlbFNob3dIaWRlRW52Ij48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLWxlZnQ6MjBweCI+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfZHVjayIgdi1tb2RlbD0iQUNDb25maWcuZHVjay5BZHNTdHlsZU1vZGUiIHZhbHVlPSIwIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kdWNrX29yaWdpbiB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kdWNrX2h1eWFuIj48aW5wdXQgbmFtZT0ic3AtYWMtaHV5YW5fc3R5bGVfZHVjayIgdi1tb2RlbD0iQUNDb25maWcuZHVjay5IdVlhbk1vZGUiIHR5cGU9ImNoZWNrYm94Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2R1Y2tfaHV5YW4gfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgOnRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2R1Y2tfbm9ybWFsIiBzdHlsZT0iIj48aW5wdXQgdi1tb2RlbD0iQUNDb25maWcubm9ybWFsaXplRHVjayIgdHlwZT0iY2hlY2tib3giPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZHVja19ub3JtYWwgfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxicj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1sZWZ0OjIwcHgiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2R1Y2siIHZhbHVlPSIxIiB2LW1vZGVsPSJBQ0NvbmZpZy5kdWNrLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZHVja18xbGluZSB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2R1Y2siIHZhbHVlPSIyIiB2LW1vZGVsPSJBQ0NvbmZpZy5kdWNrLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZHVja18xbGluZV9lbnRlciB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2R1Y2siIHZhbHVlPSIzIiB2LW1vZGVsPSJBQ0NvbmZpZy5kdWNrLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iIGNoZWNrZWQ9IiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kdWNrXzJsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfZHVjayIgdmFsdWU9IjQiIHYtbW9kZWw9IkFDQ29uZmlnLmR1Y2suQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kdWNrXzNsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfZHVjayIgdmFsdWU9IjUiIHYtbW9kZWw9IkFDQ29uZmlnLmR1Y2suQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kdWNrXzRsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3puK3puK3mkJzmoLflvI8tLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iaGVpZ2h0OiAxcHg7d2lkdGg6MjY3cHg7bWFyZ2luLWxlZnQ6MjVweDtiYWNrZ3JvdW5kLWNvbG9yOiNkOGQ4ZDg7bWFyZ2luLXRvcDoxcHg7Ij48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3lpJrlkInmoLflvI8tLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJjb250YWluZXItbGFiZWwgZG9nZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsYWJlbF9oaWRlIiB2LXRleHQ9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZG9nZV9sYWJsZSIgQGNsaWNrPSJsYWJlbFNob3dIaWRlRW52Ij48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLWxlZnQ6MjBweCI+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfZG9nZSIgdi1tb2RlbD0iQUNDb25maWcuZG9nZS5BZHNTdHlsZU1vZGUiIHZhbHVlPSIwIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kb2dlX29yaWdpbiB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kb2dlX2h1eWFuIj48aW5wdXQgbmFtZT0ic3AtYWMtaHV5YW5fc3R5bGVfZG9nZSIgdi1tb2RlbD0iQUNDb25maWcuZG9nZS5IdVlhbk1vZGUiIHR5cGU9ImNoZWNrYm94Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2RvZ2VfaHV5YW4gfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgOnRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwudXNlclN0eWxlX2RvZ2Vfbm9ybWFsIiBzdHlsZT0iIj48aW5wdXQgdi1tb2RlbD0iQUNDb25maWcubm9ybWFsaXplRG9nZSIgdHlwZT0iY2hlY2tib3giPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZG9nZV9ub3JtYWwgfX0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxicj4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgc3R5bGU9Im1hcmdpbi1sZWZ0OjIwcHgiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2RvZ2UiIHZhbHVlPSIxIiB2LW1vZGVsPSJBQ0NvbmZpZy5kb2dlLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZG9nZV8xbGluZSB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2RvZ2UiIHZhbHVlPSIyIiB2LW1vZGVsPSJBQ0NvbmZpZy5kb2dlLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC51c2VyU3R5bGVfZG9nZV8xbGluZV9lbnRlciB9fQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPjxpbnB1dCBuYW1lPSJzcC1hYy1hX2ZvcmNlX3N0eWxlX2RvZ2UiIHZhbHVlPSIzIiB2LW1vZGVsPSJBQ0NvbmZpZy5kb2dlLkFkc1N0eWxlTW9kZSIgdHlwZT0icmFkaW8iIGNoZWNrZWQ9IiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kb2dlXzJsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfZG9nZSIgdmFsdWU9IjQiIHYtbW9kZWw9IkFDQ29uZmlnLmRvZ2UuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kb2dlXzNsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+PGlucHV0IG5hbWU9InNwLWFjLWFfZm9yY2Vfc3R5bGVfZG9nZSIgdmFsdWU9IjUiIHYtbW9kZWw9IkFDQ29uZmlnLmRvZ2UuQWRzU3R5bGVNb2RlIiB0eXBlPSJyYWRpbyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnVzZXJTdHlsZV9kb2dlXzRsaW5lIH19CiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgIDwhLS0tLS0tLS0tLS0t5aSa5ZCJ5qC35byPLS0tLS0tLS0tLS0tLS0+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3miqTnnLzmqKHlvI/orr7nva4tLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmh1eWFuTW9kZV90aXRsZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJzcC1hYy11c2VyY29sb3IiIHYtbW9kZWw9IkFDQ29uZmlnLmlzVXNlckNvbG9yRW5hYmxlIiBuYW1lPSJzcC1hYy1hX2ZvcmNlIiB0eXBlPSJjaGVja2JveCIgY2hlY2tlZD0iIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuaHV5YW5Nb2RlX3RleHQgfX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgICAgICAgICA8bGk+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ibWVudS1ib3gtY29udGFpbmVyIiA6dGl0bGU9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5odXlhbk1vZGVfdGl0bGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBzdHlsZT0ibWFyZ2luLWxlZnQ6MjBweDsiIHYtdGV4dD0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmh1eWFuQ29sb3JfdGV4dCI+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9InNwLWFjLW1lbnVodXlhbkNvbG9yIiBAaW5wdXQuc3RvcD0idXNlVGhpc0h1eWFuQ29sb3IiIHYtbW9kZWw9IkFDQ29uZmlnLmRlZmF1bHRIdVlhbkNvbG9yIiB0eXBlPSJjb2xvciIgOnRpdGxlPSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuaHV5YW5Db2xvcl90aXRsZSIgc3R5bGU9ImN1cnNvcjogcG9pbnRlcjttYXJnaW4tdG9wOi0wLjA1cmVtO2hlaWdodDoyM3B4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJtZW51LWJveC1zbWFsbCIgZGF0YS12YWx1ZT0iI0RFRjFFRiIgQGNsaWNrLnN0b3A9InVzZVRoaXNIdXlhbkNvbG9yIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojREVGMUVGOyI+Jm5ic3A7Jm5ic3A7Jm5ic3A7Jm5ic3A7PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9Im1lbnUtYm94LXNtYWxsIiBkYXRhLXZhbHVlPSIjRjNGMkVFIiBAY2xpY2suc3RvcD0idXNlVGhpc0h1eWFuQ29sb3IiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNGM0YyRUU7Ij4mbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDs8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0ibWVudS1ib3gtc21hbGwiIGRhdGEtdmFsdWU9IiNFNUU1RTUiIEBjbGljay5zdG9wPSJ1c2VUaGlzSHV5YW5Db2xvciIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I0U1RTVFNTsiPiZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwOzwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJsaW5raHJlZiIgZGF0YS1ocmVmPSJodHRwczovL3d3dy5udGFvdy5jb20vY29sb3JwaWNrZXIuaHRtbCIgc3R5bGU9ImN1cnNvcjpwb2ludGVyO21hcmdpbi1yaWdodDogMTBweDsiIG9uY2xpY2s9IndpbmRvdy5vcGVuKHRoaXMuZGF0YXNldC5ocmVmKSIgdi10ZXh0PSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuaHV5YW5Db2xvck1vcmVfdGV4dCI+PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgICAgICAgICA8IS0tLS0tLS0tLS0tLUZhdmljb27lm77moIforr7nva4tLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCA6dGl0bGU9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5mYXZpY29uX3RpdGxlIiB2LW1vZGVsPSJBQ0NvbmZpZy5pc0Zhdmljb25FbmFibGUiIGlkPSJzcC1hYy1mYXZpY29uIiBuYW1lPSJzcC1hYy1hX2ZvcmNlIiB0eXBlPSJjaGVja2JveCIgY2hlY2tlZD0iIj4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuZmF2aWNvbl90ZXh0IH19CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIHN0eWxlPSJtYXJnaW4tbGVmdDoyMHB4OyIgdi10ZXh0PSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuZmF2aWNvbl9kZWZhdWx0SWNvbl90ZXh0Ij48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBpZD0ic3AtYWMtZmF2aWNvblVybCIgbmFtZT0ic3AtYWMtYV9mb3JjZSIgdi1tb2RlbD0iQUNDb25maWcuZGVmYXVsdEZhdmljb25VcmwiIHZhbHVlPSJodHRwczovL2FlMDEuYWxpY2RuLmNvbS9rZi9IVEIxZFJZMFg4T0QzS1ZqU1pGRnE2QW45cFhheS5qcGciIHN0eWxlPSJ3aWR0aDo1NSU7bWFyZ2luLXRvcDotMC4zZW07IiB0eXBlPSJpbnB1dCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3np7vpmaTnmb7luqbmkJzntKLpooTmtYstLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCA6dGl0bGU9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5zZWFyY2hPcmlnaW5fdGl0bGUiIHYtbW9kZWw9IkFDQ29uZmlnLmRvRGlzYWJsZVN1ZyIgaWQ9InNwLWFjLXN1Z19vcmlnaW4iIG5hbWU9InNwLWFjLWFfZm9yY2UiIHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSIiPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5zZWFyY2hPcmlnaW5fdGV4dCB9fQogICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgICAgICAgIDwhLS0tLS0tLS0tLS0t6ZmE5YqgN+OAgTjjgIE5LS0tLS0tLS0tLS0tLS0+CiAgICAgICAgICAgICAgICAgICAgICA8bGk+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InNwLWFjLXJpZ2h0IiB2LW1vZGVsPSJBQ0NvbmZpZy5pc1JpZ2h0RGlzcGxheUVuYWJsZSIgdHlwZT0iY2hlY2tib3giPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5zaG93UmlnaHRfdGV4dCB9fQogICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJzcC1hYy1jb3VudGVyIiB2LW1vZGVsPSJBQ0NvbmZpZy5pc0NvdW50ZXJFbmFibGUiIG5hbWU9InNwLWFjLWFfZm9yY2UiIHR5cGU9ImNoZWNrYm94Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuc2hvd0NvdW50ZXJfdGV4dCB9fQogICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJzcC1hYy1hbGluZSIgdi1tb2RlbD0iQUNDb25maWcuaXNBTGluZUVuYWJsZSIgbmFtZT0ic3AtYWMtYV9mb3JjZSIgdHlwZT0iY2hlY2tib3giPgogICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5zaG93QUxpbmVfdGV4dCB9fQogICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgICAgICAgIDwhLS0tLS0tLS0tLS0t6Ieq5a6a5LmJ5qC35byP5YaF5a65LS0tLS0tLS0tLS0tLS0+CiAgICAgICAgICAgICAgICAgICAgICA8bGk+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgaWQ9InNwLWFjLXVzZXJzdHlsZSIgdi1tb2RlbD0iQUNDb25maWcuaXNVc2VyU3R5bGVFbmFibGUiIG5hbWU9InNwLWFjLWFfZm9yY2UiIHR5cGU9ImNoZWNrYm94Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuc2hvd1VzZXJTdHlsZV90ZXh0IH19CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9InNwLWFjLXVzZXJzdHlsZVRFWFQiIHYtbW9kZWw9IkFDQ29uZmlnLlVzZXJTdHlsZVRleHQiIEBrZXl1cD0ibG9hZEN1c3RvbVN0eWxlIiBAY2hhbmdlPSJsb2FkQ3VzdG9tU3R5bGUiIEBwYXN0ZT0ibG9hZEN1c3RvbVN0eWxlIiBuYW1lPSJzcC1hYy1hX2ZvcmNlIiBzdHlsZT0id2lkdGg6ODUlO2hlaWdodDogNjZweDttYXJnaW4tbGVmdDozMHB4OyIgdHlwZT0iaW5wdXQiID48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9ImxpbmtocmVmIiB0YXJnZXQ9Il9ibGFuayIgOmhyZWY9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5jb250YWN0TWVfdXJsIiB2LXRleHQ9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5jb250YWN0TWVfdGV4dCI+PC9hPgogICAgICAgICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgIDwhLS0tLS0tLS0tLS0t5oum5oiq5Z+f5ZCN6K6+572ucGFuZWwtLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9InNldHRpbmctc2Vjb25kIiB2LXNob3c9Im90aGVyLnNob3dTZWNvbmRQYW5lbCI+CiAgICAgICAgICAgICAgICAgICAgICA8bGkgc3R5bGU9J21hcmdpbi1ib3R0b206IDhweCAhaW1wb3J0YW50Oyc+CiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0nc3AtYWMtYmxvY2tkaXlidXR0b24tYmFjaycgQGNsaWNrPSJvdGhlci5zaG93U2Vjb25kUGFuZWwgPSBvdGhlci5zaG93QmxvY2tMaXN0QXJlYSA9IGZhbHNlIiBjbGFzcz0nc3AtYWMtc3BhbmJ1dHRvbic+e3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnNldHRpbmdfcGFuZWxfc2Vjb25kLmJhY2tCdG5fdGV4dCB9fTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAge3sgbGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLnNldHRpbmdfcGFuZWxfc2Vjb25kLmJsb2NrTGFiZWxfdGV4dCB9fX0KICAgICAgICAgICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgICAgICAgICA8bGkgc3R5bGU9J21hcmdpbi1ib3R0b206IDhweCAhaW1wb3J0YW50Oyc+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSdzcC1hYy1ibG9ja2RpeWJ1dHRvbi1kaXlsaXN0JyBjbGFzcz0nc3AtYWMtc3BhbmJ1dHRvbicgQGNsaWNrPSJvdGhlci5zaG93QmxvY2tMaXN0QXJlYSA9ICFvdGhlci5zaG93QmxvY2tMaXN0QXJlYSIgdi10ZXh0PSJjYWxfZGl5QmxvY2tMaXN0QnRuIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPSdhYy1ibG9ja0xpc3QnIEBjbGljaz0icmVtb3ZlQUJsb2NrTGlzdEl0ZW0iIHN0eWxlPSdtYXgtaGVpZ2h0OjYwdmg7b3ZlcmZsb3cteTogc2Nyb2xsOyc+CiAgICAgICAgICAgICAgICAgICAgICAgIDx1bCB2LXNob3c9IiFvdGhlci5zaG93QmxvY2tMaXN0QXJlYSIgdi1odG1sPSJnZXRCbG9ja0xpc3QiPjwvdWw+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPSdhYy1ibG9ja0JveENvbicgc3R5bGU9J21heC1oZWlnaHQ6IDYwdmg7dGV4dC1hbGlnbjogY2VudGVyO21hcmdpbi1sZWZ0OiAyNnB4Oyc+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSB2LXNob3c9Im90aGVyLnNob3dCbG9ja0xpc3RBcmVhIiAgQGtleXVwPSJzeW5jVG9CbG9ja0xpc3QiIEBjaGFuZ2U9InN5bmNUb0Jsb2NrTGlzdCIgQHBhc3RlPSJzeW5jVG9CbG9ja0xpc3QiIHJvd3M9IjIwIiB2LXRleHQ9IkFDQ29uZmlnLlVzZXJCbG9ja0xpc3Quam9pbignXFxuJykiPjwvdGV4dGFyZWE+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgICAgICAgICB7eyBsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuc2V0dGluZ19wYW5lbF9zZWNvbmQuYWRkQmxvY2tMYWJlbF90ZXh0IH19PGlucHV0IGNsYXNzPSJzcC1hYy1hZGRSdWxlT25lIiBAa2V5dXAuZW50ZXI9ImNrQWRkUnVsZSIgdi1tb2RlbD0ib3RoZXIuYWRkQmxvY2tJdGVtIiBzdHlsZT0nd2lkdGg6NTUlOyc+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSdzcC1hYy1hZGRSdWxlYnV0dG9uJyBjbGFzcz0nc3AtYWMtc3BhbmJ1dHRvbiBlbmRidXR0b24nIEBjbGljaz0iY2tBZGRSdWxlIiBzdHlsZT0ncG9zaXRpb246IHJlbGF0aXZlICFpbXBvcnRhbnQ7bGluZS1oZWlnaHQ6IDE3cHg7JyB2LXRleHQ9Imxhbi51c2UuZmllbGRzZXRfcGFuZWwuc2V0dGluZ19wYW5lbC5zZXR0aW5nX3BhbmVsX3NlY29uZC5hZGRCdG5MYWJlbF90ZXh0Ij7mlrDlop48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICAgICAgPCEtLS0tLS0tLS0tLS3kv53lrZjjgIHlj5bmtojmjInpkq4tLS0tLS0tLS0tLS0tLT4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3AtYWMtY2FuY2VsYnV0dG9uIiBjbGFzcz0ic3AtYWMtc3BhbmJ1dHRvbiBlbmRidXR0b24iIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLmNhbmNlbEJ0bl90ZXh0IiBzdHlsZT0icG9zaXRpb246IHJlbGF0aXZlO2Zsb2F0OiBsZWZ0OyIgdi10ZXh0PSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwuY2FuY2VsQnRuX3RleHQiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3AtYWMtc2F2ZWJ1dHRvbiIgQGNsaWNrPSJzYXZlQ29uZmlnIiBjbGFzcz0ic3AtYWMtc3BhbmJ1dHRvbiBlbmRidXR0b24iIDp0aXRsZT0ibGFuLnVzZS5maWVsZHNldF9wYW5lbC5zZXR0aW5nX3BhbmVsLm9rQnRuX3RleHQiIHN0eWxlPSJwb3NpdGlvbjogcmVsYXRpdmU7ZmxvYXQ6IHJpZ2h0OyIgdi10ZXh0PSJsYW4udXNlLmZpZWxkc2V0X3BhbmVsLnNldHRpbmdfcGFuZWwub2tCdG5fdGV4dCI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2ZpZWxkc2V0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKENvbnRhaW5lcik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbGV0IGFsbE5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLkFDLWZhdmljb25ULCAuQUMtQ291bnRlclQiKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWxsTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGFsbE5vZGVzW2ldLmdldEF0dHJpYnV0ZSgnYWNDbGljaycpID09IG51bGwpIHsKICAgICAgICAgICAgICBhbGxOb2Rlc1tpXS5zZXRBdHRyaWJ1dGUoJ2FjQ2xpY2snLCAnMScpOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhbGxOb2Rlc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBBQ3RvZ2dsZVNldHRpbmdEaXNwbGF5KGUpOwogICAgICAgICAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJib2R5ICNzcC1hYy1jb250YWluZXIiKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsgLy8g6Zi75q2i54K55Ye76Ieq6Lqr55qE5pe25YCZ5YWz6ZetCiAgICAgICAgICAgIH0sIGZhbHNlKTsKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYm9keSIpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICBzYWZlRnVuY3Rpb24oICgpID0+IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzcC1hYy1jb250ZW50Iikuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9LCBmYWxzZSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTW9iaWxlQmFpZHVEaXJlY3RMaW5rKCkgewogICAgICAgICAgbGV0IG5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiI3BhZ2UgI3BhZ2UtYmQgI3Jlc3VsdHMgLnJlc3VsdDpub3QoW2FjX3JlZGlyZWN0U3RhdHVzXSkiKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbGV0IGN1ck5vZGUgPSBub2Rlc1tpXTsKICAgICAgICAgICAgc2FmZUZ1bmN0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBsZXQgY3VyRGF0YSA9IEpTT04ucGFyc2UoY3VyTm9kZS5kYXRhc2V0LmxvZy5yZXBsYWNlKC8nL2dtLCAiXCIiKSk7CiAgICAgICAgICAgICAgbGV0IHRydWVMaW5rID0gY3VyRGF0YS5tdTsKICAgICAgICAgICAgICBjdXJOb2RlLnF1ZXJ5U2VsZWN0b3IoImFydGljbGUiKS5zZXRBdHRyaWJ1dGUoInJsLWxpbmstaHJlZiIsIHRydWVMaW5rKTsKICAgICAgICAgICAgICBjdXJOb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoImEiKS5mb3JFYWNoKGZ1bmN0aW9uIChwZXIpIHsKICAgICAgICAgICAgICAgIHBlci5zZXRBdHRyaWJ1dGUoImhyZWYiLCB0cnVlTGluayk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjdXJOb2RlLnNldEF0dHJpYnV0ZSgiYWNfcmVkaXJlY3RTdGF0dXMiLCAiMSIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlT25Nb3VzZURvd25GdW5jKCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGV0IHJlc3VsdE5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmcgLnJjIGEiKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGxldCBvbmUgPSByZXN1bHROb2Rlc1tpXTsKICAgICAgICAgICAgICBvbmUuc2V0QXR0cmlidXRlKCJvbm1vdXNlZG93biIsICIiKTsgLy8g6LC35q2M5Y676YeN5a6a5ZCR5bmy5omwCiAgICAgICAgICAgICAgb25lLnNldEF0dHJpYnV0ZSgidGFyZ2V0IiwgIl9ibGFuayIpOyAvLyDosLfmrYzpk77mjqXmlrDmoIfnrb7miZPlvIAKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlbW92ZVJlZGlyZWN0TGlua1RhcmdldCgpIHsKICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLlpISUhVKSB7CiAgICAgICAgICAgIGxldCBub2RlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5SaWNoVGV4dCBhW2hyZWYqPScvL2xpbmsuemhpaHUuY29tLz90YXJnZXQnXSIpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgbGV0IHVybCA9IGRlY29kZVVSSUNvbXBvbmVudChub2Rlc1tpXS5ocmVmLnJlcGxhY2UoL2h0dHBzPzpcL1wvbGlua1wuemhpaHVcLmNvbVwvXD90YXJnZXQ9LywgIiIpKTsKICAgICAgICAgICAgICBub2Rlc1tpXS5ocmVmID0gdXJsOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuQkFJRFVfWFVFU0hVKSB7CiAgICAgICAgICAgIGxldCB4bm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJhW2hyZWYqPSdzY192dXJsPWh0dHAnXSIpOwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaSA8IHhub2Rlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIGxldCB4dXJsID0gZ2V0VXJsQXR0cmlidXRlKHhub2Rlc1tqXS5ocmVmLCAic2NfdnVybCIsIHRydWUpOwogICAgICAgICAgICAgIHhub2Rlc1tqXS5ocmVmID0geHVybDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g5o+Q5Y+WdXJs5YWD57Sg55qE5Y+C5pWw5YC8CiAgICAgICAgZnVuY3Rpb24gZ2V0VXJsQXR0cmlidXRlKHVybCwgYXR0cmlidXRlLCBuZWVkRGVjb2RlKSB7CiAgICAgICAgICBsZXQgc2VhcmNoVmFsdWVTID0gKHVybC5zdWJzdHIoMSkgKyAiIikuc3BsaXQoIiYiKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VhcmNoVmFsdWVTLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGxldCBrZXlfdmFsdWUgPSBzZWFyY2hWYWx1ZVNbaV0uc3BsaXQoIj0iKTsKICAgICAgICAgICAgbGV0IHJlZyA9IG5ldyBSZWdFeHAoIl4iICsgYXR0cmlidXRlICsgIiQiKTsKICAgICAgICAgICAgaWYgKHJlZy50ZXN0KGtleV92YWx1ZVswXSkpIHsKICAgICAgICAgICAgICBsZXQgc2VhcmNoV29yZHMgPSBrZXlfdmFsdWVbMV07CiAgICAgICAgICAgICAgcmV0dXJuIG5lZWREZWNvZGUgPyBkZWNvZGVVUklDb21wb25lbnQoc2VhcmNoV29yZHMpIDogc2VhcmNoV29yZHM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlc2V0VVJMTm9ybWFsKGxpc3QpIHsKICAgICAgICAgIC8vIOazqOaEj+aciemHjeWkjeeahOWcsOWdgO+8jOWwvemHj+WvuemHjeWkjeWcsOWdgOi/m+ihjOWOu+mHjQogICAgICAgICAgdmFyIGhhc0RlYWxIcmVmU2V0ID0gbmV3IFNldCgpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIOatpOaWueazleaYr+W8guatpe+8jOaVheWcqOe7k+adn+eahOaXtuWAmeS9v+eUqGnkvJrlh7rpl67popgt5Lil6YeNIQogICAgICAgICAgICAvLyDph4fnlKjpl63ljIXnmoTmlrnms5XmnaXov5vooYzmlbDmja7nmoTkvKDpgJIKICAgICAgICAgICAgbGV0IGN1ck5vZGUgPSBsaXN0W2ldOwogICAgICAgICAgICBsZXQgY3VyaHJlZiA9IGN1ck5vZGUuaHJlZjsKICAgICAgICAgICAgaWYgKGxpc3RbaV0gIT09IG51bGwgJiYgbGlzdFtpXS5nZXRBdHRyaWJ1dGUoImFjX3JlZGlyZWN0U3RhdHVzIikgPT0gbnVsbCkgewogICAgICAgICAgICAgIGxpc3RbaV0uc2V0QXR0cmlidXRlKCJhY19yZWRpcmVjdFN0YXR1cyIsICIwIik7CiAgICAgICAgICAgICAgbGV0IGxlbjEgPSBoYXNEZWFsSHJlZlNldC5zaXplOwogICAgICAgICAgICAgIGhhc0RlYWxIcmVmU2V0LmFkZChjdXJocmVmKTsKICAgICAgICAgICAgICBsZXQgbGVuMiA9IGhhc0RlYWxIcmVmU2V0LnNpemU7CiAgICAgICAgICAgICAgaWYgKGxlbjEgPT09IGxlbjIpIGNvbnRpbnVlOyAvLyDor7TmmI7mlbDmja7lt7Lnu4/lpITnkIbov4fvvIzlrZjlnKjnm7jlkIznmoTorrDlvZUKICAgICAgICAgICAgICBpZiAoY3VyaHJlZi5pbmNsdWRlcygid3d3LmJhaWR1LmNvbS9saW5rIikgfHwKICAgICAgICAgICAgICAgIGN1cmhyZWYuaW5jbHVkZXMoIm0uYmFpZHUuY29tL2Zyb20iKSB8fAogICAgICAgICAgICAgICAgY3VyaHJlZi5pbmNsdWRlcygid3d3LnNvZ291LmNvbS9saW5rIikgfHwKICAgICAgICAgICAgICAgIGN1cmhyZWYuaW5jbHVkZXMoInNvLmNvbS9saW5rIikpIHsKICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoY19jdXJub2RlLCBjX2N1cmhyZWYpIHsKICAgICAgICAgICAgICAgICAgbGV0IHVybCA9IGNfY3VyaHJlZi5yZXBsYWNlKC9eaHR0cDovLCAiaHR0cHM6Iik7CiAgICAgICAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkJBSURVICYmICF1cmwuaW5jbHVkZXMoImVxaWQiKSkgewogICAgICAgICAgICAgICAgICAgIC8vIOWmguaenOaYr+eZvuW6pu+8jOW5tuS4lOayoeacieW4puacieino+aekOWPguaVsO+8jOmCo+S5iOaJi+WKqOW4puS4igogICAgICAgICAgICAgICAgICAgIHVybCA9IHVybCArICImd2Q9JmVxaWQ9IjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBsZXQgZ21SZXF1ZXN0Tm9kZSA9IEdNX3htbGh0dHBSZXF1ZXN0KHsKICAgICAgICAgICAgICAgICAgICAvLyBmcm9tOiAiYWN4aHIiLAogICAgICAgICAgICAgICAgICAgIGV4dERhdGE6IGNfY3VyaHJlZiwgLy8g55So5LqO5omp5bGVCiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogeyJBY2NlcHQiOiAiKi8qIiwgIlJlZmVyZXIiOiBjX2N1cmhyZWYucmVwbGFjZSgvXmh0dHA6LywgImh0dHBzOiIpfSwKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICJHRVQiLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ6IDgwMDAsCiAgICAgICAgICAgICAgICAgICAgb25yZWFkeXN0YXRlY2hhbmdlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsgLy8gTUFSSyDmnInml7blgJnov5nkuKrlh73mlbDmoLnmnKzkuI3ov5vmnaUgLSDosIPor5XnmoTpl67popggLSB0aW1lb3V0CiAgICAgICAgICAgICAgICAgICAgICAvLyDnlLHkuo7mmK/nibnmrorov5Tlm54t5bm25LiU5aW95pCcLeaQnOeLly3nmb7luqbpg73mmK/ov5nkuKrmoLzlvI/vvIzmlYXmj5Dlh7oKICAgICAgICAgICAgICAgICAgICAgIERlYWxSZWRpcmVjdChnbVJlcXVlc3ROb2RlLCBjX2N1cmhyZWYsIHJlc3BvbnNlLnJlc3BvbnNlVGV4dCwgIlVSTD0nKFteJ10rKSciKQogICAgICAgICAgICAgICAgICAgICAgLy8g6L+Z5Liq5piv5Zyo5LiK6Z2i5peg5rOV5aSE55CG55qE5oOF5Ya15LiL77yM5aSH55So55qEIHRtLWZpbmFsdXJsZGhkZyAgdG0tZmluYWx1cmxtZmRoCiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UucmVzcG9uc2VIZWFkZXJzLmluY2x1ZGVzKCJ0bS1maW5hbHVybCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCByZWxVUkwgPSBSZWdfR2V0KHJlc3BvbnNlLnJlc3BvbnNlSGVhZGVycywgInRtLWZpbmFsdXJsXFx3KzogKFteXFxzXSspIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWxVUkwgPT0gbnVsbCB8fCByZWxVUkwgPT09ICIiIHx8IHJlbFVSTC5pbmNsdWRlcygid3d3LmJhaWR1LmNvbS9zZWFyY2gvZXJyb3IiKSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBEZWFsUmVkaXJlY3QoZ21SZXF1ZXN0Tm9kZSwgY19jdXJocmVmLCByZWxVUkwpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KShjdXJOb2RlLCBjdXJocmVmKTsgLy/kvKDpgJLml6fnmoTnvZHlnYDov4fljrvvvIzor7vkvZxjX2N1cmhyZWYKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gY3VyTm9kZS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW92ZXIiLCAoKT0+IHsKICAgICAgICAgICAgICAvLyAgIGNvbnN0IEFCS2V5ID0gUmVkaXJlY3RNYXAuZ2V0KGN1ck5vZGUuaHJlZik7IC8vIOWOn+WniyAtPiDkuYvlkI7nmoTpk77mjqUKICAgICAgICAgICAgICAvLyAgIGlmKEFCS2V5KSBjdXJOb2RlLmhyZWYgPSBBQktleTsKICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICAgIC8vIGN1ck5vZGUuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdXQiLCAoKT0+IHsKICAgICAgICAgICAgICAvLyAgIGNvbnN0IEJBS2V5ID0gUmVkaXJlY3RNYXAuZ2V0KGN1ck5vZGUuaHJlZik7IC8vIOS5i+WQjueahOi/nuaOpSAtPiDljp/lp4sKICAgICAgICAgICAgICAvLyAgIGlmKEJBS2V5KSBjdXJOb2RlLmhyZWYgPSBCQUtleTsKICAgICAgICAgICAgICAvLyB9KQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaGFzRGVhbEhyZWZTZXQuc2l6ZSA+IDAgJiYgbGlzdC5sZW5ndGggLSBoYXNEZWFsSHJlZlNldC5zaXplID4gMCkgY29uc29sZS5sb2coIuS4ouW8g+aOiSIsIGxpc3QubGVuZ3RoIC0gaGFzRGVhbEhyZWZTZXQuc2l6ZSwgIuS4qumHjeWkjemTvuaOpSIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIERlYWxSZWRpcmVjdCA9IGZ1bmN0aW9uIChyZXF1ZXN0LCBjdXJOb2RlSHJlZiwgcmVzcFRleHQsIFJlZ1RleHQpIHsKICAgICAgICAgIGlmIChyZXNwVGV4dCA9PSBudWxsIHx8IHR5cGVvZiAocmVzcFRleHQpID09ICJ1bmRlZmluZWQiKSByZXR1cm47CiAgICAgICAgICBsZXQgcmVzdWx0UmVzcG9uc2VVcmwgPSAiIjsKICAgICAgICAgIGlmIChSZWdUZXh0ICE9IG51bGwpIHsKICAgICAgICAgICAgcmVzdWx0UmVzcG9uc2VVcmwgPSBSZWdfR2V0KHJlc3BUZXh0LCBSZWdUZXh0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdFJlc3BvbnNlVXJsID0gcmVzcFRleHQ7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmVzdWx0UmVzcG9uc2VVcmwgIT09IG51bGwgJiYgcmVzdWx0UmVzcG9uc2VVcmwgIT09ICIiICYmICFyZXN1bHRSZXNwb25zZVVybC5pbmNsdWRlcygid3d3LmJhaWR1LmNvbS9saW5rIikpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5TT0dPVSkgY3VyTm9kZUhyZWYgPSBjdXJOb2RlSHJlZi5yZXBsYWNlKC9eaHR0cHM6XC9cL3d3dy5zb2dvdS5jb20vLCAiIik7CiAgICAgICAgICAgICAgbGV0IGhvc3QgPSBnZXRUZXh0SG9zdChyZXN1bHRSZXNwb25zZVVybCk7CiAgICAgICAgICAgICAgLy8gUmVkaXJlY3RNYXAuc2V0KGN1ck5vZGVIcmVmLCByZXN1bHRSZXNwb25zZVVybCk7IC8vIOi/m+ihjOS4gOS4quaVsOaNruWFs+iBlAogICAgICAgICAgICAgIC8vIFJlZGlyZWN0TWFwLnNldChyZXN1bHRSZXNwb25zZVVybCwgY3VyTm9kZUhyZWYpOyAvLyDov5vooYzkuIDkuKrmlbDmja7lhbPogZQKICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIqW2hyZWYqPSciICsgY3VyTm9kZUhyZWYgKyAiJ10iKS5mb3JFYWNoKCBwZXIgPT4gewogICAgICAgICAgICAgICAgbGV0IGNoYW5nZU5vZGUgPSBwZXI7CgogICAgICAgICAgICAgICAgY2hhbmdlTm9kZS5zZXRBdHRyaWJ1dGUoImFjX3JlZGlyZWN0U3RhdHVzIiwgIjIiKTsKICAgICAgICAgICAgICAgIGNoYW5nZU5vZGUuaHJlZiA9IHJlc3VsdFJlc3BvbnNlVXJsOwogICAgICAgICAgICAgICAgLy8gY2hhbmdlTm9kZS5zZXRBdHRyaWJ1dGUoImRhdGEtb3JpaHJlZiIsIGNoYW5nZU5vZGUuaHJlZik7CiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlTm9kZS5oYXNBdHRyaWJ1dGUoIm1ldGEiKSkgewogICAgICAgICAgICAgICAgICBjaGFuZ2VOb2RlLnNldEF0dHJpYnV0ZSgibWV0YSIsIGhvc3QpOwogICAgICAgICAgICAgICAgICBjaGFuZ2VOb2RlLmRhdGFzZXQuaG9zdCA9IGhvc3Q7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlTm9kZS50ZXh0ICYmIGNoYW5nZU5vZGUudGV4dC5sZW5ndGggPCAxMCAmJiAhY2hhbmdlTm9kZS50ZXh0LmluY2x1ZGVzKGhvc3QpCiAgICAgICAgICAgICAgICAgIC8vIOS4jeiDveaYr3JlZGlyZWN0IHVybCDkuI3og73mmK9oMlxoM+S4i+ebtOWxnumTvuaOpQogICAgICAgICAgICAgICAgICAmJiAhY2hhbmdlTm9kZS5wYXJlbnRFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiaCIpKSB7CiAgICAgICAgICAgICAgICAgIGNoYW5nZU5vZGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCJiZWZvcmVFbmQiLCAiJm5ic3A7LSZuYnNwOyIgKyBob3N0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICBvdGhlckRhdGEub3RoZXIuY3VySG9zdHMuYWNwdXNoKGhvc3QgKyAiIyMjIiArIHJlc3VsdFJlc3BvbnNlVXJsKTsKICAgICAgICAgICAgICByZXF1ZXN0LmFib3J0KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUFEX2JhaWR1X3NvZ291KCkgeyAvLyDnp7vpmaTnvZHnq5noh6rmnInlub/lkYoKICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkJBSURVKSB7CgogICAgICAgICAgICAvLyDnp7vpmaRzaGFkb3dET03lub/lkYrvvJvmkJzntKLlhbPplK7lrZfvvJrmt5jlrp3vvJvnhLblkI7ngrnlh7vmkJzntKLmoYbvvIzlub/lkYrkvJrlpJrmrKHph43njrBzaGFkb3dkb20KICAgICAgICAgICAgc2FmZUZ1bmN0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAkKCcuYy1jb250YWluZXIgL2RlZXAvIC5jLWNvbnRhaW5lcicpLmhhcygnLmYxMz5zcGFuOmNvbnRhaW5zKCLlub/lkYoiKScpLnJlbW92ZSgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIOenu+mZpOWPs+S+p+agj+W5v+WRigogICAgICAgICAgICBzYWZlUmVtb3ZlX3hwYXRoKCJpZCgnY29udGVudF9yaWdodCcpL2RpdlsuLy9hW2NvbnRhaW5zKHRleHQoKSwgJ+W5v+WRiicpXV0iKTsKICAgICAgICAgICAgLy8g56e76Zmk5qCH5YeG5bm/5ZGKCiAgICAgICAgICAgIHNhZmVSZW1vdmVfeHBhdGgoImlkKCdjb250ZW50X2xlZnQnKS9kaXZbLi8vc3Bhbltjb250YWlucyh0ZXh0KCksICflub/lkYonKV1dIik7CiAgICAgICAgICAgIC8vIOenu+mZpOWPs+S+p+agj+mhtumDqC3lupXpg6jml6DnlKjlub/lkYoKICAgICAgICAgICAgc2FmZVJlbW92ZV94cGF0aCgiaWQoJ2NvbnRlbnRfcmlnaHQnKS9iciIpOwogICAgICAgICAgICBzYWZlUmVtb3ZlX3hwYXRoKCJpZCgnY29udGVudF9yaWdodCcpL2Rpdltub3QoQGlkKV0iKTsKICAgICAgICAgICAgLy8g56e76Zmk6aG26YOo5Y+v6IO95Ye6546w55qEICLkuLrmgqjmjqjojZAiCiAgICAgICAgICAgIHNhZmVSZW1vdmVfeHBhdGgoImlkKCdjb250ZW50X2xlZnQnKS8vZGl2W2NvbnRhaW5zKEBjbGFzcywgJ19ycycpXSIpOwoKICAgICAgICAgIH0gZWxzZSBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5NQkFJRFUpIHsKICAgICAgICAgICAgLyoqKirnp7vpmaTmiYvmnLrmqKHlvI/kuIrnmoTpg6jliIblub/lkYoqKioqLwogICAgICAgICAgICBzYWZlUmVtb3ZlX3hwYXRoKCJpZCgncGFnZS1iZCcpL2Rpdltub3QoY29udGFpbnMoQGNsYXNzLCAncmVzdWx0JykpXSIpOwogICAgICAgICAgICBzYWZlUmVtb3ZlX3hwYXRoKCJpZCgncGFnZS1iZCcpL2Rpdltub3QoQGNsYXNzKV0iKTsKICAgICAgICAgICAgc2FmZVJlbW92ZV94cGF0aCgiLy9kaXZbQGNsYXNzPSduYS1saWtlLWNvbnRhaW5lciddIik7CiAgICAgICAgICAgIC8vIHNhZmVGdW5jdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vICAgJCgnI3BhZ2UtYmQgI3Jlc3VsdHM+ZGl2Om5vdChbY2xhc3MqPSJyZXN1bHQiXSknKS5yZW1vdmUoKTsKICAgICAgICAgICAgLy8gfSk7CiAgICAgICAgICAgIC8vIHNhZmVGdW5jdGlvbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vICAgJCgnI3BhZ2UtYmQgI3Jlc3VsdHM+ZGl2Om5vdChbY2xhc3NdKScpLnJlbW92ZSgpOwogICAgICAgICAgICAvLyB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5TTykgewogICAgICAgICAgICBzYWZlUmVtb3ZlKCIjc29fa3ctYWQiKTsKICAgICAgICAgICAgc2FmZVJlbW92ZSgiI20tc3ByZWFkLWxlZnQiKTsKICAgICAgICAgICAgLy8g56e76Zmk5pCc57Si5Lit5bqV6YOo5bm/5ZGKCiAgICAgICAgICAgIHNhZmVSZW1vdmUoIiNtLXNwcmVhZC1ib3R0b20iKTsKICAgICAgICAgICAgLy8g56e76Zmk5Y+z5L6n5qCP6aG26YOo5bm/5ZGKCiAgICAgICAgICAgIHNhZmVSZW1vdmVfeHBhdGgoImlkKCdyaWdodHRvcF9ib3gnKS8vbGlbLi8vc3Bhbltjb250YWlucyh0ZXh0KCksICflub/lkYonKV1dIik7CiAgICAgICAgICB9IGVsc2UgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuQklORykgewogICAgICAgICAgICBzYWZlUmVtb3ZlKCIuYl9hZCIpOwogICAgICAgICAgfSBlbHNlIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkdPT0dMRSkgewogICAgICAgICAgICBzYWZlUmVtb3ZlKCIjYm90dG9tYWRzIik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhZGRDb3VudGVyKGNpdGVMaXN0KSB7CiAgICAgICAgICBsZXQgY3NzVGV4dCA9ICJwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjE7bWFyZ2luLXJpZ2h0OjRweDtkaXNwbGF5OmlubGluZS1ibG9jaztjb2xvcjp3aGl0ZTtmb250LWZhbWlseTon5b6u6L2v6ZuF6buRJztmb250LXNpemU6MTZweDt0ZXh0LWFsaWduOmNlbnRlcjt3aWR0aDoyMnB4O2xpbmUtaGVpZ2h0OjIycHg7Ym9yZGVyLXJhZGl1czo1MCU7IjsKICAgICAgICAgIGxldCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2l0ZUxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbGV0IGluZGV4ID0gY2l0ZUxpc3RbaV0uZ2V0QXR0cmlidXRlKCdTb3J0SW5kZXgnKTsKICAgICAgICAgICAgaWYgKGluZGV4ID09PSBudWxsIHx8IHR5cGVvZiAoaW5kZXgpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIGNpdGVMaXN0W2ldLnNldEF0dHJpYnV0ZSgnU29ydEluZGV4JywgQ09OU1Quc29ydEluZGV4KTsKICAgICAgICAgICAgICBjaXRlTGlzdFtpXS5pbm5lciA9IGNpdGVMaXN0W2ldLmlubmVySFRNTDsKICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gIjxlbSBjbGFzcz0nQUMtQ291bnRlclQnIHN0eWxlPSIgKyBjc3NUZXh0ICsgIj4iICsgQ09OU1Quc29ydEluZGV4ICsgIjwvZW0+IjsKICAgICAgICAgICAgICBjaXRlTGlzdFtpXS5pbm5lckhUTUwgPSBkaXYuaW5uZXJIVE1MICsgY2l0ZUxpc3RbaV0uaW5uZXI7CiAgICAgICAgICAgICAgQ09OU1Quc29ydEluZGV4Kys7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAoaSArIDEpICUgMTAwKSB7IC8vIOaMiemcgOabtOaWsAogICAgICAgICAgICAgICAgY2l0ZUxpc3RbaV0ucXVlcnlTZWxlY3RvcigiLkFDLUNvdW50ZXJUIikuaW5uZXJUZXh0ID0gKGkgKyAxKSAlIDEwMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBIb3N0UmVnID0gbmV3IFJlZ0V4cCgvKGh0dHBzPzpcL1wvKT8oW14vXHNdKykvaSk7CgogICAgICAgIGZ1bmN0aW9uIGdldFRleHRIb3N0KHNiZWZvcmUpIHsKICAgICAgICAgIHNiZWZvcmUgPSAoc2JlZm9yZSAmJiBzYmVmb3JlLnRyaW0oKSkucmVwbGFjZSgvXHMtXHNcZHs0fS1cZHsxLDJ9LVxkezEsMn0vLCAiIikgfHwgIiI7CiAgICAgICAgICBsZXQgc2VuZDsKICAgICAgICAgIGxldCByZXN1bHQgPSBzYmVmb3JlLnNwbGl0KCctJyk7CiAgICAgICAgICAvLyAtLeaQnOeLl+eZvuW6puS4k+eUqO+8m+WmguaenOesrOS4gOS4quaYr+S4reaWh+eahOivne+8jOWcsOWdgOWwseaYr+esrOS6jOS4qgogICAgICAgICAgaWYgKChyZXN1bHQubGVuZ3RoID4gMSAmJiBuZXcgUmVnRXhwKCJbXFx1NEUwMC1cXHU5RkZGXSsiLCAiZyIpLnRlc3Qoc2JlZm9yZSkpICYmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkJBSURVIHx8IGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuU09HT1UpKSB7CiAgICAgICAgICAgIHNiZWZvcmUgPSByZXN1bHRbMV07CiAgICAgICAgICB9CiAgICAgICAgICAvLyDmraTml7ZzYmVmb3Jl5Yeg5LmO5piv562J5LqO572R5Z2A5LqG77yM5L2G5piv5pyJ5pe25YCZ5Lya5pyJ5aSa55qE56m65qC877yM5aSa55qE5YaF5a6577yM5aSa55qE5YmN57yAaHR0cO+8jOWkmuS9meeahOi3r+W+hAogICAgICAgICAgbGV0IHJlcyA9IEhvc3RSZWcuZXhlYyhzYmVmb3JlKTsKICAgICAgICAgIHNlbmQgPSAocmVzICYmIHJlc1syXS50cmltKCkpIHx8ICIiOwogICAgICAgICAgLy8gc2VuZCA9IHNiZWZvcmUucmVwbGFjZSgvKFwvW14vXSp8XHMqKS8sICIiKS5yZXBsYWNlKC88W14+XSo+L2csICIiKS5yZXBsYWNlKC9odHRwcz86XC9cLy9nLCAiIikucmVwbGFjZSgvPFwvP3N0cm9uZz4vZywgIiIpLnJlcGxhY2UoLzxcLz9iPi9nLCAiIikucmVwbGFjZSgvPD8+Py9nLCAiIikucmVwbGFjZSgvKCB8XC8pLiovZywgIiIpLnJlcGxhY2UoL1wuXC4uKi8sICIiKTsKICAgICAgICAgIGlmIChzZW5kID09PSAiIikgcmV0dXJuIG51bGw7CiAgICAgICAgICBpZiAoc2VuZC5pbmRleE9mKCIuIikgPCAwKSByZXR1cm4gbnVsbDsKICAgICAgICAgIGlmIChzZW5kLmluZGV4T2YoIuKGtSIpID49IDApIHJldHVybiBudWxsOwogICAgICAgICAgcmV0dXJuIHNlbmQudHJpbSgpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYWRkRmF2aWNvbihjaXRlTGlzdCkgewogICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCAhPT0gU2l0ZVR5cGUuRE9HRSkgewogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgY2l0ZUxpc3QubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgaWYgKG51bGwgPT0gY2l0ZUxpc3RbaW5kZXhdLmdldEF0dHJpYnV0ZSgiYWNfZmF2aWNvblN0YXR1cyIpKSB7CiAgICAgICAgICAgICAgICBsZXQgY3VyTm9kZSA9IGNpdGVMaXN0W2luZGV4XTsKICAgICAgICAgICAgICAgIGxldCB0YXJnZXROb2RlID0gY3VyTm9kZTsKICAgICAgICAgICAgICAgIGxldCB7IGN1ckhvc3QsIGN1clVybCB9ID0gZ2V0Tm9kZUhvc3QodGFyZ2V0Tm9kZSk7CiAgICAgICAgICAgICAgICBpZiAoY3VySG9zdCA9PSBudWxsIHx8IChjdXJVcmwgJiYgY3VyVXJsLmluY2x1ZGVzKCJ3d3cuYmFpZHUuY29tL2xpbmsiKSkpIHsgLy8g6Lez6L+HYmFpZHUuY2xpY2sKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBvdGhlckRhdGEub3RoZXIuY3VySG9zdHMuYWNwdXNoKGN1ckhvc3QgKyAiIyMjIiArIGN1clVybCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsZXQgZmF2aWNvblVybCA9IGN1ckhvc3Q7CiAgICAgICAgICAgICAgICBsZXQgSUkgPSAwOwogICAgICAgICAgICAgICAgZm9yICg7IElJIDw9IDU7IElJKyspIHsKICAgICAgICAgICAgICAgICAgdGFyZ2V0Tm9kZSA9IHRhcmdldE5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldE5vZGUgIT0gbnVsbCAmJiB0YXJnZXROb2RlLnF1ZXJ5U2VsZWN0b3IoY3VyU2l0ZS5GYXZpY29uQWRkVG8pICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpbmRleCsiLiIrZmF2aWNvblVybCsiLS0iK0lJKTsKICAgICAgICAgICAgICAgIGlmIChJSSA8PSA1KSB7CiAgICAgICAgICAgICAgICAgIC8vIOWFiOeUqOeItuiKgueCueWIpOaWreS4gOS4i+aYr+WQpuWtmOWcqGltZwogICAgICAgICAgICAgICAgICBsZXQgdG1wSFRNTCA9IHRhcmdldE5vZGUuaW5uZXJIVE1MOwogICAgICAgICAgICAgICAgICBsZXQgcG9zID0gdG1wSFRNTC5pbmRleE9mKCJmYXYtdXJsIikKICAgICAgICAgICAgICAgICAgICAmIHRtcEhUTUwuaW5kZXhPZigiZmF2dXJsIikKICAgICAgICAgICAgICAgICAgICAmIHRtcEhUTUwuaW5kZXhPZigidGl0LWljbyIpCiAgICAgICAgICAgICAgICAgICAgJiB0bXBIVE1MLmluZGV4T2YoImltZ19mYXYgcm1zX2ltZyIpCiAgICAgICAgICAgICAgICAgICAgJiB0bXBIVE1MLmluZGV4T2YoImMtdG9vbC0iKQogICAgICAgICAgICAgICAgICAgICYgdG1wSFRNTC5pbmRleE9mKCJzcGFuIGNsYXNzPVwiYy1pY29uIGMtaWNvbi0iKQogICAgICAgICAgICAgICAgICAgICYgdG1wSFRNTC5pbmRleE9mKCJpbWcgY2xhc3M9XCJ4QTMzR2MiKTsKICAgICAgICAgICAgICAgICAgLy/ku5boh6rlt7Hlt7Lnu4/lgZrkuoZmYXZpY29u5LqGCiAgICAgICAgICAgICAgICAgIGlmIChwb3MgPiAtMSkgewogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCLlt7LmnInlm77niYfvvJoiKTsKICAgICAgICAgICAgICAgICAgICBjdXJOb2RlLnNldEF0dHJpYnV0ZSgiYWNfZmF2aWNvblN0YXR1cyIsICItMiIpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRhcmdldE5vZGUgPSB0YXJnZXROb2RlLnF1ZXJ5U2VsZWN0b3IoY3VyU2l0ZS5GYXZpY29uQWRkVG8pOwogICAgICAgICAgICAgICAgICAvLyDnibnmrorlpITnkIZCSU5HCiAgICAgICAgICAgICAgICAgIC8vIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT0gU2l0ZVR5cGUuQklORykgY3VyTm9kZSA9IGN1ck5vZGUucXVlcnlTZWxlY3RvcigiaDIiKTsKICAgICAgICAgICAgICAgICAgLy9odHRwczovL2FwaS5ieWkucHcvZmF2aWNvbi8/dXJsPT8/Pz8g5LiN56iz5a6aCiAgICAgICAgICAgICAgICAgIC8vaHR0cDovLyIrZmF2aWNvblVybCsiL2Nkbi5pY28/ZGVmYXVsdGljb249aHR0cDovL3Nvei5pbS9mYXZpY29uLmljbyDkuI3nqLPlrpoKICAgICAgICAgICAgICAgICAgLy9odHRwczovL3d3dy54dHdpbmQuY29tL2FwaS9pbmRleC5waHA/dXJsPT8/Pz8g5oyC5LqG44CC44CC44CCCiAgICAgICAgICAgICAgICAgIC8vaHR0cHM6Ly9zdGF0aWNzLmRuc3BvZC5jbi9wcm94eV9mYXZpY29uL18vZmF2aWNvbj9kb21haW49c2luYS5jbgogICAgICAgICAgICAgICAgICAvL3d3dy5nb29nbGUuY29tL3MyL2Zhdmljb25zP2RvbWFpbj03NjQzNTAxNzcubG9mdGVyLmNvbQogICAgICAgICAgICAgICAgICAvL+WmguaenOWcsOWdgOS4jeato+ehru+8jOmCo+S5iOS4ouW8gwogICAgICAgICAgICAgICAgICBsZXQgaG9zdCA9IGZhdmljb25VcmwucmVwbGFjZSgvW14uXStcLihbXi5dKylcLihbXi5dKykvLCAiJDEuJDIiKTsKICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldE5vZGUucXVlcnlTZWxlY3RvcigiLkFDLWZhdmljb25UIikgPT0gbnVsbCAmJiBob3N0Lmxlbmd0aCA+IDMpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgaW5zTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgICAgICAgICAgICAgICAgIC8vIGN1ck5vZGUgPSBjdXJOb2RlLmNoaWxkcmVuWzBdIHx8IGN1ck5vZGUuZmlyc3RDaGlsZCA7IC8vIGZpcnN0Q2hpbGTlrrnmmJPpgYfliLB0ZXh05a+56LGhCiAgICAgICAgICAgICAgICAgICAgY3VyTm9kZS5zZXRBdHRyaWJ1dGUoImFjX2Zhdmljb25TdGF0dXMiLCAiMSIpOwogICAgICAgICAgICAgICAgICAgIC8vIGN1ck5vZGUuaW5zZXJ0QmVmb3JlKGluc05vZGUsIGN1ck5vZGUuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgaW5zTm9kZS5jbGFzc05hbWUgPSAiQUMtZmF2aWNvblQiOwogICAgICAgICAgICAgICAgICAgIGluc05vZGUuc2V0QXR0cmlidXRlKCJyZWZlcnJlcnBvbGljeSIsICJuby1yZWZlcnJlciIpOwogICAgICAgICAgICAgICAgICAgIGluc05vZGUuc3R5bGUgPSAicG9zaXRpb246cmVsYXRpdmU7ei1pbmRleDoxO3ZlcnRpY2FsLWFsaWduOnN1YjtoZWlnaHQ6MTZweDt3aWR0aDoxNnB4O21hcmdpbi1yaWdodDo1cHg7bWFyZ2luLWJvdHRvbTogMnB4O3VzZXItc2VsZWN0Om5vbmU7IjsKCiAgICAgICAgICAgICAgICAgICAgaW5zTm9kZS5zcmMgPSAiaHR0cHM6Ly9mYXZpY29uLnlhbmRleC5uZXQvZmF2aWNvbi92Mi8iICsgKGN1ck5vZGUuaHJlZiB8fCBob3N0KTsgLy8gTUFSSyB5YW5kZXjmlK/mjIHov5nnp43mn6Xor6Lop4TliJkKICAgICAgICAgICAgICAgICAgICBpbnNOb2RlLnNldEF0dHJpYnV0ZSgiZmF2aWNvbklEIiwgIjAiKTsKICAgICAgICAgICAgICAgICAgICBpbnNOb2RlLnNldEF0dHJpYnV0ZSgib25kcmFnc3RhcnQiLCAicmV0dXJuIGZhbHNlOyIpIC8vIOemgeatouaLluWKqOWbvueJhy3pgb/lhY3mi5bplJnkuoYKICAgICAgICAgICAgICAgICAgICAvLyBjdXJOb2RlLmlubmVySFRNTCA9IGluc05vZGUub3V0ZXJIVE1MICsgY3VyTm9kZS5pbm5lckhUTUw7CiAgICAgICAgICAgICAgICAgICAgLy8gY3VyTm9kZS5pbnNlcnRBZGphY2VudEhUTUwoImFmdGVyRW5kIiwgaW5zTm9kZS5pbm5lckhUTUwpOwogICAgICAgICAgICAgICAgICAgIGxldCBiZWZvcmVJbmRleCA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldE5vZGUuY2hpbGROb2Rlc1tiZWZvcmVJbmRleF0uY2xhc3NOYW1lID09PSAiQUMtQ291bnRlclQiKSB7CiAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVJbmRleCA9IDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRhcmdldE5vZGUuaW5zZXJ0QmVmb3JlKGluc05vZGUsIHRhcmdldE5vZGUuY2hpbGROb2Rlc1tiZWZvcmVJbmRleF0pOwogICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoeGN1cikgewogICAgICAgICAgICAgICAgICAgICAgaW5zTm9kZS5vbmxvYWQgPSBmdW5jdGlvbiAoZW52KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbWdOb2RlID0geGN1ci5xdWVyeVNlbGVjdG9yKCIuQUMtZmF2aWNvblQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGltZ05vZGUubmF0dXJhbFdpZHRoIDwgMTApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdOb2RlLnNldEF0dHJpYnV0ZSgib2xkLXNyYyIsIGltZ05vZGUuc3JjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdOb2RlLnNyYyA9IEFDQ29uZmlnLmRlZmF1bHRGYXZpY29uVXJsOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGltZ05vZGUub25sb2FkID0gImphdmFzY3JpcHQ6dm9pZCgwKTsiOwogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9KSh0YXJnZXROb2RlKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGNoZWNrTm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCIpOwogICAgICAgICAgICBmb3IgKGxldCBmYU5vZGUgb2YgY2hlY2tOb2RlcykgewogICAgICAgICAgICAgIGxldCBmYXZpY29uTm9kZSA9IGZhTm9kZS5xdWVyeVNlbGVjdG9yKCIucmVzdWx0X19pY29uIGltZyIpOwogICAgICAgICAgICAgIGxldCBiZWZvcmVOb2RlID0gZmFOb2RlLnF1ZXJ5U2VsZWN0b3IoIi5yZXN1bHRfX3RpdGxlIGEiKTsKICAgICAgICAgICAgICBpZihmYXZpY29uTm9kZSAmJiBiZWZvcmVOb2RlKXsKICAgICAgICAgICAgICAgIGZhdmljb25Ob2RlLnN0eWxlID0gInZlcnRpY2FsLWFsaWduOm1pZGRsZTttYXJnaW4tcmlnaHQ6NXB4OyI7CiAgICAgICAgICAgICAgICBiZWZvcmVOb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGZhdmljb25Ob2RlLCBiZWZvcmVOb2RlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIEluc2VydFNldHRpbmdNZW51KCkgewogICAgICAgICAgaWYgKChjdXJTaXRlLlNpdGVUeXBlSUQgIT09IFNpdGVUeXBlLk9USEVSUykgJiYgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI215dXNlciIpID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBsZXQgcGFyZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3UsICNnYj5kaXY+ZGl2PmRpdiwgI2JfaGVhZGVyPiNpZF9oLCAudG9wLWJhciAuc29nb3Utc2V0LWJveCwgI2hlYWRlcl93cmFwcGVyIC5qcy1obC1idXR0b24sIGJvZHlbZG9nZV0gI2hlYWRlcl93cmFwcGVyICNoZWFkZXIiKTsgLy9iYWlkdTsgZ29vZ2xlOyBiaW5nOyDmkJzni5cKICAgICAgICAgICAgICBwYXJlbnQuc3R5bGUgPSAid2lkdGg6IGF1dG87IjsKICAgICAgICAgICAgICBsZXQgdXNlckFkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICB1c2VyQWRpdi5pZCA9ICJteXVzZXIiOwogICAgICAgICAgICAgIHVzZXJBZGl2LmlubmVySFRNTCA9IGA8aW5wdXQgdHlwZT0nc3VibWl0JyBjbGFzcz0nbXl1c2VyY29uZmlnJyB2YWx1ZT0nJHtBbGxEYXRhLmxhbi51c2UubWVudV90ZXh0fScvPjxzcGFuIGNsYXNzPSdhYy1uZXd2ZXJzaW9uRGlzcGxheScgc3R5bGU9J2JhY2tncm91bmQtY29sb3I6IHJlZDtmbG9hdDogbGVmdDtoZWlnaHQ6IDhweDt3aWR0aDogOHB4O2JvcmRlci1yYWRpdXM6IDRweDtkaXNwbGF5OiR7KENPTlNULmhhc05ld0Z1bmNOZWVkRGlzcGxheSA/ICJ1bnNldCIgOiAibm9uZSIpfSc+Jm5ic3A7PC9zcGFuPmA7CiAgICAgICAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZSh1c2VyQWRpdiwgcGFyZW50LmNoaWxkTm9kZXNbMF0pOwogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNteXVzZXIgLm15dXNlcmNvbmZpZyIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBBQ3RvZ2dsZVNldHRpbmdEaXNwbGF5KGUpOwogICAgICAgICAgICAgIH0sIHRydWUpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0oKTsgLy8g6K+75Y+W5Liq5Lq66K6+572u5L+h5oGvCiAgICAgIC8qKgogICAgICAgKiBAcGFyYW0gY2FsbGJhY2sg5Zue6LCD5Ye95pWw77yM6ZyA6KaB6L+U5Zue5piv5ZCm57uT5p2fVHJ1ZeOAgUZhbHNl44CB5ZCm5YiZ55u45b2T5LqO5a6a5pe25ZmoCiAgICAgICAqIGNhbGxiYWNrIHJldHVybjoKICAgICAgICogIHRydWUgPSDlgJLorqHml7YKICAgICAgICogIGZhbHNlID0g6K6h5pe25ZmoCiAgICAgICAqICBub25lID0g6K6h5pe25ZmoCiAgICAgICAqIEBwYXJhbSBwZXJpb2Qg5ZGo5pyf77yM5aaCOjIwMG1zCiAgICAgICAqIEBwYXJhbSBydW5Ob3cg56uL5Y2z5omn6KGMCiAgICAgICAqLwogICAgICBmdW5jdGlvbiBSQUZJbnRlcnZhbChjYWxsYmFjaywgcGVyaW9kLCBydW5Ob3cpIHsKICAgICAgICAvLyDkuIDnp5I2MOasoe+8jOWvueW6lDHnp5IxMDAwbXMKICAgICAgICBjb25zdCBuZWVkQ291bnQgPSBwZXJpb2QgLyAxMDAwICogNjA7CiAgICAgICAgbGV0IHRpbWVzID0gMDsgLy8g5bey57uP6K6h5pWw55qE5pWw6YePCgogICAgICAgIGlmKHJ1bk5vdyA9PT0gdHJ1ZSl7IC8vIOWvueS6jueri+WNs+aJp+ihjOWHveaVsOeahOeri+WNs+WIpOWumu+8jOWQpuWImei/m+ihjAogICAgICAgICAgY29uc3Qgc2hvdWxkRmluaXNoID0gY2FsbGJhY2soKTsKICAgICAgICAgIGlmKHNob3VsZEZpbmlzaCkgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3RlcCgpIHsKICAgICAgICAgIGlmKHRpbWVzIDwgbmVlZENvdW50KXsKICAgICAgICAgICAgLy8g6K6h5pWw5pyq57uT5p2fLee7p+e7reiuoeaVsAogICAgICAgICAgICB0aW1lcysrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoc3RlcCkKICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAvLyDorqHmlbDnu5PmnZ8t5YGc5q2i6K6h5pWw77yM5Yik5a6a57uT5p6cCiAgICAgICAgICAgIGNvbnN0IHNob3VsZEZpbmlzaCA9IGNhbGxiYWNrKCkgfHwgZmFsc2U7CiAgICAgICAgICAgIGlmKCFzaG91bGRGaW5pc2gpewogICAgICAgICAgICAgIC8vIOi/lOWbnuWAvOS4umZhbHNl77yM6YeN5ZCv6K6h5pWw5ZmoCiAgICAgICAgICAgICAgdGltZXMgPSAwOwogICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShzdGVwKQogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAvLyDov5Tlm57lgLzkuLp0cnVl77yM57uT5p2f6K6h5pWw5ZmoCiAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHN0ZXApOwogICAgICB9CgogICAgICBmdW5jdGlvbiBzYWZlRnVuY3Rpb24oZnVuYykgewogICAgICAgIHRyeSB7CiAgICAgICAgICBmdW5jKCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gc2FmZVdhaXRGdW5jKHNlbGVjdG9yLCBjYWxsYmFja0Z1bmMsIHRpbWUsIG5vdENsZWFyKSB7CiAgICAgICAgdGltZSA9IHRpbWUgfHwgNTA7CiAgICAgICAgbm90Q2xlYXIgPSBub3RDbGVhciB8fCBmYWxzZTsKICAgICAgICBsZXQgZG9DbGVhciA9ICFub3RDbGVhcjsKICAgICAgICBSQUZJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoKHR5cGVvZiAoc2VsZWN0b3IpID09ICJzdHJpbmciICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpICE9IG51bGwpKSB7CiAgICAgICAgICAgIGNhbGxiYWNrRnVuYyhkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKSk7CiAgICAgICAgICAgIGlmIChkb0NsZWFyKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAoKHR5cGVvZiAoc2VsZWN0b3IpID09ICJmdW5jdGlvbiIgJiYgc2VsZWN0b3IoKS5sZW5ndGggPiAwKSkgewogICAgICAgICAgICBjYWxsYmFja0Z1bmMoc2VsZWN0b3IoKVswXSk7CiAgICAgICAgICAgIGlmIChkb0NsZWFyKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9LCB0aW1lLCB0cnVlKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gQUNfYWRkU3R5bGUoY3NzLCBjbGFzc05hbWUsIGFkZFRvVGFyZ2V0LCBpc1JlbG9hZCwgaW5pdFR5cGUpIHsgLy8g5re75YqgQ1NT5Luj56CB77yM5LiN6ICD6JmR5paH5pys6L295YWl5pe26Ze077yM5Y+q5omn6KGM5LiA5qyhLeaXoOiuuuaIkOWKn+S4juWQpu+8jOW4puaciWNsYXNzTmFtZQogICAgICAgIFJBRkludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8qKgogICAgICAgICAgICogYWRkVG9UYXJnZXTov5nph4zkuI3opoHkvb/nlKhoZWFk5qCH562+LGhlYWTmoIfnrb7nmoRjc3PkvJrlnKhodG1s6L295YWl5pe25Yqg6L2977yMCiAgICAgICAgICAgKiBodG1s5Yqg6L295ZCO5Ly85LmO5LiN5Lya5YaN5qyh5Yqg6L2977yMYm9keeS8muiHquWKqOWKoOi9vQogICAgICAgICAgICogKiovCiAgICAgICAgICBsZXQgYWRkVG8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGFkZFRvVGFyZ2V0KTsKICAgICAgICAgIGlmICh0eXBlb2YgKGFkZFRvVGFyZ2V0KSA9PSAidW5kZWZpbmVkIikKICAgICAgICAgICAgYWRkVG8gPSAoZG9jdW1lbnQuaGVhZCB8fCBkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudCk7CiAgICAgICAgICBpc1JlbG9hZCA9IGlzUmVsb2FkIHx8IGZhbHNlOyAvLyDpu5jorqTmmK/pnZ7liqDovb3lnosKICAgICAgICAgIGluaXRUeXBlID0gaW5pdFR5cGUgfHwgInRleHQvY3NzIjsKICAgICAgICAgIC8vIOWmguaenOayoeacieebruagh+iKgueCuSjliJnnm7TmjqXliqApIHx8IOacieebruagh+iKgueCueS4lOaJvuWIsOS6huiKgueCuSjov5vooYzmlrDlop4pCiAgICAgICAgICBpZiAodHlwZW9mIChhZGRUb1RhcmdldCkgPT0gInVuZGVmaW5lZCIgfHwgKHR5cGVvZiAoYWRkVG9UYXJnZXQpICE9ICJ1bmRlZmluZWQiICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYWRkVG9UYXJnZXQpICE9IG51bGwpKSB7CiAgICAgICAgICAgIC8vIGNsZWFySW50ZXJ2YWwodG91dCk7CiAgICAgICAgICAgIC8vIOWmguaenHRydWUg5by66KGM6KaG55uW77yM5LiN566h5pyJ5rKh5pyJLS3lhYjliKDpmaQKICAgICAgICAgICAgLy8g5aaC5p6cZmFsc2XvvIzkuI3opobnm5bvvIzkvYbmmK/lpoLmnpzmnInnmoTor53vvIzopoHpgIDlh7rvvIzkuI3lrZjlnKjliJnmlrDlop4tLeaXoOmcgOWIoOmZpAogICAgICAgICAgICBpZiAoaXNSZWxvYWQgPT09IHRydWUpIHsKICAgICAgICAgICAgICBzYWZlUmVtb3ZlKCIuIiArIGNsYXNzTmFtZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNSZWxvYWQgPT09IGZhbHNlICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi4iICsgY2xhc3NOYW1lKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgLy8g6IqC54K55a2Y5ZyoICYmIOS4jeWHhuWkh+imhueblgogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBjc3NOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKICAgICAgICAgICAgaWYgKGNsYXNzTmFtZSAhPSBudWxsKSBjc3NOb2RlLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICAgICAgICAgICAgY3NzTm9kZS5zZXRBdHRyaWJ1dGUoInR5cGUiLCBpbml0VHlwZSk7CiAgICAgICAgICAgIGNzc05vZGUuaW5uZXJIVE1MID0gY3NzOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGFkZFRvLmFwcGVuZENoaWxkKGNzc05vZGUpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coZS5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9LCAyMCwgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHNhZmVSZW1vdmUoY3NzU2VsZWN0b3IpIHsKICAgICAgICBzYWZlRnVuY3Rpb24oKCkgPT4gewogICAgICAgICAgbGV0IHJlbW92ZU5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjc3NTZWxlY3Rvcik7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbW92ZU5vZGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVOb2Rlc1tpXS5yZW1vdmUoKTsKICAgICAgICB9KQogICAgICB9CgogICAgICBmdW5jdGlvbiBzYWZlUmVtb3ZlX3hwYXRoKHhwYXRoU2VsZWN0b3IpIHsKICAgICAgICBzYWZlRnVuY3Rpb24oKCkgPT4gewogICAgICAgICAgbGV0IHJlbW92ZU5vZGVzID0gZ2V0QWxsRWxlbWVudHMoeHBhdGhTZWxlY3Rvcik7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlbW92ZU5vZGVzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICByZW1vdmVOb2Rlc1tpXS5yZW1vdmUoKTsKICAgICAgICB9KQogICAgICB9CgogICAgICBmdW5jdGlvbiBjaGVja0lTQmFpZHVNYWluKCkgeyAvLyDpppbpobU9dHJ1ZTvpnZ7pppbpobU9ZmFsc2UKICAgICAgICAvLyDlpoLmnpzmmK/nmb7luqYgJiYgIOayoeaciSjnmb7luqbmkJzntKLnu5PmnpznmoTmoIflv5ctW+WtmOWcqF3nmb7luqbnmoTlhoXlrrkpIHJldHVybjsKICAgICAgICByZXR1cm4gIShjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkJBSURVICYmICEobG9jYXRpb24uaHJlZi5yZXBsYWNlKC8oJnxcPykod2R8d29yZCk9LywgIiIpICE9PSBsb2NhdGlvbi5ocmVmIHx8IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNjb250ZW50X2xlZnQiKSB8fAogICAgICAgICAgICAoKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNrdyIpICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNrdyIpLmdldEF0dHJpYnV0ZSgidmFsdWUiKSkgfHwgIiIpICE9PSAiIikKICAgICAgICApCiAgICAgIH0KCiAgICAgIC8qKgogICAgICAgKiDmo4Dmn6Vkb2N1bWVudOeahOWtkOiKgueCueaYr+WQpuWQq+acieWFg+e0oAogICAgICAgKiBAcGFyYW0gbm9kZUNsYXNzIOW+heajgOafpeWFg+e0oAogICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHxGCiAgICAgICAqLwogICAgICBmdW5jdGlvbiBjaGVja0RvY21lbnRIYXNOb2RlKG5vZGVDbGFzcykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZG9jdW1lbnQuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGRvY3VtZW50LmNoaWxkTm9kZXNbaV0uZGF0YSAmJiBkb2N1bWVudC5jaGlsZE5vZGVzW2ldLmRhdGEuaW5kZXhPZihub2RlQ2xhc3MpID4gMCkKICAgICAgICAgICAgcmV0dXJuIHtyZXM6IHRydWUsIG5vZGU6IGRvY3VtZW50LmNoaWxkTm9kZXNbaV19OwogICAgICAgIH0KICAgICAgICByZXR1cm4ge3JlczogZmFsc2UsIG5vZGU6IG51bGx9OwogICAgICB9CgogICAgICBmdW5jdGlvbiBGU0JhaWR1KCkgeyAvLyB0aGFua3MgZm9yIGNvZGUgZnJvbSDmta7nlJ9A5pyq5q2HIEBwYWdlIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvemgtVFcvc2NyaXB0cy8zMTY0MgogICAgICAgIC8vIGRlYnVnKCLliJ3lp4vljJZGU0JBSURVIik7CgogICAgICAgIENPTlNULlN0eWxlTWFuZ2VyID0gewogICAgICAgICAgLyoqCiAgICAgICAgICAgKiDlr7zlhaVjc3PlhoXlrrnkuLrjgJDmlofmnKzmoLzlvI/jgJHvvIHvvIHvvIEKICAgICAgICAgICAqIEBwYXJhbSBkYXRhIGNzc+WGheWuuQogICAgICAgICAgICogQHBhcmFtIHRvQ2xhc3NOYW1lIOmihOacn+eahOexu+WQjQogICAgICAgICAgICovCiAgICAgICAgICBpbXBvcnRTdHlsZTogZnVuY3Rpb24gKGRhdGEsIHRvQ2xhc3NOYW1lLCB1c2VOb3JtYWxDU1MsIG11c3RMb2FkKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgKGRhdGEpID09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgLy8g6L+Z5Liq5bGF54S25ZyoVk3kuIrlh7rpl67popjkuobvvIzlvojlpYfmgKoKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJHTV9nZXRSZXNvdXJjZVRleHTojrflj5blhoXlrrnmlbDmja7lvILluLgiKTsKICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICB1c2VOb3JtYWxDU1MgPSB1c2VOb3JtYWxDU1MgfHwgZmFsc2U7CiAgICAgICAgICAgIG11c3RMb2FkID0gbXVzdExvYWQgfHwgZmFsc2U7CiAgICAgICAgICAgIC8vIOaZrumAmua1j+iniOWZqOaooeW8jy0t5L2G5piv5Ly85LmO5qC35byP5Yqg6L2955qE5LyY5YWI57qn5L2O5LqOaGVhZOS4reeahHN0eWxl5LyY5YWI57qnCiAgICAgICAgICAgIGlmICghdXNlTm9ybWFsQ1NTKSB7CiAgICAgICAgICAgICAgLy8g6YCa6L+HbXVzdOWPguaVsOadpeWIpOWumnN0eWxl5piv5ZCm5Yqg6L29CiAgICAgICAgICAgICAgLy8gZGF0YSA9IGRhdGEucmVwbGFjZSgvYmFpZHUuY29tI1wkIy9pZ20sICcnKTsKICAgICAgICAgICAgICBpZiAoZGF0YS5pbmRleE9mKCJodHRwIikgIT09IDApIGRhdGEgPSAiZGF0YTp0ZXh0L2Nzczt1dGYtOCwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGRhdGEpOwogICAgICAgICAgICAgIHZhciB7cmVzLH0gPSBjaGVja0RvY21lbnRIYXNOb2RlKHRvQ2xhc3NOYW1lKTsKICAgICAgICAgICAgICBpZiAoIXJlcykgewogICAgICAgICAgICAgICAgbGV0IHBpID0gZG9jdW1lbnQuY3JlYXRlUHJvY2Vzc2luZ0luc3RydWN0aW9uKAogICAgICAgICAgICAgICAgICAieG1sLXN0eWxlc2hlZXQiLAogICAgICAgICAgICAgICAgICBgdHlwZT0idGV4dC9jc3MiIG11c3Q9IiR7bXVzdExvYWR9IiBjbGFzcz0iJHt0b0NsYXNzTmFtZX0iIGhyZWY9IiR7ZGF0YX0iYAogICAgICAgICAgICAgICAgKTsgLy8g5rOo5oSP5b+F6aG76KaB5Y+M5byV5Y+3CiAgICAgICAgICAgICAgICBkb2N1bWVudC5pbnNlcnRCZWZvcmUocGksIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8qICoqKioqKioqKirlpJrph43moLflvI8t5YW85a65ZWRnZSAmJiDpu5HlpJzohJrmnKwqKioqKioqKioqKiogKi8KICAgICAgICAgICAgICBBQ19hZGRTdHlsZShkYXRhLCB0b0NsYXNzTmFtZSwgImhlYWQiLCBmYWxzZSwgInRleHQvY3NzIik7CiAgICAgICAgICAgICAgLyogKioqKioqKioqKuWkmumHjeagt+W8jy3lhbzlrrllZGdlICYmIOm7keWknOiEmuacrCoqKioqKioqKioqKiAqLwogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgLy/liqDovb3mma7pgJrmoLflvI8KICAgICAgICAgIGxvYWRDb21tb25TdHlsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmxvYWRTdHlsZShDT05TVC51c2VJdGVtLm5hbWUgKyAiQ29tbW9uU3R5bGUiLCBDT05TVC51c2VJdGVtLm5hbWUgKyAiQ29tbW9uU3R5bGUiKTsKICAgICAgICAgIH0sCiAgICAgICAgICBsb2FkQmFpZHVMaXRlU3R5bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgQ09OU1QuU3R5bGVNYW5nZXIubG9hZFN0eWxlKCJiYWlkdUxpdGVTdHlsZSIsICJiYWlkdUxpdGVTdHlsZSIsIG51bGwsIGZhbHNlLCB0cnVlKTsKICAgICAgICAgICAgQ09OU1QuU3R5bGVNYW5nZXIubG9hZFBsYWluVG9DU1MoImJhaWR1TGl0ZVN0eWxlIik7CiAgICAgICAgICB9LAogICAgICAgICAgbG9hZFN0eWxlOiBhc3luYyBmdW5jdGlvbiAoc3R5bGVOYW1lLCBpbnNDbGFzc05hbWUsIHNldFVybCwgdXNlTm9ybWFsQ1NTLCBtdXN0TG9hZCkgewogICAgICAgICAgICAvLyDlhajpg6jph4fnlKh0ZXh0L2Nzc+eahOWGheWuueadpei9veWFpQogICAgICAgICAgICAvLyDlpoLmnpzmmK9kZWJ1Z+aooeW8j+OAguaIluiAheaYr2dt5qih5byPCiAgICAgICAgICAgIGlmIChpc0xvY2FsRGVidWcpIHsKICAgICAgICAgICAgICBkZWJ1Zygi5pys5ZywLeWKoOi9veagt+W8j++8miIgKyBpbnNDbGFzc05hbWUpOwogICAgICAgICAgICAgIHNldFVybCA9IHNldFVybCB8fCAiaHR0cDovLzEyNy4wLjAuMS8iICsgc3R5bGVOYW1lICsgIi5jc3MiOwogICAgICAgICAgICAgIHRoaXMuaW1wb3J0U3R5bGUoc2V0VXJsLCAiQUMtIiArIGluc0NsYXNzTmFtZSwgdXNlTm9ybWFsQ1NTLCBtdXN0TG9hZCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOZXdHTSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgIC8vIOS7heeUqOS6jkdyZWFzZU1vbmtleTQuMCsKICAgICAgICAgICAgICBkZWJ1Zygi54m55q6K5qih5byPLeWKoOi9veagt+W8j++8miIgKyBpbnNDbGFzc05hbWUpOwogICAgICAgICAgICAgIHNldFVybCA9IHNldFVybCB8fCAiaHR0cHM6Ly9iYWlkdS5odHQ1LmNvbS9uZXdjc3MvIiArIHN0eWxlTmFtZSArICIuY3NzIjsKICAgICAgICAgICAgICB0aGlzLmltcG9ydFN0eWxlKHNldFVybCwgIkFDLSIgKyBpbnNDbGFzc05hbWUsIHVzZU5vcm1hbENTUywgbXVzdExvYWQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRlYnVnKCLliqDovb3moLflvI/vvJoiICsgaW5zQ2xhc3NOYW1lKTsKICAgICAgICAgICAgICAvLyBUYW1wZXJNb25rZXkgKyBHcmVhc2VNb25rZXkgPCA0LjAgKyBWaW9sZW50TW9ua2V5ICg0LjBHcmVhc2VNb25rZXnkuI3mlK/mjIFHZXRSZXNvdXJjZeaWueazlSkKICAgICAgICAgICAgICB0aGlzLmltcG9ydFN0eWxlKGF3YWl0IEdNX2dldFJlc291cmNlVGV4dChzdHlsZU5hbWUpLCAiQUMtIiArIGluc0NsYXNzTmFtZSwgdXNlTm9ybWFsQ1NTLCBtdXN0TG9hZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAvL+WKoOi9veaKpOecvOaooeW8j+agt+W8jwogICAgICAgICAgbG9hZEh1WWFuU3R5bGU6IGZ1bmN0aW9uIChjb2xvcikgewogICAgICAgICAgICBsZXQgc3R5bGUgPSAiYm9keVtiYWlkdV0sI3dyYXBwZXIgI2hlYWQsI3dyYXBwZXIgI3NfdGFiLGZvcm0uZm0gLnNfaXB0X3dyLmJne2JhY2tncm91bmQtY29sb3I6I2ZmZn0jY29udGFpbmVyICNjb250ZW50X2xlZnQgLnJlc3VsdC1vcCwjY29udGFpbmVyICNjb250ZW50X2xlZnQgLnJlc3VsdCwjY29udGFpbmVyICNycywjY29udGFpbmVyICNjb250ZW50X3JpZ2h0e2JhY2tncm91bmQtY29sb3I6I2FhYTtib3JkZXI6MXB4IGRvdWJsZSAjYTJkN2Q0O2JvcmRlci1yYWRpdXM6MH0jY29udGFpbmVyICNjb250ZW50X2xlZnQgLnJlc3VsdC1vcDpob3ZlciwjY29udGFpbmVyICNjb250ZW50X2xlZnQgLnJlc3VsdDpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNjY2MhaW1wb3J0YW50fSNjb250YWluZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0LW9wIGgzLCNjb250YWluZXIgI2NvbnRlbnRfbGVmdCAuYy1jb250YWluZXIgaDMsI2NvbnRhaW5lciAjcnMgLnR0e2JhY2tncm91bmQtY29sb3I6I2JiYn0ubmFfY250IC5ud3NfaXRtLC5ud3NfaXRtYiwjYl9jb250ZW50ICNiX3Jlc3VsdHMgbGksYm9keSAjYl9oZWFkZXJ7YmFja2dyb3VuZC1jb2xvcjojYWFhO2JvcmRlcjoxcHggZG91YmxlICNhMmQ3ZDQ7Ym9yZGVyLXJhZGl1czowfSNiX2NvbnRlbnQgI2JfcmVzdWx0cyBsaTpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNjY2MhaW1wb3J0YW50fSNiX2NvbnRlbnQgI2JfcmVzdWx0cyBsaSBoMntiYWNrZ3JvdW5kLWNvbG9yOiNiYmJ9I3JzbyAuZywuYmtXTWdkPi5nLC5ia1dNZ2QgZy1pbm5lci1jYXJkLCNyaHNjb2wgI3JocywjcmhzY29sICNyaHMgLmc+ZGl2LC5jMnh6VGIgLmcsLnJ1VGNJZCAuZywuZm0wNklmIC5nLC5jVW5RS2UgLmcsLkhhblFtZiAuZ3tiYWNrZ3JvdW5kLWNvbG9yOiNhYWE7Ym9yZGVyOjFweCBkb3VibGUgI2EyZDdkNDtib3JkZXItcmFkaXVzOjB9I3JzbyAuZzpob3ZlciwuYmtXTWdkPi5nOmhvdmVye2JhY2tncm91bmQtY29sb3I6I2NjYyFpbXBvcnRhbnR9LmJrV01nZCAuZyBkaXYuciwjcnNvIC5nIGgze2JhY2tncm91bmQtY29sb3I6I2JiYn0iOwogICAgICAgICAgICBpZiAoQUNDb25maWcuaXNVc2VyQ29sb3JFbmFibGUpIHsKICAgICAgICAgICAgICBjb2xvciA9IGNvbG9yIHx8IEFDQ29uZmlnLmRlZmF1bHRIdVlhbkNvbG9yIHx8ICIjRkZGRkZGIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb2xvciA9IGNvbG9yIHx8ICIjRkZGRkZGIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29sb3IuaW5kZXhPZigiIyIpICE9PSAwIHx8IGNvbG9yLmxlbmd0aCA8IDcpIHJldHVybjsKICAgICAgICAgICAgaWYgKGlzTmV3R00gPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgc3R5bGUgPSBHTV9nZXRSZXNvdXJjZVRleHQoIk1haW5IdVlhblN0eWxlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3R5bGUgPSBzdHlsZQogICAgICAgICAgICAucmVwbGFjZSgvI2FhYShhKikvaWdtLCBjb2xvcikKICAgICAgICAgICAgLnJlcGxhY2UoLyNiYmIoYiopL2lnbSwgdGhpcy5MaWdodGVyKGNvbG9yLCAtNDApKQogICAgICAgICAgICAucmVwbGFjZSgvI2NjYyhjKikvaWdtLCB0aGlzLkxpZ2h0ZXIoY29sb3IsIDQ1KSk7CiAgICAgICAgICAgIEFDX2FkZFN0eWxlKHN0eWxlLCAiQUMtIiArIENPTlNULnVzZUl0ZW0ubmFtZSArICJIdVlhblN0eWxlIiArIChpc05ld0dNID8gIiIgOiAiLUZpbGUiKSwgImhlYWQiLCB0cnVlKTsgLy8g6ZyA6KaB5L+u5pS555qE77yM5omA5Lul5Li6dHJ1ZQogICAgICAgICAgfSwKICAgICAgICAgIGNsaXAyNTU6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICBpZiAodmFsdWUgPiAyNTUpIHJldHVybiAyNTU7CiAgICAgICAgICAgIGlmICh2YWx1ZSA8IDApIHJldHVybiAwOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9LAogICAgICAgICAgTGlnaHRlcjogZnVuY3Rpb24gKG9yaVJHQiwgZGVsdGFZKSB7CiAgICAgICAgICAgIC8vIOaMieavlOS+i+e8qeaUviArIDEvZGVsdGFZCiAgICAgICAgICAgIC8vIEhFWCAyIFJHQgogICAgICAgICAgICBsZXQgcmdiID0gb3JpUkdCLnJlcGxhY2UoIiMiLCAiIik7CiAgICAgICAgICAgIGxldCBSID0gcGFyc2VJbnQoIjB4IiArIHJnYi5zdWJzdHIoMCwgMikpOwogICAgICAgICAgICBsZXQgRyA9IHBhcnNlSW50KCIweCIgKyByZ2Iuc3Vic3RyKDIsIDIpKTsKICAgICAgICAgICAgbGV0IEIgPSBwYXJzZUludCgiMHgiICsgcmdiLnN1YnN0cig0LCAyKSk7CiAgICAgICAgICAgIC8vIFJHQiAyIFlVVgogICAgICAgICAgICBsZXQgWSA9ICgoNjYgKiBSICsgMTI5ICogRyArIDI1ICogQiArIDEyOCkgPj4gOCkgKyAxNjsKICAgICAgICAgICAgbGV0IFUgPSAoKC0zOCAqIFIgLSA3NCAqIEcgKyAxMTIgKiBCICsgMTI4KSA+PiA4KSArIDEyODsKICAgICAgICAgICAgbGV0IFYgPSAoKDExMiAqIFIgLSA5NCAqIEcgLSAxOCAqIEIgKyAxMjgpID4+IDgpICsgMTI4OwogICAgICAgICAgICBZID0gWSAqICgxICsgMS4wIC8gZGVsdGFZKTsvLyDmj5Dpq5jkuq7luqYKICAgICAgICAgICAgLy8gWVVWIDIgUkdCCiAgICAgICAgICAgIFIgPSB0aGlzLmNsaXAyNTUoKDI5OCAqIChZIC0gMTYpICsgNDA5ICogKFYgLSAxMjgpICsgMTI4KSA+PiA4KTsKICAgICAgICAgICAgRyA9IHRoaXMuY2xpcDI1NSgoMjk4ICogKFkgLSAxNikgLSAxMDAgKiAoVSAtIDEyOCkgLSAyMDggKiAoViAtIDEyOCkgKyAxMjgpID4+IDgpOwogICAgICAgICAgICBCID0gdGhpcy5jbGlwMjU1KCgyOTggKiAoWSAtIDE2KSArIDUxNiAqIChVIC0gMTI4KSArIDEyOCkgPj4gOCk7CiAgICAgICAgICAgIHJldHVybiAiIyIgKyAoKFIgPDwgMTYpICsgKEcgPDwgOCkgKyBCKS50b1N0cmluZygxNik7CiAgICAgICAgICB9LAogICAgICAgICAgLy/liqDovb3ljZXpobXmoLflvI8KICAgICAgICAgIGxvYWRPbmVQYWdlU3R5bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5sb2FkU3R5bGUoQ09OU1QudXNlSXRlbS5uYW1lICsgIk9uZVBhZ2VTdHlsZSIsIENPTlNULnVzZUl0ZW0ubmFtZSArICJPbmVQYWdlU3R5bGUiKTsKICAgICAgICAgIH0sCiAgICAgICAgICAvL+WKoOi9veWPjOmhteagt+W8jwogICAgICAgICAgbG9hZFR3b1BhZ2VTdHlsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmxvYWRTdHlsZShDT05TVC51c2VJdGVtLm5hbWUgKyAiVHdvUGFnZVN0eWxlIiwgQ09OU1QudXNlSXRlbS5uYW1lICsgIlR3b1BhZ2VTdHlsZSIpOwogICAgICAgICAgICBsZXQgY3NzSGVhZCA9ICIiOwogICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5CQUlEVSkgY3NzSGVhZCA9ICIjY29udGFpbmVyICNjb250ZW50X2xlZnQsIGJvZHlbbmV3c10gI2NvbnRhaW5lciAjY29udGVudF9sZWZ0PmRpdjpub3QoW2NsYXNzXSk6bm90KFtpZF0pIjsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuR09PR0xFKSBjc3NIZWFkID0gIi5zcmcsICNyc28iOwogICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5CSU5HKSBjc3NIZWFkID0gIiNiX2NvbnRlbnQgI2JfcmVzdWx0cyI7CiAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLlNPR09VKSBjc3NIZWFkID0gIiNtYWluIC5yZXN1bHRzIjsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuRFVDSykgY3NzSGVhZCA9ICIjbGlua3Nfd3JhcHBlciAucmVzdWx0cy0tbWFpbiAjbGlua3MiOwogICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5ET0dFKSBjc3NIZWFkID0gIiNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1tYWluICNsaW5rcyI7CiAgICAgICAgICAgIEFDX2FkZFN0eWxlKGNzc0hlYWQgKyAie2dyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDIsbWlubWF4KDUwJSwxZnIpKTtncmlkLXRlbXBsYXRlLWFyZWFzOid4bWFpbiB4bWFpbic7fS5BQy5zcC1zZXBhcmF0b3J7Z3JpZC1jb2x1bW4tc3RhcnQ6IDE7Z3JpZC1jb2x1bW4tZW5kOiB4bWFpbi1lbmQ7fSIsCiAgICAgICAgICAgICAgIkFDLVR3b1BhZ2VFeFN0eWxlIiwgImhlYWQiKTsKICAgICAgICAgIH0sCiAgICAgICAgICAvLyDliqDovb3kuInliJfmoLflvI8KICAgICAgICAgIGxvYWRUaHJlZVBhZ2VTdHlsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBsZXQgY3NzSGVhZCA9ICIiOwogICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5CQUlEVSkgY3NzSGVhZCA9ICIjY29udGFpbmVyICNjb250ZW50X2xlZnQsIGJvZHlbbmV3c10gI2NvbnRhaW5lciAjY29udGVudF9sZWZ0PmRpdjpub3QoW2NsYXNzXSk6bm90KFtpZF0pIjsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuR09PR0xFKSBjc3NIZWFkID0gIi5zcmcsICNyc28iOwogICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5CSU5HKSBjc3NIZWFkID0gIiNiX2NvbnRlbnQgI2JfcmVzdWx0cyI7CiAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLlNPR09VKSBjc3NIZWFkID0gIiNtYWluIC5yZXN1bHRzIjsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuRFVDSykgY3NzSGVhZCA9ICIjbGlua3Nfd3JhcHBlciAucmVzdWx0cy0tbWFpbiAjbGlua3MiOwogICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5ET0dFKSBjc3NIZWFkID0gIiNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1tYWluICNsaW5rcyI7CiAgICAgICAgICAgIEFDX2FkZFN0eWxlKGNzc0hlYWQgKyAie2dyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDMsbWlubWF4KDMzJSwxZnIpKTtncmlkLXRlbXBsYXRlLWFyZWFzOid4bWFpbiB4bWFpbiB4bWFpbic7fSIsCiAgICAgICAgICAgICAgIkFDLVRocmVlUGFnZUV4U3R5bGUiLCAiaGVhZCIpOwogICAgICAgICAgfSwKICAgICAgICAgIC8vIOWKoOi9veWbm+WIl+agt+W8jwogICAgICAgICAgbG9hZEZvdXJQYWdlU3R5bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbGV0IGNzc0hlYWQgPSAiIjsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuQkFJRFUpIGNzc0hlYWQgPSAiI2NvbnRhaW5lciAjY29udGVudF9sZWZ0LCBib2R5W25ld3NdICNjb250YWluZXIgI2NvbnRlbnRfbGVmdD5kaXY6bm90KFtjbGFzc10pOm5vdChbaWRdKSI7CiAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkdPT0dMRSkgY3NzSGVhZCA9ICIuc3JnLCAjcnNvIjsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuQklORykgY3NzSGVhZCA9ICIjYl9jb250ZW50ICNiX3Jlc3VsdHMiOwogICAgICAgICAgICBpZiAoY3VyU2l0ZS5TaXRlVHlwZUlEID09PSBTaXRlVHlwZS5TT0dPVSkgY3NzSGVhZCA9ICIjbWFpbiAucmVzdWx0cyI7CiAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkRPR0UpIGNzc0hlYWQgPSAiI2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW4gI2xpbmtzIjsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuRE9HRSkgY3NzSGVhZCA9ICIjbGlua3Nfd3JhcHBlciAucmVzdWx0cy0tbWFpbiAjbGlua3MiOwogICAgICAgICAgICBBQ19hZGRTdHlsZShjc3NIZWFkICsgIntncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCg0LG1pbm1heCgyNSUsMWZyKSk7Z3JpZC10ZW1wbGF0ZS1hcmVhczoneG1haW4geG1haW4geG1haW4geG1haW4nO30iLAogICAgICAgICAgICAgICJBQy1Gb3VyUGFnZUV4U3R5bGUiLCAiaGVhZCIpOwogICAgICAgICAgfSwKICAgICAgICAgIGxvYWRQbGFpblRvQ1NTOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZG9jdW1lbnQuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGxldCBjdXJOb2RlID0gZG9jdW1lbnQuY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgICBpZiAoY3VyTm9kZS5kZWwpIGN1ck5vZGUucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2FmZVJlbW92ZSgic3R5bGVbY2xhc3MqPSdBQyddW2RlbD0nMSddIik7CiAgICAgICAgICB9LAogICAgICAgICAgLy8g56aB5q2i54us56uL55qE5qC35byP5Yqg6L29CiAgICAgICAgICBsb2FkQ1NTVG9QbGFpbjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRvY3VtZW50LmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBsZXQgY3VyTm9kZSA9IGRvY3VtZW50LmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgICAgLy8g5aaC5p6c5piv5a2Y5ZyoY3Nz77yMIOS4lOmdnuW/hemhu+aVsOaNrgogICAgICAgICAgICAgIGlmIChjdXJOb2RlLnRhcmdldCA9PT0gInhtbC1zdHlsZXNoZWV0IiAmJiBjdXJOb2RlLmRhdGEuaW5kZXhPZigibXVzdD1cInRydWUiKSA8IDApIHsKICAgICAgICAgICAgICAgIGN1ck5vZGUuZGF0YSA9ICIiOwogICAgICAgICAgICAgICAgY3VyTm9kZS5kZWwgPSB0cnVlOwoKICAgICAgICAgICAgICAgIC8vIOWvueS6jmVkZ2XlkoxzYWZhcmnpg73nibnmrorlpITnkIbkuIDkuIvlkKcKICAgICAgICAgICAgICAgIGlmIChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZigiZWRnZSIpID4gMCB8fCBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZigic2FmYXJpIikgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGN1ck5vZGUucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgaW5pdCgpIHsKICAgICAgICAgICAgQ29udHJvbE1hbmFnZXIuaW5pdCgpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdmFyIENvbnRyb2xNYW5hZ2VyID0gewogICAgICAgICAgLy/lsYXkuK3mmL7npLogLS0tIOW/hemhu+aYr+eZvuW6puWSjOiwt+atjOeahOaQnOe0oue7k+aenOmhtemdou+8jOWFtuS7lumhtemdouS4jeiDveWKoOi9veeahC0t5bey57uP6YCa6L+H6ISa5pysaW5jbHVkZeagh+etvumZkOWItuS6huS4gOmDqOWIhgogICAgICAgICAgY2VudGVyRGlzcGxheTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyDlpoLmnpzmmK/nmb7luqYgJiYgKCjlnLDlnYDmm7/mjaItPuWMheWQq3dk5YWz6ZSu6K+NW+abv+aNouS5i+WQjuS4jeetiS3mmK/nmb7luqbnu5PmnpzpobXpnaJdKSB8fCDmnInlj7PovrnmoI8t6IKv5a6a5piv55m+5bqm5pCc57Si57uT5p6c6aG1IHx8IHZhbHVl5Lit5a2Y5Zyo5pCc57Si5YaF5a65KSByZXR1cm47CiAgICAgICAgICAgIGlmICghY2hlY2tJU0JhaWR1TWFpbigpKSB7CiAgICAgICAgICAgICAgQ09OU1QuU3R5bGVNYW5nZXIubG9hZENTU1RvUGxhaW4oKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEFDX2FkZFN0eWxlKCIubWluaWRpdiAjbG9nbyBpbWd7d2lkdGg6IDEwMHB4O2hlaWdodDogdW5zZXQ7bWFyZ2luLXRvcDogMC4zcmVtO30iLCAiQUMtc3R5bGUtbG9nbyIsICJoZWFkIik7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSBwYXJzZUludChDT05TVC51c2VJdGVtLkFkc1N0eWxlTW9kZSB8fCAtMSk7CiAgICAgICAgICAgIGlmIChhY0Nzc0xvYWRGbGFnID09PSBmYWxzZSAmJiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuQUNFeHRlbnNpb24iKSA9PT0gbnVsbCkgewogICAgICAgICAgICAgIGRlYnVnKCJpbuagt+W8j+WNs+WwhuWKoOi9vToiICsgcmVzdWx0KTsKICAgICAgICAgICAgICBsZXQgZXhwYW5kU3R5bGUgPSAiI3dyYXBwZXIgI3JzLCAjd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQsICN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVye21pbi13aWR0aDo2NzBweDt9LmMtc3BhbjE4e3dpZHRoOjc4JSFpbXBvcnRhbnQ7bWluLXdpZHRoOjU1MHB4O30uYy1zcGFuMjR7d2lkdGg6IGF1dG8haW1wb3J0YW50O30iOwogICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IDEpIHsKICAgICAgICAgICAgICAgIEFDX2FkZFN0eWxlKGV4cGFuZFN0eWxlLCAiQUMtU3R5bGUtZXhwYW5kIiwgImhlYWQiKTsKICAgICAgICAgICAgICAgIENPTlNULlN0eWxlTWFuZ2VyLmxvYWRDb21tb25TdHlsZSgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0ID09PSAyKSB7Ly/ljZXpobXlsYXkuK0KICAgICAgICAgICAgICAgIEFDX2FkZFN0eWxlKGV4cGFuZFN0eWxlLCAiQUMtU3R5bGUtZXhwYW5kIiwgImhlYWQiKTsKICAgICAgICAgICAgICAgIENPTlNULlN0eWxlTWFuZ2VyLmxvYWRDb21tb25TdHlsZSgpOwogICAgICAgICAgICAgICAgQ09OU1QuU3R5bGVNYW5nZXIubG9hZE9uZVBhZ2VTdHlsZSgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0ID09PSAzKSB7IC8v5Y+M6aG15bGF5LitCiAgICAgICAgICAgICAgICBDT05TVC5TdHlsZU1hbmdlci5sb2FkQ29tbW9uU3R5bGUoKTsKICAgICAgICAgICAgICAgIENPTlNULlN0eWxlTWFuZ2VyLmxvYWRUd29QYWdlU3R5bGUoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdCA9PT0gNCkgeyAvLyDkuInliJcKICAgICAgICAgICAgICAgIENPTlNULlN0eWxlTWFuZ2VyLmxvYWRDb21tb25TdHlsZSgpOwogICAgICAgICAgICAgICAgQ09OU1QuU3R5bGVNYW5nZXIubG9hZFR3b1BhZ2VTdHlsZSgpOwogICAgICAgICAgICAgICAgQ09OU1QuU3R5bGVNYW5nZXIubG9hZFRocmVlUGFnZVN0eWxlKCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQgPT09IDUpIHsgLy8g5Zub5YiXCiAgICAgICAgICAgICAgICBDT05TVC5TdHlsZU1hbmdlci5sb2FkQ29tbW9uU3R5bGUoKTsKICAgICAgICAgICAgICAgIENPTlNULlN0eWxlTWFuZ2VyLmxvYWRUd29QYWdlU3R5bGUoKTsKICAgICAgICAgICAgICAgIENPTlNULlN0eWxlTWFuZ2VyLmxvYWRGb3VyUGFnZVN0eWxlKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFjQ3NzTG9hZEZsYWcgPSB0cnVlOwogICAgICAgICAgICAgIGRlYnVnKCJpbuagt+W8j+i/kOihjOe7k+adnyIpOwogICAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgPT09IFNpdGVUeXBlLkJBSURVICYmIEFDQ29uZmlnLlN0eWxlX0JhaWR1TGl0ZSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgQUNfYWRkU3R5bGUoR01fZ2V0UmVzb3VyY2VUZXh0KCJiYWlkdUxpdGVTdHlsZSIpLCAiQUMtYmFpZHVMaXRlU3R5bGUiLCAiaGVhZCIpCiAgICAgICAgICAgICAgICBDT05TVC5TdHlsZU1hbmdlci5sb2FkQmFpZHVMaXRlU3R5bGUoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjdXJTaXRlLlNpdGVUeXBlSUQgIT09IFNpdGVUeXBlLkJBSURVICYmIGN1clNpdGUuU2l0ZVR5cGVJRCAhPT0gU2l0ZVR5cGUuQkFJRFVfWFVFU0hVICYmIGN1clNpdGUuU2l0ZVR5cGVJRCAhPT0gU2l0ZVR5cGUuR09PR0xFICYmIGN1clNpdGUuU2l0ZVR5cGVJRCAhPT0gU2l0ZVR5cGUuQklORyAmJiBjdXJTaXRlLlNpdGVUeXBlSUQgIT09IFNpdGVUeXBlLlNPR09VICYmIGN1clNpdGUuU2l0ZVR5cGVJRCAhPT0gU2l0ZVR5cGUuRFVDSyAmJiBjdXJTaXRlLlNpdGVUeXBlSUQgIT09IFNpdGVUeXBlLkRPR0UpIHJldHVybjsKCiAgICAgICAgICAgIC8vIOWmguaenOaYr+iwt+atjCAmJiAo5Zyw5Z2A5pu/5o2iLT7mmK/osLfmrYzlm77lg4/pobXpnaIgfHwg5piv5Zyw5Zu+6aG16Z2iKVvmm7/mjaLopoHlj5hdIHJldHVybjsKICAgICAgICAgICAgaWYgKGN1clNpdGUuU2l0ZVR5cGVJRCA9PT0gU2l0ZVR5cGUuR09PR0xFICYmIGxvY2F0aW9uLmhyZWYucmVwbGFjZSgvdGJtPShpc2NofGxjbHxzaG9wfGZsbSkvLCAiIikgIT09IGxvY2F0aW9uLmhyZWYpIHsKICAgICAgICAgICAgICBDT05TVC5TdHlsZU1hbmdlci5sb2FkQ1NTVG9QbGFpbigpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvKirmiqTnnLxTdHlsZeacgOWQjui9veWFpSoqLwogICAgICAgICAgICBpZiAoQ09OU1QudXNlSXRlbS5IdVlhbk1vZGUgPT09IHRydWUgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic3R5bGVbY2xhc3MqPSdkYXJrcmVhZGVyJ10iKSAhPSBudWxsKSBDT05TVC5TdHlsZU1hbmdlci5sb2FkSHVZYW5TdHlsZSgpOwoKICAgICAgICAgICAgQ09OU1QuU3R5bGVNYW5nZXIubG9hZFBsYWluVG9DU1MoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChDT05TVC5pc0dvb2dsZUltYWdlVXJsKSByZXR1cm47CiAgICAgICAgICAgIHRoaXMuY2VudGVyRGlzcGxheSgpOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgLy8gZGVidWcoIuiwg+eUqOWKoOi9veiHquWumuS5iWNzcyIpOwogICAgICAgIENvbnRyb2xNYW5hZ2VyLmluaXQoKTsKICAgICAgICByZXR1cm4gQ09OU1QuU3R5bGVNYW5nZXI7CiAgICAgIH0KICAgIH0KICB9KSgpOwp9KCk7Cg==","resources":[{"meta":{"name":"baiduCommonStyle.css","url":"http://ibaidu.ntaow.com/newcss/baiduCommonStyle.css?t=24.12","ts":1605621954415,"mimetype":"text/css"},"source":"aWZyYW1lOm5vdChbc3JjKj1jaHJvbWVdKSwucmVzX3RvcF9iYW5uZXIgI2Zvb3QsI3BhZ2UgLmZrLCNoZWFkIC5oZWFkQmxvY2ssI3JzX3RvcF9uZXcsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdD50YWJsZSwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5jLXJlY29tbWVuZCwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5sZWZ0QmxvY2ssI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucnJlY29tLWJ0bi1wYXJlbnQsI2RlbW8sI3dyYXBwZXIgI2dvdG9QYWdlLGJvZHk+ZGl2LnJlc3VsdC1vcCwucnJlY29tLWNvbnRhaW5lciwuY2h1bndhbi13cmFwcGVye2Rpc3BsYXk6bm9uZSFpbXBvcnRhbnR9I3dyYXBwZXIgI2NvbnRlbnRfcmlnaHR7bWFyZ2luLXJpZ2h0Oi02JX1ib2R5W2JhaWR1XXtiYWNrZ3JvdW5kLWNvbG9yOiNmNWY1ZjU7dHJhbnNpdGlvbjphbGwgMS41c30jYWxhX2ltZ19yZXN1bHRze292ZXJmbG93OmhpZGRlbn1ib2R5IGEsYm9keSBhIGVtLCN1IGEsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3Atc29mdC10aXRsZSBhIGVtLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdCBoMyBhIGVte3RleHQtZGVjb3JhdGlvbjpub25lfWJvZHkgYTpob3Zlcixib2R5IGE6aG92ZXIgZW17dGV4dC1kZWNvcmF0aW9uOm5vbmV9I3dyYXBwZXIgI3NfdGFie2JvcmRlci1ib3R0b206I2UwZTBlMCAxcHggc29saWQ7YmFja2dyb3VuZC1jb2xvcjojZjhmOGY4fWJvZHkgI2hlYWR7YmFja2dyb3VuZC1jb2xvcjpyZ2JhKDI0OCwyNDgsMjQ4LC40KTtib3JkZXItYm90dG9tOm5vbmU7YmFja2Ryb3AtZmlsdGVyOmJsdXIoMTBweCl9Zm9ybS5mbXtiYWNrZ3JvdW5kLWNvbG9yOnVuc2V0fWZvcm0uZm0gLmJkc3VnIGxpe3dpZHRoOmF1dG87Y29sb3I6IzAwMDtmb250OjE1cHggYXJpYWw7bGluZS1oZWlnaHQ6MjZweH1mb3JtLmZtIC5zX2lwdF93ci5iZ3tiYWNrZ3JvdW5kOiNmZmY7d2lkdGg6NjYlO21pbi13aWR0aDo1NzBweH0jY29udGVudF9sZWZ0IC5uZXctcG1kIC5jLXNwYW45LCNjb250ZW50X2xlZnQgLm5ldy1wbWQgLmMtc3BhbjEwe3dpZHRoOnVuc2V0O2Zsb2F0OnVuc2V0fSNoZWFkIC5oZWFkX3dyYXBwZXJ7d2lkdGg6dW5zZXR9Zm9ybS5mbSAuc19idG57YmFja2dyb3VuZDojMzQ3NmQyO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICMzNDc2ZDJ9Zm9ybS5mbSAuc19idG46aG92ZXJ7YmFja2dyb3VuZDojNGY3ZmJmO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICMzNDc2ZDJ9I3dyYXBwZXIgI3NfdGFiIGJ7Y29sb3I6IzM0NzZkMjtib3JkZXItYm90dG9tOjNweCAjMzQ3NmQyIHNvbGlkfSN3cmFwcGVyIC5oZWFkX251bXNfY29udF9vdXRlciAuc2VhcmNoX3Rvb2xfY29udGVyLCN3cmFwcGVyIC5oZWFkX251bXNfY29udF9vdXRlciAubnVtc3t3aWR0aDo2MzBweH0jd3JhcHBlciAjY29udGVudF9sZWZ0e2FuaW1hdGlvbi1uYW1lOmFuaV9ib3R0b21Ub3RvcDstd2Via2l0LWFuaW1hdGlvbi1kdXJhdGlvbjouMnM7LXdlYmtpdC1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOmVhc2V9I2hlYWQgLmhlYWRfd3JhcHBlcnthbmltYXRpb24tbmFtZTphbmlfbGVmdFRvcmlnaHQ7LXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb246LjJzOy13ZWJraXQtYW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjplYXNlLW91dH0jd3JhcHBlciAjcnMsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0LCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVye3dpZHRoOjY3MHB4O3BhZGRpbmc6MCAyMHB4IDE1cHg7bWFyZ2luLXRvcDowO21hcmdpbi1ib3R0b206MzBweDtib3JkZXItcmFkaXVzOjA7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JveC1zaXppbmc6Ym9yZGVyLWJveDtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMCwwLDAsLjEpO3RyYW5zaXRpb246YWxsIC4ycyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzO292ZXJmbG93OmhpZGRlbn0jd3JhcHBlciAjY29udGVudF9sZWZ0IC5jLWNvbnRhaW5lcjpob3Zlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQ6aG92ZXIsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuYy1jb250YWluZXI6aG92ZXIgYXJ0aWNsZXtib3JkZXI6MXB4IHNvbGlkIHJnYmEoMCwwLDAsLjMpO2JveC1zaGFkb3c6MCAwIDFweCBncmV5Oy13ZWJraXQtYm94LXNoYWRvdzowIDAgMXB4IGdyZXk7LW1vei1ib3gtc2hhZG93OjAgMCAxcHggZ3JheX0jd3JhcHBlciAjcnNbYWMtbmVlZGhpZGVdLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdFthYy1uZWVkaGlkZV0sI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuYy1jb250YWluZXJbYWMtbmVlZGhpZGVde3BhZGRpbmc6NXB4O3BhZGRpbmctbGVmdDoxNXB4fSN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdFt0cGw9c29mdF0gLm9wLXNvZnQtdGl0bGUsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0IGgzLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVyIGgze2JhY2tncm91bmQtY29sb3I6I2Y4ZjhmODttYXJnaW46MCAtMjBweCAxMHB4O3BhZGRpbmc6OHB4IDIwcHggNXB4O2JvcmRlci1yYWRpdXM6NXB4IDVweCAwIDB9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuZjEzIGEsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuZjEzIGVtLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtc3BhbjE4IGEsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuc3ViTGlua19mYWN0b3J5IGEsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuc3ViTGlua19hbnN3ZXIgYSwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5jLXRhYnMtY29udGVudCBhLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wX29mZmljYWxfd2VpYm9fY29udGVudCBhLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wX29mZmljYWxfd2VpYm9fcHogYSwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcF90aWViYTJfdGFibGlua3NfY29udGFpbmVyIGEsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3AtdGllYmEtZ2VuZXJhbC1yaWdodCwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcF9kcTAxX3RpdGxlLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wX2RxMDFfdGFibGUgYSwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcF9kcTAxX21vcmVsaW5rIGEsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3AtdGllYmEtZ2VuZXJhbC1tYWlucGwgYSwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcC1zZS1saXN0ZW4tcmVjb21tZW5kLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtb2Zmc2V0PmRpdiBhe3RleHQtZGVjb3JhdGlvbjpub25lO2NvbG9yOiMzNDc2ZDJ9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuZjEzIGE6aG92ZXIsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuZjEzIGVtOmhvdmVyLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnN1YkxpbmtfZmFjdG9yeSBhOmhvdmVyLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnN1YkxpbmtfYW5zd2VyIGE6aG92ZXIsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuYy10YWJzLWNvbnRlbnQgYTpob3Zlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcF90aWViYTJfdGFibGlua3NfY29udGFpbmVyIGE6aG92ZXIsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3AtdGllYmEtZ2VuZXJhbC1yaWdodDpob3Zlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcF9kcTAxX3RpdGxlOmhvdmVyLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wX2RxMDFfdGFibGUgYTpob3Zlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcF9kcTAxX21vcmVsaW5rIGE6aG92ZXIsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3AtdGllYmEtZ2VuZXJhbC1tYWlucGwgYTpob3Zlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcC1zZS1saXN0ZW4tcmVjb21tZW5kOmhvdmVyLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtb2Zmc2V0PmRpdiBhOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmUhaW1wb3J0YW50fSN3cmFwcGVyICNjb250ZW50X2xlZnQgLmYxMyBhe2NvbG9yOmdyZWVufSN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtc3BhbjE4LCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtc3BhbjI0e3dpZHRoOjEwMCU7bWluLXdpZHRoOnVuc2V0fSN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtYm9yZGVye3dpZHRoOmF1dG87Ym9yZGVyOm5vbmU7Ym9yZGVyLWJvdHRvbS1jb2xvcjp0cmFuc3BhcmVudDtib3JkZXItcmlnaHQtY29sb3I6dHJhbnNwYXJlbnQ7Ym94LXNoYWRvdzowIDAgMCB0cmFuc3BhcmVudDstd2Via2l0LWJveC1zaGFkb3c6MCAwIDAgdHJhbnNwYXJlbnQ7LW1vei1ib3gtc2hhZG93OjAgMCAwIHRyYW5zcGFyZW50Oy1vLWJveC1zaGFkb3c6MCAwIDAgdHJhbnNwYXJlbnR9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuc2VfY29tX2lycmVndWxhcl9nYWxsZXJ5IHVsIGxpLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wX2ppbmd5YW5fbGlzdCwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQgLm9wLWltZy1hZGRyZXNzLWxpbmstdHlwZXtkaXNwbGF5OmlubGluZS1ibG9jazttYXJnaW4tbGVmdDoxMHB4fSN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVyW3RwbD1zb2Z0XSAub3Atc29mdC10aXRsZSBhLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVyW3RwbD1zb2Z0XSAub3Atc29mdC10aXRsZSBhIGVtLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVyIGgzIGEsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0IGgzIGEgZW0sI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0LW9wIGgzIGEgZW17Y29sb3I6IzM0NzZkMjtmb250LXdlaWdodDo3MDB9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3Atc29mdC10aXRsZSBhLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdCBoMyBhLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdC1vcCBoMyBhe3Bvc2l0aW9uOnJlbGF0aXZlfSN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wLXNvZnQtdGl0bGUgYTpob3ZlcjphZnRlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQgaDMgYTpob3ZlcjphZnRlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQtb3AgaDMgYTpob3ZlcjphZnRlcntsZWZ0OjA7d2lkdGg6MTAwJTstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXM7LW1vei10cmFuc2l0aW9uOndpZHRoIDM1MG1zO3RyYW5zaXRpb246d2lkdGggMzUwbXN9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3Atc29mdC10aXRsZSBhOmFmdGVyLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdCBoMyBhOmFmdGVyLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdC1vcCBoMyBhOmFmdGVye2NvbnRlbnQ6IiI7cG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyLWJvdHRvbToycHggc29saWQgIzM0NzZkMjtib3R0b206LTJweDtsZWZ0OjEwMCU7d2lkdGg6MDstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtczstbW96LXRyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtczt0cmFuc2l0aW9uOndpZHRoIDM1MG1zLGxlZnQgMzUwbXN9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0IGgzLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdC1vcCBoMywjd3JhcHBlciAjY29udGVudF9sZWZ0IC5jLWNvbnRhaW5lciBoM3tmb250LXdlaWdodDo3MDA7Zm9udC1zaXplOm1lZGl1bX0jd3JhcHBlciAjY29udGVudF9sZWZ0IC5vcC1zb2Z0LXRpdGxlIGEgI2NvbnRlbnRfbGVmdCAucmVzdWx0IGgzIGEsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3Atc29mdC10aXRsZSBhICNjb250ZW50X2xlZnQgLnJlc3VsdC1vcCBoMyBhe3Bvc2l0aW9uOnJlbGF0aXZlfSN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wLXNvZnQtdGl0bGUgYTp2aXNpdGVkLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wLXNvZnQtdGl0bGUgYTp2aXNpdGVkIGVtLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdCBoMyBhOnZpc2l0ZWQsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0IGgzIGE6dmlzaXRlZCBlbXtjb2xvcjojNjA5fSN3cmFwcGVyICNjb250ZW50X2xlZnQgLm9wLXNvZnQtdGl0bGUgYTp2aXNpdGVkOmhvdmVyOmFmdGVyLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdCBoMyBhOnZpc2l0ZWQ6aG92ZXI6YWZ0ZXIsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0LW9wIGgzIGE6dmlzaXRlZDpob3ZlcjphZnRlcntsZWZ0OjA7d2lkdGg6MTAwJTstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXM7LW1vei10cmFuc2l0aW9uOndpZHRoIDM1MG1zO3RyYW5zaXRpb246d2lkdGggMzUwbXN9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAub3Atc29mdC10aXRsZSBhOnZpc2l0ZWQ6YWZ0ZXIsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0IGgzIGE6dmlzaXRlZDphZnRlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQtb3AgaDMgYTp2aXNpdGVkOmFmdGVye2NvbnRlbnQ6IiI7cG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyLWJvdHRvbToycHggc29saWQgIzYwOTtib3R0b206LTJweDtsZWZ0OjEwMCU7d2lkdGg6MDstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtczstbW96LXRyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtczt0cmFuc2l0aW9uOndpZHRoIDM1MG1zLGxlZnQgMzUwbXN9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuYy1ncm91cC13cmFwcGVye3BhZGRpbmc6MDttYXJnaW46MCAyMHB4IDIwcHggMTBweH0jd3JhcHBlciAjY29udGVudF9sZWZ0IC5jLWdyb3VwLXdyYXBwZXIgLmMtZ3JvdXB7bWFyZ2luOjA7cGFkZGluZy10b3A6MTBweH0jd3JhcHBlciAjcnN7bWFyZ2luLXRvcDowO3BhZGRpbmc6MCAyMHB4IDE1cHg7Ym9yZGVyLXJhZGl1czo1cHg7ei1pbmRleDoxfS53cmFwcGVyX25ldyAjZm9ybSAuYmRzdWctbmV3e3BhZGRpbmctcmlnaHQ6MTFweH0jd3JhcHBlciAjcnMgLnR0e21hcmdpbjowIC0yMHB4IDVweDtwYWRkaW5nOjVweCAyMHB4O2JhY2tncm91bmQtY29sb3I6I2Y4ZjhmODtib3JkZXItcmFkaXVzOjVweCA1cHggMCAwfSN3cmFwcGVyICNycyB0YWJsZXt3aWR0aDo2MzBweDtwYWRkaW5nOjVweCAxNXB4fSN3cmFwcGVyICNycyB0YWJsZSB0ciBhe21hcmdpbi10b3A6NXB4O21hcmdpbi1ib3R0b206NXB4O2NvbG9yOiMzNDc2ZDJ9I3dyYXBwZXIgI3JzIHRhYmxlIHRyIGE6aG92ZXJ7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZX0jd3JhcHBlciAjcGFnZXttaW4td2lkdGg6NzEwcHg7aGVpZ2h0OjQwcHg7bGluZS1oZWlnaHQ6NDBweDtwYWRkaW5nLXRvcDo1cHg7bWFyZ2luLWJvdHRvbTo1MHB4O21hcmdpbi1sZWZ0OjB9Lm9wLWltZy1hZGRyZXNzLWRlc2t0b3AtY29udHtvdmVyZmxvdzpoaWRkZW59I3dyYXBwZXIgI3BhZ2UgYSwjd3JhcHBlciAjcGFnZSBzdHJvbmd7Y29sb3I6IzM0NzZkMjtoZWlnaHQ6YXV0b30jd3JhcHBlciAjcGFnZSAubntoZWlnaHQ6MzRweH0jd3JhcHBlciAjcGFnZSAubjpob3Zlciwjd3JhcHBlciAjcGFnZSBhOmhvdmVyIC5wY3tib3JkZXI6MXB4IHNvbGlkIHRyYW5zcGFyZW50O2JhY2tncm91bmQ6I2Q4ZDhkODtjb2xvcjojMDA1N2RhfSN3cmFwcGVyICNwYWdlIHN0cm9uZyAucGN7YmFja2dyb3VuZDojMzQ3NmQyO2NvbG9yOiNmZmZ9Lm9wLWltZy1hZGRyZXNzLWRpdmlkZS1oaWdoe292ZXJmbG93OmhpZGRlbn0jd3JhcHBlciAja3d7d2lkdGg6OTQlfSNjb250YWluZXIuc2FtX25ld2dyaWQgLmMtY29udGFpbmVyIC50IC5BQy1mYXZpY29uVH5hLCNjb250YWluZXIuc2FtX25ld2dyaWQgLmMtY29udGFpbmVyIC50IC5jLWljb25+YXtkaXNwbGF5OmlubGluZX1ib2R5ICN3cmFwcGVyICNjb250ZW50X2xlZnQgYVtocmVmKj1vZmZpY2lhbF17Y29sb3I6I2ZmZn0jY29udGVudF9sZWZ0IC5jLWdyb3VwLW1pZGRsZSwjY29udGVudF9sZWZ0IC5jLWdyb3VwLXRvcHttYXJnaW4tYm90dG9tOjMwcHghaW1wb3J0YW50fUAtd2Via2l0LWtleWZyYW1lcyBhbmlfYm90dG9tVG90b3B7MCV7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlWSgzMnB4KTtvcGFjaXR5OjB9MjAle29wYWNpdHk6MH0zMCV7b3BhY2l0eTouOH0xMDAle29wYWNpdHk6MX19QC13ZWJraXQta2V5ZnJhbWVzIGFuaV9sZWZ0VG9yaWdodHswJXstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGVYKC0zMnB4KTtvcGFjaXR5OjB9MjAle29wYWNpdHk6MH0zMCV7b3BhY2l0eTouOH0xMDAle29wYWNpdHk6MX19QC13ZWJraXQta2V5ZnJhbWVzIGFuaV90b3BUb2J1dHRvbXswJXstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGVZKC0zMnB4KTtvcGFjaXR5OjB9MjAle29wYWNpdHk6MH0zMCV7b3BhY2l0eTouOH0xMDAle29wYWNpdHk6MX19I2NvbnRhaW5lci5zYW1fbmV3Z3JpZCAjY29udGVudF9sZWZ0IC5jLWNvbnRhaW5lciAuYy1jb250YWluZXJ7d2lkdGg6YXV0bzttaW4td2lkdGg6dW5zZXR9LmMtY29udGFpbmVyIC5jLXJlc3VsdC1jb250ZW50e3BhZGRpbmctdG9wOjIwcHh9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuYy1jb250YWluZXIgYXJ0aWNsZXtwYWRkaW5nLXRvcDoxNXB4O2JvcmRlcjp1bnNldCFpbXBvcnRhbnQ7Ym94LXNoYWRvdzp1bnNldCFpbXBvcnRhbnR9Ym9keSAud3JhcHBlcl9uZXcgI2hlYWQuZml4LWhlYWQgLnNfZm9ybXtoZWlnaHQ6NzBweH0uQUMuc3Atc2VwYXJhdG9ye21hcmdpbi10b3A6LTEwcHg7d2lkdGg6NjUwcHh9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuYy1jb250YWluZXJbdHBsPXJlY29tbWVuZF9saXN0XXtwYWRkaW5nLXRvcDoxMHB4O2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXJ9QG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDoxMjgwcHgpeyN1IC50b2luZGV4LCN1ICNpbXNne2Rpc3BsYXk6bm9uZX19QG1lZGlhIHNjcmVlbiBhbmQgKG1pbi13aWR0aDoxOTIxcHgpeyNoZWFkIC5oZWFkX3dyYXBwZXJ7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoLTE0MHB4LDAsMXB4KTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoLTE0MHB4LDAsMXB4KTtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2Rpc3BsYXk6ZmxleH19"},{"meta":{"name":"baiduOnePageStyle.css","url":"http://ibaidu.ntaow.com/newcss/baiduOnePageStyle.css?t=24.12","ts":1605621954421,"mimetype":"text/css"},"source":"I3dyYXBwZXJfd3JhcHBlciAjY29udGFpbmVye3dpZHRoOjEwMCU7bWFyZ2luLWxlZnQ6dW5zZXR9Zm9ybS5mbXtwb3NpdGlvbjpyZWxhdGl2ZTtiYWNrZ3JvdW5kLWNvbG9yOnVuc2V0fWJvZHlbYmFpZHVdIC5wYWdlZm9vdC5nanttYXJnaW4tdG9wOjEwMHB4fSNyZXN1bHRfbG9nb3twb3NpdGlvbjpyZWxhdGl2ZX0jc190YWIgYiwjc190YWIgYXtwb3NpdGlvbjpyZWxhdGl2ZX0jd3JhcHBlciAuaGVhZF9udW1zX2NvbnRfb3V0ZXJ7cG9zaXRpb246YWJzb2x1dGU7bGVmdDoyMCU7d2lkdGg6NjAlfSN3cmFwcGVyICNjb250ZW50X2xlZnQsI3dyYXBwZXIgI2NvbnRhaW5lci5zYW1fbmV3Z3JpZCAjcnMsI3dyYXBwZXIgI3BhZ2V7dG9wOjM1cHg7cG9zaXRpb246cmVsYXRpdmU7cGFkZGluZy1sZWZ0OjA7d2lkdGg6NDAlIWltcG9ydGFudDttaW4td2lkdGg6NjcwcHg7ZmxvYXQ6dW5zZXQ7bWFyZ2luLWxlZnQ6dW5zZXQ7bWFyZ2luOjAgYXV0b30jd3JhcHBlciAjY29udGFpbmVyLnNhbV9uZXdncmlkICNjb250ZW50X2xlZnR7cGFkZGluZy1sZWZ0OjIwcHh9I3dyYXBwZXIgI3BhZ2V7YmFja2dyb3VuZDp1bnNldH0jd3JhcHBlciAjcnMgdGh7dGV4dC1hbGlnbjpjZW50ZXJ9I3dyYXBwZXIgI3Jze3Bvc2l0aW9uOnJlbGF0aXZlO21hcmdpbjozMHB4IGF1dG8gLTIwcHh9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAuYy1jb250YWluZXJ7d2lkdGg6MTAwJSFpbXBvcnRhbnQ7bWluLXdpZHRoOjY1MHB4fUBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6MTAwMHB4KXsjd3JhcHBlciAjY29udGVudF9sZWZ0LCN3cmFwcGVyICNyc3ttaW4td2lkdGg6ODAwcHh9fSN3cmFwcGVyICNjb250ZW50X3JpZ2h0e21hcmdpbi1yaWdodDpjYWxjKDE1dncgLSAyMTBweCk7ZGlzcGxheTpub25lfUBtZWRpYSBzY3JlZW4gYW5kIChtaW4td2lkdGg6MTYwMHB4KXsjd3JhcHBlciAjY29udGVudF9yaWdodHtkaXNwbGF5OmJsb2NrO2Zsb2F0OnVuc2V0O3Bvc2l0aW9uOmFic29sdXRlfX0jd3JhcHBlciAjcGFnZSBhLCN3cmFwcGVyICNwYWdlIHN0cm9uZ3ttYXJnaW4tcmlnaHQ6MjJweCFpbXBvcnRhbnR9I3dyYXBwZXIgI3BhZ2UgLnBhZ2UtaW5uZXJ7cGFkZGluZy1sZWZ0OjIycHg7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXJ9LnNfdGFiX2lubmVye2Rpc3BsYXk6YmxvY2shaW1wb3J0YW50fSNjb250YWluZXIgLmhpbnRfY29tbW9uX3Jlc3RvcHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OmNhbGMoNDV2dyAtIDUwMHB4KTttYXJnaW4tdG9wOjI1cHh9LkFDLnNwLXNlcGFyYXRvcnt3aWR0aDphdXRvfSNzZWotY29udGFpbmVye3BhZGRpbmctbGVmdDpjYWxjKDQ0JSAtIDQ3OHB4KSFpbXBvcnRhbnR9LnNfZm9ybV93cmFwcGVye2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyfSN3cmFwcGVyICNzX3RhYntwYWRkaW5nLWxlZnQ6MDttYXJnaW4tbGVmdDowO2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyfSN3cmFwcGVyICNjb250YWluZXIgLmhlYWRfbnVtc19jb250X291dGVyIC5zZWFyY2hfdG9vbF9jb250ZXIsI3dyYXBwZXIgI2NvbnRhaW5lciAuaGVhZF9udW1zX2NvbnRfb3V0ZXIgLm51bXN7d2lkdGg6NjklO21hcmdpbi1sZWZ0OjE2JX1AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOjE0NTBweCl7Zm9ybS5mbSAuc19pcHRfd3IuYmd7bWluLXdpZHRoOjMzMHB4fX0="},{"meta":{"name":"baiduTwoPageStyle.css","url":"http://ibaidu.ntaow.com/newcss/baiduTwoPageStyle.css?t=24.12","ts":1605621954356,"mimetype":"text/css"},"source":"I3dyYXBwZXJfd3JhcHBlciAjY29udGFpbmVye3dpZHRoOmF1dG99Zm9ybS5mbXtwb3NpdGlvbjpyZWxhdGl2ZTtiYWNrZ3JvdW5kLWNvbG9yOnVuc2V0fSNzX3RhYiBiLCNzX3RhYiBhe3Bvc2l0aW9uOnJlbGF0aXZlfSN3cmFwcGVyICNzX3RhYntwYWRkaW5nLWxlZnQ6MDttYXJnaW4tbGVmdDowO2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyfSN3cmFwcGVyIC5oZWFkX251bXNfY29udF9vdXRlciAuc2VhcmNoX3Rvb2xfY29udGVyLCN3cmFwcGVyIC5oZWFkX251bXNfY29udF9vdXRlciAubnVtc3t3aWR0aDo4MCU7bWFyZ2luLWxlZnQ6MTAlfSN3cmFwcGVyIC5oZWFkX251bXNfY29udF9vdXRlciwuaGludF9jb21tb25fcmVzdG9wLCNoZWFkZXJfdG9wX2Jhcntwb3NpdGlvbjpyZWxhdGl2ZTtsZWZ0OjEwJTt3aWR0aDo4MCV9I3dyYXBwZXIgI2hlYWRlcl90b3BfYmFye21hcmdpbi1ib3R0b206MH1ib2R5ICNjb250YWluZXIuc2FtX25ld2dyaWQgI2NvbnRlbnRfbGVmdHt3aWR0aDo4MCV9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdHtkaXNwbGF5OmlubGluZS1ncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczo1MCUgNTAlO2dyaWQtdGVtcGxhdGUtYXJlYXM6InhtYWluIHhtYWluIjttYXJnaW46MCBhdXRvO3Bvc2l0aW9uOnJlbGF0aXZlO3BhZGRpbmctbGVmdDo1JTtmbG9hdDp1bnNldDt3aWR0aDo4MCU7bWFyZ2luLWxlZnQ6NyU7bWFyZ2luLWJvdHRvbTozMHB4fWJvZHlbbmV3c10gI3dyYXBwZXIgI2NvbnRlbnRfbGVmdD5kaXY6bm90KFtjbGFzc10pOm5vdChbaWRdKXtkaXNwbGF5OmlubGluZS1ncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczo1MCUgNTAlO2dyaWQtdGVtcGxhdGUtYXJlYXM6InhtYWluIHhtYWluIn0jd3JhcHBlciAjY29udGVudF9yaWdodHtkaXNwbGF5Om5vbmUhaW1wb3J0YW50fSN3cmFwcGVyX3dyYXBwZXIgI2NvbnRhaW5lciAjcnN7cG9zaXRpb246cmVsYXRpdmU7bWFyZ2luOjAgYXV0b30jd3JhcHBlciAjcGFnZXttaW4td2lkdGg6NzEwcHg7aGVpZ2h0OjQwcHg7bGluZS1oZWlnaHQ6NDBweDtwYWRkaW5nOjVweCAxMHB4O21hcmdpbjowIGF1dG87dGV4dC1hbGlnbjpjZW50ZXI7cG9zaXRpb246cmVsYXRpdmV9I3dyYXBwZXIgI3BhZ2UgLnBhZ2UtaW5uZXJ7cGFkZGluZy1sZWZ0OjB9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0LCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVye3dpZHRoOnVuc2V0IWltcG9ydGFudDttYXgtd2lkdGg6MTAwJTttYXJnaW4tbGVmdDo1cHg7bWFyZ2luLXJpZ2h0OjE1cHh9I3dyYXBwZXIgI2NvbnRlbnRfbGVmdD4qOm5vdChbY2xhc3MqPXJlc3VsdF0pOm5vdChbY2xhc3MqPWMtZ3JvdXAtd3JhcHBlcl0pe2dyaWQtY29sdW1uLXN0YXJ0OjE7Z3JpZC1jb2x1bW4tZW5kOnhtYWluLWVuZH0uYy1jb250YWluZXIgaDMgYXt6LWluZGV4OjF9LkFDLnNwLXNlcGFyYXRvcnt3aWR0aDphdXRvfSNzZWotY29udGFpbmVye3BhZGRpbmctbGVmdDpjYWxjKDEyJSAtIDExM3B4KSFpbXBvcnRhbnR9LnNfZm9ybV93cmFwcGVye2p1c3RpZnktY29udGVudDpjZW50ZXI7ZGlzcGxheTpmbGV4fSN3cmFwcGVyIC5oZWFkX251bXNfY29udF9vdXRlciAuc2VhcmNoX3Rvb2xfY29udGVyLCN3cmFwcGVyIC5oZWFkX251bXNfY29udF9vdXRlciAubnVtc3t3aWR0aDo4MCV9QG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDoxMzg4cHgpe2Zvcm0uZm0gLnNfaXB0X3dyLmJne21pbi13aWR0aDo0MDBweH0ud3JhcHBlcl9uZXcgI3Jlc3VsdF9sb2dve21hcmdpbi1sZWZ0Oi0xMDBweH19"},{"meta":{"name":"baiduLiteStyle.css","url":"http://ibaidu.ntaow.com/newcss/baiduLiteStyle.css?t=24.12","ts":1605621954228,"mimetype":"text/css"},"source":"Kntmb250LWZhbWlseTotYXBwbGUtc3lzdGVtLGhlbHZldGljYSBuZXVlLEhlbHZldGljYSxuaW1idXMgc2FucyBsLEFyaWFsLGxpYmVyYXRpb24gc2FucyxwaW5nZmFuZyBzYyxoaXJhZ2lubyBzYW5zIGdiLHNvdXJjZSBoYW4gc2FucyBjbixzb3VyY2UgaGFuIHNhbnMgc2MsbWljcm9zb2Z0IHlhaGVpLHdlbnF1YW55aSBtaWNybyBoZWksd2VucXVhbnlpIHplbiBoZWksc3QgaGVpdGksU2ltSGVpLHdlbnF1YW55aSB6ZW4gaGVpIHNoYXJwLHNhbnMtc2VyaWZ9Ojotd2Via2l0LXNjcm9sbGJhcnt3aWR0aDo2cHg7aGVpZ2h0OjEwcHg7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudH06Oi13ZWJraXQtc2Nyb2xsYmFyLXRyYWNre2JhY2tncm91bmQtY29sb3I6cmdiYSgwLDAsMCwuMSl9Ojotd2Via2l0LXNjcm9sbGJhci10aHVtYntib3JkZXItcmFkaXVzOjNweDtiYWNrZ3JvdW5kLWNvbG9yOnJnYmEoMCwwLDAsLjIpO3RyYW5zaXRpb246YWxsIC40cyBlYXNlOy1tb3otdHJhbnNpdGlvbjphbGwgLjRzIGVhc2U7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCAuNHMgZWFzZTstby10cmFuc2l0aW9uOmFsbCAuNHMgZWFzZX06Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iOmhvdmVye2JvcmRlci1yYWRpdXM6M3B4O2JhY2tncm91bmQtY29sb3I6cmdiYSgwLDAsMCwuNCk7dHJhbnNpdGlvbjphbGwgLjRzIGVhc2U7LW1vei10cmFuc2l0aW9uOmFsbCAuNHMgZWFzZTstd2Via2l0LXRyYW5zaXRpb246YWxsIC40cyBlYXNlOy1vLXRyYW5zaXRpb246YWxsIC40cyBlYXNlfS5hbmltYXRlZHstd2Via2l0LWFuaW1hdGlvbi1kdXJhdGlvbjoxczthbmltYXRpb24tZHVyYXRpb246MXM7YW5pbWF0aW9uLWZpbGwtbW9kZTpib3RofUAtd2Via2l0LWtleWZyYW1lcyBmYWRlSW5VcHtmcm9te29wYWNpdHk6MDstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLDEwMCUsMCk7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsMTAwJSwwKX10b3tvcGFjaXR5OjE7LXdlYmtpdC10cmFuc2Zvcm06bm9uZTt0cmFuc2Zvcm06bm9uZX19QGtleWZyYW1lcyBmYWRlSW5VcHtmcm9te29wYWNpdHk6MDstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLDEwMCUsMCk7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsMTAwJSwwKX10b3tvcGFjaXR5OjE7LXdlYmtpdC10cmFuc2Zvcm06bm9uZTt0cmFuc2Zvcm06bm9uZX19LmZhZGVJblVwey13ZWJraXQtYW5pbWF0aW9uLW5hbWU6ZmFkZUluVXA7YW5pbWF0aW9uLW5hbWU6ZmFkZUluVXB9QC13ZWJraXQta2V5ZnJhbWVzIGJvdW5jZUluUmlnaHR7NjAlLDc1JSw5MCUsZnJvbSx0b3std2Via2l0LWFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246Y3ViaWMtYmV6aWVyKC4yMTUsLjYxLC4zNTUsMSk7YW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjpjdWJpYy1iZXppZXIoLjIxNSwuNjEsLjM1NSwxKX1mcm9te29wYWNpdHk6MDstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgzMDAwcHgsMCwwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMzAwMHB4LDAsMCl9NjAle29wYWNpdHk6MTstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgtMjVweCwwLDApO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgtMjVweCwwLDApfTc1JXstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGUzZCgxMHB4LDAsMCk7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDEwcHgsMCwwKX05MCV7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoLTVweCwwLDApO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgtNXB4LDAsMCl9dG97LXdlYmtpdC10cmFuc2Zvcm06bm9uZTt0cmFuc2Zvcm06bm9uZX19QGtleWZyYW1lcyBib3VuY2VJblJpZ2h0ezYwJSw3NSUsOTAlLGZyb20sdG97LXdlYmtpdC1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOmN1YmljLWJlemllciguMjE1LC42MSwuMzU1LDEpO2FuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246Y3ViaWMtYmV6aWVyKC4yMTUsLjYxLC4zNTUsMSl9ZnJvbXtvcGFjaXR5OjA7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMzAwMHB4LDAsMCk7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDMwMDBweCwwLDApfTYwJXtvcGFjaXR5OjE7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoLTI1cHgsMCwwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoLTI1cHgsMCwwKX03NSV7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMTBweCwwLDApO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgxMHB4LDAsMCl9OTAley13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZTNkKC01cHgsMCwwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoLTVweCwwLDApfXRvey13ZWJraXQtdHJhbnNmb3JtOm5vbmU7dHJhbnNmb3JtOm5vbmV9fS5ib3VuY2VJblJpZ2h0ey13ZWJraXQtYW5pbWF0aW9uLW5hbWU6Ym91bmNlSW5SaWdodDthbmltYXRpb24tbmFtZTpib3VuY2VJblJpZ2h0fUAtd2Via2l0LWtleWZyYW1lcyBib3VuY2VJblVwezYwJSw3NSUsOTAlLGZyb20sdG97LXdlYmtpdC1hbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOmN1YmljLWJlemllciguMjE1LC42MSwuMzU1LDEpO2FuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246Y3ViaWMtYmV6aWVyKC4yMTUsLjYxLC4zNTUsMSl9ZnJvbXtvcGFjaXR5OjA7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwzMDAwcHgsMCk7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsMzAwMHB4LDApfTYwJXtvcGFjaXR5OjE7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwtMjBweCwwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwtMjBweCwwKX03NSV7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwxMHB4LDApO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLDEwcHgsMCl9OTAley13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsLTVweCwwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwtNXB4LDApfXRvey13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsMCwwKTt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwwLDApfX1he3RleHQtZGVjb3JhdGlvbjpub25lO21hcmdpbi1ib3R0b206MnB4fS5jLXNob3d1cmw6aG92ZXJ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Ym9yZGVyOm5vbmU7b3BhY2l0eTouODt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstd2Via2l0LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30ucmVzLWdhcC1yaWdodDE2OmhvdmVye2JvcmRlci1ib3R0b206IzM0NzZkMiAxLjJweCBzb2xpZH0uYy1zaG93dXJse3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfS5jLXRpcC1hcnJvdzpob3Zlcnt0ZXh0LWRlY29yYXRpb246bm9uZTtib3JkZXI6bm9uZX0uYy1kZWZhdWx0IGF7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Ym9yZGVyOm5vbmV9LmMtZ2FwLWJvdHRvbSBhOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmV9Lm9wX2RpY3QzX21vcmVsaW5rIGE6aG92ZXJ7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZX0uYy1idG46aG92ZXJ7dGV4dC1kZWNvcmF0aW9uOm5vbmUhaW1wb3J0YW50fXRkIGE6aG92ZXJ7dGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZX1lbXt0ZXh0LWRlY29yYXRpb246bm9uZSFpbXBvcnRhbnR9I3Nfd3JhcHtkaXNwbGF5Om5vbmV9LnMtdG9wLW5hdntkaXNwbGF5Om5vbmV9I3NfY3RuZXJfbWVudXN7ZGlzcGxheTpub25lfSNzX21lbnVfZ3VyZHtkaXNwbGF5Om5vbmV9I3Nfc3RycHhfc3BhbjF7ZGlzcGxheTpub25lfSNmdENvbntkaXNwbGF5Om5vbmV9I2JvdHRvbV9jb250YWluZXJ7ZGlzcGxheTpub25lfSNsZ3tiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7YmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXI7aGVpZ2h0OjcwcHg7cGFkZGluZy10b3A6MTUwcHh9I2xnIGltZ3tkaXNwbGF5Om5vbmV9I2xnIGF7ZGlzcGxheTpub25lfSNoZWFkX3dyYXBwZXJ7cGFkZGluZy1ib3R0b206MH0uc19mb3JtX3dyYXBwZXJ7bWFyZ2luLXRvcDphdXRvO2Rpc3BsYXk6ZmxleH0jc19sZ19pbWcsI3NfbGdfaW1nX25ld3tkaXNwbGF5Om5vbmUhaW1wb3J0YW50fSNmb3JtIC5zX2lwdF93cntib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjNweDt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstd2Via2l0LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwcztiYWNrZ3JvdW5kLXBvc2l0aW9uOjEwMCUhaW1wb3J0YW50O2hlaWdodDozOXB4O2ZvbnQtZmFtaWx5Oi1hcHBsZS1zeXN0ZW0saGVsdmV0aWNhIG5ldWUsSGVsdmV0aWNhLG5pbWJ1cyBzYW5zIGwsQXJpYWwsbGliZXJhdGlvbiBzYW5zLHBpbmdmYW5nIHNjLGhpcmFnaW5vIHNhbnMgZ2Isc291cmNlIGhhbiBzYW5zIGNuLHNvdXJjZSBoYW4gc2FucyBzYyxtaWNyb3NvZnQgeWFoZWksd2VucXVhbnlpIG1pY3JvIGhlaSx3ZW5xdWFueWkgemVuIGhlaSxzdCBoZWl0aSxTaW1IZWksd2VucXVhbnlpIHplbiBoZWkgc2hhcnAsc2Fucy1zZXJpZjtwYWRkaW5nLXRvcDo0cHh9LnNfaXB0e2ZvbnQtZmFtaWx5Oi1hcHBsZS1zeXN0ZW0saGVsdmV0aWNhIG5ldWUsSGVsdmV0aWNhLG5pbWJ1cyBzYW5zIGwsQXJpYWwsbGliZXJhdGlvbiBzYW5zLHBpbmdmYW5nIHNjLGhpcmFnaW5vIHNhbnMgZ2Isc291cmNlIGhhbiBzYW5zIGNuLHNvdXJjZSBoYW4gc2FucyBzYyxtaWNyb3NvZnQgeWFoZWksd2VucXVhbnlpIG1pY3JvIGhlaSx3ZW5xdWFueWkgemVuIGhlaSxzdCBoZWl0aSxTaW1IZWksd2VucXVhbnlpIHplbiBoZWkgc2hhcnAsc2Fucy1zZXJpZn0jZm9ybSAuc19pcHRfd3I6aG92ZXJ7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czoycHg7dHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1vLXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9LmlwdGhvdmVye3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfS5pcHRmb2N1c3tib3gtc2hhZG93OjAgMnB4IDVweCAwIHJnYmEoMCwwLDAsLjE2KSwwIDJweCAxMHB4IDAgcmdiYSgwLDAsMCwuMTIpfWJvZHkgI2Zvcm0gLnNfYnRue3dpZHRoOjMycHg7aGVpZ2h0OjMycHg7Ym9yZGVyLXJhZGl1czo1MCU7Zm9udC1zaXplOjA7Ym9yZGVyOm5vbmU7Ym94LXNoYWRvdzpub25lO21hcmdpbi1sZWZ0OjA7ei1pbmRleDoxMDA7dHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1vLXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7bWFyZ2luLXRvcDowO29wYWNpdHk6MH1ib2R5ICNmb3JtIC5zX2J0bjpob3ZlcntvcGFjaXR5Oi41O2JhY2tncm91bmQ6dHJhbnNwYXJlbnQ7Ym9yZGVyOm5vbmU7Ym94LXNoYWRvdzpub25lO3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfWJvZHkgI2Zvcm0gLnNfYnRuX3dye3dpZHRoOjMycHg7aGVpZ2h0OjMycHg7Ym9yZGVyLXJhZGl1czo1MCU7Zm9udC1zaXplOjA7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtiYWNrZ3JvdW5kLXBvc2l0aW9uOjUwJTtib3JkZXI6bm9uZTtib3gtc2hhZG93Om5vbmU7bWFyZ2luLWxlZnQ6NXB4O3otaW5kZXg6MTAwO3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzO21hcmdpbi10b3A6NnB4fWJvZHkgI2Zvcm0gLnNfYnRuX3dyOmhvdmVye29wYWNpdHk6LjU7YmFja2dyb3VuZDp0cmFuc3BhcmVudDtib3JkZXI6bm9uZTtib3gtc2hhZG93Om5vbmU7dHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1vLXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9LmJ0bmhvdmVye29wYWNpdHk6LjU7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudCFpbXBvcnRhbnQ7Ym9yZGVyOm5vbmUhaW1wb3J0YW50O2JveC1zaGFkb3c6bm9uZTt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstd2Via2l0LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30uaGludF90b3BycV90aXBze21hcmdpbi1ib3R0b206MTJweH0uc19mb3Jte2hlaWdodDo3NXB4O3BhZGRpbmctdG9wOjEwcHh9I3NfdGFie3BhZGRpbmc6ODdweCAwIDAgMTIxcHh9I2hlYWQuc19kb3due2JveC1zaGFkb3c6MCAwIDVweCAjNjY2O3BhZGRpbmctYm90dG9tOjhweH0uYmRzdWd7dG9wOjQycHg7Ym94LXNoYWRvdzowIDJweCA1cHggMCByZ2JhKDAsMCwwLC4xNiksMCAycHggMTBweCAwIHJnYmEoMCwwLDAsLjEyKTtib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjAgMCAycHggMnB4O2ZvbnQtZmFtaWx5Oi1hcHBsZS1zeXN0ZW0saGVsdmV0aWNhIG5ldWUsSGVsdmV0aWNhLG5pbWJ1cyBzYW5zIGwsQXJpYWwsbGliZXJhdGlvbiBzYW5zLHBpbmdmYW5nIHNjLGhpcmFnaW5vIHNhbnMgZ2Isc291cmNlIGhhbiBzYW5zIGNuLHNvdXJjZSBoYW4gc2FucyBzYyxtaWNyb3NvZnQgeWFoZWksd2VucXVhbnlpIG1pY3JvIGhlaSx3ZW5xdWFueWkgemVuIGhlaSxzdCBoZWl0aSxTaW1IZWksd2VucXVhbnlpIHplbiBoZWkgc2hhcnAsc2Fucy1zZXJpZn0uYmdzdWcgbGl7Zm9udC1mYW1pbHk6SGVsdmV0aWNhLG1pY3Jvc29mdCB5YWhlaSB1aSFpbXBvcnRhbnQ7d2lkdGg6MTAwJSFpbXBvcnRhbnQ7bGluZS1oZWlnaHQ6MzZweCFpbXBvcnRhbnR9LmJnc3VnIHVsIGxpe2xpbmUtaGVpZ2h0OjMycHghaW1wb3J0YW50fS5iZHN1Zy1vdmVyZmxvd3tmb250LWZhbWlseTpIZWx2ZXRpY2EsbWljcm9zb2Z0IHlhaGVpIHVpIWltcG9ydGFudDt3aWR0aDo1ODNweCFpbXBvcnRhbnR9I3F1aWNrZGVsZXRle3RvcDo1cHghaW1wb3J0YW50O29wYWNpdHk6LjV9I2t3X3RpcHtmb250LWZhbWlseTpIZWx2ZXRpY2EsbWljcm9zb2Z0IHlhaGVpIHVpIGxpZ2h0fSNyZXN1bHRfbG9nb3tiYWNrZ3JvdW5kLWltYWdlOnVybChkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NEtQQ0V0TFNCSFpXNWxjbUYwYjNJNklFRmtiMkpsSUVsc2JIVnpkSEpoZEc5eUlERTVMakl1TVN3Z1UxWkhJRVY0Y0c5eWRDQlFiSFZuTFVsdUlDNGdVMVpISUZabGNuTnBiMjQ2SURZdU1EQWdRblZwYkdRZ01Da2dJQzB0UGdvOGMzWm5JSFpsY25OcGIyNDlJakV1TVNJZ2FXUTlJdVdidnVXeGdsOHhJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGh0Ykc1ek9uaHNhVzVyUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hzYVc1cklpQjRQU0l3Y0hnaUlIazlJakJ3ZUNJS0NTQjJhV1YzUW05NFBTSXdJREFnTVRBeElETXpJaUJ6ZEhsc1pUMGlaVzVoWW14bExXSmhZMnRuY205MWJtUTZibVYzSURBZ01DQXhNREVnTXpNN0lpQjRiV3c2YzNCaFkyVTlJbkJ5WlhObGNuWmxJajRLUEhOMGVXeGxJSFI1Y0dVOUluUmxlSFF2WTNOeklqNEtDUzV6ZERCN1ptbHNiRG9qTkRnM09VSkVPMzBLQ1M1emRERjdabWxzYkRvalJFUTBORE0yTzMwS0NTNXpkREo3Wm1sc2JEb2pSa1pHUmtaR08zMEtQQzl6ZEhsc1pUNEtQSEJoZEdnZ1kyeGhjM005SW5OME1DSWdaRDBpVFRVd0xqUXNNVFV1TTJNdE15NDRMREF1TXkwMExESXVOaTAxTGpjc05DNDNZeTB4TGpnc01pNHlMVFV1TlN3MExqRXROaXcyTGpkakxUQXVOaXd6TGpNc01TNHpMRFV1TVN3ekxEVXVOMk14TGprc01DNDJMRFl1TWkwd0xqVXNPQzQwTFRBdU5XZ3dMaklLQ1dnd0xqSmpNaTR5TERBc05pNDBMREV1TVN3NExqUXNNQzQxWXpFdU9DMHdMallzTXk0MUxUTXVNaXd6TFRVdU4yTXRNQzQwTFRJdU1TMDBMalF0TkM0MUxUWXVNaTAyTGpkRE5UUXVNaXd4T0N3MU5DNHpMREUxTGpZc05UQXVOQ3d4TlM0emVpQk5NemNzTVRRdU9Bb0pZekFzTWk0MExERXVOaXcwTGpNc015NDBMRFF1TTJNeExqa3NNQ3d6TGpRdE1TNDVMRE11TkMwMExqTmpNQzB5TGpRdE1TNDJMVFF1TXkwekxqUXROQzR6VXpNM0xERXlMalVzTXpjc01UUXVPSG9nVFRRekxqa3NPQzQyWXpBc01pNDFMREV1TlN3MExqVXNNeTR6TERRdU5Rb0pZekV1T0N3d0xETXVNeTB5TGpFc015NHpMVFF1TlZNME9TdzBMakVzTkRjdU1TdzBMakZETkRVdU15dzBMRFF6TGprc05pdzBNeTQ1TERndU5ub2dUVFV5TGpJc09DNDFZekFzTWk0ekxERXVOQ3cwTGpNc015NHlMRFF1TTNNekxqSXRNUzQ1TERNdU1pMDBMak56TFRFdU5DMDBMak10TXk0eUxUUXVNd29KVXpVeUxqSXNOaTR5TERVeUxqSXNPQzQxZWlCTk5UY3VOU3d4TlM0NVl6QXNNaTR6TERFdU5TdzBMak1zTXk0ekxEUXVNMk14TGpnc01Dd3pMak10TVM0NUxETXVNeTAwTGpOekxURXVOUzAwTGpNdE15NHpMVFF1TTBNMU9DNDVMREV4TGpZc05UY3VOU3d4TXk0MkxEVTNMalVzTVRVdU9Yb2lMejRLUEhCaGRHZ2dZMnhoYzNNOUluTjBNU0lnWkQwaVRUUXNNekF1TkhZdE5TNHhhRFl1TkdNeExqWXNNQ3d4TGpZc01DNHpMREV1Tml3eWRqRXVOR013TERFdU5pMHlMak1zTVM0NExUTXVPU3d4TGpoTU5Dd3pNQzQwVERRc016QXVOSG9nVFRRc01qTjJMVFF1T0dnMExqRUtDV014TGpZc01Dd3pMamtzTUN3ekxqa3NNaTR4ZGpBdU1XTXdMREV1TkMwd0xqVXNNaTQyTFRFdU9Dd3lMalpETVRBdU15d3lNeXcwTERJekxEUXNNak42SUUweExqY3NNVFoyTVRZdU0yZzJMalJqTXl3d0xEWXVNaXd3TERZdU1pMHpMaloyTFRFdU1XTXdMVEV1Tmkwd0xqRXRNaTQzTFRFdU1TMHpMalVLQ1dNeExUQXVPQ3d4TGpFdE1pNHpMREV1TVMwekxqWnNNQ3d3WXpBdE5DNDFMVE11TWkwMExqVXROaTR5TFRRdU5Vd3hMamNzTVRaTU1TNDNMREUyZWlJdlBnbzhjR0YwYUNCamJHRnpjejBpYzNReElpQmtQU0pOTWpVc01qZ3VPV010TVM0eExERXVNUzB6TGpNc01TNHpMVE11TlN3eExqTmpMVEV1TXl3d0xUSXVOeTB3TGpVdE1pNDNMVEl1TVdNd0xURXVOQ3d3TGpVdE1pNHpMREl1TVMweUxqTmpNUzR6TERBc01pNDRMREF1TVN3MExqRXNNQzQyVmpJNExqbDZDZ2tnVFRJeExqUXNNekl1TTJNd0xqUXNNQ3d5TGpNdE1DNHhMRE11Tnkwd0xqbHNNQzR5TERBdU4yZ3lMakYyTFRndU9XTXdMVE11TmkweUxqTXROUzAxTGpjdE5XTXRNUzQ0TERBdE5DNHpMREF1TnkwMExqY3NNQzQ1YkRBdU5Dd3lMak5qTVM0MkxUQXVOaXd6TFRBdU5pdzBMakl0TUM0MkNnbGpNUzQ0TERBc015NHpMREF1Tml3ekxqTXNNaTQyVmpJMFl5MHhMVEF1TkMweUxqUXRNQzQyTFRRdU1TMHdMalpqTFRNc01DMDBMalVzTVM0MkxUUXVOU3cwTGpkRE1UWXVOQ3d6TVM0NExERTVMallzTXpJdU15d3lNUzQwTERNeUxqTjZJaTgrQ2p4d1lYUm9JR05zWVhOelBTSnpkREVpSUdROUlrMHpNQzR5TERFMkxqRmpNQ3d3TGpZc01DNDJMREV1TWl3eExqTXNNUzR5WXpBdU9Dd3dMREV1TXkwd0xqWXNNUzR6TFRFdU1tTXdMVEF1Tnkwd0xqWXRNUzR6TFRFdU15MHhMak5ETXpBdU9Dd3hOQzQ0TERNd0xqSXNNVFV1TXl3ek1DNHlMREUyTGpGNkNna2dUVE13TGpNc016SXVNV2d5TGpSV01UZ3VOV2d0TWk0MFZqTXlMakY2SWk4K0NqeHdZWFJvSUdOc1lYTnpQU0p6ZERFaUlHUTlJazAzTVM0eUxESXlMakZvT0M0MFl6QXVOQ3d3TGpFc01DNDJMREF1TXl3d0xqWXNNQzQzZGpJdU5tZ3RPUzQzZGkweUxqWkROekF1Tml3eU1pNDBMRGN3TGpnc01qSXVNaXczTVM0eUxESXlMakY2SUUwM01TNHlMRE13TGpVS0NXTXRNQzQwTERBdE1DNDJMVEF1TXkwd0xqY3RNQzQ0ZGkweUxqWm9PUzQzZGpJdU5tTXdMREF1TkMwd0xqSXNNQzQzTFRBdU5pd3dMamRJTnpFdU1ub2dUVGN6TGpZc01UaGpMVEF1TVN3d0xqUXRNQzR4TERBdU9TMHdMalFzTVM0M1l5MHdMakVzTUM0ekxUQXVNU3d3TGpVdE1DNHhMREF1TndvSmFDMHlMalpqTFRFdU15d3dMakV0TVM0NUxEQXVPQzB5TERKMk55NDVZekF1TVN3eExqRXNNQzQ0TERFdU9Dd3lMREV1T1dneE1HTXhMakl0TUM0eExERXVPQzB3TGpjc01TNDVMVEV1T0hZdE55NDVZeTB3TGpFdE1TNHpMVEF1TnkweExqa3RNUzQ1TFRJdU1XZ3ROUW9KWXpBdU1TMHdMak1zTUM0eExUQXVPQ3d3TGpNdE1TNDBZekF1TVMwd0xqUXNNQzR4TFRBdU55d3dMakV0TUM0NWFEY3VNbll0TVM0NFNEWTNMalJXTVRoTU56TXVOaXd4T0V3M015NDJMREU0ZWlJdlBnbzhjR0YwYUNCamJHRnpjejBpYzNReElpQmtQU0pOT1RNdU55d3lNaTQzWXkwd0xqUXRNQzR4TFRBdU5TMHdMakl0TUM0MUxUQXVOWFl0TUM0MmFETXVNbll3TGpaakxUQXVNU3d3TGpNdE1DNHlMREF1TkMwd0xqVXNNQzQxU0RrekxqZDZJRTA1Tmk0MkxESTBMakVLQ1dNeExqRXRNQzR4TERFdU5pMHdMalVzTVM0MkxURXVOSFl0TVdneUxqTjJMVEV1TldndE1pNHpkaTB4TGpGb0xURXVPSFl4TGpGb0xUTXVNbll0TVM0eGFDMHhMamgyTVM0eGFDMHlMak4yTVM0MWFESXVNM1l4WXpBdU1Td3dMamtzTUM0MkxERXVOQ3d4TGpZc01TNDBTRGsyTGpaNkNna2dUVGswTGpnc016QXVOR014TGpZc01DNDRMRE11TkN3eExqTXNOUzQwTERFdU9Hd3dMamt0TVM0M1l5MHhMalF0TUM0eUxUSXVPUzB3TGpZdE5DNDBMVEV1TVdNeExqRXRNQzQ0TERJdE1TNDJMREl1TnkweUxqVmpNQzR6TFRBdU5Dd3dMalF0TUM0NUxEQXVNaTB4TGpNS0NXTXRNQzR6TFRBdU5pMHdMamd0TUM0NUxURXVOQzB3TGpsb0xUbDJNUzQxYURjdU4yTXdMaklzTUN3d0xqUXNNQzR4TERBdU5Dd3dMakZ6TUN3d0xqRXRNQzR4TERBdU0yTXRNQzQyTERBdU5pMHhMalFzTVM0ekxUSXVNeXd4TGpoakxURXVNaTB3TGpjdE1pNHhMVEV1TXkweUxqUXRNUzQ0YUMweUxqSUtDV013TGprc01Td3hMamdzTVM0NUxESXVPU3d5TGpkakxURXVOaXd3TGpZdE15NHpMREV1TVMwMExqa3NNUzR6YkRBdU9Td3hMalpET1RFdU15d3pNUzQ0TERrekxqSXNNekV1TVN3NU5DNDRMRE13TGpSNklFMDRPQzR6TERJMUxqSjJMVFpqTUM0eExUQXVOaXd3TGpNdE1DNDVMREF1T0Mwd0xqa0tDV2d4TVM0NGRpMHhMalpJT1RWakxUQXVNUzB3TGpFdE1pNHlMVEF1TVMweUxqSXNNR2d0TkM0M1l5MHhMakVzTUM0eExURXVOeXd3TGprdE1TNDRMREl1TWxZeU5XTXdMakVzTWk0eExUQXVOQ3cwTGpRdE1TNHhMRFl1TjJ3eExqa3NNQzQyQ2dsRE9EY3VPU3d5T1M0NUxEZzRMak1zTWpjdU5pdzRPQzR6TERJMUxqSjZJaTgrQ2p4d1lYUm9JR05zWVhOelBTSnpkRElpSUdROUlrMDBOaTR6TERJMExqSmpNQzQyTERBc01TNHlMREF1TVN3eExqY3NNQzQwZGpNdU5HTXdMREF1TXkwd0xqWXNNUzB4TGprc01XTXRNUzQxTERBdE1TNDRMVEF1TmkweExqZ3RNaTR4ZGkwd0xqWUtDVU0wTkM0eUxESTBMamdzTkRRdU55d3lOQzR5TERRMkxqTXNNalF1TW5vZ1RUUTVMaklzTWpBdU4wZzBPSFl5TGpWRE5EY3VOaXd5TXk0eExEUTNMREl6TERRMkxqTXNNak5qTFRJdU55d3dMVE11TXl3eExUTXVNeXd6TGpWMk1DNHpZekFzTWk0MExEQXVPU3d6TGpNc015NHlMRE11TXdvSll6QXVPQ3d3TERFdU15MHdMakVzTVM0NExUQXVOV3d3TGpFc01DNDJhREV1TVV3ME9TNHlMREl3TGpkTU5Ea3VNaXd5TUM0M2VpSXZQZ284Y0dGMGFDQmpiR0Z6Y3owaWMzUXlJaUJrUFNKTk5UWXVOeXd5TTJndE1TNHlkalV1TW1NdE1DNDJMREF1TkMweExqY3NNQzQyTFRJdU5Dd3dMalpqTFRBdU9Dd3dMVEV0TUM0MExURXRNUzR6ZGkwMExqWm9MVEV1TVhZMExqaGpNQ3d4TGpZc01DNDFMREl1TXl3eUxqRXNNaTR6Q2dsak1Td3dMREl1TVMwd0xqTXNNaTQyTFRBdU5td3dMakVzTUM0MmFERXVNVll5TTNvaUx6NEtQSEJoZEdnZ1kyeGhjM005SW5OME1TSWdaRDBpVFRreUxqY3NNVFV1TjJNd0xUQXVOeXd3TGpZdE1TNHpMREV1TWkweExqTmpNQzQyTERBc01TNHlMREF1Tml3eExqSXNNUzR6VXprMExqVXNNVGNzT1RNdU9Td3hOME01TXk0ekxERTJMamtzT1RJdU55d3hOaTR6TERreUxqY3NNVFV1TjNvaUx6NEtQQzl6ZG1jK0NnPT0pO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLXBvc2l0aW9uOmNlbnRlcjt3aWR0aDoxMDFweDtoZWlnaHQ6MzNweDttYXJnaW4tdG9wOjlweH0jcmVzdWx0X2xvZ28gaW1ne2Rpc3BsYXk6bm9uZTt2aXNpYmlsaXR5OmhpZGRlbn0jcmVzdWx0X2xvZ28gYSBpbWd7ZGlzcGxheTpub25lO3Zpc2liaWxpdHk6aGlkZGVufS5jLWNvbnRhaW5lcntsaW5lLWhlaWdodDoxLjY1fSNyc3tiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50IWltcG9ydGFudH0uYy1ib3JkZXJ7LXdlYmtpdC1ib3gtc2hhZG93OjAgMnB4IDVweCAwIHJnYmEoMCwwLDAsLjE2KSwwIDJweCAxMHB4IDAgcmdiYSgwLDAsMCwuMTIpO2JveC1zaGFkb3c6MCAycHggNXB4IDAgcmdiYSgwLDAsMCwuMTYpLDAgMnB4IDEwcHggMCByZ2JhKDAsMCwwLC4xMik7Ym9yZGVyLXJhZGl1czoycHg7Ym9yZGVyOm5vbmU7cGFkZGluZzoyMHB4O3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfS5jLWJvcmRlcjpob3Zlcntib3gtc2hhZG93OjAgM3B4IDEwcHggcmdiYSgwLDAsMCwuMTYpLDAgM3B4IDEwcHggcmdiYSgwLDAsMCwuMjMpO3RyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30uYy10YWJzLW5hdntib3JkZXI6bm9uZTtib3JkZXItcmFkaXVzOjJweCAycHggMCAwO3RyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30uYy10YWJzLW5hdi1tb3ZldG9we21hcmdpbi1sZWZ0Oi0yMHB4O21hcmdpbi1yaWdodDotMjBweDttYXJnaW4tdG9wOi0yMHB4O3RyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30uYy10YWJzLW5hdi1zZWxlY3RlZHtib3JkZXItdG9wOm5vbmUhaW1wb3J0YW50O2JvcmRlci1sZWZ0Om5vbmUhaW1wb3J0YW50O2JvcmRlci1yaWdodDpub25lIWltcG9ydGFudDt0cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9LmMtdGFicy1uYXYtc2Vwe2Rpc3BsYXk6bm9uZSFpbXBvcnRhbnR9I3BhZ2UgYXtoZWlnaHQ6MzRweDtib3JkZXItcmFkaXVzOjJweDtib3JkZXI6bm9uZSFpbXBvcnRhbnQ7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDt0cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9I3BhZ2UgYTpob3Zlcnt0cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9I3BhZ2UgYSAucGM6aG92ZXJ7dHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstd2Via2l0LXRyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1vLXRyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfSNwYWdlIHN0cm9uZ3toZWlnaHQ6MzRweDtib3JkZXItcmFkaXVzOjJweDtwb3NpdGlvbjpyZWxhdGl2ZTt0b3A6LTJweDt0cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9I3BhZ2Ugc3Ryb25nIC5wY3tsaW5lLWhlaWdodDozNHB4O3RyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30uZmt7ZGlzcGxheTpub25lIWltcG9ydGFudH0ucGN7Ym9yZGVyOm5vbmUhaW1wb3J0YW50O2hlaWdodDozNXB4O3RyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30ucGM6aG92ZXJ7dHJhbnNpdGlvbjpiYWNrZ3JvdW5kLWNvbG9yIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstd2Via2l0LXRyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1vLXRyYW5zaXRpb246YmFja2dyb3VuZC1jb2xvciA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfSNzX3RhYiBhe3dpZHRoOjU5cHg7bGluZS1oZWlnaHQ6NDRweH0jc190YWIgYnt3aWR0aDo1OXB4O2xpbmUtaGVpZ2h0OjQ0cHh9I3NfdGFie3BhZGRpbmctYm90dG9tOjhweDtwYWRkaW5nLXRvcDo4OXB4fS5jLWljb24tdGllYmF7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyfS50b2luZGV4e2Rpc3BsYXk6bm9uZX0ud3JhcHBlcl9uZXcgLnNfdGFiX2lubmVye3BhZGRpbmctdG9wOjEwcHh9LndyYXBwZXJfbmV3IC5zX2lwdF93cntiYWNrZ3JvdW5kOiNmZmZ9LndyYXBwZXJfbmV3LndyYXBwZXJfcyAjZm9ybSAuYmRzdWctbmV3e3dpZHRoOjkzJX0jdSAucGZ7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyO2ZvbnQtc2l6ZTowO3BhZGRpbmc6MTRweDtvcGFjaXR5Oi44Oy1tb3otdHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTstby10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTtwYWRkaW5nLXRvcDoxOHB4O3BhZGRpbmctYm90dG9tOjEwcHh9I3UgLnBmOmhvdmVye29wYWNpdHk6MTstbW96LXRyYW5zaXRpb246YWxsIC4zcyBlYXNlOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7LW8tdHJhbnNpdGlvbjphbGwgLjNzIGVhc2V9LndyYXBwZXJfbmV3ICN1PmEucGZ7Y29sb3I6dHJhbnNwYXJlbnQ7bWFyZ2luOjRweCAwIDAgMjRweH0ud3JhcHBlcl9uZXcgI3U+YS5wZjpob3Zlcntjb2xvcjp0cmFuc3BhcmVudH0ucGYgLmMtaWNvbntkaXNwbGF5Om5vbmUhaW1wb3J0YW50fS5jLWljb24tdHJpYW5nbGUtZG93bntkaXNwbGF5Om5vbmV9LmJkcGZtZW51e2JveC1zaGFkb3c6MCAycHggNXB4IDAgcmdiYSgwLDAsMCwuMTYpLDAgMnB4IDEwcHggMCByZ2JhKDAsMCwwLC4xMik7Ym9yZGVyLXJhZGl1czoycHghaW1wb3J0YW50O2JvcmRlcjpub25lO3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzO21hcmdpbi1sZWZ0Oi0xMHB4O21hcmdpbi10b3A6MzBweDt6LWluZGV4Ojg4ODghaW1wb3J0YW50fS5iZHBmbWVudSBhOmhvdmVye3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfS5iZG51YXJyb3d7ZGlzcGxheTpub25lIWltcG9ydGFudH0uc2V0cHJlZntib3JkZXItcmFkaXVzOjJweCAycHggMCAwO3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfS5zZXRwcmVmOmhvdmVye3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfSN1IC5sYntwYWRkaW5nOjIzcHg7Ym9yZGVyLXJhZGl1czo1MHB4O2ZvbnQtc2l6ZTowO3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjUwcHg7dG9wOjM4MDAlO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLXBvc2l0aW9uOmNlbnRlcjtib3gtc2hhZG93OnJnYmEoMCwwLDAsLjE1Njg2MykgMCAzcHggMTBweCxyZ2JhKDAsMCwwLC4yMjc0NTEpIDAgM3B4IDEwcHg7dHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1vLXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9I3UgLmxiOmhvdmVye3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfSN1IC5sYjphY3RpdmV7Ym94LXNoYWRvdzowIDEwcHggMzBweCByZ2JhKDAsMCwwLC4xOSksMCA2cHggMTBweCByZ2JhKDAsMCwwLC4yMyk7dHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstbW96LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1vLXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9LnRhbmctZm9yZWdyb3VuZHtib3JkZXItcmFkaXVzOjJweDtib3gtc2hhZG93OjAgMTlweCA2MHB4IHJnYmEoMCwwLDAsLjMpLDAgMTVweCAyMHB4IHJnYmEoMCwwLDAsLjIyKX0jc191cGZ1bmNfbWVudXN7ZGlzcGxheTpub25lfSNiZ3tiYWNrZ3JvdW5kLWNvbG9yOiNmZmYhaW1wb3J0YW50O2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6M3B4O3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzO2JhY2tncm91bmQtcG9zaXRpb246MTAwJSFpbXBvcnRhbnQ7ei1pbmRleDotMTt3aWR0aDo2MDBweDtoZWlnaHQ6MzlweDtmb250LWZhbWlseTotYXBwbGUtc3lzdGVtLGhlbHZldGljYSBuZXVlLEhlbHZldGljYSxuaW1idXMgc2FucyBsLEFyaWFsLGxpYmVyYXRpb24gc2FucyxwaW5nZmFuZyBzYyxoaXJhZ2lubyBzYW5zIGdiLHNvdXJjZSBoYW4gc2FucyBjbixzb3VyY2UgaGFuIHNhbnMgc2MsbWljcm9zb2Z0IHlhaGVpLHdlbnF1YW55aSBtaWNybyBoZWksd2VucXVhbnlpIHplbiBoZWksc3QgaGVpdGksU2ltSGVpLHdlbnF1YW55aSB6ZW4gaGVpIHNoYXJwLHNhbnMtc2VyaWY7cGFkZGluZy10b3A6NXB4IWltcG9ydGFudH0jaGVhZF93cmFwcGVyIC5zX2lwdHtib3JkZXI6MCFpbXBvcnRhbnQ7aGVpZ2h0OjIwcHghaW1wb3J0YW50O2JvcmRlci1yYWRpdXM6MnB4O3dpZHRoOjU4NnB4IWltcG9ydGFudH0jaGVhZF93cmFwcGVyIC5ub2JnX3NfZm1faG92ZXJ7Ym9yZGVyOjAhaW1wb3J0YW50fSNoZWFkX3dyYXBwZXIgLm5vYmdfc19mbV9mb2N1c3tib3JkZXI6MCFpbXBvcnRhbnQ7Ym9yZGVyLXRvcDowIHNvbGlkICNmZmYhaW1wb3J0YW50O2JvcmRlci1ib3R0b206MCBzb2xpZCAjZmZmIWltcG9ydGFudDtib3JkZXItbGVmdDowIHNvbGlkICNmZmYhaW1wb3J0YW50O2JvcmRlci1yaWdodDoxcHggc29saWQgIzM4Zn0ucy10aXRsZS1pbWFnZXtib3JkZXI6bm9uZSFpbXBvcnRhbnQ7Ym9yZGVyLXRvcDowIHNvbGlkICNmZmYhaW1wb3J0YW50O2JvcmRlci1ib3R0b206MCBzb2xpZCAjZmZmIWltcG9ydGFudDtib3JkZXItbGVmdDowIHNvbGlkICNmZmYhaW1wb3J0YW50O2JvcmRlci1yaWdodDowIHNvbGlkICNmZmYhaW1wb3J0YW50fSNzX2xnX2ltZ3tkaXNwbGF5Om5vbmV9I2Zvcm17LXdlYmtpdC1hbmltYXRpb24tZHVyYXRpb246LjJzO2FuaW1hdGlvbi1kdXJhdGlvbjouMnM7LXdlYmtpdC1hbmltYXRpb24tZmlsbC1tb2RlOmJvdGg7YW5pbWF0aW9uLWZpbGwtbW9kZTpib3RoO2FuaW1hdGlvbi1uYW1lOmZhZGVJblVwOy13ZWJraXQtYW5pbWF0aW9uLW5hbWU6ZmFkZUluVXA7YW5pbWF0aW9uLWRlbGF5Oi4zczstd2Via2l0LWFuaW1hdGlvbi1kZWxheTouM3N9Ym9keTpub3QoW25ld3NdKSAjaGVhZF93cmFwcGVyICNmb3JtLmZte21pbi13aWR0aDo1MCU7d2lkdGg6MTEwJX0ucy1wLXRvcHt0cmFuc2Zvcm06c2NhbGUoLjgpO2JvdHRvbTo5cHghaW1wb3J0YW50fS5tbmF2e2Rpc3BsYXk6bm9uZX0jdV9zcCAubW5hdntkaXNwbGF5Om5vbmV9I3UxIGEubGJ7cGFkZGluZzoyM3B4O2JvcmRlci1yYWRpdXM6NTAlO2ZvbnQtc2l6ZTowO3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjQ0cHg7dG9wOjEwNDAlO2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0S1BDRXRMU0JIWlc1bGNtRjBiM0k2SUVGa2IySmxJRWxzYkhWemRISmhkRzl5SURFNUxqSXVNU3dnVTFaSElFVjRjRzl5ZENCUWJIVm5MVWx1SUM0Z1UxWkhJRlpsY25OcGIyNDZJRFl1TURBZ1FuVnBiR1FnTUNrZ0lDMHRQZ284YzNabklIWmxjbk5wYjI0OUlqRXVNU0lnYVdROUl1V2J2dVd4Z2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lLQ1NCMmFXVjNRbTk0UFNJd0lEQWdORFlnTkRZaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURRMklEUTJPeUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0NqeHpkSGxzWlNCMGVYQmxQU0owWlhoMEwyTnpjeUkrQ2drdWMzUXdlMlpwYkd3NkkwWkdSa1pHUmp0OUNqd3ZjM1I1YkdVK0NqeHdZWFJvSUdOc1lYTnpQU0p6ZERBaUlHUTlJazB5TXl3eU0yTXlMamtzTUN3MUxqSXRNaTR6TERVdU1pMDFMakp6TFRJdU15MDFMakl0TlM0eUxUVXVNbk10TlM0eUxESXVNeTAxTGpJc05TNHlVekl3TGpFc01qTXNNak1zTWpONklFMHlNeXd5TlM0MkNnbGpMVE11TlN3d0xURXdMalFzTVM0M0xURXdMalFzTlM0eWRqSXVObWd5TUM0M2RpMHlMalpETXpNdU5Dd3lOeTR6TERJMkxqVXNNalV1Tml3eU15d3lOUzQyZWlJdlBnbzhMM04yWno0Syk7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyO2JveC1zaGFkb3c6cmdiYSgwLDAsMCwuMTU2ODYzKSAwIDNweCAxMHB4LHJnYmEoMCwwLDAsLjIyNzQ1MSkgMCAzcHggMTBweDt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstd2Via2l0LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwcztsaW5lLWhlaWdodDowO3otaW5kZXg6MTAwfSN1MSBhLmxiOmhvdmVye3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW1vei10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstby10cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfSN1MSBhLmxiOmFjdGl2ZXtib3gtc2hhZG93OjAgMTBweCAzMHB4IHJnYmEoMCwwLDAsLjE5KSwwIDZweCAxMHB4IHJnYmEoMCwwLDAsLjIzKTt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstd2Via2l0LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30jdTEgYS5wZntiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7YmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXI7Zm9udC1zaXplOjA7cGFkZGluZzoxNHB4O29wYWNpdHk6Ljg7LW1vei10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTstd2Via2l0LXRyYW5zaXRpb246YWxsIC4zcyBlYXNlOy1vLXRyYW5zaXRpb246YWxsIC4zcyBlYXNlO3otaW5kZXg6MH0jdTEgYS5icml7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7YmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXI7Zm9udC1zaXplOjA7cGFkZGluZzoycHg7b3BhY2l0eTouODstbW96LXRyYW5zaXRpb246YWxsIC4zcyBlYXNlOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7LW8tdHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7Ym9yZGVyOm5vbmU7bWFyZ2luLXRvcDoxMnB4fSN3cmFwcGVyIC5iZGJyaWltZ3RpdGxle3BhZGRpbmctdG9wOjIzcHh9I3dyYXBwZXIgLmJkYnJpLmJkYnJpaW1nIC5iZG1haW5saW5rIGF7Ym9yZGVyOm5vbmV9I3dyYXBwZXIgLmJkYnJpe3otaW5kZXg6Mn0jd3JhcHBlciAjdV9zcCAuc19icml7cGFkZGluZzo1cHg7Ym9yZGVyLXJhZGl1czo1MCU7Zm9udC1zaXplOjA7d2lkdGg6MzJweDtoZWlnaHQ6MzJweDtiYWNrZ3JvdW5kLWltYWdlOnVybChkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NE5DandoTFMwZ1IyVnVaWEpoZEc5eU9pQkJaRzlpWlNCSmJHeDFjM1J5WVhSdmNpQXhPUzR5TGpFc0lGTldSeUJGZUhCdmNuUWdVR3gxWnkxSmJpQXVJRk5XUnlCV1pYSnphVzl1T2lBMkxqQXdJRUoxYVd4a0lEQXBJQ0F0TFQ0TkNqeHpkbWNnZG1WeWMybHZiajBpTVM0eElpQnBaRDBpNVp1KzViR0NYekVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUlnZUcxc2JuTTZlR3hwYm1zOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6RTVPVGt2ZUd4cGJtc2lJSGc5SWpCd2VDSWdlVDBpTUhCNElnMEtDU0IyYVdWM1FtOTRQU0l3SURBZ016SWdNeklpSUhOMGVXeGxQU0psYm1GaWJHVXRZbUZqYTJkeWIzVnVaRHB1WlhjZ01DQXdJRE15SURNeU95SWdlRzFzT25Od1lXTmxQU0p3Y21WelpYSjJaU0krRFFvOGMzUjViR1VnZEhsd1pUMGlkR1Y0ZEM5amMzTWlQZzBLQ1M1emREQjdabWxzYkRvalJrWkdSa1pHTzMwTkNqd3ZjM1I1YkdVK0RRbzhjR0YwYUNCamJHRnpjejBpYzNRd0lpQmtQU0pOTVRBc01UTm9NM1l0TTJndE0xWXhNM29nVFRFMExqVXNNakpvTTNZdE0yZ3RNME14TkM0MUxERTVMREUwTGpVc01qSXNNVFF1TlN3eU1ub2dUVEV3TERJeWFETjJMVE5vTFROV01qSjZJRTB4TUN3eE55NDFhRE4yTFROb0xUTldNVGN1TlhvTkNna2dUVEUwTGpVc01UY3VOV2d6ZGkwemFDMHpRekUwTGpVc01UUXVOU3d4TkM0MUxERTNMalVzTVRRdU5Td3hOeTQxZWlCTk1Ua3NNVEIyTTJnemRpMHpTREU1ZWlCTk1UUXVOU3d4TTJnemRpMHphQzB6UXpFMExqVXNNVEFzTVRRdU5Td3hNeXd4TkM0MUxERXplaUJOTVRrc01UY3VOV2d6ZGkwemFDMHpEUW9KVmpFM0xqVjZJRTB4T1N3eU1tZ3pkaTB6YUMwelZqSXllaUl2UGcwS1BDOXpkbWMrRFFvPSk7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyO2JveC1zaGFkb3c6cmdiYSgwLDAsMCwuMTU2ODYzKSAwIDNweCAxMHB4LHJnYmEoMCwwLDAsLjIyNzQ1MSkgMCAzcHggMTBweDt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzOy1tb3otdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwczstd2Via2l0LXRyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7LW8tdHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwcztsaW5lLWhlaWdodDowO3otaW5kZXg6MTAwO21hcmdpbi1yaWdodDoyMnB4O21hcmdpbi10b3A6MXB4fSN1X3NwIC5zX2JkYnJpaW1ndGl0bGV7cGFkZGluZy10b3A6NzNweH0jc191c2Vyc2V0dGluZ190b3B7YmFja2dyb3VuZC1yZXBlYXQ6bm8tcmVwZWF0O2JhY2tncm91bmQtcG9zaXRpb246Y2VudGVyO2ZvbnQtc2l6ZTowO3BhZGRpbmc6MTRweDtvcGFjaXR5Oi44Oy1tb3otdHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTstby10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTttYXJnaW4tdG9wOjEycHg7bWFyZ2luLXJpZ2h0OjRweDt6LWluZGV4Oi0xMDB9I3NfdG9wX3dyYXB7ei1pbmRleDotMTA7Ym9yZGVyLWJvdHRvbTp1bnNldH0jdSAudG9pbmRleHtkaXNwbGF5Om5vbmUhaW1wb3J0YW50fSNzX3VzZXJuYW1lX3RvcHt0ZXh0LWRlY29yYXRpb246bm9uZTttYXJnaW4tdG9wOjI2cHg7bWFyZ2luLWxlZnQ6NXB4O2JvcmRlcjpub25lO3BhZGRpbmctbGVmdDoxMHB4O3BhZGRpbmctcmlnaHQ6MTBweDtib3JkZXItcmFkaXVzOjE2cHg7bWFyZ2luLXJpZ2h0Oi0zcHh9LnVzZXItbmFtZXt0ZXh0LWRlY29yYXRpb246bm9uZSFpbXBvcnRhbnR9Lm1lbnUtYXJyb3d7ZGlzcGxheTpub25lIWltcG9ydGFudH0uc191c2VyX25hbWVfbWVudXt0ZXh0LWFsaWduOmNlbnRlciFpbXBvcnRhbnR9LnMtdXNlci1zZXQtbWVudS5tZW51LXRvcHt3aWR0aDoxMDBweH0ucy11c2VyLXNldC1tZW51IGRpdntib3JkZXI6bm9uZSFpbXBvcnRhbnQ7Ym94LXNoYWRvdzpyZ2JhKDAsMCwwLC4xNTY4NjMpIDAgM3B4IDEwcHgscmdiYSgwLDAsMCwuMjI3NDUxKSAwIDNweCAxMHB4fS5zLXVzZXItc2V0LW1lbnV7cGFkZGluZy10b3A6MDttYXJnaW4tdG9wOjM2cHg7Ym9yZGVyLXJhZGl1czoycHghaW1wb3J0YW50fS5zLXVzZXItc2V0LW1lbnUgYXtwYWRkaW5nLWxlZnQ6MjVweDstbW96LXRyYW5zaXRpb246YWxsIC4zcyBlYXNlOy13ZWJraXQtdHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7LW8tdHJhbnNpdGlvbjphbGwgLjNzIGVhc2V9LnMtdXNlci1zZXQtbWVudSBhOmhvdmVyey1tb3otdHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTstby10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZX0jdXNlcnt0ZXh0LWRlY29yYXRpb246bm9uZSFpbXBvcnRhbnQ7bWFyZ2luLXRvcDozMHB4O21hcmdpbi1sZWZ0OjVweDtib3JkZXI6bm9uZTtwYWRkaW5nLWxlZnQ6MTBweDtwYWRkaW5nLXJpZ2h0OjEwcHg7Ym9yZGVyLXJhZGl1czoxNnB4O21hcmdpbi1yaWdodDotM3B4O2hlaWdodDoyM3B4O3BhZGRpbmctdG9wOjhweDstd2Via2l0LWFuaW1hdGlvbi1kdXJhdGlvbjoxczthbmltYXRpb24tZHVyYXRpb246MXM7LXdlYmtpdC1hbmltYXRpb24tZmlsbC1tb2RlOmJvdGg7YW5pbWF0aW9uLWZpbGwtbW9kZTpib3RoO2FuaW1hdGlvbi1uYW1lOmJvdW5jZUluUmlnaHQ7LXdlYmtpdC1hbmltYXRpb24tbmFtZTpib3VuY2VJblJpZ2h0fS51c2VybWVudXtib3JkZXI6bm9uZSFpbXBvcnRhbnQ7Ym94LXNoYWRvdzpyZ2JhKDAsMCwwLC4xNTY4NjMpIDAgM3B4IDEwcHgscmdiYSgwLDAsMCwuMjI3NDUxKSAwIDNweCAxMHB4IWltcG9ydGFudDstd2Via2l0LWJveC1zaGFkb3c6cmdiYSgwLDAsMCwuMTU2ODYzKSAwIDNweCAxMHB4LHJnYmEoMCwwLDAsLjIyNzQ1MSkgMCAzcHggMTBweCFpbXBvcnRhbnQ7d2lkdGg6ODNweDtib3JkZXItcmFkaXVzOjJweCFpbXBvcnRhbnQ7dG9wOjM1cHghaW1wb3J0YW50O21hcmdpbjowIGF1dG99LnVzZXJuYW1lIGF7LW1vei10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTstd2Via2l0LXRyYW5zaXRpb246YWxsIC4zcyBlYXNlOy1vLXRyYW5zaXRpb246YWxsIC4zcyBlYXNlO2JvcmRlci1yYWRpdXM6MnB4fS51c2VybmFtZSBhOmhvdmVye2JhY2tncm91bmQ6IzM0NzZkMiFpbXBvcnRhbnQ7LW1vei10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTstd2Via2l0LXRyYW5zaXRpb246YWxsIC4zcyBlYXNlOy1vLXRyYW5zaXRpb246YWxsIC4zcyBlYXNlfS51c2VybmFtZSBhOmFjdGl2ZXtiYWNrZ3JvdW5kOiMzNDc2ZDIhaW1wb3J0YW50Oy1tb3otdHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7LXdlYmtpdC10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTstby10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZX0jdXNlciAuYy1pY29ue2Rpc3BsYXk6bm9uZX0jaW1zZ3tiYWNrZ3JvdW5kLXJlcGVhdDpuby1yZXBlYXQ7YmFja2dyb3VuZC1wb3NpdGlvbjpjZW50ZXI7Zm9udC1zaXplOjA7cGFkZGluZzoxNHB4O29wYWNpdHk6Ljg7LW1vei10cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTstd2Via2l0LXRyYW5zaXRpb246YWxsIC4zcyBlYXNlOy1vLXRyYW5zaXRpb246YWxsIC4zcyBlYXNlO3otaW5kZXg6MDtwYWRkaW5nLXRvcDoyNXB4O3BhZGRpbmctYm90dG9tOjIxcHh9I2ltc2c6aG92ZXJ7b3BhY2l0eToxfS5oZWFkX3dyYXBwZXIgI2Jkcy1tZXNzYWdlLXdyYXBwZXJ7dG9wOjY0cHh9LnMtbW9kLW1zZ3tib3gtc2hhZG93OnJnYmEoMCwwLDAsLjE1Njg2MykgMCAzcHggMTBweCxyZ2JhKDAsMCwwLC4yMjc0NTEpIDAgM3B4IDEwcHghaW1wb3J0YW50Oy13ZWJraXQtYm94LXNoYWRvdzpyZ2JhKDAsMCwwLC4xNTY4NjMpIDAgM3B4IDEwcHgscmdiYSgwLDAsMCwuMjI3NDUxKSAwIDNweCAxMHB4IWltcG9ydGFudDtib3JkZXItcmFkaXVzOjNweH0ubXNnLWJ0bntib3JkZXItcmFkaXVzOjJweDt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfS5tc2ctYnRuOmhvdmVye2JvcmRlci1yYWRpdXM6MnB4O2JveC1zaGFkb3c6MCAxcHggNnB4IHJnYmEoMCwwLDAsLjEyKSwwIDFweCA0cHggcmdiYSgwLDAsMCwuMTIpO3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9Lm1zZy1idG46YWN0aXZle2JvcmRlci1yYWRpdXM6MnB4O2JveC1zaGFkb3c6cmdiYSgwLDAsMCwuMTU2ODYzKSAwIDNweCAxMHB4LHJnYmEoMCwwLDAsLjIyNzQ1MSkgMCAzcHggMTBweCFpbXBvcnRhbnQ7LXdlYmtpdC1ib3gtc2hhZG93OnJnYmEoMCwwLDAsLjE1Njg2MykgMCAzcHggMTBweCxyZ2JhKDAsMCwwLC4yMjc0NTEpIDAgM3B4IDEwcHghaW1wb3J0YW50O3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9Lm5vLXVzZTpob3Zlcntib3gtc2hhZG93Om5vbmUhaW1wb3J0YW50fS50b3AtbG9nbyBpbWd7ZGlzcGxheTpub25lfS50b3AtbG9nb3tiYWNrZ3JvdW5kLWltYWdlOnVybChkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NEtQQ0V0TFNCSFpXNWxjbUYwYjNJNklFRmtiMkpsSUVsc2JIVnpkSEpoZEc5eUlERTVMakl1TVN3Z1UxWkhJRVY0Y0c5eWRDQlFiSFZuTFVsdUlDNGdVMVpISUZabGNuTnBiMjQ2SURZdU1EQWdRblZwYkdRZ01Da2dJQzB0UGdvOGMzWm5JSFpsY25OcGIyNDlJakV1TVNJZ2FXUTlJdVdidnVXeGdsOHhJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGh0Ykc1ek9uaHNhVzVyUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hzYVc1cklpQjRQU0l3Y0hnaUlIazlJakJ3ZUNJS0NTQjJhV1YzUW05NFBTSXdJREFnTVRBeElETXpJaUJ6ZEhsc1pUMGlaVzVoWW14bExXSmhZMnRuY205MWJtUTZibVYzSURBZ01DQXhNREVnTXpNN0lpQjRiV3c2YzNCaFkyVTlJbkJ5WlhObGNuWmxJajRLUEhOMGVXeGxJSFI1Y0dVOUluUmxlSFF2WTNOeklqNEtDUzV6ZERCN1ptbHNiRG9qTkRnM09VSkVPMzBLQ1M1emRERjdabWxzYkRvalJFUTBORE0yTzMwS0NTNXpkREo3Wm1sc2JEb2pSa1pHUmtaR08zMEtQQzl6ZEhsc1pUNEtQSEJoZEdnZ1kyeGhjM005SW5OME1DSWdaRDBpVFRVd0xqUXNNVFV1TTJNdE15NDRMREF1TXkwMExESXVOaTAxTGpjc05DNDNZeTB4TGpnc01pNHlMVFV1TlN3MExqRXROaXcyTGpkakxUQXVOaXd6TGpNc01TNHpMRFV1TVN3ekxEVXVOMk14TGprc01DNDJMRFl1TWkwd0xqVXNPQzQwTFRBdU5XZ3dMaklLQ1dnd0xqSmpNaTR5TERBc05pNDBMREV1TVN3NExqUXNNQzQxWXpFdU9DMHdMallzTXk0MUxUTXVNaXd6TFRVdU4yTXRNQzQwTFRJdU1TMDBMalF0TkM0MUxUWXVNaTAyTGpkRE5UUXVNaXd4T0N3MU5DNHpMREUxTGpZc05UQXVOQ3d4TlM0emVpQk5NemNzTVRRdU9Bb0pZekFzTWk0MExERXVOaXcwTGpNc015NDBMRFF1TTJNeExqa3NNQ3d6TGpRdE1TNDVMRE11TkMwMExqTmpNQzB5TGpRdE1TNDJMVFF1TXkwekxqUXROQzR6VXpNM0xERXlMalVzTXpjc01UUXVPSG9nVFRRekxqa3NPQzQyWXpBc01pNDFMREV1TlN3MExqVXNNeTR6TERRdU5Rb0pZekV1T0N3d0xETXVNeTB5TGpFc015NHpMVFF1TlZNME9TdzBMakVzTkRjdU1TdzBMakZETkRVdU15dzBMRFF6TGprc05pdzBNeTQ1TERndU5ub2dUVFV5TGpJc09DNDFZekFzTWk0ekxERXVOQ3cwTGpNc015NHlMRFF1TTNNekxqSXRNUzQ1TERNdU1pMDBMak56TFRFdU5DMDBMak10TXk0eUxUUXVNd29KVXpVeUxqSXNOaTR5TERVeUxqSXNPQzQxZWlCTk5UY3VOU3d4TlM0NVl6QXNNaTR6TERFdU5TdzBMak1zTXk0ekxEUXVNMk14TGpnc01Dd3pMak10TVM0NUxETXVNeTAwTGpOekxURXVOUzAwTGpNdE15NHpMVFF1TTBNMU9DNDVMREV4TGpZc05UY3VOU3d4TXk0MkxEVTNMalVzTVRVdU9Yb2lMejRLUEhCaGRHZ2dZMnhoYzNNOUluTjBNU0lnWkQwaVRUUXNNekF1TkhZdE5TNHhhRFl1TkdNeExqWXNNQ3d4TGpZc01DNHpMREV1Tml3eWRqRXVOR013TERFdU5pMHlMak1zTVM0NExUTXVPU3d4TGpoTU5Dd3pNQzQwVERRc016QXVOSG9nVFRRc01qTjJMVFF1T0dnMExqRUtDV014TGpZc01Dd3pMamtzTUN3ekxqa3NNaTR4ZGpBdU1XTXdMREV1TkMwd0xqVXNNaTQyTFRFdU9Dd3lMalpETVRBdU15d3lNeXcwTERJekxEUXNNak42SUUweExqY3NNVFoyTVRZdU0yZzJMalJqTXl3d0xEWXVNaXd3TERZdU1pMHpMaloyTFRFdU1XTXdMVEV1Tmkwd0xqRXRNaTQzTFRFdU1TMHpMalVLQ1dNeExUQXVPQ3d4TGpFdE1pNHpMREV1TVMwekxqWnNNQ3d3WXpBdE5DNDFMVE11TWkwMExqVXROaTR5TFRRdU5Vd3hMamNzTVRaTU1TNDNMREUyZWlJdlBnbzhjR0YwYUNCamJHRnpjejBpYzNReElpQmtQU0pOTWpVc01qZ3VPV010TVM0eExERXVNUzB6TGpNc01TNHpMVE11TlN3eExqTmpMVEV1TXl3d0xUSXVOeTB3TGpVdE1pNDNMVEl1TVdNd0xURXVOQ3d3TGpVdE1pNHpMREl1TVMweUxqTmpNUzR6TERBc01pNDRMREF1TVN3MExqRXNNQzQyVmpJNExqbDZDZ2tnVFRJeExqUXNNekl1TTJNd0xqUXNNQ3d5TGpNdE1DNHhMRE11Tnkwd0xqbHNNQzR5TERBdU4yZ3lMakYyTFRndU9XTXdMVE11TmkweUxqTXROUzAxTGpjdE5XTXRNUzQ0TERBdE5DNHpMREF1TnkwMExqY3NNQzQ1YkRBdU5Dd3lMak5qTVM0MkxUQXVOaXd6TFRBdU5pdzBMakl0TUM0MkNnbGpNUzQ0TERBc015NHpMREF1Tml3ekxqTXNNaTQyVmpJMFl5MHhMVEF1TkMweUxqUXRNQzQyTFRRdU1TMHdMalpqTFRNc01DMDBMalVzTVM0MkxUUXVOU3cwTGpkRE1UWXVOQ3d6TVM0NExERTVMallzTXpJdU15d3lNUzQwTERNeUxqTjZJaTgrQ2p4d1lYUm9JR05zWVhOelBTSnpkREVpSUdROUlrMHpNQzR5TERFMkxqRmpNQ3d3TGpZc01DNDJMREV1TWl3eExqTXNNUzR5WXpBdU9Dd3dMREV1TXkwd0xqWXNNUzR6TFRFdU1tTXdMVEF1Tnkwd0xqWXRNUzR6TFRFdU15MHhMak5ETXpBdU9Dd3hOQzQ0TERNd0xqSXNNVFV1TXl3ek1DNHlMREUyTGpGNkNna2dUVE13TGpNc016SXVNV2d5TGpSV01UZ3VOV2d0TWk0MFZqTXlMakY2SWk4K0NqeHdZWFJvSUdOc1lYTnpQU0p6ZERFaUlHUTlJazAzTVM0eUxESXlMakZvT0M0MFl6QXVOQ3d3TGpFc01DNDJMREF1TXl3d0xqWXNNQzQzZGpJdU5tZ3RPUzQzZGkweUxqWkROekF1Tml3eU1pNDBMRGN3TGpnc01qSXVNaXczTVM0eUxESXlMakY2SUUwM01TNHlMRE13TGpVS0NXTXRNQzQwTERBdE1DNDJMVEF1TXkwd0xqY3RNQzQ0ZGkweUxqWm9PUzQzZGpJdU5tTXdMREF1TkMwd0xqSXNNQzQzTFRBdU5pd3dMamRJTnpFdU1ub2dUVGN6TGpZc01UaGpMVEF1TVN3d0xqUXRNQzR4TERBdU9TMHdMalFzTVM0M1l5MHdMakVzTUM0ekxUQXVNU3d3TGpVdE1DNHhMREF1TndvSmFDMHlMalpqTFRFdU15d3dMakV0TVM0NUxEQXVPQzB5TERKMk55NDVZekF1TVN3eExqRXNNQzQ0TERFdU9Dd3lMREV1T1dneE1HTXhMakl0TUM0eExERXVPQzB3TGpjc01TNDVMVEV1T0hZdE55NDVZeTB3TGpFdE1TNHpMVEF1TnkweExqa3RNUzQ1TFRJdU1XZ3ROUW9KWXpBdU1TMHdMak1zTUM0eExUQXVPQ3d3TGpNdE1TNDBZekF1TVMwd0xqUXNNQzR4TFRBdU55d3dMakV0TUM0NWFEY3VNbll0TVM0NFNEWTNMalJXTVRoTU56TXVOaXd4T0V3M015NDJMREU0ZWlJdlBnbzhjR0YwYUNCamJHRnpjejBpYzNReElpQmtQU0pOT1RNdU55d3lNaTQzWXkwd0xqUXRNQzR4TFRBdU5TMHdMakl0TUM0MUxUQXVOWFl0TUM0MmFETXVNbll3TGpaakxUQXVNU3d3TGpNdE1DNHlMREF1TkMwd0xqVXNNQzQxU0RrekxqZDZJRTA1Tmk0MkxESTBMakVLQ1dNeExqRXRNQzR4TERFdU5pMHdMalVzTVM0MkxURXVOSFl0TVdneUxqTjJMVEV1TldndE1pNHpkaTB4TGpGb0xURXVPSFl4TGpGb0xUTXVNbll0TVM0eGFDMHhMamgyTVM0eGFDMHlMak4yTVM0MWFESXVNM1l4WXpBdU1Td3dMamtzTUM0MkxERXVOQ3d4TGpZc01TNDBTRGsyTGpaNkNna2dUVGswTGpnc016QXVOR014TGpZc01DNDRMRE11TkN3eExqTXNOUzQwTERFdU9Hd3dMamt0TVM0M1l5MHhMalF0TUM0eUxUSXVPUzB3TGpZdE5DNDBMVEV1TVdNeExqRXRNQzQ0TERJdE1TNDJMREl1TnkweUxqVmpNQzR6TFRBdU5Dd3dMalF0TUM0NUxEQXVNaTB4TGpNS0NXTXRNQzR6TFRBdU5pMHdMamd0TUM0NUxURXVOQzB3TGpsb0xUbDJNUzQxYURjdU4yTXdMaklzTUN3d0xqUXNNQzR4TERBdU5Dd3dMakZ6TUN3d0xqRXRNQzR4TERBdU0yTXRNQzQyTERBdU5pMHhMalFzTVM0ekxUSXVNeXd4TGpoakxURXVNaTB3TGpjdE1pNHhMVEV1TXkweUxqUXRNUzQ0YUMweUxqSUtDV013TGprc01Td3hMamdzTVM0NUxESXVPU3d5TGpkakxURXVOaXd3TGpZdE15NHpMREV1TVMwMExqa3NNUzR6YkRBdU9Td3hMalpET1RFdU15d3pNUzQ0TERrekxqSXNNekV1TVN3NU5DNDRMRE13TGpSNklFMDRPQzR6TERJMUxqSjJMVFpqTUM0eExUQXVOaXd3TGpNdE1DNDVMREF1T0Mwd0xqa0tDV2d4TVM0NGRpMHhMalpJT1RWakxUQXVNUzB3TGpFdE1pNHlMVEF1TVMweUxqSXNNR2d0TkM0M1l5MHhMakVzTUM0eExURXVOeXd3TGprdE1TNDRMREl1TWxZeU5XTXdMakVzTWk0eExUQXVOQ3cwTGpRdE1TNHhMRFl1TjJ3eExqa3NNQzQyQ2dsRE9EY3VPU3d5T1M0NUxEZzRMak1zTWpjdU5pdzRPQzR6TERJMUxqSjZJaTgrQ2p4d1lYUm9JR05zWVhOelBTSnpkRElpSUdROUlrMDBOaTR6TERJMExqSmpNQzQyTERBc01TNHlMREF1TVN3eExqY3NNQzQwZGpNdU5HTXdMREF1TXkwd0xqWXNNUzB4TGprc01XTXRNUzQxTERBdE1TNDRMVEF1TmkweExqZ3RNaTR4ZGkwd0xqWUtDVU0wTkM0eUxESTBMamdzTkRRdU55d3lOQzR5TERRMkxqTXNNalF1TW5vZ1RUUTVMaklzTWpBdU4wZzBPSFl5TGpWRE5EY3VOaXd5TXk0eExEUTNMREl6TERRMkxqTXNNak5qTFRJdU55d3dMVE11TXl3eExUTXVNeXd6TGpWMk1DNHpZekFzTWk0MExEQXVPU3d6TGpNc015NHlMRE11TXdvSll6QXVPQ3d3TERFdU15MHdMakVzTVM0NExUQXVOV3d3TGpFc01DNDJhREV1TVV3ME9TNHlMREl3TGpkTU5Ea3VNaXd5TUM0M2VpSXZQZ284Y0dGMGFDQmpiR0Z6Y3owaWMzUXlJaUJrUFNKTk5UWXVOeXd5TTJndE1TNHlkalV1TW1NdE1DNDJMREF1TkMweExqY3NNQzQyTFRJdU5Dd3dMalpqTFRBdU9Dd3dMVEV0TUM0MExURXRNUzR6ZGkwMExqWm9MVEV1TVhZMExqaGpNQ3d4TGpZc01DNDFMREl1TXl3eUxqRXNNaTR6Q2dsak1Td3dMREl1TVMwd0xqTXNNaTQyTFRBdU5td3dMakVzTUM0MmFERXVNVll5TTNvaUx6NEtQSEJoZEdnZ1kyeGhjM005SW5OME1TSWdaRDBpVFRreUxqY3NNVFV1TjJNd0xUQXVOeXd3TGpZdE1TNHpMREV1TWkweExqTmpNQzQyTERBc01TNHlMREF1Tml3eExqSXNNUzR6VXprMExqVXNNVGNzT1RNdU9Td3hOME01TXk0ekxERTJMamtzT1RJdU55d3hOaTR6TERreUxqY3NNVFV1TjNvaUx6NEtQQzl6ZG1jK0NnPT0pO2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLXBvc2l0aW9uOmNlbnRlcjtoZWlnaHQ6MTAwcHg7d2lkdGg6MjAwcHh9I3Vfc3AgLnNfYnJpe2JvcmRlcjowIWltcG9ydGFudH0ucGFzcy10ZXh0LWlucHV0e2JhY2tncm91bmQtaW1hZ2U6bm9uZSFpbXBvcnRhbnR9LnBhc3MtdGV4dC1pbnB1dC1mb2N1c3tiYWNrZ3JvdW5kLWltYWdlOm5vbmUhaW1wb3J0YW50fSNwYXNzcG9ydC1sb2dpbi1wb3B7Zm9udC1mYW1pbHk6LWFwcGxlLXN5c3RlbSxoZWx2ZXRpY2EgbmV1ZSxIZWx2ZXRpY2EsbmltYnVzIHNhbnMgbCxBcmlhbCxsaWJlcmF0aW9uIHNhbnMscGluZ2Zhbmcgc2MsaGlyYWdpbm8gc2FucyBnYixzb3VyY2UgaGFuIHNhbnMgY24sc291cmNlIGhhbiBzYW5zIHNjLG1pY3Jvc29mdCB5YWhlaSx3ZW5xdWFueWkgbWljcm8gaGVpLHdlbnF1YW55aSB6ZW4gaGVpLHN0IGhlaXRpLFNpbUhlaSx3ZW5xdWFueWkgemVuIGhlaSBzaGFycCxzYW5zLXNlcmlmO2JvcmRlci1yYWRpdXM6MnB4fSNUQU5HUkFNX19QU1BfMl9fdGl0bGVUZXh0e2ZvbnQtZmFtaWx5OkhlbHZldGljYSxtaWNyb3NvZnQgeWFoZWkgdWkgbGlnaHR9LnBhc3MtZmd0cHdke2ZvbnQtZmFtaWx5OkhlbHZldGljYSxtaWNyb3NvZnQgeWFoZWkgdWkhaW1wb3J0YW50fS5wYXNzLXNtcy1idG57Zm9udC1mYW1pbHk6SGVsdmV0aWNhLG1pY3Jvc29mdCB5YWhlaSB1aSFpbXBvcnRhbnR9LnBhc3MtcmVnbGlua3tmb250LWZhbWlseTpIZWx2ZXRpY2EsbWljcm9zb2Z0IHlhaGVpIHVpIWltcG9ydGFudH0udGFuZy1mb3JlZ3JvdW5ke2JvcmRlci1yYWRpdXM6MnB4IWltcG9ydGFudDtib3JkZXI6MCFpbXBvcnRhbnR9LnRhbmctdGl0bGV7Ym9yZGVyLXJhZGl1czoycHggMnB4IDAgMCFpbXBvcnRhbnR9LnRhbmctcGFzcy1wb3AtbG9naW4gZGl2LnRhbmctdGl0bGV7Ym9yZGVyLXJhZGl1czoycHggMnB4IDAgMCFpbXBvcnRhbnR9LnBhc3MtY2hlY2tib3gtaW5wdXR7d2lkdGg6MTdweDtoZWlnaHQ6MTdweDtib3JkZXI6I2UwZTBlMCAzcHggc29saWQhaW1wb3J0YW50O2JhY2tncm91bmQtY29sb3I6I2ZmZiFpbXBvcnRhbnQ7Ym94LXNoYWRvdzpub25lfS50YW5nLXBhc3MtcG9wLWxvZ2luLWNvbG9yLWJsdWUgLnBhc3MtYnV0dG9uOmZvY3Vze2JveC1zaGFkb3c6cmdiYSgwLDAsMCwuMTU2ODYzKSAwIDNweCAxMHB4LHJnYmEoMCwwLDAsLjIyNzQ1MSkgMCAzcHggMTBweCFpbXBvcnRhbnQ7LXdlYmtpdC1ib3gtc2hhZG93OnJnYmEoMCwwLDAsLjE1Njg2MykgMCAzcHggMTBweCxyZ2JhKDAsMCwwLC4yMjc0NTEpIDAgM3B4IDEwcHghaW1wb3J0YW50fS5ycmVjb20tYnRuLXBhcmVudHtkaXNwbGF5Om5vbmUhaW1wb3J0YW50fS5zLXAtdG9we2JvdHRvbTotOHB4IWltcG9ydGFudH1pbnB1dFt0eXBlPXRleHRdOmZvY3Vze2JvcmRlcjpub25lIWltcG9ydGFudDtib3JkZXItdG9wOjAgc29saWQgI2ZmZiFpbXBvcnRhbnQ7Ym9yZGVyLWJvdHRvbTowIHNvbGlkICNmZmYhaW1wb3J0YW50O2JvcmRlci1sZWZ0OjAgc29saWQgI2ZmZiFpbXBvcnRhbnQ7Ym9yZGVyLXJpZ2h0OjAgc29saWQgI2ZmZiFpbXBvcnRhbnR9YVtzb2Z0X2lkXXtkaXNwbGF5Om5vbmV9Lm9wLXNvZnQtYnRuYm94IC5jLWdhcC1sZWZ0LXNtYWxse21hcmdpbi1sZWZ0OjAhaW1wb3J0YW50O2NvbG9yOiNmZmY7YmFja2dyb3VuZC1jb2xvcjojMzQ3NmQyO3BhZGRpbmc6N3B4IDE1cHg7Ym9yZGVyLXJhZGl1czoycHg7Zm9udC1zaXplOjE0cHg7dHJhbnNpdGlvbjphbGwgLjNzIGVhc2V9Lm9wLXNvZnQtYnRuYm94IC5jLWdhcC1sZWZ0LXNtYWxsOmhvdmVye2JhY2tncm91bmQtY29sb3I6IzcwOThkMDt0cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTtib3gtc2hhZG93OjAgMnB4IDVweCAwIHJnYmEoMCwwLDAsLjE2KSwwIDJweCAxMHB4IDAgcmdiYSgwLDAsMCwuMTIpfS5zb3V0dS1pbnB1dC1pbWFnZXt0b3A6NnB4O2xlZnQ6NXB4fSNrd3tiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50fS5zLXNraW4taGFzYmcgI2t3e2JveC1zaGFkb3c6MCAwIDAgcmdiYSgwLDAsMCwuMil9LnMtc2tpbi1oYXNiZyAuYnRuX3dye3dpZHRoOjM1cHh9I3NfdXNlcnNldHRpbmdfdG9we21hcmdpbi10b3A6LTdweH0jc191c2VybmFtZV90b3B7bWFyZ2luLXRvcDo3cHh9I3Vfc3B7cGFkZGluZy10b3A6MTZweH0uaXB0X3JlY3tiYWNrZ3JvdW5kOjAgMDtiYWNrZ3JvdW5kLWltYWdlOm5vbmV9LmlwdF9yZWM6aG92ZXJ7YmFja2dyb3VuZDowIDA7YmFja2dyb3VuZC1pbWFnZTpub25lfS5pcHRfcmVjOmFmdGVye2Rpc3BsYXk6bm9uZTttYXJnaW4tdG9wOjUwcHh9LmJkcGZtZW51LC51c2VybWVudXtib3JkZXI6bm9uZTtib3gtc2hhZG93Om5vbmU7LXdlYmtpdC1ib3gtc2hhZG93Om5vbmU7LW1vei1ib3gtc2hhZG93Om5vbmU7LW8tYm94LXNoYWRvdzpub25lfS5xcmNvZGVDb257dmlzaWJpbGl0eTpoaWRkZW59I2hlYWQgLmhlYWRCbG9ja3ttYXJnaW46MTJweCAwIDZweCAxMjFweH1he2NvbG9yOiMzNDc2ZDJ9aDMgYTpob3Zlcntib3JkZXItYm90dG9tOiMzNDc2ZDIgMS4ycHggc29saWR9LmMtc2hvd3VybHtjb2xvcjojNGNhZjUwfS5vcC1zZS1saXN0ZW4tcmVjb21tZW5kOmhvdmVye2JvcmRlci1ib3R0b206IzM0NzZkMiAxLjJweCBzb2xpZH0uYy1nYXAtYm90dG9tLXNtYWxsIGE6aG92ZXJ7Ym9yZGVyLWJvdHRvbTojMzQ3NmQyIDEuMnB4IHNvbGlkfS5jLXJvdyBhOmhvdmVye2JvcmRlci1ib3R0b206IzM0NzZkMiAxLjJweCBzb2xpZH0jcnMgYTpob3Zlcntib3JkZXItYm90dG9tOiMzNDc2ZDIgMS4ycHggc29saWR9LmhpbnRfdG9wcnFfdGlwc19pdGVtcyBhOmhvdmVye2JvcmRlci1ib3R0b206IzM0NzZkMiAxLjJweCBzb2xpZH0uYzpob3Zlcntib3JkZXItYm90dG9tOiMzNDc2ZDIgMS4ycHggc29saWR9ZW17Y29sb3I6I2VhNDMzNX0ub3AtdmlkZW8tdmFzdC11bCBsaSBhe21hcmdpbi1ib3R0b206dW5zZXR9Ym9keXtiYWNrZ3JvdW5kLWNvbG9yOiNmN2Y3Zjd9I2Zvcm0gLnNfYnRue2JhY2tncm91bmQtY29sb3I6dHJhbnNwYXJlbnR9I3dyYXBwZXIgI2hlYWR7YmFja2dyb3VuZC1jb2xvcjpyZ2JhKDI0OCwyNDgsMjQ4LC40KTtib3JkZXItYm90dG9tOm5vbmU7YmFja2Ryb3AtZmlsdGVyOmJsdXIoMTBweCl9LmMtdGFicy1uYXZ7YmFja2dyb3VuZC1jb2xvcjojZWVlfS5jLXRhYnMtbmF2LXNlbGVjdGVke2JvcmRlci1ib3R0b206I2Y0NDMzNiAycHggc29saWQhaW1wb3J0YW50O2JhY2tncm91bmQtY29sb3I6IzIxOTZmMyFpbXBvcnRhbnQ7Y29sb3I6I2ZmZiFpbXBvcnRhbnR9I3BhZ2UgYXtiYWNrZ3JvdW5kOiNmZmY7Y29sb3I6IzQyNDI0Mn0jcGFnZSBhOmhvdmVye2JhY2tncm91bmQtY29sb3I6I2UwZTBlMCFpbXBvcnRhbnR9I3BhZ2UgYSAucGM6aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojZTBlMGUwfSNwYWdlIHN0cm9uZ3tiYWNrZ3JvdW5kLWNvbG9yOiM0Mjg1ZjQhaW1wb3J0YW50O2NvbG9yOiNmZmZ9I3BhZ2Ugc3Ryb25nIC5wY3tiYWNrZ3JvdW5kLWNvbG9yOiM0Mjg1ZjQhaW1wb3J0YW50fS5wYzpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNlMGUwZTB9I3NfdGFiIGJ7Ym9yZGVyLWJvdHRvbTozcHggIzM0NzZkMiBzb2xpZDtjb2xvcjojMzQ3NmQyfSNzX3RhYntib3JkZXItYm90dG9tOiNlMGUwZTAgMXB4IHNvbGlkfS5iZHBmbWVudSBhOmhvdmVye2JhY2tncm91bmQtY29sb3I6IzM0NzZkMiFpbXBvcnRhbnR9LnNldHByZWY6aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojMzQ3NmQyIWltcG9ydGFudH0jdSAubGJ7YmFja2dyb3VuZC1jb2xvcjojMzQ3NmQyfSN1IC5sYjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiM2MThjYzd9I3UgLmxiOmFjdGl2ZXtiYWNrZ3JvdW5kLWNvbG9yOiM3ZGEwZDB9I2Jne2JhY2tncm91bmQtY29sb3I6I2ZmZiFpbXBvcnRhbnQ7YmFja2dyb3VuZDojZmZmfSN1MSBhLmxie2JhY2tncm91bmQtY29sb3I6IzM0NzZkMn0jdTEgYS5sYjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiM2MThjYzd9I3UxIGEubGI6YWN0aXZle2JhY2tncm91bmQtY29sb3I6IzdkYTBkMH0jdV9zcCAuc19icml7YmFja2dyb3VuZC1jb2xvcjojZjQ0MzM2fSNzX3VzZXJuYW1lX3RvcHtiYWNrZ3JvdW5kLWNvbG9yOiNlMGUwZTB9LnMtdXNlci1zZXQtbWVudSBhOmhvdmVye2JhY2tncm91bmQtY29sb3I6IzM0NzZkMiFpbXBvcnRhbnR9I3VzZXJ7YmFja2dyb3VuZC1jb2xvcjojZTBlMGUwfS5tc2ctc2V0dGluZy1idG57YmFja2dyb3VuZC1jb2xvcjojMzQ3NmQyIWltcG9ydGFudH0ubm8tdXNle2JhY2tncm91bmQtY29sb3I6I2U1ZTVlNSFpbXBvcnRhbnR9LnBhc3MtdGV4dC1pbnB1dHtib3JkZXItYm90dG9tOiNlMGUwZTAgMnB4IHNvbGlkIWltcG9ydGFudDtib3JkZXItbGVmdDojZmZmIDAgc29saWQhaW1wb3J0YW50O2JvcmRlci1yaWdodDojZmZmIDAgc29saWQhaW1wb3J0YW50O2JvcmRlci10b3A6I2ZmZiAwIHNvbGlkIWltcG9ydGFudH0ucGFzcy10ZXh0LWlucHV0LWZvY3Vze2JvcmRlci1ib3R0b206IzM0NzZkMiAycHggc29saWQhaW1wb3J0YW50O2JvcmRlci1sZWZ0OiNmZmYgMCBzb2xpZCFpbXBvcnRhbnQ7Ym9yZGVyLXJpZ2h0OiNmZmYgMCBzb2xpZCFpbXBvcnRhbnQ7Ym9yZGVyLXRvcDojZmZmIDAgc29saWQhaW1wb3J0YW50fS50YW5nLXBhc3MtcG9wLWxvZ2luLWNvbG9yLWJsdWUgLnBhc3MtYnV0dG9ue2JhY2tncm91bmQtY29sb3I6IzM0NzZkMn0udGFuZy1wYXNzLXBvcC1sb2dpbi1jb2xvci1ibHVlIC5wYXNzLWJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiM2MThjYzd9I2xne21hcmdpbi1sZWZ0Oi0zcmVtO2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0TkNqd2hMUzBnUjJWdVpYSmhkRzl5T2lCQlpHOWlaU0JKYkd4MWMzUnlZWFJ2Y2lBeE9TNHlMakVzSUZOV1J5QkZlSEJ2Y25RZ1VHeDFaeTFKYmlBdUlGTldSeUJXWlhKemFXOXVPaUEyTGpBd0lFSjFhV3hrSURBcElDQXRMVDROQ2p4emRtY2dkbVZ5YzJsdmJqMGlNUzR4SWlCcFpEMGk1YkdDWHpFaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJZ2VHMXNibk02ZUd4cGJtczlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5MekU1T1RrdmVHeHBibXNpSUhnOUlqQndlQ0lnZVQwaU1IQjRJZzBLQ1NCMmFXVjNRbTk0UFNJd0lEQWdNalU1SURFeE5pSWdjM1I1YkdVOUltVnVZV0pzWlMxaVlXTnJaM0p2ZFc1a09tNWxkeUF3SURBZ01qVTVJREV4TmpzaUlIaHRiRHB6Y0dGalpUMGljSEpsYzJWeWRtVWlQZzBLUEhOMGVXeGxJSFI1Y0dVOUluUmxlSFF2WTNOeklqNE5DZ2t1YzNRd2UyWnBiR3c2SXpReU9EVkdORHQ5RFFvSkxuTjBNWHRtYVd4c09pTkZRVFF6TXpVN2ZRMEtDUzV6ZERKN1ptbHNiRG9qUmtaR1JrWkdPMzBOQ2p3dmMzUjViR1UrRFFvOGNHRjBhQ0JqYkdGemN6MGljM1F3SWlCa1BTSk5NVEk0TGpJc056ZGpMVFV1TkN3d0xqUXROUzQyTERNdU55MDRMakVzTmk0M1l5MHlMalVzTXk0eExUY3VOeXcxTGpndE9DNDBMRGt1TldNdE1DNDRMRFF1Tnl3eExqZ3NOeTR5TERRdU15dzRZekl1Tnl3d0xqa3NPQzQ0TFRBdU55d3hNUzQ1TFRBdU53MEtDV2d3TGpOb01DNHpZek11TVN3d0xEa3VNU3d4TGpZc01URXVPU3d3TGpkak1pNDFMVEF1T1N3MExqa3ROQzQxTERRdU15MDRZeTB3TGpVdE15MDJMakl0Tmk0MExUZ3VOeTA1TGpWRE1UTXpMallzT0RBdU55d3hNek11Tnl3M055NDBMREV5T0M0eUxEYzNlaUJOTVRBNUxqTXNOell1TXcwS0NXTXdMRE11TkN3eUxqSXNOaTR4TERRdU9DdzJMakZqTWk0M0xEQXNOQzQ0TFRJdU55dzBMamd0Tmk0eGN5MHlMakl0Tmk0eExUUXVPQzAyTGpGVE1UQTVMak1zTnpNc01UQTVMak1zTnpZdU0zb2dUVEV4T1N3Mk55NDFZekFzTXk0MUxESXVNU3cyTGpRc05DNDJMRFl1TkEwS0NXTXlMallzTUN3MExqY3RNaTQ1TERRdU55MDJMalJ6TFRJdU1TMDJMalF0TkM0M0xUWXVORU14TWpFc05qRXNNVEU1TERZekxqa3NNVEU1TERZM0xqVjZJRTB4TXpBdU55dzJOeTQwWXpBc015NHpMRElzTml3MExqVXNObk0wTGpVdE1pNDNMRFF1TlMwMll6QXRNeTR6TFRJdE5pMDBMalV0TmcwS0NWTXhNekF1Tnl3Mk5DNHhMREV6TUM0M0xEWTNMalI2SUUweE16Z3VNaXczTnk0NFl6QXNNeTR6TERJdU1TdzJMRFF1Tml3Mll6SXVOaXd3TERRdU55MHlMamNzTkM0M0xUWmpNQzB6TGpNdE1pNHhMVFl0TkM0M0xUWkRNVFF3TGpJc056RXVPQ3d4TXpndU1pdzNOQzQxTERFek9DNHlMRGMzTGpoNklnMEtDUzgrRFFvOGNHRjBhQ0JqYkdGemN6MGljM1F4SWlCa1BTSk5Oakl1T0N3NU9DNHlWamt4YURsak1pNHlMREFzTWk0ekxEQXVOQ3d5TGpNc01pNDRkakpqTUN3eUxqTXRNeTR5TERJdU5TMDFMalVzTWk0MWFDMDFMamhXT1RndU1ub2dUVFl5TGpnc09EY3VPRlk0TVdnMUxqZ05DZ2xqTWk0ekxEQXNOUzQxTERBc05TNDFMRE4yTUM0eFl6QXNNaTB3TGpjc015NDNMVEl1TlN3ekxqZEROekV1Tml3NE55NDRMRFl5TGpnc09EY3VPQ3cyTWk0NExEZzNMamg2SUUwMU9TNDFMRGMzTGpsMk1qTm9PUzR4WXpRdU15d3dMRGd1Tnl3d0xEZ3VOeTAxTGpGMkxURXVOUTBLQ1dNd0xUSXVNeTB3TGpJdE15NDRMVEV1TlMwMExqbGpNUzQwTFRFdU1Td3hMalV0TXk0eUxERXVOUzAxTGpGc01Dd3dZekF0Tmk0ekxUUXVOUzAyTGpNdE9DNDNMVFl1TTB3MU9TNDFMRGMzTGpsTU5Ua3VOU3czTnk0NWVpSXZQZzBLUEhCaGRHZ2dZMnhoYzNNOUluTjBNU0lnWkQwaVRUa3lMalFzT1RZdU1XTXRNUzQxTERFdU5pMDBMallzTVM0NExUUXVPU3d4TGpoakxURXVPU3d3TFRNdU9DMHdMamN0TXk0NExUSXVPV013TFRJc01DNDNMVE11TXl3eUxqa3RNeTR6WXpFdU9Dd3dMRFFzTUM0eUxEVXVPQ3d3TGpoV09UWXVNWG9OQ2drZ1RUZzNMak1zTVRBd0xqbGpNQzQxTERBc015NHpMVEF1TWl3MUxqSXRNUzR6YkRBdU15d3hhREl1T1ZZNE9HTXdMVFV1TVMwekxqSXROeTR4TFRndE55NHhZeTB5TGpVc01DMDJMakVzTVMwMkxqWXNNUzR5YkRBdU5pd3pMakpqTWk0eUxUQXVPQ3cwTGpJdE1DNDVMRFV1T1Mwd0xqa05DZ2xqTWk0MkxEQXNOQzQyTERBdU9TdzBMallzTXk0M2RqRXVNV010TVM0MExUQXVOUzB6TGpRdE1DNDVMVFV1T0Mwd0xqbGpMVFF1TWl3d0xUWXVNeXd5TGpNdE5pNHpMRFl1TmtNNE1DNHpMREV3TUM0ekxEZzBMamNzTVRBd0xqa3NPRGN1TXl3eE1EQXVPWG9pTHo0TkNqeHdZWFJvSUdOc1lYTnpQU0p6ZERFaUlHUTlJazA1T1M0M0xEYzRMakZqTUN3d0xqa3NNQzQ1TERFdU55d3hMamdzTVM0M1l6RXVNU3d3TERFdU9TMHdMamdzTVM0NUxURXVOMk13TFRFdE1DNDRMVEV1T0MweExqa3RNUzQ0UXpFd01DNDJMRGMyTGpNc09Ua3VOeXczTnl3NU9TNDNMRGM0TGpGNkRRb0pJRTA1T1M0NUxERXdNQzQyYURNdU5GWTRNUzQxYUMwekxqUldNVEF3TGpaNklpOCtEUW84Y0dGMGFDQmpiR0Z6Y3owaWMzUXhJaUJrUFNKTk1UVTNMallzT0RZdU5tZ3hNUzQ0WXpBdU5Td3dMakVzTUM0NExEQXVOQ3d3TGprc01YWXpMalpvTFRFekxqZDJMVE11TmtNeE5UWXVOeXc0Tnl3eE5UY3NPRFl1Tnl3eE5UY3VOaXc0Tmk0MmVpQk5NVFUzTGpZc09UZ3VOQTBLQ1dNdE1DNDJMREF0TUM0NUxUQXVOQzB4TFRFdU1YWXRNeTQyYURFekxqZDJNeTQzWXpBc01DNDJMVEF1TXl3eExUQXVPU3d4U0RFMU55NDJlaUJOTVRZd0xqa3NPREF1TjJNdE1DNHhMREF1TlMwd0xqSXNNUzR6TFRBdU5Td3lMalJqTFRBdU1Td3dMalF0TUM0eExEQXVOeTB3TGpJc01XZ3RNeTQzRFFvSll5MHhMamdzTUM0eExUSXVOeXd4TGpFdE1pNDRMREl1T0ZZNU9HTXdMakVzTVM0MkxERXVNU3d5TGpVc01pNDRMREl1TjJneE5DNHhZekV1Tnkwd0xqRXNNaTQyTFRFc01pNDNMVEl1TlZZNE4yTXRNQzR4TFRFdU9DMHhMVEl1TnkweUxqY3RNaTQ1YUMwM0RRb0pZekF1TVMwd0xqUXNNQzR5TFRFdU1Td3dMalF0TW1Nd0xqRXRNQzQyTERBdU1TMHhMREF1TWkweExqTm9NVEF1TW5ZdE1pNDJhQzB5TWk0eWRqSXVOa3d4TmpBdU9TdzRNQzQzVERFMk1DNDVMRGd3TGpkNklpOCtEUW84Y0dGMGFDQmpiR0Z6Y3owaWMzUXhJaUJrUFNKTk1UZzVMalFzT0RjdU5HTXRNQzQxTFRBdU1TMHdMamN0TUM0ekxUQXVOeTB3TGpkMkxUQXVPV2cwTGpWMk1DNDVZeTB3TGpFc01DNDBMVEF1TXl3d0xqWXRNQzQzTERBdU4wZ3hPRGt1TkhvZ1RURTVNeTQwTERnNUxqUU5DZ2xqTVM0MUxUQXVNU3d5TGpJdE1DNDNMREl1TXkweVZqZzJhRE11TW5ZdE1pNHhhQzB6TGpKMkxURXVObWd0TWk0MWRqRXVObWd0TkM0MWRpMHhMalpvTFRJdU5uWXhMalpvTFRNdU1sWTRObWd6TGpKMk1TNDBZekF1TVN3eExqTXNNQzQ0TERJc01pNHlMREpJTVRrekxqUjZJRTB4T1RBdU9TdzVPQzR6RFFvSll6SXVNeXd4TGpFc05DNDRMREV1T1N3M0xqWXNNaTQyYkRFdU1pMHlMalJqTFRJdE1DNHpMVFF1TVMwd0xqZ3ROaTR5TFRFdU5tTXhMalV0TVM0eExESXVPQzB5TGpJc015NDRMVE11TldNd0xqUXRNQzQyTERBdU5TMHhMaklzTUM0ekxURXVPV010TUM0MExUQXVPQzB4TGpFdE1TNHlMVEl0TVM0eURRb0phQzB4TWk0M2RqSXVNV2d4TUM0NFl6QXVNeXd3TERBdU5Td3dMakVzTUM0MkxEQXVNbk13TERBdU1pMHdMaklzTUM0MFl5MHdMamtzTUM0NUxUSXNNUzQ0TFRNdU15d3lMalpqTFRFdU55MHhMVEl1T1MweExqa3RNeTQwTFRJdU5tZ3RNeTR4WXpFdU1pd3hMalFzTWk0MkxESXVOeXcwTGpFc015NDREUW9KWXkweUxqTXNNQzQ1TFRRdU5pd3hMalV0Tmk0NUxERXVPR3d4TGpNc01pNHlRekU0TlM0NUxERXdNQzR5TERFNE9DNDJMRGs1TGpNc01Ua3dMamtzT1RndU0zb2dUVEU0TVM0M0xEa3dMamwyTFRndU5XTXdMakV0TUM0NExEQXVOQzB4TGpJc01TNHhMVEV1TTJneE5pNDNkaTB5TGpOb0xUZ3VNdzBLQ1dNdE1DNHhMVEF1TWkwekxqRXRNQzR4TFRNdU1Td3dhQzAyTGpkakxURXVOU3d3TGpJdE1pNDBMREV1TXkweUxqVXNNeTR4ZGpndU4yTXdMakVzTXkwd0xqVXNOaTR5TFRFdU5pdzVMalJzTWk0M0xEQXVPRU14T0RFdU1TdzVOeTQyTERFNE1TNDNMRGswTGpNc01UZ3hMamNzT1RBdU9Yb2lMejROQ2p4d1lYUm9JR05zWVhOelBTSnpkRElpSUdROUlrMHhNakl1TlN3NE9TNDFZekF1T0N3d0xERXVOeXd3TGpJc01pNDBMREF1TlhZMExqaGpNQ3d3TGpRdE1DNDVMREV1TkMweUxqY3NNUzQwWXkweUxqRXNNQzB5TGpZdE1DNDVMVEl1TmkweUxqbDJMVEF1T0EwS0NVTXhNVGt1TlN3NU1DNDBMREV5TUM0eUxEZzVMalVzTVRJeUxqVXNPRGt1TlhvZ1RURXlOaTQyTERnMExqWm9MVEV1TjNZekxqVmpMVEF1Tmkwd0xqSXRNUzQxTFRBdU15MHlMalF0TUM0ell5MHpMamdzTUMwMExqWXNNUzQwTFRRdU5pdzBMamwyTUM0MERRb0pZekFzTXk0MExERXVNeXcwTGpZc05DNDFMRFF1Tm1NeExqRXNNQ3d4TGprdE1DNHlMREl1Tmkwd0xqZHNNQzR5TERBdU9HZ3hMalZNTVRJMkxqWXNPRFF1Tmt3eE1qWXVOaXc0TkM0MmVpSXZQZzBLUEhCaGRHZ2dZMnhoYzNNOUluTjBNaUlnWkQwaVRURXpOeTR4TERnM0xqaG9MVEV1TjNZM0xqUmpMVEF1T1N3d0xqVXRNaTQwTERBdU9DMHpMalFzTUM0NFl5MHhMakVzTUMweExqUXRNQzQyTFRFdU5DMHhMamwyTFRZdU5VZ3hNamwyTmk0NFl6QXNNaTR6TERBdU55d3pMaklzTWk0NUxETXVNZzBLQ1dNeExqUXNNQ3d5TGprdE1DNDBMRE11Tmkwd0xqaHNNQzR4TERBdU9HZ3hMalZXT0RjdU9Ib2lMejROQ2p4d1lYUm9JR05zWVhOelBTSnpkREVpSUdROUlrMHhPRGN1T1N3M055NDFZekF0TVN3d0xqZ3RNUzQ0TERFdU55MHhMamh6TVM0M0xEQXVPQ3d4TGpjc01TNDRjeTB3TGpnc01TNDRMVEV1Tnl3eExqaERNVGc0TGpjc056a3VNaXd4T0RjdU9TdzNPQzQwTERFNE55NDVMRGMzTGpWNklpOCtEUW84TDNOMlp6NE5DZz09KX0jZm9ybSAuc19idG57YmFja2dyb3VuZC1pbWFnZTp1cmwoZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpZFhSbUxUZ2lQejRLUENFdExTQkhaVzVsY21GMGIzSTZJRUZrYjJKbElFbHNiSFZ6ZEhKaGRHOXlJREU1TGpJdU1Td2dVMVpISUVWNGNHOXlkQ0JRYkhWbkxVbHVJQzRnVTFaSElGWmxjbk5wYjI0NklEWXVNREFnUW5WcGJHUWdNQ2tnSUMwdFBnbzhjM1puSUhabGNuTnBiMjQ5SWpFdU1TSWdhV1E5SXVXYnZ1V3hnbDh4SWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhodGJHNXpPbmhzYVc1clBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHhPVGs1TDNoc2FXNXJJaUI0UFNJd2NIZ2lJSGs5SWpCd2VDSUtDU0IyYVdWM1FtOTRQU0l3SURBZ016SWdNeklpSUhOMGVXeGxQU0psYm1GaWJHVXRZbUZqYTJkeWIzVnVaRHB1WlhjZ01DQXdJRE15SURNeU95SWdlRzFzT25Od1lXTmxQU0p3Y21WelpYSjJaU0krQ2p4emRIbHNaU0IwZVhCbFBTSjBaWGgwTDJOemN5SStDZ2t1YzNRd2UyWnBiR3c2SXpRM056bENSRHQ5Q2p3dmMzUjViR1UrQ2p4d1lYUm9JR05zWVhOelBTSnpkREFpSUdROUlrMHhOQzQ0TERJeExqVmpMVEF1TkN3d0xUQXVOeXd3TFRFdU1TMHdMakZqTFRJdU1TMHdMak10TXk0NUxURXVOQzAxTGpJdE0yTXRNUzR6TFRFdU55MHhMamd0TXk0M0xURXVOaTAxTGpoak1DNHpMVEl1TVN3eExqUXRNeTQ1TERNdE5TNHlDZ2xqTVM0M0xURXVNeXd6TGpndE1TNDRMRFV1T0MweExqWmpNaTR4TERBdU15d3pMamtzTVM0MExEVXVNaXd6WXpFdU15d3hMamNzTVM0NExETXVPQ3d4TGpZc05TNDRZeTB3TGpNc01pNHhMVEV1TkN3ekxqa3RNeXcxTGpKRE1UZ3VNaXd5TVN3eE5pNDFMREl4TGpVc01UUXVPQ3d5TVM0MWVnb0pJRTB4TkM0NExEZ3VNV010TVM0eUxEQXRNaTQwTERBdU5DMHpMak1zTVM0eFl5MHlMalFzTVM0NExUSXVPU3cxTGpNdE1TdzNMamRqTVM0NExESXVOQ3cxTGpNc01pNDVMRGN1Tnl3eFl6RXVNaTB3TGprc01TNDVMVEl1TWl3eUxqRXRNeTQyWXpBdU1pMHhMalV0TUM0eUxUSXVPUzB4TGpFdE5DNHhDZ2xUTVRjc09DNDBMREUxTGpVc09DNHlRekUxTGpNc09DNHlMREUxTERndU1Td3hOQzQ0TERndU1Yb2lMejRLUEdjK0NnazhaejRLQ1FrOGNHRjBhQ0JqYkdGemN6MGljM1F3SWlCa1BTSk5NalV1TXl3eU55NDFUREkxTGpNc01qY3VOV010TUM0MkxEQXVOQzB4TGpRc01DNHpMVEV1T0Mwd0xqSnNMVFV1TVMwMkxqZGpMVEF1TkMwd0xqWXRNQzR6TFRFdU5Dd3dMakl0TVM0NGJEQXNNQW9KQ1Fsak1DNDJMVEF1TkN3eExqUXRNQzR6TERFdU9Dd3dMakpzTlM0eExEWXVOME15Tml3eU5pNHpMREkxTGprc01qY3VNU3d5TlM0ekxESTNMalY2SWk4K0NnazhMMmMrQ2p3dlp6NEtQQzl6ZG1jK0NnPT0pIWltcG9ydGFudH0jZm9ybSAuc19idG5fd3J7YmFja2dyb3VuZC1pbWFnZTp1cmwoZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpZFhSbUxUZ2lQejRLUENFdExTQkhaVzVsY21GMGIzSTZJRUZrYjJKbElFbHNiSFZ6ZEhKaGRHOXlJREU1TGpJdU1Td2dVMVpISUVWNGNHOXlkQ0JRYkhWbkxVbHVJQzRnVTFaSElGWmxjbk5wYjI0NklEWXVNREFnUW5WcGJHUWdNQ2tnSUMwdFBnbzhjM1puSUhabGNuTnBiMjQ5SWpFdU1TSWdhV1E5SXVXYnZ1V3hnbDh4SWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhodGJHNXpPbmhzYVc1clBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHhPVGs1TDNoc2FXNXJJaUI0UFNJd2NIZ2lJSGs5SWpCd2VDSUtDU0IyYVdWM1FtOTRQU0l3SURBZ016SWdNeklpSUhOMGVXeGxQU0psYm1GaWJHVXRZbUZqYTJkeWIzVnVaRHB1WlhjZ01DQXdJRE15SURNeU95SWdlRzFzT25Od1lXTmxQU0p3Y21WelpYSjJaU0krQ2p4emRIbHNaU0IwZVhCbFBTSjBaWGgwTDJOemN5SStDZ2t1YzNRd2UyWnBiR3c2SXpRM056bENSRHQ5Q2p3dmMzUjViR1UrQ2p4d1lYUm9JR05zWVhOelBTSnpkREFpSUdROUlrMHhOQzQ0TERJeExqVmpMVEF1TkN3d0xUQXVOeXd3TFRFdU1TMHdMakZqTFRJdU1TMHdMak10TXk0NUxURXVOQzAxTGpJdE0yTXRNUzR6TFRFdU55MHhMamd0TXk0M0xURXVOaTAxTGpoak1DNHpMVEl1TVN3eExqUXRNeTQ1TERNdE5TNHlDZ2xqTVM0M0xURXVNeXd6TGpndE1TNDRMRFV1T0MweExqWmpNaTR4TERBdU15d3pMamtzTVM0MExEVXVNaXd6WXpFdU15d3hMamNzTVM0NExETXVPQ3d4TGpZc05TNDRZeTB3TGpNc01pNHhMVEV1TkN3ekxqa3RNeXcxTGpKRE1UZ3VNaXd5TVN3eE5pNDFMREl4TGpVc01UUXVPQ3d5TVM0MWVnb0pJRTB4TkM0NExEZ3VNV010TVM0eUxEQXRNaTQwTERBdU5DMHpMak1zTVM0eFl5MHlMalFzTVM0NExUSXVPU3cxTGpNdE1TdzNMamRqTVM0NExESXVOQ3cxTGpNc01pNDVMRGN1Tnl3eFl6RXVNaTB3TGprc01TNDVMVEl1TWl3eUxqRXRNeTQyWXpBdU1pMHhMalV0TUM0eUxUSXVPUzB4TGpFdE5DNHhDZ2xUTVRjc09DNDBMREUxTGpVc09DNHlRekUxTGpNc09DNHlMREUxTERndU1Td3hOQzQ0TERndU1Yb2lMejRLUEdjK0NnazhaejRLQ1FrOGNHRjBhQ0JqYkdGemN6MGljM1F3SWlCa1BTSk5NalV1TXl3eU55NDFUREkxTGpNc01qY3VOV010TUM0MkxEQXVOQzB4TGpRc01DNHpMVEV1T0Mwd0xqSnNMVFV1TVMwMkxqZGpMVEF1TkMwd0xqWXRNQzR6TFRFdU5Dd3dMakl0TVM0NGJEQXNNQW9KQ1Fsak1DNDJMVEF1TkN3eExqUXRNQzR6TERFdU9Dd3dMakpzTlM0eExEWXVOME15Tml3eU5pNHpMREkxTGprc01qY3VNU3d5TlM0ekxESTNMalY2SWk4K0NnazhMMmMrQ2p3dlp6NEtQQzl6ZG1jK0NnPT0pIWltcG9ydGFudH0uYy1pY29uLXRpZWJhe2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0S1BDRXRMU0JIWlc1bGNtRjBiM0k2SUVGa2IySmxJRWxzYkhWemRISmhkRzl5SURFNUxqSXVNU3dnVTFaSElFVjRjRzl5ZENCUWJIVm5MVWx1SUM0Z1UxWkhJRlpsY25OcGIyNDZJRFl1TURBZ1FuVnBiR1FnTUNrZ0lDMHRQZ284YzNabklIWmxjbk5wYjI0OUlqRXVNU0lnYVdROUl1V2J2dVd4Z2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lLQ1NCMmFXVjNRbTk0UFNJd0lEQWdNalFnTWpRaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURJMElESTBPeUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0NqeHpkSGxzWlNCMGVYQmxQU0owWlhoMEwyTnpjeUkrQ2drdWMzUXdlMlpwYkd3Nkl6TTNRVUpGTXp0OUNna3VjM1F4ZTJacGJHdzZJMFpHUmtaR1JqdDlDand2YzNSNWJHVStDanh3WVhSb0lHTnNZWE56UFNKemREQWlJR1E5SWsweU1DNDVMREl6TGpOSU15NHhZeTB4TGpFc01DMHlMVEF1T1MweUxUSldNaTQ0WXpBdE1TNHhMREF1T1MweUxESXRNbWd4Tnk0NFl6RXVNU3d3TERJc01DNDVMRElzTW5ZeE9DNDFRekl5TGprc01qSXVOQ3d5TWl3eU15NHpMREl3TGprc01qTXVNM29pQ2drdlBnbzhaejRLQ1R4d1lYUm9JR05zWVhOelBTSnpkREVpSUdROUlrMDFMaklzTVRrdU9VdzBMREU1TGpKak1TNDFMVEV1T1N3eUxqTXRNeTQ1TERJdU5DMDFMamhqTUMweExEQXVNUzB6TGpFc01DNHhMVFl1TTBnNFl6QXNNaTR5TERBc05DNHpMVEF1TVN3MkxqUmpNQ3d3TGpZdE1DNHhMREV1TWkwd0xqTXNNUzQ0Q2drSmFERXVNV013TGpVc01DNDRMREV1TWl3eUxqUXNNaTR5TERRdU5rZzVZeTB3TGpZdE1TNDFMVEV1TWkweUxqZ3RNUzQyTFRNdU9VTTNMREUzTGpJc05pNHpMREU0TGpZc05TNHlMREU1TGpsNklFMDBMakVzTVRRdU9GWTJMakZqTUMweExqSXNNQzQxTFRFdU9Dd3hMall0TVM0NGFETUtDUWxqTVN3d0xERXVOaXd3TGpjc01TNDJMREV1T0hZNExqWklPQzQ1VmpZdU0yTXdMVEF1TkMwd0xqTXRNQzQyTFRBdU5pMHdMalpvTFRKakxUQXVOQ3d3TFRBdU5pd3dMakl0TUM0MkxEQXVOblk0TGpWSU5DNHhlaUJOTVRJdU9Td3hPUzQxWXkweExqRXNNQzB4TGpjdE1DNDJMVEV1T0MweExqWldNVE1LQ1Fsak1DMHhMakVzTUM0M0xURXVOeXd4TGpndE1TNDRhREZXTkM0eGFERXVOM1l5TGpWSU1qQldPR2d0TkM0emRqTXVNbWd4TGpoak1TNHhMREFzTVM0M0xEQXVOeXd4TGpnc01TNDRkalF1T0dNd0xERXVNUzB3TGpZc01TNDJMVEV1T0N3eExqZElNVEl1T1hvZ1RURXlMamdzTVRNdU0zWTBMak1LQ1Fsak1Dd3dMalFzTUM0ekxEQXVOeXd3TGpjc01DNDNhRE11TW1Nd0xqVXNNQ3d3TGpjdE1DNHpMREF1T0Mwd0xqZDJMVFF1TkdNd0xUQXVOQzB3TGpNdE1DNDNMVEF1Tnkwd0xqZG9MVE11TTBNeE15NHhMREV5TGpZc01USXVPU3d4TWk0NExERXlMamdzTVRNdU0zb2lMejRLUEM5blBnbzhMM04yWno0Syl9I3UgLnBme2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0S1BDRXRMU0JIWlc1bGNtRjBiM0k2SUVGa2IySmxJRWxzYkhWemRISmhkRzl5SURFNUxqSXVNU3dnVTFaSElFVjRjRzl5ZENCUWJIVm5MVWx1SUM0Z1UxWkhJRlpsY25OcGIyNDZJRFl1TURBZ1FuVnBiR1FnTUNrZ0lDMHRQZ284YzNabklIWmxjbk5wYjI0OUlqRXVNU0lnYVdROUl1V2J2dVd4Z2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lLQ1NCMmFXVjNRbTk0UFNJd0lEQWdNeklnTXpJaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURNeUlETXlPeUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0NqeHpkSGxzWlNCMGVYQmxQU0owWlhoMEwyTnpjeUkrQ2drdWMzUXdlMlpwYkd3Nkl6WkVOa1EyUkR0OUNqd3ZjM1I1YkdVK0NqeHdZWFJvSUdOc1lYTnpQU0p6ZERBaUlHUTlJazB5TlM0eUxERTNMakpqTUMwd0xqUXNNQzR4TFRBdU9Dd3dMakV0TVM0eVl6QXRNQzQwTERBdE1DNDRMVEF1TVMweExqSnNNaTQyTFRKak1DNHlMVEF1TWl3d0xqTXRNQzQxTERBdU1TMHdMamhzTFRJdU5TMDBMak1LQ1dNdE1DNHhMVEF1TXkwd0xqVXRNQzQwTFRBdU9DMHdMak5zTFRNdU1Td3hMakpqTFRBdU5pMHdMalV0TVM0ekxUQXVPUzB5TGpFdE1TNHliQzB3TGpVdE15NHpZekF0TUM0ekxUQXVNeTB3TGpVdE1DNDJMVEF1TldndE5XTXRNQzR6TERBdE1DNDJMREF1TWkwd0xqWXNNQzQxYkMwd0xqVXNNeTR6Q2dsakxUQXVPQ3d3TGpNdE1TNDBMREF1TnkweUxqRXNNUzR5VERjdU15dzNMalJETnl3M0xqTXNOaTQzTERjdU5DdzJMalVzTnk0M1REUXNNVEV1T1dNdE1DNHlMREF1TXkwd0xqRXNNQzQyTERBdU1Td3dMamhzTWk0MkxESmpNQ3d3TGpRdE1DNHhMREF1T0Mwd0xqRXNNUzR5Q2dsak1Dd3dMalFzTUN3d0xqZ3NNQzR4TERFdU1td3RNaTQyTERKakxUQXVNaXd3TGpJdE1DNHpMREF1TlMwd0xqRXNNQzQ0YkRJdU5TdzBMak5qTUM0eExEQXVNeXd3TGpVc01DNDBMREF1T0N3d0xqTnNNeTR4TFRFdU1tTXdMallzTUM0MUxERXVNeXd3TGprc01pNHhMREV1TW13d0xqVXNNeTR6Q2dsak1Dd3dMak1zTUM0ekxEQXVOU3d3TGpZc01DNDFhRFZqTUM0ekxEQXNNQzQyTFRBdU1pd3dMall0TUM0MWJEQXVOUzB6TGpOak1DNDRMVEF1TXl3eExqUXRNQzQzTERJdU1TMHhMakpzTXk0eExERXVNbU13TGpNc01DNHhMREF1Tml3d0xEQXVPQzB3TGpOc01pNDFMVFF1TXdvSll6QXVNUzB3TGpNc01DNHhMVEF1Tmkwd0xqRXRNQzQ0VERJMUxqSXNNVGN1TW5vZ1RURTJMREl3TGpOakxUSXVOQ3d3TFRRdU15MHhMamt0TkM0ekxUUXVNM014TGprdE5DNHpMRFF1TXkwMExqTnpOQzR6TERFdU9TdzBMak1zTkM0elV6RTRMalFzTWpBdU15d3hOaXd5TUM0emVpSXZQZ284TDNOMlp6NEspfSN1IC5sYntiYWNrZ3JvdW5kLWltYWdlOnVybChkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NEtQQ0V0TFNCSFpXNWxjbUYwYjNJNklFRmtiMkpsSUVsc2JIVnpkSEpoZEc5eUlERTVMakl1TVN3Z1UxWkhJRVY0Y0c5eWRDQlFiSFZuTFVsdUlDNGdVMVpISUZabGNuTnBiMjQ2SURZdU1EQWdRblZwYkdRZ01Da2dJQzB0UGdvOGMzWm5JSFpsY25OcGIyNDlJakV1TVNJZ2FXUTlJdVdidnVXeGdsOHhJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGh0Ykc1ek9uaHNhVzVyUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hzYVc1cklpQjRQU0l3Y0hnaUlIazlJakJ3ZUNJS0NTQjJhV1YzUW05NFBTSXdJREFnTkRZZ05EWWlJSE4wZVd4bFBTSmxibUZpYkdVdFltRmphMmR5YjNWdVpEcHVaWGNnTUNBd0lEUTJJRFEyT3lJZ2VHMXNPbk53WVdObFBTSndjbVZ6WlhKMlpTSStDanh6ZEhsc1pTQjBlWEJsUFNKMFpYaDBMMk56Y3lJK0Nna3VjM1F3ZTJacGJHdzZJMFpHUmtaR1JqdDlDand2YzNSNWJHVStDanh3WVhSb0lHTnNZWE56UFNKemREQWlJR1E5SWsweU15d3lNMk15TGprc01DdzFMakl0TWk0ekxEVXVNaTAxTGpKekxUSXVNeTAxTGpJdE5TNHlMVFV1TW5NdE5TNHlMREl1TXkwMUxqSXNOUzR5VXpJd0xqRXNNak1zTWpNc01qTjZJRTB5TXl3eU5TNDJDZ2xqTFRNdU5Td3dMVEV3TGpRc01TNDNMVEV3TGpRc05TNHlkakl1Tm1neU1DNDNkaTB5TGpaRE16TXVOQ3d5Tnk0ekxESTJMalVzTWpVdU5pd3lNeXd5TlM0MmVpSXZQZ284TDNOMlp6NEspfSN1MSBhLnBme2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0S1BDRXRMU0JIWlc1bGNtRjBiM0k2SUVGa2IySmxJRWxzYkhWemRISmhkRzl5SURFNUxqSXVNU3dnVTFaSElFVjRjRzl5ZENCUWJIVm5MVWx1SUM0Z1UxWkhJRlpsY25OcGIyNDZJRFl1TURBZ1FuVnBiR1FnTUNrZ0lDMHRQZ284YzNabklIWmxjbk5wYjI0OUlqRXVNU0lnYVdROUl1V2J2dVd4Z2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lLQ1NCMmFXVjNRbTk0UFNJd0lEQWdNeklnTXpJaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURNeUlETXlPeUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0NqeHpkSGxzWlNCMGVYQmxQU0owWlhoMEwyTnpjeUkrQ2drdWMzUXdlMlpwYkd3Nkl6WkVOa1EyUkR0OUNqd3ZjM1I1YkdVK0NqeHdZWFJvSUdOc1lYTnpQU0p6ZERBaUlHUTlJazB5TlM0eUxERTNMakpqTUMwd0xqUXNNQzR4TFRBdU9Dd3dMakV0TVM0eVl6QXRNQzQwTERBdE1DNDRMVEF1TVMweExqSnNNaTQyTFRKak1DNHlMVEF1TWl3d0xqTXRNQzQxTERBdU1TMHdMamhzTFRJdU5TMDBMak1LQ1dNdE1DNHhMVEF1TXkwd0xqVXRNQzQwTFRBdU9DMHdMak5zTFRNdU1Td3hMakpqTFRBdU5pMHdMalV0TVM0ekxUQXVPUzB5TGpFdE1TNHliQzB3TGpVdE15NHpZekF0TUM0ekxUQXVNeTB3TGpVdE1DNDJMVEF1TldndE5XTXRNQzR6TERBdE1DNDJMREF1TWkwd0xqWXNNQzQxYkMwd0xqVXNNeTR6Q2dsakxUQXVPQ3d3TGpNdE1TNDBMREF1TnkweUxqRXNNUzR5VERjdU15dzNMalJETnl3M0xqTXNOaTQzTERjdU5DdzJMalVzTnk0M1REUXNNVEV1T1dNdE1DNHlMREF1TXkwd0xqRXNNQzQyTERBdU1Td3dMamhzTWk0MkxESmpNQ3d3TGpRdE1DNHhMREF1T0Mwd0xqRXNNUzR5Q2dsak1Dd3dMalFzTUN3d0xqZ3NNQzR4TERFdU1td3RNaTQyTERKakxUQXVNaXd3TGpJdE1DNHpMREF1TlMwd0xqRXNNQzQ0YkRJdU5TdzBMak5qTUM0eExEQXVNeXd3TGpVc01DNDBMREF1T0N3d0xqTnNNeTR4TFRFdU1tTXdMallzTUM0MUxERXVNeXd3TGprc01pNHhMREV1TW13d0xqVXNNeTR6Q2dsak1Dd3dMak1zTUM0ekxEQXVOU3d3TGpZc01DNDFhRFZqTUM0ekxEQXNNQzQyTFRBdU1pd3dMall0TUM0MWJEQXVOUzB6TGpOak1DNDRMVEF1TXl3eExqUXRNQzQzTERJdU1TMHhMakpzTXk0eExERXVNbU13TGpNc01DNHhMREF1Tml3d0xEQXVPQzB3TGpOc01pNDFMVFF1TXdvSll6QXVNUzB3TGpNc01DNHhMVEF1Tmkwd0xqRXRNQzQ0VERJMUxqSXNNVGN1TW5vZ1RURTJMREl3TGpOakxUSXVOQ3d3TFRRdU15MHhMamt0TkM0ekxUUXVNM014TGprdE5DNHpMRFF1TXkwMExqTnpOQzR6TERFdU9TdzBMak1zTkM0elV6RTRMalFzTWpBdU15d3hOaXd5TUM0emVpSXZQZ284TDNOMlp6NEspfSN1MSBhLnBmLCN1MSBhLmxie2NvbG9yOnRyYW5zcGFyZW50IWltcG9ydGFudH0jdTEgYS5icml7YmFja2dyb3VuZC1pbWFnZTp1cmwoZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpZFhSbUxUZ2lQejRLUENFdExTQkhaVzVsY21GMGIzSTZJRUZrYjJKbElFbHNiSFZ6ZEhKaGRHOXlJREU1TGpJdU1Td2dVMVpISUVWNGNHOXlkQ0JRYkhWbkxVbHVJQzRnVTFaSElGWmxjbk5wYjI0NklEWXVNREFnUW5WcGJHUWdNQ2tnSUMwdFBnbzhjM1puSUhabGNuTnBiMjQ5SWpFdU1TSWdhV1E5SXVXYnZ1V3hnbDh4SWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhodGJHNXpPbmhzYVc1clBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHhPVGs1TDNoc2FXNXJJaUI0UFNJd2NIZ2lJSGs5SWpCd2VDSUtDU0IyYVdWM1FtOTRQU0l3SURBZ016SWdNeklpSUhOMGVXeGxQU0psYm1GaWJHVXRZbUZqYTJkeWIzVnVaRHB1WlhjZ01DQXdJRE15SURNeU95SWdlRzFzT25Od1lXTmxQU0p3Y21WelpYSjJaU0krQ2p4emRIbHNaU0IwZVhCbFBTSjBaWGgwTDJOemN5SStDZ2t1YzNRd2UyWnBiR3c2SXpaRU5rUTJSRHQ5Q2p3dmMzUjViR1UrQ2p4d1lYUm9JR05zWVhOelBTSnpkREFpSUdROUlrMHpMamNzT1M0NGFEWXVNbFl6TGpkSU15NDNWamt1T0hvZ1RURXlMamtzTWpndU0yZzJMakoyTFRZdU1tZ3ROaTR5VmpJNExqTjZJRTB6TGpjc01qZ3VNMmcyTGpKMkxUWXVNa2d6TGpkV01qZ3VNM29nVFRNdU55d3hPUzR4YURZdU1uWXROaTR5Q2dsSU15NDNWakU1TGpGNklFMHhNaTQ1TERFNUxqRm9OaTR5ZGkwMkxqSm9MVFl1TWxZeE9TNHhlaUJOTWpJdU1pd3pMamQyTmk0eWFEWXVNbFl6TGpkSU1qSXVNbm9nVFRFeUxqa3NPUzQ0YURZdU1sWXpMamRvTFRZdU1sWTVMamg2SUUweU1pNHlMREU1TGpGb05pNHlkaTAyTGpKb0xUWXVNbFl4T1M0eENnbDZJRTB5TWk0eUxESTRMak5vTmk0eWRpMDJMakpvTFRZdU1sWXlPQzR6ZWlJdlBnbzhMM04yWno0Syl9I3NfdXNlcnNldHRpbmdfdG9we2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0S1BDRXRMU0JIWlc1bGNtRjBiM0k2SUVGa2IySmxJRWxzYkhWemRISmhkRzl5SURFNUxqSXVNU3dnVTFaSElFVjRjRzl5ZENCUWJIVm5MVWx1SUM0Z1UxWkhJRlpsY25OcGIyNDZJRFl1TURBZ1FuVnBiR1FnTUNrZ0lDMHRQZ284YzNabklIWmxjbk5wYjI0OUlqRXVNU0lnYVdROUl1V2J2dVd4Z2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lLQ1NCMmFXVjNRbTk0UFNJd0lEQWdNeklnTXpJaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURNeUlETXlPeUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0NqeHpkSGxzWlNCMGVYQmxQU0owWlhoMEwyTnpjeUkrQ2drdWMzUXdlMlpwYkd3Nkl6WkVOa1EyUkR0OUNqd3ZjM1I1YkdVK0NqeHdZWFJvSUdOc1lYTnpQU0p6ZERBaUlHUTlJazB5TlM0eUxERTNMakpqTUMwd0xqUXNNQzR4TFRBdU9Dd3dMakV0TVM0eVl6QXRNQzQwTERBdE1DNDRMVEF1TVMweExqSnNNaTQyTFRKak1DNHlMVEF1TWl3d0xqTXRNQzQxTERBdU1TMHdMamhzTFRJdU5TMDBMak1LQ1dNdE1DNHhMVEF1TXkwd0xqVXRNQzQwTFRBdU9DMHdMak5zTFRNdU1Td3hMakpqTFRBdU5pMHdMalV0TVM0ekxUQXVPUzB5TGpFdE1TNHliQzB3TGpVdE15NHpZekF0TUM0ekxUQXVNeTB3TGpVdE1DNDJMVEF1TldndE5XTXRNQzR6TERBdE1DNDJMREF1TWkwd0xqWXNNQzQxYkMwd0xqVXNNeTR6Q2dsakxUQXVPQ3d3TGpNdE1TNDBMREF1TnkweUxqRXNNUzR5VERjdU15dzNMalJETnl3M0xqTXNOaTQzTERjdU5DdzJMalVzTnk0M1REUXNNVEV1T1dNdE1DNHlMREF1TXkwd0xqRXNNQzQyTERBdU1Td3dMamhzTWk0MkxESmpNQ3d3TGpRdE1DNHhMREF1T0Mwd0xqRXNNUzR5Q2dsak1Dd3dMalFzTUN3d0xqZ3NNQzR4TERFdU1td3RNaTQyTERKakxUQXVNaXd3TGpJdE1DNHpMREF1TlMwd0xqRXNNQzQ0YkRJdU5TdzBMak5qTUM0eExEQXVNeXd3TGpVc01DNDBMREF1T0N3d0xqTnNNeTR4TFRFdU1tTXdMallzTUM0MUxERXVNeXd3TGprc01pNHhMREV1TW13d0xqVXNNeTR6Q2dsak1Dd3dMak1zTUM0ekxEQXVOU3d3TGpZc01DNDFhRFZqTUM0ekxEQXNNQzQyTFRBdU1pd3dMall0TUM0MWJEQXVOUzB6TGpOak1DNDRMVEF1TXl3eExqUXRNQzQzTERJdU1TMHhMakpzTXk0eExERXVNbU13TGpNc01DNHhMREF1Tml3d0xEQXVPQzB3TGpOc01pNDFMVFF1TXdvSll6QXVNUzB3TGpNc01DNHhMVEF1Tmkwd0xqRXRNQzQ0VERJMUxqSXNNVGN1TW5vZ1RURTJMREl3TGpOakxUSXVOQ3d3TFRRdU15MHhMamt0TkM0ekxUUXVNM014TGprdE5DNHpMRFF1TXkwMExqTnpOQzR6TERFdU9TdzBMak1zTkM0elV6RTRMalFzTWpBdU15d3hOaXd5TUM0emVpSXZQZ284TDNOMlp6NEspfSNpbXNne2JhY2tncm91bmQtaW1hZ2U6dXJsKGRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0TkNqd2hMUzBnUjJWdVpYSmhkRzl5T2lCQlpHOWlaU0JKYkd4MWMzUnlZWFJ2Y2lBeE9TNHlMakVzSUZOV1J5QkZlSEJ2Y25RZ1VHeDFaeTFKYmlBdUlGTldSeUJXWlhKemFXOXVPaUEyTGpBd0lFSjFhV3hrSURBcElDQXRMVDROQ2p4emRtY2dkbVZ5YzJsdmJqMGlNUzR4SWlCcFpEMGk1WnUrNWJHQ1h6RWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SWdlRzFzYm5NNmVHeHBibXM5SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpFNU9Ua3ZlR3hwYm1zaUlIZzlJakJ3ZUNJZ2VUMGlNSEI0SWcwS0NTQjJhV1YzUW05NFBTSXdJREFnTXpJZ016SWlJSE4wZVd4bFBTSmxibUZpYkdVdFltRmphMmR5YjNWdVpEcHVaWGNnTUNBd0lETXlJRE15T3lJZ2VHMXNPbk53WVdObFBTSndjbVZ6WlhKMlpTSStEUW84YzNSNWJHVWdkSGx3WlQwaWRHVjRkQzlqYzNNaVBnMEtDUzV6ZERCN1ptbHNiRG9qTmtRMlJEWkVPMzBOQ2p3dmMzUjViR1UrRFFvOGNHRjBhQ0JqYkdGemN6MGljM1F3SWlCa1BTSk5NalV1TXl3MExqWm9MVEU1UXpVc05DNDJMRE11T1N3MUxqY3NNeTQ1TERkc01Dd3lNUzQwYkRRdU9DMDBMamhvTVRZdU5tTXhMak1zTUN3eUxqUXRNUzR4TERJdU5DMHlMalJXTjBNeU55NDNMRFV1Tnl3eU5pNDJMRFF1Tml3eU5TNHpMRFF1Tm5vTkNna2dUVEl5TGprc01UZ3VPVWc0TGpaMkxUSXVOR2d4TkM0elZqRTRMamw2SUUweU1pNDVMREUxTGpOSU9DNDJkaTB5TGpSb01UUXVNMVl4TlM0emVpQk5Nakl1T1N3eE1TNDNTRGd1TmxZNUxqUm9NVFF1TTFZeE1TNDNlaUl2UGcwS1BDOXpkbWMrRFFvPSl9LmMtY29udGFpbmVye2JhY2tncm91bmQ6I2ZmZjtib3JkZXItcmFkaXVzOjJweDtwYWRkaW5nOjI1cHg7dHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwcztib3gtc2hhZG93OjAgMXB4IDRweCAwIHJnYmEoMCwwLDAsLjE0KTt3aWR0aDo1NDlweH1oMyBhOnZpc2l0ZWR7b3BhY2l0eTouNCFpbXBvcnRhbnQ7Y29sb3I6I2JiYiFpbXBvcnRhbnR9LmMtY29udGFpbmVyOmhvdmVye3RyYW5zaXRpb246YWxsIC41cyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzO2JveC1zaGFkb3c6cmdiYSgwLDAsMCwuMTE3NjQ3KSAwIDFweCA2cHgscmdiYSgwLDAsMCwuMTE3NjQ3KSAwIDFweCA0cHh9LmMtY29udGFpbmVyOmFjdGl2ZXt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzO2JveC1zaGFkb3c6cmdiYSgwLDAsMCwuMTg4MjM1KSAwIDEwcHggMzBweCxyZ2JhKDAsMCwwLC4yMjc0NTEpIDAgNnB4IDEwcHh9LnR7cGFkZGluZy1ib3R0b206MTBweH0uYy1ib3JkZXJ7d2lkdGg6NTU5cHg7Ym94LXNoYWRvdzpub25lIWltcG9ydGFudDttYXJnaW4tdG9wOjE3cHg7bWFyZ2luLWJvdHRvbToyM3B4O2JvcmRlci10b3A6I2VlZSAxcHggc29saWQ7Ym9yZGVyLWJvdHRvbTojZWVlIDFweCBzb2xpZH0jaGVscHtwYWRkaW5nLWxlZnQ6MTA3cHghaW1wb3J0YW50fS5jLXRvb2xzIGF7Ym9yZGVyOjAhaW1wb3J0YW50fS5mMTMgYTpob3Zlcntib3JkZXI6bm9uZSFpbXBvcnRhbnR9LmYxMyAubTpob3Zlcntib3JkZXItYm90dG9tOnNvbGlkIDFweCAjNjY2IWltcG9ydGFudH0uZyAubTpob3Zlcntib3JkZXItYm90dG9tOnNvbGlkIDFweCAjNjY2IWltcG9ydGFudH0uYy1yb3cgYTpob3Zlcntib3JkZXItYm90dG9tOiMzNDc2ZDIgMXB4IHNvbGlkfS5jLXNwYW42IGE6aG92ZXJ7Ym9yZGVyLWJvdHRvbTpub25lfS5vcF92ZF9taW5pbmV3ZXN0X2xpbms6aG92ZXJ7b3BhY2l0eTouOH0ub3AtdGllYmEtb2ZmaWNhbC1sb29rbW9yZSBhOmhvdmVye2JvcmRlci1ib3R0b206IzM0NzZkMiAxcHggc29saWR9b3AtdGllYmEtZ2VuZXJhbC1sb29rbW9yZSBhOmhvdmVye2JvcmRlci1ib3R0b206IzM0NzZkMiAxcHggc29saWR9LmMtdGlwLW1lbnUgdWwgbGkgYXtjb2xvcjojMzQ3NmQyIWltcG9ydGFudH1oMyBhOmhvdmVye2JvcmRlcjpub25lIWltcG9ydGFudDtvcGFjaXR5Oi43O3RyYW5zaXRpb246YWxsIDQ1MG1zIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9aDMgYXt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfS5zaXRlbGlua19zdW1tYXJ5IGE6aG92ZXJ7Ym9yZGVyLWJvdHRvbTojMzQ3NmQyIDFweCBzb2xpZH0uYy1ncmF5OmhvdmVye2JvcmRlci1ib3R0b206IzY2NiAxcHggc29saWR9Lm9wX2tlZnV0YWJsZV9jb21taXR0ZWw6aG92ZXJ7Ym9yZGVyLWJvdHRvbTojNjY2IDFweCBzb2xpZH0ub3Atc29mdC1idG5ib3ggYTpob3Zlcntib3JkZXI6bm9uZSFpbXBvcnRhbnR9Lm9wLXNvZnQtYXMtcGMtZG93bmJ0bnttYXJnaW4tbGVmdDowIWltcG9ydGFudDtjb2xvcjojZmZmO2JhY2tncm91bmQtY29sb3I6IzM0NzZkMjtwYWRkaW5nOjNweCAxNXB4O2JvcmRlci1yYWRpdXM6MnB4O2ZvbnQtc2l6ZToxNHB4O3RyYW5zaXRpb246YWxsIC4zcyBlYXNlO2JvcmRlcjpub25lO21hcmdpbi10b3A6LTNweH0ub3Atc29mdC1hcy1wYy1kb3duYnRuOmhvdmVye2JhY2tncm91bmQtY29sb3I6IzcwOThkMDt0cmFuc2l0aW9uOmFsbCAuM3MgZWFzZTtib3gtc2hhZG93OjAgMnB4IDVweCAwIHJnYmEoMCwwLDAsLjE2KSwwIDJweCAxMHB4IDAgcmdiYSgwLDAsMCwuMTIpO2JhY2tncm91bmQtaW1hZ2U6bm9uZX0uYy1idG4tcHJpbWFyeXttYXJnaW4tbGVmdDowIWltcG9ydGFudDtjb2xvcjojZmZmO2JhY2tncm91bmQtY29sb3I6IzM0NzZkMjtwYWRkaW5nOjNweCAxNXB4O2JvcmRlci1yYWRpdXM6MnB4O2ZvbnQtc2l6ZToxNHB4O3RyYW5zaXRpb246YWxsIC4zcyBlYXNlO2JvcmRlcjpub25lO21hcmdpbi10b3A6LTNweH0uYy1idG4tcHJpbWFyeTpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiM3MDk4ZDA7dHJhbnNpdGlvbjphbGwgLjNzIGVhc2U7Ym94LXNoYWRvdzowIDJweCA1cHggMCByZ2JhKDAsMCwwLC4xNiksMCAycHggMTBweCAwIHJnYmEoMCwwLDAsLjEyKTtiYWNrZ3JvdW5kLWltYWdlOm5vbmV9Lm9wLXNvZnQtdGl0bGUgYTpob3Zlcntib3JkZXI6bm9uZSFpbXBvcnRhbnQ7b3BhY2l0eTouNzt0cmFuc2l0aW9uOmFsbCA0NTBtcyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfS5vcC1zb2Z0LXRpdGxlIGF7dHJhbnNpdGlvbjphbGwgNDUwbXMgY3ViaWMtYmV6aWVyKC4yMywxLC4zMiwxKSAwc30ubnVtc3t3aWR0aDo1OThweH0uc2VhcmNoX3Rvb2xfY29udGVye3dpZHRoOjU5OHB4fS5vcF9vZmZpY2FsX3dlaWJvX290aGVyIGE6aG92ZXJ7dGV4dC1kZWNvcmF0aW9uOm5vbmUhaW1wb3J0YW50fS5vcF9vZmZpY2FsX3dlaWJvX2luZm8gYTpob3Zlcnt0ZXh0LWRlY29yYXRpb246bm9uZSFpbXBvcnRhbnR9Lm9wX29mZmljYWxfd2VpYm9fY29udGVudCBhOmhvdmVye3RleHQtZGVjb3JhdGlvbjpub25lIWltcG9ydGFudH0uYy1idG57Ym9yZGVyOm5vbmUhaW1wb3J0YW50fS5vcC16eC1uZXctbXZpZGVvLWluZm86aG92ZXJ7Ym9yZGVyLWJvdHRvbTpub25lfS5vcC16eC1uZXctbXZpZGVvLXJsdCBhOmhvdmVye2JvcmRlci1ib3R0b206IzM0NzZkMiAxcHggc29saWR9Lm9wLXp4LW5ldy1tdmlkZW8tb25lbGluZSBhOmhvdmVye2JvcmRlci1ib3R0b206IzM0NzZkMiAxcHggc29saWR9LmhpbnRfY29tbW9uX3Jlc3RvcHtjb2xvcjojZWE0MzM1O2ZvbnQtc2l6ZTptZWRpdW07Zm9udC13ZWlnaHQ6NzAwfS5vcC10aWViYS1nZW5lcmFsLW1haW4tY29sIHA6aG92ZXJ7Ym9yZGVyOm5vbmUhaW1wb3J0YW50fS5jLXRleHR7YmFja2dyb3VuZDojMzQ3NmQyO2NvbG9yOiNmZmY7Ym9yZGVyOiMzNDc2ZDIgMXB4IHNvbGlkO3BhZGRpbmctdG9wOjNweDtib3JkZXItcmFkaXVzOjJweH0uYy10ZXh0OmhvdmVye2JhY2tncm91bmQ6MCAwO2NvbG9yOiMzNDc2ZDI7Ym9yZGVyOiMzNDc2ZDIgMXB4IHNvbGlkIWltcG9ydGFudDtwYWRkaW5nLXRvcDozcHg7Ym9yZGVyLXJhZGl1czoycHh9"},{"meta":{"name":"googleCommonStyle.css","url":"http://ibaidu.ntaow.com/newcss/googleCommonStyle.css?t=24.12","ts":1605621954352,"mimetype":"text/css"},"source":"ZGl2LnJlc190b3BfYmFubmVyLCNwYWdlIC5maywjaGVhZCAuaGVhZEJsb2NrLCNyc190b3BfbmV3LCNjb250ZW50X3JpZ2h0LCNyc28+dGFibGUsI3Jzbz5kaXZbaWQqPSIzMCJdLCNyc28gLmMtcmVjb21tZW5kLCNyc28gLmxlZnRCbG9jaywjcnNvIC5oaXRfdG9wX25ldywjcnNvICNmbGQsI3JzbyBkaXYucnJlY29tLWJ0bi1wYXJlbnQsI2NvbnRlbnRfcmlnaHQsI2NlbnRlcl9jb2w+I3RhdywjZmxkLCNkZW1ve2Rpc3BsYXk6bm9uZSFpbXBvcnRhbnR9Ym9keVtnb29nbGVde2JhY2tncm91bmQtY29sb3I6I2ZkZmRmZH0jdG9wX25hdiAjaGR0YntiYWNrZ3JvdW5kOnVuc2V0fSNjbnQgI2hkdGJTdW0sI2NudD4jYXBwYmFye2JhY2tncm91bmQ6dHJhbnNwYXJlbnR9I2Zvcm0gLmJkc3Vne3dpZHRoOjc2JX0jYWxhX2ltZ19yZXN1bHRze292ZXJmbG93OmhpZGRlbn1hLGEgZW0sI3UgYXt0ZXh0LWRlY29yYXRpb246bm9uZX1hOmhvdmVyLGE6aG92ZXIgaDN7dGV4dC1kZWNvcmF0aW9uOm5vbmUhaW1wb3J0YW50fSNoZWFkLCNzX3RhYntiYWNrZ3JvdW5kLWNvbG9yOiNmOGY4Zjh9I2hlYWR7Ym9yZGVyLWJvdHRvbTpub25lfSNmb3Jte2JhY2tncm91bmQtY29sb3I6dW5zZXR9I2Zvcm0gLmJkc3VnIGxpe3dpZHRoOmF1dG87Y29sb3I6IzAwMDtmb250OjE1cHggYXJpYWw7bGluZS1oZWlnaHQ6MjZweH0jZm9ybSAuc19pcHRfd3IuYmd7YmFja2dyb3VuZDojZmZmO3dpZHRoOjc2JX0jZm9ybSAuc19idG57YmFja2dyb3VuZDojMzQ3NmQyO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICMzNDc2ZDJ9I2Zvcm0gLnNfYnRuOmhvdmVye2JhY2tncm91bmQ6IzM0NzZkMjtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjMzQ3NmQyfSNzX3RhYiBie2NvbG9yOiMzNDc2ZDI7Ym9yZGVyLWJvdHRvbTozcHggIzM0NzZkMiBzb2xpZH0jc190YWJ7Ym9yZGVyLWJvdHRvbTojZTBlMGUwIDFweCBzb2xpZH0jY29udGFpbmVyIC5oZWFkX251bXNfY29udF9vdXRlciAuc2VhcmNoX3Rvb2xfY29udGVyLCNjb250YWluZXIgLmhlYWRfbnVtc19jb250X291dGVyIC5udW1ze3dpZHRoOjYzMHB4fSNzZWFyY2ggI3Jzb3thbmltYXRpb24tbmFtZTphbmlfYm90dG9tVG90b3A7YW5pbWF0aW9uLWR1cmF0aW9uOi4zczthbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOmVhc2V9LnNycCBmb3Jte2FuaW1hdGlvbi1uYW1lOmFuaV9sZWZ0VG9yaWdodDthbmltYXRpb24tZHVyYXRpb246LjNzO2FuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246ZWFzZS1vdXR9I3JzbyAualVta0ZiOmhvdmVye21hcmdpbjowIGF1dG87Ym9yZGVyLWxlZnQ6dW5zZXQ7cGFkZGluZzowIDIwcHggMTVweDttYXJnaW4tYm90dG9tOjQwcHh9I3JzLCNyc28+Lmd7d2lkdGg6NzYwcHg7cGFkZGluZzowIDIwcHggMTVweDttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbTo0MHB4O2JvcmRlci1yYWRpdXM6NXB4O2JhY2tncm91bmQtY29sb3I6I2ZmZjtib3gtc2l6aW5nOmJvcmRlci1ib3g7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDAsMCwwLC4xKTt0cmFuc2l0aW9uOmFsbCAuMjVzIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9I3JzLCNyc28gLmcgZGl2LnJjIC5ze21heC13aWR0aDp1bnNldH0jcnNvIC5nOmhvdmVye2JvcmRlcjoxcHggc29saWQgcmdiYSgwLDAsMCwuMyk7Ym94LXNoYWRvdzowIDAgMXB4IGdyZXk7LXdlYmtpdC1ib3gtc2hhZG93OjAgMCAxcHggZ3JleTstbW96LWJveC1zaGFkb3c6MCAwIDFweCBncmF5fSNyc28gLmdbdHBsPXNvZnRdIC5vcC1zb2Z0LXRpdGxlLCNyc28gLmcgZGl2LnJ7bWFyZ2luOjAgLTIwcHggMTBweDtwYWRkaW5nOjhweCAyMHB4IDVweDtib3JkZXItcmFkaXVzOjVweCA1cHggMCAwfSNyc28gLmYxMyBhLCNyc28gLmYxMyBlbSwjcnNvIC5jLXNwYW4xOCBhLCNyc28gLnN1YkxpbmtfZmFjdG9yeSBhLCNyc28gLmMtdGFicy1jb250ZW50IGEsI3JzbyAub3Bfb2ZmaWNhbF93ZWlib19jb250ZW50IGEsI3JzbyAub3Bfb2ZmaWNhbF93ZWlib19weiBhLCNyc28gLm9wX3RpZWJhMl90YWJsaW5rc19jb250YWluZXIgYSwjcnNvIC5vcC10aWViYS1nZW5lcmFsLXJpZ2h0LCNyc28gLm9wX2RxMDFfdGl0bGUsI3JzbyAub3BfZHEwMV90YWJsZSBhLCNyc28gLm9wX2RxMDFfbW9yZWxpbmsgYSwjcnNvIC5vcC10aWViYS1nZW5lcmFsLW1haW5wbCBhLCNyc28gLm9wLXNlLWxpc3Rlbi1yZWNvbW1lbmQsI3JzbyAuYy1vZmZzZXQ+ZGl2IGF7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Y29sb3I6IzM0NzZkMn0jcnNvIC5mMTMgYTpob3ZlciwjcnNvIC5mMTMgZW06aG92ZXIsI3JzbyAuc3ViTGlua19mYWN0b3J5IGE6aG92ZXIsI3JzbyAuYy10YWJzLWNvbnRlbnQgYTpob3ZlciwjcnNvIC5vcF90aWViYTJfdGFibGlua3NfY29udGFpbmVyIGE6aG92ZXIsI3JzbyAub3AtdGllYmEtZ2VuZXJhbC1yaWdodDpob3ZlciwjcnNvIC5vcF9kcTAxX3RpdGxlOmhvdmVyLCNyc28gLm9wX2RxMDFfdGFibGUgYTpob3ZlciwjcnNvIC5vcF9kcTAxX21vcmVsaW5rIGE6aG92ZXIsI3JzbyAub3AtdGllYmEtZ2VuZXJhbC1tYWlucGwgYTpob3ZlciwjcnNvIC5vcC1zZS1saXN0ZW4tcmVjb21tZW5kOmhvdmVyLCNyc28gLmMtb2Zmc2V0PmRpdiBhOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmUhaW1wb3J0YW50fSNyc28gLmYxMyBhe2NvbG9yOmdyZWVufSNyc28gLmMtc3BhbjE4LCNyc28gLmMtc3BhbjI0e3dpZHRoOjEwMCU7bWluLXdpZHRoOnVuc2V0fSNyc28gLmMtYm9yZGVye3dpZHRoOmF1dG87Ym9yZGVyOm5vbmU7Ym9yZGVyLWJvdHRvbS1jb2xvcjp0cmFuc3BhcmVudDtib3JkZXItcmlnaHQtY29sb3I6dHJhbnNwYXJlbnQ7Ym94LXNoYWRvdzowIDAgMCB0cmFuc3BhcmVudDstd2Via2l0LWJveC1zaGFkb3c6MCAwIDAgdHJhbnNwYXJlbnQ7LW1vei1ib3gtc2hhZG93OjAgMCAwIHRyYW5zcGFyZW50Oy1vLWJveC1zaGFkb3c6MCAwIDAgdHJhbnNwYXJlbnR9I3JzbyAuc2VfY29tX2lycmVndWxhcl9nYWxsZXJ5IHVsIGxpLCNyc28gLm9wX2ppbmd5YW5fbGlzdCwjcnNvIC5nIC5vcC1pbWctYWRkcmVzcy1saW5rLXR5cGV7ZGlzcGxheTppbmxpbmUtYmxvY2s7bWFyZ2luLWxlZnQ6MTBweH0jcnNvIC5nW3RwbD1zb2Z0XSAub3Atc29mdC10aXRsZSBhLCNyc28gLmdbdHBsPXNvZnRdIC5vcC1zb2Z0LXRpdGxlIGEgZW0sI3JzbyAuZyBkaXYucj5hLCNyc28gLmcgYSBoMywjcnNvIC5nIGRpdi5yPmEgZW0sLm13ICNyZXMgaDMsLm13ICNleHRyYXJlcyBoM3tjb2xvcjojMzQ3NmQyO2ZvbnQtd2VpZ2h0OjcwMH0jcnNvIC5vcC1zb2Z0LXRpdGxlIGE6dmlzaXRlZCwjcnNvIC5vcC1zb2Z0LXRpdGxlIGE6dmlzaXRlZCBlbSwjcnNvIC5nIGRpdi5yPmE6dmlzaXRlZCwjcnNvIC5nIGRpdi5yPmE6dmlzaXRlZCBlbSwjcnNvIC5nIGE6dmlzaXRlZCBoM3tjb2xvcjojNjA5fSNyc28gLm9wLXNvZnQtdGl0bGUgYSwjcnNvIC5nIGRpdi5yPmF7cG9zaXRpb246cmVsYXRpdmV9I3JzbyAub3Atc29mdC10aXRsZSBhIGVtLCNyc28gLmcgZGl2LnI+YSBlbXt0ZXh0LWRlY29yYXRpb246bm9uZX0jcnNvIC5vcC1zb2Z0LXRpdGxlIGE6aG92ZXI6YWZ0ZXIsI3JzbyAuZyBkaXYucj5hOmhvdmVyOmFmdGVye2xlZnQ6MDt3aWR0aDoxMDAlOy13ZWJraXQtdHJhbnNpdGlvbjp3aWR0aCAzNTBtczstbW96LXRyYW5zaXRpb246d2lkdGggMzUwbXM7dHJhbnNpdGlvbjp3aWR0aCAzNTBtc30jcnNvIC5vcC1zb2Z0LXRpdGxlIGE6YWZ0ZXIsI3JzbyAuZyBkaXYucj5hOmFmdGVye2NvbnRlbnQ6IiI7cG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyLWJvdHRvbToycHggc29saWQgIzM0NzZkMjtib3R0b206LTJweDtsZWZ0OjEwMCU7d2lkdGg6MDstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtczstbW96LXRyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtczt0cmFuc2l0aW9uOndpZHRoIDM1MG1zLGxlZnQgMzUwbXN9I3JzbyAub3Atc29mdC10aXRsZSBhLCNyc28gLmcgZGl2LnI+YXtwb3NpdGlvbjpyZWxhdGl2ZX0jcnNvIC5vcC1zb2Z0LXRpdGxlIGE6dmlzaXRlZDpob3ZlcjphZnRlciwjcnNvIC5nIGRpdi5yPmE6dmlzaXRlZDpob3ZlcjphZnRlcntsZWZ0OjA7d2lkdGg6MTAwJTstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXM7LW1vei10cmFuc2l0aW9uOndpZHRoIDM1MG1zO3RyYW5zaXRpb246d2lkdGggMzUwbXN9I3JzbyAub3Atc29mdC10aXRsZSBhOnZpc2l0ZWQ6YWZ0ZXIsI3JzbyAuZyBkaXYucj5hOnZpc2l0ZWQ6YWZ0ZXJ7Y29udGVudDoiIjtwb3NpdGlvbjphYnNvbHV0ZTtib3JkZXItYm90dG9tOjJweCBzb2xpZCAjNjA5O2JvdHRvbTotMnB4O2xlZnQ6MTAwJTt3aWR0aDowOy13ZWJraXQtdHJhbnNpdGlvbjp3aWR0aCAzNTBtcyxsZWZ0IDM1MG1zOy1tb3otdHJhbnNpdGlvbjp3aWR0aCAzNTBtcyxsZWZ0IDM1MG1zO3RyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtc30jcnN7bWFyZ2luLXRvcDowO3BhZGRpbmc6MCAyMHB4IDE1cHg7Ym9yZGVyLXJhZGl1czo1cHh9I3JzIC50dHttYXJnaW46MCAtMjBweCA1cHg7cGFkZGluZzo1cHggMjBweDtiYWNrZ3JvdW5kLWNvbG9yOiNmOGY4Zjg7Ym9yZGVyLXJhZGl1czo1cHggNXB4IDAgMH0jcnMgdGFibGV7d2lkdGg6NjMwcHg7cGFkZGluZzo1cHggMTVweH0jcnMgdGFibGUgdHIgYXttYXJnaW4tdG9wOjVweDttYXJnaW4tYm90dG9tOjVweDtjb2xvcjojMzQ3NmQyfSNycyB0YWJsZSB0ciBhOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmV9I3BhZ2V7bWluLXdpZHRoOjcxMHB4O2hlaWdodDo0MHB4O2xpbmUtaGVpZ2h0OjQwcHg7cGFkZGluZy10b3A6NXB4O21hcmdpbjowIDAgNTBweCA4MHB4fS5vcC1pbWctYWRkcmVzcy1kZXNrdG9wLWNvbnR7b3ZlcmZsb3c6aGlkZGVufSNwYWdlIGEsI3BhZ2Ugc3Ryb25ne2NvbG9yOiMzNDc2ZDI7aGVpZ2h0OmF1dG87Ym94LXNoYWRvdzowIDAgMjBweCAycHggcmdiYSgwLDAsMCwuMSk7LXdlYmtpdC1ib3gtc2hhZG93OjAgMCAyMHB4IDJweCByZ2JhKDAsMCwwLC4xKTstbW96LWJveC1zaGFkb3c6MCAwIDIwcHggMnB4IHJnYmEoMCwwLDAsLjEpfSNwYWdlIC5uOmhvdmVyLCNwYWdlIGE6aG92ZXIgLnBje2JvcmRlcjoxcHggc29saWQgdHJhbnNwYXJlbnQ7YmFja2dyb3VuZDojZDhkOGQ4O2NvbG9yOiMwMDU3ZGF9I3BhZ2Ugc3Ryb25nIC5wY3tiYWNrZ3JvdW5kOiMzNDc2ZDI7Y29sb3I6I2ZmZn1Aa2V5ZnJhbWVzIGFuaV9ib3R0b21Ub3RvcHswJXt0cmFuc2Zvcm06dHJhbnNsYXRlWSgzMnB4KTtvcGFjaXR5OjB9MjAle29wYWNpdHk6MH0zMCV7b3BhY2l0eTouOH0xMDAle29wYWNpdHk6MX19QGtleWZyYW1lcyBhbmlfbGVmdFRvcmlnaHR7MCV7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTMycHgpO29wYWNpdHk6MH0yMCV7b3BhY2l0eTowfTMwJXtvcGFjaXR5Oi44fTEwMCV7b3BhY2l0eToxfX0jcnNvPmRpdjpub3QoW2NsYXNzXSl7bWFyZ2luLWxlZnQ6MThweDttYXJnaW4tcmlnaHQ6MThweH0jcnNvIC5nIC5leHAtb3V0bGluZXtkaXNwbGF5Om5vbmV9I21haW4gLm13ICNyaHN7bWFyZ2luLWxlZnQ6MTAyMHB4fSNyZXMgLmcgLnRze21heC13aWR0aDp1bnNldH1AbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOjE0MDBweCl7Lm13ICNyaHN7ZGlzcGxheTpub25lfX1jaXRle2ZvbnQtd2VpZ2h0OjQwMDt3aGl0ZS1zcGFjZTpub3dyYXB9ZGl2LnJlc190b3BfYmFubmVyICNmb290LCNwYWcgI3JlcyAucntsaW5lLWhlaWdodDoxLjN9I3Jlc3twYWRkaW5nOjB9I3JzLCNyc28gLmd7bWFyZ2luLWJvdHRvbToyMHB4O2JvcmRlci1yYWRpdXM6MTBweH0jcnNvIC5nIGRpdi5ye2JvcmRlci1yYWRpdXM6MTBweCAxMHB4IDAgMH0jcnNvIC5nIC5jYXJkLXNlY3Rpb24sI2NlbnRlcl9jb2wgLmtwLWJsa3t3aWR0aDoxMDAlIWltcG9ydGFudH0uYzJ4elRiIC5nLC5ydVRjSWQgLmcsLmZtMDZJZiAuZywuY1VuUUtlIC5nLC5IYW5RbWYgLmd7d2lkdGg6NzU4cHg7cGFkZGluZy1sZWZ0OjIwcHghaW1wb3J0YW50O3BhZGRpbmctcmlnaHQ6MjBweCFpbXBvcnRhbnQ7Ym94LXNoYWRvdzowIDAgMCAwICMwMDB9ZGl2IC54Znh4NWR7bWFyZ2luLWJvdHRvbTotMThweCFpbXBvcnRhbnQ7bWFyZ2luLXRvcDotMjVweCFpbXBvcnRhbnR9ZGl2IC54YXFKemYueGZ4eDVkIC5rbm8tZnRye21hcmdpbi10b3A6MTBweCFpbXBvcnRhbnR9ZGl2IC5rbm8tZnRyIGF7cG9zaXRpb246c3RpY2t5fS5tdyAjcmVzIGgzLC5tdyAjZXh0cmFyZXMgaDN7Zm9udC1zaXplOm1lZGl1bX0jcnNvPi5nIC5yPmE+ZGl2e3dpZHRoOjM1cmVtfWRpdi5yY1thYy1uZWVkaGlkZV17bWFyZ2luLXRvcDo1cHg7bWFyZ2luLWJvdHRvbTotMTVweH0ubG9nb3t0b3A6dW5zZXR9Ym9keVtnb29nbGVdIC5iaWcgLmJhaWR1e3RyYW5zZm9ybTp1bnNldCFpbXBvcnRhbnQ7bWFyZ2luLXRvcDotMTBweDttYXJnaW4tbGVmdDotMnJlbX1ib2R5W2dvb2dsZV0gLmJpZyAuYmFpZHUgI2xvZ28gaW1ne21hcmdpbi10b3A6LTE1cHh9Ym9keVtnb29nbGVdIC5iaWcubWluaWRpdiAuYmFpZHUgI2xvZ28gaW1ne2hlaWdodDo1OXB4O3dpZHRoOnVuc2V0O21hcmdpbi10b3A6LTE4cHh9LkFDLnNwLXNlcGFyYXRvcnttYXJnaW4tdG9wOi0yMHB4fS5yYyAuSXNadmVje21heC13aWR0aDp1bnNldH0="},{"meta":{"name":"googleOnePageStyle.css","url":"http://ibaidu.ntaow.com/newcss/googleOnePageStyle.css?t=24.12","ts":1605621954420,"mimetype":"text/css"},"source":"I3Jzb3twb3NpdGlvbjpyZWxhdGl2ZTtmbG9hdDp1bnNldH0jcnNvIC5qVW1rRmI6aG92ZXJ7bWFyZ2luLWJvdHRvbTozMHB4O21hcmdpbi1sZWZ0OjIwcHh9I3JzbyAuZ3t3aWR0aDp1bnNldDttYXJnaW4tbGVmdDoyMHB4O292ZXJmbG93OmhpZGRlbjtwYWRkaW5nOjAgMjBweCAxNXB4O21hcmdpbi10b3A6MDttYXJnaW4tYm90dG9tOjMwcHg7Ym9yZGVyLXJhZGl1czo1cHg7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JveC1zaXppbmc6Ym9yZGVyLWJveDt0cmFuc2l0aW9uOmFsbCAuMjVzIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9LnNlYXJjaD4jaXJlcyAjcnNvPi5ne21heC13aWR0aDp1bnNldH0jbWFpbiAubXcgI3Joc3tkaXNwbGF5Om5vbmV9I21haW4gLm13e21heC13aWR0aDp1bnNldH0jbWFpbiAjY250LCNjbnQgI2NlbnRlcl9jb2wsI2NudCAjZm9vdHt3aWR0aDo1MHZ3O21hcmdpbjowIGF1dG99Ym9keSAjYXBwYmFyLGJvZHkgLnJoc2NvbCxib2R5ICN0b3BfbmF2LGJvZHkgI2ZiYXJ7bWluLXdpZHRoOnVuc2V0fSNyc28gZy1zY3JvbGxpbmctY2Fyb3VzZWx7bWFyZ2luOnVuc2V0O21hcmdpbi1sZWZ0OjIwcHh9LmNvbHt3aWR0aDoxMDAlIWltcG9ydGFudH0uY29sICNjZW50ZXJfY29se3dpZHRoOjEwMCUhaW1wb3J0YW50O21hcmdpbi1sZWZ0OnVuc2V0IWltcG9ydGFudH0uc3JwIC5iaWcgI3RzZnt3aWR0aDo4MzNweH0uc3JwIGZvcm17bWFyZ2luOjAgYXV0b30jdG9wX25hdnttaW4td2lkdGg6dW5zZXR9LnNycCBmb3JtIGRpdltqc2NvbnRyb2xsZXJde21hcmdpbi1sZWZ0OnVuc2V0O21hcmdpbjowIGF1dG99Zy1zZWN0aW9uLXdpdGgtaGVhZGVye3RleHQtYWxpZ246Y2VudGVyfQ=="},{"meta":{"name":"googleTwoPageStyle.css","url":"http://ibaidu.ntaow.com/newcss/googleTwoPageStyle.css?t=24.12","ts":1605621954417,"mimetype":"text/css"},"source":"I3Jzb3twb3NpdGlvbjpyZWxhdGl2ZTtmbG9hdDp1bnNldH0jcnNvIC5qVW1rRmI6aG92ZXJ7bWFyZ2luLWJvdHRvbTozMHB4O21hcmdpbi1sZWZ0OjIwcHh9I3JzbyAuZywudmtfY3t3aWR0aDp1bnNldDttYXJnaW4tbGVmdDoyMHB4O292ZXJmbG93OmhpZGRlbjtwYWRkaW5nOjEwcHggMjBweCAxNXB4O21hcmdpbi10b3A6MDttYXJnaW4tYm90dG9tOjI1cHg7Ym9yZGVyLXJhZGl1czo1cHg7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JveC1zaXppbmc6Ym9yZGVyLWJveDt0cmFuc2l0aW9uOmFsbCAuMjVzIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9LnNlYXJjaD4jaXJlcyAjcnNvPi5ne21heC13aWR0aDp1bnNldH0jbWFpbiAubXcgI3Joc3tkaXNwbGF5Om5vbmV9I21haW4gLm13e21heC13aWR0aDp1bnNldH0jbWFpbiAjY250LCNjbnQgI2NlbnRlcl9jb2wsI2NudCAjZm9vdHt3aWR0aDo4MHZ3O21hcmdpbjowIGF1dG99Ym9keSAjYXBwYmFyLGJvZHkgLnJoc2NvbCxib2R5ICN0b3BfbmF2LGJvZHkgI2ZiYXJ7bWluLXdpZHRoOnVuc2V0fSNyc28gLkNPRW9pZHttYXJnaW46dW5zZXR9LmNvbHt3aWR0aDoxMDAlIWltcG9ydGFudH0uY29sICNjZW50ZXJfY29se3dpZHRoOjEwMCUhaW1wb3J0YW50O21hcmdpbi1sZWZ0OnVuc2V0IWltcG9ydGFudH0uc3JnLCNyc297ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoYXV0by1maXQsbWlubWF4KDUwJSwxZnIpKTtncmlkLXRlbXBsYXRlLWFyZWFzOiJ4bWFpbiB4bWFpbiJ9I3Jzbz5kaXY6bm90KC5nKSwjcnNvIC5zcmd7Z3JpZC1jb2x1bW4tc3RhcnQ6MTtncmlkLWNvbHVtbi1lbmQ6eG1haW4tZW5kfS5zcnAgZm9ybXttYXJnaW46MCBhdXRvfS5zcnAgZm9ybSBkaXZbanNjb250cm9sbGVyXXttYXJnaW4tbGVmdDp1bnNldDttYXJnaW46MCBhdXRvfWctc2VjdGlvbi13aXRoLWhlYWRlcnt0ZXh0LWFsaWduOmNlbnRlcn0="},{"meta":{"name":"bingCommonStyle.css","url":"http://ibaidu.ntaow.com/newcss/bingCommonStyle.css?t=24.12","ts":1605621954418,"mimetype":"text/css"},"source":"Ym9keXtiYWNrZ3JvdW5kLWNvbG9yOiNmNWY1ZjV9I2JfY29udGVudCAjYl9yZXN1bHRzPmxpOm5vdCgjbWZhX3Jvb3Qpe3dpZHRoOjY3MHB4O3BhZGRpbmc6MTJweCAyMHB4IWltcG9ydGFudDttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbToyNXB4O2JvcmRlci1yYWRpdXM6NXB4O2JhY2tncm91bmQtY29sb3I6I2ZmZjtib3gtc2l6aW5nOmJvcmRlci1ib3g7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDAsMCwwLC4xKTt0cmFuc2l0aW9uOmFsbCAuMjVzIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHM7b3ZlcmZsb3c6aGlkZGVufSNiX2NvbnRlbnQgI2JfcmVzdWx0cyBhLCNiX2NvbnRlbnQgI2JfcmVzdWx0cyBoMiBhe3Bvc2l0aW9uOnJlbGF0aXZlO2NvbG9yOiMzNDc2ZDJ9I2JfY29udGVudCAjYl9yZXN1bHRzIGgyIGEsI2JfcmVzdWx0cyBoMiBzdHJvbmd7Zm9udC13ZWlnaHQ6NzAwO2ZvbnQtc2l6ZTptZWRpdW19I2JfY29udGVudCAjYl9yZXN1bHRzPmxpOmhvdmVye2JvcmRlcjoxcHggc29saWQgcmdiYSgwLDAsMCwuMyk7YmFja2dyb3VuZDojZmNmY2ZjIWltcG9ydGFudDtib3gtc2hhZG93OjAgMCAxcHggZ3JleTstd2Via2l0LWJveC1zaGFkb3c6MCAwIDFweCBncmV5Oy1tb3otYm94LXNoYWRvdzowIDAgMXB4IGdyYXl9I2JfY29udGVudD4jYl9yZXN1bHRzIGxpOm5vdCgjbWZhX3Jvb3QpIGgye2JhY2tncm91bmQtY29sb3I6I2Y4ZjhmODttYXJnaW46LTEycHggLTIwcHggMTBweDtwYWRkaW5nOjhweCAyMHB4IDVweDtib3JkZXItcmFkaXVzOjVweCA1cHggMCAwfWEsYSBzdHJvbmd7dGV4dC1kZWNvcmF0aW9uOm5vbmV9I2JfY29udGVudCAjYl9yZXN1bHRzIGEgc3Ryb25nLCNiX2NvbnRlbnQgI2JfcmVzdWx0cyBoMiBhIHN0cm9uZ3t0ZXh0LWRlY29yYXRpb246bm9uZX0uYl9hbGdvOmZpcnN0LWNoaWxkOmhvdmVyIGgyIGF7dGV4dC1kZWNvcmF0aW9uOm5vbmUhaW1wb3J0YW50fSNiX2NvbnRlbnQgI2JfcmVzdWx0cyBhOmhvdmVyOmFmdGVyLCNiX2NvbnRlbnQgI2JfcmVzdWx0cyBoMiBhOmhvdmVyOmFmdGVye2xlZnQ6MDt3aWR0aDoxMDAlOy13ZWJraXQtdHJhbnNpdGlvbjp3aWR0aCAzNTBtczstbW96LXRyYW5zaXRpb246d2lkdGggMzUwbXM7dHJhbnNpdGlvbjp3aWR0aCAzNTBtc30jYl9jb250ZW50ICNiX3Jlc3VsdHMgYTpob3ZlciwjYl9jb250ZW50ICNiX3Jlc3VsdHMgaDIgYTpob3Zlcnt0ZXh0LWRlY29yYXRpb246bm9uZX0jYl9jb250ZW50ICNiX3Jlc3VsdHMgYTphZnRlciwjYl9jb250ZW50ICNiX3Jlc3VsdHMgaDIgYTphZnRlcntjb250ZW50OiIiO3Bvc2l0aW9uOmFic29sdXRlO2JvcmRlci1ib3R0b206MnB4IHNvbGlkICMzNDc2ZDI7Ym90dG9tOi0ycHg7bGVmdDoxMDAlO3dpZHRoOjA7LXdlYmtpdC10cmFuc2l0aW9uOndpZHRoIDM1MG1zLGxlZnQgMzUwbXM7LW1vei10cmFuc2l0aW9uOndpZHRoIDM1MG1zLGxlZnQgMzUwbXM7dHJhbnNpdGlvbjp3aWR0aCAzNTBtcyxsZWZ0IDM1MG1zfSNiX2NvbnRlbnQgI2JfcmVzdWx0cyBoMiBhOnZpc2l0ZWQsI2JfY29udGVudCAjYl9yZXN1bHRzIGgyIGE6dmlzaXRlZCBzdHJvbmcsI2JfY29udGVudCAjYl9yZXN1bHRzIGgyIGgyIGE6dmlzaXRlZCwjYl9jb250ZW50ICNiX3Jlc3VsdHMgaDIgaDIgYTp2aXNpdGVkIHN0cm9uZ3tjb2xvcjojNjA5fSNiX2NvbnRlbnQgI2JfcmVzdWx0cyBoMiBhOnZpc2l0ZWQ6aG92ZXI6YWZ0ZXIsI2JfY29udGVudCAjYl9yZXN1bHRzIGgyIGgyIGE6dmlzaXRlZDpob3ZlcjphZnRlcntsZWZ0OjA7d2lkdGg6MTAwJTstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXM7LW1vei10cmFuc2l0aW9uOndpZHRoIDM1MG1zO3RyYW5zaXRpb246d2lkdGggMzUwbXN9I2JfY29udGVudD5vbCNiX2NvbnRleHR7ZGlzcGxheTpub25lfWJvZHkgI2JfaGVhZGVye2JhY2tncm91bmQtY29sb3I6I2Y1ZjVmNX0jYl9jb250ZW50IC5iX3VuZGVyU2VhcmNoYm94e21hcmdpbi10b3A6MTBweH0jYl9oZWFkZXIgLmJfc2NvcGViYXJ7bWFyZ2luOnVuc2V0fS50c2YtcD4ubG9nb2NvbnQsI3Nlai1jb250YWluZXJ7bWFyZ2luLXJpZ2h0OjM1MHB4O3RleHQtYWxpZ246Y2VudGVyfS50c2YtcD4uc2ZpYmJiY3ttYXJnaW4tcmlnaHQ6MzUwcHg7dGV4dC1hbGlnbjpjZW50ZXJ9LmJfc2VhcmNoYm94Rm9ybSAuc2FfdG17dGV4dC1hbGlnbjpsZWZ0fWJvZHkgI2JfaGVhZGVyICNlc3Rfc3dpdGNoe21hcmdpbjowIGF1dG87cGFkZGluZy1yaWdodDoxMCV9Ym9keSAjZXN0X2NuOjphZnRlcixib2R5ICNlc3RfZW46OmFmdGVye3RyYW5zZm9ybTpzY2FsZSgxLjEsMS4zKSBwZXJzcGVjdGl2ZSguNWVtKSByb3RhdGVYKDBkZWcpOy13ZWJraXQtdHJhbnNmb3JtOnNjYWxlKDEuMSwxLjMpIHBlcnNwZWN0aXZlKC41ZW0pIHJvdGF0ZVgoMGRlZyl9QG1lZGlhKG1heC13aWR0aDoxMTAwcHgpe2JvZHkgI2JfaGVhZGVyICNlc3Rfc3dpdGNoe3RyYW5zZm9ybTp0cmFuc2xhdGVYKDEuMnJlbSl9fSNiX2NvbnRlbnR7YW5pbWF0aW9uLW5hbWU6YW5pX2JvdHRvbVRvdG9wO2FuaW1hdGlvbi1kdXJhdGlvbjouNnM7YW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjplYXNlfWJvZHkgI2JfaGVhZGVye2FuaW1hdGlvbi1uYW1lOmFuaV90b3BUb2J1dHRvbTthbmltYXRpb24tZHVyYXRpb246LjZzO2FuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246ZWFzZS1vdXR9Ym9keXthbmltYXRpb24tbmFtZTphbmlfaGlkZVRvU2hvdzthbmltYXRpb24tZHVyYXRpb246LjZzO2FuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246ZWFzZS1vdXR9LkFDLnNwLXNlcGFyYXRvcnttYXJnaW4tdG9wOi0xNXB4fUBrZXlmcmFtZXMgYW5pX2xlZnRUb3JpZ2h0ezAle3RyYW5zZm9ybTp0cmFuc2xhdGVYKC0zMnB4KTtvcGFjaXR5OjB9MjAle29wYWNpdHk6MH0zMCV7b3BhY2l0eTouOH0xMDAle29wYWNpdHk6MX19QGtleWZyYW1lcyBhbmlfYm90dG9tVG90b3B7MCV7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoMzJweCk7b3BhY2l0eTowfTIwJXtvcGFjaXR5OjB9MzAle29wYWNpdHk6Ljh9MTAwJXtvcGFjaXR5OjF9fUAtd2Via2l0LWtleWZyYW1lcyBhbmlfdG9wVG9idXR0b217MCV7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlWSgtMzJweCk7b3BhY2l0eTowfTIwJXtvcGFjaXR5OjB9MzAle29wYWNpdHk6Ljh9MTAwJXtvcGFjaXR5OjF9fUAtd2Via2l0LWtleWZyYW1lcyBhbmlfaGlkZVRvU2hvd3swJXtkaXNwbGF5Om5vbmU7b3BhY2l0eTowfTIwJXtkaXNwbGF5Om5vbmU7b3BhY2l0eTowfTMwJXtkaXNwbGF5Om5vbmU7b3BhY2l0eTouOH0xMDAle29wYWNpdHk6MX19"},{"meta":{"name":"bingOnePageStyle.css","url":"http://ibaidu.ntaow.com/newcss/bingOnePageStyle.css?t=24.12","ts":1605621954388,"mimetype":"text/css"},"source":"I2JfY29udGVudCBhc2lkZXtkaXNwbGF5Om5vbmV9I2JfY29udGVudCAjYl9yZXN1bHRze3dpZHRoOjczdnc7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjthbGlnbi1pdGVtczpjZW50ZXI7bWF4LXdpZHRoOjEwMDBweH1ib2R5ICNiX2hlYWRlcnt3aWR0aDo3MnZ3O3RleHQtYWxpZ246Y2VudGVyO21hcmdpbjowIGF1dG99Ym9keSAjYl9jb250ZW50e2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO21hcmdpbi1sZWZ0OnVuc2V0O3BhZGRpbmctbGVmdDp1bnNldH0jYl9jb250ZW50ICNiX3Jlc3VsdHM+bGk6bm90KCNtZmFfcm9vdCl7d2lkdGg6OTglfQ=="},{"meta":{"name":"bingTwoPageStyle.css","url":"http://ibaidu.ntaow.com/newcss/bingTwoPageStyle.css?t=24.12","ts":1605621954393,"mimetype":"text/css"},"source":"I2NvbnRhaW5lciAjY29udGVudF9sZWZ0IC5oaXRfdG9wX25ldywjYl9jb250ZW50IGFzaWRlLCNiX3Jlc3VsdHMgI21mYV9yb290e2Rpc3BsYXk6bm9uZX0jYl9jb250ZW50ICNiX3Jlc3VsdHN7d2lkdGg6NzN2dztncmlkLXRlbXBsYXRlLWNvbHVtbnM6cmVwZWF0KGF1dG8tZml0LG1pbm1heCg1MCUsMWZyKSk7Z3JpZC10ZW1wbGF0ZS1hcmVhczoieG1haW4geG1haW4iO2Rpc3BsYXk6aW5saW5lLWdyaWR9I2JfY29udGVudCAjYl9yZXN1bHRzPmxpOm5vdCgjbWZhX3Jvb3Qpe3dpZHRoOjk4JTttYXJnaW4tbGVmdDoxJX0jYl9yZXN1bHRzIC5iX2FsZ28gLmJfZGVlcCB1bHt3aWR0aDo1MCV9I2JfbXNnLCNiX3BhZ3tncmlkLWNvbHVtbi1lbmQ6eG1haW4tZW5kO2dyaWQtY29sdW1uLXN0YXJ0OjE7YmFja2dyb3VuZC1jb2xvcjojZmZmfWJvZHkgI2JfY29udGVudHtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjttYXJnaW4tbGVmdDp1bnNldDtwYWRkaW5nLWxlZnQ6dW5zZXR9Ym9keSAjYl9oZWFkZXJ7d2lkdGg6NzJ2dzt0ZXh0LWFsaWduOmNlbnRlcjttYXJnaW46MCBhdXRvfQ=="},{"meta":{"name":"duckCommonStyle.css","url":"http://ibaidu.ntaow.com/newcss/duckCommonStyle.css?t=24.12","ts":1605621954395,"mimetype":"text/css"},"source":"Ym9keXtiYWNrZ3JvdW5kLWNvbG9yOiNmNWY1ZjV9LnJlc3VsdF9faWNvbiAucmVzdWx0X19pY29uX19pbWcsLnJlc3VsdF9faWNvbiAucmVzdWx0X19pY29uIGltZ3tkaXNwbGF5Om5vbmV9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgaDJ7Zm9udC13ZWlnaHQ6NjAwfSNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1tYWlue21heC13aWR0aDo2NzBweH0jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcHt3aWR0aDo2NzBweDtvdmVyZmxvdzpoaWRkZW47bWFyZ2luLXRvcDowO21hcmdpbi1ib3R0b206MjVweDtib3JkZXItcmFkaXVzOjVweDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7Ym94LXNpemluZzpib3JkZXItYm94O2JvcmRlcjoxcHggc29saWQgcmdiYSgwLDAsMCwuMSk7dHJhbnNpdGlvbjphbGwgLjI1cyBjdWJpYy1iZXppZXIoLjIzLDEsLjMyLDEpIDBzfSNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIC5yZXN1bHRfX3RpdGxlIGF7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7bWF4LXdpZHRoOjY0MHB4O2NvbG9yOiMzNDc2ZDI7Zm9udC1zaXplOnNtYWxsZXJ9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgLnJlc3VsdF9fYm9keXtwYWRkaW5nOjEycHggMjBweCFpbXBvcnRhbnR9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXA6aG92ZXJ7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDAsMCwwLC4zKTtib3gtc2hhZG93OjAgMCAxcHggZ3JleTstd2Via2l0LWJveC1zaGFkb3c6MCAwIDFweCBncmV5Oy1tb3otYm94LXNoYWRvdzowIDAgMXB4IGdyYXl9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgaDJ7YmFja2dyb3VuZC1jb2xvcjojZjhmOGY4O21hcmdpbjotMTJweCAtMjBweCAwO3BhZGRpbmc6OHB4IDIwcHggNXB4O2JvcmRlci1yYWRpdXM6NXB4IDVweCAwIDB9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgaDIgYTpob3ZlcjphZnRlcntsZWZ0OjA7d2lkdGg6MTAwJTstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXM7LW1vei10cmFuc2l0aW9uOndpZHRoIDM1MG1zO3RyYW5zaXRpb246d2lkdGggMzUwbXN9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgaDIgYTphZnRlcntjb250ZW50OiIiO3Bvc2l0aW9uOmFic29sdXRlO2JvcmRlci1ib3R0b206MnB4IHNvbGlkICMzNDc2ZDI7Ym90dG9tOjFweDtsZWZ0OjEwMCU7d2lkdGg6MDstd2Via2l0LXRyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtczstbW96LXRyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtczt0cmFuc2l0aW9uOndpZHRoIDM1MG1zLGxlZnQgMzUwbXN9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgaDIgYTp2aXNpdGVkLCNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIGgyIGE6dmlzaXRlZCBzdHJvbmd7Y29sb3I6IzYwOX0jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCBoMiBhOnZpc2l0ZWQ6aG92ZXI6YWZ0ZXIsI2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgaDIgYTp2aXNpdGVkOmhvdmVyOmFmdGVye2xlZnQ6MDt3aWR0aDoxMDAlOy13ZWJraXQtdHJhbnNpdGlvbjp3aWR0aCAzNTBtczstbW96LXRyYW5zaXRpb246d2lkdGggMzUwbXM7dHJhbnNpdGlvbjp3aWR0aCAzNTBtc30jbGlua3Nfd3JhcHBlciAjbGlua3N7YW5pbWF0aW9uLW5hbWU6YW5pX2JvdHRvbVRvdG9wO2FuaW1hdGlvbi1kdXJhdGlvbjouM3M7YW5pbWF0aW9uLXRpbWluZy1mdW5jdGlvbjplYXNlfSNoZWFkZXJfd3JhcHBlciAuaGVhZGVyX19zZWFyY2gtd3JhcHthbmltYXRpb24tbmFtZTphbmlfbGVmdFRvcmlnaHQ7YW5pbWF0aW9uLWR1cmF0aW9uOi4zczthbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOmVhc2Utb3V0fUBrZXlmcmFtZXMgYW5pX2xlZnRUb3JpZ2h0ezAle3RyYW5zZm9ybTp0cmFuc2xhdGVYKC0zMnB4KTtvcGFjaXR5OjB9MjAle29wYWNpdHk6MH0zMCV7b3BhY2l0eTouOH0xMDAle29wYWNpdHk6MX19QGtleWZyYW1lcyBhbmlfYm90dG9tVG90b3B7MCV7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoMzJweCk7b3BhY2l0eTowfTIwJXtvcGFjaXR5OjB9MzAle29wYWNpdHk6Ljh9MTAwJXtvcGFjaXR5OjF9fQ=="},{"meta":{"name":"duckOnePageStyle.css","url":"http://ibaidu.ntaow.com/newcss/duckOnePageStyle.css?t=24.12","ts":1605621954403,"mimetype":"text/css"},"source":"LmpzLXNpZGViYXItYWRzLCNvcmdhbmljLW1vZHVsZSwucGlubmVkLXRvLWJvdHRvbXtkaXNwbGF5Om5vbmV9LmpzLXJlc3VsdC1oaWRkZW4tZWx7ZGlzcGxheTpub25lIWltcG9ydGFudH0uc2l0ZS13cmFwcGVyICN3ZWJfY29udGVudF93cmFwcGVyIC5jd3tqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2Rpc3BsYXk6ZmxleDttYXgtd2lkdGg6dW5zZXQ7bWFyZ2luLWxlZnQ6LTE1MHB4fSNoZWFkZXJfd3JhcHBlciAjaGVhZGVyLCN3ZWJfY29udGVudF93cmFwcGVyICNsaW5rc193cmFwcGVyIC5zZWFyY2gtZmlsdGVycy13cmFwLCN3ZWJfY29udGVudF93cmFwcGVyICNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1tZXNzYWdle2p1c3RpZnktY29udGVudDpjZW50ZXI7ZGlzcGxheTpncmlkfSNoZWFkZXJfd3JhcHBlciAjaGVhZGVye21heC13aWR0aDp1bnNldH0jaGVhZGVyX3dyYXBwZXIgI2hlYWRlciAuaGVhZGVyX19zZWFyY2gtd3JhcHt3aWR0aDo1MDBweH0jbGlua3Nfd3JhcHBlcntkaXNwbGF5OmlubGluZS1mbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXJ9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW57ZmxvYXQ6dW5zZXR9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLXNpZGViYXJ7bWluLXdpZHRoOnVuc2V0O21hcmdpbjp1bnNldH0uYm9keS0tc2VycCAuZm9vdGVye2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO3BhZGRpbmctbGVmdDp1bnNldH0="},{"meta":{"name":"duckTwoPageStyle.css","url":"http://ibaidu.ntaow.com/newcss/duckTwoPageStyle.css?t=24.12","ts":1605621954516,"mimetype":"text/css"},"source":"LmpzLXNpZGViYXItYWRzLCNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1zaWRlYmFyLCNvcmdhbmljLW1vZHVsZSwucGlubmVkLXRvLWJvdHRvbXtkaXNwbGF5Om5vbmV9LmpzLXJlc3VsdC1oaWRkZW4tZWx7ZGlzcGxheTpub25lIWltcG9ydGFudH0uc2l0ZS13cmFwcGVyICN3ZWJfY29udGVudF93cmFwcGVyIC5jd3tqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2Rpc3BsYXk6ZmxleDttYXgtd2lkdGg6dW5zZXQ7bWFyZ2luLWxlZnQ6LTE1MHB4fSNoZWFkZXJfd3JhcHBlciAjaGVhZGVyLCN3ZWJfY29udGVudF93cmFwcGVyICNsaW5rc193cmFwcGVyIC5zZWFyY2gtZmlsdGVycy13cmFwLCN3ZWJfY29udGVudF93cmFwcGVyICNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1tZXNzYWdle2p1c3RpZnktY29udGVudDpjZW50ZXI7ZGlzcGxheTpncmlkfSNoZWFkZXJfd3JhcHBlciAjaGVhZGVye21heC13aWR0aDp1bnNldH0jaGVhZGVyX3dyYXBwZXIgI2hlYWRlciAuaGVhZGVyX19zZWFyY2gtd3JhcHt3aWR0aDo1MDBweH0jbGlua3Nfd3JhcHBlcntkaXNwbGF5OmlubGluZS1mbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXJ9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW57ZmxvYXQ6dW5zZXQ7bWF4LXdpZHRoOnVuc2V0fSNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1zaWRlYmFye21pbi13aWR0aDp1bnNldDttYXJnaW46dW5zZXR9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW4gI2xpbmtze3dpZHRoOjgwdnc7ZGlzcGxheTppbmxpbmUtZ3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6NTAlIDUwJTtncmlkLXRlbXBsYXRlLWFyZWFzOiJ4bWFpbiB4bWFpbiJ9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW4gI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXB7d2lkdGg6dW5zZXQ7bWFyZ2luLXJpZ2h0OjE1cHh9I2xpbmtzIC5yZXN1bHQtLW1vcmUsI2xpbmtzIC5yZXN1bHQtLXNlcHtncmlkLWNvbHVtbi1zdGFydDoxO2dyaWQtY29sdW1uLWVuZDp4bWFpbi1lbmQ7d2lkdGg6dW5zZXQhaW1wb3J0YW50O3BhZGRpbmc6MDtwYWRkaW5nLXJpZ2h0OjE1cHh9I2xpbmtzIC5yZXN1bHQtLXNlcHttYXJnaW4tYm90dG9tOjJlbX0uYm9keS0tc2VycCAuZm9vdGVye2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO3BhZGRpbmctbGVmdDp1bnNldH0="},{"meta":{"name":"dogeCommonStyle.css","url":"http://ibaidu.ntaow.com/newcss/dogeCommonStyle.css?t=24.12","ts":1605621954422,"mimetype":"text/css"},"source":"Ym9keXtiYWNrZ3JvdW5kLWNvbG9yOiNmNWY1ZjV9LnJlc3VsdHNfbGlua3NfZGVlcCAucmVzdWx0X19pY29ue2Rpc3BsYXk6bm9uZX0jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCBoMntmb250LXdlaWdodDo2MDB9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW57bWF4LXdpZHRoOjY3MHB4fSNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwe3dpZHRoOjY3MHB4O292ZXJmbG93OmhpZGRlbjttYXJnaW4tdG9wOjA7bWFyZ2luLWJvdHRvbToyNXB4O2JvcmRlci1yYWRpdXM6NXB4O2JhY2tncm91bmQtY29sb3I6I2ZmZjtib3gtc2l6aW5nOmJvcmRlci1ib3g7Ym9yZGVyOjFweCBzb2xpZCByZ2JhKDAsMCwwLC4xKTt0cmFuc2l0aW9uOmFsbCAuMjVzIGN1YmljLWJlemllciguMjMsMSwuMzIsMSkgMHN9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgLnJlc3VsdF9fdGl0bGUgYXtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpczttYXgtd2lkdGg6NjQwcHg7Y29sb3I6IzM0NzZkMjtmb250LXNpemU6c21hbGxlcn0jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCAucmVzdWx0X19ib2R5e3BhZGRpbmc6MTJweCAyMHB4IWltcG9ydGFudH0jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcDpob3Zlcntib3JkZXI6MXB4IHNvbGlkIHJnYmEoMCwwLDAsLjMpO2JveC1zaGFkb3c6MCAwIDFweCBncmV5Oy13ZWJraXQtYm94LXNoYWRvdzowIDAgMXB4IGdyZXk7LW1vei1ib3gtc2hhZG93OjAgMCAxcHggZ3JheX0jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCBoMntiYWNrZ3JvdW5kLWNvbG9yOiNmOGY4Zjg7bWFyZ2luOi0xMnB4IC0yMHB4IDA7cGFkZGluZzo4cHggMjBweCA1cHg7Ym9yZGVyLXJhZGl1czo1cHggNXB4IDAgMH0jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCBoMiBhOmhvdmVyOmFmdGVye2xlZnQ6MDt3aWR0aDoxMDAlOy13ZWJraXQtdHJhbnNpdGlvbjp3aWR0aCAzNTBtczstbW96LXRyYW5zaXRpb246d2lkdGggMzUwbXM7dHJhbnNpdGlvbjp3aWR0aCAzNTBtc30jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCBoMiBhOmFmdGVye2NvbnRlbnQ6IiI7cG9zaXRpb246YWJzb2x1dGU7Ym9yZGVyLWJvdHRvbToycHggc29saWQgIzM0NzZkMjtib3R0b206MXB4O2xlZnQ6MTAwJTt3aWR0aDowOy13ZWJraXQtdHJhbnNpdGlvbjp3aWR0aCAzNTBtcyxsZWZ0IDM1MG1zOy1tb3otdHJhbnNpdGlvbjp3aWR0aCAzNTBtcyxsZWZ0IDM1MG1zO3RyYW5zaXRpb246d2lkdGggMzUwbXMsbGVmdCAzNTBtc30jbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCBoMiBhOnZpc2l0ZWQsI2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXAgaDIgYTp2aXNpdGVkIHN0cm9uZ3tjb2xvcjojNjA5fSNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIGgyIGE6dmlzaXRlZDpob3ZlcjphZnRlciwjbGlua3Nfd3JhcHBlciAjbGlua3MgLnJlc3VsdHNfbGlua3NfZGVlcCBoMiBhOnZpc2l0ZWQ6aG92ZXI6YWZ0ZXJ7bGVmdDowO3dpZHRoOjEwMCU7LXdlYmtpdC10cmFuc2l0aW9uOndpZHRoIDM1MG1zOy1tb3otdHJhbnNpdGlvbjp3aWR0aCAzNTBtczt0cmFuc2l0aW9uOndpZHRoIDM1MG1zfSNsaW5rc193cmFwcGVyICNsaW5rc3thbmltYXRpb24tbmFtZTphbmlfYm90dG9tVG90b3A7YW5pbWF0aW9uLWR1cmF0aW9uOi4zczthbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOmVhc2V9I2hlYWRlcl93cmFwcGVyIC5oZWFkZXJfX3NlYXJjaC13cmFwe2FuaW1hdGlvbi1uYW1lOmFuaV9sZWZ0VG9yaWdodDthbmltYXRpb24tZHVyYXRpb246LjNzO2FuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246ZWFzZS1vdXR9LkFDLnNwLXNlcGFyYXRvcnttYXJnaW4tdG9wOi0xNXB4fUBrZXlmcmFtZXMgYW5pX2xlZnRUb3JpZ2h0ezAle3RyYW5zZm9ybTp0cmFuc2xhdGVYKC0zMnB4KTtvcGFjaXR5OjB9MjAle29wYWNpdHk6MH0zMCV7b3BhY2l0eTouOH0xMDAle29wYWNpdHk6MX19QGtleWZyYW1lcyBhbmlfYm90dG9tVG90b3B7MCV7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoMzJweCk7b3BhY2l0eTowfTIwJXtvcGFjaXR5OjB9MzAle29wYWNpdHk6Ljh9MTAwJXtvcGFjaXR5OjF9fQ=="},{"meta":{"name":"dogeOnePageStyle.css","url":"http://ibaidu.ntaow.com/newcss/dogeOnePageStyle.css?t=24.12","ts":1605621954532,"mimetype":"text/css"},"source":"LmpzLXNpZGViYXItYWRzLCNvcmdhbmljLW1vZHVsZSwucGlubmVkLXRvLWJvdHRvbXtkaXNwbGF5Om5vbmV9LmpzLXJlc3VsdC1oaWRkZW4tZWx7ZGlzcGxheTpub25lIWltcG9ydGFudH0uc2l0ZS13cmFwcGVyICN3ZWJfY29udGVudF93cmFwcGVyIC5jd3tqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2Rpc3BsYXk6ZmxleDttYXgtd2lkdGg6dW5zZXR9QG1lZGlhIHNjcmVlbiBhbmQgKG1pbi13aWR0aDoxMDAwcHgpeyNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwe3dpZHRoOjEwMCV9fSNoZWFkZXJfd3JhcHBlciAjaGVhZGVyLCN3ZWJfY29udGVudF93cmFwcGVyICNsaW5rc193cmFwcGVyIC5zZWFyY2gtZmlsdGVycy13cmFwLCN3ZWJfY29udGVudF93cmFwcGVyICNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1tZXNzYWdle2p1c3RpZnktY29udGVudDpjZW50ZXI7ZGlzcGxheTpncmlkfSNoZWFkZXJfd3JhcHBlciAjaGVhZGVye21heC13aWR0aDp1bnNldH0jaGVhZGVyX3dyYXBwZXIgI2hlYWRlciAuaGVhZGVyX19zZWFyY2gtd3JhcHt3aWR0aDo1MDBweH0jbGlua3Nfd3JhcHBlcntkaXNwbGF5OmlubGluZS1mbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7cGFkZGluZy1sZWZ0OjB9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW57ZmxvYXQ6dW5zZXQ7bWF4LXdpZHRoOjg2MHB4fSNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1zaWRlYmFye21pbi13aWR0aDp1bnNldDttYXJnaW46dW5zZXR9LmJvZHktLXNlcnAgLmZvb3RlcntkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjtwYWRkaW5nLWxlZnQ6dW5zZXR9"},{"meta":{"name":"dogeTwoPageStyle.css","url":"http://ibaidu.ntaow.com/newcss/dogeTwoPageStyle.css?t=24.12","ts":1605621954537,"mimetype":"text/css"},"source":"LmpzLXNpZGViYXItYWRzLCNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1zaWRlYmFyLCNvcmdhbmljLW1vZHVsZSwucGlubmVkLXRvLWJvdHRvbXtkaXNwbGF5Om5vbmV9LmpzLXJlc3VsdC1oaWRkZW4tZWx7ZGlzcGxheTpub25lIWltcG9ydGFudH0uc2l0ZS13cmFwcGVyICN3ZWJfY29udGVudF93cmFwcGVyIC5jd3tqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2Rpc3BsYXk6ZmxleDttYXgtd2lkdGg6dW5zZXQ7bWFyZ2luLWxlZnQ6LTE1MHB4fSNoZWFkZXJfd3JhcHBlciAjaGVhZGVyLCN3ZWJfY29udGVudF93cmFwcGVyICNsaW5rc193cmFwcGVyIC5zZWFyY2gtZmlsdGVycy13cmFwLCN3ZWJfY29udGVudF93cmFwcGVyICNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1tZXNzYWdle2p1c3RpZnktY29udGVudDpjZW50ZXI7ZGlzcGxheTpncmlkfSNoZWFkZXJfd3JhcHBlciAjaGVhZGVye21heC13aWR0aDp1bnNldH0jaGVhZGVyX3dyYXBwZXIgI2hlYWRlciAuaGVhZGVyX19zZWFyY2gtd3JhcHt3aWR0aDo1MDBweH0jbGlua3Nfd3JhcHBlcntkaXNwbGF5OmlubGluZS1mbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXJ9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW57ZmxvYXQ6dW5zZXQ7bWF4LXdpZHRoOnVuc2V0fSNsaW5rc193cmFwcGVyIC5yZXN1bHRzLS1zaWRlYmFye21pbi13aWR0aDp1bnNldDttYXJnaW46dW5zZXR9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW4gI2xpbmtze3dpZHRoOjgwdnc7ZGlzcGxheTppbmxpbmUtZ3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6NTAlIDUwJTtncmlkLXRlbXBsYXRlLWFyZWFzOiJ4bWFpbiB4bWFpbiJ9I2xpbmtzX3dyYXBwZXIgLnJlc3VsdHMtLW1haW4gI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXB7d2lkdGg6dW5zZXQ7bWFyZ2luLXJpZ2h0OjE1cHh9I2xpbmtzIC5yZXN1bHQtLW1vcmUsI2xpbmtzIC5yZXN1bHQtLXNlcHtncmlkLWNvbHVtbi1zdGFydDoxO2dyaWQtY29sdW1uLWVuZDp4bWFpbi1lbmQ7d2lkdGg6dW5zZXQhaW1wb3J0YW50O3BhZGRpbmc6MDtwYWRkaW5nLXJpZ2h0OjE1cHh9I2xpbmtzIC5yZXN1bHQtLXNlcHttYXJnaW4tYm90dG9tOjJlbX0uYm9keS0tc2VycCAuZm9vdGVye2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO3BhZGRpbmctbGVmdDp1bnNldH0="},{"meta":{"name":"HuYanStyle.css","url":"http://ibaidu.ntaow.com/newcss/HuYanStyle.css?t=24.12","ts":1605621954539,"mimetype":"text/css"},"source":"Ym9keVtiYWlkdV0sI3dyYXBwZXIgI2hlYWQsI3dyYXBwZXIgI3NfdGFiLGZvcm0uZm0gLnNfaXB0X3dyLmJne2JhY2tncm91bmQtY29sb3I6I2ZmZn0jd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQtb3AsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0LCN3cmFwcGVyICNjb250ZW50X2xlZnQgYXJ0aWNsZSwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5jLWNvbnRhaW5lciwjd3JhcHBlciAjcnMsI3dyYXBwZXIgI2NvbnRlbnRfcmlnaHR7YmFja2dyb3VuZC1jb2xvcjojYWFhO2JvcmRlcjoxcHggZG91YmxlICNhMmQ3ZDQ7Ym9yZGVyLXJhZGl1czowfSN3cmFwcGVyICNjb250ZW50X2xlZnQgLnJlc3VsdC1vcDpob3Zlciwjd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQ6aG92ZXIsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0LW9wOmhvdmVyIGFydGljbGV7YmFja2dyb3VuZC1jb2xvcjojY2NjIWltcG9ydGFudH0jd3JhcHBlciAjY29udGVudF9sZWZ0IC5yZXN1bHQgaDMsI3dyYXBwZXIgI2NvbnRlbnRfbGVmdCAucmVzdWx0LW9wIGgzLCN3cmFwcGVyICNjb250ZW50X2xlZnQgLmMtY29udGFpbmVyIGgzLCN3cmFwcGVyICNycyAudHR7YmFja2dyb3VuZC1jb2xvcjojYmJifS5uYV9jbnQgLm53c19pdG0sLm53c19pdG1iLCNiX2NvbnRlbnQgI2JfcmVzdWx0cz5saTpub3QoI21mYV9yb290KSxib2R5ICNiX2hlYWRlcntiYWNrZ3JvdW5kLWNvbG9yOiNhYWE7Ym9yZGVyOjFweCBkb3VibGUgI2EyZDdkNDtib3JkZXItcmFkaXVzOjB9I2JfY29udGVudCAjYl9yZXN1bHRzIGxpOmhvdmVye2JhY2tncm91bmQtY29sb3I6I2NjYyFpbXBvcnRhbnR9I2JfY29udGVudCAjYl9yZXN1bHRzIGxpIGgye2JhY2tncm91bmQtY29sb3I6I2JiYn1ib2R5W2dvb2dsZV17YmFja2dyb3VuZC1jb2xvcjojZmRmZGZkfSNyc28gLmcsLmJrV01nZD4uZywuYmtXTWdkIGctaW5uZXItY2FyZCwjcmhzY29sICNyaHMsI3Joc2NvbCAjcmhzIC5nPmRpdiwuYzJ4elRiIC5nLC5ydVRjSWQgLmcsLmZtMDZJZiAuZywuY1VuUUtlIC5nLC5IYW5RbWYgLmcsI3JzbyAuZywjcnNvPmRpdjpub3QoLmcpPip7YmFja2dyb3VuZC1jb2xvcjojYWFhO2JvcmRlcjoxcHggc29saWQgIzljZDJjZmFhO2JvcmRlci1yYWRpdXM6MH0jcnNvIC5nOmhvdmVyLC5ia1dNZ2Q+Lmc6aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojY2NjIWltcG9ydGFudDtib3JkZXI6MXB4IGRvdWJsZSAjOWNkMmNmfS5ia1dNZ2QgLmcgZGl2LnIsI3JzbyAuZyBoM3tiYWNrZ3JvdW5kLWNvbG9yOiNiYmJ9Ym9keVtzb2dvdV0sI3BhZ2ViYXJfY29udGFpbmVyIGF7YmFja2dyb3VuZC1jb2xvcjojZmRmZGZkfSNtYWluIC5yZXN1bHRzPmRpdntiYWNrZ3JvdW5kLWNvbG9yOiNhYWE7Ym9yZGVyOjFweCBzb2xpZCAjOWNkMmNmYWE7Ym9yZGVyLXJhZGl1czowfSNtYWluIC5yZXN1bHRzPmRpdjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiNjY2MhaW1wb3J0YW50O2JvcmRlcjoxcHggZG91YmxlICM5Y2QyY2Z9I21haW4gLnJlc3VsdHM+ZGl2IGgze2JhY2tncm91bmQtY29sb3I6I2JiYn1ib2R5W2R1Y2tdLGJvZHlbZG9nZV17YmFja2dyb3VuZC1jb2xvcjojZmRmZGZkfSNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwe2JhY2tncm91bmQtY29sb3I6I2FhYTtib3JkZXI6MXB4IHNvbGlkICM5Y2QyY2ZhYTtib3JkZXItcmFkaXVzOjB9I2xpbmtzX3dyYXBwZXIgI2xpbmtzIC5yZXN1bHRzX2xpbmtzX2RlZXA6aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojY2NjIWltcG9ydGFudDtib3JkZXI6MXB4IGRvdWJsZSAjOWNkMmNmfSNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIGgye2JhY2tncm91bmQtY29sb3I6I2JiYn0="},{"meta":{"name":"SiteConfigRules.conf","url":"http://ibaidu.ntaow.com/newcss/SiteConfigRules.conf?t=24.12","ts":1605621954543,"mimetype":"text/plain"},"source":"b25saW5lREIgPSB7DQogICBiYWlkdTogew0KICAgICAgIFNpdGVUeXBlSUQ6IDEsDQogICAgICAgTWFpblR5cGU6ICIjY29udGVudF9sZWZ0IC5jLWNvbnRhaW5lciIsDQogICAgICAgU3R5cGVfTm9ybWFsOiAiaDMudD5hLCAuYy1jb250YWluZXIgYXJ0aWNsZSBhIiwNCiAgICAgICBGYXZpY29uVHlwZTogIi5jLXNob3d1cmwiLA0KICAgICAgIEZhdmljb25BZGRUbzogImgzIiwNCiAgICAgICBDb3VudGVyVHlwZTogIiNjb250ZW50X2xlZnQ+I2RvdWJsZT5kaXZbc3JjaWRdICpbY2xhc3N+PXRdLFtjbGFzc349b3BfYmVzdF9hbnN3ZXJfcXVlc3Rpb25dLCNjb250ZW50X2xlZnQ+ZGl2W3NyY2lkXSAqW2NsYXNzfj10XSxbY2xhc3N+PW9wX2Jlc3RfYW5zd2VyX3F1ZXN0aW9uXSIsDQogICAgICAgQmxvY2tUeXBlOiAiaDMgYSIsDQogICAgICAgcGFnZXI6ew0KICAgICAgICAgICBuZXh0TGluazogJy8vZGl2W0BpZD0icGFnZSJdLy9hW2NvbnRhaW5zKHRleHQoKSwiw6TCuMKLw6TCuMKAw6nCocK1IildW0BocmVmXScsDQogICAgICAgICAgIHBhZ2VFbGVtZW50OiAiY3NzO2RpdiNjb250ZW50X2xlZnQgPiAqIiwNCiAgICAgICAgICAgSFRfaW5zZXJ0OiBbICJjc3M7ZGl2I2NvbnRlbnRfbGVmdCIsIDIgXSwNCiAgICAgICAgICAgcmVwbGFjZUU6ICJjc3M7I3BhZ2UiLA0KICAgICAgICAgICBzdHlsaXNoOiAiLmF1dG9wYWdlcml6ZV9wYWdlX2luZm8sIGRpdi5zcC1zZXBhcmF0b3Ige21hcmdpbi1ib3R0b206IDEwcHggIWltcG9ydGFudDt9IiwNCiAgICAgICB9DQogICB9LA0KICAgc29nb3U6IHsNCiAgICAgICBTaXRlVHlwZUlEOiAyLA0KICAgICAgIE1haW5UeXBlOiAiI21haW4gLnJlc3VsdHM+ZGl2IiwNCiAgICAgICBTdHlwZV9Ob3JtYWw6ICJoMy5wdD5hLCBoMy52clRpdGxlPmEiLA0KICAgICAgIEZhdmljb25UeXBlOiAiY2l0ZVtpZCo9J2NhY2hlcmVzdWx0X2luZm9fJ10iLA0KICAgICAgIEZhdmljb25BZGRUbzogImgzIiwNCiAgICAgICBDb3VudGVyVHlwZTogIi5yZXN1bHRzPmRpdiIsDQogICAgICAgQmxvY2tUeXBlOiAiaDMgYSIsDQogICAgICAgcGFnZXI6ew0KICAgICAgICAgICBuZXh0TGluazogIi8vZGl2W0BpZD1cInBhZ2ViYXJfY29udGFpbmVyXCJdLy9hW0BpZD1cInNvZ291X25leHRcIl0iLA0KICAgICAgICAgICBwYWdlRWxlbWVudDogIi8vZGl2W0BjbGFzcz0ncmVzdWx0cyddL2RpdiIsDQogICAgICAgICAgIEhUX2luc2VydDogWyIvL2RpdltAY2xhc3M9J3Jlc3VsdHMnXSIsIDJdLA0KICAgICAgICAgICByZXBsYWNlRTogImlkKCdwYWdlYmFyX2NvbnRhaW5lcicpIg0KICAgICAgIH0NCiAgIH0sDQogICBoYW9zb3U6IHsNCiAgICAgICBTaXRlVHlwZUlEOiAzLA0KICAgICAgIE1haW5UeXBlOiAiLnJlcy1saXN0IiwNCiAgICAgICBTdHlwZV9Ob3JtYWw6ICIucmVzLWxpc3QgaDM+YSIsDQogICAgICAgRmF2aWNvblR5cGU6ICJjaXRlIiwNCiAgICAgICBGYXZpY29uQWRkVG86ICJoMyIsDQogICAgICAgQ291bnRlclR5cGU6ICIucmVzdWx0cz5kaXYiLA0KICAgICAgIEJsb2NrVHlwZTogImgzIGEiLA0KICAgICAgIHBhZ2VyOnsNCiAgICAgICAgICAgbmV4dExpbms6ICIvL2RpdltAaWQ9J3BhZ2UnXS8vYVt0ZXh0KCk9J8OkwrjCi8OkwrjCgMOpwqHCtT4nXSB8IGlkKCdzbmV4dCcpIiwNCiAgICAgICAgICAgcGFnZUVsZW1lbnQ6ICIvL2RpdltAaWQ9J2NvbnRhaW5lciddL2RpdiIsDQogICAgICAgICAgIEhUX2luc2VydDogWyIvL2RpdltAaWQ9J2NvbnRhaW5lciddIiwgMl0sDQogICAgICAgICAgIHJlcGxhY2VFOiAiaWQoJ3BhZ2UnKSINCiAgICAgICB9DQogICB9LA0KICAgZ29vZ2xlOiB7DQogICAgICAgU2l0ZVR5cGVJRDogNCwNCiAgICAgICBNYWluVHlwZTogIiNyc28gLmciLA0KICAgICAgIEZhdmljb25UeXBlOiAiLmlVaDMwIiwNCiAgICAgICBGYXZpY29uQWRkVG86ICJoMyIsDQogICAgICAgQ291bnRlclR5cGU6ICIjcnNvIC5nIGgzLC5feUU+ZGl2W2NsYXNzfj1fa2tdIGgzIiwNCiAgICAgICBCbG9ja1R5cGU6ICIucmM+ZGl2PmEiLA0KICAgICAgIHBhZ2VyOnsNCiAgICAgICAgICAgbmV4dExpbms6ICdpZCgicG5uZXh0IikgfCBpZCgibmF2YmFyIG5hdmNudCBuYXYiKS8vdGRbc3Bhbl0vZm9sbG93aW5nLXNpYmxpbmc6OnRkWzFdL2EgfCBpZCgibm4iKS9wYXJlbnQ6OmEnLA0KICAgICAgICAgICBwYWdlRWxlbWVudDogJy8vZGl2W0BpZD0icmVzIl0nLA0KICAgICAgICAgICBIVF9pbnNlcnQ6IFsgImNzczsjcmVzIiwgMiBdLA0KICAgICAgICAgICByZXBsYWNlRTogJy8vZGl2W0BpZD0ibmF2Y250Il0gfCAvL2RpdltAaWQ9ImZvb3QiXVtAcm9sZT0ibmF2aWdhdGlvbiJdJw0KICAgICAgIH0NCiAgIH0sDQogICBiaW5nOiB7DQogICAgICAgU2l0ZVR5cGVJRDogNSwNCiAgICAgICBNYWluVHlwZTogIiNiX3Jlc3VsdHM+bGkiLA0KICAgICAgIEZhdmljb25UeXBlOiAiLmJfYXR0cmlidXRpb24+Y2l0ZSIsDQogICAgICAgRmF2aWNvbkFkZFRvOiAiaDIiLA0KICAgICAgIENvdW50ZXJUeXBlOiAiI2JfcmVzdWx0cz5saVtjbGFzc349Yl9hbnNdPmgyLCNiX3Jlc3VsdHM+bGlbY2xhc3N+PWJfYWxnb10+aDIsI2JfcmVzdWx0cz5saVtjbGFzc349Yl9hbGdvXT5oMiIsDQogICAgICAgQmxvY2tUeXBlOiAiaDIgYSIsDQogICAgICAgcGFnZXI6ew0KICAgICAgICAgICBuZXh0TGluazogIi8vYVtjb250YWlucyhAY2xhc3MsXCJzYl9wYWdOXCIpXSIsDQogICAgICAgICAgIHBhZ2VFbGVtZW50OiAiaWQoXCJiX3Jlc3VsdHNcIikvbGlbbm90KGNvbnRhaW5zKEBjbGFzcyxcImJfcGFnXCIpIG9yIGNvbnRhaW5zKEBjbGFzcyxcImJfYW5zIGJfdG9wXCIpKV0iLA0KICAgICAgICAgICBIVF9pbnNlcnQ6IFsiaWQoXCJiX3Jlc3VsdHNcIikvbGlbQGNsYXNzPVwiYl9wYWdcIl0iLCAxXSwNCiAgICAgICAgICAgcmVwbGFjZUU6ICJpZChcImJfcmVzdWx0c1wiKS8vbmF2W0Byb2xlPVwibmF2aWdhdGlvblwiXSIsDQogICAgICAgfQ0KICAgfSwNCiAgIGR1Y2s6IHsNCiAgICAgICBTaXRlVHlwZUlEOiAxMCwNCiAgICAgICBNYWluVHlwZTogIiNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIiwNCiAgICAgICBGYXZpY29uVHlwZTogIi5yZXN1bHRzX2xpbmtzX2RlZXAgLnJlc3VsdF9fdXJsX19kb21haW4iLA0KICAgICAgIEZhdmljb25BZGRUbzogImgyIiwNCiAgICAgICBDb3VudGVyVHlwZTogIiNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIGgyIiwNCiAgICAgICBCbG9ja1R5cGU6ICJoMiBhIiwNCiAgICAgICBwYWdlcjp7DQogICAgICAgICAgIG5leHRMaW5rOiAiLy9hW2NvbnRhaW5zKEBjbGFzcyxcInNiX3BhZ05cIildIiwNCiAgICAgICAgICAgcGFnZUVsZW1lbnQ6ICJpZChcImJfcmVzdWx0c1wiKS9saVtub3QoY29udGFpbnMoQGNsYXNzLFwiYl9wYWdcIikgb3IgY29udGFpbnMoQGNsYXNzLFwiYl9hbnMgYl90b3BcIikpXSIsDQogICAgICAgICAgIEhUX2luc2VydDogWyJpZChcImJfcmVzdWx0c1wiKS9saVtAY2xhc3M9XCJiX3BhZ1wiXSIsIDFdLA0KICAgICAgICAgICByZXBsYWNlRTogImlkKFwiYl9yZXN1bHRzXCIpLy9uYXZbQHJvbGU9XCJuYXZpZ2F0aW9uXCJdIiwNCiAgICAgICB9DQogICB9LA0KICAgZG9nZTogew0KICAgICAgU2l0ZVR5cGVJRDogMTEsDQogICAgICBNYWluVHlwZTogIiNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIiwNCiAgICAgIEZhdmljb25UeXBlOiAiLnJlc3VsdHNfbGlua3NfZGVlcCAucmVzdWx0X191cmxfX2RvbWFpbiIsDQogICAgICBGYXZpY29uQWRkVG86ICJoMiIsDQogICAgICBDb3VudGVyVHlwZTogIiNsaW5rc193cmFwcGVyICNsaW5rcyAucmVzdWx0c19saW5rc19kZWVwIGgyIiwNCiAgICAgIEJsb2NrVHlwZTogImgyIGEiLA0KICAgICAgcGFnZXI6ew0KICAgICAgICAgIG5leHRMaW5rOiAiLy9hW2NvbnRhaW5zKEBjbGFzcywgJ3Jlc3VsdC0tbW9yZScpXSIsDQogICAgICAgICAgcGFnZUVsZW1lbnQ6ICJpZCgnbGlua3Nfd3JhcHBlcicpLy9kaXZbY29udGFpbnMoQGNsYXNzLCAncmVzdWx0c19saW5rc19kZWVwJyldIiwNCiAgICAgICAgICBIVF9pbnNlcnQ6IFsiaWQoJ2xpbmtzX3dyYXBwZXInKS8vZGl2W0BpZD0nbGlua3MnXS9kaXZbY29udGFpbnMoQGNsYXNzLCAncmVzdWx0LS1tb3JlJyldIiwgMV0sDQogICAgICAgICAgcmVwbGFjZUU6ICJpZCgnbGlua3Nfd3JhcHBlcicpLy9kaXZbY29udGFpbnMoQGNsYXNzLCAncmVzdWx0LS1tb3JlJyldL2FbY29udGFpbnModGV4dCgpLCAnw6TCuMKLw6TCuMKAw6nCocK1JyldW0BocmVmXSIsDQogICAgICB9DQogICB9LA0KICAgbUJhaWR1OnsNCiAgICAgICBTaXRlVHlwZUlEOiA2LA0KICAgICAgIE1haW5UeXBlOiAiI2JfcmVzdWx0cz5saSIsDQogICAgICAgRmF2aWNvblR5cGU6ICIuYl9hdHRyaWJ1dGlvbj5jaXRlIiwNCiAgICAgICBGYXZpY29uQWRkVG86ICJoMiIsDQogICAgICAgQ291bnRlclR5cGU6ICIjYl9yZXN1bHRzPmxpW2NsYXNzfj1iX2Fuc10+aDIsI2JfcmVzdWx0cz5saVtjbGFzc349Yl9hbGdvXT5oMiwjYl9yZXN1bHRzPmxpW2NsYXNzfj1iX2FsZ29dPmgyIiwNCiAgICAgICBCbG9ja1R5cGU6ICJoMiBhIiwNCiAgIH0sDQogICB6aGlodTogew0KICAgICAgIFNpdGVUeXBlSUQ6IDcsDQogICB9LA0KICAgYmFpZHVfeHVlc2h1OnsNCiAgICAgICBTaXRlVHlwZUlEOiA4LA0KICAgICAgIE1haW5UeXBlOiAiI2NvbnRlbnRfbGVmdCAucmVzdWx0IiwNCiAgICAgICBTdHlwZV9Ob3JtYWw6ICJoMy50PmEsICNyZXN1bHRzIC5jLWNvbnRhaW5lcj4uYy1ibG9ja2EiLA0KICAgICAgIEZhdmljb25UeXBlOiAiLnJlc3VsdC1vcCwgLmMtc2hvd3VybCIsDQogICAgICAgRmF2aWNvbkFkZFRvOiAiaDMiLA0KICAgICAgIENvdW50ZXJUeXBlOiAiI2NvbnRlbnRfbGVmdD4jZG91YmxlPmRpdltzcmNpZF0gKltjbGFzc349dF0sW2NsYXNzfj1vcF9iZXN0X2Fuc3dlcl9xdWVzdGlvbl0sI2NvbnRlbnRfbGVmdD5kaXZbc3JjaWRdICpbY2xhc3N+PXRdLFtjbGFzc349b3BfYmVzdF9hbnN3ZXJfcXVlc3Rpb25dIiwNCiAgICAgICBCbG9ja1R5cGU6ICJoMyBhIiwNCiAgIH0sDQogICBvdGhlcjogew0KICAgICAgIFNpdGVUeXBlSUQ6IDksDQogICB9DQp9DQo="}],"requires":[{"meta":{"name":"vue.js","url":"https://cdn.staticfile.org/vue/2.6.11/vue.js","ts":1605621954132,"mimetype":"text/javascript"},"source":"LyohCiAqIFZ1ZS5qcyB2Mi42LjExCiAqIChjKSAyMDE0LTIwMTkgRXZhbiBZb3UKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLgogKi8KKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6CiAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDoKICAoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGdsb2JhbC5WdWUgPSBmYWN0b3J5KCkpOwp9KHRoaXMsIGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnOwoKICAvKiAgKi8KCiAgdmFyIGVtcHR5T2JqZWN0ID0gT2JqZWN0LmZyZWV6ZSh7fSk7CgogIC8vIFRoZXNlIGhlbHBlcnMgcHJvZHVjZSBiZXR0ZXIgVk0gY29kZSBpbiBKUyBlbmdpbmVzIGR1ZSB0byB0aGVpcgogIC8vIGV4cGxpY2l0bmVzcyBhbmQgZnVuY3Rpb24gaW5saW5pbmcuCiAgZnVuY3Rpb24gaXNVbmRlZiAodikgewogICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCB8fCB2ID09PSBudWxsCiAgfQoKICBmdW5jdGlvbiBpc0RlZiAodikgewogICAgcmV0dXJuIHYgIT09IHVuZGVmaW5lZCAmJiB2ICE9PSBudWxsCiAgfQoKICBmdW5jdGlvbiBpc1RydWUgKHYpIHsKICAgIHJldHVybiB2ID09PSB0cnVlCiAgfQoKICBmdW5jdGlvbiBpc0ZhbHNlICh2KSB7CiAgICByZXR1cm4gdiA9PT0gZmFsc2UKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHZhbHVlIGlzIHByaW1pdGl2ZS4KICAgKi8KICBmdW5jdGlvbiBpc1ByaW1pdGl2ZSAodmFsdWUpIHsKICAgIHJldHVybiAoCiAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwKICAgICAgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyB8fAogICAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgICAgdHlwZW9mIHZhbHVlID09PSAnc3ltYm9sJyB8fAogICAgICB0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJwogICAgKQogIH0KCiAgLyoqCiAgICogUXVpY2sgb2JqZWN0IGNoZWNrIC0gdGhpcyBpcyBwcmltYXJpbHkgdXNlZCB0byB0ZWxsCiAgICogT2JqZWN0cyBmcm9tIHByaW1pdGl2ZSB2YWx1ZXMgd2hlbiB3ZSBrbm93IHRoZSB2YWx1ZQogICAqIGlzIGEgSlNPTi1jb21wbGlhbnQgdHlwZS4KICAgKi8KICBmdW5jdGlvbiBpc09iamVjdCAob2JqKSB7CiAgICByZXR1cm4gb2JqICE9PSBudWxsICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnCiAgfQoKICAvKioKICAgKiBHZXQgdGhlIHJhdyB0eXBlIHN0cmluZyBvZiBhIHZhbHVlLCBlLmcuLCBbb2JqZWN0IE9iamVjdF0uCiAgICovCiAgdmFyIF90b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CgogIGZ1bmN0aW9uIHRvUmF3VHlwZSAodmFsdWUpIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbCh2YWx1ZSkuc2xpY2UoOCwgLTEpCiAgfQoKICAvKioKICAgKiBTdHJpY3Qgb2JqZWN0IHR5cGUgY2hlY2suIE9ubHkgcmV0dXJucyB0cnVlCiAgICogZm9yIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0cy4KICAgKi8KICBmdW5jdGlvbiBpc1BsYWluT2JqZWN0IChvYmopIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBPYmplY3RdJwogIH0KCiAgZnVuY3Rpb24gaXNSZWdFeHAgKHYpIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgUmVnRXhwXScKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHZhbCBpcyBhIHZhbGlkIGFycmF5IGluZGV4LgogICAqLwogIGZ1bmN0aW9uIGlzVmFsaWRBcnJheUluZGV4ICh2YWwpIHsKICAgIHZhciBuID0gcGFyc2VGbG9hdChTdHJpbmcodmFsKSk7CiAgICByZXR1cm4gbiA+PSAwICYmIE1hdGguZmxvb3IobikgPT09IG4gJiYgaXNGaW5pdGUodmFsKQogIH0KCiAgZnVuY3Rpb24gaXNQcm9taXNlICh2YWwpIHsKICAgIHJldHVybiAoCiAgICAgIGlzRGVmKHZhbCkgJiYKICAgICAgdHlwZW9mIHZhbC50aGVuID09PSAnZnVuY3Rpb24nICYmCiAgICAgIHR5cGVvZiB2YWwuY2F0Y2ggPT09ICdmdW5jdGlvbicKICAgICkKICB9CgogIC8qKgogICAqIENvbnZlcnQgYSB2YWx1ZSB0byBhIHN0cmluZyB0aGF0IGlzIGFjdHVhbGx5IHJlbmRlcmVkLgogICAqLwogIGZ1bmN0aW9uIHRvU3RyaW5nICh2YWwpIHsKICAgIHJldHVybiB2YWwgPT0gbnVsbAogICAgICA/ICcnCiAgICAgIDogQXJyYXkuaXNBcnJheSh2YWwpIHx8IChpc1BsYWluT2JqZWN0KHZhbCkgJiYgdmFsLnRvU3RyaW5nID09PSBfdG9TdHJpbmcpCiAgICAgICAgPyBKU09OLnN0cmluZ2lmeSh2YWwsIG51bGwsIDIpCiAgICAgICAgOiBTdHJpbmcodmFsKQogIH0KCiAgLyoqCiAgICogQ29udmVydCBhbiBpbnB1dCB2YWx1ZSB0byBhIG51bWJlciBmb3IgcGVyc2lzdGVuY2UuCiAgICogSWYgdGhlIGNvbnZlcnNpb24gZmFpbHMsIHJldHVybiBvcmlnaW5hbCBzdHJpbmcuCiAgICovCiAgZnVuY3Rpb24gdG9OdW1iZXIgKHZhbCkgewogICAgdmFyIG4gPSBwYXJzZUZsb2F0KHZhbCk7CiAgICByZXR1cm4gaXNOYU4obikgPyB2YWwgOiBuCiAgfQoKICAvKioKICAgKiBNYWtlIGEgbWFwIGFuZCByZXR1cm4gYSBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYSBrZXkKICAgKiBpcyBpbiB0aGF0IG1hcC4KICAgKi8KICBmdW5jdGlvbiBtYWtlTWFwICgKICAgIHN0ciwKICAgIGV4cGVjdHNMb3dlckNhc2UKICApIHsKICAgIHZhciBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdmFyIGxpc3QgPSBzdHIuc3BsaXQoJywnKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgewogICAgICBtYXBbbGlzdFtpXV0gPSB0cnVlOwogICAgfQogICAgcmV0dXJuIGV4cGVjdHNMb3dlckNhc2UKICAgICAgPyBmdW5jdGlvbiAodmFsKSB7IHJldHVybiBtYXBbdmFsLnRvTG93ZXJDYXNlKCldOyB9CiAgICAgIDogZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gbWFwW3ZhbF07IH0KICB9CgogIC8qKgogICAqIENoZWNrIGlmIGEgdGFnIGlzIGEgYnVpbHQtaW4gdGFnLgogICAqLwogIHZhciBpc0J1aWx0SW5UYWcgPSBtYWtlTWFwKCdzbG90LGNvbXBvbmVudCcsIHRydWUpOwoKICAvKioKICAgKiBDaGVjayBpZiBhbiBhdHRyaWJ1dGUgaXMgYSByZXNlcnZlZCBhdHRyaWJ1dGUuCiAgICovCiAgdmFyIGlzUmVzZXJ2ZWRBdHRyaWJ1dGUgPSBtYWtlTWFwKCdrZXkscmVmLHNsb3Qsc2xvdC1zY29wZSxpcycpOwoKICAvKioKICAgKiBSZW1vdmUgYW4gaXRlbSBmcm9tIGFuIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIHJlbW92ZSAoYXJyLCBpdGVtKSB7CiAgICBpZiAoYXJyLmxlbmd0aCkgewogICAgICB2YXIgaW5kZXggPSBhcnIuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICByZXR1cm4gYXJyLnNwbGljZShpbmRleCwgMSkKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogQ2hlY2sgd2hldGhlciBhbiBvYmplY3QgaGFzIHRoZSBwcm9wZXJ0eS4KICAgKi8KICB2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwogIGZ1bmN0aW9uIGhhc093biAob2JqLCBrZXkpIHsKICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KQogIH0KCiAgLyoqCiAgICogQ3JlYXRlIGEgY2FjaGVkIHZlcnNpb24gb2YgYSBwdXJlIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNhY2hlZCAoZm4pIHsKICAgIHZhciBjYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICByZXR1cm4gKGZ1bmN0aW9uIGNhY2hlZEZuIChzdHIpIHsKICAgICAgdmFyIGhpdCA9IGNhY2hlW3N0cl07CiAgICAgIHJldHVybiBoaXQgfHwgKGNhY2hlW3N0cl0gPSBmbihzdHIpKQogICAgfSkKICB9CgogIC8qKgogICAqIENhbWVsaXplIGEgaHlwaGVuLWRlbGltaXRlZCBzdHJpbmcuCiAgICovCiAgdmFyIGNhbWVsaXplUkUgPSAvLShcdykvZzsKICB2YXIgY2FtZWxpemUgPSBjYWNoZWQoZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuIHN0ci5yZXBsYWNlKGNhbWVsaXplUkUsIGZ1bmN0aW9uIChfLCBjKSB7IHJldHVybiBjID8gYy50b1VwcGVyQ2FzZSgpIDogJyc7IH0pCiAgfSk7CgogIC8qKgogICAqIENhcGl0YWxpemUgYSBzdHJpbmcuCiAgICovCiAgdmFyIGNhcGl0YWxpemUgPSBjYWNoZWQoZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKQogIH0pOwoKICAvKioKICAgKiBIeXBoZW5hdGUgYSBjYW1lbENhc2Ugc3RyaW5nLgogICAqLwogIHZhciBoeXBoZW5hdGVSRSA9IC9cQihbQS1aXSkvZzsKICB2YXIgaHlwaGVuYXRlID0gY2FjaGVkKGZ1bmN0aW9uIChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZShoeXBoZW5hdGVSRSwgJy0kMScpLnRvTG93ZXJDYXNlKCkKICB9KTsKCiAgLyoqCiAgICogU2ltcGxlIGJpbmQgcG9seWZpbGwgZm9yIGVudmlyb25tZW50cyB0aGF0IGRvIG5vdCBzdXBwb3J0IGl0LAogICAqIGUuZy4sIFBoYW50b21KUyAxLnguIFRlY2huaWNhbGx5LCB3ZSBkb24ndCBuZWVkIHRoaXMgYW55bW9yZQogICAqIHNpbmNlIG5hdGl2ZSBiaW5kIGlzIG5vdyBwZXJmb3JtYW50IGVub3VnaCBpbiBtb3N0IGJyb3dzZXJzLgogICAqIEJ1dCByZW1vdmluZyBpdCB3b3VsZCBtZWFuIGJyZWFraW5nIGNvZGUgdGhhdCB3YXMgYWJsZSB0byBydW4gaW4KICAgKiBQaGFudG9tSlMgMS54LCBzbyB0aGlzIG11c3QgYmUga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS4KICAgKi8KCiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICBmdW5jdGlvbiBwb2x5ZmlsbEJpbmQgKGZuLCBjdHgpIHsKICAgIGZ1bmN0aW9uIGJvdW5kRm4gKGEpIHsKICAgICAgdmFyIGwgPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICByZXR1cm4gbAogICAgICAgID8gbCA+IDEKICAgICAgICAgID8gZm4uYXBwbHkoY3R4LCBhcmd1bWVudHMpCiAgICAgICAgICA6IGZuLmNhbGwoY3R4LCBhKQogICAgICAgIDogZm4uY2FsbChjdHgpCiAgICB9CgogICAgYm91bmRGbi5fbGVuZ3RoID0gZm4ubGVuZ3RoOwogICAgcmV0dXJuIGJvdW5kRm4KICB9CgogIGZ1bmN0aW9uIG5hdGl2ZUJpbmQgKGZuLCBjdHgpIHsKICAgIHJldHVybiBmbi5iaW5kKGN0eCkKICB9CgogIHZhciBiaW5kID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQKICAgID8gbmF0aXZlQmluZAogICAgOiBwb2x5ZmlsbEJpbmQ7CgogIC8qKgogICAqIENvbnZlcnQgYW4gQXJyYXktbGlrZSBvYmplY3QgdG8gYSByZWFsIEFycmF5LgogICAqLwogIGZ1bmN0aW9uIHRvQXJyYXkgKGxpc3QsIHN0YXJ0KSB7CiAgICBzdGFydCA9IHN0YXJ0IHx8IDA7CiAgICB2YXIgaSA9IGxpc3QubGVuZ3RoIC0gc3RhcnQ7CiAgICB2YXIgcmV0ID0gbmV3IEFycmF5KGkpOwogICAgd2hpbGUgKGktLSkgewogICAgICByZXRbaV0gPSBsaXN0W2kgKyBzdGFydF07CiAgICB9CiAgICByZXR1cm4gcmV0CiAgfQoKICAvKioKICAgKiBNaXggcHJvcGVydGllcyBpbnRvIHRhcmdldCBvYmplY3QuCiAgICovCiAgZnVuY3Rpb24gZXh0ZW5kICh0bywgX2Zyb20pIHsKICAgIGZvciAodmFyIGtleSBpbiBfZnJvbSkgewogICAgICB0b1trZXldID0gX2Zyb21ba2V5XTsKICAgIH0KICAgIHJldHVybiB0bwogIH0KCiAgLyoqCiAgICogTWVyZ2UgYW4gQXJyYXkgb2YgT2JqZWN0cyBpbnRvIGEgc2luZ2xlIE9iamVjdC4KICAgKi8KICBmdW5jdGlvbiB0b09iamVjdCAoYXJyKSB7CiAgICB2YXIgcmVzID0ge307CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBpZiAoYXJyW2ldKSB7CiAgICAgICAgZXh0ZW5kKHJlcywgYXJyW2ldKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCiAgLyoqCiAgICogUGVyZm9ybSBubyBvcGVyYXRpb24uCiAgICogU3R1YmJpbmcgYXJncyB0byBtYWtlIEZsb3cgaGFwcHkgd2l0aG91dCBsZWF2aW5nIHVzZWxlc3MgdHJhbnNwaWxlZCBjb2RlCiAgICogd2l0aCAuLi5yZXN0IChodHRwczovL2Zsb3cub3JnL2Jsb2cvMjAxNy8wNS8wNy9TdHJpY3QtRnVuY3Rpb24tQ2FsbC1Bcml0eS8pLgogICAqLwogIGZ1bmN0aW9uIG5vb3AgKGEsIGIsIGMpIHt9CgogIC8qKgogICAqIEFsd2F5cyByZXR1cm4gZmFsc2UuCiAgICovCiAgdmFyIG5vID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIGZhbHNlOyB9OwoKICAvKiBlc2xpbnQtZW5hYmxlIG5vLXVudXNlZC12YXJzICovCgogIC8qKgogICAqIFJldHVybiB0aGUgc2FtZSB2YWx1ZS4KICAgKi8KICB2YXIgaWRlbnRpdHkgPSBmdW5jdGlvbiAoXykgeyByZXR1cm4gXzsgfTsKCiAgLyoqCiAgICogR2VuZXJhdGUgYSBzdHJpbmcgY29udGFpbmluZyBzdGF0aWMga2V5cyBmcm9tIGNvbXBpbGVyIG1vZHVsZXMuCiAgICovCiAgZnVuY3Rpb24gZ2VuU3RhdGljS2V5cyAobW9kdWxlcykgewogICAgcmV0dXJuIG1vZHVsZXMucmVkdWNlKGZ1bmN0aW9uIChrZXlzLCBtKSB7CiAgICAgIHJldHVybiBrZXlzLmNvbmNhdChtLnN0YXRpY0tleXMgfHwgW10pCiAgICB9LCBbXSkuam9pbignLCcpCiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0d28gdmFsdWVzIGFyZSBsb29zZWx5IGVxdWFsIC0gdGhhdCBpcywKICAgKiBpZiB0aGV5IGFyZSBwbGFpbiBvYmplY3RzLCBkbyB0aGV5IGhhdmUgdGhlIHNhbWUgc2hhcGU/CiAgICovCiAgZnVuY3Rpb24gbG9vc2VFcXVhbCAoYSwgYikgewogICAgaWYgKGEgPT09IGIpIHsgcmV0dXJuIHRydWUgfQogICAgdmFyIGlzT2JqZWN0QSA9IGlzT2JqZWN0KGEpOwogICAgdmFyIGlzT2JqZWN0QiA9IGlzT2JqZWN0KGIpOwogICAgaWYgKGlzT2JqZWN0QSAmJiBpc09iamVjdEIpIHsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgaXNBcnJheUEgPSBBcnJheS5pc0FycmF5KGEpOwogICAgICAgIHZhciBpc0FycmF5QiA9IEFycmF5LmlzQXJyYXkoYik7CiAgICAgICAgaWYgKGlzQXJyYXlBICYmIGlzQXJyYXlCKSB7CiAgICAgICAgICByZXR1cm4gYS5sZW5ndGggPT09IGIubGVuZ3RoICYmIGEuZXZlcnkoZnVuY3Rpb24gKGUsIGkpIHsKICAgICAgICAgICAgcmV0dXJuIGxvb3NlRXF1YWwoZSwgYltpXSkKICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIGlmIChhIGluc3RhbmNlb2YgRGF0ZSAmJiBiIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgcmV0dXJuIGEuZ2V0VGltZSgpID09PSBiLmdldFRpbWUoKQogICAgICAgIH0gZWxzZSBpZiAoIWlzQXJyYXlBICYmICFpc0FycmF5QikgewogICAgICAgICAgdmFyIGtleXNBID0gT2JqZWN0LmtleXMoYSk7CiAgICAgICAgICB2YXIga2V5c0IgPSBPYmplY3Qua2V5cyhiKTsKICAgICAgICAgIHJldHVybiBrZXlzQS5sZW5ndGggPT09IGtleXNCLmxlbmd0aCAmJiBrZXlzQS5ldmVyeShmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiBsb29zZUVxdWFsKGFba2V5XSwgYltrZXldKQogICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIWlzT2JqZWN0QSAmJiAhaXNPYmplY3RCKSB7CiAgICAgIHJldHVybiBTdHJpbmcoYSkgPT09IFN0cmluZyhiKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgfQoKICAvKioKICAgKiBSZXR1cm4gdGhlIGZpcnN0IGluZGV4IGF0IHdoaWNoIGEgbG9vc2VseSBlcXVhbCB2YWx1ZSBjYW4gYmUKICAgKiBmb3VuZCBpbiB0aGUgYXJyYXkgKGlmIHZhbHVlIGlzIGEgcGxhaW4gb2JqZWN0LCB0aGUgYXJyYXkgbXVzdAogICAqIGNvbnRhaW4gYW4gb2JqZWN0IG9mIHRoZSBzYW1lIHNoYXBlKSwgb3IgLTEgaWYgaXQgaXMgbm90IHByZXNlbnQuCiAgICovCiAgZnVuY3Rpb24gbG9vc2VJbmRleE9mIChhcnIsIHZhbCkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGxvb3NlRXF1YWwoYXJyW2ldLCB2YWwpKSB7IHJldHVybiBpIH0KICAgIH0KICAgIHJldHVybiAtMQogIH0KCiAgLyoqCiAgICogRW5zdXJlIGEgZnVuY3Rpb24gaXMgY2FsbGVkIG9ubHkgb25jZS4KICAgKi8KICBmdW5jdGlvbiBvbmNlIChmbikgewogICAgdmFyIGNhbGxlZCA9IGZhbHNlOwogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCFjYWxsZWQpIHsKICAgICAgICBjYWxsZWQgPSB0cnVlOwogICAgICAgIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBTU1JfQVRUUiA9ICdkYXRhLXNlcnZlci1yZW5kZXJlZCc7CgogIHZhciBBU1NFVF9UWVBFUyA9IFsKICAgICdjb21wb25lbnQnLAogICAgJ2RpcmVjdGl2ZScsCiAgICAnZmlsdGVyJwogIF07CgogIHZhciBMSUZFQ1lDTEVfSE9PS1MgPSBbCiAgICAnYmVmb3JlQ3JlYXRlJywKICAgICdjcmVhdGVkJywKICAgICdiZWZvcmVNb3VudCcsCiAgICAnbW91bnRlZCcsCiAgICAnYmVmb3JlVXBkYXRlJywKICAgICd1cGRhdGVkJywKICAgICdiZWZvcmVEZXN0cm95JywKICAgICdkZXN0cm95ZWQnLAogICAgJ2FjdGl2YXRlZCcsCiAgICAnZGVhY3RpdmF0ZWQnLAogICAgJ2Vycm9yQ2FwdHVyZWQnLAogICAgJ3NlcnZlclByZWZldGNoJwogIF07CgogIC8qICAqLwoKCgogIHZhciBjb25maWcgPSAoewogICAgLyoqCiAgICAgKiBPcHRpb24gbWVyZ2Ugc3RyYXRlZ2llcyAodXNlZCBpbiBjb3JlL3V0aWwvb3B0aW9ucykKICAgICAqLwogICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICBvcHRpb25NZXJnZVN0cmF0ZWdpZXM6IE9iamVjdC5jcmVhdGUobnVsbCksCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHN1cHByZXNzIHdhcm5pbmdzLgogICAgICovCiAgICBzaWxlbnQ6IGZhbHNlLAoKICAgIC8qKgogICAgICogU2hvdyBwcm9kdWN0aW9uIG1vZGUgdGlwIG1lc3NhZ2Ugb24gYm9vdD8KICAgICAqLwogICAgcHJvZHVjdGlvblRpcDogImRldmVsb3BtZW50IiAhPT0gJ3Byb2R1Y3Rpb24nLAoKICAgIC8qKgogICAgICogV2hldGhlciB0byBlbmFibGUgZGV2dG9vbHMKICAgICAqLwogICAgZGV2dG9vbHM6ICJkZXZlbG9wbWVudCIgIT09ICdwcm9kdWN0aW9uJywKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcmVjb3JkIHBlcmYKICAgICAqLwogICAgcGVyZm9ybWFuY2U6IGZhbHNlLAoKICAgIC8qKgogICAgICogRXJyb3IgaGFuZGxlciBmb3Igd2F0Y2hlciBlcnJvcnMKICAgICAqLwogICAgZXJyb3JIYW5kbGVyOiBudWxsLAoKICAgIC8qKgogICAgICogV2FybiBoYW5kbGVyIGZvciB3YXRjaGVyIHdhcm5zCiAgICAgKi8KICAgIHdhcm5IYW5kbGVyOiBudWxsLAoKICAgIC8qKgogICAgICogSWdub3JlIGNlcnRhaW4gY3VzdG9tIGVsZW1lbnRzCiAgICAgKi8KICAgIGlnbm9yZWRFbGVtZW50czogW10sCgogICAgLyoqCiAgICAgKiBDdXN0b20gdXNlciBrZXkgYWxpYXNlcyBmb3Igdi1vbgogICAgICovCiAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgIGtleUNvZGVzOiBPYmplY3QuY3JlYXRlKG51bGwpLAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB0YWcgaXMgcmVzZXJ2ZWQgc28gdGhhdCBpdCBjYW5ub3QgYmUgcmVnaXN0ZXJlZCBhcyBhCiAgICAgKiBjb21wb25lbnQuIFRoaXMgaXMgcGxhdGZvcm0tZGVwZW5kZW50IGFuZCBtYXkgYmUgb3ZlcndyaXR0ZW4uCiAgICAgKi8KICAgIGlzUmVzZXJ2ZWRUYWc6IG5vLAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gYXR0cmlidXRlIGlzIHJlc2VydmVkIHNvIHRoYXQgaXQgY2Fubm90IGJlIHVzZWQgYXMgYSBjb21wb25lbnQKICAgICAqIHByb3AuIFRoaXMgaXMgcGxhdGZvcm0tZGVwZW5kZW50IGFuZCBtYXkgYmUgb3ZlcndyaXR0ZW4uCiAgICAgKi8KICAgIGlzUmVzZXJ2ZWRBdHRyOiBubywKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdGFnIGlzIGFuIHVua25vd24gZWxlbWVudC4KICAgICAqIFBsYXRmb3JtLWRlcGVuZGVudC4KICAgICAqLwogICAgaXNVbmtub3duRWxlbWVudDogbm8sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIG5hbWVzcGFjZSBvZiBhbiBlbGVtZW50CiAgICAgKi8KICAgIGdldFRhZ05hbWVzcGFjZTogbm9vcCwKCiAgICAvKioKICAgICAqIFBhcnNlIHRoZSByZWFsIHRhZyBuYW1lIGZvciB0aGUgc3BlY2lmaWMgcGxhdGZvcm0uCiAgICAgKi8KICAgIHBhcnNlUGxhdGZvcm1UYWdOYW1lOiBpZGVudGl0eSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGF0dHJpYnV0ZSBtdXN0IGJlIGJvdW5kIHVzaW5nIHByb3BlcnR5LCBlLmcuIHZhbHVlCiAgICAgKiBQbGF0Zm9ybS1kZXBlbmRlbnQuCiAgICAgKi8KICAgIG11c3RVc2VQcm9wOiBubywKCiAgICAvKioKICAgICAqIFBlcmZvcm0gdXBkYXRlcyBhc3luY2hyb25vdXNseS4gSW50ZW5kZWQgdG8gYmUgdXNlZCBieSBWdWUgVGVzdCBVdGlscwogICAgICogVGhpcyB3aWxsIHNpZ25pZmljYW50bHkgcmVkdWNlIHBlcmZvcm1hbmNlIGlmIHNldCB0byBmYWxzZS4KICAgICAqLwogICAgYXN5bmM6IHRydWUsCgogICAgLyoqCiAgICAgKiBFeHBvc2VkIGZvciBsZWdhY3kgcmVhc29ucwogICAgICovCiAgICBfbGlmZWN5Y2xlSG9va3M6IExJRkVDWUNMRV9IT09LUwogIH0pOwoKICAvKiAgKi8KCiAgLyoqCiAgICogdW5pY29kZSBsZXR0ZXJzIHVzZWQgZm9yIHBhcnNpbmcgaHRtbCB0YWdzLCBjb21wb25lbnQgbmFtZXMgYW5kIHByb3BlcnR5IHBhdGhzLgogICAqIHVzaW5nIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9odG1sNTMvc2VtYW50aWNzLXNjcmlwdGluZy5odG1sI3BvdGVudGlhbGN1c3RvbWVsZW1lbnRuYW1lCiAgICogc2tpcHBpbmcgXHUxMDAwMC1cdUVGRkZGIGR1ZSB0byBpdCBmcmVlemluZyB1cCBQaGFudG9tSlMKICAgKi8KICB2YXIgdW5pY29kZVJlZ0V4cCA9IC9hLXpBLVpcdTAwQjdcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjAzRi1cdTIwNDBcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRC87CgogIC8qKgogICAqIENoZWNrIGlmIGEgc3RyaW5nIHN0YXJ0cyB3aXRoICQgb3IgXwogICAqLwogIGZ1bmN0aW9uIGlzUmVzZXJ2ZWQgKHN0cikgewogICAgdmFyIGMgPSAoc3RyICsgJycpLmNoYXJDb2RlQXQoMCk7CiAgICByZXR1cm4gYyA9PT0gMHgyNCB8fCBjID09PSAweDVGCiAgfQoKICAvKioKICAgKiBEZWZpbmUgYSBwcm9wZXJ0eS4KICAgKi8KICBmdW5jdGlvbiBkZWYgKG9iaiwga2V5LCB2YWwsIGVudW1lcmFibGUpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsLAogICAgICBlbnVtZXJhYmxlOiAhIWVudW1lcmFibGUsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0pOwogIH0KCiAgLyoqCiAgICogUGFyc2Ugc2ltcGxlIHBhdGguCiAgICovCiAgdmFyIGJhaWxSRSA9IG5ldyBSZWdFeHAoKCJbXiIgKyAodW5pY29kZVJlZ0V4cC5zb3VyY2UpICsgIi4kX1xcZF0iKSk7CiAgZnVuY3Rpb24gcGFyc2VQYXRoIChwYXRoKSB7CiAgICBpZiAoYmFpbFJFLnRlc3QocGF0aCkpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgc2VnbWVudHMgPSBwYXRoLnNwbGl0KCcuJyk7CiAgICByZXR1cm4gZnVuY3Rpb24gKG9iaikgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKCFvYmopIHsgcmV0dXJuIH0KICAgICAgICBvYmogPSBvYmpbc2VnbWVudHNbaV1dOwogICAgICB9CiAgICAgIHJldHVybiBvYmoKICAgIH0KICB9CgogIC8qICAqLwoKICAvLyBjYW4gd2UgdXNlIF9fcHJvdG9fXz8KICB2YXIgaGFzUHJvdG8gPSAnX19wcm90b19fJyBpbiB7fTsKCiAgLy8gQnJvd3NlciBlbnZpcm9ubWVudCBzbmlmZmluZwogIHZhciBpbkJyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJzsKICB2YXIgaW5XZWV4ID0gdHlwZW9mIFdYRW52aXJvbm1lbnQgIT09ICd1bmRlZmluZWQnICYmICEhV1hFbnZpcm9ubWVudC5wbGF0Zm9ybTsKICB2YXIgd2VleFBsYXRmb3JtID0gaW5XZWV4ICYmIFdYRW52aXJvbm1lbnQucGxhdGZvcm0udG9Mb3dlckNhc2UoKTsKICB2YXIgVUEgPSBpbkJyb3dzZXIgJiYgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsKICB2YXIgaXNJRSA9IFVBICYmIC9tc2llfHRyaWRlbnQvLnRlc3QoVUEpOwogIHZhciBpc0lFOSA9IFVBICYmIFVBLmluZGV4T2YoJ21zaWUgOS4wJykgPiAwOwogIHZhciBpc0VkZ2UgPSBVQSAmJiBVQS5pbmRleE9mKCdlZGdlLycpID4gMDsKICB2YXIgaXNBbmRyb2lkID0gKFVBICYmIFVBLmluZGV4T2YoJ2FuZHJvaWQnKSA+IDApIHx8ICh3ZWV4UGxhdGZvcm0gPT09ICdhbmRyb2lkJyk7CiAgdmFyIGlzSU9TID0gKFVBICYmIC9pcGhvbmV8aXBhZHxpcG9kfGlvcy8udGVzdChVQSkpIHx8ICh3ZWV4UGxhdGZvcm0gPT09ICdpb3MnKTsKICB2YXIgaXNDaHJvbWUgPSBVQSAmJiAvY2hyb21lXC9cZCsvLnRlc3QoVUEpICYmICFpc0VkZ2U7CiAgdmFyIGlzUGhhbnRvbUpTID0gVUEgJiYgL3BoYW50b21qcy8udGVzdChVQSk7CiAgdmFyIGlzRkYgPSBVQSAmJiBVQS5tYXRjaCgvZmlyZWZveFwvKFxkKykvKTsKCiAgLy8gRmlyZWZveCBoYXMgYSAid2F0Y2giIGZ1bmN0aW9uIG9uIE9iamVjdC5wcm90b3R5cGUuLi4KICB2YXIgbmF0aXZlV2F0Y2ggPSAoe30pLndhdGNoOwoKICB2YXIgc3VwcG9ydHNQYXNzaXZlID0gZmFsc2U7CiAgaWYgKGluQnJvd3NlcikgewogICAgdHJ5IHsKICAgICAgdmFyIG9wdHMgPSB7fTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9wdHMsICdwYXNzaXZlJywgKHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCAoKSB7CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgICAgc3VwcG9ydHNQYXNzaXZlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pKTsgLy8gaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL2Zsb3cvaXNzdWVzLzI4NQogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndGVzdC1wYXNzaXZlJywgbnVsbCwgb3B0cyk7CiAgICB9IGNhdGNoIChlKSB7fQogIH0KCiAgLy8gdGhpcyBuZWVkcyB0byBiZSBsYXp5LWV2YWxlZCBiZWNhdXNlIHZ1ZSBtYXkgYmUgcmVxdWlyZWQgYmVmb3JlCiAgLy8gdnVlLXNlcnZlci1yZW5kZXJlciBjYW4gc2V0IFZVRV9FTlYKICB2YXIgX2lzU2VydmVyOwogIHZhciBpc1NlcnZlclJlbmRlcmluZyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChfaXNTZXJ2ZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCFpbkJyb3dzZXIgJiYgIWluV2VleCAmJiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIC8vIGRldGVjdCBwcmVzZW5jZSBvZiB2dWUtc2VydmVyLXJlbmRlcmVyIGFuZCBhdm9pZAogICAgICAgIC8vIFdlYnBhY2sgc2hpbW1pbmcgdGhlIHByb2Nlc3MKICAgICAgICBfaXNTZXJ2ZXIgPSBnbG9iYWxbJ3Byb2Nlc3MnXSAmJiBnbG9iYWxbJ3Byb2Nlc3MnXS5lbnYuVlVFX0VOViA9PT0gJ3NlcnZlcic7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX2lzU2VydmVyID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBfaXNTZXJ2ZXIKICB9OwoKICAvLyBkZXRlY3QgZGV2dG9vbHMKICB2YXIgZGV2dG9vbHMgPSBpbkJyb3dzZXIgJiYgd2luZG93Ll9fVlVFX0RFVlRPT0xTX0dMT0JBTF9IT09LX187CgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gaXNOYXRpdmUgKEN0b3IpIHsKICAgIHJldHVybiB0eXBlb2YgQ3RvciA9PT0gJ2Z1bmN0aW9uJyAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoQ3Rvci50b1N0cmluZygpKQogIH0KCiAgdmFyIGhhc1N5bWJvbCA9CiAgICB0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBpc05hdGl2ZShTeW1ib2wpICYmCiAgICB0eXBlb2YgUmVmbGVjdCAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoUmVmbGVjdC5vd25LZXlzKTsKCiAgdmFyIF9TZXQ7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovIC8vICRmbG93LWRpc2FibGUtbGluZQogIGlmICh0eXBlb2YgU2V0ICE9PSAndW5kZWZpbmVkJyAmJiBpc05hdGl2ZShTZXQpKSB7CiAgICAvLyB1c2UgbmF0aXZlIFNldCB3aGVuIGF2YWlsYWJsZS4KICAgIF9TZXQgPSBTZXQ7CiAgfSBlbHNlIHsKICAgIC8vIGEgbm9uLXN0YW5kYXJkIFNldCBwb2x5ZmlsbCB0aGF0IG9ubHkgd29ya3Mgd2l0aCBwcmltaXRpdmUga2V5cy4KICAgIF9TZXQgPSAvKkBfX1BVUkVfXyovKGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gU2V0ICgpIHsKICAgICAgICB0aGlzLnNldCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH0KICAgICAgU2V0LnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbiBoYXMgKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLnNldFtrZXldID09PSB0cnVlCiAgICAgIH07CiAgICAgIFNldC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gYWRkIChrZXkpIHsKICAgICAgICB0aGlzLnNldFtrZXldID0gdHJ1ZTsKICAgICAgfTsKICAgICAgU2V0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIGNsZWFyICgpIHsKICAgICAgICB0aGlzLnNldCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH07CgogICAgICByZXR1cm4gU2V0OwogICAgfSgpKTsKICB9CgogIC8qICAqLwoKICB2YXIgd2FybiA9IG5vb3A7CiAgdmFyIHRpcCA9IG5vb3A7CiAgdmFyIGdlbmVyYXRlQ29tcG9uZW50VHJhY2UgPSAobm9vcCk7IC8vIHdvcmsgYXJvdW5kIGZsb3cgY2hlY2sKICB2YXIgZm9ybWF0Q29tcG9uZW50TmFtZSA9IChub29wKTsKCiAgewogICAgdmFyIGhhc0NvbnNvbGUgPSB0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCc7CiAgICB2YXIgY2xhc3NpZnlSRSA9IC8oPzpefFstX10pKFx3KS9nOwogICAgdmFyIGNsYXNzaWZ5ID0gZnVuY3Rpb24gKHN0cikgeyByZXR1cm4gc3RyCiAgICAgIC5yZXBsYWNlKGNsYXNzaWZ5UkUsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBjLnRvVXBwZXJDYXNlKCk7IH0pCiAgICAgIC5yZXBsYWNlKC9bLV9dL2csICcnKTsgfTsKCiAgICB3YXJuID0gZnVuY3Rpb24gKG1zZywgdm0pIHsKICAgICAgdmFyIHRyYWNlID0gdm0gPyBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlKHZtKSA6ICcnOwoKICAgICAgaWYgKGNvbmZpZy53YXJuSGFuZGxlcikgewogICAgICAgIGNvbmZpZy53YXJuSGFuZGxlci5jYWxsKG51bGwsIG1zZywgdm0sIHRyYWNlKTsKICAgICAgfSBlbHNlIGlmIChoYXNDb25zb2xlICYmICghY29uZmlnLnNpbGVudCkpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCgiW1Z1ZSB3YXJuXTogIiArIG1zZyArIHRyYWNlKSk7CiAgICAgIH0KICAgIH07CgogICAgdGlwID0gZnVuY3Rpb24gKG1zZywgdm0pIHsKICAgICAgaWYgKGhhc0NvbnNvbGUgJiYgKCFjb25maWcuc2lsZW50KSkgewogICAgICAgIGNvbnNvbGUud2FybigiW1Z1ZSB0aXBdOiAiICsgbXNnICsgKAogICAgICAgICAgdm0gPyBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlKHZtKSA6ICcnCiAgICAgICAgKSk7CiAgICAgIH0KICAgIH07CgogICAgZm9ybWF0Q29tcG9uZW50TmFtZSA9IGZ1bmN0aW9uICh2bSwgaW5jbHVkZUZpbGUpIHsKICAgICAgaWYgKHZtLiRyb290ID09PSB2bSkgewogICAgICAgIHJldHVybiAnPFJvb3Q+JwogICAgICB9CiAgICAgIHZhciBvcHRpb25zID0gdHlwZW9mIHZtID09PSAnZnVuY3Rpb24nICYmIHZtLmNpZCAhPSBudWxsCiAgICAgICAgPyB2bS5vcHRpb25zCiAgICAgICAgOiB2bS5faXNWdWUKICAgICAgICAgID8gdm0uJG9wdGlvbnMgfHwgdm0uY29uc3RydWN0b3Iub3B0aW9ucwogICAgICAgICAgOiB2bTsKICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLm5hbWUgfHwgb3B0aW9ucy5fY29tcG9uZW50VGFnOwogICAgICB2YXIgZmlsZSA9IG9wdGlvbnMuX19maWxlOwogICAgICBpZiAoIW5hbWUgJiYgZmlsZSkgewogICAgICAgIHZhciBtYXRjaCA9IGZpbGUubWF0Y2goLyhbXi9cXF0rKVwudnVlJC8pOwogICAgICAgIG5hbWUgPSBtYXRjaCAmJiBtYXRjaFsxXTsKICAgICAgfQoKICAgICAgcmV0dXJuICgKICAgICAgICAobmFtZSA/ICgiPCIgKyAoY2xhc3NpZnkobmFtZSkpICsgIj4iKSA6ICI8QW5vbnltb3VzPiIpICsKICAgICAgICAoZmlsZSAmJiBpbmNsdWRlRmlsZSAhPT0gZmFsc2UgPyAoIiBhdCAiICsgZmlsZSkgOiAnJykKICAgICAgKQogICAgfTsKCiAgICB2YXIgcmVwZWF0ID0gZnVuY3Rpb24gKHN0ciwgbikgewogICAgICB2YXIgcmVzID0gJyc7CiAgICAgIHdoaWxlIChuKSB7CiAgICAgICAgaWYgKG4gJSAyID09PSAxKSB7IHJlcyArPSBzdHI7IH0KICAgICAgICBpZiAobiA+IDEpIHsgc3RyICs9IHN0cjsgfQogICAgICAgIG4gPj49IDE7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlcwogICAgfTsKCiAgICBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlID0gZnVuY3Rpb24gKHZtKSB7CiAgICAgIGlmICh2bS5faXNWdWUgJiYgdm0uJHBhcmVudCkgewogICAgICAgIHZhciB0cmVlID0gW107CiAgICAgICAgdmFyIGN1cnJlbnRSZWN1cnNpdmVTZXF1ZW5jZSA9IDA7CiAgICAgICAgd2hpbGUgKHZtKSB7CiAgICAgICAgICBpZiAodHJlZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBsYXN0ID0gdHJlZVt0cmVlLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBpZiAobGFzdC5jb25zdHJ1Y3RvciA9PT0gdm0uY29uc3RydWN0b3IpIHsKICAgICAgICAgICAgICBjdXJyZW50UmVjdXJzaXZlU2VxdWVuY2UrKzsKICAgICAgICAgICAgICB2bSA9IHZtLiRwYXJlbnQ7CiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50UmVjdXJzaXZlU2VxdWVuY2UgPiAwKSB7CiAgICAgICAgICAgICAgdHJlZVt0cmVlLmxlbmd0aCAtIDFdID0gW2xhc3QsIGN1cnJlbnRSZWN1cnNpdmVTZXF1ZW5jZV07CiAgICAgICAgICAgICAgY3VycmVudFJlY3Vyc2l2ZVNlcXVlbmNlID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdHJlZS5wdXNoKHZtKTsKICAgICAgICAgIHZtID0gdm0uJHBhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdcblxuZm91bmQgaW5cblxuJyArIHRyZWUKICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHZtLCBpKSB7IHJldHVybiAoIiIgKyAoaSA9PT0gMCA/ICctLS0+ICcgOiByZXBlYXQoJyAnLCA1ICsgaSAqIDIpKSArIChBcnJheS5pc0FycmF5KHZtKQogICAgICAgICAgICAgID8gKChmb3JtYXRDb21wb25lbnROYW1lKHZtWzBdKSkgKyAiLi4uICgiICsgKHZtWzFdKSArICIgcmVjdXJzaXZlIGNhbGxzKSIpCiAgICAgICAgICAgICAgOiBmb3JtYXRDb21wb25lbnROYW1lKHZtKSkpOyB9KQogICAgICAgICAgLmpvaW4oJ1xuJykKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gKCJcblxuKGZvdW5kIGluICIgKyAoZm9ybWF0Q29tcG9uZW50TmFtZSh2bSkpICsgIikiKQogICAgICB9CiAgICB9OwogIH0KCiAgLyogICovCgogIHZhciB1aWQgPSAwOwoKICAvKioKICAgKiBBIGRlcCBpcyBhbiBvYnNlcnZhYmxlIHRoYXQgY2FuIGhhdmUgbXVsdGlwbGUKICAgKiBkaXJlY3RpdmVzIHN1YnNjcmliaW5nIHRvIGl0LgogICAqLwogIHZhciBEZXAgPSBmdW5jdGlvbiBEZXAgKCkgewogICAgdGhpcy5pZCA9IHVpZCsrOwogICAgdGhpcy5zdWJzID0gW107CiAgfTsKCiAgRGVwLnByb3RvdHlwZS5hZGRTdWIgPSBmdW5jdGlvbiBhZGRTdWIgKHN1YikgewogICAgdGhpcy5zdWJzLnB1c2goc3ViKTsKICB9OwoKICBEZXAucHJvdG90eXBlLnJlbW92ZVN1YiA9IGZ1bmN0aW9uIHJlbW92ZVN1YiAoc3ViKSB7CiAgICByZW1vdmUodGhpcy5zdWJzLCBzdWIpOwogIH07CgogIERlcC5wcm90b3R5cGUuZGVwZW5kID0gZnVuY3Rpb24gZGVwZW5kICgpIHsKICAgIGlmIChEZXAudGFyZ2V0KSB7CiAgICAgIERlcC50YXJnZXQuYWRkRGVwKHRoaXMpOwogICAgfQogIH07CgogIERlcC5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5ICgpIHsKICAgIC8vIHN0YWJpbGl6ZSB0aGUgc3Vic2NyaWJlciBsaXN0IGZpcnN0CiAgICB2YXIgc3VicyA9IHRoaXMuc3Vicy5zbGljZSgpOwogICAgaWYgKCFjb25maWcuYXN5bmMpIHsKICAgICAgLy8gc3VicyBhcmVuJ3Qgc29ydGVkIGluIHNjaGVkdWxlciBpZiBub3QgcnVubmluZyBhc3luYwogICAgICAvLyB3ZSBuZWVkIHRvIHNvcnQgdGhlbSBub3cgdG8gbWFrZSBzdXJlIHRoZXkgZmlyZSBpbiBjb3JyZWN0CiAgICAgIC8vIG9yZGVyCiAgICAgIHN1YnMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5pZCAtIGIuaWQ7IH0pOwogICAgfQogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzdWJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBzdWJzW2ldLnVwZGF0ZSgpOwogICAgfQogIH07CgogIC8vIFRoZSBjdXJyZW50IHRhcmdldCB3YXRjaGVyIGJlaW5nIGV2YWx1YXRlZC4KICAvLyBUaGlzIGlzIGdsb2JhbGx5IHVuaXF1ZSBiZWNhdXNlIG9ubHkgb25lIHdhdGNoZXIKICAvLyBjYW4gYmUgZXZhbHVhdGVkIGF0IGEgdGltZS4KICBEZXAudGFyZ2V0ID0gbnVsbDsKICB2YXIgdGFyZ2V0U3RhY2sgPSBbXTsKCiAgZnVuY3Rpb24gcHVzaFRhcmdldCAodGFyZ2V0KSB7CiAgICB0YXJnZXRTdGFjay5wdXNoKHRhcmdldCk7CiAgICBEZXAudGFyZ2V0ID0gdGFyZ2V0OwogIH0KCiAgZnVuY3Rpb24gcG9wVGFyZ2V0ICgpIHsKICAgIHRhcmdldFN0YWNrLnBvcCgpOwogICAgRGVwLnRhcmdldCA9IHRhcmdldFN0YWNrW3RhcmdldFN0YWNrLmxlbmd0aCAtIDFdOwogIH0KCiAgLyogICovCgogIHZhciBWTm9kZSA9IGZ1bmN0aW9uIFZOb2RlICgKICAgIHRhZywKICAgIGRhdGEsCiAgICBjaGlsZHJlbiwKICAgIHRleHQsCiAgICBlbG0sCiAgICBjb250ZXh0LAogICAgY29tcG9uZW50T3B0aW9ucywKICAgIGFzeW5jRmFjdG9yeQogICkgewogICAgdGhpcy50YWcgPSB0YWc7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuOwogICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgIHRoaXMuZWxtID0gZWxtOwogICAgdGhpcy5ucyA9IHVuZGVmaW5lZDsKICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgICB0aGlzLmZuQ29udGV4dCA9IHVuZGVmaW5lZDsKICAgIHRoaXMuZm5PcHRpb25zID0gdW5kZWZpbmVkOwogICAgdGhpcy5mblNjb3BlSWQgPSB1bmRlZmluZWQ7CiAgICB0aGlzLmtleSA9IGRhdGEgJiYgZGF0YS5rZXk7CiAgICB0aGlzLmNvbXBvbmVudE9wdGlvbnMgPSBjb21wb25lbnRPcHRpb25zOwogICAgdGhpcy5jb21wb25lbnRJbnN0YW5jZSA9IHVuZGVmaW5lZDsKICAgIHRoaXMucGFyZW50ID0gdW5kZWZpbmVkOwogICAgdGhpcy5yYXcgPSBmYWxzZTsKICAgIHRoaXMuaXNTdGF0aWMgPSBmYWxzZTsKICAgIHRoaXMuaXNSb290SW5zZXJ0ID0gdHJ1ZTsKICAgIHRoaXMuaXNDb21tZW50ID0gZmFsc2U7CiAgICB0aGlzLmlzQ2xvbmVkID0gZmFsc2U7CiAgICB0aGlzLmlzT25jZSA9IGZhbHNlOwogICAgdGhpcy5hc3luY0ZhY3RvcnkgPSBhc3luY0ZhY3Rvcnk7CiAgICB0aGlzLmFzeW5jTWV0YSA9IHVuZGVmaW5lZDsKICAgIHRoaXMuaXNBc3luY1BsYWNlaG9sZGVyID0gZmFsc2U7CiAgfTsKCiAgdmFyIHByb3RvdHlwZUFjY2Vzc29ycyA9IHsgY2hpbGQ6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTsKCiAgLy8gREVQUkVDQVRFRDogYWxpYXMgZm9yIGNvbXBvbmVudEluc3RhbmNlIGZvciBiYWNrd2FyZHMgY29tcGF0LgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgcHJvdG90eXBlQWNjZXNzb3JzLmNoaWxkLmdldCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmNvbXBvbmVudEluc3RhbmNlCiAgfTsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIFZOb2RlLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzICk7CgogIHZhciBjcmVhdGVFbXB0eVZOb2RlID0gZnVuY3Rpb24gKHRleHQpIHsKICAgIGlmICggdGV4dCA9PT0gdm9pZCAwICkgdGV4dCA9ICcnOwoKICAgIHZhciBub2RlID0gbmV3IFZOb2RlKCk7CiAgICBub2RlLnRleHQgPSB0ZXh0OwogICAgbm9kZS5pc0NvbW1lbnQgPSB0cnVlOwogICAgcmV0dXJuIG5vZGUKICB9OwoKICBmdW5jdGlvbiBjcmVhdGVUZXh0Vk5vZGUgKHZhbCkgewogICAgcmV0dXJuIG5ldyBWTm9kZSh1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBTdHJpbmcodmFsKSkKICB9CgogIC8vIG9wdGltaXplZCBzaGFsbG93IGNsb25lCiAgLy8gdXNlZCBmb3Igc3RhdGljIG5vZGVzIGFuZCBzbG90IG5vZGVzIGJlY2F1c2UgdGhleSBtYXkgYmUgcmV1c2VkIGFjcm9zcwogIC8vIG11bHRpcGxlIHJlbmRlcnMsIGNsb25pbmcgdGhlbSBhdm9pZHMgZXJyb3JzIHdoZW4gRE9NIG1hbmlwdWxhdGlvbnMgcmVseQogIC8vIG9uIHRoZWlyIGVsbSByZWZlcmVuY2UuCiAgZnVuY3Rpb24gY2xvbmVWTm9kZSAodm5vZGUpIHsKICAgIHZhciBjbG9uZWQgPSBuZXcgVk5vZGUoCiAgICAgIHZub2RlLnRhZywKICAgICAgdm5vZGUuZGF0YSwKICAgICAgLy8gIzc5NzUKICAgICAgLy8gY2xvbmUgY2hpbGRyZW4gYXJyYXkgdG8gYXZvaWQgbXV0YXRpbmcgb3JpZ2luYWwgaW4gY2FzZSBvZiBjbG9uaW5nCiAgICAgIC8vIGEgY2hpbGQuCiAgICAgIHZub2RlLmNoaWxkcmVuICYmIHZub2RlLmNoaWxkcmVuLnNsaWNlKCksCiAgICAgIHZub2RlLnRleHQsCiAgICAgIHZub2RlLmVsbSwKICAgICAgdm5vZGUuY29udGV4dCwKICAgICAgdm5vZGUuY29tcG9uZW50T3B0aW9ucywKICAgICAgdm5vZGUuYXN5bmNGYWN0b3J5CiAgICApOwogICAgY2xvbmVkLm5zID0gdm5vZGUubnM7CiAgICBjbG9uZWQuaXNTdGF0aWMgPSB2bm9kZS5pc1N0YXRpYzsKICAgIGNsb25lZC5rZXkgPSB2bm9kZS5rZXk7CiAgICBjbG9uZWQuaXNDb21tZW50ID0gdm5vZGUuaXNDb21tZW50OwogICAgY2xvbmVkLmZuQ29udGV4dCA9IHZub2RlLmZuQ29udGV4dDsKICAgIGNsb25lZC5mbk9wdGlvbnMgPSB2bm9kZS5mbk9wdGlvbnM7CiAgICBjbG9uZWQuZm5TY29wZUlkID0gdm5vZGUuZm5TY29wZUlkOwogICAgY2xvbmVkLmFzeW5jTWV0YSA9IHZub2RlLmFzeW5jTWV0YTsKICAgIGNsb25lZC5pc0Nsb25lZCA9IHRydWU7CiAgICByZXR1cm4gY2xvbmVkCiAgfQoKICAvKgogICAqIG5vdCB0eXBlIGNoZWNraW5nIHRoaXMgZmlsZSBiZWNhdXNlIGZsb3cgZG9lc24ndCBwbGF5IHdlbGwgd2l0aAogICAqIGR5bmFtaWNhbGx5IGFjY2Vzc2luZyBtZXRob2RzIG9uIEFycmF5IHByb3RvdHlwZQogICAqLwoKICB2YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsKICB2YXIgYXJyYXlNZXRob2RzID0gT2JqZWN0LmNyZWF0ZShhcnJheVByb3RvKTsKCiAgdmFyIG1ldGhvZHNUb1BhdGNoID0gWwogICAgJ3B1c2gnLAogICAgJ3BvcCcsCiAgICAnc2hpZnQnLAogICAgJ3Vuc2hpZnQnLAogICAgJ3NwbGljZScsCiAgICAnc29ydCcsCiAgICAncmV2ZXJzZScKICBdOwoKICAvKioKICAgKiBJbnRlcmNlcHQgbXV0YXRpbmcgbWV0aG9kcyBhbmQgZW1pdCBldmVudHMKICAgKi8KICBtZXRob2RzVG9QYXRjaC5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHsKICAgIC8vIGNhY2hlIG9yaWdpbmFsIG1ldGhvZAogICAgdmFyIG9yaWdpbmFsID0gYXJyYXlQcm90b1ttZXRob2RdOwogICAgZGVmKGFycmF5TWV0aG9kcywgbWV0aG9kLCBmdW5jdGlvbiBtdXRhdG9yICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKCiAgICAgIHZhciByZXN1bHQgPSBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgdmFyIG9iID0gdGhpcy5fX29iX187CiAgICAgIHZhciBpbnNlcnRlZDsKICAgICAgc3dpdGNoIChtZXRob2QpIHsKICAgICAgICBjYXNlICdwdXNoJzoKICAgICAgICBjYXNlICd1bnNoaWZ0JzoKICAgICAgICAgIGluc2VydGVkID0gYXJnczsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnc3BsaWNlJzoKICAgICAgICAgIGluc2VydGVkID0gYXJncy5zbGljZSgyKTsKICAgICAgICAgIGJyZWFrCiAgICAgIH0KICAgICAgaWYgKGluc2VydGVkKSB7IG9iLm9ic2VydmVBcnJheShpbnNlcnRlZCk7IH0KICAgICAgLy8gbm90aWZ5IGNoYW5nZQogICAgICBvYi5kZXAubm90aWZ5KCk7CiAgICAgIHJldHVybiByZXN1bHQKICAgIH0pOwogIH0pOwoKICAvKiAgKi8KCiAgdmFyIGFycmF5S2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGFycmF5TWV0aG9kcyk7CgogIC8qKgogICAqIEluIHNvbWUgY2FzZXMgd2UgbWF5IHdhbnQgdG8gZGlzYWJsZSBvYnNlcnZhdGlvbiBpbnNpZGUgYSBjb21wb25lbnQncwogICAqIHVwZGF0ZSBjb21wdXRhdGlvbi4KICAgKi8KICB2YXIgc2hvdWxkT2JzZXJ2ZSA9IHRydWU7CgogIGZ1bmN0aW9uIHRvZ2dsZU9ic2VydmluZyAodmFsdWUpIHsKICAgIHNob3VsZE9ic2VydmUgPSB2YWx1ZTsKICB9CgogIC8qKgogICAqIE9ic2VydmVyIGNsYXNzIHRoYXQgaXMgYXR0YWNoZWQgdG8gZWFjaCBvYnNlcnZlZAogICAqIG9iamVjdC4gT25jZSBhdHRhY2hlZCwgdGhlIG9ic2VydmVyIGNvbnZlcnRzIHRoZSB0YXJnZXQKICAgKiBvYmplY3QncyBwcm9wZXJ0eSBrZXlzIGludG8gZ2V0dGVyL3NldHRlcnMgdGhhdAogICAqIGNvbGxlY3QgZGVwZW5kZW5jaWVzIGFuZCBkaXNwYXRjaCB1cGRhdGVzLgogICAqLwogIHZhciBPYnNlcnZlciA9IGZ1bmN0aW9uIE9ic2VydmVyICh2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgdGhpcy5kZXAgPSBuZXcgRGVwKCk7CiAgICB0aGlzLnZtQ291bnQgPSAwOwogICAgZGVmKHZhbHVlLCAnX19vYl9fJywgdGhpcyk7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgaWYgKGhhc1Byb3RvKSB7CiAgICAgICAgcHJvdG9BdWdtZW50KHZhbHVlLCBhcnJheU1ldGhvZHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvcHlBdWdtZW50KHZhbHVlLCBhcnJheU1ldGhvZHMsIGFycmF5S2V5cyk7CiAgICAgIH0KICAgICAgdGhpcy5vYnNlcnZlQXJyYXkodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy53YWxrKHZhbHVlKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBXYWxrIHRocm91Z2ggYWxsIHByb3BlcnRpZXMgYW5kIGNvbnZlcnQgdGhlbSBpbnRvCiAgICogZ2V0dGVyL3NldHRlcnMuIFRoaXMgbWV0aG9kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuCiAgICogdmFsdWUgdHlwZSBpcyBPYmplY3QuCiAgICovCiAgT2JzZXJ2ZXIucHJvdG90eXBlLndhbGsgPSBmdW5jdGlvbiB3YWxrIChvYmopIHsKICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICBkZWZpbmVSZWFjdGl2ZSQkMShvYmosIGtleXNbaV0pOwogICAgfQogIH07CgogIC8qKgogICAqIE9ic2VydmUgYSBsaXN0IG9mIEFycmF5IGl0ZW1zLgogICAqLwogIE9ic2VydmVyLnByb3RvdHlwZS5vYnNlcnZlQXJyYXkgPSBmdW5jdGlvbiBvYnNlcnZlQXJyYXkgKGl0ZW1zKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGl0ZW1zLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBvYnNlcnZlKGl0ZW1zW2ldKTsKICAgIH0KICB9OwoKICAvLyBoZWxwZXJzCgogIC8qKgogICAqIEF1Z21lbnQgYSB0YXJnZXQgT2JqZWN0IG9yIEFycmF5IGJ5IGludGVyY2VwdGluZwogICAqIHRoZSBwcm90b3R5cGUgY2hhaW4gdXNpbmcgX19wcm90b19fCiAgICovCiAgZnVuY3Rpb24gcHJvdG9BdWdtZW50ICh0YXJnZXQsIHNyYykgewogICAgLyogZXNsaW50LWRpc2FibGUgbm8tcHJvdG8gKi8KICAgIHRhcmdldC5fX3Byb3RvX18gPSBzcmM7CiAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXByb3RvICovCiAgfQoKICAvKioKICAgKiBBdWdtZW50IGEgdGFyZ2V0IE9iamVjdCBvciBBcnJheSBieSBkZWZpbmluZwogICAqIGhpZGRlbiBwcm9wZXJ0aWVzLgogICAqLwogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gY29weUF1Z21lbnQgKHRhcmdldCwgc3JjLCBrZXlzKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICBkZWYodGFyZ2V0LCBrZXksIHNyY1trZXldKTsKICAgIH0KICB9CgogIC8qKgogICAqIEF0dGVtcHQgdG8gY3JlYXRlIGFuIG9ic2VydmVyIGluc3RhbmNlIGZvciBhIHZhbHVlLAogICAqIHJldHVybnMgdGhlIG5ldyBvYnNlcnZlciBpZiBzdWNjZXNzZnVsbHkgb2JzZXJ2ZWQsCiAgICogb3IgdGhlIGV4aXN0aW5nIG9ic2VydmVyIGlmIHRoZSB2YWx1ZSBhbHJlYWR5IGhhcyBvbmUuCiAgICovCiAgZnVuY3Rpb24gb2JzZXJ2ZSAodmFsdWUsIGFzUm9vdERhdGEpIHsKICAgIGlmICghaXNPYmplY3QodmFsdWUpIHx8IHZhbHVlIGluc3RhbmNlb2YgVk5vZGUpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgb2I7CiAgICBpZiAoaGFzT3duKHZhbHVlLCAnX19vYl9fJykgJiYgdmFsdWUuX19vYl9fIGluc3RhbmNlb2YgT2JzZXJ2ZXIpIHsKICAgICAgb2IgPSB2YWx1ZS5fX29iX187CiAgICB9IGVsc2UgaWYgKAogICAgICBzaG91bGRPYnNlcnZlICYmCiAgICAgICFpc1NlcnZlclJlbmRlcmluZygpICYmCiAgICAgIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBpc1BsYWluT2JqZWN0KHZhbHVlKSkgJiYKICAgICAgT2JqZWN0LmlzRXh0ZW5zaWJsZSh2YWx1ZSkgJiYKICAgICAgIXZhbHVlLl9pc1Z1ZQogICAgKSB7CiAgICAgIG9iID0gbmV3IE9ic2VydmVyKHZhbHVlKTsKICAgIH0KICAgIGlmIChhc1Jvb3REYXRhICYmIG9iKSB7CiAgICAgIG9iLnZtQ291bnQrKzsKICAgIH0KICAgIHJldHVybiBvYgogIH0KCiAgLyoqCiAgICogRGVmaW5lIGEgcmVhY3RpdmUgcHJvcGVydHkgb24gYW4gT2JqZWN0LgogICAqLwogIGZ1bmN0aW9uIGRlZmluZVJlYWN0aXZlJCQxICgKICAgIG9iaiwKICAgIGtleSwKICAgIHZhbCwKICAgIGN1c3RvbVNldHRlciwKICAgIHNoYWxsb3cKICApIHsKICAgIHZhciBkZXAgPSBuZXcgRGVwKCk7CgogICAgdmFyIHByb3BlcnR5ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSk7CiAgICBpZiAocHJvcGVydHkgJiYgcHJvcGVydHkuY29uZmlndXJhYmxlID09PSBmYWxzZSkgewogICAgICByZXR1cm4KICAgIH0KCiAgICAvLyBjYXRlciBmb3IgcHJlLWRlZmluZWQgZ2V0dGVyL3NldHRlcnMKICAgIHZhciBnZXR0ZXIgPSBwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5nZXQ7CiAgICB2YXIgc2V0dGVyID0gcHJvcGVydHkgJiYgcHJvcGVydHkuc2V0OwogICAgaWYgKCghZ2V0dGVyIHx8IHNldHRlcikgJiYgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICB2YWwgPSBvYmpba2V5XTsKICAgIH0KCiAgICB2YXIgY2hpbGRPYiA9ICFzaGFsbG93ICYmIG9ic2VydmUodmFsKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gcmVhY3RpdmVHZXR0ZXIgKCkgewogICAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWw7CiAgICAgICAgaWYgKERlcC50YXJnZXQpIHsKICAgICAgICAgIGRlcC5kZXBlbmQoKTsKICAgICAgICAgIGlmIChjaGlsZE9iKSB7CiAgICAgICAgICAgIGNoaWxkT2IuZGVwLmRlcGVuZCgpOwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgICAgICBkZXBlbmRBcnJheSh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gcmVhY3RpdmVTZXR0ZXIgKG5ld1ZhbCkgewogICAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWw7CiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tc2VsZi1jb21wYXJlICovCiAgICAgICAgaWYgKG5ld1ZhbCA9PT0gdmFsdWUgfHwgKG5ld1ZhbCAhPT0gbmV3VmFsICYmIHZhbHVlICE9PSB2YWx1ZSkpIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXNlbGYtY29tcGFyZSAqLwogICAgICAgIGlmIChjdXN0b21TZXR0ZXIpIHsKICAgICAgICAgIGN1c3RvbVNldHRlcigpOwogICAgICAgIH0KICAgICAgICAvLyAjNzk4MTogZm9yIGFjY2Vzc29yIHByb3BlcnRpZXMgd2l0aG91dCBzZXR0ZXIKICAgICAgICBpZiAoZ2V0dGVyICYmICFzZXR0ZXIpIHsgcmV0dXJuIH0KICAgICAgICBpZiAoc2V0dGVyKSB7CiAgICAgICAgICBzZXR0ZXIuY2FsbChvYmosIG5ld1ZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbCA9IG5ld1ZhbDsKICAgICAgICB9CiAgICAgICAgY2hpbGRPYiA9ICFzaGFsbG93ICYmIG9ic2VydmUobmV3VmFsKTsKICAgICAgICBkZXAubm90aWZ5KCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLyoqCiAgICogU2V0IGEgcHJvcGVydHkgb24gYW4gb2JqZWN0LiBBZGRzIHRoZSBuZXcgcHJvcGVydHkgYW5kCiAgICogdHJpZ2dlcnMgY2hhbmdlIG5vdGlmaWNhdGlvbiBpZiB0aGUgcHJvcGVydHkgZG9lc24ndAogICAqIGFscmVhZHkgZXhpc3QuCiAgICovCiAgZnVuY3Rpb24gc2V0ICh0YXJnZXQsIGtleSwgdmFsKSB7CiAgICBpZiAoaXNVbmRlZih0YXJnZXQpIHx8IGlzUHJpbWl0aXZlKHRhcmdldCkKICAgICkgewogICAgICB3YXJuKCgiQ2Fubm90IHNldCByZWFjdGl2ZSBwcm9wZXJ0eSBvbiB1bmRlZmluZWQsIG51bGwsIG9yIHByaW1pdGl2ZSB2YWx1ZTogIiArICgodGFyZ2V0KSkpKTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHRhcmdldCkgJiYgaXNWYWxpZEFycmF5SW5kZXgoa2V5KSkgewogICAgICB0YXJnZXQubGVuZ3RoID0gTWF0aC5tYXgodGFyZ2V0Lmxlbmd0aCwga2V5KTsKICAgICAgdGFyZ2V0LnNwbGljZShrZXksIDEsIHZhbCk7CiAgICAgIHJldHVybiB2YWwKICAgIH0KICAgIGlmIChrZXkgaW4gdGFyZ2V0ICYmICEoa2V5IGluIE9iamVjdC5wcm90b3R5cGUpKSB7CiAgICAgIHRhcmdldFtrZXldID0gdmFsOwogICAgICByZXR1cm4gdmFsCiAgICB9CiAgICB2YXIgb2IgPSAodGFyZ2V0KS5fX29iX187CiAgICBpZiAodGFyZ2V0Ll9pc1Z1ZSB8fCAob2IgJiYgb2Iudm1Db3VudCkpIHsKICAgICAgd2FybigKICAgICAgICAnQXZvaWQgYWRkaW5nIHJlYWN0aXZlIHByb3BlcnRpZXMgdG8gYSBWdWUgaW5zdGFuY2Ugb3IgaXRzIHJvb3QgJGRhdGEgJyArCiAgICAgICAgJ2F0IHJ1bnRpbWUgLSBkZWNsYXJlIGl0IHVwZnJvbnQgaW4gdGhlIGRhdGEgb3B0aW9uLicKICAgICAgKTsKICAgICAgcmV0dXJuIHZhbAogICAgfQogICAgaWYgKCFvYikgewogICAgICB0YXJnZXRba2V5XSA9IHZhbDsKICAgICAgcmV0dXJuIHZhbAogICAgfQogICAgZGVmaW5lUmVhY3RpdmUkJDEob2IudmFsdWUsIGtleSwgdmFsKTsKICAgIG9iLmRlcC5ub3RpZnkoKTsKICAgIHJldHVybiB2YWwKICB9CgogIC8qKgogICAqIERlbGV0ZSBhIHByb3BlcnR5IGFuZCB0cmlnZ2VyIGNoYW5nZSBpZiBuZWNlc3NhcnkuCiAgICovCiAgZnVuY3Rpb24gZGVsICh0YXJnZXQsIGtleSkgewogICAgaWYgKGlzVW5kZWYodGFyZ2V0KSB8fCBpc1ByaW1pdGl2ZSh0YXJnZXQpCiAgICApIHsKICAgICAgd2FybigoIkNhbm5vdCBkZWxldGUgcmVhY3RpdmUgcHJvcGVydHkgb24gdW5kZWZpbmVkLCBudWxsLCBvciBwcmltaXRpdmUgdmFsdWU6ICIgKyAoKHRhcmdldCkpKSk7CiAgICB9CiAgICBpZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpICYmIGlzVmFsaWRBcnJheUluZGV4KGtleSkpIHsKICAgICAgdGFyZ2V0LnNwbGljZShrZXksIDEpOwogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBvYiA9ICh0YXJnZXQpLl9fb2JfXzsKICAgIGlmICh0YXJnZXQuX2lzVnVlIHx8IChvYiAmJiBvYi52bUNvdW50KSkgewogICAgICB3YXJuKAogICAgICAgICdBdm9pZCBkZWxldGluZyBwcm9wZXJ0aWVzIG9uIGEgVnVlIGluc3RhbmNlIG9yIGl0cyByb290ICRkYXRhICcgKwogICAgICAgICctIGp1c3Qgc2V0IGl0IHRvIG51bGwuJwogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIGlmICghaGFzT3duKHRhcmdldCwga2V5KSkgewogICAgICByZXR1cm4KICAgIH0KICAgIGRlbGV0ZSB0YXJnZXRba2V5XTsKICAgIGlmICghb2IpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICBvYi5kZXAubm90aWZ5KCk7CiAgfQoKICAvKioKICAgKiBDb2xsZWN0IGRlcGVuZGVuY2llcyBvbiBhcnJheSBlbGVtZW50cyB3aGVuIHRoZSBhcnJheSBpcyB0b3VjaGVkLCBzaW5jZQogICAqIHdlIGNhbm5vdCBpbnRlcmNlcHQgYXJyYXkgZWxlbWVudCBhY2Nlc3MgbGlrZSBwcm9wZXJ0eSBnZXR0ZXJzLgogICAqLwogIGZ1bmN0aW9uIGRlcGVuZEFycmF5ICh2YWx1ZSkgewogICAgZm9yICh2YXIgZSA9ICh2b2lkIDApLCBpID0gMCwgbCA9IHZhbHVlLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBlID0gdmFsdWVbaV07CiAgICAgIGUgJiYgZS5fX29iX18gJiYgZS5fX29iX18uZGVwLmRlcGVuZCgpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShlKSkgewogICAgICAgIGRlcGVuZEFycmF5KGUpOwogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogT3B0aW9uIG92ZXJ3cml0aW5nIHN0cmF0ZWdpZXMgYXJlIGZ1bmN0aW9ucyB0aGF0IGhhbmRsZQogICAqIGhvdyB0byBtZXJnZSBhIHBhcmVudCBvcHRpb24gdmFsdWUgYW5kIGEgY2hpbGQgb3B0aW9uCiAgICogdmFsdWUgaW50byB0aGUgZmluYWwgdmFsdWUuCiAgICovCiAgdmFyIHN0cmF0cyA9IGNvbmZpZy5vcHRpb25NZXJnZVN0cmF0ZWdpZXM7CgogIC8qKgogICAqIE9wdGlvbnMgd2l0aCByZXN0cmljdGlvbnMKICAgKi8KICB7CiAgICBzdHJhdHMuZWwgPSBzdHJhdHMucHJvcHNEYXRhID0gZnVuY3Rpb24gKHBhcmVudCwgY2hpbGQsIHZtLCBrZXkpIHsKICAgICAgaWYgKCF2bSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAib3B0aW9uIFwiIiArIGtleSArICJcIiBjYW4gb25seSBiZSB1c2VkIGR1cmluZyBpbnN0YW5jZSAiICsKICAgICAgICAgICdjcmVhdGlvbiB3aXRoIHRoZSBgbmV3YCBrZXl3b3JkLicKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiBkZWZhdWx0U3RyYXQocGFyZW50LCBjaGlsZCkKICAgIH07CiAgfQoKICAvKioKICAgKiBIZWxwZXIgdGhhdCByZWN1cnNpdmVseSBtZXJnZXMgdHdvIGRhdGEgb2JqZWN0cyB0b2dldGhlci4KICAgKi8KICBmdW5jdGlvbiBtZXJnZURhdGEgKHRvLCBmcm9tKSB7CiAgICBpZiAoIWZyb20pIHsgcmV0dXJuIHRvIH0KICAgIHZhciBrZXksIHRvVmFsLCBmcm9tVmFsOwoKICAgIHZhciBrZXlzID0gaGFzU3ltYm9sCiAgICAgID8gUmVmbGVjdC5vd25LZXlzKGZyb20pCiAgICAgIDogT2JqZWN0LmtleXMoZnJvbSk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGtleSA9IGtleXNbaV07CiAgICAgIC8vIGluIGNhc2UgdGhlIG9iamVjdCBpcyBhbHJlYWR5IG9ic2VydmVkLi4uCiAgICAgIGlmIChrZXkgPT09ICdfX29iX18nKSB7IGNvbnRpbnVlIH0KICAgICAgdG9WYWwgPSB0b1trZXldOwogICAgICBmcm9tVmFsID0gZnJvbVtrZXldOwogICAgICBpZiAoIWhhc093bih0bywga2V5KSkgewogICAgICAgIHNldCh0bywga2V5LCBmcm9tVmFsKTsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB0b1ZhbCAhPT0gZnJvbVZhbCAmJgogICAgICAgIGlzUGxhaW5PYmplY3QodG9WYWwpICYmCiAgICAgICAgaXNQbGFpbk9iamVjdChmcm9tVmFsKQogICAgICApIHsKICAgICAgICBtZXJnZURhdGEodG9WYWwsIGZyb21WYWwpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdG8KICB9CgogIC8qKgogICAqIERhdGEKICAgKi8KICBmdW5jdGlvbiBtZXJnZURhdGFPckZuICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0KICApIHsKICAgIGlmICghdm0pIHsKICAgICAgLy8gaW4gYSBWdWUuZXh0ZW5kIG1lcmdlLCBib3RoIHNob3VsZCBiZSBmdW5jdGlvbnMKICAgICAgaWYgKCFjaGlsZFZhbCkgewogICAgICAgIHJldHVybiBwYXJlbnRWYWwKICAgICAgfQogICAgICBpZiAoIXBhcmVudFZhbCkgewogICAgICAgIHJldHVybiBjaGlsZFZhbAogICAgICB9CiAgICAgIC8vIHdoZW4gcGFyZW50VmFsICYgY2hpbGRWYWwgYXJlIGJvdGggcHJlc2VudCwKICAgICAgLy8gd2UgbmVlZCB0byByZXR1cm4gYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlCiAgICAgIC8vIG1lcmdlZCByZXN1bHQgb2YgYm90aCBmdW5jdGlvbnMuLi4gbm8gbmVlZCB0bwogICAgICAvLyBjaGVjayBpZiBwYXJlbnRWYWwgaXMgYSBmdW5jdGlvbiBoZXJlIGJlY2F1c2UKICAgICAgLy8gaXQgaGFzIHRvIGJlIGEgZnVuY3Rpb24gdG8gcGFzcyBwcmV2aW91cyBtZXJnZXMuCiAgICAgIHJldHVybiBmdW5jdGlvbiBtZXJnZWREYXRhRm4gKCkgewogICAgICAgIHJldHVybiBtZXJnZURhdGEoCiAgICAgICAgICB0eXBlb2YgY2hpbGRWYWwgPT09ICdmdW5jdGlvbicgPyBjaGlsZFZhbC5jYWxsKHRoaXMsIHRoaXMpIDogY2hpbGRWYWwsCiAgICAgICAgICB0eXBlb2YgcGFyZW50VmFsID09PSAnZnVuY3Rpb24nID8gcGFyZW50VmFsLmNhbGwodGhpcywgdGhpcykgOiBwYXJlbnRWYWwKICAgICAgICApCiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiBtZXJnZWRJbnN0YW5jZURhdGFGbiAoKSB7CiAgICAgICAgLy8gaW5zdGFuY2UgbWVyZ2UKICAgICAgICB2YXIgaW5zdGFuY2VEYXRhID0gdHlwZW9mIGNoaWxkVmFsID09PSAnZnVuY3Rpb24nCiAgICAgICAgICA/IGNoaWxkVmFsLmNhbGwodm0sIHZtKQogICAgICAgICAgOiBjaGlsZFZhbDsKICAgICAgICB2YXIgZGVmYXVsdERhdGEgPSB0eXBlb2YgcGFyZW50VmFsID09PSAnZnVuY3Rpb24nCiAgICAgICAgICA/IHBhcmVudFZhbC5jYWxsKHZtLCB2bSkKICAgICAgICAgIDogcGFyZW50VmFsOwogICAgICAgIGlmIChpbnN0YW5jZURhdGEpIHsKICAgICAgICAgIHJldHVybiBtZXJnZURhdGEoaW5zdGFuY2VEYXRhLCBkZWZhdWx0RGF0YSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGRlZmF1bHREYXRhCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBzdHJhdHMuZGF0YSA9IGZ1bmN0aW9uICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0KICApIHsKICAgIGlmICghdm0pIHsKICAgICAgaWYgKGNoaWxkVmFsICYmIHR5cGVvZiBjaGlsZFZhbCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHdhcm4oCiAgICAgICAgICAnVGhlICJkYXRhIiBvcHRpb24gc2hvdWxkIGJlIGEgZnVuY3Rpb24gJyArCiAgICAgICAgICAndGhhdCByZXR1cm5zIGEgcGVyLWluc3RhbmNlIHZhbHVlIGluIGNvbXBvbmVudCAnICsKICAgICAgICAgICdkZWZpbml0aW9ucy4nLAogICAgICAgICAgdm0KICAgICAgICApOwoKICAgICAgICByZXR1cm4gcGFyZW50VmFsCiAgICAgIH0KICAgICAgcmV0dXJuIG1lcmdlRGF0YU9yRm4ocGFyZW50VmFsLCBjaGlsZFZhbCkKICAgIH0KCiAgICByZXR1cm4gbWVyZ2VEYXRhT3JGbihwYXJlbnRWYWwsIGNoaWxkVmFsLCB2bSkKICB9OwoKICAvKioKICAgKiBIb29rcyBhbmQgcHJvcHMgYXJlIG1lcmdlZCBhcyBhcnJheXMuCiAgICovCiAgZnVuY3Rpb24gbWVyZ2VIb29rICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsCiAgKSB7CiAgICB2YXIgcmVzID0gY2hpbGRWYWwKICAgICAgPyBwYXJlbnRWYWwKICAgICAgICA/IHBhcmVudFZhbC5jb25jYXQoY2hpbGRWYWwpCiAgICAgICAgOiBBcnJheS5pc0FycmF5KGNoaWxkVmFsKQogICAgICAgICAgPyBjaGlsZFZhbAogICAgICAgICAgOiBbY2hpbGRWYWxdCiAgICAgIDogcGFyZW50VmFsOwogICAgcmV0dXJuIHJlcwogICAgICA/IGRlZHVwZUhvb2tzKHJlcykKICAgICAgOiByZXMKICB9CgogIGZ1bmN0aW9uIGRlZHVwZUhvb2tzIChob29rcykgewogICAgdmFyIHJlcyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAocmVzLmluZGV4T2YoaG9va3NbaV0pID09PSAtMSkgewogICAgICAgIHJlcy5wdXNoKGhvb2tzW2ldKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgTElGRUNZQ0xFX0hPT0tTLmZvckVhY2goZnVuY3Rpb24gKGhvb2spIHsKICAgIHN0cmF0c1tob29rXSA9IG1lcmdlSG9vazsKICB9KTsKCiAgLyoqCiAgICogQXNzZXRzCiAgICoKICAgKiBXaGVuIGEgdm0gaXMgcHJlc2VudCAoaW5zdGFuY2UgY3JlYXRpb24pLCB3ZSBuZWVkIHRvIGRvCiAgICogYSB0aHJlZS13YXkgbWVyZ2UgYmV0d2VlbiBjb25zdHJ1Y3RvciBvcHRpb25zLCBpbnN0YW5jZQogICAqIG9wdGlvbnMgYW5kIHBhcmVudCBvcHRpb25zLgogICAqLwogIGZ1bmN0aW9uIG1lcmdlQXNzZXRzICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0sCiAgICBrZXkKICApIHsKICAgIHZhciByZXMgPSBPYmplY3QuY3JlYXRlKHBhcmVudFZhbCB8fCBudWxsKTsKICAgIGlmIChjaGlsZFZhbCkgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgICAgcmV0dXJuIGV4dGVuZChyZXMsIGNoaWxkVmFsKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHJlcwogICAgfQogIH0KCiAgQVNTRVRfVFlQRVMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgc3RyYXRzW3R5cGUgKyAncyddID0gbWVyZ2VBc3NldHM7CiAgfSk7CgogIC8qKgogICAqIFdhdGNoZXJzLgogICAqCiAgICogV2F0Y2hlcnMgaGFzaGVzIHNob3VsZCBub3Qgb3ZlcndyaXRlIG9uZQogICAqIGFub3RoZXIsIHNvIHdlIG1lcmdlIHRoZW0gYXMgYXJyYXlzLgogICAqLwogIHN0cmF0cy53YXRjaCA9IGZ1bmN0aW9uICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0sCiAgICBrZXkKICApIHsKICAgIC8vIHdvcmsgYXJvdW5kIEZpcmVmb3gncyBPYmplY3QucHJvdG90eXBlLndhdGNoLi4uCiAgICBpZiAocGFyZW50VmFsID09PSBuYXRpdmVXYXRjaCkgeyBwYXJlbnRWYWwgPSB1bmRlZmluZWQ7IH0KICAgIGlmIChjaGlsZFZhbCA9PT0gbmF0aXZlV2F0Y2gpIHsgY2hpbGRWYWwgPSB1bmRlZmluZWQ7IH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKCFjaGlsZFZhbCkgeyByZXR1cm4gT2JqZWN0LmNyZWF0ZShwYXJlbnRWYWwgfHwgbnVsbCkgfQogICAgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgIH0KICAgIGlmICghcGFyZW50VmFsKSB7IHJldHVybiBjaGlsZFZhbCB9CiAgICB2YXIgcmV0ID0ge307CiAgICBleHRlbmQocmV0LCBwYXJlbnRWYWwpOwogICAgZm9yICh2YXIga2V5JDEgaW4gY2hpbGRWYWwpIHsKICAgICAgdmFyIHBhcmVudCA9IHJldFtrZXkkMV07CiAgICAgIHZhciBjaGlsZCA9IGNoaWxkVmFsW2tleSQxXTsKICAgICAgaWYgKHBhcmVudCAmJiAhQXJyYXkuaXNBcnJheShwYXJlbnQpKSB7CiAgICAgICAgcGFyZW50ID0gW3BhcmVudF07CiAgICAgIH0KICAgICAgcmV0W2tleSQxXSA9IHBhcmVudAogICAgICAgID8gcGFyZW50LmNvbmNhdChjaGlsZCkKICAgICAgICA6IEFycmF5LmlzQXJyYXkoY2hpbGQpID8gY2hpbGQgOiBbY2hpbGRdOwogICAgfQogICAgcmV0dXJuIHJldAogIH07CgogIC8qKgogICAqIE90aGVyIG9iamVjdCBoYXNoZXMuCiAgICovCiAgc3RyYXRzLnByb3BzID0KICBzdHJhdHMubWV0aG9kcyA9CiAgc3RyYXRzLmluamVjdCA9CiAgc3RyYXRzLmNvbXB1dGVkID0gZnVuY3Rpb24gKAogICAgcGFyZW50VmFsLAogICAgY2hpbGRWYWwsCiAgICB2bSwKICAgIGtleQogICkgewogICAgaWYgKGNoaWxkVmFsICYmICJkZXZlbG9wbWVudCIgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgIH0KICAgIGlmICghcGFyZW50VmFsKSB7IHJldHVybiBjaGlsZFZhbCB9CiAgICB2YXIgcmV0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGV4dGVuZChyZXQsIHBhcmVudFZhbCk7CiAgICBpZiAoY2hpbGRWYWwpIHsgZXh0ZW5kKHJldCwgY2hpbGRWYWwpOyB9CiAgICByZXR1cm4gcmV0CiAgfTsKICBzdHJhdHMucHJvdmlkZSA9IG1lcmdlRGF0YU9yRm47CgogIC8qKgogICAqIERlZmF1bHQgc3RyYXRlZ3kuCiAgICovCiAgdmFyIGRlZmF1bHRTdHJhdCA9IGZ1bmN0aW9uIChwYXJlbnRWYWwsIGNoaWxkVmFsKSB7CiAgICByZXR1cm4gY2hpbGRWYWwgPT09IHVuZGVmaW5lZAogICAgICA/IHBhcmVudFZhbAogICAgICA6IGNoaWxkVmFsCiAgfTsKCiAgLyoqCiAgICogVmFsaWRhdGUgY29tcG9uZW50IG5hbWVzCiAgICovCiAgZnVuY3Rpb24gY2hlY2tDb21wb25lbnRzIChvcHRpb25zKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gb3B0aW9ucy5jb21wb25lbnRzKSB7CiAgICAgIHZhbGlkYXRlQ29tcG9uZW50TmFtZShrZXkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdmFsaWRhdGVDb21wb25lbnROYW1lIChuYW1lKSB7CiAgICBpZiAoIW5ldyBSZWdFeHAoKCJeW2EtekEtWl1bXFwtXFwuMC05XyIgKyAodW5pY29kZVJlZ0V4cC5zb3VyY2UpICsgIl0qJCIpKS50ZXN0KG5hbWUpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgJ0ludmFsaWQgY29tcG9uZW50IG5hbWU6ICInICsgbmFtZSArICciLiBDb21wb25lbnQgbmFtZXMgJyArCiAgICAgICAgJ3Nob3VsZCBjb25mb3JtIHRvIHZhbGlkIGN1c3RvbSBlbGVtZW50IG5hbWUgaW4gaHRtbDUgc3BlY2lmaWNhdGlvbi4nCiAgICAgICk7CiAgICB9CiAgICBpZiAoaXNCdWlsdEluVGFnKG5hbWUpIHx8IGNvbmZpZy5pc1Jlc2VydmVkVGFnKG5hbWUpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgJ0RvIG5vdCB1c2UgYnVpbHQtaW4gb3IgcmVzZXJ2ZWQgSFRNTCBlbGVtZW50cyBhcyBjb21wb25lbnQgJyArCiAgICAgICAgJ2lkOiAnICsgbmFtZQogICAgICApOwogICAgfQogIH0KCiAgLyoqCiAgICogRW5zdXJlIGFsbCBwcm9wcyBvcHRpb24gc3ludGF4IGFyZSBub3JtYWxpemVkIGludG8gdGhlCiAgICogT2JqZWN0LWJhc2VkIGZvcm1hdC4KICAgKi8KICBmdW5jdGlvbiBub3JtYWxpemVQcm9wcyAob3B0aW9ucywgdm0pIHsKICAgIHZhciBwcm9wcyA9IG9wdGlvbnMucHJvcHM7CiAgICBpZiAoIXByb3BzKSB7IHJldHVybiB9CiAgICB2YXIgcmVzID0ge307CiAgICB2YXIgaSwgdmFsLCBuYW1lOwogICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcHMpKSB7CiAgICAgIGkgPSBwcm9wcy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2YWwgPSBwcm9wc1tpXTsKICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIG5hbWUgPSBjYW1lbGl6ZSh2YWwpOwogICAgICAgICAgcmVzW25hbWVdID0geyB0eXBlOiBudWxsIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdhcm4oJ3Byb3BzIG11c3QgYmUgc3RyaW5ncyB3aGVuIHVzaW5nIGFycmF5IHN5bnRheC4nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChwcm9wcykpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHByb3BzKSB7CiAgICAgICAgdmFsID0gcHJvcHNba2V5XTsKICAgICAgICBuYW1lID0gY2FtZWxpemUoa2V5KTsKICAgICAgICByZXNbbmFtZV0gPSBpc1BsYWluT2JqZWN0KHZhbCkKICAgICAgICAgID8gdmFsCiAgICAgICAgICA6IHsgdHlwZTogdmFsIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkludmFsaWQgdmFsdWUgZm9yIG9wdGlvbiBcInByb3BzXCI6IGV4cGVjdGVkIGFuIEFycmF5IG9yIGFuIE9iamVjdCwgIiArCiAgICAgICAgImJ1dCBnb3QgIiArICh0b1Jhd1R5cGUocHJvcHMpKSArICIuIiwKICAgICAgICB2bQogICAgICApOwogICAgfQogICAgb3B0aW9ucy5wcm9wcyA9IHJlczsKICB9CgogIC8qKgogICAqIE5vcm1hbGl6ZSBhbGwgaW5qZWN0aW9ucyBpbnRvIE9iamVjdC1iYXNlZCBmb3JtYXQKICAgKi8KICBmdW5jdGlvbiBub3JtYWxpemVJbmplY3QgKG9wdGlvbnMsIHZtKSB7CiAgICB2YXIgaW5qZWN0ID0gb3B0aW9ucy5pbmplY3Q7CiAgICBpZiAoIWluamVjdCkgeyByZXR1cm4gfQogICAgdmFyIG5vcm1hbGl6ZWQgPSBvcHRpb25zLmluamVjdCA9IHt9OwogICAgaWYgKEFycmF5LmlzQXJyYXkoaW5qZWN0KSkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluamVjdC5sZW5ndGg7IGkrKykgewogICAgICAgIG5vcm1hbGl6ZWRbaW5qZWN0W2ldXSA9IHsgZnJvbTogaW5qZWN0W2ldIH07CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChpbmplY3QpKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBpbmplY3QpIHsKICAgICAgICB2YXIgdmFsID0gaW5qZWN0W2tleV07CiAgICAgICAgbm9ybWFsaXplZFtrZXldID0gaXNQbGFpbk9iamVjdCh2YWwpCiAgICAgICAgICA/IGV4dGVuZCh7IGZyb206IGtleSB9LCB2YWwpCiAgICAgICAgICA6IHsgZnJvbTogdmFsIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkludmFsaWQgdmFsdWUgZm9yIG9wdGlvbiBcImluamVjdFwiOiBleHBlY3RlZCBhbiBBcnJheSBvciBhbiBPYmplY3QsICIgKwogICAgICAgICJidXQgZ290ICIgKyAodG9SYXdUeXBlKGluamVjdCkpICsgIi4iLAogICAgICAgIHZtCiAgICAgICk7CiAgICB9CiAgfQoKICAvKioKICAgKiBOb3JtYWxpemUgcmF3IGZ1bmN0aW9uIGRpcmVjdGl2ZXMgaW50byBvYmplY3QgZm9ybWF0LgogICAqLwogIGZ1bmN0aW9uIG5vcm1hbGl6ZURpcmVjdGl2ZXMgKG9wdGlvbnMpIHsKICAgIHZhciBkaXJzID0gb3B0aW9ucy5kaXJlY3RpdmVzOwogICAgaWYgKGRpcnMpIHsKICAgICAgZm9yICh2YXIga2V5IGluIGRpcnMpIHsKICAgICAgICB2YXIgZGVmJCQxID0gZGlyc1trZXldOwogICAgICAgIGlmICh0eXBlb2YgZGVmJCQxID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBkaXJzW2tleV0gPSB7IGJpbmQ6IGRlZiQkMSwgdXBkYXRlOiBkZWYkJDEgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFzc2VydE9iamVjdFR5cGUgKG5hbWUsIHZhbHVlLCB2bSkgewogICAgaWYgKCFpc1BsYWluT2JqZWN0KHZhbHVlKSkgewogICAgICB3YXJuKAogICAgICAgICJJbnZhbGlkIHZhbHVlIGZvciBvcHRpb24gXCIiICsgbmFtZSArICJcIjogZXhwZWN0ZWQgYW4gT2JqZWN0LCAiICsKICAgICAgICAiYnV0IGdvdCAiICsgKHRvUmF3VHlwZSh2YWx1ZSkpICsgIi4iLAogICAgICAgIHZtCiAgICAgICk7CiAgICB9CiAgfQoKICAvKioKICAgKiBNZXJnZSB0d28gb3B0aW9uIG9iamVjdHMgaW50byBhIG5ldyBvbmUuCiAgICogQ29yZSB1dGlsaXR5IHVzZWQgaW4gYm90aCBpbnN0YW50aWF0aW9uIGFuZCBpbmhlcml0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBtZXJnZU9wdGlvbnMgKAogICAgcGFyZW50LAogICAgY2hpbGQsCiAgICB2bQogICkgewogICAgewogICAgICBjaGVja0NvbXBvbmVudHMoY2hpbGQpOwogICAgfQoKICAgIGlmICh0eXBlb2YgY2hpbGQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgY2hpbGQgPSBjaGlsZC5vcHRpb25zOwogICAgfQoKICAgIG5vcm1hbGl6ZVByb3BzKGNoaWxkLCB2bSk7CiAgICBub3JtYWxpemVJbmplY3QoY2hpbGQsIHZtKTsKICAgIG5vcm1hbGl6ZURpcmVjdGl2ZXMoY2hpbGQpOwoKICAgIC8vIEFwcGx5IGV4dGVuZHMgYW5kIG1peGlucyBvbiB0aGUgY2hpbGQgb3B0aW9ucywKICAgIC8vIGJ1dCBvbmx5IGlmIGl0IGlzIGEgcmF3IG9wdGlvbnMgb2JqZWN0IHRoYXQgaXNuJ3QKICAgIC8vIHRoZSByZXN1bHQgb2YgYW5vdGhlciBtZXJnZU9wdGlvbnMgY2FsbC4KICAgIC8vIE9ubHkgbWVyZ2VkIG9wdGlvbnMgaGFzIHRoZSBfYmFzZSBwcm9wZXJ0eS4KICAgIGlmICghY2hpbGQuX2Jhc2UpIHsKICAgICAgaWYgKGNoaWxkLmV4dGVuZHMpIHsKICAgICAgICBwYXJlbnQgPSBtZXJnZU9wdGlvbnMocGFyZW50LCBjaGlsZC5leHRlbmRzLCB2bSk7CiAgICAgIH0KICAgICAgaWYgKGNoaWxkLm1peGlucykgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2hpbGQubWl4aW5zLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgcGFyZW50ID0gbWVyZ2VPcHRpb25zKHBhcmVudCwgY2hpbGQubWl4aW5zW2ldLCB2bSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIG9wdGlvbnMgPSB7fTsKICAgIHZhciBrZXk7CiAgICBmb3IgKGtleSBpbiBwYXJlbnQpIHsKICAgICAgbWVyZ2VGaWVsZChrZXkpOwogICAgfQogICAgZm9yIChrZXkgaW4gY2hpbGQpIHsKICAgICAgaWYgKCFoYXNPd24ocGFyZW50LCBrZXkpKSB7CiAgICAgICAgbWVyZ2VGaWVsZChrZXkpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBtZXJnZUZpZWxkIChrZXkpIHsKICAgICAgdmFyIHN0cmF0ID0gc3RyYXRzW2tleV0gfHwgZGVmYXVsdFN0cmF0OwogICAgICBvcHRpb25zW2tleV0gPSBzdHJhdChwYXJlbnRba2V5XSwgY2hpbGRba2V5XSwgdm0sIGtleSk7CiAgICB9CiAgICByZXR1cm4gb3B0aW9ucwogIH0KCiAgLyoqCiAgICogUmVzb2x2ZSBhbiBhc3NldC4KICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgYmVjYXVzZSBjaGlsZCBpbnN0YW5jZXMgbmVlZCBhY2Nlc3MKICAgKiB0byBhc3NldHMgZGVmaW5lZCBpbiBpdHMgYW5jZXN0b3IgY2hhaW4uCiAgICovCiAgZnVuY3Rpb24gcmVzb2x2ZUFzc2V0ICgKICAgIG9wdGlvbnMsCiAgICB0eXBlLAogICAgaWQsCiAgICB3YXJuTWlzc2luZwogICkgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAodHlwZW9mIGlkICE9PSAnc3RyaW5nJykgewogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBhc3NldHMgPSBvcHRpb25zW3R5cGVdOwogICAgLy8gY2hlY2sgbG9jYWwgcmVnaXN0cmF0aW9uIHZhcmlhdGlvbnMgZmlyc3QKICAgIGlmIChoYXNPd24oYXNzZXRzLCBpZCkpIHsgcmV0dXJuIGFzc2V0c1tpZF0gfQogICAgdmFyIGNhbWVsaXplZElkID0gY2FtZWxpemUoaWQpOwogICAgaWYgKGhhc093bihhc3NldHMsIGNhbWVsaXplZElkKSkgeyByZXR1cm4gYXNzZXRzW2NhbWVsaXplZElkXSB9CiAgICB2YXIgUGFzY2FsQ2FzZUlkID0gY2FwaXRhbGl6ZShjYW1lbGl6ZWRJZCk7CiAgICBpZiAoaGFzT3duKGFzc2V0cywgUGFzY2FsQ2FzZUlkKSkgeyByZXR1cm4gYXNzZXRzW1Bhc2NhbENhc2VJZF0gfQogICAgLy8gZmFsbGJhY2sgdG8gcHJvdG90eXBlIGNoYWluCiAgICB2YXIgcmVzID0gYXNzZXRzW2lkXSB8fCBhc3NldHNbY2FtZWxpemVkSWRdIHx8IGFzc2V0c1tQYXNjYWxDYXNlSWRdOwogICAgaWYgKHdhcm5NaXNzaW5nICYmICFyZXMpIHsKICAgICAgd2FybigKICAgICAgICAnRmFpbGVkIHRvIHJlc29sdmUgJyArIHR5cGUuc2xpY2UoMCwgLTEpICsgJzogJyArIGlkLAogICAgICAgIG9wdGlvbnMKICAgICAgKTsKICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIC8qICAqLwoKCgogIGZ1bmN0aW9uIHZhbGlkYXRlUHJvcCAoCiAgICBrZXksCiAgICBwcm9wT3B0aW9ucywKICAgIHByb3BzRGF0YSwKICAgIHZtCiAgKSB7CiAgICB2YXIgcHJvcCA9IHByb3BPcHRpb25zW2tleV07CiAgICB2YXIgYWJzZW50ID0gIWhhc093bihwcm9wc0RhdGEsIGtleSk7CiAgICB2YXIgdmFsdWUgPSBwcm9wc0RhdGFba2V5XTsKICAgIC8vIGJvb2xlYW4gY2FzdGluZwogICAgdmFyIGJvb2xlYW5JbmRleCA9IGdldFR5cGVJbmRleChCb29sZWFuLCBwcm9wLnR5cGUpOwogICAgaWYgKGJvb2xlYW5JbmRleCA+IC0xKSB7CiAgICAgIGlmIChhYnNlbnQgJiYgIWhhc093bihwcm9wLCAnZGVmYXVsdCcpKSB7CiAgICAgICAgdmFsdWUgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IGh5cGhlbmF0ZShrZXkpKSB7CiAgICAgICAgLy8gb25seSBjYXN0IGVtcHR5IHN0cmluZyAvIHNhbWUgbmFtZSB0byBib29sZWFuIGlmCiAgICAgICAgLy8gYm9vbGVhbiBoYXMgaGlnaGVyIHByaW9yaXR5CiAgICAgICAgdmFyIHN0cmluZ0luZGV4ID0gZ2V0VHlwZUluZGV4KFN0cmluZywgcHJvcC50eXBlKTsKICAgICAgICBpZiAoc3RyaW5nSW5kZXggPCAwIHx8IGJvb2xlYW5JbmRleCA8IHN0cmluZ0luZGV4KSB7CiAgICAgICAgICB2YWx1ZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyBjaGVjayBkZWZhdWx0IHZhbHVlCiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IGdldFByb3BEZWZhdWx0VmFsdWUodm0sIHByb3AsIGtleSk7CiAgICAgIC8vIHNpbmNlIHRoZSBkZWZhdWx0IHZhbHVlIGlzIGEgZnJlc2ggY29weSwKICAgICAgLy8gbWFrZSBzdXJlIHRvIG9ic2VydmUgaXQuCiAgICAgIHZhciBwcmV2U2hvdWxkT2JzZXJ2ZSA9IHNob3VsZE9ic2VydmU7CiAgICAgIHRvZ2dsZU9ic2VydmluZyh0cnVlKTsKICAgICAgb2JzZXJ2ZSh2YWx1ZSk7CiAgICAgIHRvZ2dsZU9ic2VydmluZyhwcmV2U2hvdWxkT2JzZXJ2ZSk7CiAgICB9CiAgICB7CiAgICAgIGFzc2VydFByb3AocHJvcCwga2V5LCB2YWx1ZSwgdm0sIGFic2VudCk7CiAgICB9CiAgICByZXR1cm4gdmFsdWUKICB9CgogIC8qKgogICAqIEdldCB0aGUgZGVmYXVsdCB2YWx1ZSBvZiBhIHByb3AuCiAgICovCiAgZnVuY3Rpb24gZ2V0UHJvcERlZmF1bHRWYWx1ZSAodm0sIHByb3AsIGtleSkgewogICAgLy8gbm8gZGVmYXVsdCwgcmV0dXJuIHVuZGVmaW5lZAogICAgaWYgKCFoYXNPd24ocHJvcCwgJ2RlZmF1bHQnKSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICB9CiAgICB2YXIgZGVmID0gcHJvcC5kZWZhdWx0OwogICAgLy8gd2FybiBhZ2FpbnN0IG5vbi1mYWN0b3J5IGRlZmF1bHRzIGZvciBPYmplY3QgJiBBcnJheQogICAgaWYgKGlzT2JqZWN0KGRlZikpIHsKICAgICAgd2FybigKICAgICAgICAnSW52YWxpZCBkZWZhdWx0IHZhbHVlIGZvciBwcm9wICInICsga2V5ICsgJyI6ICcgKwogICAgICAgICdQcm9wcyB3aXRoIHR5cGUgT2JqZWN0L0FycmF5IG11c3QgdXNlIGEgZmFjdG9yeSBmdW5jdGlvbiAnICsKICAgICAgICAndG8gcmV0dXJuIHRoZSBkZWZhdWx0IHZhbHVlLicsCiAgICAgICAgdm0KICAgICAgKTsKICAgIH0KICAgIC8vIHRoZSByYXcgcHJvcCB2YWx1ZSB3YXMgYWxzbyB1bmRlZmluZWQgZnJvbSBwcmV2aW91cyByZW5kZXIsCiAgICAvLyByZXR1cm4gcHJldmlvdXMgZGVmYXVsdCB2YWx1ZSB0byBhdm9pZCB1bm5lY2Vzc2FyeSB3YXRjaGVyIHRyaWdnZXIKICAgIGlmICh2bSAmJiB2bS4kb3B0aW9ucy5wcm9wc0RhdGEgJiYKICAgICAgdm0uJG9wdGlvbnMucHJvcHNEYXRhW2tleV0gPT09IHVuZGVmaW5lZCAmJgogICAgICB2bS5fcHJvcHNba2V5XSAhPT0gdW5kZWZpbmVkCiAgICApIHsKICAgICAgcmV0dXJuIHZtLl9wcm9wc1trZXldCiAgICB9CiAgICAvLyBjYWxsIGZhY3RvcnkgZnVuY3Rpb24gZm9yIG5vbi1GdW5jdGlvbiB0eXBlcwogICAgLy8gYSB2YWx1ZSBpcyBGdW5jdGlvbiBpZiBpdHMgcHJvdG90eXBlIGlzIGZ1bmN0aW9uIGV2ZW4gYWNyb3NzIGRpZmZlcmVudCBleGVjdXRpb24gY29udGV4dAogICAgcmV0dXJuIHR5cGVvZiBkZWYgPT09ICdmdW5jdGlvbicgJiYgZ2V0VHlwZShwcm9wLnR5cGUpICE9PSAnRnVuY3Rpb24nCiAgICAgID8gZGVmLmNhbGwodm0pCiAgICAgIDogZGVmCiAgfQoKICAvKioKICAgKiBBc3NlcnQgd2hldGhlciBhIHByb3AgaXMgdmFsaWQuCiAgICovCiAgZnVuY3Rpb24gYXNzZXJ0UHJvcCAoCiAgICBwcm9wLAogICAgbmFtZSwKICAgIHZhbHVlLAogICAgdm0sCiAgICBhYnNlbnQKICApIHsKICAgIGlmIChwcm9wLnJlcXVpcmVkICYmIGFic2VudCkgewogICAgICB3YXJuKAogICAgICAgICdNaXNzaW5nIHJlcXVpcmVkIHByb3A6ICInICsgbmFtZSArICciJywKICAgICAgICB2bQogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIGlmICh2YWx1ZSA9PSBudWxsICYmICFwcm9wLnJlcXVpcmVkKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIHR5cGUgPSBwcm9wLnR5cGU7CiAgICB2YXIgdmFsaWQgPSAhdHlwZSB8fCB0eXBlID09PSB0cnVlOwogICAgdmFyIGV4cGVjdGVkVHlwZXMgPSBbXTsKICAgIGlmICh0eXBlKSB7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0eXBlKSkgewogICAgICAgIHR5cGUgPSBbdHlwZV07CiAgICAgIH0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0eXBlLmxlbmd0aCAmJiAhdmFsaWQ7IGkrKykgewogICAgICAgIHZhciBhc3NlcnRlZFR5cGUgPSBhc3NlcnRUeXBlKHZhbHVlLCB0eXBlW2ldKTsKICAgICAgICBleHBlY3RlZFR5cGVzLnB1c2goYXNzZXJ0ZWRUeXBlLmV4cGVjdGVkVHlwZSB8fCAnJyk7CiAgICAgICAgdmFsaWQgPSBhc3NlcnRlZFR5cGUudmFsaWQ7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIXZhbGlkKSB7CiAgICAgIHdhcm4oCiAgICAgICAgZ2V0SW52YWxpZFR5cGVNZXNzYWdlKG5hbWUsIHZhbHVlLCBleHBlY3RlZFR5cGVzKSwKICAgICAgICB2bQogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIHZhciB2YWxpZGF0b3IgPSBwcm9wLnZhbGlkYXRvcjsKICAgIGlmICh2YWxpZGF0b3IpIHsKICAgICAgaWYgKCF2YWxpZGF0b3IodmFsdWUpKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdJbnZhbGlkIHByb3A6IGN1c3RvbSB2YWxpZGF0b3IgY2hlY2sgZmFpbGVkIGZvciBwcm9wICInICsgbmFtZSArICciLicsCiAgICAgICAgICB2bQogICAgICAgICk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBzaW1wbGVDaGVja1JFID0gL14oU3RyaW5nfE51bWJlcnxCb29sZWFufEZ1bmN0aW9ufFN5bWJvbCkkLzsKCiAgZnVuY3Rpb24gYXNzZXJ0VHlwZSAodmFsdWUsIHR5cGUpIHsKICAgIHZhciB2YWxpZDsKICAgIHZhciBleHBlY3RlZFR5cGUgPSBnZXRUeXBlKHR5cGUpOwogICAgaWYgKHNpbXBsZUNoZWNrUkUudGVzdChleHBlY3RlZFR5cGUpKSB7CiAgICAgIHZhciB0ID0gdHlwZW9mIHZhbHVlOwogICAgICB2YWxpZCA9IHQgPT09IGV4cGVjdGVkVHlwZS50b0xvd2VyQ2FzZSgpOwogICAgICAvLyBmb3IgcHJpbWl0aXZlIHdyYXBwZXIgb2JqZWN0cwogICAgICBpZiAoIXZhbGlkICYmIHQgPT09ICdvYmplY3QnKSB7CiAgICAgICAgdmFsaWQgPSB2YWx1ZSBpbnN0YW5jZW9mIHR5cGU7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXhwZWN0ZWRUeXBlID09PSAnT2JqZWN0JykgewogICAgICB2YWxpZCA9IGlzUGxhaW5PYmplY3QodmFsdWUpOwogICAgfSBlbHNlIGlmIChleHBlY3RlZFR5cGUgPT09ICdBcnJheScpIHsKICAgICAgdmFsaWQgPSBBcnJheS5pc0FycmF5KHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhbGlkID0gdmFsdWUgaW5zdGFuY2VvZiB0eXBlOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IHZhbGlkLAogICAgICBleHBlY3RlZFR5cGU6IGV4cGVjdGVkVHlwZQogICAgfQogIH0KCiAgLyoqCiAgICogVXNlIGZ1bmN0aW9uIHN0cmluZyBuYW1lIHRvIGNoZWNrIGJ1aWx0LWluIHR5cGVzLAogICAqIGJlY2F1c2UgYSBzaW1wbGUgZXF1YWxpdHkgY2hlY2sgd2lsbCBmYWlsIHdoZW4gcnVubmluZwogICAqIGFjcm9zcyBkaWZmZXJlbnQgdm1zIC8gaWZyYW1lcy4KICAgKi8KICBmdW5jdGlvbiBnZXRUeXBlIChmbikgewogICAgdmFyIG1hdGNoID0gZm4gJiYgZm4udG9TdHJpbmcoKS5tYXRjaCgvXlxzKmZ1bmN0aW9uIChcdyspLyk7CiAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6ICcnCiAgfQoKICBmdW5jdGlvbiBpc1NhbWVUeXBlIChhLCBiKSB7CiAgICByZXR1cm4gZ2V0VHlwZShhKSA9PT0gZ2V0VHlwZShiKQogIH0KCiAgZnVuY3Rpb24gZ2V0VHlwZUluZGV4ICh0eXBlLCBleHBlY3RlZFR5cGVzKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZXhwZWN0ZWRUeXBlcykpIHsKICAgICAgcmV0dXJuIGlzU2FtZVR5cGUoZXhwZWN0ZWRUeXBlcywgdHlwZSkgPyAwIDogLTEKICAgIH0KICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBleHBlY3RlZFR5cGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGlmIChpc1NhbWVUeXBlKGV4cGVjdGVkVHlwZXNbaV0sIHR5cGUpKSB7CiAgICAgICAgcmV0dXJuIGkKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xCiAgfQoKICBmdW5jdGlvbiBnZXRJbnZhbGlkVHlwZU1lc3NhZ2UgKG5hbWUsIHZhbHVlLCBleHBlY3RlZFR5cGVzKSB7CiAgICB2YXIgbWVzc2FnZSA9ICJJbnZhbGlkIHByb3A6IHR5cGUgY2hlY2sgZmFpbGVkIGZvciBwcm9wIFwiIiArIG5hbWUgKyAiXCIuIiArCiAgICAgICIgRXhwZWN0ZWQgIiArIChleHBlY3RlZFR5cGVzLm1hcChjYXBpdGFsaXplKS5qb2luKCcsICcpKTsKICAgIHZhciBleHBlY3RlZFR5cGUgPSBleHBlY3RlZFR5cGVzWzBdOwogICAgdmFyIHJlY2VpdmVkVHlwZSA9IHRvUmF3VHlwZSh2YWx1ZSk7CiAgICB2YXIgZXhwZWN0ZWRWYWx1ZSA9IHN0eWxlVmFsdWUodmFsdWUsIGV4cGVjdGVkVHlwZSk7CiAgICB2YXIgcmVjZWl2ZWRWYWx1ZSA9IHN0eWxlVmFsdWUodmFsdWUsIHJlY2VpdmVkVHlwZSk7CiAgICAvLyBjaGVjayBpZiB3ZSBuZWVkIHRvIHNwZWNpZnkgZXhwZWN0ZWQgdmFsdWUKICAgIGlmIChleHBlY3RlZFR5cGVzLmxlbmd0aCA9PT0gMSAmJgogICAgICAgIGlzRXhwbGljYWJsZShleHBlY3RlZFR5cGUpICYmCiAgICAgICAgIWlzQm9vbGVhbihleHBlY3RlZFR5cGUsIHJlY2VpdmVkVHlwZSkpIHsKICAgICAgbWVzc2FnZSArPSAiIHdpdGggdmFsdWUgIiArIGV4cGVjdGVkVmFsdWU7CiAgICB9CiAgICBtZXNzYWdlICs9ICIsIGdvdCAiICsgcmVjZWl2ZWRUeXBlICsgIiAiOwogICAgLy8gY2hlY2sgaWYgd2UgbmVlZCB0byBzcGVjaWZ5IHJlY2VpdmVkIHZhbHVlCiAgICBpZiAoaXNFeHBsaWNhYmxlKHJlY2VpdmVkVHlwZSkpIHsKICAgICAgbWVzc2FnZSArPSAid2l0aCB2YWx1ZSAiICsgcmVjZWl2ZWRWYWx1ZSArICIuIjsKICAgIH0KICAgIHJldHVybiBtZXNzYWdlCiAgfQoKICBmdW5jdGlvbiBzdHlsZVZhbHVlICh2YWx1ZSwgdHlwZSkgewogICAgaWYgKHR5cGUgPT09ICdTdHJpbmcnKSB7CiAgICAgIHJldHVybiAoIlwiIiArIHZhbHVlICsgIlwiIikKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ051bWJlcicpIHsKICAgICAgcmV0dXJuICgiIiArIChOdW1iZXIodmFsdWUpKSkKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAoIiIgKyB2YWx1ZSkKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzRXhwbGljYWJsZSAodmFsdWUpIHsKICAgIHZhciBleHBsaWNpdFR5cGVzID0gWydzdHJpbmcnLCAnbnVtYmVyJywgJ2Jvb2xlYW4nXTsKICAgIHJldHVybiBleHBsaWNpdFR5cGVzLnNvbWUoZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IGVsZW07IH0pCiAgfQoKICBmdW5jdGlvbiBpc0Jvb2xlYW4gKCkgewogICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07CgogICAgcmV0dXJuIGFyZ3Muc29tZShmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gZWxlbS50b0xvd2VyQ2FzZSgpID09PSAnYm9vbGVhbic7IH0pCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaGFuZGxlRXJyb3IgKGVyciwgdm0sIGluZm8pIHsKICAgIC8vIERlYWN0aXZhdGUgZGVwcyB0cmFja2luZyB3aGlsZSBwcm9jZXNzaW5nIGVycm9yIGhhbmRsZXIgdG8gYXZvaWQgcG9zc2libGUgaW5maW5pdGUgcmVuZGVyaW5nLgogICAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vdnVlanMvdnVleC9pc3N1ZXMvMTUwNQogICAgcHVzaFRhcmdldCgpOwogICAgdHJ5IHsKICAgICAgaWYgKHZtKSB7CiAgICAgICAgdmFyIGN1ciA9IHZtOwogICAgICAgIHdoaWxlICgoY3VyID0gY3VyLiRwYXJlbnQpKSB7CiAgICAgICAgICB2YXIgaG9va3MgPSBjdXIuJG9wdGlvbnMuZXJyb3JDYXB0dXJlZDsKICAgICAgICAgIGlmIChob29rcykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhvb2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBjYXB0dXJlID0gaG9va3NbaV0uY2FsbChjdXIsIGVyciwgdm0sIGluZm8pID09PSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChjYXB0dXJlKSB7IHJldHVybiB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgZ2xvYmFsSGFuZGxlRXJyb3IoZSwgY3VyLCAnZXJyb3JDYXB0dXJlZCBob29rJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGdsb2JhbEhhbmRsZUVycm9yKGVyciwgdm0sIGluZm8pOwogICAgfSBmaW5hbGx5IHsKICAgICAgcG9wVGFyZ2V0KCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyAoCiAgICBoYW5kbGVyLAogICAgY29udGV4dCwKICAgIGFyZ3MsCiAgICB2bSwKICAgIGluZm8KICApIHsKICAgIHZhciByZXM7CiAgICB0cnkgewogICAgICByZXMgPSBhcmdzID8gaGFuZGxlci5hcHBseShjb250ZXh0LCBhcmdzKSA6IGhhbmRsZXIuY2FsbChjb250ZXh0KTsKICAgICAgaWYgKHJlcyAmJiAhcmVzLl9pc1Z1ZSAmJiBpc1Byb21pc2UocmVzKSAmJiAhcmVzLl9oYW5kbGVkKSB7CiAgICAgICAgcmVzLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBoYW5kbGVFcnJvcihlLCB2bSwgaW5mbyArICIgKFByb21pc2UvYXN5bmMpIik7IH0pOwogICAgICAgIC8vIGlzc3VlICM5NTExCiAgICAgICAgLy8gYXZvaWQgY2F0Y2ggdHJpZ2dlcmluZyBtdWx0aXBsZSB0aW1lcyB3aGVuIG5lc3RlZCBjYWxscwogICAgICAgIHJlcy5faGFuZGxlZCA9IHRydWU7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sIGluZm8pOwogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gZ2xvYmFsSGFuZGxlRXJyb3IgKGVyciwgdm0sIGluZm8pIHsKICAgIGlmIChjb25maWcuZXJyb3JIYW5kbGVyKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGNvbmZpZy5lcnJvckhhbmRsZXIuY2FsbChudWxsLCBlcnIsIHZtLCBpbmZvKQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gaWYgdGhlIHVzZXIgaW50ZW50aW9uYWxseSB0aHJvd3MgdGhlIG9yaWdpbmFsIGVycm9yIGluIHRoZSBoYW5kbGVyLAogICAgICAgIC8vIGRvIG5vdCBsb2cgaXQgdHdpY2UKICAgICAgICBpZiAoZSAhPT0gZXJyKSB7CiAgICAgICAgICBsb2dFcnJvcihlLCBudWxsLCAnY29uZmlnLmVycm9ySGFuZGxlcicpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbG9nRXJyb3IoZXJyLCB2bSwgaW5mbyk7CiAgfQoKICBmdW5jdGlvbiBsb2dFcnJvciAoZXJyLCB2bSwgaW5mbykgewogICAgewogICAgICB3YXJuKCgiRXJyb3IgaW4gIiArIGluZm8gKyAiOiBcIiIgKyAoZXJyLnRvU3RyaW5nKCkpICsgIlwiIiksIHZtKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAoKGluQnJvd3NlciB8fCBpbldlZXgpICYmIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgewogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBlcnIKICAgIH0KICB9CgogIC8qICAqLwoKICB2YXIgaXNVc2luZ01pY3JvVGFzayA9IGZhbHNlOwoKICB2YXIgY2FsbGJhY2tzID0gW107CiAgdmFyIHBlbmRpbmcgPSBmYWxzZTsKCiAgZnVuY3Rpb24gZmx1c2hDYWxsYmFja3MgKCkgewogICAgcGVuZGluZyA9IGZhbHNlOwogICAgdmFyIGNvcGllcyA9IGNhbGxiYWNrcy5zbGljZSgwKTsKICAgIGNhbGxiYWNrcy5sZW5ndGggPSAwOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3BpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgY29waWVzW2ldKCk7CiAgICB9CiAgfQoKICAvLyBIZXJlIHdlIGhhdmUgYXN5bmMgZGVmZXJyaW5nIHdyYXBwZXJzIHVzaW5nIG1pY3JvdGFza3MuCiAgLy8gSW4gMi41IHdlIHVzZWQgKG1hY3JvKSB0YXNrcyAoaW4gY29tYmluYXRpb24gd2l0aCBtaWNyb3Rhc2tzKS4KICAvLyBIb3dldmVyLCBpdCBoYXMgc3VidGxlIHByb2JsZW1zIHdoZW4gc3RhdGUgaXMgY2hhbmdlZCByaWdodCBiZWZvcmUgcmVwYWludAogIC8vIChlLmcuICM2ODEzLCBvdXQtaW4gdHJhbnNpdGlvbnMpLgogIC8vIEFsc28sIHVzaW5nIChtYWNybykgdGFza3MgaW4gZXZlbnQgaGFuZGxlciB3b3VsZCBjYXVzZSBzb21lIHdlaXJkIGJlaGF2aW9ycwogIC8vIHRoYXQgY2Fubm90IGJlIGNpcmN1bXZlbnRlZCAoZS5nLiAjNzEwOSwgIzcxNTMsICM3NTQ2LCAjNzgzNCwgIzgxMDkpLgogIC8vIFNvIHdlIG5vdyB1c2UgbWljcm90YXNrcyBldmVyeXdoZXJlLCBhZ2Fpbi4KICAvLyBBIG1ham9yIGRyYXdiYWNrIG9mIHRoaXMgdHJhZGVvZmYgaXMgdGhhdCB0aGVyZSBhcmUgc29tZSBzY2VuYXJpb3MKICAvLyB3aGVyZSBtaWNyb3Rhc2tzIGhhdmUgdG9vIGhpZ2ggYSBwcmlvcml0eSBhbmQgZmlyZSBpbiBiZXR3ZWVuIHN1cHBvc2VkbHkKICAvLyBzZXF1ZW50aWFsIGV2ZW50cyAoZS5nLiAjNDUyMSwgIzY2OTAsIHdoaWNoIGhhdmUgd29ya2Fyb3VuZHMpCiAgLy8gb3IgZXZlbiBiZXR3ZWVuIGJ1YmJsaW5nIG9mIHRoZSBzYW1lIGV2ZW50ICgjNjU2NikuCiAgdmFyIHRpbWVyRnVuYzsKCiAgLy8gVGhlIG5leHRUaWNrIGJlaGF2aW9yIGxldmVyYWdlcyB0aGUgbWljcm90YXNrIHF1ZXVlLCB3aGljaCBjYW4gYmUgYWNjZXNzZWQKICAvLyB2aWEgZWl0aGVyIG5hdGl2ZSBQcm9taXNlLnRoZW4gb3IgTXV0YXRpb25PYnNlcnZlci4KICAvLyBNdXRhdGlvbk9ic2VydmVyIGhhcyB3aWRlciBzdXBwb3J0LCBob3dldmVyIGl0IGlzIHNlcmlvdXNseSBidWdnZWQgaW4KICAvLyBVSVdlYlZpZXcgaW4gaU9TID49IDkuMy4zIHdoZW4gdHJpZ2dlcmVkIGluIHRvdWNoIGV2ZW50IGhhbmRsZXJzLiBJdAogIC8vIGNvbXBsZXRlbHkgc3RvcHMgd29ya2luZyBhZnRlciB0cmlnZ2VyaW5nIGEgZmV3IHRpbWVzLi4uIHNvLCBpZiBuYXRpdmUKICAvLyBQcm9taXNlIGlzIGF2YWlsYWJsZSwgd2Ugd2lsbCB1c2UgaXQ6CiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQsICRmbG93LWRpc2FibGUtbGluZSAqLwogIGlmICh0eXBlb2YgUHJvbWlzZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoUHJvbWlzZSkpIHsKICAgIHZhciBwID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICB0aW1lckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHAudGhlbihmbHVzaENhbGxiYWNrcyk7CiAgICAgIC8vIEluIHByb2JsZW1hdGljIFVJV2ViVmlld3MsIFByb21pc2UudGhlbiBkb2Vzbid0IGNvbXBsZXRlbHkgYnJlYWssIGJ1dAogICAgICAvLyBpdCBjYW4gZ2V0IHN0dWNrIGluIGEgd2VpcmQgc3RhdGUgd2hlcmUgY2FsbGJhY2tzIGFyZSBwdXNoZWQgaW50byB0aGUKICAgICAgLy8gbWljcm90YXNrIHF1ZXVlIGJ1dCB0aGUgcXVldWUgaXNuJ3QgYmVpbmcgZmx1c2hlZCwgdW50aWwgdGhlIGJyb3dzZXIKICAgICAgLy8gbmVlZHMgdG8gZG8gc29tZSBvdGhlciB3b3JrLCBlLmcuIGhhbmRsZSBhIHRpbWVyLiBUaGVyZWZvcmUgd2UgY2FuCiAgICAgIC8vICJmb3JjZSIgdGhlIG1pY3JvdGFzayBxdWV1ZSB0byBiZSBmbHVzaGVkIGJ5IGFkZGluZyBhbiBlbXB0eSB0aW1lci4KICAgICAgaWYgKGlzSU9TKSB7IHNldFRpbWVvdXQobm9vcCk7IH0KICAgIH07CiAgICBpc1VzaW5nTWljcm9UYXNrID0gdHJ1ZTsKICB9IGVsc2UgaWYgKCFpc0lFICYmIHR5cGVvZiBNdXRhdGlvbk9ic2VydmVyICE9PSAndW5kZWZpbmVkJyAmJiAoCiAgICBpc05hdGl2ZShNdXRhdGlvbk9ic2VydmVyKSB8fAogICAgLy8gUGhhbnRvbUpTIGFuZCBpT1MgNy54CiAgICBNdXRhdGlvbk9ic2VydmVyLnRvU3RyaW5nKCkgPT09ICdbb2JqZWN0IE11dGF0aW9uT2JzZXJ2ZXJDb25zdHJ1Y3Rvcl0nCiAgKSkgewogICAgLy8gVXNlIE11dGF0aW9uT2JzZXJ2ZXIgd2hlcmUgbmF0aXZlIFByb21pc2UgaXMgbm90IGF2YWlsYWJsZSwKICAgIC8vIGUuZy4gUGhhbnRvbUpTLCBpT1M3LCBBbmRyb2lkIDQuNAogICAgLy8gKCM2NDY2IE11dGF0aW9uT2JzZXJ2ZXIgaXMgdW5yZWxpYWJsZSBpbiBJRTExKQogICAgdmFyIGNvdW50ZXIgPSAxOwogICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZmx1c2hDYWxsYmFja3MpOwogICAgdmFyIHRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoU3RyaW5nKGNvdW50ZXIpKTsKICAgIG9ic2VydmVyLm9ic2VydmUodGV4dE5vZGUsIHsKICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZQogICAgfSk7CiAgICB0aW1lckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvdW50ZXIgPSAoY291bnRlciArIDEpICUgMjsKICAgICAgdGV4dE5vZGUuZGF0YSA9IFN0cmluZyhjb3VudGVyKTsKICAgIH07CiAgICBpc1VzaW5nTWljcm9UYXNrID0gdHJ1ZTsKICB9IGVsc2UgaWYgKHR5cGVvZiBzZXRJbW1lZGlhdGUgIT09ICd1bmRlZmluZWQnICYmIGlzTmF0aXZlKHNldEltbWVkaWF0ZSkpIHsKICAgIC8vIEZhbGxiYWNrIHRvIHNldEltbWVkaWF0ZS4KICAgIC8vIFRlY2huaWNhbGx5IGl0IGxldmVyYWdlcyB0aGUgKG1hY3JvKSB0YXNrIHF1ZXVlLAogICAgLy8gYnV0IGl0IGlzIHN0aWxsIGEgYmV0dGVyIGNob2ljZSB0aGFuIHNldFRpbWVvdXQuCiAgICB0aW1lckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHNldEltbWVkaWF0ZShmbHVzaENhbGxiYWNrcyk7CiAgICB9OwogIH0gZWxzZSB7CiAgICAvLyBGYWxsYmFjayB0byBzZXRUaW1lb3V0LgogICAgdGltZXJGdW5jID0gZnVuY3Rpb24gKCkgewogICAgICBzZXRUaW1lb3V0KGZsdXNoQ2FsbGJhY2tzLCAwKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBuZXh0VGljayAoY2IsIGN0eCkgewogICAgdmFyIF9yZXNvbHZlOwogICAgY2FsbGJhY2tzLnB1c2goZnVuY3Rpb24gKCkgewogICAgICBpZiAoY2IpIHsKICAgICAgICB0cnkgewogICAgICAgICAgY2IuY2FsbChjdHgpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGhhbmRsZUVycm9yKGUsIGN0eCwgJ25leHRUaWNrJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKF9yZXNvbHZlKSB7CiAgICAgICAgX3Jlc29sdmUoY3R4KTsKICAgICAgfQogICAgfSk7CiAgICBpZiAoIXBlbmRpbmcpIHsKICAgICAgcGVuZGluZyA9IHRydWU7CiAgICAgIHRpbWVyRnVuYygpOwogICAgfQogICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICBpZiAoIWNiICYmIHR5cGVvZiBQcm9taXNlICE9PSAndW5kZWZpbmVkJykgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBfcmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgIH0pCiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIG1hcms7CiAgdmFyIG1lYXN1cmU7CgogIHsKICAgIHZhciBwZXJmID0gaW5Ccm93c2VyICYmIHdpbmRvdy5wZXJmb3JtYW5jZTsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKAogICAgICBwZXJmICYmCiAgICAgIHBlcmYubWFyayAmJgogICAgICBwZXJmLm1lYXN1cmUgJiYKICAgICAgcGVyZi5jbGVhck1hcmtzICYmCiAgICAgIHBlcmYuY2xlYXJNZWFzdXJlcwogICAgKSB7CiAgICAgIG1hcmsgPSBmdW5jdGlvbiAodGFnKSB7IHJldHVybiBwZXJmLm1hcmsodGFnKTsgfTsKICAgICAgbWVhc3VyZSA9IGZ1bmN0aW9uIChuYW1lLCBzdGFydFRhZywgZW5kVGFnKSB7CiAgICAgICAgcGVyZi5tZWFzdXJlKG5hbWUsIHN0YXJ0VGFnLCBlbmRUYWcpOwogICAgICAgIHBlcmYuY2xlYXJNYXJrcyhzdGFydFRhZyk7CiAgICAgICAgcGVyZi5jbGVhck1hcmtzKGVuZFRhZyk7CiAgICAgICAgLy8gcGVyZi5jbGVhck1lYXN1cmVzKG5hbWUpCiAgICAgIH07CiAgICB9CiAgfQoKICAvKiBub3QgdHlwZSBjaGVja2luZyB0aGlzIGZpbGUgYmVjYXVzZSBmbG93IGRvZXNuJ3QgcGxheSB3ZWxsIHdpdGggUHJveHkgKi8KCiAgdmFyIGluaXRQcm94eTsKCiAgewogICAgdmFyIGFsbG93ZWRHbG9iYWxzID0gbWFrZU1hcCgKICAgICAgJ0luZmluaXR5LHVuZGVmaW5lZCxOYU4saXNGaW5pdGUsaXNOYU4sJyArCiAgICAgICdwYXJzZUZsb2F0LHBhcnNlSW50LGRlY29kZVVSSSxkZWNvZGVVUklDb21wb25lbnQsZW5jb2RlVVJJLGVuY29kZVVSSUNvbXBvbmVudCwnICsKICAgICAgJ01hdGgsTnVtYmVyLERhdGUsQXJyYXksT2JqZWN0LEJvb2xlYW4sU3RyaW5nLFJlZ0V4cCxNYXAsU2V0LEpTT04sSW50bCwnICsKICAgICAgJ3JlcXVpcmUnIC8vIGZvciBXZWJwYWNrL0Jyb3dzZXJpZnkKICAgICk7CgogICAgdmFyIHdhcm5Ob25QcmVzZW50ID0gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7CiAgICAgIHdhcm4oCiAgICAgICAgIlByb3BlcnR5IG9yIG1ldGhvZCBcIiIgKyBrZXkgKyAiXCIgaXMgbm90IGRlZmluZWQgb24gdGhlIGluc3RhbmNlIGJ1dCAiICsKICAgICAgICAncmVmZXJlbmNlZCBkdXJpbmcgcmVuZGVyLiBNYWtlIHN1cmUgdGhhdCB0aGlzIHByb3BlcnR5IGlzIHJlYWN0aXZlLCAnICsKICAgICAgICAnZWl0aGVyIGluIHRoZSBkYXRhIG9wdGlvbiwgb3IgZm9yIGNsYXNzLWJhc2VkIGNvbXBvbmVudHMsIGJ5ICcgKwogICAgICAgICdpbml0aWFsaXppbmcgdGhlIHByb3BlcnR5LiAnICsKICAgICAgICAnU2VlOiBodHRwczovL3Z1ZWpzLm9yZy92Mi9ndWlkZS9yZWFjdGl2aXR5Lmh0bWwjRGVjbGFyaW5nLVJlYWN0aXZlLVByb3BlcnRpZXMuJywKICAgICAgICB0YXJnZXQKICAgICAgKTsKICAgIH07CgogICAgdmFyIHdhcm5SZXNlcnZlZFByZWZpeCA9IGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgewogICAgICB3YXJuKAogICAgICAgICJQcm9wZXJ0eSBcIiIgKyBrZXkgKyAiXCIgbXVzdCBiZSBhY2Nlc3NlZCB3aXRoIFwiJGRhdGEuIiArIGtleSArICJcIiBiZWNhdXNlICIgKwogICAgICAgICdwcm9wZXJ0aWVzIHN0YXJ0aW5nIHdpdGggIiQiIG9yICJfIiBhcmUgbm90IHByb3hpZWQgaW4gdGhlIFZ1ZSBpbnN0YW5jZSB0byAnICsKICAgICAgICAncHJldmVudCBjb25mbGljdHMgd2l0aCBWdWUgaW50ZXJuYWxzLiAnICsKICAgICAgICAnU2VlOiBodHRwczovL3Z1ZWpzLm9yZy92Mi9hcGkvI2RhdGEnLAogICAgICAgIHRhcmdldAogICAgICApOwogICAgfTsKCiAgICB2YXIgaGFzUHJveHkgPQogICAgICB0eXBlb2YgUHJveHkgIT09ICd1bmRlZmluZWQnICYmIGlzTmF0aXZlKFByb3h5KTsKCiAgICBpZiAoaGFzUHJveHkpIHsKICAgICAgdmFyIGlzQnVpbHRJbk1vZGlmaWVyID0gbWFrZU1hcCgnc3RvcCxwcmV2ZW50LHNlbGYsY3RybCxzaGlmdCxhbHQsbWV0YSxleGFjdCcpOwogICAgICBjb25maWcua2V5Q29kZXMgPSBuZXcgUHJveHkoY29uZmlnLmtleUNvZGVzLCB7CiAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQgKHRhcmdldCwga2V5LCB2YWx1ZSkgewogICAgICAgICAgaWYgKGlzQnVpbHRJbk1vZGlmaWVyKGtleSkpIHsKICAgICAgICAgICAgd2FybigoIkF2b2lkIG92ZXJ3cml0aW5nIGJ1aWx0LWluIG1vZGlmaWVyIGluIGNvbmZpZy5rZXlDb2RlczogLiIgKyBrZXkpKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YXJnZXRba2V5XSA9IHZhbHVlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgdmFyIGhhc0hhbmRsZXIgPSB7CiAgICAgIGhhczogZnVuY3Rpb24gaGFzICh0YXJnZXQsIGtleSkgewogICAgICAgIHZhciBoYXMgPSBrZXkgaW4gdGFyZ2V0OwogICAgICAgIHZhciBpc0FsbG93ZWQgPSBhbGxvd2VkR2xvYmFscyhrZXkpIHx8CiAgICAgICAgICAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycgJiYga2V5LmNoYXJBdCgwKSA9PT0gJ18nICYmICEoa2V5IGluIHRhcmdldC4kZGF0YSkpOwogICAgICAgIGlmICghaGFzICYmICFpc0FsbG93ZWQpIHsKICAgICAgICAgIGlmIChrZXkgaW4gdGFyZ2V0LiRkYXRhKSB7IHdhcm5SZXNlcnZlZFByZWZpeCh0YXJnZXQsIGtleSk7IH0KICAgICAgICAgIGVsc2UgeyB3YXJuTm9uUHJlc2VudCh0YXJnZXQsIGtleSk7IH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhhcyB8fCAhaXNBbGxvd2VkCiAgICAgIH0KICAgIH07CgogICAgdmFyIGdldEhhbmRsZXIgPSB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0ICh0YXJnZXQsIGtleSkgewogICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyAmJiAhKGtleSBpbiB0YXJnZXQpKSB7CiAgICAgICAgICBpZiAoa2V5IGluIHRhcmdldC4kZGF0YSkgeyB3YXJuUmVzZXJ2ZWRQcmVmaXgodGFyZ2V0LCBrZXkpOyB9CiAgICAgICAgICBlbHNlIHsgd2Fybk5vblByZXNlbnQodGFyZ2V0LCBrZXkpOyB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0YXJnZXRba2V5XQogICAgICB9CiAgICB9OwoKICAgIGluaXRQcm94eSA9IGZ1bmN0aW9uIGluaXRQcm94eSAodm0pIHsKICAgICAgaWYgKGhhc1Byb3h5KSB7CiAgICAgICAgLy8gZGV0ZXJtaW5lIHdoaWNoIHByb3h5IGhhbmRsZXIgdG8gdXNlCiAgICAgICAgdmFyIG9wdGlvbnMgPSB2bS4kb3B0aW9uczsKICAgICAgICB2YXIgaGFuZGxlcnMgPSBvcHRpb25zLnJlbmRlciAmJiBvcHRpb25zLnJlbmRlci5fd2l0aFN0cmlwcGVkCiAgICAgICAgICA/IGdldEhhbmRsZXIKICAgICAgICAgIDogaGFzSGFuZGxlcjsKICAgICAgICB2bS5fcmVuZGVyUHJveHkgPSBuZXcgUHJveHkodm0sIGhhbmRsZXJzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5fcmVuZGVyUHJveHkgPSB2bTsKICAgICAgfQogICAgfTsKICB9CgogIC8qICAqLwoKICB2YXIgc2Vlbk9iamVjdHMgPSBuZXcgX1NldCgpOwoKICAvKioKICAgKiBSZWN1cnNpdmVseSB0cmF2ZXJzZSBhbiBvYmplY3QgdG8gZXZva2UgYWxsIGNvbnZlcnRlZAogICAqIGdldHRlcnMsIHNvIHRoYXQgZXZlcnkgbmVzdGVkIHByb3BlcnR5IGluc2lkZSB0aGUgb2JqZWN0CiAgICogaXMgY29sbGVjdGVkIGFzIGEgImRlZXAiIGRlcGVuZGVuY3kuCiAgICovCiAgZnVuY3Rpb24gdHJhdmVyc2UgKHZhbCkgewogICAgX3RyYXZlcnNlKHZhbCwgc2Vlbk9iamVjdHMpOwogICAgc2Vlbk9iamVjdHMuY2xlYXIoKTsKICB9CgogIGZ1bmN0aW9uIF90cmF2ZXJzZSAodmFsLCBzZWVuKSB7CiAgICB2YXIgaSwga2V5czsKICAgIHZhciBpc0EgPSBBcnJheS5pc0FycmF5KHZhbCk7CiAgICBpZiAoKCFpc0EgJiYgIWlzT2JqZWN0KHZhbCkpIHx8IE9iamVjdC5pc0Zyb3plbih2YWwpIHx8IHZhbCBpbnN0YW5jZW9mIFZOb2RlKSB7CiAgICAgIHJldHVybgogICAgfQogICAgaWYgKHZhbC5fX29iX18pIHsKICAgICAgdmFyIGRlcElkID0gdmFsLl9fb2JfXy5kZXAuaWQ7CiAgICAgIGlmIChzZWVuLmhhcyhkZXBJZCkpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBzZWVuLmFkZChkZXBJZCk7CiAgICB9CiAgICBpZiAoaXNBKSB7CiAgICAgIGkgPSB2YWwubGVuZ3RoOwogICAgICB3aGlsZSAoaS0tKSB7IF90cmF2ZXJzZSh2YWxbaV0sIHNlZW4pOyB9CiAgICB9IGVsc2UgewogICAgICBrZXlzID0gT2JqZWN0LmtleXModmFsKTsKICAgICAgaSA9IGtleXMubGVuZ3RoOwogICAgICB3aGlsZSAoaS0tKSB7IF90cmF2ZXJzZSh2YWxba2V5c1tpXV0sIHNlZW4pOyB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIG5vcm1hbGl6ZUV2ZW50ID0gY2FjaGVkKGZ1bmN0aW9uIChuYW1lKSB7CiAgICB2YXIgcGFzc2l2ZSA9IG5hbWUuY2hhckF0KDApID09PSAnJic7CiAgICBuYW1lID0gcGFzc2l2ZSA/IG5hbWUuc2xpY2UoMSkgOiBuYW1lOwogICAgdmFyIG9uY2UkJDEgPSBuYW1lLmNoYXJBdCgwKSA9PT0gJ34nOyAvLyBQcmVmaXhlZCBsYXN0LCBjaGVja2VkIGZpcnN0CiAgICBuYW1lID0gb25jZSQkMSA/IG5hbWUuc2xpY2UoMSkgOiBuYW1lOwogICAgdmFyIGNhcHR1cmUgPSBuYW1lLmNoYXJBdCgwKSA9PT0gJyEnOwogICAgbmFtZSA9IGNhcHR1cmUgPyBuYW1lLnNsaWNlKDEpIDogbmFtZTsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIG9uY2U6IG9uY2UkJDEsCiAgICAgIGNhcHR1cmU6IGNhcHR1cmUsCiAgICAgIHBhc3NpdmU6IHBhc3NpdmUKICAgIH0KICB9KTsKCiAgZnVuY3Rpb24gY3JlYXRlRm5JbnZva2VyIChmbnMsIHZtKSB7CiAgICBmdW5jdGlvbiBpbnZva2VyICgpIHsKICAgICAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKICAgICAgdmFyIGZucyA9IGludm9rZXIuZm5zOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShmbnMpKSB7CiAgICAgICAgdmFyIGNsb25lZCA9IGZucy5zbGljZSgpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2xvbmVkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyhjbG9uZWRbaV0sIG51bGwsIGFyZ3VtZW50cyQxLCB2bSwgInYtb24gaGFuZGxlciIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyByZXR1cm4gaGFuZGxlciByZXR1cm4gdmFsdWUgZm9yIHNpbmdsZSBoYW5kbGVycwogICAgICAgIHJldHVybiBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyhmbnMsIG51bGwsIGFyZ3VtZW50cywgdm0sICJ2LW9uIGhhbmRsZXIiKQogICAgICB9CiAgICB9CiAgICBpbnZva2VyLmZucyA9IGZuczsKICAgIHJldHVybiBpbnZva2VyCiAgfQoKICBmdW5jdGlvbiB1cGRhdGVMaXN0ZW5lcnMgKAogICAgb24sCiAgICBvbGRPbiwKICAgIGFkZCwKICAgIHJlbW92ZSQkMSwKICAgIGNyZWF0ZU9uY2VIYW5kbGVyLAogICAgdm0KICApIHsKICAgIHZhciBuYW1lLCBkZWYkJDEsIGN1ciwgb2xkLCBldmVudDsKICAgIGZvciAobmFtZSBpbiBvbikgewogICAgICBkZWYkJDEgPSBjdXIgPSBvbltuYW1lXTsKICAgICAgb2xkID0gb2xkT25bbmFtZV07CiAgICAgIGV2ZW50ID0gbm9ybWFsaXplRXZlbnQobmFtZSk7CiAgICAgIGlmIChpc1VuZGVmKGN1cikpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgIkludmFsaWQgaGFuZGxlciBmb3IgZXZlbnQgXCIiICsgKGV2ZW50Lm5hbWUpICsgIlwiOiBnb3QgIiArIFN0cmluZyhjdXIpLAogICAgICAgICAgdm0KICAgICAgICApOwogICAgICB9IGVsc2UgaWYgKGlzVW5kZWYob2xkKSkgewogICAgICAgIGlmIChpc1VuZGVmKGN1ci5mbnMpKSB7CiAgICAgICAgICBjdXIgPSBvbltuYW1lXSA9IGNyZWF0ZUZuSW52b2tlcihjdXIsIHZtKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzVHJ1ZShldmVudC5vbmNlKSkgewogICAgICAgICAgY3VyID0gb25bbmFtZV0gPSBjcmVhdGVPbmNlSGFuZGxlcihldmVudC5uYW1lLCBjdXIsIGV2ZW50LmNhcHR1cmUpOwogICAgICAgIH0KICAgICAgICBhZGQoZXZlbnQubmFtZSwgY3VyLCBldmVudC5jYXB0dXJlLCBldmVudC5wYXNzaXZlLCBldmVudC5wYXJhbXMpOwogICAgICB9IGVsc2UgaWYgKGN1ciAhPT0gb2xkKSB7CiAgICAgICAgb2xkLmZucyA9IGN1cjsKICAgICAgICBvbltuYW1lXSA9IG9sZDsKICAgICAgfQogICAgfQogICAgZm9yIChuYW1lIGluIG9sZE9uKSB7CiAgICAgIGlmIChpc1VuZGVmKG9uW25hbWVdKSkgewogICAgICAgIGV2ZW50ID0gbm9ybWFsaXplRXZlbnQobmFtZSk7CiAgICAgICAgcmVtb3ZlJCQxKGV2ZW50Lm5hbWUsIG9sZE9uW25hbWVdLCBldmVudC5jYXB0dXJlKTsKICAgICAgfQogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIG1lcmdlVk5vZGVIb29rIChkZWYsIGhvb2tLZXksIGhvb2spIHsKICAgIGlmIChkZWYgaW5zdGFuY2VvZiBWTm9kZSkgewogICAgICBkZWYgPSBkZWYuZGF0YS5ob29rIHx8IChkZWYuZGF0YS5ob29rID0ge30pOwogICAgfQogICAgdmFyIGludm9rZXI7CiAgICB2YXIgb2xkSG9vayA9IGRlZltob29rS2V5XTsKCiAgICBmdW5jdGlvbiB3cmFwcGVkSG9vayAoKSB7CiAgICAgIGhvb2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgLy8gaW1wb3J0YW50OiByZW1vdmUgbWVyZ2VkIGhvb2sgdG8gZW5zdXJlIGl0J3MgY2FsbGVkIG9ubHkgb25jZQogICAgICAvLyBhbmQgcHJldmVudCBtZW1vcnkgbGVhawogICAgICByZW1vdmUoaW52b2tlci5mbnMsIHdyYXBwZWRIb29rKTsKICAgIH0KCiAgICBpZiAoaXNVbmRlZihvbGRIb29rKSkgewogICAgICAvLyBubyBleGlzdGluZyBob29rCiAgICAgIGludm9rZXIgPSBjcmVhdGVGbkludm9rZXIoW3dyYXBwZWRIb29rXSk7CiAgICB9IGVsc2UgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKGlzRGVmKG9sZEhvb2suZm5zKSAmJiBpc1RydWUob2xkSG9vay5tZXJnZWQpKSB7CiAgICAgICAgLy8gYWxyZWFkeSBhIG1lcmdlZCBpbnZva2VyCiAgICAgICAgaW52b2tlciA9IG9sZEhvb2s7CiAgICAgICAgaW52b2tlci5mbnMucHVzaCh3cmFwcGVkSG9vayk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZXhpc3RpbmcgcGxhaW4gaG9vawogICAgICAgIGludm9rZXIgPSBjcmVhdGVGbkludm9rZXIoW29sZEhvb2ssIHdyYXBwZWRIb29rXSk7CiAgICAgIH0KICAgIH0KCiAgICBpbnZva2VyLm1lcmdlZCA9IHRydWU7CiAgICBkZWZbaG9va0tleV0gPSBpbnZva2VyOwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGV4dHJhY3RQcm9wc0Zyb21WTm9kZURhdGEgKAogICAgZGF0YSwKICAgIEN0b3IsCiAgICB0YWcKICApIHsKICAgIC8vIHdlIGFyZSBvbmx5IGV4dHJhY3RpbmcgcmF3IHZhbHVlcyBoZXJlLgogICAgLy8gdmFsaWRhdGlvbiBhbmQgZGVmYXVsdCB2YWx1ZXMgYXJlIGhhbmRsZWQgaW4gdGhlIGNoaWxkCiAgICAvLyBjb21wb25lbnQgaXRzZWxmLgogICAgdmFyIHByb3BPcHRpb25zID0gQ3Rvci5vcHRpb25zLnByb3BzOwogICAgaWYgKGlzVW5kZWYocHJvcE9wdGlvbnMpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIHJlcyA9IHt9OwogICAgdmFyIGF0dHJzID0gZGF0YS5hdHRyczsKICAgIHZhciBwcm9wcyA9IGRhdGEucHJvcHM7CiAgICBpZiAoaXNEZWYoYXR0cnMpIHx8IGlzRGVmKHByb3BzKSkgewogICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcE9wdGlvbnMpIHsKICAgICAgICB2YXIgYWx0S2V5ID0gaHlwaGVuYXRlKGtleSk7CiAgICAgICAgewogICAgICAgICAgdmFyIGtleUluTG93ZXJDYXNlID0ga2V5LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGtleSAhPT0ga2V5SW5Mb3dlckNhc2UgJiYKICAgICAgICAgICAgYXR0cnMgJiYgaGFzT3duKGF0dHJzLCBrZXlJbkxvd2VyQ2FzZSkKICAgICAgICAgICkgewogICAgICAgICAgICB0aXAoCiAgICAgICAgICAgICAgIlByb3AgXCIiICsga2V5SW5Mb3dlckNhc2UgKyAiXCIgaXMgcGFzc2VkIHRvIGNvbXBvbmVudCAiICsKICAgICAgICAgICAgICAoZm9ybWF0Q29tcG9uZW50TmFtZSh0YWcgfHwgQ3RvcikpICsgIiwgYnV0IHRoZSBkZWNsYXJlZCBwcm9wIG5hbWUgaXMiICsKICAgICAgICAgICAgICAiIFwiIiArIGtleSArICJcIi4gIiArCiAgICAgICAgICAgICAgIk5vdGUgdGhhdCBIVE1MIGF0dHJpYnV0ZXMgYXJlIGNhc2UtaW5zZW5zaXRpdmUgYW5kIGNhbWVsQ2FzZWQgIiArCiAgICAgICAgICAgICAgInByb3BzIG5lZWQgdG8gdXNlIHRoZWlyIGtlYmFiLWNhc2UgZXF1aXZhbGVudHMgd2hlbiB1c2luZyBpbi1ET00gIiArCiAgICAgICAgICAgICAgInRlbXBsYXRlcy4gWW91IHNob3VsZCBwcm9iYWJseSB1c2UgXCIiICsgYWx0S2V5ICsgIlwiIGluc3RlYWQgb2YgXCIiICsga2V5ICsgIlwiLiIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2hlY2tQcm9wKHJlcywgcHJvcHMsIGtleSwgYWx0S2V5LCB0cnVlKSB8fAogICAgICAgIGNoZWNrUHJvcChyZXMsIGF0dHJzLCBrZXksIGFsdEtleSwgZmFsc2UpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICBmdW5jdGlvbiBjaGVja1Byb3AgKAogICAgcmVzLAogICAgaGFzaCwKICAgIGtleSwKICAgIGFsdEtleSwKICAgIHByZXNlcnZlCiAgKSB7CiAgICBpZiAoaXNEZWYoaGFzaCkpIHsKICAgICAgaWYgKGhhc093bihoYXNoLCBrZXkpKSB7CiAgICAgICAgcmVzW2tleV0gPSBoYXNoW2tleV07CiAgICAgICAgaWYgKCFwcmVzZXJ2ZSkgewogICAgICAgICAgZGVsZXRlIGhhc2hba2V5XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWUKICAgICAgfSBlbHNlIGlmIChoYXNPd24oaGFzaCwgYWx0S2V5KSkgewogICAgICAgIHJlc1trZXldID0gaGFzaFthbHRLZXldOwogICAgICAgIGlmICghcHJlc2VydmUpIHsKICAgICAgICAgIGRlbGV0ZSBoYXNoW2FsdEtleV07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZQogIH0KCiAgLyogICovCgogIC8vIFRoZSB0ZW1wbGF0ZSBjb21waWxlciBhdHRlbXB0cyB0byBtaW5pbWl6ZSB0aGUgbmVlZCBmb3Igbm9ybWFsaXphdGlvbiBieQogIC8vIHN0YXRpY2FsbHkgYW5hbHl6aW5nIHRoZSB0ZW1wbGF0ZSBhdCBjb21waWxlIHRpbWUuCiAgLy8KICAvLyBGb3IgcGxhaW4gSFRNTCBtYXJrdXAsIG5vcm1hbGl6YXRpb24gY2FuIGJlIGNvbXBsZXRlbHkgc2tpcHBlZCBiZWNhdXNlIHRoZQogIC8vIGdlbmVyYXRlZCByZW5kZXIgZnVuY3Rpb24gaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gQXJyYXk8Vk5vZGU+LiBUaGVyZSBhcmUKICAvLyB0d28gY2FzZXMgd2hlcmUgZXh0cmEgbm9ybWFsaXphdGlvbiBpcyBuZWVkZWQ6CgogIC8vIDEuIFdoZW4gdGhlIGNoaWxkcmVuIGNvbnRhaW5zIGNvbXBvbmVudHMgLSBiZWNhdXNlIGEgZnVuY3Rpb25hbCBjb21wb25lbnQKICAvLyBtYXkgcmV0dXJuIGFuIEFycmF5IGluc3RlYWQgb2YgYSBzaW5nbGUgcm9vdC4gSW4gdGhpcyBjYXNlLCBqdXN0IGEgc2ltcGxlCiAgLy8gbm9ybWFsaXphdGlvbiBpcyBuZWVkZWQgLSBpZiBhbnkgY2hpbGQgaXMgYW4gQXJyYXksIHdlIGZsYXR0ZW4gdGhlIHdob2xlCiAgLy8gdGhpbmcgd2l0aCBBcnJheS5wcm90b3R5cGUuY29uY2F0LiBJdCBpcyBndWFyYW50ZWVkIHRvIGJlIG9ubHkgMS1sZXZlbCBkZWVwCiAgLy8gYmVjYXVzZSBmdW5jdGlvbmFsIGNvbXBvbmVudHMgYWxyZWFkeSBub3JtYWxpemUgdGhlaXIgb3duIGNoaWxkcmVuLgogIGZ1bmN0aW9uIHNpbXBsZU5vcm1hbGl6ZUNoaWxkcmVuIChjaGlsZHJlbikgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbltpXSkpIHsKICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShbXSwgY2hpbGRyZW4pCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjaGlsZHJlbgogIH0KCiAgLy8gMi4gV2hlbiB0aGUgY2hpbGRyZW4gY29udGFpbnMgY29uc3RydWN0cyB0aGF0IGFsd2F5cyBnZW5lcmF0ZWQgbmVzdGVkIEFycmF5cywKICAvLyBlLmcuIDx0ZW1wbGF0ZT4sIDxzbG90Piwgdi1mb3IsIG9yIHdoZW4gdGhlIGNoaWxkcmVuIGlzIHByb3ZpZGVkIGJ5IHVzZXIKICAvLyB3aXRoIGhhbmQtd3JpdHRlbiByZW5kZXIgZnVuY3Rpb25zIC8gSlNYLiBJbiBzdWNoIGNhc2VzIGEgZnVsbCBub3JtYWxpemF0aW9uCiAgLy8gaXMgbmVlZGVkIHRvIGNhdGVyIHRvIGFsbCBwb3NzaWJsZSB0eXBlcyBvZiBjaGlsZHJlbiB2YWx1ZXMuCiAgZnVuY3Rpb24gbm9ybWFsaXplQ2hpbGRyZW4gKGNoaWxkcmVuKSB7CiAgICByZXR1cm4gaXNQcmltaXRpdmUoY2hpbGRyZW4pCiAgICAgID8gW2NyZWF0ZVRleHRWTm9kZShjaGlsZHJlbildCiAgICAgIDogQXJyYXkuaXNBcnJheShjaGlsZHJlbikKICAgICAgICA/IG5vcm1hbGl6ZUFycmF5Q2hpbGRyZW4oY2hpbGRyZW4pCiAgICAgICAgOiB1bmRlZmluZWQKICB9CgogIGZ1bmN0aW9uIGlzVGV4dE5vZGUgKG5vZGUpIHsKICAgIHJldHVybiBpc0RlZihub2RlKSAmJiBpc0RlZihub2RlLnRleHQpICYmIGlzRmFsc2Uobm9kZS5pc0NvbW1lbnQpCiAgfQoKICBmdW5jdGlvbiBub3JtYWxpemVBcnJheUNoaWxkcmVuIChjaGlsZHJlbiwgbmVzdGVkSW5kZXgpIHsKICAgIHZhciByZXMgPSBbXTsKICAgIHZhciBpLCBjLCBsYXN0SW5kZXgsIGxhc3Q7CiAgICBmb3IgKGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgYyA9IGNoaWxkcmVuW2ldOwogICAgICBpZiAoaXNVbmRlZihjKSB8fCB0eXBlb2YgYyA9PT0gJ2Jvb2xlYW4nKSB7IGNvbnRpbnVlIH0KICAgICAgbGFzdEluZGV4ID0gcmVzLmxlbmd0aCAtIDE7CiAgICAgIGxhc3QgPSByZXNbbGFzdEluZGV4XTsKICAgICAgLy8gIG5lc3RlZAogICAgICBpZiAoQXJyYXkuaXNBcnJheShjKSkgewogICAgICAgIGlmIChjLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGMgPSBub3JtYWxpemVBcnJheUNoaWxkcmVuKGMsICgobmVzdGVkSW5kZXggfHwgJycpICsgIl8iICsgaSkpOwogICAgICAgICAgLy8gbWVyZ2UgYWRqYWNlbnQgdGV4dCBub2RlcwogICAgICAgICAgaWYgKGlzVGV4dE5vZGUoY1swXSkgJiYgaXNUZXh0Tm9kZShsYXN0KSkgewogICAgICAgICAgICByZXNbbGFzdEluZGV4XSA9IGNyZWF0ZVRleHRWTm9kZShsYXN0LnRleHQgKyAoY1swXSkudGV4dCk7CiAgICAgICAgICAgIGMuc2hpZnQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlcy5wdXNoLmFwcGx5KHJlcywgYyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGlzUHJpbWl0aXZlKGMpKSB7CiAgICAgICAgaWYgKGlzVGV4dE5vZGUobGFzdCkpIHsKICAgICAgICAgIC8vIG1lcmdlIGFkamFjZW50IHRleHQgbm9kZXMKICAgICAgICAgIC8vIHRoaXMgaXMgbmVjZXNzYXJ5IGZvciBTU1IgaHlkcmF0aW9uIGJlY2F1c2UgdGV4dCBub2RlcyBhcmUKICAgICAgICAgIC8vIGVzc2VudGlhbGx5IG1lcmdlZCB3aGVuIHJlbmRlcmVkIHRvIEhUTUwgc3RyaW5ncwogICAgICAgICAgcmVzW2xhc3RJbmRleF0gPSBjcmVhdGVUZXh0Vk5vZGUobGFzdC50ZXh0ICsgYyk7CiAgICAgICAgfSBlbHNlIGlmIChjICE9PSAnJykgewogICAgICAgICAgLy8gY29udmVydCBwcmltaXRpdmUgdG8gdm5vZGUKICAgICAgICAgIHJlcy5wdXNoKGNyZWF0ZVRleHRWTm9kZShjKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChpc1RleHROb2RlKGMpICYmIGlzVGV4dE5vZGUobGFzdCkpIHsKICAgICAgICAgIC8vIG1lcmdlIGFkamFjZW50IHRleHQgbm9kZXMKICAgICAgICAgIHJlc1tsYXN0SW5kZXhdID0gY3JlYXRlVGV4dFZOb2RlKGxhc3QudGV4dCArIGMudGV4dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGRlZmF1bHQga2V5IGZvciBuZXN0ZWQgYXJyYXkgY2hpbGRyZW4gKGxpa2VseSBnZW5lcmF0ZWQgYnkgdi1mb3IpCiAgICAgICAgICBpZiAoaXNUcnVlKGNoaWxkcmVuLl9pc1ZMaXN0KSAmJgogICAgICAgICAgICBpc0RlZihjLnRhZykgJiYKICAgICAgICAgICAgaXNVbmRlZihjLmtleSkgJiYKICAgICAgICAgICAgaXNEZWYobmVzdGVkSW5kZXgpKSB7CiAgICAgICAgICAgIGMua2V5ID0gIl9fdmxpc3QiICsgbmVzdGVkSW5kZXggKyAiXyIgKyBpICsgIl9fIjsKICAgICAgICAgIH0KICAgICAgICAgIHJlcy5wdXNoKGMpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRQcm92aWRlICh2bSkgewogICAgdmFyIHByb3ZpZGUgPSB2bS4kb3B0aW9ucy5wcm92aWRlOwogICAgaWYgKHByb3ZpZGUpIHsKICAgICAgdm0uX3Byb3ZpZGVkID0gdHlwZW9mIHByb3ZpZGUgPT09ICdmdW5jdGlvbicKICAgICAgICA/IHByb3ZpZGUuY2FsbCh2bSkKICAgICAgICA6IHByb3ZpZGU7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0SW5qZWN0aW9ucyAodm0pIHsKICAgIHZhciByZXN1bHQgPSByZXNvbHZlSW5qZWN0KHZtLiRvcHRpb25zLmluamVjdCwgdm0pOwogICAgaWYgKHJlc3VsdCkgewogICAgICB0b2dnbGVPYnNlcnZpbmcoZmFsc2UpOwogICAgICBPYmplY3Qua2V5cyhyZXN1bHQpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgICAgewogICAgICAgICAgZGVmaW5lUmVhY3RpdmUkJDEodm0sIGtleSwgcmVzdWx0W2tleV0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgd2FybigKICAgICAgICAgICAgICAiQXZvaWQgbXV0YXRpbmcgYW4gaW5qZWN0ZWQgdmFsdWUgZGlyZWN0bHkgc2luY2UgdGhlIGNoYW5nZXMgd2lsbCBiZSAiICsKICAgICAgICAgICAgICAib3ZlcndyaXR0ZW4gd2hlbmV2ZXIgdGhlIHByb3ZpZGVkIGNvbXBvbmVudCByZS1yZW5kZXJzLiAiICsKICAgICAgICAgICAgICAiaW5qZWN0aW9uIGJlaW5nIG11dGF0ZWQ6IFwiIiArIGtleSArICJcIiIsCiAgICAgICAgICAgICAgdm0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRvZ2dsZU9ic2VydmluZyh0cnVlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlc29sdmVJbmplY3QgKGluamVjdCwgdm0pIHsKICAgIGlmIChpbmplY3QpIHsKICAgICAgLy8gaW5qZWN0IGlzIDphbnkgYmVjYXVzZSBmbG93IGlzIG5vdCBzbWFydCBlbm91Z2ggdG8gZmlndXJlIG91dCBjYWNoZWQKICAgICAgdmFyIHJlc3VsdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHZhciBrZXlzID0gaGFzU3ltYm9sCiAgICAgICAgPyBSZWZsZWN0Lm93bktleXMoaW5qZWN0KQogICAgICAgIDogT2JqZWN0LmtleXMoaW5qZWN0KTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICAgIC8vICM2NTc0IGluIGNhc2UgdGhlIGluamVjdCBvYmplY3QgaXMgb2JzZXJ2ZWQuLi4KICAgICAgICBpZiAoa2V5ID09PSAnX19vYl9fJykgeyBjb250aW51ZSB9CiAgICAgICAgdmFyIHByb3ZpZGVLZXkgPSBpbmplY3Rba2V5XS5mcm9tOwogICAgICAgIHZhciBzb3VyY2UgPSB2bTsKICAgICAgICB3aGlsZSAoc291cmNlKSB7CiAgICAgICAgICBpZiAoc291cmNlLl9wcm92aWRlZCAmJiBoYXNPd24oc291cmNlLl9wcm92aWRlZCwgcHJvdmlkZUtleSkpIHsKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBzb3VyY2UuX3Byb3ZpZGVkW3Byb3ZpZGVLZXldOwogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgICAgc291cmNlID0gc291cmNlLiRwYXJlbnQ7CiAgICAgICAgfQogICAgICAgIGlmICghc291cmNlKSB7CiAgICAgICAgICBpZiAoJ2RlZmF1bHQnIGluIGluamVjdFtrZXldKSB7CiAgICAgICAgICAgIHZhciBwcm92aWRlRGVmYXVsdCA9IGluamVjdFtrZXldLmRlZmF1bHQ7CiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdHlwZW9mIHByb3ZpZGVEZWZhdWx0ID09PSAnZnVuY3Rpb24nCiAgICAgICAgICAgICAgPyBwcm92aWRlRGVmYXVsdC5jYWxsKHZtKQogICAgICAgICAgICAgIDogcHJvdmlkZURlZmF1bHQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3YXJuKCgiSW5qZWN0aW9uIFwiIiArIGtleSArICJcIiBub3QgZm91bmQiKSwgdm0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0CiAgICB9CiAgfQoKICAvKiAgKi8KCgoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3IgcmVzb2x2aW5nIHJhdyBjaGlsZHJlbiBWTm9kZXMgaW50byBhIHNsb3Qgb2JqZWN0LgogICAqLwogIGZ1bmN0aW9uIHJlc29sdmVTbG90cyAoCiAgICBjaGlsZHJlbiwKICAgIGNvbnRleHQKICApIHsKICAgIGlmICghY2hpbGRyZW4gfHwgIWNoaWxkcmVuLmxlbmd0aCkgewogICAgICByZXR1cm4ge30KICAgIH0KICAgIHZhciBzbG90cyA9IHt9OwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07CiAgICAgIHZhciBkYXRhID0gY2hpbGQuZGF0YTsKICAgICAgLy8gcmVtb3ZlIHNsb3QgYXR0cmlidXRlIGlmIHRoZSBub2RlIGlzIHJlc29sdmVkIGFzIGEgVnVlIHNsb3Qgbm9kZQogICAgICBpZiAoZGF0YSAmJiBkYXRhLmF0dHJzICYmIGRhdGEuYXR0cnMuc2xvdCkgewogICAgICAgIGRlbGV0ZSBkYXRhLmF0dHJzLnNsb3Q7CiAgICAgIH0KICAgICAgLy8gbmFtZWQgc2xvdHMgc2hvdWxkIG9ubHkgYmUgcmVzcGVjdGVkIGlmIHRoZSB2bm9kZSB3YXMgcmVuZGVyZWQgaW4gdGhlCiAgICAgIC8vIHNhbWUgY29udGV4dC4KICAgICAgaWYgKChjaGlsZC5jb250ZXh0ID09PSBjb250ZXh0IHx8IGNoaWxkLmZuQ29udGV4dCA9PT0gY29udGV4dCkgJiYKICAgICAgICBkYXRhICYmIGRhdGEuc2xvdCAhPSBudWxsCiAgICAgICkgewogICAgICAgIHZhciBuYW1lID0gZGF0YS5zbG90OwogICAgICAgIHZhciBzbG90ID0gKHNsb3RzW25hbWVdIHx8IChzbG90c1tuYW1lXSA9IFtdKSk7CiAgICAgICAgaWYgKGNoaWxkLnRhZyA9PT0gJ3RlbXBsYXRlJykgewogICAgICAgICAgc2xvdC5wdXNoLmFwcGx5KHNsb3QsIGNoaWxkLmNoaWxkcmVuIHx8IFtdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2xvdC5wdXNoKGNoaWxkKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKHNsb3RzLmRlZmF1bHQgfHwgKHNsb3RzLmRlZmF1bHQgPSBbXSkpLnB1c2goY2hpbGQpOwogICAgICB9CiAgICB9CiAgICAvLyBpZ25vcmUgc2xvdHMgdGhhdCBjb250YWlucyBvbmx5IHdoaXRlc3BhY2UKICAgIGZvciAodmFyIG5hbWUkMSBpbiBzbG90cykgewogICAgICBpZiAoc2xvdHNbbmFtZSQxXS5ldmVyeShpc1doaXRlc3BhY2UpKSB7CiAgICAgICAgZGVsZXRlIHNsb3RzW25hbWUkMV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzbG90cwogIH0KCiAgZnVuY3Rpb24gaXNXaGl0ZXNwYWNlIChub2RlKSB7CiAgICByZXR1cm4gKG5vZGUuaXNDb21tZW50ICYmICFub2RlLmFzeW5jRmFjdG9yeSkgfHwgbm9kZS50ZXh0ID09PSAnICcKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBub3JtYWxpemVTY29wZWRTbG90cyAoCiAgICBzbG90cywKICAgIG5vcm1hbFNsb3RzLAogICAgcHJldlNsb3RzCiAgKSB7CiAgICB2YXIgcmVzOwogICAgdmFyIGhhc05vcm1hbFNsb3RzID0gT2JqZWN0LmtleXMobm9ybWFsU2xvdHMpLmxlbmd0aCA+IDA7CiAgICB2YXIgaXNTdGFibGUgPSBzbG90cyA/ICEhc2xvdHMuJHN0YWJsZSA6ICFoYXNOb3JtYWxTbG90czsKICAgIHZhciBrZXkgPSBzbG90cyAmJiBzbG90cy4ka2V5OwogICAgaWYgKCFzbG90cykgewogICAgICByZXMgPSB7fTsKICAgIH0gZWxzZSBpZiAoc2xvdHMuX25vcm1hbGl6ZWQpIHsKICAgICAgLy8gZmFzdCBwYXRoIDE6IGNoaWxkIGNvbXBvbmVudCByZS1yZW5kZXIgb25seSwgcGFyZW50IGRpZCBub3QgY2hhbmdlCiAgICAgIHJldHVybiBzbG90cy5fbm9ybWFsaXplZAogICAgfSBlbHNlIGlmICgKICAgICAgaXNTdGFibGUgJiYKICAgICAgcHJldlNsb3RzICYmCiAgICAgIHByZXZTbG90cyAhPT0gZW1wdHlPYmplY3QgJiYKICAgICAga2V5ID09PSBwcmV2U2xvdHMuJGtleSAmJgogICAgICAhaGFzTm9ybWFsU2xvdHMgJiYKICAgICAgIXByZXZTbG90cy4kaGFzTm9ybWFsCiAgICApIHsKICAgICAgLy8gZmFzdCBwYXRoIDI6IHN0YWJsZSBzY29wZWQgc2xvdHMgdy8gbm8gbm9ybWFsIHNsb3RzIHRvIHByb3h5LAogICAgICAvLyBvbmx5IG5lZWQgdG8gbm9ybWFsaXplIG9uY2UKICAgICAgcmV0dXJuIHByZXZTbG90cwogICAgfSBlbHNlIHsKICAgICAgcmVzID0ge307CiAgICAgIGZvciAodmFyIGtleSQxIGluIHNsb3RzKSB7CiAgICAgICAgaWYgKHNsb3RzW2tleSQxXSAmJiBrZXkkMVswXSAhPT0gJyQnKSB7CiAgICAgICAgICByZXNba2V5JDFdID0gbm9ybWFsaXplU2NvcGVkU2xvdChub3JtYWxTbG90cywga2V5JDEsIHNsb3RzW2tleSQxXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyBleHBvc2Ugbm9ybWFsIHNsb3RzIG9uIHNjb3BlZFNsb3RzCiAgICBmb3IgKHZhciBrZXkkMiBpbiBub3JtYWxTbG90cykgewogICAgICBpZiAoIShrZXkkMiBpbiByZXMpKSB7CiAgICAgICAgcmVzW2tleSQyXSA9IHByb3h5Tm9ybWFsU2xvdChub3JtYWxTbG90cywga2V5JDIpOwogICAgICB9CiAgICB9CiAgICAvLyBhdm9yaWF6IHNlZW1zIHRvIG1vY2sgYSBub24tZXh0ZW5zaWJsZSAkc2NvcGVkU2xvdHMgb2JqZWN0CiAgICAvLyBhbmQgd2hlbiB0aGF0IGlzIHBhc3NlZCBkb3duIHRoaXMgd291bGQgY2F1c2UgYW4gZXJyb3IKICAgIGlmIChzbG90cyAmJiBPYmplY3QuaXNFeHRlbnNpYmxlKHNsb3RzKSkgewogICAgICAoc2xvdHMpLl9ub3JtYWxpemVkID0gcmVzOwogICAgfQogICAgZGVmKHJlcywgJyRzdGFibGUnLCBpc1N0YWJsZSk7CiAgICBkZWYocmVzLCAnJGtleScsIGtleSk7CiAgICBkZWYocmVzLCAnJGhhc05vcm1hbCcsIGhhc05vcm1hbFNsb3RzKTsKICAgIHJldHVybiByZXMKICB9CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZVNjb3BlZFNsb3Qobm9ybWFsU2xvdHMsIGtleSwgZm4pIHsKICAgIHZhciBub3JtYWxpemVkID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgcmVzID0gYXJndW1lbnRzLmxlbmd0aCA/IGZuLmFwcGx5KG51bGwsIGFyZ3VtZW50cykgOiBmbih7fSk7CiAgICAgIHJlcyA9IHJlcyAmJiB0eXBlb2YgcmVzID09PSAnb2JqZWN0JyAmJiAhQXJyYXkuaXNBcnJheShyZXMpCiAgICAgICAgPyBbcmVzXSAvLyBzaW5nbGUgdm5vZGUKICAgICAgICA6IG5vcm1hbGl6ZUNoaWxkcmVuKHJlcyk7CiAgICAgIHJldHVybiByZXMgJiYgKAogICAgICAgIHJlcy5sZW5ndGggPT09IDAgfHwKICAgICAgICAocmVzLmxlbmd0aCA9PT0gMSAmJiByZXNbMF0uaXNDb21tZW50KSAvLyAjOTY1OAogICAgICApID8gdW5kZWZpbmVkCiAgICAgICAgOiByZXMKICAgIH07CiAgICAvLyB0aGlzIGlzIGEgc2xvdCB1c2luZyB0aGUgbmV3IHYtc2xvdCBzeW50YXggd2l0aG91dCBzY29wZS4gYWx0aG91Z2ggaXQgaXMKICAgIC8vIGNvbXBpbGVkIGFzIGEgc2NvcGVkIHNsb3QsIHJlbmRlciBmbiB1c2VycyB3b3VsZCBleHBlY3QgaXQgdG8gYmUgcHJlc2VudAogICAgLy8gb24gdGhpcy4kc2xvdHMgYmVjYXVzZSB0aGUgdXNhZ2UgaXMgc2VtYW50aWNhbGx5IGEgbm9ybWFsIHNsb3QuCiAgICBpZiAoZm4ucHJveHkpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5vcm1hbFNsb3RzLCBrZXksIHsKICAgICAgICBnZXQ6IG5vcm1hbGl6ZWQsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gbm9ybWFsaXplZAogIH0KCiAgZnVuY3Rpb24gcHJveHlOb3JtYWxTbG90KHNsb3RzLCBrZXkpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiBzbG90c1trZXldOyB9CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHJlbmRlcmluZyB2LWZvciBsaXN0cy4KICAgKi8KICBmdW5jdGlvbiByZW5kZXJMaXN0ICgKICAgIHZhbCwKICAgIHJlbmRlcgogICkgewogICAgdmFyIHJldCwgaSwgbCwga2V5cywga2V5OwogICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSB8fCB0eXBlb2YgdmFsID09PSAnc3RyaW5nJykgewogICAgICByZXQgPSBuZXcgQXJyYXkodmFsLmxlbmd0aCk7CiAgICAgIGZvciAoaSA9IDAsIGwgPSB2YWwubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgcmV0W2ldID0gcmVuZGVyKHZhbFtpXSwgaSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpIHsKICAgICAgcmV0ID0gbmV3IEFycmF5KHZhbCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCB2YWw7IGkrKykgewogICAgICAgIHJldFtpXSA9IHJlbmRlcihpICsgMSwgaSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNPYmplY3QodmFsKSkgewogICAgICBpZiAoaGFzU3ltYm9sICYmIHZhbFtTeW1ib2wuaXRlcmF0b3JdKSB7CiAgICAgICAgcmV0ID0gW107CiAgICAgICAgdmFyIGl0ZXJhdG9yID0gdmFsW1N5bWJvbC5pdGVyYXRvcl0oKTsKICAgICAgICB2YXIgcmVzdWx0ID0gaXRlcmF0b3IubmV4dCgpOwogICAgICAgIHdoaWxlICghcmVzdWx0LmRvbmUpIHsKICAgICAgICAgIHJldC5wdXNoKHJlbmRlcihyZXN1bHQudmFsdWUsIHJldC5sZW5ndGgpKTsKICAgICAgICAgIHJlc3VsdCA9IGl0ZXJhdG9yLm5leHQoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAga2V5cyA9IE9iamVjdC5rZXlzKHZhbCk7CiAgICAgICAgcmV0ID0gbmV3IEFycmF5KGtleXMubGVuZ3RoKTsKICAgICAgICBmb3IgKGkgPSAwLCBsID0ga2V5cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGtleSA9IGtleXNbaV07CiAgICAgICAgICByZXRbaV0gPSByZW5kZXIodmFsW2tleV0sIGtleSwgaSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIWlzRGVmKHJldCkpIHsKICAgICAgcmV0ID0gW107CiAgICB9CiAgICAocmV0KS5faXNWTGlzdCA9IHRydWU7CiAgICByZXR1cm4gcmV0CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHJlbmRlcmluZyA8c2xvdD4KICAgKi8KICBmdW5jdGlvbiByZW5kZXJTbG90ICgKICAgIG5hbWUsCiAgICBmYWxsYmFjaywKICAgIHByb3BzLAogICAgYmluZE9iamVjdAogICkgewogICAgdmFyIHNjb3BlZFNsb3RGbiA9IHRoaXMuJHNjb3BlZFNsb3RzW25hbWVdOwogICAgdmFyIG5vZGVzOwogICAgaWYgKHNjb3BlZFNsb3RGbikgeyAvLyBzY29wZWQgc2xvdAogICAgICBwcm9wcyA9IHByb3BzIHx8IHt9OwogICAgICBpZiAoYmluZE9iamVjdCkgewogICAgICAgIGlmICghaXNPYmplY3QoYmluZE9iamVjdCkpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICdzbG90IHYtYmluZCB3aXRob3V0IGFyZ3VtZW50IGV4cGVjdHMgYW4gT2JqZWN0JywKICAgICAgICAgICAgdGhpcwogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcHJvcHMgPSBleHRlbmQoZXh0ZW5kKHt9LCBiaW5kT2JqZWN0KSwgcHJvcHMpOwogICAgICB9CiAgICAgIG5vZGVzID0gc2NvcGVkU2xvdEZuKHByb3BzKSB8fCBmYWxsYmFjazsKICAgIH0gZWxzZSB7CiAgICAgIG5vZGVzID0gdGhpcy4kc2xvdHNbbmFtZV0gfHwgZmFsbGJhY2s7CiAgICB9CgogICAgdmFyIHRhcmdldCA9IHByb3BzICYmIHByb3BzLnNsb3Q7CiAgICBpZiAodGFyZ2V0KSB7CiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScsIHsgc2xvdDogdGFyZ2V0IH0sIG5vZGVzKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5vZGVzCiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHJlc29sdmluZyBmaWx0ZXJzCiAgICovCiAgZnVuY3Rpb24gcmVzb2x2ZUZpbHRlciAoaWQpIHsKICAgIHJldHVybiByZXNvbHZlQXNzZXQodGhpcy4kb3B0aW9ucywgJ2ZpbHRlcnMnLCBpZCwgdHJ1ZSkgfHwgaWRlbnRpdHkKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBpc0tleU5vdE1hdGNoIChleHBlY3QsIGFjdHVhbCkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoZXhwZWN0KSkgewogICAgICByZXR1cm4gZXhwZWN0LmluZGV4T2YoYWN0dWFsKSA9PT0gLTEKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBleHBlY3QgIT09IGFjdHVhbAogICAgfQogIH0KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIGNoZWNraW5nIGtleUNvZGVzIGZyb20gY29uZmlnLgogICAqIGV4cG9zZWQgYXMgVnVlLnByb3RvdHlwZS5fawogICAqIHBhc3NpbmcgaW4gZXZlbnRLZXlOYW1lIGFzIGxhc3QgYXJndW1lbnQgc2VwYXJhdGVseSBmb3IgYmFja3dhcmRzIGNvbXBhdAogICAqLwogIGZ1bmN0aW9uIGNoZWNrS2V5Q29kZXMgKAogICAgZXZlbnRLZXlDb2RlLAogICAga2V5LAogICAgYnVpbHRJbktleUNvZGUsCiAgICBldmVudEtleU5hbWUsCiAgICBidWlsdEluS2V5TmFtZQogICkgewogICAgdmFyIG1hcHBlZEtleUNvZGUgPSBjb25maWcua2V5Q29kZXNba2V5XSB8fCBidWlsdEluS2V5Q29kZTsKICAgIGlmIChidWlsdEluS2V5TmFtZSAmJiBldmVudEtleU5hbWUgJiYgIWNvbmZpZy5rZXlDb2Rlc1trZXldKSB7CiAgICAgIHJldHVybiBpc0tleU5vdE1hdGNoKGJ1aWx0SW5LZXlOYW1lLCBldmVudEtleU5hbWUpCiAgICB9IGVsc2UgaWYgKG1hcHBlZEtleUNvZGUpIHsKICAgICAgcmV0dXJuIGlzS2V5Tm90TWF0Y2gobWFwcGVkS2V5Q29kZSwgZXZlbnRLZXlDb2RlKQogICAgfSBlbHNlIGlmIChldmVudEtleU5hbWUpIHsKICAgICAgcmV0dXJuIGh5cGhlbmF0ZShldmVudEtleU5hbWUpICE9PSBrZXkKICAgIH0KICB9CgogIC8qICAqLwoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3IgbWVyZ2luZyB2LWJpbmQ9Im9iamVjdCIgaW50byBhIFZOb2RlJ3MgZGF0YS4KICAgKi8KICBmdW5jdGlvbiBiaW5kT2JqZWN0UHJvcHMgKAogICAgZGF0YSwKICAgIHRhZywKICAgIHZhbHVlLAogICAgYXNQcm9wLAogICAgaXNTeW5jCiAgKSB7CiAgICBpZiAodmFsdWUpIHsKICAgICAgaWYgKCFpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ3YtYmluZCB3aXRob3V0IGFyZ3VtZW50IGV4cGVjdHMgYW4gT2JqZWN0IG9yIEFycmF5IHZhbHVlJywKICAgICAgICAgIHRoaXMKICAgICAgICApOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgICAgdmFsdWUgPSB0b09iamVjdCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHZhciBoYXNoOwogICAgICAgIHZhciBsb29wID0gZnVuY3Rpb24gKCBrZXkgKSB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGtleSA9PT0gJ2NsYXNzJyB8fAogICAgICAgICAgICBrZXkgPT09ICdzdHlsZScgfHwKICAgICAgICAgICAgaXNSZXNlcnZlZEF0dHJpYnV0ZShrZXkpCiAgICAgICAgICApIHsKICAgICAgICAgICAgaGFzaCA9IGRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgdHlwZSA9IGRhdGEuYXR0cnMgJiYgZGF0YS5hdHRycy50eXBlOwogICAgICAgICAgICBoYXNoID0gYXNQcm9wIHx8IGNvbmZpZy5tdXN0VXNlUHJvcCh0YWcsIHR5cGUsIGtleSkKICAgICAgICAgICAgICA/IGRhdGEuZG9tUHJvcHMgfHwgKGRhdGEuZG9tUHJvcHMgPSB7fSkKICAgICAgICAgICAgICA6IGRhdGEuYXR0cnMgfHwgKGRhdGEuYXR0cnMgPSB7fSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgY2FtZWxpemVkS2V5ID0gY2FtZWxpemUoa2V5KTsKICAgICAgICAgIHZhciBoeXBoZW5hdGVkS2V5ID0gaHlwaGVuYXRlKGtleSk7CiAgICAgICAgICBpZiAoIShjYW1lbGl6ZWRLZXkgaW4gaGFzaCkgJiYgIShoeXBoZW5hdGVkS2V5IGluIGhhc2gpKSB7CiAgICAgICAgICAgIGhhc2hba2V5XSA9IHZhbHVlW2tleV07CgogICAgICAgICAgICBpZiAoaXNTeW5jKSB7CiAgICAgICAgICAgICAgdmFyIG9uID0gZGF0YS5vbiB8fCAoZGF0YS5vbiA9IHt9KTsKICAgICAgICAgICAgICBvblsoInVwZGF0ZToiICsga2V5KV0gPSBmdW5jdGlvbiAoJGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YWx1ZVtrZXldID0gJGV2ZW50OwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIGxvb3AoIGtleSApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZGF0YQogIH0KCiAgLyogICovCgogIC8qKgogICAqIFJ1bnRpbWUgaGVscGVyIGZvciByZW5kZXJpbmcgc3RhdGljIHRyZWVzLgogICAqLwogIGZ1bmN0aW9uIHJlbmRlclN0YXRpYyAoCiAgICBpbmRleCwKICAgIGlzSW5Gb3IKICApIHsKICAgIHZhciBjYWNoZWQgPSB0aGlzLl9zdGF0aWNUcmVlcyB8fCAodGhpcy5fc3RhdGljVHJlZXMgPSBbXSk7CiAgICB2YXIgdHJlZSA9IGNhY2hlZFtpbmRleF07CiAgICAvLyBpZiBoYXMgYWxyZWFkeS1yZW5kZXJlZCBzdGF0aWMgdHJlZSBhbmQgbm90IGluc2lkZSB2LWZvciwKICAgIC8vIHdlIGNhbiByZXVzZSB0aGUgc2FtZSB0cmVlLgogICAgaWYgKHRyZWUgJiYgIWlzSW5Gb3IpIHsKICAgICAgcmV0dXJuIHRyZWUKICAgIH0KICAgIC8vIG90aGVyd2lzZSwgcmVuZGVyIGEgZnJlc2ggdHJlZS4KICAgIHRyZWUgPSBjYWNoZWRbaW5kZXhdID0gdGhpcy4kb3B0aW9ucy5zdGF0aWNSZW5kZXJGbnNbaW5kZXhdLmNhbGwoCiAgICAgIHRoaXMuX3JlbmRlclByb3h5LAogICAgICBudWxsLAogICAgICB0aGlzIC8vIGZvciByZW5kZXIgZm5zIGdlbmVyYXRlZCBmb3IgZnVuY3Rpb25hbCBjb21wb25lbnQgdGVtcGxhdGVzCiAgICApOwogICAgbWFya1N0YXRpYyh0cmVlLCAoIl9fc3RhdGljX18iICsgaW5kZXgpLCBmYWxzZSk7CiAgICByZXR1cm4gdHJlZQogIH0KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHYtb25jZS4KICAgKiBFZmZlY3RpdmVseSBpdCBtZWFucyBtYXJraW5nIHRoZSBub2RlIGFzIHN0YXRpYyB3aXRoIGEgdW5pcXVlIGtleS4KICAgKi8KICBmdW5jdGlvbiBtYXJrT25jZSAoCiAgICB0cmVlLAogICAgaW5kZXgsCiAgICBrZXkKICApIHsKICAgIG1hcmtTdGF0aWModHJlZSwgKCJfX29uY2VfXyIgKyBpbmRleCArIChrZXkgPyAoIl8iICsga2V5KSA6ICIiKSksIHRydWUpOwogICAgcmV0dXJuIHRyZWUKICB9CgogIGZ1bmN0aW9uIG1hcmtTdGF0aWMgKAogICAgdHJlZSwKICAgIGtleSwKICAgIGlzT25jZQogICkgewogICAgaWYgKEFycmF5LmlzQXJyYXkodHJlZSkpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0cmVlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRyZWVbaV0gJiYgdHlwZW9mIHRyZWVbaV0gIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBtYXJrU3RhdGljTm9kZSh0cmVlW2ldLCAoa2V5ICsgIl8iICsgaSksIGlzT25jZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBtYXJrU3RhdGljTm9kZSh0cmVlLCBrZXksIGlzT25jZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBtYXJrU3RhdGljTm9kZSAobm9kZSwga2V5LCBpc09uY2UpIHsKICAgIG5vZGUuaXNTdGF0aWMgPSB0cnVlOwogICAgbm9kZS5rZXkgPSBrZXk7CiAgICBub2RlLmlzT25jZSA9IGlzT25jZTsKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBiaW5kT2JqZWN0TGlzdGVuZXJzIChkYXRhLCB2YWx1ZSkgewogICAgaWYgKHZhbHVlKSB7CiAgICAgIGlmICghaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ3Ytb24gd2l0aG91dCBhcmd1bWVudCBleHBlY3RzIGFuIE9iamVjdCB2YWx1ZScsCiAgICAgICAgICB0aGlzCiAgICAgICAgKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgb24gPSBkYXRhLm9uID0gZGF0YS5vbiA/IGV4dGVuZCh7fSwgZGF0YS5vbikgOiB7fTsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHsKICAgICAgICAgIHZhciBleGlzdGluZyA9IG9uW2tleV07CiAgICAgICAgICB2YXIgb3VycyA9IHZhbHVlW2tleV07CiAgICAgICAgICBvbltrZXldID0gZXhpc3RpbmcgPyBbXS5jb25jYXQoZXhpc3RpbmcsIG91cnMpIDogb3VyczsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gcmVzb2x2ZVNjb3BlZFNsb3RzICgKICAgIGZucywgLy8gc2VlIGZsb3cvdm5vZGUKICAgIHJlcywKICAgIC8vIHRoZSBmb2xsb3dpbmcgYXJlIGFkZGVkIGluIDIuNgogICAgaGFzRHluYW1pY0tleXMsCiAgICBjb250ZW50SGFzaEtleQogICkgewogICAgcmVzID0gcmVzIHx8IHsgJHN0YWJsZTogIWhhc0R5bmFtaWNLZXlzIH07CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZucy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc2xvdCA9IGZuc1tpXTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2xvdCkpIHsKICAgICAgICByZXNvbHZlU2NvcGVkU2xvdHMoc2xvdCwgcmVzLCBoYXNEeW5hbWljS2V5cyk7CiAgICAgIH0gZWxzZSBpZiAoc2xvdCkgewogICAgICAgIC8vIG1hcmtlciBmb3IgcmV2ZXJzZSBwcm94eWluZyB2LXNsb3Qgd2l0aG91dCBzY29wZSBvbiB0aGlzLiRzbG90cwogICAgICAgIGlmIChzbG90LnByb3h5KSB7CiAgICAgICAgICBzbG90LmZuLnByb3h5ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmVzW3Nsb3Qua2V5XSA9IHNsb3QuZm47CiAgICAgIH0KICAgIH0KICAgIGlmIChjb250ZW50SGFzaEtleSkgewogICAgICAocmVzKS4ka2V5ID0gY29udGVudEhhc2hLZXk7CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gYmluZER5bmFtaWNLZXlzIChiYXNlT2JqLCB2YWx1ZXMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHZhciBrZXkgPSB2YWx1ZXNbaV07CiAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyAmJiBrZXkpIHsKICAgICAgICBiYXNlT2JqW3ZhbHVlc1tpXV0gPSB2YWx1ZXNbaSArIDFdOwogICAgICB9IGVsc2UgaWYgKGtleSAhPT0gJycgJiYga2V5ICE9PSBudWxsKSB7CiAgICAgICAgLy8gbnVsbCBpcyBhIHNwZWNpYWwgdmFsdWUgZm9yIGV4cGxpY2l0bHkgcmVtb3ZpbmcgYSBiaW5kaW5nCiAgICAgICAgd2FybigKICAgICAgICAgICgiSW52YWxpZCB2YWx1ZSBmb3IgZHluYW1pYyBkaXJlY3RpdmUgYXJndW1lbnQgKGV4cGVjdGVkIHN0cmluZyBvciBudWxsKTogIiArIGtleSksCiAgICAgICAgICB0aGlzCiAgICAgICAgKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGJhc2VPYmoKICB9CgogIC8vIGhlbHBlciB0byBkeW5hbWljYWxseSBhcHBlbmQgbW9kaWZpZXIgcnVudGltZSBtYXJrZXJzIHRvIGV2ZW50IG5hbWVzLgogIC8vIGVuc3VyZSBvbmx5IGFwcGVuZCB3aGVuIHZhbHVlIGlzIGFscmVhZHkgc3RyaW5nLCBvdGhlcndpc2UgaXQgd2lsbCBiZSBjYXN0CiAgLy8gdG8gc3RyaW5nIGFuZCBjYXVzZSB0aGUgdHlwZSBjaGVjayB0byBtaXNzLgogIGZ1bmN0aW9uIHByZXBlbmRNb2RpZmllciAodmFsdWUsIHN5bWJvbCkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyBzeW1ib2wgKyB2YWx1ZSA6IHZhbHVlCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5zdGFsbFJlbmRlckhlbHBlcnMgKHRhcmdldCkgewogICAgdGFyZ2V0Ll9vID0gbWFya09uY2U7CiAgICB0YXJnZXQuX24gPSB0b051bWJlcjsKICAgIHRhcmdldC5fcyA9IHRvU3RyaW5nOwogICAgdGFyZ2V0Ll9sID0gcmVuZGVyTGlzdDsKICAgIHRhcmdldC5fdCA9IHJlbmRlclNsb3Q7CiAgICB0YXJnZXQuX3EgPSBsb29zZUVxdWFsOwogICAgdGFyZ2V0Ll9pID0gbG9vc2VJbmRleE9mOwogICAgdGFyZ2V0Ll9tID0gcmVuZGVyU3RhdGljOwogICAgdGFyZ2V0Ll9mID0gcmVzb2x2ZUZpbHRlcjsKICAgIHRhcmdldC5fayA9IGNoZWNrS2V5Q29kZXM7CiAgICB0YXJnZXQuX2IgPSBiaW5kT2JqZWN0UHJvcHM7CiAgICB0YXJnZXQuX3YgPSBjcmVhdGVUZXh0Vk5vZGU7CiAgICB0YXJnZXQuX2UgPSBjcmVhdGVFbXB0eVZOb2RlOwogICAgdGFyZ2V0Ll91ID0gcmVzb2x2ZVNjb3BlZFNsb3RzOwogICAgdGFyZ2V0Ll9nID0gYmluZE9iamVjdExpc3RlbmVyczsKICAgIHRhcmdldC5fZCA9IGJpbmREeW5hbWljS2V5czsKICAgIHRhcmdldC5fcCA9IHByZXBlbmRNb2RpZmllcjsKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBGdW5jdGlvbmFsUmVuZGVyQ29udGV4dCAoCiAgICBkYXRhLAogICAgcHJvcHMsCiAgICBjaGlsZHJlbiwKICAgIHBhcmVudCwKICAgIEN0b3IKICApIHsKICAgIHZhciB0aGlzJDEgPSB0aGlzOwoKICAgIHZhciBvcHRpb25zID0gQ3Rvci5vcHRpb25zOwogICAgLy8gZW5zdXJlIHRoZSBjcmVhdGVFbGVtZW50IGZ1bmN0aW9uIGluIGZ1bmN0aW9uYWwgY29tcG9uZW50cwogICAgLy8gZ2V0cyBhIHVuaXF1ZSBjb250ZXh0IC0gdGhpcyBpcyBuZWNlc3NhcnkgZm9yIGNvcnJlY3QgbmFtZWQgc2xvdCBjaGVjawogICAgdmFyIGNvbnRleHRWbTsKICAgIGlmIChoYXNPd24ocGFyZW50LCAnX3VpZCcpKSB7CiAgICAgIGNvbnRleHRWbSA9IE9iamVjdC5jcmVhdGUocGFyZW50KTsKICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgIGNvbnRleHRWbS5fb3JpZ2luYWwgPSBwYXJlbnQ7CiAgICB9IGVsc2UgewogICAgICAvLyB0aGUgY29udGV4dCB2bSBwYXNzZWQgaW4gaXMgYSBmdW5jdGlvbmFsIGNvbnRleHQgYXMgd2VsbC4KICAgICAgLy8gaW4gdGhpcyBjYXNlIHdlIHdhbnQgdG8gbWFrZSBzdXJlIHdlIGFyZSBhYmxlIHRvIGdldCBhIGhvbGQgdG8gdGhlCiAgICAgIC8vIHJlYWwgY29udGV4dCBpbnN0YW5jZS4KICAgICAgY29udGV4dFZtID0gcGFyZW50OwogICAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgICAgcGFyZW50ID0gcGFyZW50Ll9vcmlnaW5hbDsKICAgIH0KICAgIHZhciBpc0NvbXBpbGVkID0gaXNUcnVlKG9wdGlvbnMuX2NvbXBpbGVkKTsKICAgIHZhciBuZWVkTm9ybWFsaXphdGlvbiA9ICFpc0NvbXBpbGVkOwoKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLnByb3BzID0gcHJvcHM7CiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47CiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICAgIHRoaXMubGlzdGVuZXJzID0gZGF0YS5vbiB8fCBlbXB0eU9iamVjdDsKICAgIHRoaXMuaW5qZWN0aW9ucyA9IHJlc29sdmVJbmplY3Qob3B0aW9ucy5pbmplY3QsIHBhcmVudCk7CiAgICB0aGlzLnNsb3RzID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAoIXRoaXMkMS4kc2xvdHMpIHsKICAgICAgICBub3JtYWxpemVTY29wZWRTbG90cygKICAgICAgICAgIGRhdGEuc2NvcGVkU2xvdHMsCiAgICAgICAgICB0aGlzJDEuJHNsb3RzID0gcmVzb2x2ZVNsb3RzKGNoaWxkcmVuLCBwYXJlbnQpCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcyQxLiRzbG90cwogICAgfTsKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ3Njb3BlZFNsb3RzJywgKHsKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQgKCkgewogICAgICAgIHJldHVybiBub3JtYWxpemVTY29wZWRTbG90cyhkYXRhLnNjb3BlZFNsb3RzLCB0aGlzLnNsb3RzKCkpCiAgICAgIH0KICAgIH0pKTsKCiAgICAvLyBzdXBwb3J0IGZvciBjb21waWxlZCBmdW5jdGlvbmFsIHRlbXBsYXRlCiAgICBpZiAoaXNDb21waWxlZCkgewogICAgICAvLyBleHBvc2luZyAkb3B0aW9ucyBmb3IgcmVuZGVyU3RhdGljKCkKICAgICAgdGhpcy4kb3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIC8vIHByZS1yZXNvbHZlIHNsb3RzIGZvciByZW5kZXJTbG90KCkKICAgICAgdGhpcy4kc2xvdHMgPSB0aGlzLnNsb3RzKCk7CiAgICAgIHRoaXMuJHNjb3BlZFNsb3RzID0gbm9ybWFsaXplU2NvcGVkU2xvdHMoZGF0YS5zY29wZWRTbG90cywgdGhpcy4kc2xvdHMpOwogICAgfQoKICAgIGlmIChvcHRpb25zLl9zY29wZUlkKSB7CiAgICAgIHRoaXMuX2MgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIHZhciB2bm9kZSA9IGNyZWF0ZUVsZW1lbnQoY29udGV4dFZtLCBhLCBiLCBjLCBkLCBuZWVkTm9ybWFsaXphdGlvbik7CiAgICAgICAgaWYgKHZub2RlICYmICFBcnJheS5pc0FycmF5KHZub2RlKSkgewogICAgICAgICAgdm5vZGUuZm5TY29wZUlkID0gb3B0aW9ucy5fc2NvcGVJZDsKICAgICAgICAgIHZub2RlLmZuQ29udGV4dCA9IHBhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZub2RlCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9jID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgcmV0dXJuIGNyZWF0ZUVsZW1lbnQoY29udGV4dFZtLCBhLCBiLCBjLCBkLCBuZWVkTm9ybWFsaXphdGlvbik7IH07CiAgICB9CiAgfQoKICBpbnN0YWxsUmVuZGVySGVscGVycyhGdW5jdGlvbmFsUmVuZGVyQ29udGV4dC5wcm90b3R5cGUpOwoKICBmdW5jdGlvbiBjcmVhdGVGdW5jdGlvbmFsQ29tcG9uZW50ICgKICAgIEN0b3IsCiAgICBwcm9wc0RhdGEsCiAgICBkYXRhLAogICAgY29udGV4dFZtLAogICAgY2hpbGRyZW4KICApIHsKICAgIHZhciBvcHRpb25zID0gQ3Rvci5vcHRpb25zOwogICAgdmFyIHByb3BzID0ge307CiAgICB2YXIgcHJvcE9wdGlvbnMgPSBvcHRpb25zLnByb3BzOwogICAgaWYgKGlzRGVmKHByb3BPcHRpb25zKSkgewogICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcE9wdGlvbnMpIHsKICAgICAgICBwcm9wc1trZXldID0gdmFsaWRhdGVQcm9wKGtleSwgcHJvcE9wdGlvbnMsIHByb3BzRGF0YSB8fCBlbXB0eU9iamVjdCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChpc0RlZihkYXRhLmF0dHJzKSkgeyBtZXJnZVByb3BzKHByb3BzLCBkYXRhLmF0dHJzKTsgfQogICAgICBpZiAoaXNEZWYoZGF0YS5wcm9wcykpIHsgbWVyZ2VQcm9wcyhwcm9wcywgZGF0YS5wcm9wcyk7IH0KICAgIH0KCiAgICB2YXIgcmVuZGVyQ29udGV4dCA9IG5ldyBGdW5jdGlvbmFsUmVuZGVyQ29udGV4dCgKICAgICAgZGF0YSwKICAgICAgcHJvcHMsCiAgICAgIGNoaWxkcmVuLAogICAgICBjb250ZXh0Vm0sCiAgICAgIEN0b3IKICAgICk7CgogICAgdmFyIHZub2RlID0gb3B0aW9ucy5yZW5kZXIuY2FsbChudWxsLCByZW5kZXJDb250ZXh0Ll9jLCByZW5kZXJDb250ZXh0KTsKCiAgICBpZiAodm5vZGUgaW5zdGFuY2VvZiBWTm9kZSkgewogICAgICByZXR1cm4gY2xvbmVBbmRNYXJrRnVuY3Rpb25hbFJlc3VsdCh2bm9kZSwgZGF0YSwgcmVuZGVyQ29udGV4dC5wYXJlbnQsIG9wdGlvbnMsIHJlbmRlckNvbnRleHQpCiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodm5vZGUpKSB7CiAgICAgIHZhciB2bm9kZXMgPSBub3JtYWxpemVDaGlsZHJlbih2bm9kZSkgfHwgW107CiAgICAgIHZhciByZXMgPSBuZXcgQXJyYXkodm5vZGVzLmxlbmd0aCk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcmVzW2ldID0gY2xvbmVBbmRNYXJrRnVuY3Rpb25hbFJlc3VsdCh2bm9kZXNbaV0sIGRhdGEsIHJlbmRlckNvbnRleHQucGFyZW50LCBvcHRpb25zLCByZW5kZXJDb250ZXh0KTsKICAgICAgfQogICAgICByZXR1cm4gcmVzCiAgICB9CiAgfQoKICBmdW5jdGlvbiBjbG9uZUFuZE1hcmtGdW5jdGlvbmFsUmVzdWx0ICh2bm9kZSwgZGF0YSwgY29udGV4dFZtLCBvcHRpb25zLCByZW5kZXJDb250ZXh0KSB7CiAgICAvLyAjNzgxNyBjbG9uZSBub2RlIGJlZm9yZSBzZXR0aW5nIGZuQ29udGV4dCwgb3RoZXJ3aXNlIGlmIHRoZSBub2RlIGlzIHJldXNlZAogICAgLy8gKGUuZy4gaXQgd2FzIGZyb20gYSBjYWNoZWQgbm9ybWFsIHNsb3QpIHRoZSBmbkNvbnRleHQgY2F1c2VzIG5hbWVkIHNsb3RzCiAgICAvLyB0aGF0IHNob3VsZCBub3QgYmUgbWF0Y2hlZCB0byBtYXRjaC4KICAgIHZhciBjbG9uZSA9IGNsb25lVk5vZGUodm5vZGUpOwogICAgY2xvbmUuZm5Db250ZXh0ID0gY29udGV4dFZtOwogICAgY2xvbmUuZm5PcHRpb25zID0gb3B0aW9uczsKICAgIHsKICAgICAgKGNsb25lLmRldnRvb2xzTWV0YSA9IGNsb25lLmRldnRvb2xzTWV0YSB8fCB7fSkucmVuZGVyQ29udGV4dCA9IHJlbmRlckNvbnRleHQ7CiAgICB9CiAgICBpZiAoZGF0YS5zbG90KSB7CiAgICAgIChjbG9uZS5kYXRhIHx8IChjbG9uZS5kYXRhID0ge30pKS5zbG90ID0gZGF0YS5zbG90OwogICAgfQogICAgcmV0dXJuIGNsb25lCiAgfQoKICBmdW5jdGlvbiBtZXJnZVByb3BzICh0bywgZnJvbSkgewogICAgZm9yICh2YXIga2V5IGluIGZyb20pIHsKICAgICAgdG9bY2FtZWxpemUoa2V5KV0gPSBmcm9tW2tleV07CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyogICovCgogIC8qICAqLwoKICAvKiAgKi8KCiAgLy8gaW5saW5lIGhvb2tzIHRvIGJlIGludm9rZWQgb24gY29tcG9uZW50IFZOb2RlcyBkdXJpbmcgcGF0Y2gKICB2YXIgY29tcG9uZW50Vk5vZGVIb29rcyA9IHsKICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQgKHZub2RlLCBoeWRyYXRpbmcpIHsKICAgICAgaWYgKAogICAgICAgIHZub2RlLmNvbXBvbmVudEluc3RhbmNlICYmCiAgICAgICAgIXZub2RlLmNvbXBvbmVudEluc3RhbmNlLl9pc0Rlc3Ryb3llZCAmJgogICAgICAgIHZub2RlLmRhdGEua2VlcEFsaXZlCiAgICAgICkgewogICAgICAgIC8vIGtlcHQtYWxpdmUgY29tcG9uZW50cywgdHJlYXQgYXMgYSBwYXRjaAogICAgICAgIHZhciBtb3VudGVkTm9kZSA9IHZub2RlOyAvLyB3b3JrIGFyb3VuZCBmbG93CiAgICAgICAgY29tcG9uZW50Vk5vZGVIb29rcy5wcmVwYXRjaChtb3VudGVkTm9kZSwgbW91bnRlZE5vZGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBjaGlsZCA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlID0gY3JlYXRlQ29tcG9uZW50SW5zdGFuY2VGb3JWbm9kZSgKICAgICAgICAgIHZub2RlLAogICAgICAgICAgYWN0aXZlSW5zdGFuY2UKICAgICAgICApOwogICAgICAgIGNoaWxkLiRtb3VudChoeWRyYXRpbmcgPyB2bm9kZS5lbG0gOiB1bmRlZmluZWQsIGh5ZHJhdGluZyk7CiAgICAgIH0KICAgIH0sCgogICAgcHJlcGF0Y2g6IGZ1bmN0aW9uIHByZXBhdGNoIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB2bm9kZS5jb21wb25lbnRPcHRpb25zOwogICAgICB2YXIgY2hpbGQgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSA9IG9sZFZub2RlLmNvbXBvbmVudEluc3RhbmNlOwogICAgICB1cGRhdGVDaGlsZENvbXBvbmVudCgKICAgICAgICBjaGlsZCwKICAgICAgICBvcHRpb25zLnByb3BzRGF0YSwgLy8gdXBkYXRlZCBwcm9wcwogICAgICAgIG9wdGlvbnMubGlzdGVuZXJzLCAvLyB1cGRhdGVkIGxpc3RlbmVycwogICAgICAgIHZub2RlLCAvLyBuZXcgcGFyZW50IHZub2RlCiAgICAgICAgb3B0aW9ucy5jaGlsZHJlbiAvLyBuZXcgY2hpbGRyZW4KICAgICAgKTsKICAgIH0sCgogICAgaW5zZXJ0OiBmdW5jdGlvbiBpbnNlcnQgKHZub2RlKSB7CiAgICAgIHZhciBjb250ZXh0ID0gdm5vZGUuY29udGV4dDsKICAgICAgdmFyIGNvbXBvbmVudEluc3RhbmNlID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICAgIGlmICghY29tcG9uZW50SW5zdGFuY2UuX2lzTW91bnRlZCkgewogICAgICAgIGNvbXBvbmVudEluc3RhbmNlLl9pc01vdW50ZWQgPSB0cnVlOwogICAgICAgIGNhbGxIb29rKGNvbXBvbmVudEluc3RhbmNlLCAnbW91bnRlZCcpOwogICAgICB9CiAgICAgIGlmICh2bm9kZS5kYXRhLmtlZXBBbGl2ZSkgewogICAgICAgIGlmIChjb250ZXh0Ll9pc01vdW50ZWQpIHsKICAgICAgICAgIC8vIHZ1ZS1yb3V0ZXIjMTIxMgogICAgICAgICAgLy8gRHVyaW5nIHVwZGF0ZXMsIGEga2VwdC1hbGl2ZSBjb21wb25lbnQncyBjaGlsZCBjb21wb25lbnRzIG1heQogICAgICAgICAgLy8gY2hhbmdlLCBzbyBkaXJlY3RseSB3YWxraW5nIHRoZSB0cmVlIGhlcmUgbWF5IGNhbGwgYWN0aXZhdGVkIGhvb2tzCiAgICAgICAgICAvLyBvbiBpbmNvcnJlY3QgY2hpbGRyZW4uIEluc3RlYWQgd2UgcHVzaCB0aGVtIGludG8gYSBxdWV1ZSB3aGljaCB3aWxsCiAgICAgICAgICAvLyBiZSBwcm9jZXNzZWQgYWZ0ZXIgdGhlIHdob2xlIHBhdGNoIHByb2Nlc3MgZW5kZWQuCiAgICAgICAgICBxdWV1ZUFjdGl2YXRlZENvbXBvbmVudChjb21wb25lbnRJbnN0YW5jZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFjdGl2YXRlQ2hpbGRDb21wb25lbnQoY29tcG9uZW50SW5zdGFuY2UsIHRydWUgLyogZGlyZWN0ICovKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSAodm5vZGUpIHsKICAgICAgdmFyIGNvbXBvbmVudEluc3RhbmNlID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICAgIGlmICghY29tcG9uZW50SW5zdGFuY2UuX2lzRGVzdHJveWVkKSB7CiAgICAgICAgaWYgKCF2bm9kZS5kYXRhLmtlZXBBbGl2ZSkgewogICAgICAgICAgY29tcG9uZW50SW5zdGFuY2UuJGRlc3Ryb3koKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVhY3RpdmF0ZUNoaWxkQ29tcG9uZW50KGNvbXBvbmVudEluc3RhbmNlLCB0cnVlIC8qIGRpcmVjdCAqLyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIGhvb2tzVG9NZXJnZSA9IE9iamVjdC5rZXlzKGNvbXBvbmVudFZOb2RlSG9va3MpOwoKICBmdW5jdGlvbiBjcmVhdGVDb21wb25lbnQgKAogICAgQ3RvciwKICAgIGRhdGEsCiAgICBjb250ZXh0LAogICAgY2hpbGRyZW4sCiAgICB0YWcKICApIHsKICAgIGlmIChpc1VuZGVmKEN0b3IpKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBiYXNlQ3RvciA9IGNvbnRleHQuJG9wdGlvbnMuX2Jhc2U7CgogICAgLy8gcGxhaW4gb3B0aW9ucyBvYmplY3Q6IHR1cm4gaXQgaW50byBhIGNvbnN0cnVjdG9yCiAgICBpZiAoaXNPYmplY3QoQ3RvcikpIHsKICAgICAgQ3RvciA9IGJhc2VDdG9yLmV4dGVuZChDdG9yKTsKICAgIH0KCiAgICAvLyBpZiBhdCB0aGlzIHN0YWdlIGl0J3Mgbm90IGEgY29uc3RydWN0b3Igb3IgYW4gYXN5bmMgY29tcG9uZW50IGZhY3RvcnksCiAgICAvLyByZWplY3QuCiAgICBpZiAodHlwZW9mIEN0b3IgIT09ICdmdW5jdGlvbicpIHsKICAgICAgewogICAgICAgIHdhcm4oKCJJbnZhbGlkIENvbXBvbmVudCBkZWZpbml0aW9uOiAiICsgKFN0cmluZyhDdG9yKSkpLCBjb250ZXh0KTsKICAgICAgfQogICAgICByZXR1cm4KICAgIH0KCiAgICAvLyBhc3luYyBjb21wb25lbnQKICAgIHZhciBhc3luY0ZhY3Rvcnk7CiAgICBpZiAoaXNVbmRlZihDdG9yLmNpZCkpIHsKICAgICAgYXN5bmNGYWN0b3J5ID0gQ3RvcjsKICAgICAgQ3RvciA9IHJlc29sdmVBc3luY0NvbXBvbmVudChhc3luY0ZhY3RvcnksIGJhc2VDdG9yKTsKICAgICAgaWYgKEN0b3IgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIHJldHVybiBhIHBsYWNlaG9sZGVyIG5vZGUgZm9yIGFzeW5jIGNvbXBvbmVudCwgd2hpY2ggaXMgcmVuZGVyZWQKICAgICAgICAvLyBhcyBhIGNvbW1lbnQgbm9kZSBidXQgcHJlc2VydmVzIGFsbCB0aGUgcmF3IGluZm9ybWF0aW9uIGZvciB0aGUgbm9kZS4KICAgICAgICAvLyB0aGUgaW5mb3JtYXRpb24gd2lsbCBiZSB1c2VkIGZvciBhc3luYyBzZXJ2ZXItcmVuZGVyaW5nIGFuZCBoeWRyYXRpb24uCiAgICAgICAgcmV0dXJuIGNyZWF0ZUFzeW5jUGxhY2Vob2xkZXIoCiAgICAgICAgICBhc3luY0ZhY3RvcnksCiAgICAgICAgICBkYXRhLAogICAgICAgICAgY29udGV4dCwKICAgICAgICAgIGNoaWxkcmVuLAogICAgICAgICAgdGFnCiAgICAgICAgKQogICAgICB9CiAgICB9CgogICAgZGF0YSA9IGRhdGEgfHwge307CgogICAgLy8gcmVzb2x2ZSBjb25zdHJ1Y3RvciBvcHRpb25zIGluIGNhc2UgZ2xvYmFsIG1peGlucyBhcmUgYXBwbGllZCBhZnRlcgogICAgLy8gY29tcG9uZW50IGNvbnN0cnVjdG9yIGNyZWF0aW9uCiAgICByZXNvbHZlQ29uc3RydWN0b3JPcHRpb25zKEN0b3IpOwoKICAgIC8vIHRyYW5zZm9ybSBjb21wb25lbnQgdi1tb2RlbCBkYXRhIGludG8gcHJvcHMgJiBldmVudHMKICAgIGlmIChpc0RlZihkYXRhLm1vZGVsKSkgewogICAgICB0cmFuc2Zvcm1Nb2RlbChDdG9yLm9wdGlvbnMsIGRhdGEpOwogICAgfQoKICAgIC8vIGV4dHJhY3QgcHJvcHMKICAgIHZhciBwcm9wc0RhdGEgPSBleHRyYWN0UHJvcHNGcm9tVk5vZGVEYXRhKGRhdGEsIEN0b3IsIHRhZyk7CgogICAgLy8gZnVuY3Rpb25hbCBjb21wb25lbnQKICAgIGlmIChpc1RydWUoQ3Rvci5vcHRpb25zLmZ1bmN0aW9uYWwpKSB7CiAgICAgIHJldHVybiBjcmVhdGVGdW5jdGlvbmFsQ29tcG9uZW50KEN0b3IsIHByb3BzRGF0YSwgZGF0YSwgY29udGV4dCwgY2hpbGRyZW4pCiAgICB9CgogICAgLy8gZXh0cmFjdCBsaXN0ZW5lcnMsIHNpbmNlIHRoZXNlIG5lZWRzIHRvIGJlIHRyZWF0ZWQgYXMKICAgIC8vIGNoaWxkIGNvbXBvbmVudCBsaXN0ZW5lcnMgaW5zdGVhZCBvZiBET00gbGlzdGVuZXJzCiAgICB2YXIgbGlzdGVuZXJzID0gZGF0YS5vbjsKICAgIC8vIHJlcGxhY2Ugd2l0aCBsaXN0ZW5lcnMgd2l0aCAubmF0aXZlIG1vZGlmaWVyCiAgICAvLyBzbyBpdCBnZXRzIHByb2Nlc3NlZCBkdXJpbmcgcGFyZW50IGNvbXBvbmVudCBwYXRjaC4KICAgIGRhdGEub24gPSBkYXRhLm5hdGl2ZU9uOwoKICAgIGlmIChpc1RydWUoQ3Rvci5vcHRpb25zLmFic3RyYWN0KSkgewogICAgICAvLyBhYnN0cmFjdCBjb21wb25lbnRzIGRvIG5vdCBrZWVwIGFueXRoaW5nCiAgICAgIC8vIG90aGVyIHRoYW4gcHJvcHMgJiBsaXN0ZW5lcnMgJiBzbG90CgogICAgICAvLyB3b3JrIGFyb3VuZCBmbG93CiAgICAgIHZhciBzbG90ID0gZGF0YS5zbG90OwogICAgICBkYXRhID0ge307CiAgICAgIGlmIChzbG90KSB7CiAgICAgICAgZGF0YS5zbG90ID0gc2xvdDsKICAgICAgfQogICAgfQoKICAgIC8vIGluc3RhbGwgY29tcG9uZW50IG1hbmFnZW1lbnQgaG9va3Mgb250byB0aGUgcGxhY2Vob2xkZXIgbm9kZQogICAgaW5zdGFsbENvbXBvbmVudEhvb2tzKGRhdGEpOwoKICAgIC8vIHJldHVybiBhIHBsYWNlaG9sZGVyIHZub2RlCiAgICB2YXIgbmFtZSA9IEN0b3Iub3B0aW9ucy5uYW1lIHx8IHRhZzsKICAgIHZhciB2bm9kZSA9IG5ldyBWTm9kZSgKICAgICAgKCJ2dWUtY29tcG9uZW50LSIgKyAoQ3Rvci5jaWQpICsgKG5hbWUgPyAoIi0iICsgbmFtZSkgOiAnJykpLAogICAgICBkYXRhLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjb250ZXh0LAogICAgICB7IEN0b3I6IEN0b3IsIHByb3BzRGF0YTogcHJvcHNEYXRhLCBsaXN0ZW5lcnM6IGxpc3RlbmVycywgdGFnOiB0YWcsIGNoaWxkcmVuOiBjaGlsZHJlbiB9LAogICAgICBhc3luY0ZhY3RvcnkKICAgICk7CgogICAgcmV0dXJuIHZub2RlCiAgfQoKICBmdW5jdGlvbiBjcmVhdGVDb21wb25lbnRJbnN0YW5jZUZvclZub2RlICgKICAgIHZub2RlLCAvLyB3ZSBrbm93IGl0J3MgTW91bnRlZENvbXBvbmVudFZOb2RlIGJ1dCBmbG93IGRvZXNuJ3QKICAgIHBhcmVudCAvLyBhY3RpdmVJbnN0YW5jZSBpbiBsaWZlY3ljbGUgc3RhdGUKICApIHsKICAgIHZhciBvcHRpb25zID0gewogICAgICBfaXNDb21wb25lbnQ6IHRydWUsCiAgICAgIF9wYXJlbnRWbm9kZTogdm5vZGUsCiAgICAgIHBhcmVudDogcGFyZW50CiAgICB9OwogICAgLy8gY2hlY2sgaW5saW5lLXRlbXBsYXRlIHJlbmRlciBmdW5jdGlvbnMKICAgIHZhciBpbmxpbmVUZW1wbGF0ZSA9IHZub2RlLmRhdGEuaW5saW5lVGVtcGxhdGU7CiAgICBpZiAoaXNEZWYoaW5saW5lVGVtcGxhdGUpKSB7CiAgICAgIG9wdGlvbnMucmVuZGVyID0gaW5saW5lVGVtcGxhdGUucmVuZGVyOwogICAgICBvcHRpb25zLnN0YXRpY1JlbmRlckZucyA9IGlubGluZVRlbXBsYXRlLnN0YXRpY1JlbmRlckZuczsKICAgIH0KICAgIHJldHVybiBuZXcgdm5vZGUuY29tcG9uZW50T3B0aW9ucy5DdG9yKG9wdGlvbnMpCiAgfQoKICBmdW5jdGlvbiBpbnN0YWxsQ29tcG9uZW50SG9va3MgKGRhdGEpIHsKICAgIHZhciBob29rcyA9IGRhdGEuaG9vayB8fCAoZGF0YS5ob29rID0ge30pOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rc1RvTWVyZ2UubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGtleSA9IGhvb2tzVG9NZXJnZVtpXTsKICAgICAgdmFyIGV4aXN0aW5nID0gaG9va3Nba2V5XTsKICAgICAgdmFyIHRvTWVyZ2UgPSBjb21wb25lbnRWTm9kZUhvb2tzW2tleV07CiAgICAgIGlmIChleGlzdGluZyAhPT0gdG9NZXJnZSAmJiAhKGV4aXN0aW5nICYmIGV4aXN0aW5nLl9tZXJnZWQpKSB7CiAgICAgICAgaG9va3Nba2V5XSA9IGV4aXN0aW5nID8gbWVyZ2VIb29rJDEodG9NZXJnZSwgZXhpc3RpbmcpIDogdG9NZXJnZTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gbWVyZ2VIb29rJDEgKGYxLCBmMikgewogICAgdmFyIG1lcmdlZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgIC8vIGZsb3cgY29tcGxhaW5zIGFib3V0IGV4dHJhIGFyZ3Mgd2hpY2ggaXMgd2h5IHdlIHVzZSBhbnkKICAgICAgZjEoYSwgYik7CiAgICAgIGYyKGEsIGIpOwogICAgfTsKICAgIG1lcmdlZC5fbWVyZ2VkID0gdHJ1ZTsKICAgIHJldHVybiBtZXJnZWQKICB9CgogIC8vIHRyYW5zZm9ybSBjb21wb25lbnQgdi1tb2RlbCBpbmZvICh2YWx1ZSBhbmQgY2FsbGJhY2spIGludG8KICAvLyBwcm9wIGFuZCBldmVudCBoYW5kbGVyIHJlc3BlY3RpdmVseS4KICBmdW5jdGlvbiB0cmFuc2Zvcm1Nb2RlbCAob3B0aW9ucywgZGF0YSkgewogICAgdmFyIHByb3AgPSAob3B0aW9ucy5tb2RlbCAmJiBvcHRpb25zLm1vZGVsLnByb3ApIHx8ICd2YWx1ZSc7CiAgICB2YXIgZXZlbnQgPSAob3B0aW9ucy5tb2RlbCAmJiBvcHRpb25zLm1vZGVsLmV2ZW50KSB8fCAnaW5wdXQnCiAgICA7KGRhdGEuYXR0cnMgfHwgKGRhdGEuYXR0cnMgPSB7fSkpW3Byb3BdID0gZGF0YS5tb2RlbC52YWx1ZTsKICAgIHZhciBvbiA9IGRhdGEub24gfHwgKGRhdGEub24gPSB7fSk7CiAgICB2YXIgZXhpc3RpbmcgPSBvbltldmVudF07CiAgICB2YXIgY2FsbGJhY2sgPSBkYXRhLm1vZGVsLmNhbGxiYWNrOwogICAgaWYgKGlzRGVmKGV4aXN0aW5nKSkgewogICAgICBpZiAoCiAgICAgICAgQXJyYXkuaXNBcnJheShleGlzdGluZykKICAgICAgICAgID8gZXhpc3RpbmcuaW5kZXhPZihjYWxsYmFjaykgPT09IC0xCiAgICAgICAgICA6IGV4aXN0aW5nICE9PSBjYWxsYmFjawogICAgICApIHsKICAgICAgICBvbltldmVudF0gPSBbY2FsbGJhY2tdLmNvbmNhdChleGlzdGluZyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIG9uW2V2ZW50XSA9IGNhbGxiYWNrOwogICAgfQogIH0KCiAgLyogICovCgogIHZhciBTSU1QTEVfTk9STUFMSVpFID0gMTsKICB2YXIgQUxXQVlTX05PUk1BTElaRSA9IDI7CgogIC8vIHdyYXBwZXIgZnVuY3Rpb24gZm9yIHByb3ZpZGluZyBhIG1vcmUgZmxleGlibGUgaW50ZXJmYWNlCiAgLy8gd2l0aG91dCBnZXR0aW5nIHllbGxlZCBhdCBieSBmbG93CiAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCAoCiAgICBjb250ZXh0LAogICAgdGFnLAogICAgZGF0YSwKICAgIGNoaWxkcmVuLAogICAgbm9ybWFsaXphdGlvblR5cGUsCiAgICBhbHdheXNOb3JtYWxpemUKICApIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpIHx8IGlzUHJpbWl0aXZlKGRhdGEpKSB7CiAgICAgIG5vcm1hbGl6YXRpb25UeXBlID0gY2hpbGRyZW47CiAgICAgIGNoaWxkcmVuID0gZGF0YTsKICAgICAgZGF0YSA9IHVuZGVmaW5lZDsKICAgIH0KICAgIGlmIChpc1RydWUoYWx3YXlzTm9ybWFsaXplKSkgewogICAgICBub3JtYWxpemF0aW9uVHlwZSA9IEFMV0FZU19OT1JNQUxJWkU7CiAgICB9CiAgICByZXR1cm4gX2NyZWF0ZUVsZW1lbnQoY29udGV4dCwgdGFnLCBkYXRhLCBjaGlsZHJlbiwgbm9ybWFsaXphdGlvblR5cGUpCiAgfQoKICBmdW5jdGlvbiBfY3JlYXRlRWxlbWVudCAoCiAgICBjb250ZXh0LAogICAgdGFnLAogICAgZGF0YSwKICAgIGNoaWxkcmVuLAogICAgbm9ybWFsaXphdGlvblR5cGUKICApIHsKICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZigoZGF0YSkuX19vYl9fKSkgewogICAgICB3YXJuKAogICAgICAgICJBdm9pZCB1c2luZyBvYnNlcnZlZCBkYXRhIG9iamVjdCBhcyB2bm9kZSBkYXRhOiAiICsgKEpTT04uc3RyaW5naWZ5KGRhdGEpKSArICJcbiIgKwogICAgICAgICdBbHdheXMgY3JlYXRlIGZyZXNoIHZub2RlIGRhdGEgb2JqZWN0cyBpbiBlYWNoIHJlbmRlciEnLAogICAgICAgIGNvbnRleHQKICAgICAgKTsKICAgICAgcmV0dXJuIGNyZWF0ZUVtcHR5Vk5vZGUoKQogICAgfQogICAgLy8gb2JqZWN0IHN5bnRheCBpbiB2LWJpbmQKICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZihkYXRhLmlzKSkgewogICAgICB0YWcgPSBkYXRhLmlzOwogICAgfQogICAgaWYgKCF0YWcpIHsKICAgICAgLy8gaW4gY2FzZSBvZiBjb21wb25lbnQgOmlzIHNldCB0byBmYWxzeSB2YWx1ZQogICAgICByZXR1cm4gY3JlYXRlRW1wdHlWTm9kZSgpCiAgICB9CiAgICAvLyB3YXJuIGFnYWluc3Qgbm9uLXByaW1pdGl2ZSBrZXkKICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZihkYXRhLmtleSkgJiYgIWlzUHJpbWl0aXZlKGRhdGEua2V5KQogICAgKSB7CiAgICAgIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ0F2b2lkIHVzaW5nIG5vbi1wcmltaXRpdmUgdmFsdWUgYXMga2V5LCAnICsKICAgICAgICAgICd1c2Ugc3RyaW5nL251bWJlciB2YWx1ZSBpbnN0ZWFkLicsCiAgICAgICAgICBjb250ZXh0CiAgICAgICAgKTsKICAgICAgfQogICAgfQogICAgLy8gc3VwcG9ydCBzaW5nbGUgZnVuY3Rpb24gY2hpbGRyZW4gYXMgZGVmYXVsdCBzY29wZWQgc2xvdAogICAgaWYgKEFycmF5LmlzQXJyYXkoY2hpbGRyZW4pICYmCiAgICAgIHR5cGVvZiBjaGlsZHJlblswXSA9PT0gJ2Z1bmN0aW9uJwogICAgKSB7CiAgICAgIGRhdGEgPSBkYXRhIHx8IHt9OwogICAgICBkYXRhLnNjb3BlZFNsb3RzID0geyBkZWZhdWx0OiBjaGlsZHJlblswXSB9OwogICAgICBjaGlsZHJlbi5sZW5ndGggPSAwOwogICAgfQogICAgaWYgKG5vcm1hbGl6YXRpb25UeXBlID09PSBBTFdBWVNfTk9STUFMSVpFKSB7CiAgICAgIGNoaWxkcmVuID0gbm9ybWFsaXplQ2hpbGRyZW4oY2hpbGRyZW4pOwogICAgfSBlbHNlIGlmIChub3JtYWxpemF0aW9uVHlwZSA9PT0gU0lNUExFX05PUk1BTElaRSkgewogICAgICBjaGlsZHJlbiA9IHNpbXBsZU5vcm1hbGl6ZUNoaWxkcmVuKGNoaWxkcmVuKTsKICAgIH0KICAgIHZhciB2bm9kZSwgbnM7CiAgICBpZiAodHlwZW9mIHRhZyA9PT0gJ3N0cmluZycpIHsKICAgICAgdmFyIEN0b3I7CiAgICAgIG5zID0gKGNvbnRleHQuJHZub2RlICYmIGNvbnRleHQuJHZub2RlLm5zKSB8fCBjb25maWcuZ2V0VGFnTmFtZXNwYWNlKHRhZyk7CiAgICAgIGlmIChjb25maWcuaXNSZXNlcnZlZFRhZyh0YWcpKSB7CiAgICAgICAgLy8gcGxhdGZvcm0gYnVpbHQtaW4gZWxlbWVudHMKICAgICAgICBpZiAoaXNEZWYoZGF0YSkgJiYgaXNEZWYoZGF0YS5uYXRpdmVPbikpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICgiVGhlIC5uYXRpdmUgbW9kaWZpZXIgZm9yIHYtb24gaXMgb25seSB2YWxpZCBvbiBjb21wb25lbnRzIGJ1dCBpdCB3YXMgdXNlZCBvbiA8IiArIHRhZyArICI+LiIpLAogICAgICAgICAgICBjb250ZXh0CiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB2bm9kZSA9IG5ldyBWTm9kZSgKICAgICAgICAgIGNvbmZpZy5wYXJzZVBsYXRmb3JtVGFnTmFtZSh0YWcpLCBkYXRhLCBjaGlsZHJlbiwKICAgICAgICAgIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjb250ZXh0CiAgICAgICAgKTsKICAgICAgfSBlbHNlIGlmICgoIWRhdGEgfHwgIWRhdGEucHJlKSAmJiBpc0RlZihDdG9yID0gcmVzb2x2ZUFzc2V0KGNvbnRleHQuJG9wdGlvbnMsICdjb21wb25lbnRzJywgdGFnKSkpIHsKICAgICAgICAvLyBjb21wb25lbnQKICAgICAgICB2bm9kZSA9IGNyZWF0ZUNvbXBvbmVudChDdG9yLCBkYXRhLCBjb250ZXh0LCBjaGlsZHJlbiwgdGFnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB1bmtub3duIG9yIHVubGlzdGVkIG5hbWVzcGFjZWQgZWxlbWVudHMKICAgICAgICAvLyBjaGVjayBhdCBydW50aW1lIGJlY2F1c2UgaXQgbWF5IGdldCBhc3NpZ25lZCBhIG5hbWVzcGFjZSB3aGVuIGl0cwogICAgICAgIC8vIHBhcmVudCBub3JtYWxpemVzIGNoaWxkcmVuCiAgICAgICAgdm5vZGUgPSBuZXcgVk5vZGUoCiAgICAgICAgICB0YWcsIGRhdGEsIGNoaWxkcmVuLAogICAgICAgICAgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvbnRleHQKICAgICAgICApOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBkaXJlY3QgY29tcG9uZW50IG9wdGlvbnMgLyBjb25zdHJ1Y3RvcgogICAgICB2bm9kZSA9IGNyZWF0ZUNvbXBvbmVudCh0YWcsIGRhdGEsIGNvbnRleHQsIGNoaWxkcmVuKTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHZub2RlKSkgewogICAgICByZXR1cm4gdm5vZGUKICAgIH0gZWxzZSBpZiAoaXNEZWYodm5vZGUpKSB7CiAgICAgIGlmIChpc0RlZihucykpIHsgYXBwbHlOUyh2bm9kZSwgbnMpOyB9CiAgICAgIGlmIChpc0RlZihkYXRhKSkgeyByZWdpc3RlckRlZXBCaW5kaW5ncyhkYXRhKTsgfQogICAgICByZXR1cm4gdm5vZGUKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBjcmVhdGVFbXB0eVZOb2RlKCkKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFwcGx5TlMgKHZub2RlLCBucywgZm9yY2UpIHsKICAgIHZub2RlLm5zID0gbnM7CiAgICBpZiAodm5vZGUudGFnID09PSAnZm9yZWlnbk9iamVjdCcpIHsKICAgICAgLy8gdXNlIGRlZmF1bHQgbmFtZXNwYWNlIGluc2lkZSBmb3JlaWduT2JqZWN0CiAgICAgIG5zID0gdW5kZWZpbmVkOwogICAgICBmb3JjZSA9IHRydWU7CiAgICB9CiAgICBpZiAoaXNEZWYodm5vZGUuY2hpbGRyZW4pKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdm5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdmFyIGNoaWxkID0gdm5vZGUuY2hpbGRyZW5baV07CiAgICAgICAgaWYgKGlzRGVmKGNoaWxkLnRhZykgJiYgKAogICAgICAgICAgaXNVbmRlZihjaGlsZC5ucykgfHwgKGlzVHJ1ZShmb3JjZSkgJiYgY2hpbGQudGFnICE9PSAnc3ZnJykpKSB7CiAgICAgICAgICBhcHBseU5TKGNoaWxkLCBucywgZm9yY2UpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8gcmVmICM1MzE4CiAgLy8gbmVjZXNzYXJ5IHRvIGVuc3VyZSBwYXJlbnQgcmUtcmVuZGVyIHdoZW4gZGVlcCBiaW5kaW5ncyBsaWtlIDpzdHlsZSBhbmQKICAvLyA6Y2xhc3MgYXJlIHVzZWQgb24gc2xvdCBub2RlcwogIGZ1bmN0aW9uIHJlZ2lzdGVyRGVlcEJpbmRpbmdzIChkYXRhKSB7CiAgICBpZiAoaXNPYmplY3QoZGF0YS5zdHlsZSkpIHsKICAgICAgdHJhdmVyc2UoZGF0YS5zdHlsZSk7CiAgICB9CiAgICBpZiAoaXNPYmplY3QoZGF0YS5jbGFzcykpIHsKICAgICAgdHJhdmVyc2UoZGF0YS5jbGFzcyk7CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdFJlbmRlciAodm0pIHsKICAgIHZtLl92bm9kZSA9IG51bGw7IC8vIHRoZSByb290IG9mIHRoZSBjaGlsZCB0cmVlCiAgICB2bS5fc3RhdGljVHJlZXMgPSBudWxsOyAvLyB2LW9uY2UgY2FjaGVkIHRyZWVzCiAgICB2YXIgb3B0aW9ucyA9IHZtLiRvcHRpb25zOwogICAgdmFyIHBhcmVudFZub2RlID0gdm0uJHZub2RlID0gb3B0aW9ucy5fcGFyZW50Vm5vZGU7IC8vIHRoZSBwbGFjZWhvbGRlciBub2RlIGluIHBhcmVudCB0cmVlCiAgICB2YXIgcmVuZGVyQ29udGV4dCA9IHBhcmVudFZub2RlICYmIHBhcmVudFZub2RlLmNvbnRleHQ7CiAgICB2bS4kc2xvdHMgPSByZXNvbHZlU2xvdHMob3B0aW9ucy5fcmVuZGVyQ2hpbGRyZW4sIHJlbmRlckNvbnRleHQpOwogICAgdm0uJHNjb3BlZFNsb3RzID0gZW1wdHlPYmplY3Q7CiAgICAvLyBiaW5kIHRoZSBjcmVhdGVFbGVtZW50IGZuIHRvIHRoaXMgaW5zdGFuY2UKICAgIC8vIHNvIHRoYXQgd2UgZ2V0IHByb3BlciByZW5kZXIgY29udGV4dCBpbnNpZGUgaXQuCiAgICAvLyBhcmdzIG9yZGVyOiB0YWcsIGRhdGEsIGNoaWxkcmVuLCBub3JtYWxpemF0aW9uVHlwZSwgYWx3YXlzTm9ybWFsaXplCiAgICAvLyBpbnRlcm5hbCB2ZXJzaW9uIGlzIHVzZWQgYnkgcmVuZGVyIGZ1bmN0aW9ucyBjb21waWxlZCBmcm9tIHRlbXBsYXRlcwogICAgdm0uX2MgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyByZXR1cm4gY3JlYXRlRWxlbWVudCh2bSwgYSwgYiwgYywgZCwgZmFsc2UpOyB9OwogICAgLy8gbm9ybWFsaXphdGlvbiBpcyBhbHdheXMgYXBwbGllZCBmb3IgdGhlIHB1YmxpYyB2ZXJzaW9uLCB1c2VkIGluCiAgICAvLyB1c2VyLXdyaXR0ZW4gcmVuZGVyIGZ1bmN0aW9ucy4KICAgIHZtLiRjcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgcmV0dXJuIGNyZWF0ZUVsZW1lbnQodm0sIGEsIGIsIGMsIGQsIHRydWUpOyB9OwoKICAgIC8vICRhdHRycyAmICRsaXN0ZW5lcnMgYXJlIGV4cG9zZWQgZm9yIGVhc2llciBIT0MgY3JlYXRpb24uCiAgICAvLyB0aGV5IG5lZWQgdG8gYmUgcmVhY3RpdmUgc28gdGhhdCBIT0NzIHVzaW5nIHRoZW0gYXJlIGFsd2F5cyB1cGRhdGVkCiAgICB2YXIgcGFyZW50RGF0YSA9IHBhcmVudFZub2RlICYmIHBhcmVudFZub2RlLmRhdGE7CgogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIHsKICAgICAgZGVmaW5lUmVhY3RpdmUkJDEodm0sICckYXR0cnMnLCBwYXJlbnREYXRhICYmIHBhcmVudERhdGEuYXR0cnMgfHwgZW1wdHlPYmplY3QsIGZ1bmN0aW9uICgpIHsKICAgICAgICAhaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50ICYmIHdhcm4oIiRhdHRycyBpcyByZWFkb25seS4iLCB2bSk7CiAgICAgIH0sIHRydWUpOwogICAgICBkZWZpbmVSZWFjdGl2ZSQkMSh2bSwgJyRsaXN0ZW5lcnMnLCBvcHRpb25zLl9wYXJlbnRMaXN0ZW5lcnMgfHwgZW1wdHlPYmplY3QsIGZ1bmN0aW9uICgpIHsKICAgICAgICAhaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50ICYmIHdhcm4oIiRsaXN0ZW5lcnMgaXMgcmVhZG9ubHkuIiwgdm0pOwogICAgICB9LCB0cnVlKTsKICAgIH0KICB9CgogIHZhciBjdXJyZW50UmVuZGVyaW5nSW5zdGFuY2UgPSBudWxsOwoKICBmdW5jdGlvbiByZW5kZXJNaXhpbiAoVnVlKSB7CiAgICAvLyBpbnN0YWxsIHJ1bnRpbWUgY29udmVuaWVuY2UgaGVscGVycwogICAgaW5zdGFsbFJlbmRlckhlbHBlcnMoVnVlLnByb3RvdHlwZSk7CgogICAgVnVlLnByb3RvdHlwZS4kbmV4dFRpY2sgPSBmdW5jdGlvbiAoZm4pIHsKICAgICAgcmV0dXJuIG5leHRUaWNrKGZuLCB0aGlzKQogICAgfTsKCiAgICBWdWUucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHZhciByZWYgPSB2bS4kb3B0aW9uczsKICAgICAgdmFyIHJlbmRlciA9IHJlZi5yZW5kZXI7CiAgICAgIHZhciBfcGFyZW50Vm5vZGUgPSByZWYuX3BhcmVudFZub2RlOwoKICAgICAgaWYgKF9wYXJlbnRWbm9kZSkgewogICAgICAgIHZtLiRzY29wZWRTbG90cyA9IG5vcm1hbGl6ZVNjb3BlZFNsb3RzKAogICAgICAgICAgX3BhcmVudFZub2RlLmRhdGEuc2NvcGVkU2xvdHMsCiAgICAgICAgICB2bS4kc2xvdHMsCiAgICAgICAgICB2bS4kc2NvcGVkU2xvdHMKICAgICAgICApOwogICAgICB9CgogICAgICAvLyBzZXQgcGFyZW50IHZub2RlLiB0aGlzIGFsbG93cyByZW5kZXIgZnVuY3Rpb25zIHRvIGhhdmUgYWNjZXNzCiAgICAgIC8vIHRvIHRoZSBkYXRhIG9uIHRoZSBwbGFjZWhvbGRlciBub2RlLgogICAgICB2bS4kdm5vZGUgPSBfcGFyZW50Vm5vZGU7CiAgICAgIC8vIHJlbmRlciBzZWxmCiAgICAgIHZhciB2bm9kZTsKICAgICAgdHJ5IHsKICAgICAgICAvLyBUaGVyZSdzIG5vIG5lZWQgdG8gbWFpbnRhaW4gYSBzdGFjayBiZWNhdXNlIGFsbCByZW5kZXIgZm5zIGFyZSBjYWxsZWQKICAgICAgICAvLyBzZXBhcmF0ZWx5IGZyb20gb25lIGFub3RoZXIuIE5lc3RlZCBjb21wb25lbnQncyByZW5kZXIgZm5zIGFyZSBjYWxsZWQKICAgICAgICAvLyB3aGVuIHBhcmVudCBjb21wb25lbnQgaXMgcGF0Y2hlZC4KICAgICAgICBjdXJyZW50UmVuZGVyaW5nSW5zdGFuY2UgPSB2bTsKICAgICAgICB2bm9kZSA9IHJlbmRlci5jYWxsKHZtLl9yZW5kZXJQcm94eSwgdm0uJGNyZWF0ZUVsZW1lbnQpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sICJyZW5kZXIiKTsKICAgICAgICAvLyByZXR1cm4gZXJyb3IgcmVuZGVyIHJlc3VsdCwKICAgICAgICAvLyBvciBwcmV2aW91cyB2bm9kZSB0byBwcmV2ZW50IHJlbmRlciBlcnJvciBjYXVzaW5nIGJsYW5rIGNvbXBvbmVudAogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgICAgaWYgKHZtLiRvcHRpb25zLnJlbmRlckVycm9yKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2bm9kZSA9IHZtLiRvcHRpb25zLnJlbmRlckVycm9yLmNhbGwodm0uX3JlbmRlclByb3h5LCB2bS4kY3JlYXRlRWxlbWVudCwgZSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGhhbmRsZUVycm9yKGUsIHZtLCAicmVuZGVyRXJyb3IiKTsKICAgICAgICAgICAgdm5vZGUgPSB2bS5fdm5vZGU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZub2RlID0gdm0uX3Zub2RlOwogICAgICAgIH0KICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBjdXJyZW50UmVuZGVyaW5nSW5zdGFuY2UgPSBudWxsOwogICAgICB9CiAgICAgIC8vIGlmIHRoZSByZXR1cm5lZCBhcnJheSBjb250YWlucyBvbmx5IGEgc2luZ2xlIG5vZGUsIGFsbG93IGl0CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZub2RlKSAmJiB2bm9kZS5sZW5ndGggPT09IDEpIHsKICAgICAgICB2bm9kZSA9IHZub2RlWzBdOwogICAgICB9CiAgICAgIC8vIHJldHVybiBlbXB0eSB2bm9kZSBpbiBjYXNlIHRoZSByZW5kZXIgZnVuY3Rpb24gZXJyb3JlZCBvdXQKICAgICAgaWYgKCEodm5vZGUgaW5zdGFuY2VvZiBWTm9kZSkpIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2bm9kZSkpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICdNdWx0aXBsZSByb290IG5vZGVzIHJldHVybmVkIGZyb20gcmVuZGVyIGZ1bmN0aW9uLiBSZW5kZXIgZnVuY3Rpb24gJyArCiAgICAgICAgICAgICdzaG91bGQgcmV0dXJuIGEgc2luZ2xlIHJvb3Qgbm9kZS4nLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgdm5vZGUgPSBjcmVhdGVFbXB0eVZOb2RlKCk7CiAgICAgIH0KICAgICAgLy8gc2V0IHBhcmVudAogICAgICB2bm9kZS5wYXJlbnQgPSBfcGFyZW50Vm5vZGU7CiAgICAgIHJldHVybiB2bm9kZQogICAgfTsKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBlbnN1cmVDdG9yIChjb21wLCBiYXNlKSB7CiAgICBpZiAoCiAgICAgIGNvbXAuX19lc01vZHVsZSB8fAogICAgICAoaGFzU3ltYm9sICYmIGNvbXBbU3ltYm9sLnRvU3RyaW5nVGFnXSA9PT0gJ01vZHVsZScpCiAgICApIHsKICAgICAgY29tcCA9IGNvbXAuZGVmYXVsdDsKICAgIH0KICAgIHJldHVybiBpc09iamVjdChjb21wKQogICAgICA/IGJhc2UuZXh0ZW5kKGNvbXApCiAgICAgIDogY29tcAogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQXN5bmNQbGFjZWhvbGRlciAoCiAgICBmYWN0b3J5LAogICAgZGF0YSwKICAgIGNvbnRleHQsCiAgICBjaGlsZHJlbiwKICAgIHRhZwogICkgewogICAgdmFyIG5vZGUgPSBjcmVhdGVFbXB0eVZOb2RlKCk7CiAgICBub2RlLmFzeW5jRmFjdG9yeSA9IGZhY3Rvcnk7CiAgICBub2RlLmFzeW5jTWV0YSA9IHsgZGF0YTogZGF0YSwgY29udGV4dDogY29udGV4dCwgY2hpbGRyZW46IGNoaWxkcmVuLCB0YWc6IHRhZyB9OwogICAgcmV0dXJuIG5vZGUKICB9CgogIGZ1bmN0aW9uIHJlc29sdmVBc3luY0NvbXBvbmVudCAoCiAgICBmYWN0b3J5LAogICAgYmFzZUN0b3IKICApIHsKICAgIGlmIChpc1RydWUoZmFjdG9yeS5lcnJvcikgJiYgaXNEZWYoZmFjdG9yeS5lcnJvckNvbXApKSB7CiAgICAgIHJldHVybiBmYWN0b3J5LmVycm9yQ29tcAogICAgfQoKICAgIGlmIChpc0RlZihmYWN0b3J5LnJlc29sdmVkKSkgewogICAgICByZXR1cm4gZmFjdG9yeS5yZXNvbHZlZAogICAgfQoKICAgIHZhciBvd25lciA9IGN1cnJlbnRSZW5kZXJpbmdJbnN0YW5jZTsKICAgIGlmIChvd25lciAmJiBpc0RlZihmYWN0b3J5Lm93bmVycykgJiYgZmFjdG9yeS5vd25lcnMuaW5kZXhPZihvd25lcikgPT09IC0xKSB7CiAgICAgIC8vIGFscmVhZHkgcGVuZGluZwogICAgICBmYWN0b3J5Lm93bmVycy5wdXNoKG93bmVyKTsKICAgIH0KCiAgICBpZiAoaXNUcnVlKGZhY3RvcnkubG9hZGluZykgJiYgaXNEZWYoZmFjdG9yeS5sb2FkaW5nQ29tcCkpIHsKICAgICAgcmV0dXJuIGZhY3RvcnkubG9hZGluZ0NvbXAKICAgIH0KCiAgICBpZiAob3duZXIgJiYgIWlzRGVmKGZhY3Rvcnkub3duZXJzKSkgewogICAgICB2YXIgb3duZXJzID0gZmFjdG9yeS5vd25lcnMgPSBbb3duZXJdOwogICAgICB2YXIgc3luYyA9IHRydWU7CiAgICAgIHZhciB0aW1lckxvYWRpbmcgPSBudWxsOwogICAgICB2YXIgdGltZXJUaW1lb3V0ID0gbnVsbAoKICAgICAgOyhvd25lcikuJG9uKCdob29rOmRlc3Ryb3llZCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlbW92ZShvd25lcnMsIG93bmVyKTsgfSk7CgogICAgICB2YXIgZm9yY2VSZW5kZXIgPSBmdW5jdGlvbiAocmVuZGVyQ29tcGxldGVkKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBvd25lcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAob3duZXJzW2ldKS4kZm9yY2VVcGRhdGUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChyZW5kZXJDb21wbGV0ZWQpIHsKICAgICAgICAgIG93bmVycy5sZW5ndGggPSAwOwogICAgICAgICAgaWYgKHRpbWVyTG9hZGluZyAhPT0gbnVsbCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJMb2FkaW5nKTsKICAgICAgICAgICAgdGltZXJMb2FkaW5nID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aW1lclRpbWVvdXQgIT09IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyVGltZW91dCk7CiAgICAgICAgICAgIHRpbWVyVGltZW91dCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIHJlc29sdmUgPSBvbmNlKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAvLyBjYWNoZSByZXNvbHZlZAogICAgICAgIGZhY3RvcnkucmVzb2x2ZWQgPSBlbnN1cmVDdG9yKHJlcywgYmFzZUN0b3IpOwogICAgICAgIC8vIGludm9rZSBjYWxsYmFja3Mgb25seSBpZiB0aGlzIGlzIG5vdCBhIHN5bmNocm9ub3VzIHJlc29sdmUKICAgICAgICAvLyAoYXN5bmMgcmVzb2x2ZXMgYXJlIHNoaW1tZWQgYXMgc3luY2hyb25vdXMgZHVyaW5nIFNTUikKICAgICAgICBpZiAoIXN5bmMpIHsKICAgICAgICAgIGZvcmNlUmVuZGVyKHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvd25lcnMubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIHJlamVjdCA9IG9uY2UoZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIHdhcm4oCiAgICAgICAgICAiRmFpbGVkIHRvIHJlc29sdmUgYXN5bmMgY29tcG9uZW50OiAiICsgKFN0cmluZyhmYWN0b3J5KSkgKwogICAgICAgICAgKHJlYXNvbiA/ICgiXG5SZWFzb246ICIgKyByZWFzb24pIDogJycpCiAgICAgICAgKTsKICAgICAgICBpZiAoaXNEZWYoZmFjdG9yeS5lcnJvckNvbXApKSB7CiAgICAgICAgICBmYWN0b3J5LmVycm9yID0gdHJ1ZTsKICAgICAgICAgIGZvcmNlUmVuZGVyKHRydWUpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgcmVzID0gZmFjdG9yeShyZXNvbHZlLCByZWplY3QpOwoKICAgICAgaWYgKGlzT2JqZWN0KHJlcykpIHsKICAgICAgICBpZiAoaXNQcm9taXNlKHJlcykpIHsKICAgICAgICAgIC8vICgpID0+IFByb21pc2UKICAgICAgICAgIGlmIChpc1VuZGVmKGZhY3RvcnkucmVzb2x2ZWQpKSB7CiAgICAgICAgICAgIHJlcy50aGVuKHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChpc1Byb21pc2UocmVzLmNvbXBvbmVudCkpIHsKICAgICAgICAgIHJlcy5jb21wb25lbnQudGhlbihyZXNvbHZlLCByZWplY3QpOwoKICAgICAgICAgIGlmIChpc0RlZihyZXMuZXJyb3IpKSB7CiAgICAgICAgICAgIGZhY3RvcnkuZXJyb3JDb21wID0gZW5zdXJlQ3RvcihyZXMuZXJyb3IsIGJhc2VDdG9yKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaXNEZWYocmVzLmxvYWRpbmcpKSB7CiAgICAgICAgICAgIGZhY3RvcnkubG9hZGluZ0NvbXAgPSBlbnN1cmVDdG9yKHJlcy5sb2FkaW5nLCBiYXNlQ3Rvcik7CiAgICAgICAgICAgIGlmIChyZXMuZGVsYXkgPT09IDApIHsKICAgICAgICAgICAgICBmYWN0b3J5LmxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRpbWVyTG9hZGluZyA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGltZXJMb2FkaW5nID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChpc1VuZGVmKGZhY3RvcnkucmVzb2x2ZWQpICYmIGlzVW5kZWYoZmFjdG9yeS5lcnJvcikpIHsKICAgICAgICAgICAgICAgICAgZmFjdG9yeS5sb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgZm9yY2VSZW5kZXIoZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIHJlcy5kZWxheSB8fCAyMDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGlzRGVmKHJlcy50aW1lb3V0KSkgewogICAgICAgICAgICB0aW1lclRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB0aW1lclRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgIGlmIChpc1VuZGVmKGZhY3RvcnkucmVzb2x2ZWQpKSB7CiAgICAgICAgICAgICAgICByZWplY3QoCiAgICAgICAgICAgICAgICAgICJ0aW1lb3V0ICgiICsgKHJlcy50aW1lb3V0KSArICJtcykiCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgcmVzLnRpbWVvdXQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgc3luYyA9IGZhbHNlOwogICAgICAvLyByZXR1cm4gaW4gY2FzZSByZXNvbHZlZCBzeW5jaHJvbm91c2x5CiAgICAgIHJldHVybiBmYWN0b3J5LmxvYWRpbmcKICAgICAgICA/IGZhY3RvcnkubG9hZGluZ0NvbXAKICAgICAgICA6IGZhY3RvcnkucmVzb2x2ZWQKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBpc0FzeW5jUGxhY2Vob2xkZXIgKG5vZGUpIHsKICAgIHJldHVybiBub2RlLmlzQ29tbWVudCAmJiBub2RlLmFzeW5jRmFjdG9yeQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGdldEZpcnN0Q29tcG9uZW50Q2hpbGQgKGNoaWxkcmVuKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbikpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjID0gY2hpbGRyZW5baV07CiAgICAgICAgaWYgKGlzRGVmKGMpICYmIChpc0RlZihjLmNvbXBvbmVudE9wdGlvbnMpIHx8IGlzQXN5bmNQbGFjZWhvbGRlcihjKSkpIHsKICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRFdmVudHMgKHZtKSB7CiAgICB2bS5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHZtLl9oYXNIb29rRXZlbnQgPSBmYWxzZTsKICAgIC8vIGluaXQgcGFyZW50IGF0dGFjaGVkIGV2ZW50cwogICAgdmFyIGxpc3RlbmVycyA9IHZtLiRvcHRpb25zLl9wYXJlbnRMaXN0ZW5lcnM7CiAgICBpZiAobGlzdGVuZXJzKSB7CiAgICAgIHVwZGF0ZUNvbXBvbmVudExpc3RlbmVycyh2bSwgbGlzdGVuZXJzKTsKICAgIH0KICB9CgogIHZhciB0YXJnZXQ7CgogIGZ1bmN0aW9uIGFkZCAoZXZlbnQsIGZuKSB7CiAgICB0YXJnZXQuJG9uKGV2ZW50LCBmbik7CiAgfQoKICBmdW5jdGlvbiByZW1vdmUkMSAoZXZlbnQsIGZuKSB7CiAgICB0YXJnZXQuJG9mZihldmVudCwgZm4pOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlT25jZUhhbmRsZXIgKGV2ZW50LCBmbikgewogICAgdmFyIF90YXJnZXQgPSB0YXJnZXQ7CiAgICByZXR1cm4gZnVuY3Rpb24gb25jZUhhbmRsZXIgKCkgewogICAgICB2YXIgcmVzID0gZm4uYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgaWYgKHJlcyAhPT0gbnVsbCkgewogICAgICAgIF90YXJnZXQuJG9mZihldmVudCwgb25jZUhhbmRsZXIpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVDb21wb25lbnRMaXN0ZW5lcnMgKAogICAgdm0sCiAgICBsaXN0ZW5lcnMsCiAgICBvbGRMaXN0ZW5lcnMKICApIHsKICAgIHRhcmdldCA9IHZtOwogICAgdXBkYXRlTGlzdGVuZXJzKGxpc3RlbmVycywgb2xkTGlzdGVuZXJzIHx8IHt9LCBhZGQsIHJlbW92ZSQxLCBjcmVhdGVPbmNlSGFuZGxlciwgdm0pOwogICAgdGFyZ2V0ID0gdW5kZWZpbmVkOwogIH0KCiAgZnVuY3Rpb24gZXZlbnRzTWl4aW4gKFZ1ZSkgewogICAgdmFyIGhvb2tSRSA9IC9eaG9vazovOwogICAgVnVlLnByb3RvdHlwZS4kb24gPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGV2ZW50KSkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gZXZlbnQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB2bS4kb24oZXZlbnRbaV0sIGZuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKHZtLl9ldmVudHNbZXZlbnRdIHx8ICh2bS5fZXZlbnRzW2V2ZW50XSA9IFtdKSkucHVzaChmbik7CiAgICAgICAgLy8gb3B0aW1pemUgaG9vazpldmVudCBjb3N0IGJ5IHVzaW5nIGEgYm9vbGVhbiBmbGFnIG1hcmtlZCBhdCByZWdpc3RyYXRpb24KICAgICAgICAvLyBpbnN0ZWFkIG9mIGEgaGFzaCBsb29rdXAKICAgICAgICBpZiAoaG9va1JFLnRlc3QoZXZlbnQpKSB7CiAgICAgICAgICB2bS5faGFzSG9va0V2ZW50ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHZtCiAgICB9OwoKICAgIFZ1ZS5wcm90b3R5cGUuJG9uY2UgPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGZ1bmN0aW9uIG9uICgpIHsKICAgICAgICB2bS4kb2ZmKGV2ZW50LCBvbik7CiAgICAgICAgZm4uYXBwbHkodm0sIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgb24uZm4gPSBmbjsKICAgICAgdm0uJG9uKGV2ZW50LCBvbik7CiAgICAgIHJldHVybiB2bQogICAgfTsKCiAgICBWdWUucHJvdG90eXBlLiRvZmYgPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIC8vIGFsbAogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICB2bS5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICByZXR1cm4gdm0KICAgICAgfQogICAgICAvLyBhcnJheSBvZiBldmVudHMKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7CiAgICAgICAgZm9yICh2YXIgaSQxID0gMCwgbCA9IGV2ZW50Lmxlbmd0aDsgaSQxIDwgbDsgaSQxKyspIHsKICAgICAgICAgIHZtLiRvZmYoZXZlbnRbaSQxXSwgZm4pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdm0KICAgICAgfQogICAgICAvLyBzcGVjaWZpYyBldmVudAogICAgICB2YXIgY2JzID0gdm0uX2V2ZW50c1tldmVudF07CiAgICAgIGlmICghY2JzKSB7CiAgICAgICAgcmV0dXJuIHZtCiAgICAgIH0KICAgICAgaWYgKCFmbikgewogICAgICAgIHZtLl9ldmVudHNbZXZlbnRdID0gbnVsbDsKICAgICAgICByZXR1cm4gdm0KICAgICAgfQogICAgICAvLyBzcGVjaWZpYyBoYW5kbGVyCiAgICAgIHZhciBjYjsKICAgICAgdmFyIGkgPSBjYnMubGVuZ3RoOwogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgY2IgPSBjYnNbaV07CiAgICAgICAgaWYgKGNiID09PSBmbiB8fCBjYi5mbiA9PT0gZm4pIHsKICAgICAgICAgIGNicy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdm0KICAgIH07CgogICAgVnVlLnByb3RvdHlwZS4kZW1pdCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB7CiAgICAgICAgdmFyIGxvd2VyQ2FzZUV2ZW50ID0gZXZlbnQudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAobG93ZXJDYXNlRXZlbnQgIT09IGV2ZW50ICYmIHZtLl9ldmVudHNbbG93ZXJDYXNlRXZlbnRdKSB7CiAgICAgICAgICB0aXAoCiAgICAgICAgICAgICJFdmVudCBcIiIgKyBsb3dlckNhc2VFdmVudCArICJcIiBpcyBlbWl0dGVkIGluIGNvbXBvbmVudCAiICsKICAgICAgICAgICAgKGZvcm1hdENvbXBvbmVudE5hbWUodm0pKSArICIgYnV0IHRoZSBoYW5kbGVyIGlzIHJlZ2lzdGVyZWQgZm9yIFwiIiArIGV2ZW50ICsgIlwiLiAiICsKICAgICAgICAgICAgIk5vdGUgdGhhdCBIVE1MIGF0dHJpYnV0ZXMgYXJlIGNhc2UtaW5zZW5zaXRpdmUgYW5kIHlvdSBjYW5ub3QgdXNlICIgKwogICAgICAgICAgICAidi1vbiB0byBsaXN0ZW4gdG8gY2FtZWxDYXNlIGV2ZW50cyB3aGVuIHVzaW5nIGluLURPTSB0ZW1wbGF0ZXMuICIgKwogICAgICAgICAgICAiWW91IHNob3VsZCBwcm9iYWJseSB1c2UgXCIiICsgKGh5cGhlbmF0ZShldmVudCkpICsgIlwiIGluc3RlYWQgb2YgXCIiICsgZXZlbnQgKyAiXCIuIgogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIGNicyA9IHZtLl9ldmVudHNbZXZlbnRdOwogICAgICBpZiAoY2JzKSB7CiAgICAgICAgY2JzID0gY2JzLmxlbmd0aCA+IDEgPyB0b0FycmF5KGNicykgOiBjYnM7CiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cywgMSk7CiAgICAgICAgdmFyIGluZm8gPSAiZXZlbnQgaGFuZGxlciBmb3IgXCIiICsgZXZlbnQgKyAiXCIiOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2JzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgaW52b2tlV2l0aEVycm9ySGFuZGxpbmcoY2JzW2ldLCB2bSwgYXJncywgdm0sIGluZm8pOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdm0KICAgIH07CiAgfQoKICAvKiAgKi8KCiAgdmFyIGFjdGl2ZUluc3RhbmNlID0gbnVsbDsKICB2YXIgaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50ID0gZmFsc2U7CgogIGZ1bmN0aW9uIHNldEFjdGl2ZUluc3RhbmNlKHZtKSB7CiAgICB2YXIgcHJldkFjdGl2ZUluc3RhbmNlID0gYWN0aXZlSW5zdGFuY2U7CiAgICBhY3RpdmVJbnN0YW5jZSA9IHZtOwogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgYWN0aXZlSW5zdGFuY2UgPSBwcmV2QWN0aXZlSW5zdGFuY2U7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0TGlmZWN5Y2xlICh2bSkgewogICAgdmFyIG9wdGlvbnMgPSB2bS4kb3B0aW9uczsKCiAgICAvLyBsb2NhdGUgZmlyc3Qgbm9uLWFic3RyYWN0IHBhcmVudAogICAgdmFyIHBhcmVudCA9IG9wdGlvbnMucGFyZW50OwogICAgaWYgKHBhcmVudCAmJiAhb3B0aW9ucy5hYnN0cmFjdCkgewogICAgICB3aGlsZSAocGFyZW50LiRvcHRpb25zLmFic3RyYWN0ICYmIHBhcmVudC4kcGFyZW50KSB7CiAgICAgICAgcGFyZW50ID0gcGFyZW50LiRwYXJlbnQ7CiAgICAgIH0KICAgICAgcGFyZW50LiRjaGlsZHJlbi5wdXNoKHZtKTsKICAgIH0KCiAgICB2bS4kcGFyZW50ID0gcGFyZW50OwogICAgdm0uJHJvb3QgPSBwYXJlbnQgPyBwYXJlbnQuJHJvb3QgOiB2bTsKCiAgICB2bS4kY2hpbGRyZW4gPSBbXTsKICAgIHZtLiRyZWZzID0ge307CgogICAgdm0uX3dhdGNoZXIgPSBudWxsOwogICAgdm0uX2luYWN0aXZlID0gbnVsbDsKICAgIHZtLl9kaXJlY3RJbmFjdGl2ZSA9IGZhbHNlOwogICAgdm0uX2lzTW91bnRlZCA9IGZhbHNlOwogICAgdm0uX2lzRGVzdHJveWVkID0gZmFsc2U7CiAgICB2bS5faXNCZWluZ0Rlc3Ryb3llZCA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gbGlmZWN5Y2xlTWl4aW4gKFZ1ZSkgewogICAgVnVlLnByb3RvdHlwZS5fdXBkYXRlID0gZnVuY3Rpb24gKHZub2RlLCBoeWRyYXRpbmcpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdmFyIHByZXZFbCA9IHZtLiRlbDsKICAgICAgdmFyIHByZXZWbm9kZSA9IHZtLl92bm9kZTsKICAgICAgdmFyIHJlc3RvcmVBY3RpdmVJbnN0YW5jZSA9IHNldEFjdGl2ZUluc3RhbmNlKHZtKTsKICAgICAgdm0uX3Zub2RlID0gdm5vZGU7CiAgICAgIC8vIFZ1ZS5wcm90b3R5cGUuX19wYXRjaF9fIGlzIGluamVjdGVkIGluIGVudHJ5IHBvaW50cwogICAgICAvLyBiYXNlZCBvbiB0aGUgcmVuZGVyaW5nIGJhY2tlbmQgdXNlZC4KICAgICAgaWYgKCFwcmV2Vm5vZGUpIHsKICAgICAgICAvLyBpbml0aWFsIHJlbmRlcgogICAgICAgIHZtLiRlbCA9IHZtLl9fcGF0Y2hfXyh2bS4kZWwsIHZub2RlLCBoeWRyYXRpbmcsIGZhbHNlIC8qIHJlbW92ZU9ubHkgKi8pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHVwZGF0ZXMKICAgICAgICB2bS4kZWwgPSB2bS5fX3BhdGNoX18ocHJldlZub2RlLCB2bm9kZSk7CiAgICAgIH0KICAgICAgcmVzdG9yZUFjdGl2ZUluc3RhbmNlKCk7CiAgICAgIC8vIHVwZGF0ZSBfX3Z1ZV9fIHJlZmVyZW5jZQogICAgICBpZiAocHJldkVsKSB7CiAgICAgICAgcHJldkVsLl9fdnVlX18gPSBudWxsOwogICAgICB9CiAgICAgIGlmICh2bS4kZWwpIHsKICAgICAgICB2bS4kZWwuX192dWVfXyA9IHZtOwogICAgICB9CiAgICAgIC8vIGlmIHBhcmVudCBpcyBhbiBIT0MsIHVwZGF0ZSBpdHMgJGVsIGFzIHdlbGwKICAgICAgaWYgKHZtLiR2bm9kZSAmJiB2bS4kcGFyZW50ICYmIHZtLiR2bm9kZSA9PT0gdm0uJHBhcmVudC5fdm5vZGUpIHsKICAgICAgICB2bS4kcGFyZW50LiRlbCA9IHZtLiRlbDsKICAgICAgfQogICAgICAvLyB1cGRhdGVkIGhvb2sgaXMgY2FsbGVkIGJ5IHRoZSBzY2hlZHVsZXIgdG8gZW5zdXJlIHRoYXQgY2hpbGRyZW4gYXJlCiAgICAgIC8vIHVwZGF0ZWQgaW4gYSBwYXJlbnQncyB1cGRhdGVkIGhvb2suCiAgICB9OwoKICAgIFZ1ZS5wcm90b3R5cGUuJGZvcmNlVXBkYXRlID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBpZiAodm0uX3dhdGNoZXIpIHsKICAgICAgICB2bS5fd2F0Y2hlci51cGRhdGUoKTsKICAgICAgfQogICAgfTsKCiAgICBWdWUucHJvdG90eXBlLiRkZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBpZiAodm0uX2lzQmVpbmdEZXN0cm95ZWQpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBjYWxsSG9vayh2bSwgJ2JlZm9yZURlc3Ryb3knKTsKICAgICAgdm0uX2lzQmVpbmdEZXN0cm95ZWQgPSB0cnVlOwogICAgICAvLyByZW1vdmUgc2VsZiBmcm9tIHBhcmVudAogICAgICB2YXIgcGFyZW50ID0gdm0uJHBhcmVudDsKICAgICAgaWYgKHBhcmVudCAmJiAhcGFyZW50Ll9pc0JlaW5nRGVzdHJveWVkICYmICF2bS4kb3B0aW9ucy5hYnN0cmFjdCkgewogICAgICAgIHJlbW92ZShwYXJlbnQuJGNoaWxkcmVuLCB2bSk7CiAgICAgIH0KICAgICAgLy8gdGVhcmRvd24gd2F0Y2hlcnMKICAgICAgaWYgKHZtLl93YXRjaGVyKSB7CiAgICAgICAgdm0uX3dhdGNoZXIudGVhcmRvd24oKTsKICAgICAgfQogICAgICB2YXIgaSA9IHZtLl93YXRjaGVycy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2bS5fd2F0Y2hlcnNbaV0udGVhcmRvd24oKTsKICAgICAgfQogICAgICAvLyByZW1vdmUgcmVmZXJlbmNlIGZyb20gZGF0YSBvYgogICAgICAvLyBmcm96ZW4gb2JqZWN0IG1heSBub3QgaGF2ZSBvYnNlcnZlci4KICAgICAgaWYgKHZtLl9kYXRhLl9fb2JfXykgewogICAgICAgIHZtLl9kYXRhLl9fb2JfXy52bUNvdW50LS07CiAgICAgIH0KICAgICAgLy8gY2FsbCB0aGUgbGFzdCBob29rLi4uCiAgICAgIHZtLl9pc0Rlc3Ryb3llZCA9IHRydWU7CiAgICAgIC8vIGludm9rZSBkZXN0cm95IGhvb2tzIG9uIGN1cnJlbnQgcmVuZGVyZWQgdHJlZQogICAgICB2bS5fX3BhdGNoX18odm0uX3Zub2RlLCBudWxsKTsKICAgICAgLy8gZmlyZSBkZXN0cm95ZWQgaG9vawogICAgICBjYWxsSG9vayh2bSwgJ2Rlc3Ryb3llZCcpOwogICAgICAvLyB0dXJuIG9mZiBhbGwgaW5zdGFuY2UgbGlzdGVuZXJzLgogICAgICB2bS4kb2ZmKCk7CiAgICAgIC8vIHJlbW92ZSBfX3Z1ZV9fIHJlZmVyZW5jZQogICAgICBpZiAodm0uJGVsKSB7CiAgICAgICAgdm0uJGVsLl9fdnVlX18gPSBudWxsOwogICAgICB9CiAgICAgIC8vIHJlbGVhc2UgY2lyY3VsYXIgcmVmZXJlbmNlICgjNjc1OSkKICAgICAgaWYgKHZtLiR2bm9kZSkgewogICAgICAgIHZtLiR2bm9kZS5wYXJlbnQgPSBudWxsOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbW91bnRDb21wb25lbnQgKAogICAgdm0sCiAgICBlbCwKICAgIGh5ZHJhdGluZwogICkgewogICAgdm0uJGVsID0gZWw7CiAgICBpZiAoIXZtLiRvcHRpb25zLnJlbmRlcikgewogICAgICB2bS4kb3B0aW9ucy5yZW5kZXIgPSBjcmVhdGVFbXB0eVZOb2RlOwogICAgICB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgaWYgKCh2bS4kb3B0aW9ucy50ZW1wbGF0ZSAmJiB2bS4kb3B0aW9ucy50ZW1wbGF0ZS5jaGFyQXQoMCkgIT09ICcjJykgfHwKICAgICAgICAgIHZtLiRvcHRpb25zLmVsIHx8IGVsKSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAnWW91IGFyZSB1c2luZyB0aGUgcnVudGltZS1vbmx5IGJ1aWxkIG9mIFZ1ZSB3aGVyZSB0aGUgdGVtcGxhdGUgJyArCiAgICAgICAgICAgICdjb21waWxlciBpcyBub3QgYXZhaWxhYmxlLiBFaXRoZXIgcHJlLWNvbXBpbGUgdGhlIHRlbXBsYXRlcyBpbnRvICcgKwogICAgICAgICAgICAncmVuZGVyIGZ1bmN0aW9ucywgb3IgdXNlIHRoZSBjb21waWxlci1pbmNsdWRlZCBidWlsZC4nLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgJ0ZhaWxlZCB0byBtb3VudCBjb21wb25lbnQ6IHRlbXBsYXRlIG9yIHJlbmRlciBmdW5jdGlvbiBub3QgZGVmaW5lZC4nLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNhbGxIb29rKHZtLCAnYmVmb3JlTW91bnQnKTsKCiAgICB2YXIgdXBkYXRlQ29tcG9uZW50OwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoY29uZmlnLnBlcmZvcm1hbmNlICYmIG1hcmspIHsKICAgICAgdXBkYXRlQ29tcG9uZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBuYW1lID0gdm0uX25hbWU7CiAgICAgICAgdmFyIGlkID0gdm0uX3VpZDsKICAgICAgICB2YXIgc3RhcnRUYWcgPSAidnVlLXBlcmYtc3RhcnQ6IiArIGlkOwogICAgICAgIHZhciBlbmRUYWcgPSAidnVlLXBlcmYtZW5kOiIgKyBpZDsKCiAgICAgICAgbWFyayhzdGFydFRhZyk7CiAgICAgICAgdmFyIHZub2RlID0gdm0uX3JlbmRlcigpOwogICAgICAgIG1hcmsoZW5kVGFnKTsKICAgICAgICBtZWFzdXJlKCgidnVlICIgKyBuYW1lICsgIiByZW5kZXIiKSwgc3RhcnRUYWcsIGVuZFRhZyk7CgogICAgICAgIG1hcmsoc3RhcnRUYWcpOwogICAgICAgIHZtLl91cGRhdGUodm5vZGUsIGh5ZHJhdGluZyk7CiAgICAgICAgbWFyayhlbmRUYWcpOwogICAgICAgIG1lYXN1cmUoKCJ2dWUgIiArIG5hbWUgKyAiIHBhdGNoIiksIHN0YXJ0VGFnLCBlbmRUYWcpOwogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgdXBkYXRlQ29tcG9uZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZtLl91cGRhdGUodm0uX3JlbmRlcigpLCBoeWRyYXRpbmcpOwogICAgICB9OwogICAgfQoKICAgIC8vIHdlIHNldCB0aGlzIHRvIHZtLl93YXRjaGVyIGluc2lkZSB0aGUgd2F0Y2hlcidzIGNvbnN0cnVjdG9yCiAgICAvLyBzaW5jZSB0aGUgd2F0Y2hlcidzIGluaXRpYWwgcGF0Y2ggbWF5IGNhbGwgJGZvcmNlVXBkYXRlIChlLmcuIGluc2lkZSBjaGlsZAogICAgLy8gY29tcG9uZW50J3MgbW91bnRlZCBob29rKSwgd2hpY2ggcmVsaWVzIG9uIHZtLl93YXRjaGVyIGJlaW5nIGFscmVhZHkgZGVmaW5lZAogICAgbmV3IFdhdGNoZXIodm0sIHVwZGF0ZUNvbXBvbmVudCwgbm9vcCwgewogICAgICBiZWZvcmU6IGZ1bmN0aW9uIGJlZm9yZSAoKSB7CiAgICAgICAgaWYgKHZtLl9pc01vdW50ZWQgJiYgIXZtLl9pc0Rlc3Ryb3llZCkgewogICAgICAgICAgY2FsbEhvb2sodm0sICdiZWZvcmVVcGRhdGUnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHRydWUgLyogaXNSZW5kZXJXYXRjaGVyICovKTsKICAgIGh5ZHJhdGluZyA9IGZhbHNlOwoKICAgIC8vIG1hbnVhbGx5IG1vdW50ZWQgaW5zdGFuY2UsIGNhbGwgbW91bnRlZCBvbiBzZWxmCiAgICAvLyBtb3VudGVkIGlzIGNhbGxlZCBmb3IgcmVuZGVyLWNyZWF0ZWQgY2hpbGQgY29tcG9uZW50cyBpbiBpdHMgaW5zZXJ0ZWQgaG9vawogICAgaWYgKHZtLiR2bm9kZSA9PSBudWxsKSB7CiAgICAgIHZtLl9pc01vdW50ZWQgPSB0cnVlOwogICAgICBjYWxsSG9vayh2bSwgJ21vdW50ZWQnKTsKICAgIH0KICAgIHJldHVybiB2bQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlQ2hpbGRDb21wb25lbnQgKAogICAgdm0sCiAgICBwcm9wc0RhdGEsCiAgICBsaXN0ZW5lcnMsCiAgICBwYXJlbnRWbm9kZSwKICAgIHJlbmRlckNoaWxkcmVuCiAgKSB7CiAgICB7CiAgICAgIGlzVXBkYXRpbmdDaGlsZENvbXBvbmVudCA9IHRydWU7CiAgICB9CgogICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgY29tcG9uZW50IGhhcyBzbG90IGNoaWxkcmVuCiAgICAvLyB3ZSBuZWVkIHRvIGRvIHRoaXMgYmVmb3JlIG92ZXJ3cml0aW5nICRvcHRpb25zLl9yZW5kZXJDaGlsZHJlbi4KCiAgICAvLyBjaGVjayBpZiB0aGVyZSBhcmUgZHluYW1pYyBzY29wZWRTbG90cyAoaGFuZC13cml0dGVuIG9yIGNvbXBpbGVkIGJ1dCB3aXRoCiAgICAvLyBkeW5hbWljIHNsb3QgbmFtZXMpLiBTdGF0aWMgc2NvcGVkIHNsb3RzIGNvbXBpbGVkIGZyb20gdGVtcGxhdGUgaGFzIHRoZQogICAgLy8gIiRzdGFibGUiIG1hcmtlci4KICAgIHZhciBuZXdTY29wZWRTbG90cyA9IHBhcmVudFZub2RlLmRhdGEuc2NvcGVkU2xvdHM7CiAgICB2YXIgb2xkU2NvcGVkU2xvdHMgPSB2bS4kc2NvcGVkU2xvdHM7CiAgICB2YXIgaGFzRHluYW1pY1Njb3BlZFNsb3QgPSAhISgKICAgICAgKG5ld1Njb3BlZFNsb3RzICYmICFuZXdTY29wZWRTbG90cy4kc3RhYmxlKSB8fAogICAgICAob2xkU2NvcGVkU2xvdHMgIT09IGVtcHR5T2JqZWN0ICYmICFvbGRTY29wZWRTbG90cy4kc3RhYmxlKSB8fAogICAgICAobmV3U2NvcGVkU2xvdHMgJiYgdm0uJHNjb3BlZFNsb3RzLiRrZXkgIT09IG5ld1Njb3BlZFNsb3RzLiRrZXkpCiAgICApOwoKICAgIC8vIEFueSBzdGF0aWMgc2xvdCBjaGlsZHJlbiBmcm9tIHRoZSBwYXJlbnQgbWF5IGhhdmUgY2hhbmdlZCBkdXJpbmcgcGFyZW50J3MKICAgIC8vIHVwZGF0ZS4gRHluYW1pYyBzY29wZWQgc2xvdHMgbWF5IGFsc28gaGF2ZSBjaGFuZ2VkLiBJbiBzdWNoIGNhc2VzLCBhIGZvcmNlZAogICAgLy8gdXBkYXRlIGlzIG5lY2Vzc2FyeSB0byBlbnN1cmUgY29ycmVjdG5lc3MuCiAgICB2YXIgbmVlZHNGb3JjZVVwZGF0ZSA9ICEhKAogICAgICByZW5kZXJDaGlsZHJlbiB8fCAgICAgICAgICAgICAgIC8vIGhhcyBuZXcgc3RhdGljIHNsb3RzCiAgICAgIHZtLiRvcHRpb25zLl9yZW5kZXJDaGlsZHJlbiB8fCAgLy8gaGFzIG9sZCBzdGF0aWMgc2xvdHMKICAgICAgaGFzRHluYW1pY1Njb3BlZFNsb3QKICAgICk7CgogICAgdm0uJG9wdGlvbnMuX3BhcmVudFZub2RlID0gcGFyZW50Vm5vZGU7CiAgICB2bS4kdm5vZGUgPSBwYXJlbnRWbm9kZTsgLy8gdXBkYXRlIHZtJ3MgcGxhY2Vob2xkZXIgbm9kZSB3aXRob3V0IHJlLXJlbmRlcgoKICAgIGlmICh2bS5fdm5vZGUpIHsgLy8gdXBkYXRlIGNoaWxkIHRyZWUncyBwYXJlbnQKICAgICAgdm0uX3Zub2RlLnBhcmVudCA9IHBhcmVudFZub2RlOwogICAgfQogICAgdm0uJG9wdGlvbnMuX3JlbmRlckNoaWxkcmVuID0gcmVuZGVyQ2hpbGRyZW47CgogICAgLy8gdXBkYXRlICRhdHRycyBhbmQgJGxpc3RlbmVycyBoYXNoCiAgICAvLyB0aGVzZSBhcmUgYWxzbyByZWFjdGl2ZSBzbyB0aGV5IG1heSB0cmlnZ2VyIGNoaWxkIHVwZGF0ZSBpZiB0aGUgY2hpbGQKICAgIC8vIHVzZWQgdGhlbSBkdXJpbmcgcmVuZGVyCiAgICB2bS4kYXR0cnMgPSBwYXJlbnRWbm9kZS5kYXRhLmF0dHJzIHx8IGVtcHR5T2JqZWN0OwogICAgdm0uJGxpc3RlbmVycyA9IGxpc3RlbmVycyB8fCBlbXB0eU9iamVjdDsKCiAgICAvLyB1cGRhdGUgcHJvcHMKICAgIGlmIChwcm9wc0RhdGEgJiYgdm0uJG9wdGlvbnMucHJvcHMpIHsKICAgICAgdG9nZ2xlT2JzZXJ2aW5nKGZhbHNlKTsKICAgICAgdmFyIHByb3BzID0gdm0uX3Byb3BzOwogICAgICB2YXIgcHJvcEtleXMgPSB2bS4kb3B0aW9ucy5fcHJvcEtleXMgfHwgW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIga2V5ID0gcHJvcEtleXNbaV07CiAgICAgICAgdmFyIHByb3BPcHRpb25zID0gdm0uJG9wdGlvbnMucHJvcHM7IC8vIHd0ZiBmbG93PwogICAgICAgIHByb3BzW2tleV0gPSB2YWxpZGF0ZVByb3Aoa2V5LCBwcm9wT3B0aW9ucywgcHJvcHNEYXRhLCB2bSk7CiAgICAgIH0KICAgICAgdG9nZ2xlT2JzZXJ2aW5nKHRydWUpOwogICAgICAvLyBrZWVwIGEgY29weSBvZiByYXcgcHJvcHNEYXRhCiAgICAgIHZtLiRvcHRpb25zLnByb3BzRGF0YSA9IHByb3BzRGF0YTsKICAgIH0KCiAgICAvLyB1cGRhdGUgbGlzdGVuZXJzCiAgICBsaXN0ZW5lcnMgPSBsaXN0ZW5lcnMgfHwgZW1wdHlPYmplY3Q7CiAgICB2YXIgb2xkTGlzdGVuZXJzID0gdm0uJG9wdGlvbnMuX3BhcmVudExpc3RlbmVyczsKICAgIHZtLiRvcHRpb25zLl9wYXJlbnRMaXN0ZW5lcnMgPSBsaXN0ZW5lcnM7CiAgICB1cGRhdGVDb21wb25lbnRMaXN0ZW5lcnModm0sIGxpc3RlbmVycywgb2xkTGlzdGVuZXJzKTsKCiAgICAvLyByZXNvbHZlIHNsb3RzICsgZm9yY2UgdXBkYXRlIGlmIGhhcyBjaGlsZHJlbgogICAgaWYgKG5lZWRzRm9yY2VVcGRhdGUpIHsKICAgICAgdm0uJHNsb3RzID0gcmVzb2x2ZVNsb3RzKHJlbmRlckNoaWxkcmVuLCBwYXJlbnRWbm9kZS5jb250ZXh0KTsKICAgICAgdm0uJGZvcmNlVXBkYXRlKCk7CiAgICB9CgogICAgewogICAgICBpc1VwZGF0aW5nQ2hpbGRDb21wb25lbnQgPSBmYWxzZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzSW5JbmFjdGl2ZVRyZWUgKHZtKSB7CiAgICB3aGlsZSAodm0gJiYgKHZtID0gdm0uJHBhcmVudCkpIHsKICAgICAgaWYgKHZtLl9pbmFjdGl2ZSkgeyByZXR1cm4gdHJ1ZSB9CiAgICB9CiAgICByZXR1cm4gZmFsc2UKICB9CgogIGZ1bmN0aW9uIGFjdGl2YXRlQ2hpbGRDb21wb25lbnQgKHZtLCBkaXJlY3QpIHsKICAgIGlmIChkaXJlY3QpIHsKICAgICAgdm0uX2RpcmVjdEluYWN0aXZlID0gZmFsc2U7CiAgICAgIGlmIChpc0luSW5hY3RpdmVUcmVlKHZtKSkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICB9IGVsc2UgaWYgKHZtLl9kaXJlY3RJbmFjdGl2ZSkgewogICAgICByZXR1cm4KICAgIH0KICAgIGlmICh2bS5faW5hY3RpdmUgfHwgdm0uX2luYWN0aXZlID09PSBudWxsKSB7CiAgICAgIHZtLl9pbmFjdGl2ZSA9IGZhbHNlOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLiRjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIGFjdGl2YXRlQ2hpbGRDb21wb25lbnQodm0uJGNoaWxkcmVuW2ldKTsKICAgICAgfQogICAgICBjYWxsSG9vayh2bSwgJ2FjdGl2YXRlZCcpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZGVhY3RpdmF0ZUNoaWxkQ29tcG9uZW50ICh2bSwgZGlyZWN0KSB7CiAgICBpZiAoZGlyZWN0KSB7CiAgICAgIHZtLl9kaXJlY3RJbmFjdGl2ZSA9IHRydWU7CiAgICAgIGlmIChpc0luSW5hY3RpdmVUcmVlKHZtKSkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICB9CiAgICBpZiAoIXZtLl9pbmFjdGl2ZSkgewogICAgICB2bS5faW5hY3RpdmUgPSB0cnVlOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLiRjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIGRlYWN0aXZhdGVDaGlsZENvbXBvbmVudCh2bS4kY2hpbGRyZW5baV0pOwogICAgICB9CiAgICAgIGNhbGxIb29rKHZtLCAnZGVhY3RpdmF0ZWQnKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNhbGxIb29rICh2bSwgaG9vaykgewogICAgLy8gIzc1NzMgZGlzYWJsZSBkZXAgY29sbGVjdGlvbiB3aGVuIGludm9raW5nIGxpZmVjeWNsZSBob29rcwogICAgcHVzaFRhcmdldCgpOwogICAgdmFyIGhhbmRsZXJzID0gdm0uJG9wdGlvbnNbaG9va107CiAgICB2YXIgaW5mbyA9IGhvb2sgKyAiIGhvb2siOwogICAgaWYgKGhhbmRsZXJzKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgajsgaSsrKSB7CiAgICAgICAgaW52b2tlV2l0aEVycm9ySGFuZGxpbmcoaGFuZGxlcnNbaV0sIHZtLCBudWxsLCB2bSwgaW5mbyk7CiAgICAgIH0KICAgIH0KICAgIGlmICh2bS5faGFzSG9va0V2ZW50KSB7CiAgICAgIHZtLiRlbWl0KCdob29rOicgKyBob29rKTsKICAgIH0KICAgIHBvcFRhcmdldCgpOwogIH0KCiAgLyogICovCgogIHZhciBNQVhfVVBEQVRFX0NPVU5UID0gMTAwOwoKICB2YXIgcXVldWUgPSBbXTsKICB2YXIgYWN0aXZhdGVkQ2hpbGRyZW4gPSBbXTsKICB2YXIgaGFzID0ge307CiAgdmFyIGNpcmN1bGFyID0ge307CiAgdmFyIHdhaXRpbmcgPSBmYWxzZTsKICB2YXIgZmx1c2hpbmcgPSBmYWxzZTsKICB2YXIgaW5kZXggPSAwOwoKICAvKioKICAgKiBSZXNldCB0aGUgc2NoZWR1bGVyJ3Mgc3RhdGUuCiAgICovCiAgZnVuY3Rpb24gcmVzZXRTY2hlZHVsZXJTdGF0ZSAoKSB7CiAgICBpbmRleCA9IHF1ZXVlLmxlbmd0aCA9IGFjdGl2YXRlZENoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICBoYXMgPSB7fTsKICAgIHsKICAgICAgY2lyY3VsYXIgPSB7fTsKICAgIH0KICAgIHdhaXRpbmcgPSBmbHVzaGluZyA9IGZhbHNlOwogIH0KCiAgLy8gQXN5bmMgZWRnZSBjYXNlICM2NTY2IHJlcXVpcmVzIHNhdmluZyB0aGUgdGltZXN0YW1wIHdoZW4gZXZlbnQgbGlzdGVuZXJzIGFyZQogIC8vIGF0dGFjaGVkLiBIb3dldmVyLCBjYWxsaW5nIHBlcmZvcm1hbmNlLm5vdygpIGhhcyBhIHBlcmYgb3ZlcmhlYWQgZXNwZWNpYWxseQogIC8vIGlmIHRoZSBwYWdlIGhhcyB0aG91c2FuZHMgb2YgZXZlbnQgbGlzdGVuZXJzLiBJbnN0ZWFkLCB3ZSB0YWtlIGEgdGltZXN0YW1wCiAgLy8gZXZlcnkgdGltZSB0aGUgc2NoZWR1bGVyIGZsdXNoZXMgYW5kIHVzZSB0aGF0IGZvciBhbGwgZXZlbnQgbGlzdGVuZXJzCiAgLy8gYXR0YWNoZWQgZHVyaW5nIHRoYXQgZmx1c2guCiAgdmFyIGN1cnJlbnRGbHVzaFRpbWVzdGFtcCA9IDA7CgogIC8vIEFzeW5jIGVkZ2UgY2FzZSBmaXggcmVxdWlyZXMgc3RvcmluZyBhbiBldmVudCBsaXN0ZW5lcidzIGF0dGFjaCB0aW1lc3RhbXAuCiAgdmFyIGdldE5vdyA9IERhdGUubm93OwoKICAvLyBEZXRlcm1pbmUgd2hhdCBldmVudCB0aW1lc3RhbXAgdGhlIGJyb3dzZXIgaXMgdXNpbmcuIEFubm95aW5nbHksIHRoZQogIC8vIHRpbWVzdGFtcCBjYW4gZWl0aGVyIGJlIGhpLXJlcyAocmVsYXRpdmUgdG8gcGFnZSBsb2FkKSBvciBsb3ctcmVzCiAgLy8gKHJlbGF0aXZlIHRvIFVOSVggZXBvY2gpLCBzbyBpbiBvcmRlciB0byBjb21wYXJlIHRpbWUgd2UgaGF2ZSB0byB1c2UgdGhlCiAgLy8gc2FtZSB0aW1lc3RhbXAgdHlwZSB3aGVuIHNhdmluZyB0aGUgZmx1c2ggdGltZXN0YW1wLgogIC8vIEFsbCBJRSB2ZXJzaW9ucyB1c2UgbG93LXJlcyBldmVudCB0aW1lc3RhbXBzLCBhbmQgaGF2ZSBwcm9ibGVtYXRpYyBjbG9jawogIC8vIGltcGxlbWVudGF0aW9ucyAoIzk2MzIpCiAgaWYgKGluQnJvd3NlciAmJiAhaXNJRSkgewogICAgdmFyIHBlcmZvcm1hbmNlID0gd2luZG93LnBlcmZvcm1hbmNlOwogICAgaWYgKAogICAgICBwZXJmb3JtYW5jZSAmJgogICAgICB0eXBlb2YgcGVyZm9ybWFuY2Uubm93ID09PSAnZnVuY3Rpb24nICYmCiAgICAgIGdldE5vdygpID4gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50JykudGltZVN0YW1wCiAgICApIHsKICAgICAgLy8gaWYgdGhlIGV2ZW50IHRpbWVzdGFtcCwgYWx0aG91Z2ggZXZhbHVhdGVkIEFGVEVSIHRoZSBEYXRlLm5vdygpLCBpcwogICAgICAvLyBzbWFsbGVyIHRoYW4gaXQsIGl0IG1lYW5zIHRoZSBldmVudCBpcyB1c2luZyBhIGhpLXJlcyB0aW1lc3RhbXAsCiAgICAgIC8vIGFuZCB3ZSBuZWVkIHRvIHVzZSB0aGUgaGktcmVzIHZlcnNpb24gZm9yIGV2ZW50IGxpc3RlbmVyIHRpbWVzdGFtcHMgYXMKICAgICAgLy8gd2VsbC4KICAgICAgZ2V0Tm93ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCk7IH07CiAgICB9CiAgfQoKICAvKioKICAgKiBGbHVzaCBib3RoIHF1ZXVlcyBhbmQgcnVuIHRoZSB3YXRjaGVycy4KICAgKi8KICBmdW5jdGlvbiBmbHVzaFNjaGVkdWxlclF1ZXVlICgpIHsKICAgIGN1cnJlbnRGbHVzaFRpbWVzdGFtcCA9IGdldE5vdygpOwogICAgZmx1c2hpbmcgPSB0cnVlOwogICAgdmFyIHdhdGNoZXIsIGlkOwoKICAgIC8vIFNvcnQgcXVldWUgYmVmb3JlIGZsdXNoLgogICAgLy8gVGhpcyBlbnN1cmVzIHRoYXQ6CiAgICAvLyAxLiBDb21wb25lbnRzIGFyZSB1cGRhdGVkIGZyb20gcGFyZW50IHRvIGNoaWxkLiAoYmVjYXVzZSBwYXJlbnQgaXMgYWx3YXlzCiAgICAvLyAgICBjcmVhdGVkIGJlZm9yZSB0aGUgY2hpbGQpCiAgICAvLyAyLiBBIGNvbXBvbmVudCdzIHVzZXIgd2F0Y2hlcnMgYXJlIHJ1biBiZWZvcmUgaXRzIHJlbmRlciB3YXRjaGVyIChiZWNhdXNlCiAgICAvLyAgICB1c2VyIHdhdGNoZXJzIGFyZSBjcmVhdGVkIGJlZm9yZSB0aGUgcmVuZGVyIHdhdGNoZXIpCiAgICAvLyAzLiBJZiBhIGNvbXBvbmVudCBpcyBkZXN0cm95ZWQgZHVyaW5nIGEgcGFyZW50IGNvbXBvbmVudCdzIHdhdGNoZXIgcnVuLAogICAgLy8gICAgaXRzIHdhdGNoZXJzIGNhbiBiZSBza2lwcGVkLgogICAgcXVldWUuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5pZCAtIGIuaWQ7IH0pOwoKICAgIC8vIGRvIG5vdCBjYWNoZSBsZW5ndGggYmVjYXVzZSBtb3JlIHdhdGNoZXJzIG1pZ2h0IGJlIHB1c2hlZAogICAgLy8gYXMgd2UgcnVuIGV4aXN0aW5nIHdhdGNoZXJzCiAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBxdWV1ZS5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgd2F0Y2hlciA9IHF1ZXVlW2luZGV4XTsKICAgICAgaWYgKHdhdGNoZXIuYmVmb3JlKSB7CiAgICAgICAgd2F0Y2hlci5iZWZvcmUoKTsKICAgICAgfQogICAgICBpZCA9IHdhdGNoZXIuaWQ7CiAgICAgIGhhc1tpZF0gPSBudWxsOwogICAgICB3YXRjaGVyLnJ1bigpOwogICAgICAvLyBpbiBkZXYgYnVpbGQsIGNoZWNrIGFuZCBzdG9wIGNpcmN1bGFyIHVwZGF0ZXMuCiAgICAgIGlmIChoYXNbaWRdICE9IG51bGwpIHsKICAgICAgICBjaXJjdWxhcltpZF0gPSAoY2lyY3VsYXJbaWRdIHx8IDApICsgMTsKICAgICAgICBpZiAoY2lyY3VsYXJbaWRdID4gTUFYX1VQREFURV9DT1VOVCkgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgJ1lvdSBtYXkgaGF2ZSBhbiBpbmZpbml0ZSB1cGRhdGUgbG9vcCAnICsgKAogICAgICAgICAgICAgIHdhdGNoZXIudXNlcgogICAgICAgICAgICAgICAgPyAoImluIHdhdGNoZXIgd2l0aCBleHByZXNzaW9uIFwiIiArICh3YXRjaGVyLmV4cHJlc3Npb24pICsgIlwiIikKICAgICAgICAgICAgICAgIDogImluIGEgY29tcG9uZW50IHJlbmRlciBmdW5jdGlvbi4iCiAgICAgICAgICAgICksCiAgICAgICAgICAgIHdhdGNoZXIudm0KICAgICAgICAgICk7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIGtlZXAgY29waWVzIG9mIHBvc3QgcXVldWVzIGJlZm9yZSByZXNldHRpbmcgc3RhdGUKICAgIHZhciBhY3RpdmF0ZWRRdWV1ZSA9IGFjdGl2YXRlZENoaWxkcmVuLnNsaWNlKCk7CiAgICB2YXIgdXBkYXRlZFF1ZXVlID0gcXVldWUuc2xpY2UoKTsKCiAgICByZXNldFNjaGVkdWxlclN0YXRlKCk7CgogICAgLy8gY2FsbCBjb21wb25lbnQgdXBkYXRlZCBhbmQgYWN0aXZhdGVkIGhvb2tzCiAgICBjYWxsQWN0aXZhdGVkSG9va3MoYWN0aXZhdGVkUXVldWUpOwogICAgY2FsbFVwZGF0ZWRIb29rcyh1cGRhdGVkUXVldWUpOwoKICAgIC8vIGRldnRvb2wgaG9vawogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoZGV2dG9vbHMgJiYgY29uZmlnLmRldnRvb2xzKSB7CiAgICAgIGRldnRvb2xzLmVtaXQoJ2ZsdXNoJyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjYWxsVXBkYXRlZEhvb2tzIChxdWV1ZSkgewogICAgdmFyIGkgPSBxdWV1ZS5sZW5ndGg7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIHZhciB3YXRjaGVyID0gcXVldWVbaV07CiAgICAgIHZhciB2bSA9IHdhdGNoZXIudm07CiAgICAgIGlmICh2bS5fd2F0Y2hlciA9PT0gd2F0Y2hlciAmJiB2bS5faXNNb3VudGVkICYmICF2bS5faXNEZXN0cm95ZWQpIHsKICAgICAgICBjYWxsSG9vayh2bSwgJ3VwZGF0ZWQnKTsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogUXVldWUgYSBrZXB0LWFsaXZlIGNvbXBvbmVudCB0aGF0IHdhcyBhY3RpdmF0ZWQgZHVyaW5nIHBhdGNoLgogICAqIFRoZSBxdWV1ZSB3aWxsIGJlIHByb2Nlc3NlZCBhZnRlciB0aGUgZW50aXJlIHRyZWUgaGFzIGJlZW4gcGF0Y2hlZC4KICAgKi8KICBmdW5jdGlvbiBxdWV1ZUFjdGl2YXRlZENvbXBvbmVudCAodm0pIHsKICAgIC8vIHNldHRpbmcgX2luYWN0aXZlIHRvIGZhbHNlIGhlcmUgc28gdGhhdCBhIHJlbmRlciBmdW5jdGlvbiBjYW4KICAgIC8vIHJlbHkgb24gY2hlY2tpbmcgd2hldGhlciBpdCdzIGluIGFuIGluYWN0aXZlIHRyZWUgKGUuZy4gcm91dGVyLXZpZXcpCiAgICB2bS5faW5hY3RpdmUgPSBmYWxzZTsKICAgIGFjdGl2YXRlZENoaWxkcmVuLnB1c2godm0pOwogIH0KCiAgZnVuY3Rpb24gY2FsbEFjdGl2YXRlZEhvb2tzIChxdWV1ZSkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykgewogICAgICBxdWV1ZVtpXS5faW5hY3RpdmUgPSB0cnVlOwogICAgICBhY3RpdmF0ZUNoaWxkQ29tcG9uZW50KHF1ZXVlW2ldLCB0cnVlIC8qIHRydWUgKi8pOwogICAgfQogIH0KCiAgLyoqCiAgICogUHVzaCBhIHdhdGNoZXIgaW50byB0aGUgd2F0Y2hlciBxdWV1ZS4KICAgKiBKb2JzIHdpdGggZHVwbGljYXRlIElEcyB3aWxsIGJlIHNraXBwZWQgdW5sZXNzIGl0J3MKICAgKiBwdXNoZWQgd2hlbiB0aGUgcXVldWUgaXMgYmVpbmcgZmx1c2hlZC4KICAgKi8KICBmdW5jdGlvbiBxdWV1ZVdhdGNoZXIgKHdhdGNoZXIpIHsKICAgIHZhciBpZCA9IHdhdGNoZXIuaWQ7CiAgICBpZiAoaGFzW2lkXSA9PSBudWxsKSB7CiAgICAgIGhhc1tpZF0gPSB0cnVlOwogICAgICBpZiAoIWZsdXNoaW5nKSB7CiAgICAgICAgcXVldWUucHVzaCh3YXRjaGVyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBpZiBhbHJlYWR5IGZsdXNoaW5nLCBzcGxpY2UgdGhlIHdhdGNoZXIgYmFzZWQgb24gaXRzIGlkCiAgICAgICAgLy8gaWYgYWxyZWFkeSBwYXN0IGl0cyBpZCwgaXQgd2lsbCBiZSBydW4gbmV4dCBpbW1lZGlhdGVseS4KICAgICAgICB2YXIgaSA9IHF1ZXVlLmxlbmd0aCAtIDE7CiAgICAgICAgd2hpbGUgKGkgPiBpbmRleCAmJiBxdWV1ZVtpXS5pZCA+IHdhdGNoZXIuaWQpIHsKICAgICAgICAgIGktLTsKICAgICAgICB9CiAgICAgICAgcXVldWUuc3BsaWNlKGkgKyAxLCAwLCB3YXRjaGVyKTsKICAgICAgfQogICAgICAvLyBxdWV1ZSB0aGUgZmx1c2gKICAgICAgaWYgKCF3YWl0aW5nKSB7CiAgICAgICAgd2FpdGluZyA9IHRydWU7CgogICAgICAgIGlmICghY29uZmlnLmFzeW5jKSB7CiAgICAgICAgICBmbHVzaFNjaGVkdWxlclF1ZXVlKCk7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgbmV4dFRpY2soZmx1c2hTY2hlZHVsZXJRdWV1ZSk7CiAgICAgIH0KICAgIH0KICB9CgogIC8qICAqLwoKCgogIHZhciB1aWQkMiA9IDA7CgogIC8qKgogICAqIEEgd2F0Y2hlciBwYXJzZXMgYW4gZXhwcmVzc2lvbiwgY29sbGVjdHMgZGVwZW5kZW5jaWVzLAogICAqIGFuZCBmaXJlcyBjYWxsYmFjayB3aGVuIHRoZSBleHByZXNzaW9uIHZhbHVlIGNoYW5nZXMuCiAgICogVGhpcyBpcyB1c2VkIGZvciBib3RoIHRoZSAkd2F0Y2goKSBhcGkgYW5kIGRpcmVjdGl2ZXMuCiAgICovCiAgdmFyIFdhdGNoZXIgPSBmdW5jdGlvbiBXYXRjaGVyICgKICAgIHZtLAogICAgZXhwT3JGbiwKICAgIGNiLAogICAgb3B0aW9ucywKICAgIGlzUmVuZGVyV2F0Y2hlcgogICkgewogICAgdGhpcy52bSA9IHZtOwogICAgaWYgKGlzUmVuZGVyV2F0Y2hlcikgewogICAgICB2bS5fd2F0Y2hlciA9IHRoaXM7CiAgICB9CiAgICB2bS5fd2F0Y2hlcnMucHVzaCh0aGlzKTsKICAgIC8vIG9wdGlvbnMKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIHRoaXMuZGVlcCA9ICEhb3B0aW9ucy5kZWVwOwogICAgICB0aGlzLnVzZXIgPSAhIW9wdGlvbnMudXNlcjsKICAgICAgdGhpcy5sYXp5ID0gISFvcHRpb25zLmxhenk7CiAgICAgIHRoaXMuc3luYyA9ICEhb3B0aW9ucy5zeW5jOwogICAgICB0aGlzLmJlZm9yZSA9IG9wdGlvbnMuYmVmb3JlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kZWVwID0gdGhpcy51c2VyID0gdGhpcy5sYXp5ID0gdGhpcy5zeW5jID0gZmFsc2U7CiAgICB9CiAgICB0aGlzLmNiID0gY2I7CiAgICB0aGlzLmlkID0gKyt1aWQkMjsgLy8gdWlkIGZvciBiYXRjaGluZwogICAgdGhpcy5hY3RpdmUgPSB0cnVlOwogICAgdGhpcy5kaXJ0eSA9IHRoaXMubGF6eTsgLy8gZm9yIGxhenkgd2F0Y2hlcnMKICAgIHRoaXMuZGVwcyA9IFtdOwogICAgdGhpcy5uZXdEZXBzID0gW107CiAgICB0aGlzLmRlcElkcyA9IG5ldyBfU2V0KCk7CiAgICB0aGlzLm5ld0RlcElkcyA9IG5ldyBfU2V0KCk7CiAgICB0aGlzLmV4cHJlc3Npb24gPSBleHBPckZuLnRvU3RyaW5nKCk7CiAgICAvLyBwYXJzZSBleHByZXNzaW9uIGZvciBnZXR0ZXIKICAgIGlmICh0eXBlb2YgZXhwT3JGbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICB0aGlzLmdldHRlciA9IGV4cE9yRm47CiAgICB9IGVsc2UgewogICAgICB0aGlzLmdldHRlciA9IHBhcnNlUGF0aChleHBPckZuKTsKICAgICAgaWYgKCF0aGlzLmdldHRlcikgewogICAgICAgIHRoaXMuZ2V0dGVyID0gbm9vcDsKICAgICAgICB3YXJuKAogICAgICAgICAgIkZhaWxlZCB3YXRjaGluZyBwYXRoOiBcIiIgKyBleHBPckZuICsgIlwiICIgKwogICAgICAgICAgJ1dhdGNoZXIgb25seSBhY2NlcHRzIHNpbXBsZSBkb3QtZGVsaW1pdGVkIHBhdGhzLiAnICsKICAgICAgICAgICdGb3IgZnVsbCBjb250cm9sLCB1c2UgYSBmdW5jdGlvbiBpbnN0ZWFkLicsCiAgICAgICAgICB2bQogICAgICAgICk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMudmFsdWUgPSB0aGlzLmxhenkKICAgICAgPyB1bmRlZmluZWQKICAgICAgOiB0aGlzLmdldCgpOwogIH07CgogIC8qKgogICAqIEV2YWx1YXRlIHRoZSBnZXR0ZXIsIGFuZCByZS1jb2xsZWN0IGRlcGVuZGVuY2llcy4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQgKCkgewogICAgcHVzaFRhcmdldCh0aGlzKTsKICAgIHZhciB2YWx1ZTsKICAgIHZhciB2bSA9IHRoaXMudm07CiAgICB0cnkgewogICAgICB2YWx1ZSA9IHRoaXMuZ2V0dGVyLmNhbGwodm0sIHZtKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaWYgKHRoaXMudXNlcikgewogICAgICAgIGhhbmRsZUVycm9yKGUsIHZtLCAoImdldHRlciBmb3Igd2F0Y2hlciBcIiIgKyAodGhpcy5leHByZXNzaW9uKSArICJcIiIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBlCiAgICAgIH0KICAgIH0gZmluYWxseSB7CiAgICAgIC8vICJ0b3VjaCIgZXZlcnkgcHJvcGVydHkgc28gdGhleSBhcmUgYWxsIHRyYWNrZWQgYXMKICAgICAgLy8gZGVwZW5kZW5jaWVzIGZvciBkZWVwIHdhdGNoaW5nCiAgICAgIGlmICh0aGlzLmRlZXApIHsKICAgICAgICB0cmF2ZXJzZSh2YWx1ZSk7CiAgICAgIH0KICAgICAgcG9wVGFyZ2V0KCk7CiAgICAgIHRoaXMuY2xlYW51cERlcHMoKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZQogIH07CgogIC8qKgogICAqIEFkZCBhIGRlcGVuZGVuY3kgdG8gdGhpcyBkaXJlY3RpdmUuCiAgICovCiAgV2F0Y2hlci5wcm90b3R5cGUuYWRkRGVwID0gZnVuY3Rpb24gYWRkRGVwIChkZXApIHsKICAgIHZhciBpZCA9IGRlcC5pZDsKICAgIGlmICghdGhpcy5uZXdEZXBJZHMuaGFzKGlkKSkgewogICAgICB0aGlzLm5ld0RlcElkcy5hZGQoaWQpOwogICAgICB0aGlzLm5ld0RlcHMucHVzaChkZXApOwogICAgICBpZiAoIXRoaXMuZGVwSWRzLmhhcyhpZCkpIHsKICAgICAgICBkZXAuYWRkU3ViKHRoaXMpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ2xlYW4gdXAgZm9yIGRlcGVuZGVuY3kgY29sbGVjdGlvbi4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5jbGVhbnVwRGVwcyA9IGZ1bmN0aW9uIGNsZWFudXBEZXBzICgpIHsKICAgIHZhciBpID0gdGhpcy5kZXBzLmxlbmd0aDsKICAgIHdoaWxlIChpLS0pIHsKICAgICAgdmFyIGRlcCA9IHRoaXMuZGVwc1tpXTsKICAgICAgaWYgKCF0aGlzLm5ld0RlcElkcy5oYXMoZGVwLmlkKSkgewogICAgICAgIGRlcC5yZW1vdmVTdWIodGhpcyk7CiAgICAgIH0KICAgIH0KICAgIHZhciB0bXAgPSB0aGlzLmRlcElkczsKICAgIHRoaXMuZGVwSWRzID0gdGhpcy5uZXdEZXBJZHM7CiAgICB0aGlzLm5ld0RlcElkcyA9IHRtcDsKICAgIHRoaXMubmV3RGVwSWRzLmNsZWFyKCk7CiAgICB0bXAgPSB0aGlzLmRlcHM7CiAgICB0aGlzLmRlcHMgPSB0aGlzLm5ld0RlcHM7CiAgICB0aGlzLm5ld0RlcHMgPSB0bXA7CiAgICB0aGlzLm5ld0RlcHMubGVuZ3RoID0gMDsKICB9OwoKICAvKioKICAgKiBTdWJzY3JpYmVyIGludGVyZmFjZS4KICAgKiBXaWxsIGJlIGNhbGxlZCB3aGVuIGEgZGVwZW5kZW5jeSBjaGFuZ2VzLgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIHVwZGF0ZSAoKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgaWYgKHRoaXMubGF6eSkgewogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAodGhpcy5zeW5jKSB7CiAgICAgIHRoaXMucnVuKCk7CiAgICB9IGVsc2UgewogICAgICBxdWV1ZVdhdGNoZXIodGhpcyk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2NoZWR1bGVyIGpvYiBpbnRlcmZhY2UuCiAgICogV2lsbCBiZSBjYWxsZWQgYnkgdGhlIHNjaGVkdWxlci4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiBydW4gKCkgewogICAgaWYgKHRoaXMuYWN0aXZlKSB7CiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0KCk7CiAgICAgIGlmICgKICAgICAgICB2YWx1ZSAhPT0gdGhpcy52YWx1ZSB8fAogICAgICAgIC8vIERlZXAgd2F0Y2hlcnMgYW5kIHdhdGNoZXJzIG9uIE9iamVjdC9BcnJheXMgc2hvdWxkIGZpcmUgZXZlbgogICAgICAgIC8vIHdoZW4gdGhlIHZhbHVlIGlzIHRoZSBzYW1lLCBiZWNhdXNlIHRoZSB2YWx1ZSBtYXkKICAgICAgICAvLyBoYXZlIG11dGF0ZWQuCiAgICAgICAgaXNPYmplY3QodmFsdWUpIHx8CiAgICAgICAgdGhpcy5kZWVwCiAgICAgICkgewogICAgICAgIC8vIHNldCBuZXcgdmFsdWUKICAgICAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLnZhbHVlOwogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICBpZiAodGhpcy51c2VyKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLmNiLmNhbGwodGhpcy52bSwgdmFsdWUsIG9sZFZhbHVlKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaGFuZGxlRXJyb3IoZSwgdGhpcy52bSwgKCJjYWxsYmFjayBmb3Igd2F0Y2hlciBcIiIgKyAodGhpcy5leHByZXNzaW9uKSArICJcIiIpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jYi5jYWxsKHRoaXMudm0sIHZhbHVlLCBvbGRWYWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRXZhbHVhdGUgdGhlIHZhbHVlIG9mIHRoZSB3YXRjaGVyLgogICAqIFRoaXMgb25seSBnZXRzIGNhbGxlZCBmb3IgbGF6eSB3YXRjaGVycy4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlICgpIHsKICAgIHRoaXMudmFsdWUgPSB0aGlzLmdldCgpOwogICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogIH07CgogIC8qKgogICAqIERlcGVuZCBvbiBhbGwgZGVwcyBjb2xsZWN0ZWQgYnkgdGhpcyB3YXRjaGVyLgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLmRlcGVuZCA9IGZ1bmN0aW9uIGRlcGVuZCAoKSB7CiAgICB2YXIgaSA9IHRoaXMuZGVwcy5sZW5ndGg7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIHRoaXMuZGVwc1tpXS5kZXBlbmQoKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBSZW1vdmUgc2VsZiBmcm9tIGFsbCBkZXBlbmRlbmNpZXMnIHN1YnNjcmliZXIgbGlzdC4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS50ZWFyZG93biA9IGZ1bmN0aW9uIHRlYXJkb3duICgpIHsKICAgIGlmICh0aGlzLmFjdGl2ZSkgewogICAgICAvLyByZW1vdmUgc2VsZiBmcm9tIHZtJ3Mgd2F0Y2hlciBsaXN0CiAgICAgIC8vIHRoaXMgaXMgYSBzb21ld2hhdCBleHBlbnNpdmUgb3BlcmF0aW9uIHNvIHdlIHNraXAgaXQKICAgICAgLy8gaWYgdGhlIHZtIGlzIGJlaW5nIGRlc3Ryb3llZC4KICAgICAgaWYgKCF0aGlzLnZtLl9pc0JlaW5nRGVzdHJveWVkKSB7CiAgICAgICAgcmVtb3ZlKHRoaXMudm0uX3dhdGNoZXJzLCB0aGlzKTsKICAgICAgfQogICAgICB2YXIgaSA9IHRoaXMuZGVwcy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB0aGlzLmRlcHNbaV0ucmVtb3ZlU3ViKHRoaXMpOwogICAgICB9CiAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7CiAgICB9CiAgfTsKCiAgLyogICovCgogIHZhciBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24gPSB7CiAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgZ2V0OiBub29wLAogICAgc2V0OiBub29wCiAgfTsKCiAgZnVuY3Rpb24gcHJveHkgKHRhcmdldCwgc291cmNlS2V5LCBrZXkpIHsKICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5nZXQgPSBmdW5jdGlvbiBwcm94eUdldHRlciAoKSB7CiAgICAgIHJldHVybiB0aGlzW3NvdXJjZUtleV1ba2V5XQogICAgfTsKICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5zZXQgPSBmdW5jdGlvbiBwcm94eVNldHRlciAodmFsKSB7CiAgICAgIHRoaXNbc291cmNlS2V5XVtrZXldID0gdmFsOwogICAgfTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc2hhcmVkUHJvcGVydHlEZWZpbml0aW9uKTsKICB9CgogIGZ1bmN0aW9uIGluaXRTdGF0ZSAodm0pIHsKICAgIHZtLl93YXRjaGVycyA9IFtdOwogICAgdmFyIG9wdHMgPSB2bS4kb3B0aW9uczsKICAgIGlmIChvcHRzLnByb3BzKSB7IGluaXRQcm9wcyh2bSwgb3B0cy5wcm9wcyk7IH0KICAgIGlmIChvcHRzLm1ldGhvZHMpIHsgaW5pdE1ldGhvZHModm0sIG9wdHMubWV0aG9kcyk7IH0KICAgIGlmIChvcHRzLmRhdGEpIHsKICAgICAgaW5pdERhdGEodm0pOwogICAgfSBlbHNlIHsKICAgICAgb2JzZXJ2ZSh2bS5fZGF0YSA9IHt9LCB0cnVlIC8qIGFzUm9vdERhdGEgKi8pOwogICAgfQogICAgaWYgKG9wdHMuY29tcHV0ZWQpIHsgaW5pdENvbXB1dGVkKHZtLCBvcHRzLmNvbXB1dGVkKTsgfQogICAgaWYgKG9wdHMud2F0Y2ggJiYgb3B0cy53YXRjaCAhPT0gbmF0aXZlV2F0Y2gpIHsKICAgICAgaW5pdFdhdGNoKHZtLCBvcHRzLndhdGNoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRQcm9wcyAodm0sIHByb3BzT3B0aW9ucykgewogICAgdmFyIHByb3BzRGF0YSA9IHZtLiRvcHRpb25zLnByb3BzRGF0YSB8fCB7fTsKICAgIHZhciBwcm9wcyA9IHZtLl9wcm9wcyA9IHt9OwogICAgLy8gY2FjaGUgcHJvcCBrZXlzIHNvIHRoYXQgZnV0dXJlIHByb3BzIHVwZGF0ZXMgY2FuIGl0ZXJhdGUgdXNpbmcgQXJyYXkKICAgIC8vIGluc3RlYWQgb2YgZHluYW1pYyBvYmplY3Qga2V5IGVudW1lcmF0aW9uLgogICAgdmFyIGtleXMgPSB2bS4kb3B0aW9ucy5fcHJvcEtleXMgPSBbXTsKICAgIHZhciBpc1Jvb3QgPSAhdm0uJHBhcmVudDsKICAgIC8vIHJvb3QgaW5zdGFuY2UgcHJvcHMgc2hvdWxkIGJlIGNvbnZlcnRlZAogICAgaWYgKCFpc1Jvb3QpIHsKICAgICAgdG9nZ2xlT2JzZXJ2aW5nKGZhbHNlKTsKICAgIH0KICAgIHZhciBsb29wID0gZnVuY3Rpb24gKCBrZXkgKSB7CiAgICAgIGtleXMucHVzaChrZXkpOwogICAgICB2YXIgdmFsdWUgPSB2YWxpZGF0ZVByb3Aoa2V5LCBwcm9wc09wdGlvbnMsIHByb3BzRGF0YSwgdm0pOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgICB7CiAgICAgICAgdmFyIGh5cGhlbmF0ZWRLZXkgPSBoeXBoZW5hdGUoa2V5KTsKICAgICAgICBpZiAoaXNSZXNlcnZlZEF0dHJpYnV0ZShoeXBoZW5hdGVkS2V5KSB8fAogICAgICAgICAgICBjb25maWcuaXNSZXNlcnZlZEF0dHIoaHlwaGVuYXRlZEtleSkpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICgiXCIiICsgaHlwaGVuYXRlZEtleSArICJcIiBpcyBhIHJlc2VydmVkIGF0dHJpYnV0ZSBhbmQgY2Fubm90IGJlIHVzZWQgYXMgY29tcG9uZW50IHByb3AuIiksCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBkZWZpbmVSZWFjdGl2ZSQkMShwcm9wcywga2V5LCB2YWx1ZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFpc1Jvb3QgJiYgIWlzVXBkYXRpbmdDaGlsZENvbXBvbmVudCkgewogICAgICAgICAgICB3YXJuKAogICAgICAgICAgICAgICJBdm9pZCBtdXRhdGluZyBhIHByb3AgZGlyZWN0bHkgc2luY2UgdGhlIHZhbHVlIHdpbGwgYmUgIiArCiAgICAgICAgICAgICAgIm92ZXJ3cml0dGVuIHdoZW5ldmVyIHRoZSBwYXJlbnQgY29tcG9uZW50IHJlLXJlbmRlcnMuICIgKwogICAgICAgICAgICAgICJJbnN0ZWFkLCB1c2UgYSBkYXRhIG9yIGNvbXB1dGVkIHByb3BlcnR5IGJhc2VkIG9uIHRoZSBwcm9wJ3MgIiArCiAgICAgICAgICAgICAgInZhbHVlLiBQcm9wIGJlaW5nIG11dGF0ZWQ6IFwiIiArIGtleSArICJcIiIsCiAgICAgICAgICAgICAgdm0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICAvLyBzdGF0aWMgcHJvcHMgYXJlIGFscmVhZHkgcHJveGllZCBvbiB0aGUgY29tcG9uZW50J3MgcHJvdG90eXBlCiAgICAgIC8vIGR1cmluZyBWdWUuZXh0ZW5kKCkuIFdlIG9ubHkgbmVlZCB0byBwcm94eSBwcm9wcyBkZWZpbmVkIGF0CiAgICAgIC8vIGluc3RhbnRpYXRpb24gaGVyZS4KICAgICAgaWYgKCEoa2V5IGluIHZtKSkgewogICAgICAgIHByb3h5KHZtLCAiX3Byb3BzIiwga2V5KTsKICAgICAgfQogICAgfTsKCiAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHNPcHRpb25zKSBsb29wKCBrZXkgKTsKICAgIHRvZ2dsZU9ic2VydmluZyh0cnVlKTsKICB9CgogIGZ1bmN0aW9uIGluaXREYXRhICh2bSkgewogICAgdmFyIGRhdGEgPSB2bS4kb3B0aW9ucy5kYXRhOwogICAgZGF0YSA9IHZtLl9kYXRhID0gdHlwZW9mIGRhdGEgPT09ICdmdW5jdGlvbicKICAgICAgPyBnZXREYXRhKGRhdGEsIHZtKQogICAgICA6IGRhdGEgfHwge307CiAgICBpZiAoIWlzUGxhaW5PYmplY3QoZGF0YSkpIHsKICAgICAgZGF0YSA9IHt9OwogICAgICB3YXJuKAogICAgICAgICdkYXRhIGZ1bmN0aW9ucyBzaG91bGQgcmV0dXJuIGFuIG9iamVjdDpcbicgKwogICAgICAgICdodHRwczovL3Z1ZWpzLm9yZy92Mi9ndWlkZS9jb21wb25lbnRzLmh0bWwjZGF0YS1NdXN0LUJlLWEtRnVuY3Rpb24nLAogICAgICAgIHZtCiAgICAgICk7CiAgICB9CiAgICAvLyBwcm94eSBkYXRhIG9uIGluc3RhbmNlCiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpOwogICAgdmFyIHByb3BzID0gdm0uJG9wdGlvbnMucHJvcHM7CiAgICB2YXIgbWV0aG9kcyA9IHZtLiRvcHRpb25zLm1ldGhvZHM7CiAgICB2YXIgaSA9IGtleXMubGVuZ3RoOwogICAgd2hpbGUgKGktLSkgewogICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgewogICAgICAgIGlmIChtZXRob2RzICYmIGhhc093bihtZXRob2RzLCBrZXkpKSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAoIk1ldGhvZCBcIiIgKyBrZXkgKyAiXCIgaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkIGFzIGEgZGF0YSBwcm9wZXJ0eS4iKSwKICAgICAgICAgICAgdm0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwcm9wcyAmJiBoYXNPd24ocHJvcHMsIGtleSkpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgIlRoZSBkYXRhIHByb3BlcnR5IFwiIiArIGtleSArICJcIiBpcyBhbHJlYWR5IGRlY2xhcmVkIGFzIGEgcHJvcC4gIiArCiAgICAgICAgICAiVXNlIHByb3AgZGVmYXVsdCB2YWx1ZSBpbnN0ZWFkLiIsCiAgICAgICAgICB2bQogICAgICAgICk7CiAgICAgIH0gZWxzZSBpZiAoIWlzUmVzZXJ2ZWQoa2V5KSkgewogICAgICAgIHByb3h5KHZtLCAiX2RhdGEiLCBrZXkpOwogICAgICB9CiAgICB9CiAgICAvLyBvYnNlcnZlIGRhdGEKICAgIG9ic2VydmUoZGF0YSwgdHJ1ZSAvKiBhc1Jvb3REYXRhICovKTsKICB9CgogIGZ1bmN0aW9uIGdldERhdGEgKGRhdGEsIHZtKSB7CiAgICAvLyAjNzU3MyBkaXNhYmxlIGRlcCBjb2xsZWN0aW9uIHdoZW4gaW52b2tpbmcgZGF0YSBnZXR0ZXJzCiAgICBwdXNoVGFyZ2V0KCk7CiAgICB0cnkgewogICAgICByZXR1cm4gZGF0YS5jYWxsKHZtLCB2bSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sICJkYXRhKCkiKTsKICAgICAgcmV0dXJuIHt9CiAgICB9IGZpbmFsbHkgewogICAgICBwb3BUYXJnZXQoKTsKICAgIH0KICB9CgogIHZhciBjb21wdXRlZFdhdGNoZXJPcHRpb25zID0geyBsYXp5OiB0cnVlIH07CgogIGZ1bmN0aW9uIGluaXRDb21wdXRlZCAodm0sIGNvbXB1dGVkKSB7CiAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgIHZhciB3YXRjaGVycyA9IHZtLl9jb21wdXRlZFdhdGNoZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIC8vIGNvbXB1dGVkIHByb3BlcnRpZXMgYXJlIGp1c3QgZ2V0dGVycyBkdXJpbmcgU1NSCiAgICB2YXIgaXNTU1IgPSBpc1NlcnZlclJlbmRlcmluZygpOwoKICAgIGZvciAodmFyIGtleSBpbiBjb21wdXRlZCkgewogICAgICB2YXIgdXNlckRlZiA9IGNvbXB1dGVkW2tleV07CiAgICAgIHZhciBnZXR0ZXIgPSB0eXBlb2YgdXNlckRlZiA9PT0gJ2Z1bmN0aW9uJyA/IHVzZXJEZWYgOiB1c2VyRGVmLmdldDsKICAgICAgaWYgKGdldHRlciA9PSBudWxsKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICgiR2V0dGVyIGlzIG1pc3NpbmcgZm9yIGNvbXB1dGVkIHByb3BlcnR5IFwiIiArIGtleSArICJcIi4iKSwKICAgICAgICAgIHZtCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgaWYgKCFpc1NTUikgewogICAgICAgIC8vIGNyZWF0ZSBpbnRlcm5hbCB3YXRjaGVyIGZvciB0aGUgY29tcHV0ZWQgcHJvcGVydHkuCiAgICAgICAgd2F0Y2hlcnNba2V5XSA9IG5ldyBXYXRjaGVyKAogICAgICAgICAgdm0sCiAgICAgICAgICBnZXR0ZXIgfHwgbm9vcCwKICAgICAgICAgIG5vb3AsCiAgICAgICAgICBjb21wdXRlZFdhdGNoZXJPcHRpb25zCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgLy8gY29tcG9uZW50LWRlZmluZWQgY29tcHV0ZWQgcHJvcGVydGllcyBhcmUgYWxyZWFkeSBkZWZpbmVkIG9uIHRoZQogICAgICAvLyBjb21wb25lbnQgcHJvdG90eXBlLiBXZSBvbmx5IG5lZWQgdG8gZGVmaW5lIGNvbXB1dGVkIHByb3BlcnRpZXMgZGVmaW5lZAogICAgICAvLyBhdCBpbnN0YW50aWF0aW9uIGhlcmUuCiAgICAgIGlmICghKGtleSBpbiB2bSkpIHsKICAgICAgICBkZWZpbmVDb21wdXRlZCh2bSwga2V5LCB1c2VyRGVmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoa2V5IGluIHZtLiRkYXRhKSB7CiAgICAgICAgICB3YXJuKCgiVGhlIGNvbXB1dGVkIHByb3BlcnR5IFwiIiArIGtleSArICJcIiBpcyBhbHJlYWR5IGRlZmluZWQgaW4gZGF0YS4iKSwgdm0pOwogICAgICAgIH0gZWxzZSBpZiAodm0uJG9wdGlvbnMucHJvcHMgJiYga2V5IGluIHZtLiRvcHRpb25zLnByb3BzKSB7CiAgICAgICAgICB3YXJuKCgiVGhlIGNvbXB1dGVkIHByb3BlcnR5IFwiIiArIGtleSArICJcIiBpcyBhbHJlYWR5IGRlZmluZWQgYXMgYSBwcm9wLiIpLCB2bSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkZWZpbmVDb21wdXRlZCAoCiAgICB0YXJnZXQsCiAgICBrZXksCiAgICB1c2VyRGVmCiAgKSB7CiAgICB2YXIgc2hvdWxkQ2FjaGUgPSAhaXNTZXJ2ZXJSZW5kZXJpbmcoKTsKICAgIGlmICh0eXBlb2YgdXNlckRlZiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24uZ2V0ID0gc2hvdWxkQ2FjaGUKICAgICAgICA/IGNyZWF0ZUNvbXB1dGVkR2V0dGVyKGtleSkKICAgICAgICA6IGNyZWF0ZUdldHRlckludm9rZXIodXNlckRlZik7CiAgICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5zZXQgPSBub29wOwogICAgfSBlbHNlIHsKICAgICAgc2hhcmVkUHJvcGVydHlEZWZpbml0aW9uLmdldCA9IHVzZXJEZWYuZ2V0CiAgICAgICAgPyBzaG91bGRDYWNoZSAmJiB1c2VyRGVmLmNhY2hlICE9PSBmYWxzZQogICAgICAgICAgPyBjcmVhdGVDb21wdXRlZEdldHRlcihrZXkpCiAgICAgICAgICA6IGNyZWF0ZUdldHRlckludm9rZXIodXNlckRlZi5nZXQpCiAgICAgICAgOiBub29wOwogICAgICBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24uc2V0ID0gdXNlckRlZi5zZXQgfHwgbm9vcDsKICAgIH0KICAgIGlmIChzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24uc2V0ID09PSBub29wKSB7CiAgICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5zZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICgiQ29tcHV0ZWQgcHJvcGVydHkgXCIiICsga2V5ICsgIlwiIHdhcyBhc3NpZ25lZCB0byBidXQgaXQgaGFzIG5vIHNldHRlci4iKSwKICAgICAgICAgIHRoaXMKICAgICAgICApOwogICAgICB9OwogICAgfQogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24pOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQ29tcHV0ZWRHZXR0ZXIgKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbXB1dGVkR2V0dGVyICgpIHsKICAgICAgdmFyIHdhdGNoZXIgPSB0aGlzLl9jb21wdXRlZFdhdGNoZXJzICYmIHRoaXMuX2NvbXB1dGVkV2F0Y2hlcnNba2V5XTsKICAgICAgaWYgKHdhdGNoZXIpIHsKICAgICAgICBpZiAod2F0Y2hlci5kaXJ0eSkgewogICAgICAgICAgd2F0Y2hlci5ldmFsdWF0ZSgpOwogICAgICAgIH0KICAgICAgICBpZiAoRGVwLnRhcmdldCkgewogICAgICAgICAgd2F0Y2hlci5kZXBlbmQoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHdhdGNoZXIudmFsdWUKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlR2V0dGVySW52b2tlcihmbikgewogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbXB1dGVkR2V0dGVyICgpIHsKICAgICAgcmV0dXJuIGZuLmNhbGwodGhpcywgdGhpcykKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRNZXRob2RzICh2bSwgbWV0aG9kcykgewogICAgdmFyIHByb3BzID0gdm0uJG9wdGlvbnMucHJvcHM7CiAgICBmb3IgKHZhciBrZXkgaW4gbWV0aG9kcykgewogICAgICB7CiAgICAgICAgaWYgKHR5cGVvZiBtZXRob2RzW2tleV0gIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICJNZXRob2QgXCIiICsga2V5ICsgIlwiIGhhcyB0eXBlIFwiIiArICh0eXBlb2YgbWV0aG9kc1trZXldKSArICJcIiBpbiB0aGUgY29tcG9uZW50IGRlZmluaXRpb24uICIgKwogICAgICAgICAgICAiRGlkIHlvdSByZWZlcmVuY2UgdGhlIGZ1bmN0aW9uIGNvcnJlY3RseT8iLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKHByb3BzICYmIGhhc093bihwcm9wcywga2V5KSkgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgKCJNZXRob2QgXCIiICsga2V5ICsgIlwiIGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZCBhcyBhIHByb3AuIiksCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoKGtleSBpbiB2bSkgJiYgaXNSZXNlcnZlZChrZXkpKSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAiTWV0aG9kIFwiIiArIGtleSArICJcIiBjb25mbGljdHMgd2l0aCBhbiBleGlzdGluZyBWdWUgaW5zdGFuY2UgbWV0aG9kLiAiICsKICAgICAgICAgICAgIkF2b2lkIGRlZmluaW5nIGNvbXBvbmVudCBtZXRob2RzIHRoYXQgc3RhcnQgd2l0aCBfIG9yICQuIgogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdm1ba2V5XSA9IHR5cGVvZiBtZXRob2RzW2tleV0gIT09ICdmdW5jdGlvbicgPyBub29wIDogYmluZChtZXRob2RzW2tleV0sIHZtKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRXYXRjaCAodm0sIHdhdGNoKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gd2F0Y2gpIHsKICAgICAgdmFyIGhhbmRsZXIgPSB3YXRjaFtrZXldOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShoYW5kbGVyKSkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFuZGxlci5sZW5ndGg7IGkrKykgewogICAgICAgICAgY3JlYXRlV2F0Y2hlcih2bSwga2V5LCBoYW5kbGVyW2ldKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3JlYXRlV2F0Y2hlcih2bSwga2V5LCBoYW5kbGVyKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlV2F0Y2hlciAoCiAgICB2bSwKICAgIGV4cE9yRm4sCiAgICBoYW5kbGVyLAogICAgb3B0aW9ucwogICkgewogICAgaWYgKGlzUGxhaW5PYmplY3QoaGFuZGxlcikpIHsKICAgICAgb3B0aW9ucyA9IGhhbmRsZXI7CiAgICAgIGhhbmRsZXIgPSBoYW5kbGVyLmhhbmRsZXI7CiAgICB9CiAgICBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICdzdHJpbmcnKSB7CiAgICAgIGhhbmRsZXIgPSB2bVtoYW5kbGVyXTsKICAgIH0KICAgIHJldHVybiB2bS4kd2F0Y2goZXhwT3JGbiwgaGFuZGxlciwgb3B0aW9ucykKICB9CgogIGZ1bmN0aW9uIHN0YXRlTWl4aW4gKFZ1ZSkgewogICAgLy8gZmxvdyBzb21laG93IGhhcyBwcm9ibGVtcyB3aXRoIGRpcmVjdGx5IGRlY2xhcmVkIGRlZmluaXRpb24gb2JqZWN0CiAgICAvLyB3aGVuIHVzaW5nIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwgc28gd2UgaGF2ZSB0byBwcm9jZWR1cmFsbHkgYnVpbGQgdXAKICAgIC8vIHRoZSBvYmplY3QgaGVyZS4KICAgIHZhciBkYXRhRGVmID0ge307CiAgICBkYXRhRGVmLmdldCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2RhdGEgfTsKICAgIHZhciBwcm9wc0RlZiA9IHt9OwogICAgcHJvcHNEZWYuZ2V0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fcHJvcHMgfTsKICAgIHsKICAgICAgZGF0YURlZi5zZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdBdm9pZCByZXBsYWNpbmcgaW5zdGFuY2Ugcm9vdCAkZGF0YS4gJyArCiAgICAgICAgICAnVXNlIG5lc3RlZCBkYXRhIHByb3BlcnRpZXMgaW5zdGVhZC4nLAogICAgICAgICAgdGhpcwogICAgICAgICk7CiAgICAgIH07CiAgICAgIHByb3BzRGVmLnNldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB3YXJuKCIkcHJvcHMgaXMgcmVhZG9ubHkuIiwgdGhpcyk7CiAgICAgIH07CiAgICB9CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlLnByb3RvdHlwZSwgJyRkYXRhJywgZGF0YURlZik7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlLnByb3RvdHlwZSwgJyRwcm9wcycsIHByb3BzRGVmKTsKCiAgICBWdWUucHJvdG90eXBlLiRzZXQgPSBzZXQ7CiAgICBWdWUucHJvdG90eXBlLiRkZWxldGUgPSBkZWw7CgogICAgVnVlLnByb3RvdHlwZS4kd2F0Y2ggPSBmdW5jdGlvbiAoCiAgICAgIGV4cE9yRm4sCiAgICAgIGNiLAogICAgICBvcHRpb25zCiAgICApIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgaWYgKGlzUGxhaW5PYmplY3QoY2IpKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZVdhdGNoZXIodm0sIGV4cE9yRm4sIGNiLCBvcHRpb25zKQogICAgICB9CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICBvcHRpb25zLnVzZXIgPSB0cnVlOwogICAgICB2YXIgd2F0Y2hlciA9IG5ldyBXYXRjaGVyKHZtLCBleHBPckZuLCBjYiwgb3B0aW9ucyk7CiAgICAgIGlmIChvcHRpb25zLmltbWVkaWF0ZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjYi5jYWxsKHZtLCB3YXRjaGVyLnZhbHVlKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgaGFuZGxlRXJyb3IoZXJyb3IsIHZtLCAoImNhbGxiYWNrIGZvciBpbW1lZGlhdGUgd2F0Y2hlciBcIiIgKyAod2F0Y2hlci5leHByZXNzaW9uKSArICJcIiIpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIHVud2F0Y2hGbiAoKSB7CiAgICAgICAgd2F0Y2hlci50ZWFyZG93bigpOwogICAgICB9CiAgICB9OwogIH0KCiAgLyogICovCgogIHZhciB1aWQkMyA9IDA7CgogIGZ1bmN0aW9uIGluaXRNaXhpbiAoVnVlKSB7CiAgICBWdWUucHJvdG90eXBlLl9pbml0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgLy8gYSB1aWQKICAgICAgdm0uX3VpZCA9IHVpZCQzKys7CgogICAgICB2YXIgc3RhcnRUYWcsIGVuZFRhZzsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmIChjb25maWcucGVyZm9ybWFuY2UgJiYgbWFyaykgewogICAgICAgIHN0YXJ0VGFnID0gInZ1ZS1wZXJmLXN0YXJ0OiIgKyAodm0uX3VpZCk7CiAgICAgICAgZW5kVGFnID0gInZ1ZS1wZXJmLWVuZDoiICsgKHZtLl91aWQpOwogICAgICAgIG1hcmsoc3RhcnRUYWcpOwogICAgICB9CgogICAgICAvLyBhIGZsYWcgdG8gYXZvaWQgdGhpcyBiZWluZyBvYnNlcnZlZAogICAgICB2bS5faXNWdWUgPSB0cnVlOwogICAgICAvLyBtZXJnZSBvcHRpb25zCiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuX2lzQ29tcG9uZW50KSB7CiAgICAgICAgLy8gb3B0aW1pemUgaW50ZXJuYWwgY29tcG9uZW50IGluc3RhbnRpYXRpb24KICAgICAgICAvLyBzaW5jZSBkeW5hbWljIG9wdGlvbnMgbWVyZ2luZyBpcyBwcmV0dHkgc2xvdywgYW5kIG5vbmUgb2YgdGhlCiAgICAgICAgLy8gaW50ZXJuYWwgY29tcG9uZW50IG9wdGlvbnMgbmVlZHMgc3BlY2lhbCB0cmVhdG1lbnQuCiAgICAgICAgaW5pdEludGVybmFsQ29tcG9uZW50KHZtLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS4kb3B0aW9ucyA9IG1lcmdlT3B0aW9ucygKICAgICAgICAgIHJlc29sdmVDb25zdHJ1Y3Rvck9wdGlvbnModm0uY29uc3RydWN0b3IpLAogICAgICAgICAgb3B0aW9ucyB8fCB7fSwKICAgICAgICAgIHZtCiAgICAgICAgKTsKICAgICAgfQogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgICB7CiAgICAgICAgaW5pdFByb3h5KHZtKTsKICAgICAgfQogICAgICAvLyBleHBvc2UgcmVhbCBzZWxmCiAgICAgIHZtLl9zZWxmID0gdm07CiAgICAgIGluaXRMaWZlY3ljbGUodm0pOwogICAgICBpbml0RXZlbnRzKHZtKTsKICAgICAgaW5pdFJlbmRlcih2bSk7CiAgICAgIGNhbGxIb29rKHZtLCAnYmVmb3JlQ3JlYXRlJyk7CiAgICAgIGluaXRJbmplY3Rpb25zKHZtKTsgLy8gcmVzb2x2ZSBpbmplY3Rpb25zIGJlZm9yZSBkYXRhL3Byb3BzCiAgICAgIGluaXRTdGF0ZSh2bSk7CiAgICAgIGluaXRQcm92aWRlKHZtKTsgLy8gcmVzb2x2ZSBwcm92aWRlIGFmdGVyIGRhdGEvcHJvcHMKICAgICAgY2FsbEhvb2sodm0sICdjcmVhdGVkJyk7CgogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKGNvbmZpZy5wZXJmb3JtYW5jZSAmJiBtYXJrKSB7CiAgICAgICAgdm0uX25hbWUgPSBmb3JtYXRDb21wb25lbnROYW1lKHZtLCBmYWxzZSk7CiAgICAgICAgbWFyayhlbmRUYWcpOwogICAgICAgIG1lYXN1cmUoKCJ2dWUgIiArICh2bS5fbmFtZSkgKyAiIGluaXQiKSwgc3RhcnRUYWcsIGVuZFRhZyk7CiAgICAgIH0KCiAgICAgIGlmICh2bS4kb3B0aW9ucy5lbCkgewogICAgICAgIHZtLiRtb3VudCh2bS4kb3B0aW9ucy5lbCk7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBpbml0SW50ZXJuYWxDb21wb25lbnQgKHZtLCBvcHRpb25zKSB7CiAgICB2YXIgb3B0cyA9IHZtLiRvcHRpb25zID0gT2JqZWN0LmNyZWF0ZSh2bS5jb25zdHJ1Y3Rvci5vcHRpb25zKTsKICAgIC8vIGRvaW5nIHRoaXMgYmVjYXVzZSBpdCdzIGZhc3RlciB0aGFuIGR5bmFtaWMgZW51bWVyYXRpb24uCiAgICB2YXIgcGFyZW50Vm5vZGUgPSBvcHRpb25zLl9wYXJlbnRWbm9kZTsKICAgIG9wdHMucGFyZW50ID0gb3B0aW9ucy5wYXJlbnQ7CiAgICBvcHRzLl9wYXJlbnRWbm9kZSA9IHBhcmVudFZub2RlOwoKICAgIHZhciB2bm9kZUNvbXBvbmVudE9wdGlvbnMgPSBwYXJlbnRWbm9kZS5jb21wb25lbnRPcHRpb25zOwogICAgb3B0cy5wcm9wc0RhdGEgPSB2bm9kZUNvbXBvbmVudE9wdGlvbnMucHJvcHNEYXRhOwogICAgb3B0cy5fcGFyZW50TGlzdGVuZXJzID0gdm5vZGVDb21wb25lbnRPcHRpb25zLmxpc3RlbmVyczsKICAgIG9wdHMuX3JlbmRlckNoaWxkcmVuID0gdm5vZGVDb21wb25lbnRPcHRpb25zLmNoaWxkcmVuOwogICAgb3B0cy5fY29tcG9uZW50VGFnID0gdm5vZGVDb21wb25lbnRPcHRpb25zLnRhZzsKCiAgICBpZiAob3B0aW9ucy5yZW5kZXIpIHsKICAgICAgb3B0cy5yZW5kZXIgPSBvcHRpb25zLnJlbmRlcjsKICAgICAgb3B0cy5zdGF0aWNSZW5kZXJGbnMgPSBvcHRpb25zLnN0YXRpY1JlbmRlckZuczsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlc29sdmVDb25zdHJ1Y3Rvck9wdGlvbnMgKEN0b3IpIHsKICAgIHZhciBvcHRpb25zID0gQ3Rvci5vcHRpb25zOwogICAgaWYgKEN0b3Iuc3VwZXIpIHsKICAgICAgdmFyIHN1cGVyT3B0aW9ucyA9IHJlc29sdmVDb25zdHJ1Y3Rvck9wdGlvbnMoQ3Rvci5zdXBlcik7CiAgICAgIHZhciBjYWNoZWRTdXBlck9wdGlvbnMgPSBDdG9yLnN1cGVyT3B0aW9uczsKICAgICAgaWYgKHN1cGVyT3B0aW9ucyAhPT0gY2FjaGVkU3VwZXJPcHRpb25zKSB7CiAgICAgICAgLy8gc3VwZXIgb3B0aW9uIGNoYW5nZWQsCiAgICAgICAgLy8gbmVlZCB0byByZXNvbHZlIG5ldyBvcHRpb25zLgogICAgICAgIEN0b3Iuc3VwZXJPcHRpb25zID0gc3VwZXJPcHRpb25zOwogICAgICAgIC8vIGNoZWNrIGlmIHRoZXJlIGFyZSBhbnkgbGF0ZS1tb2RpZmllZC9hdHRhY2hlZCBvcHRpb25zICgjNDk3NikKICAgICAgICB2YXIgbW9kaWZpZWRPcHRpb25zID0gcmVzb2x2ZU1vZGlmaWVkT3B0aW9ucyhDdG9yKTsKICAgICAgICAvLyB1cGRhdGUgYmFzZSBleHRlbmQgb3B0aW9ucwogICAgICAgIGlmIChtb2RpZmllZE9wdGlvbnMpIHsKICAgICAgICAgIGV4dGVuZChDdG9yLmV4dGVuZE9wdGlvbnMsIG1vZGlmaWVkT3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIG9wdGlvbnMgPSBDdG9yLm9wdGlvbnMgPSBtZXJnZU9wdGlvbnMoc3VwZXJPcHRpb25zLCBDdG9yLmV4dGVuZE9wdGlvbnMpOwogICAgICAgIGlmIChvcHRpb25zLm5hbWUpIHsKICAgICAgICAgIG9wdGlvbnMuY29tcG9uZW50c1tvcHRpb25zLm5hbWVdID0gQ3RvcjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvcHRpb25zCiAgfQoKICBmdW5jdGlvbiByZXNvbHZlTW9kaWZpZWRPcHRpb25zIChDdG9yKSB7CiAgICB2YXIgbW9kaWZpZWQ7CiAgICB2YXIgbGF0ZXN0ID0gQ3Rvci5vcHRpb25zOwogICAgdmFyIHNlYWxlZCA9IEN0b3Iuc2VhbGVkT3B0aW9uczsKICAgIGZvciAodmFyIGtleSBpbiBsYXRlc3QpIHsKICAgICAgaWYgKGxhdGVzdFtrZXldICE9PSBzZWFsZWRba2V5XSkgewogICAgICAgIGlmICghbW9kaWZpZWQpIHsgbW9kaWZpZWQgPSB7fTsgfQogICAgICAgIG1vZGlmaWVkW2tleV0gPSBsYXRlc3Rba2V5XTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG1vZGlmaWVkCiAgfQoKICBmdW5jdGlvbiBWdWUgKG9wdGlvbnMpIHsKICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBWdWUpCiAgICApIHsKICAgICAgd2FybignVnVlIGlzIGEgY29uc3RydWN0b3IgYW5kIHNob3VsZCBiZSBjYWxsZWQgd2l0aCB0aGUgYG5ld2Aga2V5d29yZCcpOwogICAgfQogICAgdGhpcy5faW5pdChvcHRpb25zKTsKICB9CgogIGluaXRNaXhpbihWdWUpOwogIHN0YXRlTWl4aW4oVnVlKTsKICBldmVudHNNaXhpbihWdWUpOwogIGxpZmVjeWNsZU1peGluKFZ1ZSk7CiAgcmVuZGVyTWl4aW4oVnVlKTsKCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRVc2UgKFZ1ZSkgewogICAgVnVlLnVzZSA9IGZ1bmN0aW9uIChwbHVnaW4pIHsKICAgICAgdmFyIGluc3RhbGxlZFBsdWdpbnMgPSAodGhpcy5faW5zdGFsbGVkUGx1Z2lucyB8fCAodGhpcy5faW5zdGFsbGVkUGx1Z2lucyA9IFtdKSk7CiAgICAgIGlmIChpbnN0YWxsZWRQbHVnaW5zLmluZGV4T2YocGx1Z2luKSA+IC0xKSB7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQoKICAgICAgLy8gYWRkaXRpb25hbCBwYXJhbWV0ZXJzCiAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMsIDEpOwogICAgICBhcmdzLnVuc2hpZnQodGhpcyk7CiAgICAgIGlmICh0eXBlb2YgcGx1Z2luLmluc3RhbGwgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBwbHVnaW4uaW5zdGFsbC5hcHBseShwbHVnaW4sIGFyZ3MpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwbHVnaW4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBwbHVnaW4uYXBwbHkobnVsbCwgYXJncyk7CiAgICAgIH0KICAgICAgaW5zdGFsbGVkUGx1Z2lucy5wdXNoKHBsdWdpbik7CiAgICAgIHJldHVybiB0aGlzCiAgICB9OwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRNaXhpbiQxIChWdWUpIHsKICAgIFZ1ZS5taXhpbiA9IGZ1bmN0aW9uIChtaXhpbikgewogICAgICB0aGlzLm9wdGlvbnMgPSBtZXJnZU9wdGlvbnModGhpcy5vcHRpb25zLCBtaXhpbik7CiAgICAgIHJldHVybiB0aGlzCiAgICB9OwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRFeHRlbmQgKFZ1ZSkgewogICAgLyoqCiAgICAgKiBFYWNoIGluc3RhbmNlIGNvbnN0cnVjdG9yLCBpbmNsdWRpbmcgVnVlLCBoYXMgYSB1bmlxdWUKICAgICAqIGNpZC4gVGhpcyBlbmFibGVzIHVzIHRvIGNyZWF0ZSB3cmFwcGVkICJjaGlsZAogICAgICogY29uc3RydWN0b3JzIiBmb3IgcHJvdG90eXBhbCBpbmhlcml0YW5jZSBhbmQgY2FjaGUgdGhlbS4KICAgICAqLwogICAgVnVlLmNpZCA9IDA7CiAgICB2YXIgY2lkID0gMTsKCiAgICAvKioKICAgICAqIENsYXNzIGluaGVyaXRhbmNlCiAgICAgKi8KICAgIFZ1ZS5leHRlbmQgPSBmdW5jdGlvbiAoZXh0ZW5kT3B0aW9ucykgewogICAgICBleHRlbmRPcHRpb25zID0gZXh0ZW5kT3B0aW9ucyB8fCB7fTsKICAgICAgdmFyIFN1cGVyID0gdGhpczsKICAgICAgdmFyIFN1cGVySWQgPSBTdXBlci5jaWQ7CiAgICAgIHZhciBjYWNoZWRDdG9ycyA9IGV4dGVuZE9wdGlvbnMuX0N0b3IgfHwgKGV4dGVuZE9wdGlvbnMuX0N0b3IgPSB7fSk7CiAgICAgIGlmIChjYWNoZWRDdG9yc1tTdXBlcklkXSkgewogICAgICAgIHJldHVybiBjYWNoZWRDdG9yc1tTdXBlcklkXQogICAgICB9CgogICAgICB2YXIgbmFtZSA9IGV4dGVuZE9wdGlvbnMubmFtZSB8fCBTdXBlci5vcHRpb25zLm5hbWU7CiAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVDb21wb25lbnROYW1lKG5hbWUpOwogICAgICB9CgogICAgICB2YXIgU3ViID0gZnVuY3Rpb24gVnVlQ29tcG9uZW50IChvcHRpb25zKSB7CiAgICAgICAgdGhpcy5faW5pdChvcHRpb25zKTsKICAgICAgfTsKICAgICAgU3ViLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU3VwZXIucHJvdG90eXBlKTsKICAgICAgU3ViLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFN1YjsKICAgICAgU3ViLmNpZCA9IGNpZCsrOwogICAgICBTdWIub3B0aW9ucyA9IG1lcmdlT3B0aW9ucygKICAgICAgICBTdXBlci5vcHRpb25zLAogICAgICAgIGV4dGVuZE9wdGlvbnMKICAgICAgKTsKICAgICAgU3ViWydzdXBlciddID0gU3VwZXI7CgogICAgICAvLyBGb3IgcHJvcHMgYW5kIGNvbXB1dGVkIHByb3BlcnRpZXMsIHdlIGRlZmluZSB0aGUgcHJveHkgZ2V0dGVycyBvbgogICAgICAvLyB0aGUgVnVlIGluc3RhbmNlcyBhdCBleHRlbnNpb24gdGltZSwgb24gdGhlIGV4dGVuZGVkIHByb3RvdHlwZS4gVGhpcwogICAgICAvLyBhdm9pZHMgT2JqZWN0LmRlZmluZVByb3BlcnR5IGNhbGxzIGZvciBlYWNoIGluc3RhbmNlIGNyZWF0ZWQuCiAgICAgIGlmIChTdWIub3B0aW9ucy5wcm9wcykgewogICAgICAgIGluaXRQcm9wcyQxKFN1Yik7CiAgICAgIH0KICAgICAgaWYgKFN1Yi5vcHRpb25zLmNvbXB1dGVkKSB7CiAgICAgICAgaW5pdENvbXB1dGVkJDEoU3ViKTsKICAgICAgfQoKICAgICAgLy8gYWxsb3cgZnVydGhlciBleHRlbnNpb24vbWl4aW4vcGx1Z2luIHVzYWdlCiAgICAgIFN1Yi5leHRlbmQgPSBTdXBlci5leHRlbmQ7CiAgICAgIFN1Yi5taXhpbiA9IFN1cGVyLm1peGluOwogICAgICBTdWIudXNlID0gU3VwZXIudXNlOwoKICAgICAgLy8gY3JlYXRlIGFzc2V0IHJlZ2lzdGVycywgc28gZXh0ZW5kZWQgY2xhc3NlcwogICAgICAvLyBjYW4gaGF2ZSB0aGVpciBwcml2YXRlIGFzc2V0cyB0b28uCiAgICAgIEFTU0VUX1RZUEVTLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICBTdWJbdHlwZV0gPSBTdXBlclt0eXBlXTsKICAgICAgfSk7CiAgICAgIC8vIGVuYWJsZSByZWN1cnNpdmUgc2VsZi1sb29rdXAKICAgICAgaWYgKG5hbWUpIHsKICAgICAgICBTdWIub3B0aW9ucy5jb21wb25lbnRzW25hbWVdID0gU3ViOwogICAgICB9CgogICAgICAvLyBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZSBzdXBlciBvcHRpb25zIGF0IGV4dGVuc2lvbiB0aW1lLgogICAgICAvLyBsYXRlciBhdCBpbnN0YW50aWF0aW9uIHdlIGNhbiBjaGVjayBpZiBTdXBlcidzIG9wdGlvbnMgaGF2ZQogICAgICAvLyBiZWVuIHVwZGF0ZWQuCiAgICAgIFN1Yi5zdXBlck9wdGlvbnMgPSBTdXBlci5vcHRpb25zOwogICAgICBTdWIuZXh0ZW5kT3B0aW9ucyA9IGV4dGVuZE9wdGlvbnM7CiAgICAgIFN1Yi5zZWFsZWRPcHRpb25zID0gZXh0ZW5kKHt9LCBTdWIub3B0aW9ucyk7CgogICAgICAvLyBjYWNoZSBjb25zdHJ1Y3RvcgogICAgICBjYWNoZWRDdG9yc1tTdXBlcklkXSA9IFN1YjsKICAgICAgcmV0dXJuIFN1YgogICAgfTsKICB9CgogIGZ1bmN0aW9uIGluaXRQcm9wcyQxIChDb21wKSB7CiAgICB2YXIgcHJvcHMgPSBDb21wLm9wdGlvbnMucHJvcHM7CiAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHMpIHsKICAgICAgcHJveHkoQ29tcC5wcm90b3R5cGUsICJfcHJvcHMiLCBrZXkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdENvbXB1dGVkJDEgKENvbXApIHsKICAgIHZhciBjb21wdXRlZCA9IENvbXAub3B0aW9ucy5jb21wdXRlZDsKICAgIGZvciAodmFyIGtleSBpbiBjb21wdXRlZCkgewogICAgICBkZWZpbmVDb21wdXRlZChDb21wLnByb3RvdHlwZSwga2V5LCBjb21wdXRlZFtrZXldKTsKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBpbml0QXNzZXRSZWdpc3RlcnMgKFZ1ZSkgewogICAgLyoqCiAgICAgKiBDcmVhdGUgYXNzZXQgcmVnaXN0cmF0aW9uIG1ldGhvZHMuCiAgICAgKi8KICAgIEFTU0VUX1RZUEVTLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgVnVlW3R5cGVdID0gZnVuY3Rpb24gKAogICAgICAgIGlkLAogICAgICAgIGRlZmluaXRpb24KICAgICAgKSB7CiAgICAgICAgaWYgKCFkZWZpbml0aW9uKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zW3R5cGUgKyAncyddW2lkXQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICAgIGlmICh0eXBlID09PSAnY29tcG9uZW50JykgewogICAgICAgICAgICB2YWxpZGF0ZUNvbXBvbmVudE5hbWUoaWQpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGUgPT09ICdjb21wb25lbnQnICYmIGlzUGxhaW5PYmplY3QoZGVmaW5pdGlvbikpIHsKICAgICAgICAgICAgZGVmaW5pdGlvbi5uYW1lID0gZGVmaW5pdGlvbi5uYW1lIHx8IGlkOwogICAgICAgICAgICBkZWZpbml0aW9uID0gdGhpcy5vcHRpb25zLl9iYXNlLmV4dGVuZChkZWZpbml0aW9uKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlID09PSAnZGlyZWN0aXZlJyAmJiB0eXBlb2YgZGVmaW5pdGlvbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBkZWZpbml0aW9uID0geyBiaW5kOiBkZWZpbml0aW9uLCB1cGRhdGU6IGRlZmluaXRpb24gfTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMub3B0aW9uc1t0eXBlICsgJ3MnXVtpZF0gPSBkZWZpbml0aW9uOwogICAgICAgICAgcmV0dXJuIGRlZmluaXRpb24KICAgICAgICB9CiAgICAgIH07CiAgICB9KTsKICB9CgogIC8qICAqLwoKCgogIGZ1bmN0aW9uIGdldENvbXBvbmVudE5hbWUgKG9wdHMpIHsKICAgIHJldHVybiBvcHRzICYmIChvcHRzLkN0b3Iub3B0aW9ucy5uYW1lIHx8IG9wdHMudGFnKQogIH0KCiAgZnVuY3Rpb24gbWF0Y2hlcyAocGF0dGVybiwgbmFtZSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkocGF0dGVybikpIHsKICAgICAgcmV0dXJuIHBhdHRlcm4uaW5kZXhPZihuYW1lKSA+IC0xCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXR0ZXJuID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gcGF0dGVybi5zcGxpdCgnLCcpLmluZGV4T2YobmFtZSkgPiAtMQogICAgfSBlbHNlIGlmIChpc1JlZ0V4cChwYXR0ZXJuKSkgewogICAgICByZXR1cm4gcGF0dGVybi50ZXN0KG5hbWUpCiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgcmV0dXJuIGZhbHNlCiAgfQoKICBmdW5jdGlvbiBwcnVuZUNhY2hlIChrZWVwQWxpdmVJbnN0YW5jZSwgZmlsdGVyKSB7CiAgICB2YXIgY2FjaGUgPSBrZWVwQWxpdmVJbnN0YW5jZS5jYWNoZTsKICAgIHZhciBrZXlzID0ga2VlcEFsaXZlSW5zdGFuY2Uua2V5czsKICAgIHZhciBfdm5vZGUgPSBrZWVwQWxpdmVJbnN0YW5jZS5fdm5vZGU7CiAgICBmb3IgKHZhciBrZXkgaW4gY2FjaGUpIHsKICAgICAgdmFyIGNhY2hlZE5vZGUgPSBjYWNoZVtrZXldOwogICAgICBpZiAoY2FjaGVkTm9kZSkgewogICAgICAgIHZhciBuYW1lID0gZ2V0Q29tcG9uZW50TmFtZShjYWNoZWROb2RlLmNvbXBvbmVudE9wdGlvbnMpOwogICAgICAgIGlmIChuYW1lICYmICFmaWx0ZXIobmFtZSkpIHsKICAgICAgICAgIHBydW5lQ2FjaGVFbnRyeShjYWNoZSwga2V5LCBrZXlzLCBfdm5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJ1bmVDYWNoZUVudHJ5ICgKICAgIGNhY2hlLAogICAga2V5LAogICAga2V5cywKICAgIGN1cnJlbnQKICApIHsKICAgIHZhciBjYWNoZWQkJDEgPSBjYWNoZVtrZXldOwogICAgaWYgKGNhY2hlZCQkMSAmJiAoIWN1cnJlbnQgfHwgY2FjaGVkJCQxLnRhZyAhPT0gY3VycmVudC50YWcpKSB7CiAgICAgIGNhY2hlZCQkMS5jb21wb25lbnRJbnN0YW5jZS4kZGVzdHJveSgpOwogICAgfQogICAgY2FjaGVba2V5XSA9IG51bGw7CiAgICByZW1vdmUoa2V5cywga2V5KTsKICB9CgogIHZhciBwYXR0ZXJuVHlwZXMgPSBbU3RyaW5nLCBSZWdFeHAsIEFycmF5XTsKCiAgdmFyIEtlZXBBbGl2ZSA9IHsKICAgIG5hbWU6ICdrZWVwLWFsaXZlJywKICAgIGFic3RyYWN0OiB0cnVlLAoKICAgIHByb3BzOiB7CiAgICAgIGluY2x1ZGU6IHBhdHRlcm5UeXBlcywKICAgICAgZXhjbHVkZTogcGF0dGVyblR5cGVzLAogICAgICBtYXg6IFtTdHJpbmcsIE51bWJlcl0KICAgIH0sCgogICAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCAoKSB7CiAgICAgIHRoaXMuY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB0aGlzLmtleXMgPSBbXTsKICAgIH0sCgogICAgZGVzdHJveWVkOiBmdW5jdGlvbiBkZXN0cm95ZWQgKCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jYWNoZSkgewogICAgICAgIHBydW5lQ2FjaGVFbnRyeSh0aGlzLmNhY2hlLCBrZXksIHRoaXMua2V5cyk7CiAgICAgIH0KICAgIH0sCgogICAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCAoKSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwoKICAgICAgdGhpcy4kd2F0Y2goJ2luY2x1ZGUnLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcHJ1bmVDYWNoZSh0aGlzJDEsIGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiBtYXRjaGVzKHZhbCwgbmFtZSk7IH0pOwogICAgICB9KTsKICAgICAgdGhpcy4kd2F0Y2goJ2V4Y2x1ZGUnLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcHJ1bmVDYWNoZSh0aGlzJDEsIGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiAhbWF0Y2hlcyh2YWwsIG5hbWUpOyB9KTsKICAgICAgfSk7CiAgICB9LAoKICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyICgpIHsKICAgICAgdmFyIHNsb3QgPSB0aGlzLiRzbG90cy5kZWZhdWx0OwogICAgICB2YXIgdm5vZGUgPSBnZXRGaXJzdENvbXBvbmVudENoaWxkKHNsb3QpOwogICAgICB2YXIgY29tcG9uZW50T3B0aW9ucyA9IHZub2RlICYmIHZub2RlLmNvbXBvbmVudE9wdGlvbnM7CiAgICAgIGlmIChjb21wb25lbnRPcHRpb25zKSB7CiAgICAgICAgLy8gY2hlY2sgcGF0dGVybgogICAgICAgIHZhciBuYW1lID0gZ2V0Q29tcG9uZW50TmFtZShjb21wb25lbnRPcHRpb25zKTsKICAgICAgICB2YXIgcmVmID0gdGhpczsKICAgICAgICB2YXIgaW5jbHVkZSA9IHJlZi5pbmNsdWRlOwogICAgICAgIHZhciBleGNsdWRlID0gcmVmLmV4Y2x1ZGU7CiAgICAgICAgaWYgKAogICAgICAgICAgLy8gbm90IGluY2x1ZGVkCiAgICAgICAgICAoaW5jbHVkZSAmJiAoIW5hbWUgfHwgIW1hdGNoZXMoaW5jbHVkZSwgbmFtZSkpKSB8fAogICAgICAgICAgLy8gZXhjbHVkZWQKICAgICAgICAgIChleGNsdWRlICYmIG5hbWUgJiYgbWF0Y2hlcyhleGNsdWRlLCBuYW1lKSkKICAgICAgICApIHsKICAgICAgICAgIHJldHVybiB2bm9kZQogICAgICAgIH0KCiAgICAgICAgdmFyIHJlZiQxID0gdGhpczsKICAgICAgICB2YXIgY2FjaGUgPSByZWYkMS5jYWNoZTsKICAgICAgICB2YXIga2V5cyA9IHJlZiQxLmtleXM7CiAgICAgICAgdmFyIGtleSA9IHZub2RlLmtleSA9PSBudWxsCiAgICAgICAgICAvLyBzYW1lIGNvbnN0cnVjdG9yIG1heSBnZXQgcmVnaXN0ZXJlZCBhcyBkaWZmZXJlbnQgbG9jYWwgY29tcG9uZW50cwogICAgICAgICAgLy8gc28gY2lkIGFsb25lIGlzIG5vdCBlbm91Z2ggKCMzMjY5KQogICAgICAgICAgPyBjb21wb25lbnRPcHRpb25zLkN0b3IuY2lkICsgKGNvbXBvbmVudE9wdGlvbnMudGFnID8gKCI6OiIgKyAoY29tcG9uZW50T3B0aW9ucy50YWcpKSA6ICcnKQogICAgICAgICAgOiB2bm9kZS5rZXk7CiAgICAgICAgaWYgKGNhY2hlW2tleV0pIHsKICAgICAgICAgIHZub2RlLmNvbXBvbmVudEluc3RhbmNlID0gY2FjaGVba2V5XS5jb21wb25lbnRJbnN0YW5jZTsKICAgICAgICAgIC8vIG1ha2UgY3VycmVudCBrZXkgZnJlc2hlc3QKICAgICAgICAgIHJlbW92ZShrZXlzLCBrZXkpOwogICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNhY2hlW2tleV0gPSB2bm9kZTsKICAgICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgICAgLy8gcHJ1bmUgb2xkZXN0IGVudHJ5CiAgICAgICAgICBpZiAodGhpcy5tYXggJiYga2V5cy5sZW5ndGggPiBwYXJzZUludCh0aGlzLm1heCkpIHsKICAgICAgICAgICAgcHJ1bmVDYWNoZUVudHJ5KGNhY2hlLCBrZXlzWzBdLCBrZXlzLCB0aGlzLl92bm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2bm9kZS5kYXRhLmtlZXBBbGl2ZSA9IHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIHZub2RlIHx8IChzbG90ICYmIHNsb3RbMF0pCiAgICB9CiAgfTsKCiAgdmFyIGJ1aWx0SW5Db21wb25lbnRzID0gewogICAgS2VlcEFsaXZlOiBLZWVwQWxpdmUKICB9OwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdEdsb2JhbEFQSSAoVnVlKSB7CiAgICAvLyBjb25maWcKICAgIHZhciBjb25maWdEZWYgPSB7fTsKICAgIGNvbmZpZ0RlZi5nZXQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25maWc7IH07CiAgICB7CiAgICAgIGNvbmZpZ0RlZi5zZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdEbyBub3QgcmVwbGFjZSB0aGUgVnVlLmNvbmZpZyBvYmplY3QsIHNldCBpbmRpdmlkdWFsIGZpZWxkcyBpbnN0ZWFkLicKICAgICAgICApOwogICAgICB9OwogICAgfQogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZSwgJ2NvbmZpZycsIGNvbmZpZ0RlZik7CgogICAgLy8gZXhwb3NlZCB1dGlsIG1ldGhvZHMuCiAgICAvLyBOT1RFOiB0aGVzZSBhcmUgbm90IGNvbnNpZGVyZWQgcGFydCBvZiB0aGUgcHVibGljIEFQSSAtIGF2b2lkIHJlbHlpbmcgb24KICAgIC8vIHRoZW0gdW5sZXNzIHlvdSBhcmUgYXdhcmUgb2YgdGhlIHJpc2suCiAgICBWdWUudXRpbCA9IHsKICAgICAgd2Fybjogd2FybiwKICAgICAgZXh0ZW5kOiBleHRlbmQsCiAgICAgIG1lcmdlT3B0aW9uczogbWVyZ2VPcHRpb25zLAogICAgICBkZWZpbmVSZWFjdGl2ZTogZGVmaW5lUmVhY3RpdmUkJDEKICAgIH07CgogICAgVnVlLnNldCA9IHNldDsKICAgIFZ1ZS5kZWxldGUgPSBkZWw7CiAgICBWdWUubmV4dFRpY2sgPSBuZXh0VGljazsKCiAgICAvLyAyLjYgZXhwbGljaXQgb2JzZXJ2YWJsZSBBUEkKICAgIFZ1ZS5vYnNlcnZhYmxlID0gZnVuY3Rpb24gKG9iaikgewogICAgICBvYnNlcnZlKG9iaik7CiAgICAgIHJldHVybiBvYmoKICAgIH07CgogICAgVnVlLm9wdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgQVNTRVRfVFlQRVMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgICBWdWUub3B0aW9uc1t0eXBlICsgJ3MnXSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB9KTsKCiAgICAvLyB0aGlzIGlzIHVzZWQgdG8gaWRlbnRpZnkgdGhlICJiYXNlIiBjb25zdHJ1Y3RvciB0byBleHRlbmQgYWxsIHBsYWluLW9iamVjdAogICAgLy8gY29tcG9uZW50cyB3aXRoIGluIFdlZXgncyBtdWx0aS1pbnN0YW5jZSBzY2VuYXJpb3MuCiAgICBWdWUub3B0aW9ucy5fYmFzZSA9IFZ1ZTsKCiAgICBleHRlbmQoVnVlLm9wdGlvbnMuY29tcG9uZW50cywgYnVpbHRJbkNvbXBvbmVudHMpOwoKICAgIGluaXRVc2UoVnVlKTsKICAgIGluaXRNaXhpbiQxKFZ1ZSk7CiAgICBpbml0RXh0ZW5kKFZ1ZSk7CiAgICBpbml0QXNzZXRSZWdpc3RlcnMoVnVlKTsKICB9CgogIGluaXRHbG9iYWxBUEkoVnVlKTsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckaXNTZXJ2ZXInLCB7CiAgICBnZXQ6IGlzU2VydmVyUmVuZGVyaW5nCiAgfSk7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUucHJvdG90eXBlLCAnJHNzckNvbnRleHQnLCB7CiAgICBnZXQ6IGZ1bmN0aW9uIGdldCAoKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgIHJldHVybiB0aGlzLiR2bm9kZSAmJiB0aGlzLiR2bm9kZS5zc3JDb250ZXh0CiAgICB9CiAgfSk7CgogIC8vIGV4cG9zZSBGdW5jdGlvbmFsUmVuZGVyQ29udGV4dCBmb3Igc3NyIHJ1bnRpbWUgaGVscGVyIGluc3RhbGxhdGlvbgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUsICdGdW5jdGlvbmFsUmVuZGVyQ29udGV4dCcsIHsKICAgIHZhbHVlOiBGdW5jdGlvbmFsUmVuZGVyQ29udGV4dAogIH0pOwoKICBWdWUudmVyc2lvbiA9ICcyLjYuMTEnOwoKICAvKiAgKi8KCiAgLy8gdGhlc2UgYXJlIHJlc2VydmVkIGZvciB3ZWIgYmVjYXVzZSB0aGV5IGFyZSBkaXJlY3RseSBjb21waWxlZCBhd2F5CiAgLy8gZHVyaW5nIHRlbXBsYXRlIGNvbXBpbGF0aW9uCiAgdmFyIGlzUmVzZXJ2ZWRBdHRyID0gbWFrZU1hcCgnc3R5bGUsY2xhc3MnKTsKCiAgLy8gYXR0cmlidXRlcyB0aGF0IHNob3VsZCBiZSB1c2luZyBwcm9wcyBmb3IgYmluZGluZwogIHZhciBhY2NlcHRWYWx1ZSA9IG1ha2VNYXAoJ2lucHV0LHRleHRhcmVhLG9wdGlvbixzZWxlY3QscHJvZ3Jlc3MnKTsKICB2YXIgbXVzdFVzZVByb3AgPSBmdW5jdGlvbiAodGFnLCB0eXBlLCBhdHRyKSB7CiAgICByZXR1cm4gKAogICAgICAoYXR0ciA9PT0gJ3ZhbHVlJyAmJiBhY2NlcHRWYWx1ZSh0YWcpKSAmJiB0eXBlICE9PSAnYnV0dG9uJyB8fAogICAgICAoYXR0ciA9PT0gJ3NlbGVjdGVkJyAmJiB0YWcgPT09ICdvcHRpb24nKSB8fAogICAgICAoYXR0ciA9PT0gJ2NoZWNrZWQnICYmIHRhZyA9PT0gJ2lucHV0JykgfHwKICAgICAgKGF0dHIgPT09ICdtdXRlZCcgJiYgdGFnID09PSAndmlkZW8nKQogICAgKQogIH07CgogIHZhciBpc0VudW1lcmF0ZWRBdHRyID0gbWFrZU1hcCgnY29udGVudGVkaXRhYmxlLGRyYWdnYWJsZSxzcGVsbGNoZWNrJyk7CgogIHZhciBpc1ZhbGlkQ29udGVudEVkaXRhYmxlVmFsdWUgPSBtYWtlTWFwKCdldmVudHMsY2FyZXQsdHlwaW5nLHBsYWludGV4dC1vbmx5Jyk7CgogIHZhciBjb252ZXJ0RW51bWVyYXRlZFZhbHVlID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgIHJldHVybiBpc0ZhbHN5QXR0clZhbHVlKHZhbHVlKSB8fCB2YWx1ZSA9PT0gJ2ZhbHNlJwogICAgICA/ICdmYWxzZScKICAgICAgLy8gYWxsb3cgYXJiaXRyYXJ5IHN0cmluZyB2YWx1ZSBmb3IgY29udGVudGVkaXRhYmxlCiAgICAgIDoga2V5ID09PSAnY29udGVudGVkaXRhYmxlJyAmJiBpc1ZhbGlkQ29udGVudEVkaXRhYmxlVmFsdWUodmFsdWUpCiAgICAgICAgPyB2YWx1ZQogICAgICAgIDogJ3RydWUnCiAgfTsKCiAgdmFyIGlzQm9vbGVhbkF0dHIgPSBtYWtlTWFwKAogICAgJ2FsbG93ZnVsbHNjcmVlbixhc3luYyxhdXRvZm9jdXMsYXV0b3BsYXksY2hlY2tlZCxjb21wYWN0LGNvbnRyb2xzLGRlY2xhcmUsJyArCiAgICAnZGVmYXVsdCxkZWZhdWx0Y2hlY2tlZCxkZWZhdWx0bXV0ZWQsZGVmYXVsdHNlbGVjdGVkLGRlZmVyLGRpc2FibGVkLCcgKwogICAgJ2VuYWJsZWQsZm9ybW5vdmFsaWRhdGUsaGlkZGVuLGluZGV0ZXJtaW5hdGUsaW5lcnQsaXNtYXAsaXRlbXNjb3BlLGxvb3AsbXVsdGlwbGUsJyArCiAgICAnbXV0ZWQsbm9ocmVmLG5vcmVzaXplLG5vc2hhZGUsbm92YWxpZGF0ZSxub3dyYXAsb3BlbixwYXVzZW9uZXhpdCxyZWFkb25seSwnICsKICAgICdyZXF1aXJlZCxyZXZlcnNlZCxzY29wZWQsc2VhbWxlc3Msc2VsZWN0ZWQsc29ydGFibGUsdHJhbnNsYXRlLCcgKwogICAgJ3RydWVzcGVlZCx0eXBlbXVzdG1hdGNoLHZpc2libGUnCiAgKTsKCiAgdmFyIHhsaW5rTlMgPSAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayc7CgogIHZhciBpc1hsaW5rID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgIHJldHVybiBuYW1lLmNoYXJBdCg1KSA9PT0gJzonICYmIG5hbWUuc2xpY2UoMCwgNSkgPT09ICd4bGluaycKICB9OwoKICB2YXIgZ2V0WGxpbmtQcm9wID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgIHJldHVybiBpc1hsaW5rKG5hbWUpID8gbmFtZS5zbGljZSg2LCBuYW1lLmxlbmd0aCkgOiAnJwogIH07CgogIHZhciBpc0ZhbHN5QXR0clZhbHVlID0gZnVuY3Rpb24gKHZhbCkgewogICAgcmV0dXJuIHZhbCA9PSBudWxsIHx8IHZhbCA9PT0gZmFsc2UKICB9OwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gZ2VuQ2xhc3NGb3JWbm9kZSAodm5vZGUpIHsKICAgIHZhciBkYXRhID0gdm5vZGUuZGF0YTsKICAgIHZhciBwYXJlbnROb2RlID0gdm5vZGU7CiAgICB2YXIgY2hpbGROb2RlID0gdm5vZGU7CiAgICB3aGlsZSAoaXNEZWYoY2hpbGROb2RlLmNvbXBvbmVudEluc3RhbmNlKSkgewogICAgICBjaGlsZE5vZGUgPSBjaGlsZE5vZGUuY29tcG9uZW50SW5zdGFuY2UuX3Zub2RlOwogICAgICBpZiAoY2hpbGROb2RlICYmIGNoaWxkTm9kZS5kYXRhKSB7CiAgICAgICAgZGF0YSA9IG1lcmdlQ2xhc3NEYXRhKGNoaWxkTm9kZS5kYXRhLCBkYXRhKTsKICAgICAgfQogICAgfQogICAgd2hpbGUgKGlzRGVmKHBhcmVudE5vZGUgPSBwYXJlbnROb2RlLnBhcmVudCkpIHsKICAgICAgaWYgKHBhcmVudE5vZGUgJiYgcGFyZW50Tm9kZS5kYXRhKSB7CiAgICAgICAgZGF0YSA9IG1lcmdlQ2xhc3NEYXRhKGRhdGEsIHBhcmVudE5vZGUuZGF0YSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZW5kZXJDbGFzcyhkYXRhLnN0YXRpY0NsYXNzLCBkYXRhLmNsYXNzKQogIH0KCiAgZnVuY3Rpb24gbWVyZ2VDbGFzc0RhdGEgKGNoaWxkLCBwYXJlbnQpIHsKICAgIHJldHVybiB7CiAgICAgIHN0YXRpY0NsYXNzOiBjb25jYXQoY2hpbGQuc3RhdGljQ2xhc3MsIHBhcmVudC5zdGF0aWNDbGFzcyksCiAgICAgIGNsYXNzOiBpc0RlZihjaGlsZC5jbGFzcykKICAgICAgICA/IFtjaGlsZC5jbGFzcywgcGFyZW50LmNsYXNzXQogICAgICAgIDogcGFyZW50LmNsYXNzCiAgICB9CiAgfQoKICBmdW5jdGlvbiByZW5kZXJDbGFzcyAoCiAgICBzdGF0aWNDbGFzcywKICAgIGR5bmFtaWNDbGFzcwogICkgewogICAgaWYgKGlzRGVmKHN0YXRpY0NsYXNzKSB8fCBpc0RlZihkeW5hbWljQ2xhc3MpKSB7CiAgICAgIHJldHVybiBjb25jYXQoc3RhdGljQ2xhc3MsIHN0cmluZ2lmeUNsYXNzKGR5bmFtaWNDbGFzcykpCiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgcmV0dXJuICcnCiAgfQoKICBmdW5jdGlvbiBjb25jYXQgKGEsIGIpIHsKICAgIHJldHVybiBhID8gYiA/IChhICsgJyAnICsgYikgOiBhIDogKGIgfHwgJycpCiAgfQoKICBmdW5jdGlvbiBzdHJpbmdpZnlDbGFzcyAodmFsdWUpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gc3RyaW5naWZ5QXJyYXkodmFsdWUpCiAgICB9CiAgICBpZiAoaXNPYmplY3QodmFsdWUpKSB7CiAgICAgIHJldHVybiBzdHJpbmdpZnlPYmplY3QodmFsdWUpCiAgICB9CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gdmFsdWUKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICByZXR1cm4gJycKICB9CgogIGZ1bmN0aW9uIHN0cmluZ2lmeUFycmF5ICh2YWx1ZSkgewogICAgdmFyIHJlcyA9ICcnOwogICAgdmFyIHN0cmluZ2lmaWVkOwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2YWx1ZS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgaWYgKGlzRGVmKHN0cmluZ2lmaWVkID0gc3RyaW5naWZ5Q2xhc3ModmFsdWVbaV0pKSAmJiBzdHJpbmdpZmllZCAhPT0gJycpIHsKICAgICAgICBpZiAocmVzKSB7IHJlcyArPSAnICc7IH0KICAgICAgICByZXMgKz0gc3RyaW5naWZpZWQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIGZ1bmN0aW9uIHN0cmluZ2lmeU9iamVjdCAodmFsdWUpIHsKICAgIHZhciByZXMgPSAnJzsKICAgIGZvciAodmFyIGtleSBpbiB2YWx1ZSkgewogICAgICBpZiAodmFsdWVba2V5XSkgewogICAgICAgIGlmIChyZXMpIHsgcmVzICs9ICcgJzsgfQogICAgICAgIHJlcyArPSBrZXk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIC8qICAqLwoKICB2YXIgbmFtZXNwYWNlTWFwID0gewogICAgc3ZnOiAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLAogICAgbWF0aDogJ2h0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwnCiAgfTsKCiAgdmFyIGlzSFRNTFRhZyA9IG1ha2VNYXAoCiAgICAnaHRtbCxib2R5LGJhc2UsaGVhZCxsaW5rLG1ldGEsc3R5bGUsdGl0bGUsJyArCiAgICAnYWRkcmVzcyxhcnRpY2xlLGFzaWRlLGZvb3RlcixoZWFkZXIsaDEsaDIsaDMsaDQsaDUsaDYsaGdyb3VwLG5hdixzZWN0aW9uLCcgKwogICAgJ2RpdixkZCxkbCxkdCxmaWdjYXB0aW9uLGZpZ3VyZSxwaWN0dXJlLGhyLGltZyxsaSxtYWluLG9sLHAscHJlLHVsLCcgKwogICAgJ2EsYixhYmJyLGJkaSxiZG8sYnIsY2l0ZSxjb2RlLGRhdGEsZGZuLGVtLGksa2JkLG1hcmsscSxycCxydCxydGMscnVieSwnICsKICAgICdzLHNhbXAsc21hbGwsc3BhbixzdHJvbmcsc3ViLHN1cCx0aW1lLHUsdmFyLHdicixhcmVhLGF1ZGlvLG1hcCx0cmFjayx2aWRlbywnICsKICAgICdlbWJlZCxvYmplY3QscGFyYW0sc291cmNlLGNhbnZhcyxzY3JpcHQsbm9zY3JpcHQsZGVsLGlucywnICsKICAgICdjYXB0aW9uLGNvbCxjb2xncm91cCx0YWJsZSx0aGVhZCx0Ym9keSx0ZCx0aCx0ciwnICsKICAgICdidXR0b24sZGF0YWxpc3QsZmllbGRzZXQsZm9ybSxpbnB1dCxsYWJlbCxsZWdlbmQsbWV0ZXIsb3B0Z3JvdXAsb3B0aW9uLCcgKwogICAgJ291dHB1dCxwcm9ncmVzcyxzZWxlY3QsdGV4dGFyZWEsJyArCiAgICAnZGV0YWlscyxkaWFsb2csbWVudSxtZW51aXRlbSxzdW1tYXJ5LCcgKwogICAgJ2NvbnRlbnQsZWxlbWVudCxzaGFkb3csdGVtcGxhdGUsYmxvY2txdW90ZSxpZnJhbWUsdGZvb3QnCiAgKTsKCiAgLy8gdGhpcyBtYXAgaXMgaW50ZW50aW9uYWxseSBzZWxlY3RpdmUsIG9ubHkgY292ZXJpbmcgU1ZHIGVsZW1lbnRzIHRoYXQgbWF5CiAgLy8gY29udGFpbiBjaGlsZCBlbGVtZW50cy4KICB2YXIgaXNTVkcgPSBtYWtlTWFwKAogICAgJ3N2ZyxhbmltYXRlLGNpcmNsZSxjbGlwcGF0aCxjdXJzb3IsZGVmcyxkZXNjLGVsbGlwc2UsZmlsdGVyLGZvbnQtZmFjZSwnICsKICAgICdmb3JlaWduT2JqZWN0LGcsZ2x5cGgsaW1hZ2UsbGluZSxtYXJrZXIsbWFzayxtaXNzaW5nLWdseXBoLHBhdGgscGF0dGVybiwnICsKICAgICdwb2x5Z29uLHBvbHlsaW5lLHJlY3Qsc3dpdGNoLHN5bWJvbCx0ZXh0LHRleHRwYXRoLHRzcGFuLHVzZSx2aWV3JywKICAgIHRydWUKICApOwoKICB2YXIgaXNQcmVUYWcgPSBmdW5jdGlvbiAodGFnKSB7IHJldHVybiB0YWcgPT09ICdwcmUnOyB9OwoKICB2YXIgaXNSZXNlcnZlZFRhZyA9IGZ1bmN0aW9uICh0YWcpIHsKICAgIHJldHVybiBpc0hUTUxUYWcodGFnKSB8fCBpc1NWRyh0YWcpCiAgfTsKCiAgZnVuY3Rpb24gZ2V0VGFnTmFtZXNwYWNlICh0YWcpIHsKICAgIGlmIChpc1NWRyh0YWcpKSB7CiAgICAgIHJldHVybiAnc3ZnJwogICAgfQogICAgLy8gYmFzaWMgc3VwcG9ydCBmb3IgTWF0aE1MCiAgICAvLyBub3RlIGl0IGRvZXNuJ3Qgc3VwcG9ydCBvdGhlciBNYXRoTUwgZWxlbWVudHMgYmVpbmcgY29tcG9uZW50IHJvb3RzCiAgICBpZiAodGFnID09PSAnbWF0aCcpIHsKICAgICAgcmV0dXJuICdtYXRoJwogICAgfQogIH0KCiAgdmFyIHVua25vd25FbGVtZW50Q2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGZ1bmN0aW9uIGlzVW5rbm93bkVsZW1lbnQgKHRhZykgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoIWluQnJvd3NlcikgewogICAgICByZXR1cm4gdHJ1ZQogICAgfQogICAgaWYgKGlzUmVzZXJ2ZWRUYWcodGFnKSkgewogICAgICByZXR1cm4gZmFsc2UKICAgIH0KICAgIHRhZyA9IHRhZy50b0xvd2VyQ2FzZSgpOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAodW5rbm93bkVsZW1lbnRDYWNoZVt0YWddICE9IG51bGwpIHsKICAgICAgcmV0dXJuIHVua25vd25FbGVtZW50Q2FjaGVbdGFnXQogICAgfQogICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwogICAgaWYgKHRhZy5pbmRleE9mKCctJykgPiAtMSkgewogICAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8yODIxMDM2NC8xMDcwMjQ0CiAgICAgIHJldHVybiAodW5rbm93bkVsZW1lbnRDYWNoZVt0YWddID0gKAogICAgICAgIGVsLmNvbnN0cnVjdG9yID09PSB3aW5kb3cuSFRNTFVua25vd25FbGVtZW50IHx8CiAgICAgICAgZWwuY29uc3RydWN0b3IgPT09IHdpbmRvdy5IVE1MRWxlbWVudAogICAgICApKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICh1bmtub3duRWxlbWVudENhY2hlW3RhZ10gPSAvSFRNTFVua25vd25FbGVtZW50Ly50ZXN0KGVsLnRvU3RyaW5nKCkpKQogICAgfQogIH0KCiAgdmFyIGlzVGV4dElucHV0VHlwZSA9IG1ha2VNYXAoJ3RleHQsbnVtYmVyLHBhc3N3b3JkLHNlYXJjaCxlbWFpbCx0ZWwsdXJsJyk7CgogIC8qICAqLwoKICAvKioKICAgKiBRdWVyeSBhbiBlbGVtZW50IHNlbGVjdG9yIGlmIGl0J3Mgbm90IGFuIGVsZW1lbnQgYWxyZWFkeS4KICAgKi8KICBmdW5jdGlvbiBxdWVyeSAoZWwpIHsKICAgIGlmICh0eXBlb2YgZWwgPT09ICdzdHJpbmcnKSB7CiAgICAgIHZhciBzZWxlY3RlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpOwogICAgICBpZiAoIXNlbGVjdGVkKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdDYW5ub3QgZmluZCBlbGVtZW50OiAnICsgZWwKICAgICAgICApOwogICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQogICAgICB9CiAgICAgIHJldHVybiBzZWxlY3RlZAogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGVsCiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCQxICh0YWdOYW1lLCB2bm9kZSkgewogICAgdmFyIGVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7CiAgICBpZiAodGFnTmFtZSAhPT0gJ3NlbGVjdCcpIHsKICAgICAgcmV0dXJuIGVsbQogICAgfQogICAgLy8gZmFsc2Ugb3IgbnVsbCB3aWxsIHJlbW92ZSB0aGUgYXR0cmlidXRlIGJ1dCB1bmRlZmluZWQgd2lsbCBub3QKICAgIGlmICh2bm9kZS5kYXRhICYmIHZub2RlLmRhdGEuYXR0cnMgJiYgdm5vZGUuZGF0YS5hdHRycy5tdWx0aXBsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGVsbS5zZXRBdHRyaWJ1dGUoJ211bHRpcGxlJywgJ211bHRpcGxlJyk7CiAgICB9CiAgICByZXR1cm4gZWxtCiAgfQoKICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50TlMgKG5hbWVzcGFjZSwgdGFnTmFtZSkgewogICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VNYXBbbmFtZXNwYWNlXSwgdGFnTmFtZSkKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZVRleHROb2RlICh0ZXh0KSB7CiAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbW1lbnQgKHRleHQpIHsKICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVDb21tZW50KHRleHQpCiAgfQoKICBmdW5jdGlvbiBpbnNlcnRCZWZvcmUgKHBhcmVudE5vZGUsIG5ld05vZGUsIHJlZmVyZW5jZU5vZGUpIHsKICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5ld05vZGUsIHJlZmVyZW5jZU5vZGUpOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlQ2hpbGQgKG5vZGUsIGNoaWxkKSB7CiAgICBub2RlLnJlbW92ZUNoaWxkKGNoaWxkKTsKICB9CgogIGZ1bmN0aW9uIGFwcGVuZENoaWxkIChub2RlLCBjaGlsZCkgewogICAgbm9kZS5hcHBlbmRDaGlsZChjaGlsZCk7CiAgfQoKICBmdW5jdGlvbiBwYXJlbnROb2RlIChub2RlKSB7CiAgICByZXR1cm4gbm9kZS5wYXJlbnROb2RlCiAgfQoKICBmdW5jdGlvbiBuZXh0U2libGluZyAobm9kZSkgewogICAgcmV0dXJuIG5vZGUubmV4dFNpYmxpbmcKICB9CgogIGZ1bmN0aW9uIHRhZ05hbWUgKG5vZGUpIHsKICAgIHJldHVybiBub2RlLnRhZ05hbWUKICB9CgogIGZ1bmN0aW9uIHNldFRleHRDb250ZW50IChub2RlLCB0ZXh0KSB7CiAgICBub2RlLnRleHRDb250ZW50ID0gdGV4dDsKICB9CgogIGZ1bmN0aW9uIHNldFN0eWxlU2NvcGUgKG5vZGUsIHNjb3BlSWQpIHsKICAgIG5vZGUuc2V0QXR0cmlidXRlKHNjb3BlSWQsICcnKTsKICB9CgogIHZhciBub2RlT3BzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgY3JlYXRlRWxlbWVudDogY3JlYXRlRWxlbWVudCQxLAogICAgY3JlYXRlRWxlbWVudE5TOiBjcmVhdGVFbGVtZW50TlMsCiAgICBjcmVhdGVUZXh0Tm9kZTogY3JlYXRlVGV4dE5vZGUsCiAgICBjcmVhdGVDb21tZW50OiBjcmVhdGVDb21tZW50LAogICAgaW5zZXJ0QmVmb3JlOiBpbnNlcnRCZWZvcmUsCiAgICByZW1vdmVDaGlsZDogcmVtb3ZlQ2hpbGQsCiAgICBhcHBlbmRDaGlsZDogYXBwZW5kQ2hpbGQsCiAgICBwYXJlbnROb2RlOiBwYXJlbnROb2RlLAogICAgbmV4dFNpYmxpbmc6IG5leHRTaWJsaW5nLAogICAgdGFnTmFtZTogdGFnTmFtZSwKICAgIHNldFRleHRDb250ZW50OiBzZXRUZXh0Q29udGVudCwKICAgIHNldFN0eWxlU2NvcGU6IHNldFN0eWxlU2NvcGUKICB9KTsKCiAgLyogICovCgogIHZhciByZWYgPSB7CiAgICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSAoXywgdm5vZGUpIHsKICAgICAgcmVnaXN0ZXJSZWYodm5vZGUpOwogICAgfSwKICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgaWYgKG9sZFZub2RlLmRhdGEucmVmICE9PSB2bm9kZS5kYXRhLnJlZikgewogICAgICAgIHJlZ2lzdGVyUmVmKG9sZFZub2RlLCB0cnVlKTsKICAgICAgICByZWdpc3RlclJlZih2bm9kZSk7CiAgICAgIH0KICAgIH0sCiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95ICh2bm9kZSkgewogICAgICByZWdpc3RlclJlZih2bm9kZSwgdHJ1ZSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gcmVnaXN0ZXJSZWYgKHZub2RlLCBpc1JlbW92YWwpIHsKICAgIHZhciBrZXkgPSB2bm9kZS5kYXRhLnJlZjsKICAgIGlmICghaXNEZWYoa2V5KSkgeyByZXR1cm4gfQoKICAgIHZhciB2bSA9IHZub2RlLmNvbnRleHQ7CiAgICB2YXIgcmVmID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2UgfHwgdm5vZGUuZWxtOwogICAgdmFyIHJlZnMgPSB2bS4kcmVmczsKICAgIGlmIChpc1JlbW92YWwpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVmc1trZXldKSkgewogICAgICAgIHJlbW92ZShyZWZzW2tleV0sIHJlZik7CiAgICAgIH0gZWxzZSBpZiAocmVmc1trZXldID09PSByZWYpIHsKICAgICAgICByZWZzW2tleV0gPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmICh2bm9kZS5kYXRhLnJlZkluRm9yKSB7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJlZnNba2V5XSkpIHsKICAgICAgICAgIHJlZnNba2V5XSA9IFtyZWZdOwogICAgICAgIH0gZWxzZSBpZiAocmVmc1trZXldLmluZGV4T2YocmVmKSA8IDApIHsKICAgICAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICAgICAgcmVmc1trZXldLnB1c2gocmVmKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVmc1trZXldID0gcmVmOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBWaXJ0dWFsIERPTSBwYXRjaGluZyBhbGdvcml0aG0gYmFzZWQgb24gU25hYmJkb20gYnkKICAgKiBTaW1vbiBGcmlpcyBWaW5kdW0gKEBwYWxkZXBpbmQpCiAgICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlCiAgICogaHR0cHM6Ly9naXRodWIuY29tL3BhbGRlcGluZC9zbmFiYmRvbS9ibG9iL21hc3Rlci9MSUNFTlNFCiAgICoKICAgKiBtb2RpZmllZCBieSBFdmFuIFlvdSAoQHl5eDk5MDgwMykKICAgKgogICAqIE5vdCB0eXBlLWNoZWNraW5nIHRoaXMgYmVjYXVzZSB0aGlzIGZpbGUgaXMgcGVyZi1jcml0aWNhbCBhbmQgdGhlIGNvc3QKICAgKiBvZiBtYWtpbmcgZmxvdyB1bmRlcnN0YW5kIGl0IGlzIG5vdCB3b3J0aCBpdC4KICAgKi8KCiAgdmFyIGVtcHR5Tm9kZSA9IG5ldyBWTm9kZSgnJywge30sIFtdKTsKCiAgdmFyIGhvb2tzID0gWydjcmVhdGUnLCAnYWN0aXZhdGUnLCAndXBkYXRlJywgJ3JlbW92ZScsICdkZXN0cm95J107CgogIGZ1bmN0aW9uIHNhbWVWbm9kZSAoYSwgYikgewogICAgcmV0dXJuICgKICAgICAgYS5rZXkgPT09IGIua2V5ICYmICgKICAgICAgICAoCiAgICAgICAgICBhLnRhZyA9PT0gYi50YWcgJiYKICAgICAgICAgIGEuaXNDb21tZW50ID09PSBiLmlzQ29tbWVudCAmJgogICAgICAgICAgaXNEZWYoYS5kYXRhKSA9PT0gaXNEZWYoYi5kYXRhKSAmJgogICAgICAgICAgc2FtZUlucHV0VHlwZShhLCBiKQogICAgICAgICkgfHwgKAogICAgICAgICAgaXNUcnVlKGEuaXNBc3luY1BsYWNlaG9sZGVyKSAmJgogICAgICAgICAgYS5hc3luY0ZhY3RvcnkgPT09IGIuYXN5bmNGYWN0b3J5ICYmCiAgICAgICAgICBpc1VuZGVmKGIuYXN5bmNGYWN0b3J5LmVycm9yKQogICAgICAgICkKICAgICAgKQogICAgKQogIH0KCiAgZnVuY3Rpb24gc2FtZUlucHV0VHlwZSAoYSwgYikgewogICAgaWYgKGEudGFnICE9PSAnaW5wdXQnKSB7IHJldHVybiB0cnVlIH0KICAgIHZhciBpOwogICAgdmFyIHR5cGVBID0gaXNEZWYoaSA9IGEuZGF0YSkgJiYgaXNEZWYoaSA9IGkuYXR0cnMpICYmIGkudHlwZTsKICAgIHZhciB0eXBlQiA9IGlzRGVmKGkgPSBiLmRhdGEpICYmIGlzRGVmKGkgPSBpLmF0dHJzKSAmJiBpLnR5cGU7CiAgICByZXR1cm4gdHlwZUEgPT09IHR5cGVCIHx8IGlzVGV4dElucHV0VHlwZSh0eXBlQSkgJiYgaXNUZXh0SW5wdXRUeXBlKHR5cGVCKQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlS2V5VG9PbGRJZHggKGNoaWxkcmVuLCBiZWdpbklkeCwgZW5kSWR4KSB7CiAgICB2YXIgaSwga2V5OwogICAgdmFyIG1hcCA9IHt9OwogICAgZm9yIChpID0gYmVnaW5JZHg7IGkgPD0gZW5kSWR4OyArK2kpIHsKICAgICAga2V5ID0gY2hpbGRyZW5baV0ua2V5OwogICAgICBpZiAoaXNEZWYoa2V5KSkgeyBtYXBba2V5XSA9IGk7IH0KICAgIH0KICAgIHJldHVybiBtYXAKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZVBhdGNoRnVuY3Rpb24gKGJhY2tlbmQpIHsKICAgIHZhciBpLCBqOwogICAgdmFyIGNicyA9IHt9OwoKICAgIHZhciBtb2R1bGVzID0gYmFja2VuZC5tb2R1bGVzOwogICAgdmFyIG5vZGVPcHMgPSBiYWNrZW5kLm5vZGVPcHM7CgogICAgZm9yIChpID0gMDsgaSA8IGhvb2tzLmxlbmd0aDsgKytpKSB7CiAgICAgIGNic1tob29rc1tpXV0gPSBbXTsKICAgICAgZm9yIChqID0gMDsgaiA8IG1vZHVsZXMubGVuZ3RoOyArK2opIHsKICAgICAgICBpZiAoaXNEZWYobW9kdWxlc1tqXVtob29rc1tpXV0pKSB7CiAgICAgICAgICBjYnNbaG9va3NbaV1dLnB1c2gobW9kdWxlc1tqXVtob29rc1tpXV0pOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGVtcHR5Tm9kZUF0IChlbG0pIHsKICAgICAgcmV0dXJuIG5ldyBWTm9kZShub2RlT3BzLnRhZ05hbWUoZWxtKS50b0xvd2VyQ2FzZSgpLCB7fSwgW10sIHVuZGVmaW5lZCwgZWxtKQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVJtQ2IgKGNoaWxkRWxtLCBsaXN0ZW5lcnMpIHsKICAgICAgZnVuY3Rpb24gcmVtb3ZlJCQxICgpIHsKICAgICAgICBpZiAoLS1yZW1vdmUkJDEubGlzdGVuZXJzID09PSAwKSB7CiAgICAgICAgICByZW1vdmVOb2RlKGNoaWxkRWxtKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmVtb3ZlJCQxLmxpc3RlbmVycyA9IGxpc3RlbmVyczsKICAgICAgcmV0dXJuIHJlbW92ZSQkMQogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU5vZGUgKGVsKSB7CiAgICAgIHZhciBwYXJlbnQgPSBub2RlT3BzLnBhcmVudE5vZGUoZWwpOwogICAgICAvLyBlbGVtZW50IG1heSBoYXZlIGFscmVhZHkgYmVlbiByZW1vdmVkIGR1ZSB0byB2LWh0bWwgLyB2LXRleHQKICAgICAgaWYgKGlzRGVmKHBhcmVudCkpIHsKICAgICAgICBub2RlT3BzLnJlbW92ZUNoaWxkKHBhcmVudCwgZWwpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaXNVbmtub3duRWxlbWVudCQkMSAodm5vZGUsIGluVlByZSkgewogICAgICByZXR1cm4gKAogICAgICAgICFpblZQcmUgJiYKICAgICAgICAhdm5vZGUubnMgJiYKICAgICAgICAhKAogICAgICAgICAgY29uZmlnLmlnbm9yZWRFbGVtZW50cy5sZW5ndGggJiYKICAgICAgICAgIGNvbmZpZy5pZ25vcmVkRWxlbWVudHMuc29tZShmdW5jdGlvbiAoaWdub3JlKSB7CiAgICAgICAgICAgIHJldHVybiBpc1JlZ0V4cChpZ25vcmUpCiAgICAgICAgICAgICAgPyBpZ25vcmUudGVzdCh2bm9kZS50YWcpCiAgICAgICAgICAgICAgOiBpZ25vcmUgPT09IHZub2RlLnRhZwogICAgICAgICAgfSkKICAgICAgICApICYmCiAgICAgICAgY29uZmlnLmlzVW5rbm93bkVsZW1lbnQodm5vZGUudGFnKQogICAgICApCiAgICB9CgogICAgdmFyIGNyZWF0aW5nRWxtSW5WUHJlID0gMDsKCiAgICBmdW5jdGlvbiBjcmVhdGVFbG0gKAogICAgICB2bm9kZSwKICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLAogICAgICBwYXJlbnRFbG0sCiAgICAgIHJlZkVsbSwKICAgICAgbmVzdGVkLAogICAgICBvd25lckFycmF5LAogICAgICBpbmRleAogICAgKSB7CiAgICAgIGlmIChpc0RlZih2bm9kZS5lbG0pICYmIGlzRGVmKG93bmVyQXJyYXkpKSB7CiAgICAgICAgLy8gVGhpcyB2bm9kZSB3YXMgdXNlZCBpbiBhIHByZXZpb3VzIHJlbmRlciEKICAgICAgICAvLyBub3cgaXQncyB1c2VkIGFzIGEgbmV3IG5vZGUsIG92ZXJ3cml0aW5nIGl0cyBlbG0gd291bGQgY2F1c2UKICAgICAgICAvLyBwb3RlbnRpYWwgcGF0Y2ggZXJyb3JzIGRvd24gdGhlIHJvYWQgd2hlbiBpdCdzIHVzZWQgYXMgYW4gaW5zZXJ0aW9uCiAgICAgICAgLy8gcmVmZXJlbmNlIG5vZGUuIEluc3RlYWQsIHdlIGNsb25lIHRoZSBub2RlIG9uLWRlbWFuZCBiZWZvcmUgY3JlYXRpbmcKICAgICAgICAvLyBhc3NvY2lhdGVkIERPTSBlbGVtZW50IGZvciBpdC4KICAgICAgICB2bm9kZSA9IG93bmVyQXJyYXlbaW5kZXhdID0gY2xvbmVWTm9kZSh2bm9kZSk7CiAgICAgIH0KCiAgICAgIHZub2RlLmlzUm9vdEluc2VydCA9ICFuZXN0ZWQ7IC8vIGZvciB0cmFuc2l0aW9uIGVudGVyIGNoZWNrCiAgICAgIGlmIChjcmVhdGVDb21wb25lbnQodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCByZWZFbG0pKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gdm5vZGUuZGF0YTsKICAgICAgdmFyIGNoaWxkcmVuID0gdm5vZGUuY2hpbGRyZW47CiAgICAgIHZhciB0YWcgPSB2bm9kZS50YWc7CiAgICAgIGlmIChpc0RlZih0YWcpKSB7CiAgICAgICAgewogICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5wcmUpIHsKICAgICAgICAgICAgY3JlYXRpbmdFbG1JblZQcmUrKzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc1Vua25vd25FbGVtZW50JCQxKHZub2RlLCBjcmVhdGluZ0VsbUluVlByZSkpIHsKICAgICAgICAgICAgd2FybigKICAgICAgICAgICAgICAnVW5rbm93biBjdXN0b20gZWxlbWVudDogPCcgKyB0YWcgKyAnPiAtIGRpZCB5b3UgJyArCiAgICAgICAgICAgICAgJ3JlZ2lzdGVyIHRoZSBjb21wb25lbnQgY29ycmVjdGx5PyBGb3IgcmVjdXJzaXZlIGNvbXBvbmVudHMsICcgKwogICAgICAgICAgICAgICdtYWtlIHN1cmUgdG8gcHJvdmlkZSB0aGUgIm5hbWUiIG9wdGlvbi4nLAogICAgICAgICAgICAgIHZub2RlLmNvbnRleHQKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZub2RlLmVsbSA9IHZub2RlLm5zCiAgICAgICAgICA/IG5vZGVPcHMuY3JlYXRlRWxlbWVudE5TKHZub2RlLm5zLCB0YWcpCiAgICAgICAgICA6IG5vZGVPcHMuY3JlYXRlRWxlbWVudCh0YWcsIHZub2RlKTsKICAgICAgICBzZXRTY29wZSh2bm9kZSk7CgogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIHsKICAgICAgICAgIGNyZWF0ZUNoaWxkcmVuKHZub2RlLCBjaGlsZHJlbiwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgIGlmIChpc0RlZihkYXRhKSkgewogICAgICAgICAgICBpbnZva2VDcmVhdGVIb29rcyh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgICAgICB9CgogICAgICAgIGlmIChkYXRhICYmIGRhdGEucHJlKSB7CiAgICAgICAgICBjcmVhdGluZ0VsbUluVlByZS0tOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpc1RydWUodm5vZGUuaXNDb21tZW50KSkgewogICAgICAgIHZub2RlLmVsbSA9IG5vZGVPcHMuY3JlYXRlQ29tbWVudCh2bm9kZS50ZXh0KTsKICAgICAgICBpbnNlcnQocGFyZW50RWxtLCB2bm9kZS5lbG0sIHJlZkVsbSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm5vZGUuZWxtID0gbm9kZU9wcy5jcmVhdGVUZXh0Tm9kZSh2bm9kZS50ZXh0KTsKICAgICAgICBpbnNlcnQocGFyZW50RWxtLCB2bm9kZS5lbG0sIHJlZkVsbSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVDb21wb25lbnQgKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtKSB7CiAgICAgIHZhciBpID0gdm5vZGUuZGF0YTsKICAgICAgaWYgKGlzRGVmKGkpKSB7CiAgICAgICAgdmFyIGlzUmVhY3RpdmF0ZWQgPSBpc0RlZih2bm9kZS5jb21wb25lbnRJbnN0YW5jZSkgJiYgaS5rZWVwQWxpdmU7CiAgICAgICAgaWYgKGlzRGVmKGkgPSBpLmhvb2spICYmIGlzRGVmKGkgPSBpLmluaXQpKSB7CiAgICAgICAgICBpKHZub2RlLCBmYWxzZSAvKiBoeWRyYXRpbmcgKi8pOwogICAgICAgIH0KICAgICAgICAvLyBhZnRlciBjYWxsaW5nIHRoZSBpbml0IGhvb2ssIGlmIHRoZSB2bm9kZSBpcyBhIGNoaWxkIGNvbXBvbmVudAogICAgICAgIC8vIGl0IHNob3VsZCd2ZSBjcmVhdGVkIGEgY2hpbGQgaW5zdGFuY2UgYW5kIG1vdW50ZWQgaXQuIHRoZSBjaGlsZAogICAgICAgIC8vIGNvbXBvbmVudCBhbHNvIGhhcyBzZXQgdGhlIHBsYWNlaG9sZGVyIHZub2RlJ3MgZWxtLgogICAgICAgIC8vIGluIHRoYXQgY2FzZSB3ZSBjYW4ganVzdCByZXR1cm4gdGhlIGVsZW1lbnQgYW5kIGJlIGRvbmUuCiAgICAgICAgaWYgKGlzRGVmKHZub2RlLmNvbXBvbmVudEluc3RhbmNlKSkgewogICAgICAgICAgaW5pdENvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgICAgICAgIGlmIChpc1RydWUoaXNSZWFjdGl2YXRlZCkpIHsKICAgICAgICAgICAgcmVhY3RpdmF0ZUNvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBwYXJlbnRFbG0sIHJlZkVsbSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRDb21wb25lbnQgKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgICAgaWYgKGlzRGVmKHZub2RlLmRhdGEucGVuZGluZ0luc2VydCkpIHsKICAgICAgICBpbnNlcnRlZFZub2RlUXVldWUucHVzaC5hcHBseShpbnNlcnRlZFZub2RlUXVldWUsIHZub2RlLmRhdGEucGVuZGluZ0luc2VydCk7CiAgICAgICAgdm5vZGUuZGF0YS5wZW5kaW5nSW5zZXJ0ID0gbnVsbDsKICAgICAgfQogICAgICB2bm9kZS5lbG0gPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZS4kZWw7CiAgICAgIGlmIChpc1BhdGNoYWJsZSh2bm9kZSkpIHsKICAgICAgICBpbnZva2VDcmVhdGVIb29rcyh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICBzZXRTY29wZSh2bm9kZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZW1wdHkgY29tcG9uZW50IHJvb3QuCiAgICAgICAgLy8gc2tpcCBhbGwgZWxlbWVudC1yZWxhdGVkIG1vZHVsZXMgZXhjZXB0IGZvciByZWYgKCMzNDU1KQogICAgICAgIHJlZ2lzdGVyUmVmKHZub2RlKTsKICAgICAgICAvLyBtYWtlIHN1cmUgdG8gaW52b2tlIHRoZSBpbnNlcnQgaG9vawogICAgICAgIGluc2VydGVkVm5vZGVRdWV1ZS5wdXNoKHZub2RlKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJlYWN0aXZhdGVDb21wb25lbnQgKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtKSB7CiAgICAgIHZhciBpOwogICAgICAvLyBoYWNrIGZvciAjNDMzOTogYSByZWFjdGl2YXRlZCBjb21wb25lbnQgd2l0aCBpbm5lciB0cmFuc2l0aW9uCiAgICAgIC8vIGRvZXMgbm90IHRyaWdnZXIgYmVjYXVzZSB0aGUgaW5uZXIgbm9kZSdzIGNyZWF0ZWQgaG9va3MgYXJlIG5vdCBjYWxsZWQKICAgICAgLy8gYWdhaW4uIEl0J3Mgbm90IGlkZWFsIHRvIGludm9sdmUgbW9kdWxlLXNwZWNpZmljIGxvZ2ljIGluIGhlcmUgYnV0CiAgICAgIC8vIHRoZXJlIGRvZXNuJ3Qgc2VlbSB0byBiZSBhIGJldHRlciB3YXkgdG8gZG8gaXQuCiAgICAgIHZhciBpbm5lck5vZGUgPSB2bm9kZTsKICAgICAgd2hpbGUgKGlubmVyTm9kZS5jb21wb25lbnRJbnN0YW5jZSkgewogICAgICAgIGlubmVyTm9kZSA9IGlubmVyTm9kZS5jb21wb25lbnRJbnN0YW5jZS5fdm5vZGU7CiAgICAgICAgaWYgKGlzRGVmKGkgPSBpbm5lck5vZGUuZGF0YSkgJiYgaXNEZWYoaSA9IGkudHJhbnNpdGlvbikpIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjYnMuYWN0aXZhdGUubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgY2JzLmFjdGl2YXRlW2ldKGVtcHR5Tm9kZSwgaW5uZXJOb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGluc2VydGVkVm5vZGVRdWV1ZS5wdXNoKGlubmVyTm9kZSk7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgfQogICAgICAvLyB1bmxpa2UgYSBuZXdseSBjcmVhdGVkIGNvbXBvbmVudCwKICAgICAgLy8gYSByZWFjdGl2YXRlZCBrZWVwLWFsaXZlIGNvbXBvbmVudCBkb2Vzbid0IGluc2VydCBpdHNlbGYKICAgICAgaW5zZXJ0KHBhcmVudEVsbSwgdm5vZGUuZWxtLCByZWZFbG0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGluc2VydCAocGFyZW50LCBlbG0sIHJlZiQkMSkgewogICAgICBpZiAoaXNEZWYocGFyZW50KSkgewogICAgICAgIGlmIChpc0RlZihyZWYkJDEpKSB7CiAgICAgICAgICBpZiAobm9kZU9wcy5wYXJlbnROb2RlKHJlZiQkMSkgPT09IHBhcmVudCkgewogICAgICAgICAgICBub2RlT3BzLmluc2VydEJlZm9yZShwYXJlbnQsIGVsbSwgcmVmJCQxKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbm9kZU9wcy5hcHBlbmRDaGlsZChwYXJlbnQsIGVsbSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQ2hpbGRyZW4gKHZub2RlLCBjaGlsZHJlbiwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkcmVuKSkgewogICAgICAgIHsKICAgICAgICAgIGNoZWNrRHVwbGljYXRlS2V5cyhjaGlsZHJlbik7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGNyZWF0ZUVsbShjaGlsZHJlbltpXSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCB2bm9kZS5lbG0sIG51bGwsIHRydWUsIGNoaWxkcmVuLCBpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoaXNQcmltaXRpdmUodm5vZGUudGV4dCkpIHsKICAgICAgICBub2RlT3BzLmFwcGVuZENoaWxkKHZub2RlLmVsbSwgbm9kZU9wcy5jcmVhdGVUZXh0Tm9kZShTdHJpbmcodm5vZGUudGV4dCkpKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGlzUGF0Y2hhYmxlICh2bm9kZSkgewogICAgICB3aGlsZSAodm5vZGUuY29tcG9uZW50SW5zdGFuY2UpIHsKICAgICAgICB2bm9kZSA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlLl92bm9kZTsKICAgICAgfQogICAgICByZXR1cm4gaXNEZWYodm5vZGUudGFnKQogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZUNyZWF0ZUhvb2tzICh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSB7CiAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGNicy5jcmVhdGUubGVuZ3RoOyArK2kkMSkgewogICAgICAgIGNicy5jcmVhdGVbaSQxXShlbXB0eU5vZGUsIHZub2RlKTsKICAgICAgfQogICAgICBpID0gdm5vZGUuZGF0YS5ob29rOyAvLyBSZXVzZSB2YXJpYWJsZQogICAgICBpZiAoaXNEZWYoaSkpIHsKICAgICAgICBpZiAoaXNEZWYoaS5jcmVhdGUpKSB7IGkuY3JlYXRlKGVtcHR5Tm9kZSwgdm5vZGUpOyB9CiAgICAgICAgaWYgKGlzRGVmKGkuaW5zZXJ0KSkgeyBpbnNlcnRlZFZub2RlUXVldWUucHVzaCh2bm9kZSk7IH0KICAgICAgfQogICAgfQoKICAgIC8vIHNldCBzY29wZSBpZCBhdHRyaWJ1dGUgZm9yIHNjb3BlZCBDU1MuCiAgICAvLyB0aGlzIGlzIGltcGxlbWVudGVkIGFzIGEgc3BlY2lhbCBjYXNlIHRvIGF2b2lkIHRoZSBvdmVyaGVhZAogICAgLy8gb2YgZ29pbmcgdGhyb3VnaCB0aGUgbm9ybWFsIGF0dHJpYnV0ZSBwYXRjaGluZyBwcm9jZXNzLgogICAgZnVuY3Rpb24gc2V0U2NvcGUgKHZub2RlKSB7CiAgICAgIHZhciBpOwogICAgICBpZiAoaXNEZWYoaSA9IHZub2RlLmZuU2NvcGVJZCkpIHsKICAgICAgICBub2RlT3BzLnNldFN0eWxlU2NvcGUodm5vZGUuZWxtLCBpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgYW5jZXN0b3IgPSB2bm9kZTsKICAgICAgICB3aGlsZSAoYW5jZXN0b3IpIHsKICAgICAgICAgIGlmIChpc0RlZihpID0gYW5jZXN0b3IuY29udGV4dCkgJiYgaXNEZWYoaSA9IGkuJG9wdGlvbnMuX3Njb3BlSWQpKSB7CiAgICAgICAgICAgIG5vZGVPcHMuc2V0U3R5bGVTY29wZSh2bm9kZS5lbG0sIGkpOwogICAgICAgICAgfQogICAgICAgICAgYW5jZXN0b3IgPSBhbmNlc3Rvci5wYXJlbnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIGZvciBzbG90IGNvbnRlbnQgdGhleSBzaG91bGQgYWxzbyBnZXQgdGhlIHNjb3BlSWQgZnJvbSB0aGUgaG9zdCBpbnN0YW5jZS4KICAgICAgaWYgKGlzRGVmKGkgPSBhY3RpdmVJbnN0YW5jZSkgJiYKICAgICAgICBpICE9PSB2bm9kZS5jb250ZXh0ICYmCiAgICAgICAgaSAhPT0gdm5vZGUuZm5Db250ZXh0ICYmCiAgICAgICAgaXNEZWYoaSA9IGkuJG9wdGlvbnMuX3Njb3BlSWQpCiAgICAgICkgewogICAgICAgIG5vZGVPcHMuc2V0U3R5bGVTY29wZSh2bm9kZS5lbG0sIGkpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYWRkVm5vZGVzIChwYXJlbnRFbG0sIHJlZkVsbSwgdm5vZGVzLCBzdGFydElkeCwgZW5kSWR4LCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgICAgZm9yICg7IHN0YXJ0SWR4IDw9IGVuZElkeDsgKytzdGFydElkeCkgewogICAgICAgIGNyZWF0ZUVsbSh2bm9kZXNbc3RhcnRJZHhdLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtLCBmYWxzZSwgdm5vZGVzLCBzdGFydElkeCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2VEZXN0cm95SG9vayAodm5vZGUpIHsKICAgICAgdmFyIGksIGo7CiAgICAgIHZhciBkYXRhID0gdm5vZGUuZGF0YTsKICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgaWYgKGlzRGVmKGkgPSBkYXRhLmhvb2spICYmIGlzRGVmKGkgPSBpLmRlc3Ryb3kpKSB7IGkodm5vZGUpOyB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5kZXN0cm95Lmxlbmd0aDsgKytpKSB7IGNicy5kZXN0cm95W2ldKHZub2RlKTsgfQogICAgICB9CiAgICAgIGlmIChpc0RlZihpID0gdm5vZGUuY2hpbGRyZW4pKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IHZub2RlLmNoaWxkcmVuLmxlbmd0aDsgKytqKSB7CiAgICAgICAgICBpbnZva2VEZXN0cm95SG9vayh2bm9kZS5jaGlsZHJlbltqXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlVm5vZGVzICh2bm9kZXMsIHN0YXJ0SWR4LCBlbmRJZHgpIHsKICAgICAgZm9yICg7IHN0YXJ0SWR4IDw9IGVuZElkeDsgKytzdGFydElkeCkgewogICAgICAgIHZhciBjaCA9IHZub2Rlc1tzdGFydElkeF07CiAgICAgICAgaWYgKGlzRGVmKGNoKSkgewogICAgICAgICAgaWYgKGlzRGVmKGNoLnRhZykpIHsKICAgICAgICAgICAgcmVtb3ZlQW5kSW52b2tlUmVtb3ZlSG9vayhjaCk7CiAgICAgICAgICAgIGludm9rZURlc3Ryb3lIb29rKGNoKTsKICAgICAgICAgIH0gZWxzZSB7IC8vIFRleHQgbm9kZQogICAgICAgICAgICByZW1vdmVOb2RlKGNoLmVsbSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlQW5kSW52b2tlUmVtb3ZlSG9vayAodm5vZGUsIHJtKSB7CiAgICAgIGlmIChpc0RlZihybSkgfHwgaXNEZWYodm5vZGUuZGF0YSkpIHsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgbGlzdGVuZXJzID0gY2JzLnJlbW92ZS5sZW5ndGggKyAxOwogICAgICAgIGlmIChpc0RlZihybSkpIHsKICAgICAgICAgIC8vIHdlIGhhdmUgYSByZWN1cnNpdmVseSBwYXNzZWQgZG93biBybSBjYWxsYmFjawogICAgICAgICAgLy8gaW5jcmVhc2UgdGhlIGxpc3RlbmVycyBjb3VudAogICAgICAgICAgcm0ubGlzdGVuZXJzICs9IGxpc3RlbmVyczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gZGlyZWN0bHkgcmVtb3ZpbmcKICAgICAgICAgIHJtID0gY3JlYXRlUm1DYih2bm9kZS5lbG0sIGxpc3RlbmVycyk7CiAgICAgICAgfQogICAgICAgIC8vIHJlY3Vyc2l2ZWx5IGludm9rZSBob29rcyBvbiBjaGlsZCBjb21wb25lbnQgcm9vdCBub2RlCiAgICAgICAgaWYgKGlzRGVmKGkgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSkgJiYgaXNEZWYoaSA9IGkuX3Zub2RlKSAmJiBpc0RlZihpLmRhdGEpKSB7CiAgICAgICAgICByZW1vdmVBbmRJbnZva2VSZW1vdmVIb29rKGksIHJtKTsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5yZW1vdmUubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGNicy5yZW1vdmVbaV0odm5vZGUsIHJtKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzRGVmKGkgPSB2bm9kZS5kYXRhLmhvb2spICYmIGlzRGVmKGkgPSBpLnJlbW92ZSkpIHsKICAgICAgICAgIGkodm5vZGUsIHJtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcm0oKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVtb3ZlTm9kZSh2bm9kZS5lbG0pOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlQ2hpbGRyZW4gKHBhcmVudEVsbSwgb2xkQ2gsIG5ld0NoLCBpbnNlcnRlZFZub2RlUXVldWUsIHJlbW92ZU9ubHkpIHsKICAgICAgdmFyIG9sZFN0YXJ0SWR4ID0gMDsKICAgICAgdmFyIG5ld1N0YXJ0SWR4ID0gMDsKICAgICAgdmFyIG9sZEVuZElkeCA9IG9sZENoLmxlbmd0aCAtIDE7CiAgICAgIHZhciBvbGRTdGFydFZub2RlID0gb2xkQ2hbMF07CiAgICAgIHZhciBvbGRFbmRWbm9kZSA9IG9sZENoW29sZEVuZElkeF07CiAgICAgIHZhciBuZXdFbmRJZHggPSBuZXdDaC5sZW5ndGggLSAxOwogICAgICB2YXIgbmV3U3RhcnRWbm9kZSA9IG5ld0NoWzBdOwogICAgICB2YXIgbmV3RW5kVm5vZGUgPSBuZXdDaFtuZXdFbmRJZHhdOwogICAgICB2YXIgb2xkS2V5VG9JZHgsIGlkeEluT2xkLCB2bm9kZVRvTW92ZSwgcmVmRWxtOwoKICAgICAgLy8gcmVtb3ZlT25seSBpcyBhIHNwZWNpYWwgZmxhZyB1c2VkIG9ubHkgYnkgPHRyYW5zaXRpb24tZ3JvdXA+CiAgICAgIC8vIHRvIGVuc3VyZSByZW1vdmVkIGVsZW1lbnRzIHN0YXkgaW4gY29ycmVjdCByZWxhdGl2ZSBwb3NpdGlvbnMKICAgICAgLy8gZHVyaW5nIGxlYXZpbmcgdHJhbnNpdGlvbnMKICAgICAgdmFyIGNhbk1vdmUgPSAhcmVtb3ZlT25seTsKCiAgICAgIHsKICAgICAgICBjaGVja0R1cGxpY2F0ZUtleXMobmV3Q2gpOwogICAgICB9CgogICAgICB3aGlsZSAob2xkU3RhcnRJZHggPD0gb2xkRW5kSWR4ICYmIG5ld1N0YXJ0SWR4IDw9IG5ld0VuZElkeCkgewogICAgICAgIGlmIChpc1VuZGVmKG9sZFN0YXJ0Vm5vZGUpKSB7CiAgICAgICAgICBvbGRTdGFydFZub2RlID0gb2xkQ2hbKytvbGRTdGFydElkeF07IC8vIFZub2RlIGhhcyBiZWVuIG1vdmVkIGxlZnQKICAgICAgICB9IGVsc2UgaWYgKGlzVW5kZWYob2xkRW5kVm5vZGUpKSB7CiAgICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICB9IGVsc2UgaWYgKHNhbWVWbm9kZShvbGRTdGFydFZub2RlLCBuZXdTdGFydFZub2RlKSkgewogICAgICAgICAgcGF0Y2hWbm9kZShvbGRTdGFydFZub2RlLCBuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICBvbGRTdGFydFZub2RlID0gb2xkQ2hbKytvbGRTdGFydElkeF07CiAgICAgICAgICBuZXdTdGFydFZub2RlID0gbmV3Q2hbKytuZXdTdGFydElkeF07CiAgICAgICAgfSBlbHNlIGlmIChzYW1lVm5vZGUob2xkRW5kVm5vZGUsIG5ld0VuZFZub2RlKSkgewogICAgICAgICAgcGF0Y2hWbm9kZShvbGRFbmRWbm9kZSwgbmV3RW5kVm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgbmV3Q2gsIG5ld0VuZElkeCk7CiAgICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICAgIG5ld0VuZFZub2RlID0gbmV3Q2hbLS1uZXdFbmRJZHhdOwogICAgICAgIH0gZWxzZSBpZiAoc2FtZVZub2RlKG9sZFN0YXJ0Vm5vZGUsIG5ld0VuZFZub2RlKSkgeyAvLyBWbm9kZSBtb3ZlZCByaWdodAogICAgICAgICAgcGF0Y2hWbm9kZShvbGRTdGFydFZub2RlLCBuZXdFbmRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBuZXdDaCwgbmV3RW5kSWR4KTsKICAgICAgICAgIGNhbk1vdmUgJiYgbm9kZU9wcy5pbnNlcnRCZWZvcmUocGFyZW50RWxtLCBvbGRTdGFydFZub2RlLmVsbSwgbm9kZU9wcy5uZXh0U2libGluZyhvbGRFbmRWbm9kZS5lbG0pKTsKICAgICAgICAgIG9sZFN0YXJ0Vm5vZGUgPSBvbGRDaFsrK29sZFN0YXJ0SWR4XTsKICAgICAgICAgIG5ld0VuZFZub2RlID0gbmV3Q2hbLS1uZXdFbmRJZHhdOwogICAgICAgIH0gZWxzZSBpZiAoc2FtZVZub2RlKG9sZEVuZFZub2RlLCBuZXdTdGFydFZub2RlKSkgeyAvLyBWbm9kZSBtb3ZlZCBsZWZ0CiAgICAgICAgICBwYXRjaFZub2RlKG9sZEVuZFZub2RlLCBuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICBjYW5Nb3ZlICYmIG5vZGVPcHMuaW5zZXJ0QmVmb3JlKHBhcmVudEVsbSwgb2xkRW5kVm5vZGUuZWxtLCBvbGRTdGFydFZub2RlLmVsbSk7CiAgICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICAgIG5ld1N0YXJ0Vm5vZGUgPSBuZXdDaFsrK25ld1N0YXJ0SWR4XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGlzVW5kZWYob2xkS2V5VG9JZHgpKSB7IG9sZEtleVRvSWR4ID0gY3JlYXRlS2V5VG9PbGRJZHgob2xkQ2gsIG9sZFN0YXJ0SWR4LCBvbGRFbmRJZHgpOyB9CiAgICAgICAgICBpZHhJbk9sZCA9IGlzRGVmKG5ld1N0YXJ0Vm5vZGUua2V5KQogICAgICAgICAgICA/IG9sZEtleVRvSWR4W25ld1N0YXJ0Vm5vZGUua2V5XQogICAgICAgICAgICA6IGZpbmRJZHhJbk9sZChuZXdTdGFydFZub2RlLCBvbGRDaCwgb2xkU3RhcnRJZHgsIG9sZEVuZElkeCk7CiAgICAgICAgICBpZiAoaXNVbmRlZihpZHhJbk9sZCkpIHsgLy8gTmV3IGVsZW1lbnQKICAgICAgICAgICAgY3JlYXRlRWxtKG5ld1N0YXJ0Vm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCBvbGRTdGFydFZub2RlLmVsbSwgZmFsc2UsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2bm9kZVRvTW92ZSA9IG9sZENoW2lkeEluT2xkXTsKICAgICAgICAgICAgaWYgKHNhbWVWbm9kZSh2bm9kZVRvTW92ZSwgbmV3U3RhcnRWbm9kZSkpIHsKICAgICAgICAgICAgICBwYXRjaFZub2RlKHZub2RlVG9Nb3ZlLCBuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICAgICAgb2xkQ2hbaWR4SW5PbGRdID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgIGNhbk1vdmUgJiYgbm9kZU9wcy5pbnNlcnRCZWZvcmUocGFyZW50RWxtLCB2bm9kZVRvTW92ZS5lbG0sIG9sZFN0YXJ0Vm5vZGUuZWxtKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBzYW1lIGtleSBidXQgZGlmZmVyZW50IGVsZW1lbnQuIHRyZWF0IGFzIG5ldyBlbGVtZW50CiAgICAgICAgICAgICAgY3JlYXRlRWxtKG5ld1N0YXJ0Vm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCBvbGRTdGFydFZub2RlLmVsbSwgZmFsc2UsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG5ld1N0YXJ0Vm5vZGUgPSBuZXdDaFsrK25ld1N0YXJ0SWR4XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG9sZFN0YXJ0SWR4ID4gb2xkRW5kSWR4KSB7CiAgICAgICAgcmVmRWxtID0gaXNVbmRlZihuZXdDaFtuZXdFbmRJZHggKyAxXSkgPyBudWxsIDogbmV3Q2hbbmV3RW5kSWR4ICsgMV0uZWxtOwogICAgICAgIGFkZFZub2RlcyhwYXJlbnRFbG0sIHJlZkVsbSwgbmV3Q2gsIG5ld1N0YXJ0SWR4LCBuZXdFbmRJZHgsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgIH0gZWxzZSBpZiAobmV3U3RhcnRJZHggPiBuZXdFbmRJZHgpIHsKICAgICAgICByZW1vdmVWbm9kZXMob2xkQ2gsIG9sZFN0YXJ0SWR4LCBvbGRFbmRJZHgpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tEdXBsaWNhdGVLZXlzIChjaGlsZHJlbikgewogICAgICB2YXIgc2VlbktleXMgPSB7fTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciB2bm9kZSA9IGNoaWxkcmVuW2ldOwogICAgICAgIHZhciBrZXkgPSB2bm9kZS5rZXk7CiAgICAgICAgaWYgKGlzRGVmKGtleSkpIHsKICAgICAgICAgIGlmIChzZWVuS2V5c1trZXldKSB7CiAgICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICAgKCJEdXBsaWNhdGUga2V5cyBkZXRlY3RlZDogJyIgKyBrZXkgKyAiJy4gVGhpcyBtYXkgY2F1c2UgYW4gdXBkYXRlIGVycm9yLiIpLAogICAgICAgICAgICAgIHZub2RlLmNvbnRleHQKICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlZW5LZXlzW2tleV0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRJZHhJbk9sZCAobm9kZSwgb2xkQ2gsIHN0YXJ0LCBlbmQpIHsKICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgICAgICB2YXIgYyA9IG9sZENoW2ldOwogICAgICAgIGlmIChpc0RlZihjKSAmJiBzYW1lVm5vZGUobm9kZSwgYykpIHsgcmV0dXJuIGkgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGF0Y2hWbm9kZSAoCiAgICAgIG9sZFZub2RlLAogICAgICB2bm9kZSwKICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLAogICAgICBvd25lckFycmF5LAogICAgICBpbmRleCwKICAgICAgcmVtb3ZlT25seQogICAgKSB7CiAgICAgIGlmIChvbGRWbm9kZSA9PT0gdm5vZGUpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgaWYgKGlzRGVmKHZub2RlLmVsbSkgJiYgaXNEZWYob3duZXJBcnJheSkpIHsKICAgICAgICAvLyBjbG9uZSByZXVzZWQgdm5vZGUKICAgICAgICB2bm9kZSA9IG93bmVyQXJyYXlbaW5kZXhdID0gY2xvbmVWTm9kZSh2bm9kZSk7CiAgICAgIH0KCiAgICAgIHZhciBlbG0gPSB2bm9kZS5lbG0gPSBvbGRWbm9kZS5lbG07CgogICAgICBpZiAoaXNUcnVlKG9sZFZub2RlLmlzQXN5bmNQbGFjZWhvbGRlcikpIHsKICAgICAgICBpZiAoaXNEZWYodm5vZGUuYXN5bmNGYWN0b3J5LnJlc29sdmVkKSkgewogICAgICAgICAgaHlkcmF0ZShvbGRWbm9kZS5lbG0sIHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bm9kZS5pc0FzeW5jUGxhY2Vob2xkZXIgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gcmV1c2UgZWxlbWVudCBmb3Igc3RhdGljIHRyZWVzLgogICAgICAvLyBub3RlIHdlIG9ubHkgZG8gdGhpcyBpZiB0aGUgdm5vZGUgaXMgY2xvbmVkIC0KICAgICAgLy8gaWYgdGhlIG5ldyBub2RlIGlzIG5vdCBjbG9uZWQgaXQgbWVhbnMgdGhlIHJlbmRlciBmdW5jdGlvbnMgaGF2ZSBiZWVuCiAgICAgIC8vIHJlc2V0IGJ5IHRoZSBob3QtcmVsb2FkLWFwaSBhbmQgd2UgbmVlZCB0byBkbyBhIHByb3BlciByZS1yZW5kZXIuCiAgICAgIGlmIChpc1RydWUodm5vZGUuaXNTdGF0aWMpICYmCiAgICAgICAgaXNUcnVlKG9sZFZub2RlLmlzU3RhdGljKSAmJgogICAgICAgIHZub2RlLmtleSA9PT0gb2xkVm5vZGUua2V5ICYmCiAgICAgICAgKGlzVHJ1ZSh2bm9kZS5pc0Nsb25lZCkgfHwgaXNUcnVlKHZub2RlLmlzT25jZSkpCiAgICAgICkgewogICAgICAgIHZub2RlLmNvbXBvbmVudEluc3RhbmNlID0gb2xkVm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHZhciBpOwogICAgICB2YXIgZGF0YSA9IHZub2RlLmRhdGE7CiAgICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS5wcmVwYXRjaCkpIHsKICAgICAgICBpKG9sZFZub2RlLCB2bm9kZSk7CiAgICAgIH0KCiAgICAgIHZhciBvbGRDaCA9IG9sZFZub2RlLmNoaWxkcmVuOwogICAgICB2YXIgY2ggPSB2bm9kZS5jaGlsZHJlbjsKICAgICAgaWYgKGlzRGVmKGRhdGEpICYmIGlzUGF0Y2hhYmxlKHZub2RlKSkgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjYnMudXBkYXRlLmxlbmd0aDsgKytpKSB7IGNicy51cGRhdGVbaV0ob2xkVm5vZGUsIHZub2RlKTsgfQogICAgICAgIGlmIChpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS51cGRhdGUpKSB7IGkob2xkVm5vZGUsIHZub2RlKTsgfQogICAgICB9CiAgICAgIGlmIChpc1VuZGVmKHZub2RlLnRleHQpKSB7CiAgICAgICAgaWYgKGlzRGVmKG9sZENoKSAmJiBpc0RlZihjaCkpIHsKICAgICAgICAgIGlmIChvbGRDaCAhPT0gY2gpIHsgdXBkYXRlQ2hpbGRyZW4oZWxtLCBvbGRDaCwgY2gsIGluc2VydGVkVm5vZGVRdWV1ZSwgcmVtb3ZlT25seSk7IH0KICAgICAgICB9IGVsc2UgaWYgKGlzRGVmKGNoKSkgewogICAgICAgICAgewogICAgICAgICAgICBjaGVja0R1cGxpY2F0ZUtleXMoY2gpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzRGVmKG9sZFZub2RlLnRleHQpKSB7IG5vZGVPcHMuc2V0VGV4dENvbnRlbnQoZWxtLCAnJyk7IH0KICAgICAgICAgIGFkZFZub2RlcyhlbG0sIG51bGwsIGNoLCAwLCBjaC5sZW5ndGggLSAxLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgIH0gZWxzZSBpZiAoaXNEZWYob2xkQ2gpKSB7CiAgICAgICAgICByZW1vdmVWbm9kZXMob2xkQ2gsIDAsIG9sZENoLmxlbmd0aCAtIDEpOwogICAgICAgIH0gZWxzZSBpZiAoaXNEZWYob2xkVm5vZGUudGV4dCkpIHsKICAgICAgICAgIG5vZGVPcHMuc2V0VGV4dENvbnRlbnQoZWxtLCAnJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKG9sZFZub2RlLnRleHQgIT09IHZub2RlLnRleHQpIHsKICAgICAgICBub2RlT3BzLnNldFRleHRDb250ZW50KGVsbSwgdm5vZGUudGV4dCk7CiAgICAgIH0KICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgaWYgKGlzRGVmKGkgPSBkYXRhLmhvb2spICYmIGlzRGVmKGkgPSBpLnBvc3RwYXRjaCkpIHsgaShvbGRWbm9kZSwgdm5vZGUpOyB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2VJbnNlcnRIb29rICh2bm9kZSwgcXVldWUsIGluaXRpYWwpIHsKICAgICAgLy8gZGVsYXkgaW5zZXJ0IGhvb2tzIGZvciBjb21wb25lbnQgcm9vdCBub2RlcywgaW52b2tlIHRoZW0gYWZ0ZXIgdGhlCiAgICAgIC8vIGVsZW1lbnQgaXMgcmVhbGx5IGluc2VydGVkCiAgICAgIGlmIChpc1RydWUoaW5pdGlhbCkgJiYgaXNEZWYodm5vZGUucGFyZW50KSkgewogICAgICAgIHZub2RlLnBhcmVudC5kYXRhLnBlbmRpbmdJbnNlcnQgPSBxdWV1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBxdWV1ZVtpXS5kYXRhLmhvb2suaW5zZXJ0KHF1ZXVlW2ldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICB2YXIgaHlkcmF0aW9uQmFpbGVkID0gZmFsc2U7CiAgICAvLyBsaXN0IG9mIG1vZHVsZXMgdGhhdCBjYW4gc2tpcCBjcmVhdGUgaG9vayBkdXJpbmcgaHlkcmF0aW9uIGJlY2F1c2UgdGhleQogICAgLy8gYXJlIGFscmVhZHkgcmVuZGVyZWQgb24gdGhlIGNsaWVudCBvciBoYXMgbm8gbmVlZCBmb3IgaW5pdGlhbGl6YXRpb24KICAgIC8vIE5vdGU6IHN0eWxlIGlzIGV4Y2x1ZGVkIGJlY2F1c2UgaXQgcmVsaWVzIG9uIGluaXRpYWwgY2xvbmUgZm9yIGZ1dHVyZQogICAgLy8gZGVlcCB1cGRhdGVzICgjNzA2MykuCiAgICB2YXIgaXNSZW5kZXJlZE1vZHVsZSA9IG1ha2VNYXAoJ2F0dHJzLGNsYXNzLHN0YXRpY0NsYXNzLHN0YXRpY1N0eWxlLGtleScpOwoKICAgIC8vIE5vdGU6IHRoaXMgaXMgYSBicm93c2VyLW9ubHkgZnVuY3Rpb24gc28gd2UgY2FuIGFzc3VtZSBlbG1zIGFyZSBET00gbm9kZXMuCiAgICBmdW5jdGlvbiBoeWRyYXRlIChlbG0sIHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIGluVlByZSkgewogICAgICB2YXIgaTsKICAgICAgdmFyIHRhZyA9IHZub2RlLnRhZzsKICAgICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwogICAgICB2YXIgY2hpbGRyZW4gPSB2bm9kZS5jaGlsZHJlbjsKICAgICAgaW5WUHJlID0gaW5WUHJlIHx8IChkYXRhICYmIGRhdGEucHJlKTsKICAgICAgdm5vZGUuZWxtID0gZWxtOwoKICAgICAgaWYgKGlzVHJ1ZSh2bm9kZS5pc0NvbW1lbnQpICYmIGlzRGVmKHZub2RlLmFzeW5jRmFjdG9yeSkpIHsKICAgICAgICB2bm9kZS5pc0FzeW5jUGxhY2Vob2xkZXIgPSB0cnVlOwogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgICAgLy8gYXNzZXJ0IG5vZGUgbWF0Y2gKICAgICAgewogICAgICAgIGlmICghYXNzZXJ0Tm9kZU1hdGNoKGVsbSwgdm5vZGUsIGluVlByZSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaXNEZWYoZGF0YSkpIHsKICAgICAgICBpZiAoaXNEZWYoaSA9IGRhdGEuaG9vaykgJiYgaXNEZWYoaSA9IGkuaW5pdCkpIHsgaSh2bm9kZSwgdHJ1ZSAvKiBoeWRyYXRpbmcgKi8pOyB9CiAgICAgICAgaWYgKGlzRGVmKGkgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSkpIHsKICAgICAgICAgIC8vIGNoaWxkIGNvbXBvbmVudC4gaXQgc2hvdWxkIGhhdmUgaHlkcmF0ZWQgaXRzIG93biB0cmVlLgogICAgICAgICAgaW5pdENvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChpc0RlZih0YWcpKSB7CiAgICAgICAgaWYgKGlzRGVmKGNoaWxkcmVuKSkgewogICAgICAgICAgLy8gZW1wdHkgZWxlbWVudCwgYWxsb3cgY2xpZW50IHRvIHBpY2sgdXAgYW5kIHBvcHVsYXRlIGNoaWxkcmVuCiAgICAgICAgICBpZiAoIWVsbS5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgICAgICAgY3JlYXRlQ2hpbGRyZW4odm5vZGUsIGNoaWxkcmVuLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gdi1odG1sIGFuZCBkb21Qcm9wczogaW5uZXJIVE1MCiAgICAgICAgICAgIGlmIChpc0RlZihpID0gZGF0YSkgJiYgaXNEZWYoaSA9IGkuZG9tUHJvcHMpICYmIGlzRGVmKGkgPSBpLmlubmVySFRNTCkpIHsKICAgICAgICAgICAgICBpZiAoaSAhPT0gZWxtLmlubmVySFRNTCkgewogICAgICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmCiAgICAgICAgICAgICAgICAgICFoeWRyYXRpb25CYWlsZWQKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICBoeWRyYXRpb25CYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1BhcmVudDogJywgZWxtKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdzZXJ2ZXIgaW5uZXJIVE1MOiAnLCBpKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdjbGllbnQgaW5uZXJIVE1MOiAnLCBlbG0uaW5uZXJIVE1MKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBpdGVyYXRlIGFuZCBjb21wYXJlIGNoaWxkcmVuIGxpc3RzCiAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuTWF0Y2ggPSB0cnVlOwogICAgICAgICAgICAgIHZhciBjaGlsZE5vZGUgPSBlbG0uZmlyc3RDaGlsZDsKICAgICAgICAgICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBjaGlsZHJlbi5sZW5ndGg7IGkkMSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoIWNoaWxkTm9kZSB8fCAhaHlkcmF0ZShjaGlsZE5vZGUsIGNoaWxkcmVuW2kkMV0sIGluc2VydGVkVm5vZGVRdWV1ZSwgaW5WUHJlKSkgewogICAgICAgICAgICAgICAgICBjaGlsZHJlbk1hdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjaGlsZE5vZGUgPSBjaGlsZE5vZGUubmV4dFNpYmxpbmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vIGlmIGNoaWxkTm9kZSBpcyBub3QgbnVsbCwgaXQgbWVhbnMgdGhlIGFjdHVhbCBjaGlsZE5vZGVzIGxpc3QgaXMKICAgICAgICAgICAgICAvLyBsb25nZXIgdGhhbiB0aGUgdmlydHVhbCBjaGlsZHJlbiBsaXN0LgogICAgICAgICAgICAgIGlmICghY2hpbGRyZW5NYXRjaCB8fCBjaGlsZE5vZGUpIHsKICAgICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJgogICAgICAgICAgICAgICAgICAhaHlkcmF0aW9uQmFpbGVkCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgaHlkcmF0aW9uQmFpbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdQYXJlbnQ6ICcsIGVsbSk7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignTWlzbWF0Y2hpbmcgY2hpbGROb2RlcyB2cy4gVk5vZGVzOiAnLCBlbG0uY2hpbGROb2RlcywgY2hpbGRyZW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChpc0RlZihkYXRhKSkgewogICAgICAgICAgdmFyIGZ1bGxJbnZva2UgPSBmYWxzZTsKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7CiAgICAgICAgICAgIGlmICghaXNSZW5kZXJlZE1vZHVsZShrZXkpKSB7CiAgICAgICAgICAgICAgZnVsbEludm9rZSA9IHRydWU7CiAgICAgICAgICAgICAgaW52b2tlQ3JlYXRlSG9va3Modm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFmdWxsSW52b2tlICYmIGRhdGFbJ2NsYXNzJ10pIHsKICAgICAgICAgICAgLy8gZW5zdXJlIGNvbGxlY3RpbmcgZGVwcyBmb3IgZGVlcCBjbGFzcyBiaW5kaW5ncyBmb3IgZnV0dXJlIHVwZGF0ZXMKICAgICAgICAgICAgdHJhdmVyc2UoZGF0YVsnY2xhc3MnXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGVsbS5kYXRhICE9PSB2bm9kZS50ZXh0KSB7CiAgICAgICAgZWxtLmRhdGEgPSB2bm9kZS50ZXh0OwogICAgICB9CiAgICAgIHJldHVybiB0cnVlCiAgICB9CgogICAgZnVuY3Rpb24gYXNzZXJ0Tm9kZU1hdGNoIChub2RlLCB2bm9kZSwgaW5WUHJlKSB7CiAgICAgIGlmIChpc0RlZih2bm9kZS50YWcpKSB7CiAgICAgICAgcmV0dXJuIHZub2RlLnRhZy5pbmRleE9mKCd2dWUtY29tcG9uZW50JykgPT09IDAgfHwgKAogICAgICAgICAgIWlzVW5rbm93bkVsZW1lbnQkJDEodm5vZGUsIGluVlByZSkgJiYKICAgICAgICAgIHZub2RlLnRhZy50b0xvd2VyQ2FzZSgpID09PSAobm9kZS50YWdOYW1lICYmIG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpKQogICAgICAgICkKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gKHZub2RlLmlzQ29tbWVudCA/IDggOiAzKQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZ1bmN0aW9uIHBhdGNoIChvbGRWbm9kZSwgdm5vZGUsIGh5ZHJhdGluZywgcmVtb3ZlT25seSkgewogICAgICBpZiAoaXNVbmRlZih2bm9kZSkpIHsKICAgICAgICBpZiAoaXNEZWYob2xkVm5vZGUpKSB7IGludm9rZURlc3Ryb3lIb29rKG9sZFZub2RlKTsgfQogICAgICAgIHJldHVybgogICAgICB9CgogICAgICB2YXIgaXNJbml0aWFsUGF0Y2ggPSBmYWxzZTsKICAgICAgdmFyIGluc2VydGVkVm5vZGVRdWV1ZSA9IFtdOwoKICAgICAgaWYgKGlzVW5kZWYob2xkVm5vZGUpKSB7CiAgICAgICAgLy8gZW1wdHkgbW91bnQgKGxpa2VseSBhcyBjb21wb25lbnQpLCBjcmVhdGUgbmV3IHJvb3QgZWxlbWVudAogICAgICAgIGlzSW5pdGlhbFBhdGNoID0gdHJ1ZTsKICAgICAgICBjcmVhdGVFbG0odm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGlzUmVhbEVsZW1lbnQgPSBpc0RlZihvbGRWbm9kZS5ub2RlVHlwZSk7CiAgICAgICAgaWYgKCFpc1JlYWxFbGVtZW50ICYmIHNhbWVWbm9kZShvbGRWbm9kZSwgdm5vZGUpKSB7CiAgICAgICAgICAvLyBwYXRjaCBleGlzdGluZyByb290IG5vZGUKICAgICAgICAgIHBhdGNoVm5vZGUob2xkVm5vZGUsIHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG51bGwsIG51bGwsIHJlbW92ZU9ubHkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoaXNSZWFsRWxlbWVudCkgewogICAgICAgICAgICAvLyBtb3VudGluZyB0byBhIHJlYWwgZWxlbWVudAogICAgICAgICAgICAvLyBjaGVjayBpZiB0aGlzIGlzIHNlcnZlci1yZW5kZXJlZCBjb250ZW50IGFuZCBpZiB3ZSBjYW4gcGVyZm9ybQogICAgICAgICAgICAvLyBhIHN1Y2Nlc3NmdWwgaHlkcmF0aW9uLgogICAgICAgICAgICBpZiAob2xkVm5vZGUubm9kZVR5cGUgPT09IDEgJiYgb2xkVm5vZGUuaGFzQXR0cmlidXRlKFNTUl9BVFRSKSkgewogICAgICAgICAgICAgIG9sZFZub2RlLnJlbW92ZUF0dHJpYnV0ZShTU1JfQVRUUik7CiAgICAgICAgICAgICAgaHlkcmF0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNUcnVlKGh5ZHJhdGluZykpIHsKICAgICAgICAgICAgICBpZiAoaHlkcmF0ZShvbGRWbm9kZSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSkpIHsKICAgICAgICAgICAgICAgIGludm9rZUluc2VydEhvb2sodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gb2xkVm5vZGUKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgd2FybigKICAgICAgICAgICAgICAgICAgJ1RoZSBjbGllbnQtc2lkZSByZW5kZXJlZCB2aXJ0dWFsIERPTSB0cmVlIGlzIG5vdCBtYXRjaGluZyAnICsKICAgICAgICAgICAgICAgICAgJ3NlcnZlci1yZW5kZXJlZCBjb250ZW50LiBUaGlzIGlzIGxpa2VseSBjYXVzZWQgYnkgaW5jb3JyZWN0ICcgKwogICAgICAgICAgICAgICAgICAnSFRNTCBtYXJrdXAsIGZvciBleGFtcGxlIG5lc3RpbmcgYmxvY2stbGV2ZWwgZWxlbWVudHMgaW5zaWRlICcgKwogICAgICAgICAgICAgICAgICAnPHA+LCBvciBtaXNzaW5nIDx0Ym9keT4uIEJhaWxpbmcgaHlkcmF0aW9uIGFuZCBwZXJmb3JtaW5nICcgKwogICAgICAgICAgICAgICAgICAnZnVsbCBjbGllbnQtc2lkZSByZW5kZXIuJwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZWl0aGVyIG5vdCBzZXJ2ZXItcmVuZGVyZWQsIG9yIGh5ZHJhdGlvbiBmYWlsZWQuCiAgICAgICAgICAgIC8vIGNyZWF0ZSBhbiBlbXB0eSBub2RlIGFuZCByZXBsYWNlIGl0CiAgICAgICAgICAgIG9sZFZub2RlID0gZW1wdHlOb2RlQXQob2xkVm5vZGUpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHJlcGxhY2luZyBleGlzdGluZyBlbGVtZW50CiAgICAgICAgICB2YXIgb2xkRWxtID0gb2xkVm5vZGUuZWxtOwogICAgICAgICAgdmFyIHBhcmVudEVsbSA9IG5vZGVPcHMucGFyZW50Tm9kZShvbGRFbG0pOwoKICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgbm9kZQogICAgICAgICAgY3JlYXRlRWxtKAogICAgICAgICAgICB2bm9kZSwKICAgICAgICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLAogICAgICAgICAgICAvLyBleHRyZW1lbHkgcmFyZSBlZGdlIGNhc2U6IGRvIG5vdCBpbnNlcnQgaWYgb2xkIGVsZW1lbnQgaXMgaW4gYQogICAgICAgICAgICAvLyBsZWF2aW5nIHRyYW5zaXRpb24uIE9ubHkgaGFwcGVucyB3aGVuIGNvbWJpbmluZyB0cmFuc2l0aW9uICsKICAgICAgICAgICAgLy8ga2VlcC1hbGl2ZSArIEhPQ3MuICgjNDU5MCkKICAgICAgICAgICAgb2xkRWxtLl9sZWF2ZUNiID8gbnVsbCA6IHBhcmVudEVsbSwKICAgICAgICAgICAgbm9kZU9wcy5uZXh0U2libGluZyhvbGRFbG0pCiAgICAgICAgICApOwoKICAgICAgICAgIC8vIHVwZGF0ZSBwYXJlbnQgcGxhY2Vob2xkZXIgbm9kZSBlbGVtZW50LCByZWN1cnNpdmVseQogICAgICAgICAgaWYgKGlzRGVmKHZub2RlLnBhcmVudCkpIHsKICAgICAgICAgICAgdmFyIGFuY2VzdG9yID0gdm5vZGUucGFyZW50OwogICAgICAgICAgICB2YXIgcGF0Y2hhYmxlID0gaXNQYXRjaGFibGUodm5vZGUpOwogICAgICAgICAgICB3aGlsZSAoYW5jZXN0b3IpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNicy5kZXN0cm95Lmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICBjYnMuZGVzdHJveVtpXShhbmNlc3Rvcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFuY2VzdG9yLmVsbSA9IHZub2RlLmVsbTsKICAgICAgICAgICAgICBpZiAocGF0Y2hhYmxlKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBjYnMuY3JlYXRlLmxlbmd0aDsgKytpJDEpIHsKICAgICAgICAgICAgICAgICAgY2JzLmNyZWF0ZVtpJDFdKGVtcHR5Tm9kZSwgYW5jZXN0b3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gIzY1MTMKICAgICAgICAgICAgICAgIC8vIGludm9rZSBpbnNlcnQgaG9va3MgdGhhdCBtYXkgaGF2ZSBiZWVuIG1lcmdlZCBieSBjcmVhdGUgaG9va3MuCiAgICAgICAgICAgICAgICAvLyBlLmcuIGZvciBkaXJlY3RpdmVzIHRoYXQgdXNlcyB0aGUgImluc2VydGVkIiBob29rLgogICAgICAgICAgICAgICAgdmFyIGluc2VydCA9IGFuY2VzdG9yLmRhdGEuaG9vay5pbnNlcnQ7CiAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0Lm1lcmdlZCkgewogICAgICAgICAgICAgICAgICAvLyBzdGFydCBhdCBpbmRleCAxIHRvIGF2b2lkIHJlLWludm9raW5nIGNvbXBvbmVudCBtb3VudGVkIGhvb2sKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSQyID0gMTsgaSQyIDwgaW5zZXJ0LmZucy5sZW5ndGg7IGkkMisrKSB7CiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0LmZuc1tpJDJdKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVnaXN0ZXJSZWYoYW5jZXN0b3IpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhbmNlc3RvciA9IGFuY2VzdG9yLnBhcmVudDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIGRlc3Ryb3kgb2xkIG5vZGUKICAgICAgICAgIGlmIChpc0RlZihwYXJlbnRFbG0pKSB7CiAgICAgICAgICAgIHJlbW92ZVZub2Rlcyhbb2xkVm5vZGVdLCAwLCAwKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaXNEZWYob2xkVm5vZGUudGFnKSkgewogICAgICAgICAgICBpbnZva2VEZXN0cm95SG9vayhvbGRWbm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpbnZva2VJbnNlcnRIb29rKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIGlzSW5pdGlhbFBhdGNoKTsKICAgICAgcmV0dXJuIHZub2RlLmVsbQogICAgfQogIH0KCiAgLyogICovCgogIHZhciBkaXJlY3RpdmVzID0gewogICAgY3JlYXRlOiB1cGRhdGVEaXJlY3RpdmVzLAogICAgdXBkYXRlOiB1cGRhdGVEaXJlY3RpdmVzLAogICAgZGVzdHJveTogZnVuY3Rpb24gdW5iaW5kRGlyZWN0aXZlcyAodm5vZGUpIHsKICAgICAgdXBkYXRlRGlyZWN0aXZlcyh2bm9kZSwgZW1wdHlOb2RlKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiB1cGRhdGVEaXJlY3RpdmVzIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgIGlmIChvbGRWbm9kZS5kYXRhLmRpcmVjdGl2ZXMgfHwgdm5vZGUuZGF0YS5kaXJlY3RpdmVzKSB7CiAgICAgIF91cGRhdGUob2xkVm5vZGUsIHZub2RlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF91cGRhdGUgKG9sZFZub2RlLCB2bm9kZSkgewogICAgdmFyIGlzQ3JlYXRlID0gb2xkVm5vZGUgPT09IGVtcHR5Tm9kZTsKICAgIHZhciBpc0Rlc3Ryb3kgPSB2bm9kZSA9PT0gZW1wdHlOb2RlOwogICAgdmFyIG9sZERpcnMgPSBub3JtYWxpemVEaXJlY3RpdmVzJDEob2xkVm5vZGUuZGF0YS5kaXJlY3RpdmVzLCBvbGRWbm9kZS5jb250ZXh0KTsKICAgIHZhciBuZXdEaXJzID0gbm9ybWFsaXplRGlyZWN0aXZlcyQxKHZub2RlLmRhdGEuZGlyZWN0aXZlcywgdm5vZGUuY29udGV4dCk7CgogICAgdmFyIGRpcnNXaXRoSW5zZXJ0ID0gW107CiAgICB2YXIgZGlyc1dpdGhQb3N0cGF0Y2ggPSBbXTsKCiAgICB2YXIga2V5LCBvbGREaXIsIGRpcjsKICAgIGZvciAoa2V5IGluIG5ld0RpcnMpIHsKICAgICAgb2xkRGlyID0gb2xkRGlyc1trZXldOwogICAgICBkaXIgPSBuZXdEaXJzW2tleV07CiAgICAgIGlmICghb2xkRGlyKSB7CiAgICAgICAgLy8gbmV3IGRpcmVjdGl2ZSwgYmluZAogICAgICAgIGNhbGxIb29rJDEoZGlyLCAnYmluZCcsIHZub2RlLCBvbGRWbm9kZSk7CiAgICAgICAgaWYgKGRpci5kZWYgJiYgZGlyLmRlZi5pbnNlcnRlZCkgewogICAgICAgICAgZGlyc1dpdGhJbnNlcnQucHVzaChkaXIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBleGlzdGluZyBkaXJlY3RpdmUsIHVwZGF0ZQogICAgICAgIGRpci5vbGRWYWx1ZSA9IG9sZERpci52YWx1ZTsKICAgICAgICBkaXIub2xkQXJnID0gb2xkRGlyLmFyZzsKICAgICAgICBjYWxsSG9vayQxKGRpciwgJ3VwZGF0ZScsIHZub2RlLCBvbGRWbm9kZSk7CiAgICAgICAgaWYgKGRpci5kZWYgJiYgZGlyLmRlZi5jb21wb25lbnRVcGRhdGVkKSB7CiAgICAgICAgICBkaXJzV2l0aFBvc3RwYXRjaC5wdXNoKGRpcik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGRpcnNXaXRoSW5zZXJ0Lmxlbmd0aCkgewogICAgICB2YXIgY2FsbEluc2VydCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRpcnNXaXRoSW5zZXJ0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjYWxsSG9vayQxKGRpcnNXaXRoSW5zZXJ0W2ldLCAnaW5zZXJ0ZWQnLCB2bm9kZSwgb2xkVm5vZGUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgaWYgKGlzQ3JlYXRlKSB7CiAgICAgICAgbWVyZ2VWTm9kZUhvb2sodm5vZGUsICdpbnNlcnQnLCBjYWxsSW5zZXJ0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsSW5zZXJ0KCk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZGlyc1dpdGhQb3N0cGF0Y2gubGVuZ3RoKSB7CiAgICAgIG1lcmdlVk5vZGVIb29rKHZub2RlLCAncG9zdHBhdGNoJywgZnVuY3Rpb24gKCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGlyc1dpdGhQb3N0cGF0Y2gubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNhbGxIb29rJDEoZGlyc1dpdGhQb3N0cGF0Y2hbaV0sICdjb21wb25lbnRVcGRhdGVkJywgdm5vZGUsIG9sZFZub2RlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGlmICghaXNDcmVhdGUpIHsKICAgICAgZm9yIChrZXkgaW4gb2xkRGlycykgewogICAgICAgIGlmICghbmV3RGlyc1trZXldKSB7CiAgICAgICAgICAvLyBubyBsb25nZXIgcHJlc2VudCwgdW5iaW5kCiAgICAgICAgICBjYWxsSG9vayQxKG9sZERpcnNba2V5XSwgJ3VuYmluZCcsIG9sZFZub2RlLCBvbGRWbm9kZSwgaXNEZXN0cm95KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBlbXB0eU1vZGlmaWVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZURpcmVjdGl2ZXMkMSAoCiAgICBkaXJzLAogICAgdm0KICApIHsKICAgIHZhciByZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKCFkaXJzKSB7CiAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICByZXR1cm4gcmVzCiAgICB9CiAgICB2YXIgaSwgZGlyOwogICAgZm9yIChpID0gMDsgaSA8IGRpcnMubGVuZ3RoOyBpKyspIHsKICAgICAgZGlyID0gZGlyc1tpXTsKICAgICAgaWYgKCFkaXIubW9kaWZpZXJzKSB7CiAgICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgICAgZGlyLm1vZGlmaWVycyA9IGVtcHR5TW9kaWZpZXJzOwogICAgICB9CiAgICAgIHJlc1tnZXRSYXdEaXJOYW1lKGRpcildID0gZGlyOwogICAgICBkaXIuZGVmID0gcmVzb2x2ZUFzc2V0KHZtLiRvcHRpb25zLCAnZGlyZWN0aXZlcycsIGRpci5uYW1lLCB0cnVlKTsKICAgIH0KICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gZ2V0UmF3RGlyTmFtZSAoZGlyKSB7CiAgICByZXR1cm4gZGlyLnJhd05hbWUgfHwgKChkaXIubmFtZSkgKyAiLiIgKyAoT2JqZWN0LmtleXMoZGlyLm1vZGlmaWVycyB8fCB7fSkuam9pbignLicpKSkKICB9CgogIGZ1bmN0aW9uIGNhbGxIb29rJDEgKGRpciwgaG9vaywgdm5vZGUsIG9sZFZub2RlLCBpc0Rlc3Ryb3kpIHsKICAgIHZhciBmbiA9IGRpci5kZWYgJiYgZGlyLmRlZltob29rXTsKICAgIGlmIChmbikgewogICAgICB0cnkgewogICAgICAgIGZuKHZub2RlLmVsbSwgZGlyLCB2bm9kZSwgb2xkVm5vZGUsIGlzRGVzdHJveSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBoYW5kbGVFcnJvcihlLCB2bm9kZS5jb250ZXh0LCAoImRpcmVjdGl2ZSAiICsgKGRpci5uYW1lKSArICIgIiArIGhvb2sgKyAiIGhvb2siKSk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBiYXNlTW9kdWxlcyA9IFsKICAgIHJlZiwKICAgIGRpcmVjdGl2ZXMKICBdOwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gdXBkYXRlQXR0cnMgKG9sZFZub2RlLCB2bm9kZSkgewogICAgdmFyIG9wdHMgPSB2bm9kZS5jb21wb25lbnRPcHRpb25zOwogICAgaWYgKGlzRGVmKG9wdHMpICYmIG9wdHMuQ3Rvci5vcHRpb25zLmluaGVyaXRBdHRycyA9PT0gZmFsc2UpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaXNVbmRlZihvbGRWbm9kZS5kYXRhLmF0dHJzKSAmJiBpc1VuZGVmKHZub2RlLmRhdGEuYXR0cnMpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIGtleSwgY3VyLCBvbGQ7CiAgICB2YXIgZWxtID0gdm5vZGUuZWxtOwogICAgdmFyIG9sZEF0dHJzID0gb2xkVm5vZGUuZGF0YS5hdHRycyB8fCB7fTsKICAgIHZhciBhdHRycyA9IHZub2RlLmRhdGEuYXR0cnMgfHwge307CiAgICAvLyBjbG9uZSBvYnNlcnZlZCBvYmplY3RzLCBhcyB0aGUgdXNlciBwcm9iYWJseSB3YW50cyB0byBtdXRhdGUgaXQKICAgIGlmIChpc0RlZihhdHRycy5fX29iX18pKSB7CiAgICAgIGF0dHJzID0gdm5vZGUuZGF0YS5hdHRycyA9IGV4dGVuZCh7fSwgYXR0cnMpOwogICAgfQoKICAgIGZvciAoa2V5IGluIGF0dHJzKSB7CiAgICAgIGN1ciA9IGF0dHJzW2tleV07CiAgICAgIG9sZCA9IG9sZEF0dHJzW2tleV07CiAgICAgIGlmIChvbGQgIT09IGN1cikgewogICAgICAgIHNldEF0dHIoZWxtLCBrZXksIGN1cik7CiAgICAgIH0KICAgIH0KICAgIC8vICM0MzkxOiBpbiBJRTksIHNldHRpbmcgdHlwZSBjYW4gcmVzZXQgdmFsdWUgZm9yIGlucHV0W3R5cGU9cmFkaW9dCiAgICAvLyAjNjY2NjogSUUvRWRnZSBmb3JjZXMgcHJvZ3Jlc3MgdmFsdWUgZG93biB0byAxIGJlZm9yZSBzZXR0aW5nIGEgbWF4CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICgoaXNJRSB8fCBpc0VkZ2UpICYmIGF0dHJzLnZhbHVlICE9PSBvbGRBdHRycy52YWx1ZSkgewogICAgICBzZXRBdHRyKGVsbSwgJ3ZhbHVlJywgYXR0cnMudmFsdWUpOwogICAgfQogICAgZm9yIChrZXkgaW4gb2xkQXR0cnMpIHsKICAgICAgaWYgKGlzVW5kZWYoYXR0cnNba2V5XSkpIHsKICAgICAgICBpZiAoaXNYbGluayhrZXkpKSB7CiAgICAgICAgICBlbG0ucmVtb3ZlQXR0cmlidXRlTlMoeGxpbmtOUywgZ2V0WGxpbmtQcm9wKGtleSkpOwogICAgICAgIH0gZWxzZSBpZiAoIWlzRW51bWVyYXRlZEF0dHIoa2V5KSkgewogICAgICAgICAgZWxtLnJlbW92ZUF0dHJpYnV0ZShrZXkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0QXR0ciAoZWwsIGtleSwgdmFsdWUpIHsKICAgIGlmIChlbC50YWdOYW1lLmluZGV4T2YoJy0nKSA+IC0xKSB7CiAgICAgIGJhc2VTZXRBdHRyKGVsLCBrZXksIHZhbHVlKTsKICAgIH0gZWxzZSBpZiAoaXNCb29sZWFuQXR0cihrZXkpKSB7CiAgICAgIC8vIHNldCBhdHRyaWJ1dGUgZm9yIGJsYW5rIHZhbHVlCiAgICAgIC8vIGUuZy4gPG9wdGlvbiBkaXNhYmxlZD5TZWxlY3Qgb25lPC9vcHRpb24+CiAgICAgIGlmIChpc0ZhbHN5QXR0clZhbHVlKHZhbHVlKSkgewogICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZShrZXkpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHRlY2huaWNhbGx5IGFsbG93ZnVsbHNjcmVlbiBpcyBhIGJvb2xlYW4gYXR0cmlidXRlIGZvciA8aWZyYW1lPiwKICAgICAgICAvLyBidXQgRmxhc2ggZXhwZWN0cyBhIHZhbHVlIG9mICJ0cnVlIiB3aGVuIHVzZWQgb24gPGVtYmVkPiB0YWcKICAgICAgICB2YWx1ZSA9IGtleSA9PT0gJ2FsbG93ZnVsbHNjcmVlbicgJiYgZWwudGFnTmFtZSA9PT0gJ0VNQkVEJwogICAgICAgICAgPyAndHJ1ZScKICAgICAgICAgIDoga2V5OwogICAgICAgIGVsLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChpc0VudW1lcmF0ZWRBdHRyKGtleSkpIHsKICAgICAgZWwuc2V0QXR0cmlidXRlKGtleSwgY29udmVydEVudW1lcmF0ZWRWYWx1ZShrZXksIHZhbHVlKSk7CiAgICB9IGVsc2UgaWYgKGlzWGxpbmsoa2V5KSkgewogICAgICBpZiAoaXNGYWxzeUF0dHJWYWx1ZSh2YWx1ZSkpIHsKICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGVOUyh4bGlua05TLCBnZXRYbGlua1Byb3Aoa2V5KSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlTlMoeGxpbmtOUywga2V5LCB2YWx1ZSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGJhc2VTZXRBdHRyKGVsLCBrZXksIHZhbHVlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGJhc2VTZXRBdHRyIChlbCwga2V5LCB2YWx1ZSkgewogICAgaWYgKGlzRmFsc3lBdHRyVmFsdWUodmFsdWUpKSB7CiAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZShrZXkpOwogICAgfSBlbHNlIHsKICAgICAgLy8gIzcxMzg6IElFMTAgJiAxMSBmaXJlcyBpbnB1dCBldmVudCB3aGVuIHNldHRpbmcgcGxhY2Vob2xkZXIgb24KICAgICAgLy8gPHRleHRhcmVhPi4uLiBibG9jayB0aGUgZmlyc3QgaW5wdXQgZXZlbnQgYW5kIHJlbW92ZSB0aGUgYmxvY2tlcgogICAgICAvLyBpbW1lZGlhdGVseS4KICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmICgKICAgICAgICBpc0lFICYmICFpc0lFOSAmJgogICAgICAgIGVsLnRhZ05hbWUgPT09ICdURVhUQVJFQScgJiYKICAgICAgICBrZXkgPT09ICdwbGFjZWhvbGRlcicgJiYgdmFsdWUgIT09ICcnICYmICFlbC5fX2llcGgKICAgICAgKSB7CiAgICAgICAgdmFyIGJsb2NrZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lucHV0JywgYmxvY2tlcik7CiAgICAgICAgfTsKICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGJsb2NrZXIpOwogICAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICAgIGVsLl9faWVwaCA9IHRydWU7IC8qIElFIHBsYWNlaG9sZGVyIHBhdGNoZWQgKi8KICAgICAgfQogICAgICBlbC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQoKICB2YXIgYXR0cnMgPSB7CiAgICBjcmVhdGU6IHVwZGF0ZUF0dHJzLAogICAgdXBkYXRlOiB1cGRhdGVBdHRycwogIH07CgogIC8qICAqLwoKICBmdW5jdGlvbiB1cGRhdGVDbGFzcyAob2xkVm5vZGUsIHZub2RlKSB7CiAgICB2YXIgZWwgPSB2bm9kZS5lbG07CiAgICB2YXIgZGF0YSA9IHZub2RlLmRhdGE7CiAgICB2YXIgb2xkRGF0YSA9IG9sZFZub2RlLmRhdGE7CiAgICBpZiAoCiAgICAgIGlzVW5kZWYoZGF0YS5zdGF0aWNDbGFzcykgJiYKICAgICAgaXNVbmRlZihkYXRhLmNsYXNzKSAmJiAoCiAgICAgICAgaXNVbmRlZihvbGREYXRhKSB8fCAoCiAgICAgICAgICBpc1VuZGVmKG9sZERhdGEuc3RhdGljQ2xhc3MpICYmCiAgICAgICAgICBpc1VuZGVmKG9sZERhdGEuY2xhc3MpCiAgICAgICAgKQogICAgICApCiAgICApIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgdmFyIGNscyA9IGdlbkNsYXNzRm9yVm5vZGUodm5vZGUpOwoKICAgIC8vIGhhbmRsZSB0cmFuc2l0aW9uIGNsYXNzZXMKICAgIHZhciB0cmFuc2l0aW9uQ2xhc3MgPSBlbC5fdHJhbnNpdGlvbkNsYXNzZXM7CiAgICBpZiAoaXNEZWYodHJhbnNpdGlvbkNsYXNzKSkgewogICAgICBjbHMgPSBjb25jYXQoY2xzLCBzdHJpbmdpZnlDbGFzcyh0cmFuc2l0aW9uQ2xhc3MpKTsKICAgIH0KCiAgICAvLyBzZXQgdGhlIGNsYXNzCiAgICBpZiAoY2xzICE9PSBlbC5fcHJldkNsYXNzKSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBjbHMpOwogICAgICBlbC5fcHJldkNsYXNzID0gY2xzOwogICAgfQogIH0KCiAgdmFyIGtsYXNzID0gewogICAgY3JlYXRlOiB1cGRhdGVDbGFzcywKICAgIHVwZGF0ZTogdXBkYXRlQ2xhc3MKICB9OwoKICAvKiAgKi8KCiAgdmFyIHZhbGlkRGl2aXNpb25DaGFyUkUgPSAvW1x3KS4rXC1fJFxdXS87CgogIGZ1bmN0aW9uIHBhcnNlRmlsdGVycyAoZXhwKSB7CiAgICB2YXIgaW5TaW5nbGUgPSBmYWxzZTsKICAgIHZhciBpbkRvdWJsZSA9IGZhbHNlOwogICAgdmFyIGluVGVtcGxhdGVTdHJpbmcgPSBmYWxzZTsKICAgIHZhciBpblJlZ2V4ID0gZmFsc2U7CiAgICB2YXIgY3VybHkgPSAwOwogICAgdmFyIHNxdWFyZSA9IDA7CiAgICB2YXIgcGFyZW4gPSAwOwogICAgdmFyIGxhc3RGaWx0ZXJJbmRleCA9IDA7CiAgICB2YXIgYywgcHJldiwgaSwgZXhwcmVzc2lvbiwgZmlsdGVyczsKCiAgICBmb3IgKGkgPSAwOyBpIDwgZXhwLmxlbmd0aDsgaSsrKSB7CiAgICAgIHByZXYgPSBjOwogICAgICBjID0gZXhwLmNoYXJDb2RlQXQoaSk7CiAgICAgIGlmIChpblNpbmdsZSkgewogICAgICAgIGlmIChjID09PSAweDI3ICYmIHByZXYgIT09IDB4NUMpIHsgaW5TaW5nbGUgPSBmYWxzZTsgfQogICAgICB9IGVsc2UgaWYgKGluRG91YmxlKSB7CiAgICAgICAgaWYgKGMgPT09IDB4MjIgJiYgcHJldiAhPT0gMHg1QykgeyBpbkRvdWJsZSA9IGZhbHNlOyB9CiAgICAgIH0gZWxzZSBpZiAoaW5UZW1wbGF0ZVN0cmluZykgewogICAgICAgIGlmIChjID09PSAweDYwICYmIHByZXYgIT09IDB4NUMpIHsgaW5UZW1wbGF0ZVN0cmluZyA9IGZhbHNlOyB9CiAgICAgIH0gZWxzZSBpZiAoaW5SZWdleCkgewogICAgICAgIGlmIChjID09PSAweDJmICYmIHByZXYgIT09IDB4NUMpIHsgaW5SZWdleCA9IGZhbHNlOyB9CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgYyA9PT0gMHg3QyAmJiAvLyBwaXBlCiAgICAgICAgZXhwLmNoYXJDb2RlQXQoaSArIDEpICE9PSAweDdDICYmCiAgICAgICAgZXhwLmNoYXJDb2RlQXQoaSAtIDEpICE9PSAweDdDICYmCiAgICAgICAgIWN1cmx5ICYmICFzcXVhcmUgJiYgIXBhcmVuCiAgICAgICkgewogICAgICAgIGlmIChleHByZXNzaW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIGZpcnN0IGZpbHRlciwgZW5kIG9mIGV4cHJlc3Npb24KICAgICAgICAgIGxhc3RGaWx0ZXJJbmRleCA9IGkgKyAxOwogICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cC5zbGljZSgwLCBpKS50cmltKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHB1c2hGaWx0ZXIoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICBjYXNlIDB4MjI6IGluRG91YmxlID0gdHJ1ZTsgYnJlYWsgICAgICAgICAvLyAiCiAgICAgICAgICBjYXNlIDB4Mjc6IGluU2luZ2xlID0gdHJ1ZTsgYnJlYWsgICAgICAgICAvLyAnCiAgICAgICAgICBjYXNlIDB4NjA6IGluVGVtcGxhdGVTdHJpbmcgPSB0cnVlOyBicmVhayAvLyBgCiAgICAgICAgICBjYXNlIDB4Mjg6IHBhcmVuKys7IGJyZWFrICAgICAgICAgICAgICAgICAvLyAoCiAgICAgICAgICBjYXNlIDB4Mjk6IHBhcmVuLS07IGJyZWFrICAgICAgICAgICAgICAgICAvLyApCiAgICAgICAgICBjYXNlIDB4NUI6IHNxdWFyZSsrOyBicmVhayAgICAgICAgICAgICAgICAvLyBbCiAgICAgICAgICBjYXNlIDB4NUQ6IHNxdWFyZS0tOyBicmVhayAgICAgICAgICAgICAgICAvLyBdCiAgICAgICAgICBjYXNlIDB4N0I6IGN1cmx5Kys7IGJyZWFrICAgICAgICAgICAgICAgICAvLyB7CiAgICAgICAgICBjYXNlIDB4N0Q6IGN1cmx5LS07IGJyZWFrICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgfQogICAgICAgIGlmIChjID09PSAweDJmKSB7IC8vIC8KICAgICAgICAgIHZhciBqID0gaSAtIDE7CiAgICAgICAgICB2YXIgcCA9ICh2b2lkIDApOwogICAgICAgICAgLy8gZmluZCBmaXJzdCBub24td2hpdGVzcGFjZSBwcmV2IGNoYXIKICAgICAgICAgIGZvciAoOyBqID49IDA7IGotLSkgewogICAgICAgICAgICBwID0gZXhwLmNoYXJBdChqKTsKICAgICAgICAgICAgaWYgKHAgIT09ICcgJykgeyBicmVhayB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXAgfHwgIXZhbGlkRGl2aXNpb25DaGFyUkUudGVzdChwKSkgewogICAgICAgICAgICBpblJlZ2V4ID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZXhwcmVzc2lvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGV4cHJlc3Npb24gPSBleHAuc2xpY2UoMCwgaSkudHJpbSgpOwogICAgfSBlbHNlIGlmIChsYXN0RmlsdGVySW5kZXggIT09IDApIHsKICAgICAgcHVzaEZpbHRlcigpOwogICAgfQoKICAgIGZ1bmN0aW9uIHB1c2hGaWx0ZXIgKCkgewogICAgICAoZmlsdGVycyB8fCAoZmlsdGVycyA9IFtdKSkucHVzaChleHAuc2xpY2UobGFzdEZpbHRlckluZGV4LCBpKS50cmltKCkpOwogICAgICBsYXN0RmlsdGVySW5kZXggPSBpICsgMTsKICAgIH0KCiAgICBpZiAoZmlsdGVycykgewogICAgICBmb3IgKGkgPSAwOyBpIDwgZmlsdGVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGV4cHJlc3Npb24gPSB3cmFwRmlsdGVyKGV4cHJlc3Npb24sIGZpbHRlcnNbaV0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGV4cHJlc3Npb24KICB9CgogIGZ1bmN0aW9uIHdyYXBGaWx0ZXIgKGV4cCwgZmlsdGVyKSB7CiAgICB2YXIgaSA9IGZpbHRlci5pbmRleE9mKCcoJyk7CiAgICBpZiAoaSA8IDApIHsKICAgICAgLy8gX2Y6IHJlc29sdmVGaWx0ZXIKICAgICAgcmV0dXJuICgiX2YoXCIiICsgZmlsdGVyICsgIlwiKSgiICsgZXhwICsgIikiKQogICAgfSBlbHNlIHsKICAgICAgdmFyIG5hbWUgPSBmaWx0ZXIuc2xpY2UoMCwgaSk7CiAgICAgIHZhciBhcmdzID0gZmlsdGVyLnNsaWNlKGkgKyAxKTsKICAgICAgcmV0dXJuICgiX2YoXCIiICsgbmFtZSArICJcIikoIiArIGV4cCArIChhcmdzICE9PSAnKScgPyAnLCcgKyBhcmdzIDogYXJncykpCiAgICB9CiAgfQoKICAvKiAgKi8KCgoKICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwogIGZ1bmN0aW9uIGJhc2VXYXJuIChtc2csIHJhbmdlKSB7CiAgICBjb25zb2xlLmVycm9yKCgiW1Z1ZSBjb21waWxlcl06ICIgKyBtc2cpKTsKICB9CiAgLyogZXNsaW50LWVuYWJsZSBuby11bnVzZWQtdmFycyAqLwoKICBmdW5jdGlvbiBwbHVja01vZHVsZUZ1bmN0aW9uICgKICAgIG1vZHVsZXMsCiAgICBrZXkKICApIHsKICAgIHJldHVybiBtb2R1bGVzCiAgICAgID8gbW9kdWxlcy5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG1ba2V5XTsgfSkuZmlsdGVyKGZ1bmN0aW9uIChfKSB7IHJldHVybiBfOyB9KQogICAgICA6IFtdCiAgfQoKICBmdW5jdGlvbiBhZGRQcm9wIChlbCwgbmFtZSwgdmFsdWUsIHJhbmdlLCBkeW5hbWljKSB7CiAgICAoZWwucHJvcHMgfHwgKGVsLnByb3BzID0gW10pKS5wdXNoKHJhbmdlU2V0SXRlbSh7IG5hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZSwgZHluYW1pYzogZHluYW1pYyB9LCByYW5nZSkpOwogICAgZWwucGxhaW4gPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIGFkZEF0dHIgKGVsLCBuYW1lLCB2YWx1ZSwgcmFuZ2UsIGR5bmFtaWMpIHsKICAgIHZhciBhdHRycyA9IGR5bmFtaWMKICAgICAgPyAoZWwuZHluYW1pY0F0dHJzIHx8IChlbC5keW5hbWljQXR0cnMgPSBbXSkpCiAgICAgIDogKGVsLmF0dHJzIHx8IChlbC5hdHRycyA9IFtdKSk7CiAgICBhdHRycy5wdXNoKHJhbmdlU2V0SXRlbSh7IG5hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZSwgZHluYW1pYzogZHluYW1pYyB9LCByYW5nZSkpOwogICAgZWwucGxhaW4gPSBmYWxzZTsKICB9CgogIC8vIGFkZCBhIHJhdyBhdHRyICh1c2UgdGhpcyBpbiBwcmVUcmFuc2Zvcm1zKQogIGZ1bmN0aW9uIGFkZFJhd0F0dHIgKGVsLCBuYW1lLCB2YWx1ZSwgcmFuZ2UpIHsKICAgIGVsLmF0dHJzTWFwW25hbWVdID0gdmFsdWU7CiAgICBlbC5hdHRyc0xpc3QucHVzaChyYW5nZVNldEl0ZW0oeyBuYW1lOiBuYW1lLCB2YWx1ZTogdmFsdWUgfSwgcmFuZ2UpKTsKICB9CgogIGZ1bmN0aW9uIGFkZERpcmVjdGl2ZSAoCiAgICBlbCwKICAgIG5hbWUsCiAgICByYXdOYW1lLAogICAgdmFsdWUsCiAgICBhcmcsCiAgICBpc0R5bmFtaWNBcmcsCiAgICBtb2RpZmllcnMsCiAgICByYW5nZQogICkgewogICAgKGVsLmRpcmVjdGl2ZXMgfHwgKGVsLmRpcmVjdGl2ZXMgPSBbXSkpLnB1c2gocmFuZ2VTZXRJdGVtKHsKICAgICAgbmFtZTogbmFtZSwKICAgICAgcmF3TmFtZTogcmF3TmFtZSwKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBhcmc6IGFyZywKICAgICAgaXNEeW5hbWljQXJnOiBpc0R5bmFtaWNBcmcsCiAgICAgIG1vZGlmaWVyczogbW9kaWZpZXJzCiAgICB9LCByYW5nZSkpOwogICAgZWwucGxhaW4gPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHByZXBlbmRNb2RpZmllck1hcmtlciAoc3ltYm9sLCBuYW1lLCBkeW5hbWljKSB7CiAgICByZXR1cm4gZHluYW1pYwogICAgICA/ICgiX3AoIiArIG5hbWUgKyAiLFwiIiArIHN5bWJvbCArICJcIikiKQogICAgICA6IHN5bWJvbCArIG5hbWUgLy8gbWFyayB0aGUgZXZlbnQgYXMgY2FwdHVyZWQKICB9CgogIGZ1bmN0aW9uIGFkZEhhbmRsZXIgKAogICAgZWwsCiAgICBuYW1lLAogICAgdmFsdWUsCiAgICBtb2RpZmllcnMsCiAgICBpbXBvcnRhbnQsCiAgICB3YXJuLAogICAgcmFuZ2UsCiAgICBkeW5hbWljCiAgKSB7CiAgICBtb2RpZmllcnMgPSBtb2RpZmllcnMgfHwgZW1wdHlPYmplY3Q7CiAgICAvLyB3YXJuIHByZXZlbnQgYW5kIHBhc3NpdmUgbW9kaWZpZXIKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKAogICAgICB3YXJuICYmCiAgICAgIG1vZGlmaWVycy5wcmV2ZW50ICYmIG1vZGlmaWVycy5wYXNzaXZlCiAgICApIHsKICAgICAgd2FybigKICAgICAgICAncGFzc2l2ZSBhbmQgcHJldmVudCBjYW5cJ3QgYmUgdXNlZCB0b2dldGhlci4gJyArCiAgICAgICAgJ1Bhc3NpdmUgaGFuZGxlciBjYW5cJ3QgcHJldmVudCBkZWZhdWx0IGV2ZW50LicsCiAgICAgICAgcmFuZ2UKICAgICAgKTsKICAgIH0KCiAgICAvLyBub3JtYWxpemUgY2xpY2sucmlnaHQgYW5kIGNsaWNrLm1pZGRsZSBzaW5jZSB0aGV5IGRvbid0IGFjdHVhbGx5IGZpcmUKICAgIC8vIHRoaXMgaXMgdGVjaG5pY2FsbHkgYnJvd3Nlci1zcGVjaWZpYywgYnV0IGF0IGxlYXN0IGZvciBub3cgYnJvd3NlcnMgYXJlCiAgICAvLyB0aGUgb25seSB0YXJnZXQgZW52cyB0aGF0IGhhdmUgcmlnaHQvbWlkZGxlIGNsaWNrcy4KICAgIGlmIChtb2RpZmllcnMucmlnaHQpIHsKICAgICAgaWYgKGR5bmFtaWMpIHsKICAgICAgICBuYW1lID0gIigiICsgbmFtZSArICIpPT09J2NsaWNrJz8nY29udGV4dG1lbnUnOigiICsgbmFtZSArICIpIjsKICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAnY2xpY2snKSB7CiAgICAgICAgbmFtZSA9ICdjb250ZXh0bWVudSc7CiAgICAgICAgZGVsZXRlIG1vZGlmaWVycy5yaWdodDsKICAgICAgfQogICAgfSBlbHNlIGlmIChtb2RpZmllcnMubWlkZGxlKSB7CiAgICAgIGlmIChkeW5hbWljKSB7CiAgICAgICAgbmFtZSA9ICIoIiArIG5hbWUgKyAiKT09PSdjbGljayc/J21vdXNldXAnOigiICsgbmFtZSArICIpIjsKICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAnY2xpY2snKSB7CiAgICAgICAgbmFtZSA9ICdtb3VzZXVwJzsKICAgICAgfQogICAgfQoKICAgIC8vIGNoZWNrIGNhcHR1cmUgbW9kaWZpZXIKICAgIGlmIChtb2RpZmllcnMuY2FwdHVyZSkgewogICAgICBkZWxldGUgbW9kaWZpZXJzLmNhcHR1cmU7CiAgICAgIG5hbWUgPSBwcmVwZW5kTW9kaWZpZXJNYXJrZXIoJyEnLCBuYW1lLCBkeW5hbWljKTsKICAgIH0KICAgIGlmIChtb2RpZmllcnMub25jZSkgewogICAgICBkZWxldGUgbW9kaWZpZXJzLm9uY2U7CiAgICAgIG5hbWUgPSBwcmVwZW5kTW9kaWZpZXJNYXJrZXIoJ34nLCBuYW1lLCBkeW5hbWljKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKG1vZGlmaWVycy5wYXNzaXZlKSB7CiAgICAgIGRlbGV0ZSBtb2RpZmllcnMucGFzc2l2ZTsKICAgICAgbmFtZSA9IHByZXBlbmRNb2RpZmllck1hcmtlcignJicsIG5hbWUsIGR5bmFtaWMpOwogICAgfQoKICAgIHZhciBldmVudHM7CiAgICBpZiAobW9kaWZpZXJzLm5hdGl2ZSkgewogICAgICBkZWxldGUgbW9kaWZpZXJzLm5hdGl2ZTsKICAgICAgZXZlbnRzID0gZWwubmF0aXZlRXZlbnRzIHx8IChlbC5uYXRpdmVFdmVudHMgPSB7fSk7CiAgICB9IGVsc2UgewogICAgICBldmVudHMgPSBlbC5ldmVudHMgfHwgKGVsLmV2ZW50cyA9IHt9KTsKICAgIH0KCiAgICB2YXIgbmV3SGFuZGxlciA9IHJhbmdlU2V0SXRlbSh7IHZhbHVlOiB2YWx1ZS50cmltKCksIGR5bmFtaWM6IGR5bmFtaWMgfSwgcmFuZ2UpOwogICAgaWYgKG1vZGlmaWVycyAhPT0gZW1wdHlPYmplY3QpIHsKICAgICAgbmV3SGFuZGxlci5tb2RpZmllcnMgPSBtb2RpZmllcnM7CiAgICB9CgogICAgdmFyIGhhbmRsZXJzID0gZXZlbnRzW25hbWVdOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoQXJyYXkuaXNBcnJheShoYW5kbGVycykpIHsKICAgICAgaW1wb3J0YW50ID8gaGFuZGxlcnMudW5zaGlmdChuZXdIYW5kbGVyKSA6IGhhbmRsZXJzLnB1c2gobmV3SGFuZGxlcik7CiAgICB9IGVsc2UgaWYgKGhhbmRsZXJzKSB7CiAgICAgIGV2ZW50c1tuYW1lXSA9IGltcG9ydGFudCA/IFtuZXdIYW5kbGVyLCBoYW5kbGVyc10gOiBbaGFuZGxlcnMsIG5ld0hhbmRsZXJdOwogICAgfSBlbHNlIHsKICAgICAgZXZlbnRzW25hbWVdID0gbmV3SGFuZGxlcjsKICAgIH0KCiAgICBlbC5wbGFpbiA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gZ2V0UmF3QmluZGluZ0F0dHIgKAogICAgZWwsCiAgICBuYW1lCiAgKSB7CiAgICByZXR1cm4gZWwucmF3QXR0cnNNYXBbJzonICsgbmFtZV0gfHwKICAgICAgZWwucmF3QXR0cnNNYXBbJ3YtYmluZDonICsgbmFtZV0gfHwKICAgICAgZWwucmF3QXR0cnNNYXBbbmFtZV0KICB9CgogIGZ1bmN0aW9uIGdldEJpbmRpbmdBdHRyICgKICAgIGVsLAogICAgbmFtZSwKICAgIGdldFN0YXRpYwogICkgewogICAgdmFyIGR5bmFtaWNWYWx1ZSA9CiAgICAgIGdldEFuZFJlbW92ZUF0dHIoZWwsICc6JyArIG5hbWUpIHx8CiAgICAgIGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LWJpbmQ6JyArIG5hbWUpOwogICAgaWYgKGR5bmFtaWNWYWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBwYXJzZUZpbHRlcnMoZHluYW1pY1ZhbHVlKQogICAgfSBlbHNlIGlmIChnZXRTdGF0aWMgIT09IGZhbHNlKSB7CiAgICAgIHZhciBzdGF0aWNWYWx1ZSA9IGdldEFuZFJlbW92ZUF0dHIoZWwsIG5hbWUpOwogICAgICBpZiAoc3RhdGljVmFsdWUgIT0gbnVsbCkgewogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShzdGF0aWNWYWx1ZSkKICAgICAgfQogICAgfQogIH0KCiAgLy8gbm90ZTogdGhpcyBvbmx5IHJlbW92ZXMgdGhlIGF0dHIgZnJvbSB0aGUgQXJyYXkgKGF0dHJzTGlzdCkgc28gdGhhdCBpdAogIC8vIGRvZXNuJ3QgZ2V0IHByb2Nlc3NlZCBieSBwcm9jZXNzQXR0cnMuCiAgLy8gQnkgZGVmYXVsdCBpdCBkb2VzIE5PVCByZW1vdmUgaXQgZnJvbSB0aGUgbWFwIChhdHRyc01hcCkgYmVjYXVzZSB0aGUgbWFwIGlzCiAgLy8gbmVlZGVkIGR1cmluZyBjb2RlZ2VuLgogIGZ1bmN0aW9uIGdldEFuZFJlbW92ZUF0dHIgKAogICAgZWwsCiAgICBuYW1lLAogICAgcmVtb3ZlRnJvbU1hcAogICkgewogICAgdmFyIHZhbDsKICAgIGlmICgodmFsID0gZWwuYXR0cnNNYXBbbmFtZV0pICE9IG51bGwpIHsKICAgICAgdmFyIGxpc3QgPSBlbC5hdHRyc0xpc3Q7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBpZiAobGlzdFtpXS5uYW1lID09PSBuYW1lKSB7CiAgICAgICAgICBsaXN0LnNwbGljZShpLCAxKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAocmVtb3ZlRnJvbU1hcCkgewogICAgICBkZWxldGUgZWwuYXR0cnNNYXBbbmFtZV07CiAgICB9CiAgICByZXR1cm4gdmFsCiAgfQoKICBmdW5jdGlvbiBnZXRBbmRSZW1vdmVBdHRyQnlSZWdleCAoCiAgICBlbCwKICAgIG5hbWUKICApIHsKICAgIHZhciBsaXN0ID0gZWwuYXR0cnNMaXN0OwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBsaXN0Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIgYXR0ciA9IGxpc3RbaV07CiAgICAgIGlmIChuYW1lLnRlc3QoYXR0ci5uYW1lKSkgewogICAgICAgIGxpc3Quc3BsaWNlKGksIDEpOwogICAgICAgIHJldHVybiBhdHRyCiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHJhbmdlU2V0SXRlbSAoCiAgICBpdGVtLAogICAgcmFuZ2UKICApIHsKICAgIGlmIChyYW5nZSkgewogICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gbnVsbCkgewogICAgICAgIGl0ZW0uc3RhcnQgPSByYW5nZS5zdGFydDsKICAgICAgfQogICAgICBpZiAocmFuZ2UuZW5kICE9IG51bGwpIHsKICAgICAgICBpdGVtLmVuZCA9IHJhbmdlLmVuZDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGl0ZW0KICB9CgogIC8qICAqLwoKICAvKioKICAgKiBDcm9zcy1wbGF0Zm9ybSBjb2RlIGdlbmVyYXRpb24gZm9yIGNvbXBvbmVudCB2LW1vZGVsCiAgICovCiAgZnVuY3Rpb24gZ2VuQ29tcG9uZW50TW9kZWwgKAogICAgZWwsCiAgICB2YWx1ZSwKICAgIG1vZGlmaWVycwogICkgewogICAgdmFyIHJlZiA9IG1vZGlmaWVycyB8fCB7fTsKICAgIHZhciBudW1iZXIgPSByZWYubnVtYmVyOwogICAgdmFyIHRyaW0gPSByZWYudHJpbTsKCiAgICB2YXIgYmFzZVZhbHVlRXhwcmVzc2lvbiA9ICckJHYnOwogICAgdmFyIHZhbHVlRXhwcmVzc2lvbiA9IGJhc2VWYWx1ZUV4cHJlc3Npb247CiAgICBpZiAodHJpbSkgewogICAgICB2YWx1ZUV4cHJlc3Npb24gPQogICAgICAgICIodHlwZW9mICIgKyBiYXNlVmFsdWVFeHByZXNzaW9uICsgIiA9PT0gJ3N0cmluZyciICsKICAgICAgICAiPyAiICsgYmFzZVZhbHVlRXhwcmVzc2lvbiArICIudHJpbSgpIiArCiAgICAgICAgIjogIiArIGJhc2VWYWx1ZUV4cHJlc3Npb24gKyAiKSI7CiAgICB9CiAgICBpZiAobnVtYmVyKSB7CiAgICAgIHZhbHVlRXhwcmVzc2lvbiA9ICJfbigiICsgdmFsdWVFeHByZXNzaW9uICsgIikiOwogICAgfQogICAgdmFyIGFzc2lnbm1lbnQgPSBnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgdmFsdWVFeHByZXNzaW9uKTsKCiAgICBlbC5tb2RlbCA9IHsKICAgICAgdmFsdWU6ICgiKCIgKyB2YWx1ZSArICIpIiksCiAgICAgIGV4cHJlc3Npb246IEpTT04uc3RyaW5naWZ5KHZhbHVlKSwKICAgICAgY2FsbGJhY2s6ICgiZnVuY3Rpb24gKCIgKyBiYXNlVmFsdWVFeHByZXNzaW9uICsgIikgeyIgKyBhc3NpZ25tZW50ICsgIn0iKQogICAgfTsKICB9CgogIC8qKgogICAqIENyb3NzLXBsYXRmb3JtIGNvZGVnZW4gaGVscGVyIGZvciBnZW5lcmF0aW5nIHYtbW9kZWwgdmFsdWUgYXNzaWdubWVudCBjb2RlLgogICAqLwogIGZ1bmN0aW9uIGdlbkFzc2lnbm1lbnRDb2RlICgKICAgIHZhbHVlLAogICAgYXNzaWdubWVudAogICkgewogICAgdmFyIHJlcyA9IHBhcnNlTW9kZWwodmFsdWUpOwogICAgaWYgKHJlcy5rZXkgPT09IG51bGwpIHsKICAgICAgcmV0dXJuICh2YWx1ZSArICI9IiArIGFzc2lnbm1lbnQpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gKCIkc2V0KCIgKyAocmVzLmV4cCkgKyAiLCAiICsgKHJlcy5rZXkpICsgIiwgIiArIGFzc2lnbm1lbnQgKyAiKSIpCiAgICB9CiAgfQoKICAvKioKICAgKiBQYXJzZSBhIHYtbW9kZWwgZXhwcmVzc2lvbiBpbnRvIGEgYmFzZSBwYXRoIGFuZCBhIGZpbmFsIGtleSBzZWdtZW50LgogICAqIEhhbmRsZXMgYm90aCBkb3QtcGF0aCBhbmQgcG9zc2libGUgc3F1YXJlIGJyYWNrZXRzLgogICAqCiAgICogUG9zc2libGUgY2FzZXM6CiAgICoKICAgKiAtIHRlc3QKICAgKiAtIHRlc3Rba2V5XQogICAqIC0gdGVzdFt0ZXN0MVtrZXldXQogICAqIC0gdGVzdFsiYSJdW2tleV0KICAgKiAtIHh4eC50ZXN0W2FbYV0udGVzdDFba2V5XV0KICAgKiAtIHRlc3QueHh4LmFbImFzYSJdW3Rlc3QxW2tleV1dCiAgICoKICAgKi8KCiAgdmFyIGxlbiwgc3RyLCBjaHIsIGluZGV4JDEsIGV4cHJlc3Npb25Qb3MsIGV4cHJlc3Npb25FbmRQb3M7CgoKCiAgZnVuY3Rpb24gcGFyc2VNb2RlbCAodmFsKSB7CiAgICAvLyBGaXggaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS9wdWxsLzc3MzAKICAgIC8vIGFsbG93IHYtbW9kZWw9Im9iai52YWwgIiAodHJhaWxpbmcgd2hpdGVzcGFjZSkKICAgIHZhbCA9IHZhbC50cmltKCk7CiAgICBsZW4gPSB2YWwubGVuZ3RoOwoKICAgIGlmICh2YWwuaW5kZXhPZignWycpIDwgMCB8fCB2YWwubGFzdEluZGV4T2YoJ10nKSA8IGxlbiAtIDEpIHsKICAgICAgaW5kZXgkMSA9IHZhbC5sYXN0SW5kZXhPZignLicpOwogICAgICBpZiAoaW5kZXgkMSA+IC0xKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGV4cDogdmFsLnNsaWNlKDAsIGluZGV4JDEpLAogICAgICAgICAga2V5OiAnIicgKyB2YWwuc2xpY2UoaW5kZXgkMSArIDEpICsgJyInCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBleHA6IHZhbCwKICAgICAgICAgIGtleTogbnVsbAogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHN0ciA9IHZhbDsKICAgIGluZGV4JDEgPSBleHByZXNzaW9uUG9zID0gZXhwcmVzc2lvbkVuZFBvcyA9IDA7CgogICAgd2hpbGUgKCFlb2YoKSkgewogICAgICBjaHIgPSBuZXh0KCk7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoaXNTdHJpbmdTdGFydChjaHIpKSB7CiAgICAgICAgcGFyc2VTdHJpbmcoY2hyKTsKICAgICAgfSBlbHNlIGlmIChjaHIgPT09IDB4NUIpIHsKICAgICAgICBwYXJzZUJyYWNrZXQoY2hyKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGV4cDogdmFsLnNsaWNlKDAsIGV4cHJlc3Npb25Qb3MpLAogICAgICBrZXk6IHZhbC5zbGljZShleHByZXNzaW9uUG9zICsgMSwgZXhwcmVzc2lvbkVuZFBvcykKICAgIH0KICB9CgogIGZ1bmN0aW9uIG5leHQgKCkgewogICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KCsraW5kZXgkMSkKICB9CgogIGZ1bmN0aW9uIGVvZiAoKSB7CiAgICByZXR1cm4gaW5kZXgkMSA+PSBsZW4KICB9CgogIGZ1bmN0aW9uIGlzU3RyaW5nU3RhcnQgKGNocikgewogICAgcmV0dXJuIGNociA9PT0gMHgyMiB8fCBjaHIgPT09IDB4MjcKICB9CgogIGZ1bmN0aW9uIHBhcnNlQnJhY2tldCAoY2hyKSB7CiAgICB2YXIgaW5CcmFja2V0ID0gMTsKICAgIGV4cHJlc3Npb25Qb3MgPSBpbmRleCQxOwogICAgd2hpbGUgKCFlb2YoKSkgewogICAgICBjaHIgPSBuZXh0KCk7CiAgICAgIGlmIChpc1N0cmluZ1N0YXJ0KGNocikpIHsKICAgICAgICBwYXJzZVN0cmluZyhjaHIpOwogICAgICAgIGNvbnRpbnVlCiAgICAgIH0KICAgICAgaWYgKGNociA9PT0gMHg1QikgeyBpbkJyYWNrZXQrKzsgfQogICAgICBpZiAoY2hyID09PSAweDVEKSB7IGluQnJhY2tldC0tOyB9CiAgICAgIGlmIChpbkJyYWNrZXQgPT09IDApIHsKICAgICAgICBleHByZXNzaW9uRW5kUG9zID0gaW5kZXgkMTsKICAgICAgICBicmVhawogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwYXJzZVN0cmluZyAoY2hyKSB7CiAgICB2YXIgc3RyaW5nUXVvdGUgPSBjaHI7CiAgICB3aGlsZSAoIWVvZigpKSB7CiAgICAgIGNociA9IG5leHQoKTsKICAgICAgaWYgKGNociA9PT0gc3RyaW5nUXVvdGUpIHsKICAgICAgICBicmVhawogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIHdhcm4kMTsKCiAgLy8gaW4gc29tZSBjYXNlcywgdGhlIGV2ZW50IHVzZWQgaGFzIHRvIGJlIGRldGVybWluZWQgYXQgcnVudGltZQogIC8vIHNvIHdlIHVzZWQgc29tZSByZXNlcnZlZCB0b2tlbnMgZHVyaW5nIGNvbXBpbGUuCiAgdmFyIFJBTkdFX1RPS0VOID0gJ19fcic7CiAgdmFyIENIRUNLQk9YX1JBRElPX1RPS0VOID0gJ19fYyc7CgogIGZ1bmN0aW9uIG1vZGVsICgKICAgIGVsLAogICAgZGlyLAogICAgX3dhcm4KICApIHsKICAgIHdhcm4kMSA9IF93YXJuOwogICAgdmFyIHZhbHVlID0gZGlyLnZhbHVlOwogICAgdmFyIG1vZGlmaWVycyA9IGRpci5tb2RpZmllcnM7CiAgICB2YXIgdGFnID0gZWwudGFnOwogICAgdmFyIHR5cGUgPSBlbC5hdHRyc01hcC50eXBlOwoKICAgIHsKICAgICAgLy8gaW5wdXRzIHdpdGggdHlwZT0iZmlsZSIgYXJlIHJlYWQgb25seSBhbmQgc2V0dGluZyB0aGUgaW5wdXQncwogICAgICAvLyB2YWx1ZSB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICBpZiAodGFnID09PSAnaW5wdXQnICYmIHR5cGUgPT09ICdmaWxlJykgewogICAgICAgIHdhcm4kMSgKICAgICAgICAgICI8IiArIChlbC50YWcpICsgIiB2LW1vZGVsPVwiIiArIHZhbHVlICsgIlwiIHR5cGU9XCJmaWxlXCI+OlxuIiArCiAgICAgICAgICAiRmlsZSBpbnB1dHMgYXJlIHJlYWQgb25seS4gVXNlIGEgdi1vbjpjaGFuZ2UgbGlzdGVuZXIgaW5zdGVhZC4iLAogICAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3YtbW9kZWwnXQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZWwuY29tcG9uZW50KSB7CiAgICAgIGdlbkNvbXBvbmVudE1vZGVsKGVsLCB2YWx1ZSwgbW9kaWZpZXJzKTsKICAgICAgLy8gY29tcG9uZW50IHYtbW9kZWwgZG9lc24ndCBuZWVkIGV4dHJhIHJ1bnRpbWUKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9IGVsc2UgaWYgKHRhZyA9PT0gJ3NlbGVjdCcpIHsKICAgICAgZ2VuU2VsZWN0KGVsLCB2YWx1ZSwgbW9kaWZpZXJzKTsKICAgIH0gZWxzZSBpZiAodGFnID09PSAnaW5wdXQnICYmIHR5cGUgPT09ICdjaGVja2JveCcpIHsKICAgICAgZ2VuQ2hlY2tib3hNb2RlbChlbCwgdmFsdWUsIG1vZGlmaWVycyk7CiAgICB9IGVsc2UgaWYgKHRhZyA9PT0gJ2lucHV0JyAmJiB0eXBlID09PSAncmFkaW8nKSB7CiAgICAgIGdlblJhZGlvTW9kZWwoZWwsIHZhbHVlLCBtb2RpZmllcnMpOwogICAgfSBlbHNlIGlmICh0YWcgPT09ICdpbnB1dCcgfHwgdGFnID09PSAndGV4dGFyZWEnKSB7CiAgICAgIGdlbkRlZmF1bHRNb2RlbChlbCwgdmFsdWUsIG1vZGlmaWVycyk7CiAgICB9IGVsc2UgaWYgKCFjb25maWcuaXNSZXNlcnZlZFRhZyh0YWcpKSB7CiAgICAgIGdlbkNvbXBvbmVudE1vZGVsKGVsLCB2YWx1ZSwgbW9kaWZpZXJzKTsKICAgICAgLy8gY29tcG9uZW50IHYtbW9kZWwgZG9lc24ndCBuZWVkIGV4dHJhIHJ1bnRpbWUKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9IGVsc2UgewogICAgICB3YXJuJDEoCiAgICAgICAgIjwiICsgKGVsLnRhZykgKyAiIHYtbW9kZWw9XCIiICsgdmFsdWUgKyAiXCI+OiAiICsKICAgICAgICAidi1tb2RlbCBpcyBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgZWxlbWVudCB0eXBlLiAiICsKICAgICAgICAnSWYgeW91IGFyZSB3b3JraW5nIHdpdGggY29udGVudGVkaXRhYmxlLCBpdFwncyByZWNvbW1lbmRlZCB0byAnICsKICAgICAgICAnd3JhcCBhIGxpYnJhcnkgZGVkaWNhdGVkIGZvciB0aGF0IHB1cnBvc2UgaW5zaWRlIGEgY3VzdG9tIGNvbXBvbmVudC4nLAogICAgICAgIGVsLnJhd0F0dHJzTWFwWyd2LW1vZGVsJ10KICAgICAgKTsKICAgIH0KCiAgICAvLyBlbnN1cmUgcnVudGltZSBkaXJlY3RpdmUgbWV0YWRhdGEKICAgIHJldHVybiB0cnVlCiAgfQoKICBmdW5jdGlvbiBnZW5DaGVja2JveE1vZGVsICgKICAgIGVsLAogICAgdmFsdWUsCiAgICBtb2RpZmllcnMKICApIHsKICAgIHZhciBudW1iZXIgPSBtb2RpZmllcnMgJiYgbW9kaWZpZXJzLm51bWJlcjsKICAgIHZhciB2YWx1ZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3ZhbHVlJykgfHwgJ251bGwnOwogICAgdmFyIHRydWVWYWx1ZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3RydWUtdmFsdWUnKSB8fCAndHJ1ZSc7CiAgICB2YXIgZmFsc2VWYWx1ZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ2ZhbHNlLXZhbHVlJykgfHwgJ2ZhbHNlJzsKICAgIGFkZFByb3AoZWwsICdjaGVja2VkJywKICAgICAgIkFycmF5LmlzQXJyYXkoIiArIHZhbHVlICsgIikiICsKICAgICAgIj9faSgiICsgdmFsdWUgKyAiLCIgKyB2YWx1ZUJpbmRpbmcgKyAiKT4tMSIgKyAoCiAgICAgICAgdHJ1ZVZhbHVlQmluZGluZyA9PT0gJ3RydWUnCiAgICAgICAgICA/ICgiOigiICsgdmFsdWUgKyAiKSIpCiAgICAgICAgICA6ICgiOl9xKCIgKyB2YWx1ZSArICIsIiArIHRydWVWYWx1ZUJpbmRpbmcgKyAiKSIpCiAgICAgICkKICAgICk7CiAgICBhZGRIYW5kbGVyKGVsLCAnY2hhbmdlJywKICAgICAgInZhciAkJGE9IiArIHZhbHVlICsgIiwiICsKICAgICAgICAgICckJGVsPSRldmVudC50YXJnZXQsJyArCiAgICAgICAgICAiJCRjPSQkZWwuY2hlY2tlZD8oIiArIHRydWVWYWx1ZUJpbmRpbmcgKyAiKTooIiArIGZhbHNlVmFsdWVCaW5kaW5nICsgIik7IiArCiAgICAgICdpZihBcnJheS5pc0FycmF5KCQkYSkpeycgKwogICAgICAgICJ2YXIgJCR2PSIgKyAobnVtYmVyID8gJ19uKCcgKyB2YWx1ZUJpbmRpbmcgKyAnKScgOiB2YWx1ZUJpbmRpbmcpICsgIiwiICsKICAgICAgICAgICAgJyQkaT1faSgkJGEsJCR2KTsnICsKICAgICAgICAiaWYoJCRlbC5jaGVja2VkKXskJGk8MCYmKCIgKyAoZ2VuQXNzaWdubWVudENvZGUodmFsdWUsICckJGEuY29uY2F0KFskJHZdKScpKSArICIpfSIgKwogICAgICAgICJlbHNleyQkaT4tMSYmKCIgKyAoZ2VuQXNzaWdubWVudENvZGUodmFsdWUsICckJGEuc2xpY2UoMCwkJGkpLmNvbmNhdCgkJGEuc2xpY2UoJCRpKzEpKScpKSArICIpfSIgKwogICAgICAifWVsc2V7IiArIChnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgJyQkYycpKSArICJ9IiwKICAgICAgbnVsbCwgdHJ1ZQogICAgKTsKICB9CgogIGZ1bmN0aW9uIGdlblJhZGlvTW9kZWwgKAogICAgZWwsCiAgICB2YWx1ZSwKICAgIG1vZGlmaWVycwogICkgewogICAgdmFyIG51bWJlciA9IG1vZGlmaWVycyAmJiBtb2RpZmllcnMubnVtYmVyOwogICAgdmFyIHZhbHVlQmluZGluZyA9IGdldEJpbmRpbmdBdHRyKGVsLCAndmFsdWUnKSB8fCAnbnVsbCc7CiAgICB2YWx1ZUJpbmRpbmcgPSBudW1iZXIgPyAoIl9uKCIgKyB2YWx1ZUJpbmRpbmcgKyAiKSIpIDogdmFsdWVCaW5kaW5nOwogICAgYWRkUHJvcChlbCwgJ2NoZWNrZWQnLCAoIl9xKCIgKyB2YWx1ZSArICIsIiArIHZhbHVlQmluZGluZyArICIpIikpOwogICAgYWRkSGFuZGxlcihlbCwgJ2NoYW5nZScsIGdlbkFzc2lnbm1lbnRDb2RlKHZhbHVlLCB2YWx1ZUJpbmRpbmcpLCBudWxsLCB0cnVlKTsKICB9CgogIGZ1bmN0aW9uIGdlblNlbGVjdCAoCiAgICBlbCwKICAgIHZhbHVlLAogICAgbW9kaWZpZXJzCiAgKSB7CiAgICB2YXIgbnVtYmVyID0gbW9kaWZpZXJzICYmIG1vZGlmaWVycy5udW1iZXI7CiAgICB2YXIgc2VsZWN0ZWRWYWwgPSAiQXJyYXkucHJvdG90eXBlLmZpbHRlciIgKwogICAgICAiLmNhbGwoJGV2ZW50LnRhcmdldC5vcHRpb25zLGZ1bmN0aW9uKG8pe3JldHVybiBvLnNlbGVjdGVkfSkiICsKICAgICAgIi5tYXAoZnVuY3Rpb24obyl7dmFyIHZhbCA9IFwiX3ZhbHVlXCIgaW4gbyA/IG8uX3ZhbHVlIDogby52YWx1ZTsiICsKICAgICAgInJldHVybiAiICsgKG51bWJlciA/ICdfbih2YWwpJyA6ICd2YWwnKSArICJ9KSI7CgogICAgdmFyIGFzc2lnbm1lbnQgPSAnJGV2ZW50LnRhcmdldC5tdWx0aXBsZSA/ICQkc2VsZWN0ZWRWYWwgOiAkJHNlbGVjdGVkVmFsWzBdJzsKICAgIHZhciBjb2RlID0gInZhciAkJHNlbGVjdGVkVmFsID0gIiArIHNlbGVjdGVkVmFsICsgIjsiOwogICAgY29kZSA9IGNvZGUgKyAiICIgKyAoZ2VuQXNzaWdubWVudENvZGUodmFsdWUsIGFzc2lnbm1lbnQpKTsKICAgIGFkZEhhbmRsZXIoZWwsICdjaGFuZ2UnLCBjb2RlLCBudWxsLCB0cnVlKTsKICB9CgogIGZ1bmN0aW9uIGdlbkRlZmF1bHRNb2RlbCAoCiAgICBlbCwKICAgIHZhbHVlLAogICAgbW9kaWZpZXJzCiAgKSB7CiAgICB2YXIgdHlwZSA9IGVsLmF0dHJzTWFwLnR5cGU7CgogICAgLy8gd2FybiBpZiB2LWJpbmQ6dmFsdWUgY29uZmxpY3RzIHdpdGggdi1tb2RlbAogICAgLy8gZXhjZXB0IGZvciBpbnB1dHMgd2l0aCB2LWJpbmQ6dHlwZQogICAgewogICAgICB2YXIgdmFsdWUkMSA9IGVsLmF0dHJzTWFwWyd2LWJpbmQ6dmFsdWUnXSB8fCBlbC5hdHRyc01hcFsnOnZhbHVlJ107CiAgICAgIHZhciB0eXBlQmluZGluZyA9IGVsLmF0dHJzTWFwWyd2LWJpbmQ6dHlwZSddIHx8IGVsLmF0dHJzTWFwWyc6dHlwZSddOwogICAgICBpZiAodmFsdWUkMSAmJiAhdHlwZUJpbmRpbmcpIHsKICAgICAgICB2YXIgYmluZGluZyA9IGVsLmF0dHJzTWFwWyd2LWJpbmQ6dmFsdWUnXSA/ICd2LWJpbmQ6dmFsdWUnIDogJzp2YWx1ZSc7CiAgICAgICAgd2FybiQxKAogICAgICAgICAgYmluZGluZyArICI9XCIiICsgdmFsdWUkMSArICJcIiBjb25mbGljdHMgd2l0aCB2LW1vZGVsIG9uIHRoZSBzYW1lIGVsZW1lbnQgIiArCiAgICAgICAgICAnYmVjYXVzZSB0aGUgbGF0dGVyIGFscmVhZHkgZXhwYW5kcyB0byBhIHZhbHVlIGJpbmRpbmcgaW50ZXJuYWxseScsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFtiaW5kaW5nXQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgcmVmID0gbW9kaWZpZXJzIHx8IHt9OwogICAgdmFyIGxhenkgPSByZWYubGF6eTsKICAgIHZhciBudW1iZXIgPSByZWYubnVtYmVyOwogICAgdmFyIHRyaW0gPSByZWYudHJpbTsKICAgIHZhciBuZWVkQ29tcG9zaXRpb25HdWFyZCA9ICFsYXp5ICYmIHR5cGUgIT09ICdyYW5nZSc7CiAgICB2YXIgZXZlbnQgPSBsYXp5CiAgICAgID8gJ2NoYW5nZScKICAgICAgOiB0eXBlID09PSAncmFuZ2UnCiAgICAgICAgPyBSQU5HRV9UT0tFTgogICAgICAgIDogJ2lucHV0JzsKCiAgICB2YXIgdmFsdWVFeHByZXNzaW9uID0gJyRldmVudC50YXJnZXQudmFsdWUnOwogICAgaWYgKHRyaW0pIHsKICAgICAgdmFsdWVFeHByZXNzaW9uID0gIiRldmVudC50YXJnZXQudmFsdWUudHJpbSgpIjsKICAgIH0KICAgIGlmIChudW1iZXIpIHsKICAgICAgdmFsdWVFeHByZXNzaW9uID0gIl9uKCIgKyB2YWx1ZUV4cHJlc3Npb24gKyAiKSI7CiAgICB9CgogICAgdmFyIGNvZGUgPSBnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgdmFsdWVFeHByZXNzaW9uKTsKICAgIGlmIChuZWVkQ29tcG9zaXRpb25HdWFyZCkgewogICAgICBjb2RlID0gImlmKCRldmVudC50YXJnZXQuY29tcG9zaW5nKXJldHVybjsiICsgY29kZTsKICAgIH0KCiAgICBhZGRQcm9wKGVsLCAndmFsdWUnLCAoIigiICsgdmFsdWUgKyAiKSIpKTsKICAgIGFkZEhhbmRsZXIoZWwsIGV2ZW50LCBjb2RlLCBudWxsLCB0cnVlKTsKICAgIGlmICh0cmltIHx8IG51bWJlcikgewogICAgICBhZGRIYW5kbGVyKGVsLCAnYmx1cicsICckZm9yY2VVcGRhdGUoKScpOwogICAgfQogIH0KCiAgLyogICovCgogIC8vIG5vcm1hbGl6ZSB2LW1vZGVsIGV2ZW50IHRva2VucyB0aGF0IGNhbiBvbmx5IGJlIGRldGVybWluZWQgYXQgcnVudGltZS4KICAvLyBpdCdzIGltcG9ydGFudCB0byBwbGFjZSB0aGUgZXZlbnQgYXMgdGhlIGZpcnN0IGluIHRoZSBhcnJheSBiZWNhdXNlCiAgLy8gdGhlIHdob2xlIHBvaW50IGlzIGVuc3VyaW5nIHRoZSB2LW1vZGVsIGNhbGxiYWNrIGdldHMgY2FsbGVkIGJlZm9yZQogIC8vIHVzZXItYXR0YWNoZWQgaGFuZGxlcnMuCiAgZnVuY3Rpb24gbm9ybWFsaXplRXZlbnRzIChvbikgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNEZWYob25bUkFOR0VfVE9LRU5dKSkgewogICAgICAvLyBJRSBpbnB1dFt0eXBlPXJhbmdlXSBvbmx5IHN1cHBvcnRzIGBjaGFuZ2VgIGV2ZW50CiAgICAgIHZhciBldmVudCA9IGlzSUUgPyAnY2hhbmdlJyA6ICdpbnB1dCc7CiAgICAgIG9uW2V2ZW50XSA9IFtdLmNvbmNhdChvbltSQU5HRV9UT0tFTl0sIG9uW2V2ZW50XSB8fCBbXSk7CiAgICAgIGRlbGV0ZSBvbltSQU5HRV9UT0tFTl07CiAgICB9CiAgICAvLyBUaGlzIHdhcyBvcmlnaW5hbGx5IGludGVuZGVkIHRvIGZpeCAjNDUyMSBidXQgbm8gbG9uZ2VyIG5lY2Vzc2FyeQogICAgLy8gYWZ0ZXIgMi41LiBLZWVwaW5nIGl0IGZvciBiYWNrd2FyZHMgY29tcGF0IHdpdGggZ2VuZXJhdGVkIGNvZGUgZnJvbSA8IDIuNAogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNEZWYob25bQ0hFQ0tCT1hfUkFESU9fVE9LRU5dKSkgewogICAgICBvbi5jaGFuZ2UgPSBbXS5jb25jYXQob25bQ0hFQ0tCT1hfUkFESU9fVE9LRU5dLCBvbi5jaGFuZ2UgfHwgW10pOwogICAgICBkZWxldGUgb25bQ0hFQ0tCT1hfUkFESU9fVE9LRU5dOwogICAgfQogIH0KCiAgdmFyIHRhcmdldCQxOwoKICBmdW5jdGlvbiBjcmVhdGVPbmNlSGFuZGxlciQxIChldmVudCwgaGFuZGxlciwgY2FwdHVyZSkgewogICAgdmFyIF90YXJnZXQgPSB0YXJnZXQkMTsgLy8gc2F2ZSBjdXJyZW50IHRhcmdldCBlbGVtZW50IGluIGNsb3N1cmUKICAgIHJldHVybiBmdW5jdGlvbiBvbmNlSGFuZGxlciAoKSB7CiAgICAgIHZhciByZXMgPSBoYW5kbGVyLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICAgIGlmIChyZXMgIT09IG51bGwpIHsKICAgICAgICByZW1vdmUkMihldmVudCwgb25jZUhhbmRsZXIsIGNhcHR1cmUsIF90YXJnZXQpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyAjOTQ0NjogRmlyZWZveCA8PSA1MyAoaW4gcGFydGljdWxhciwgRVNSIDUyKSBoYXMgaW5jb3JyZWN0IEV2ZW50LnRpbWVTdGFtcAogIC8vIGltcGxlbWVudGF0aW9uIGFuZCBkb2VzIG5vdCBmaXJlIG1pY3JvdGFza3MgaW4gYmV0d2VlbiBldmVudCBwcm9wYWdhdGlvbiwgc28KICAvLyBzYWZlIHRvIGV4Y2x1ZGUuCiAgdmFyIHVzZU1pY3JvdGFza0ZpeCA9IGlzVXNpbmdNaWNyb1Rhc2sgJiYgIShpc0ZGICYmIE51bWJlcihpc0ZGWzFdKSA8PSA1Myk7CgogIGZ1bmN0aW9uIGFkZCQxICgKICAgIG5hbWUsCiAgICBoYW5kbGVyLAogICAgY2FwdHVyZSwKICAgIHBhc3NpdmUKICApIHsKICAgIC8vIGFzeW5jIGVkZ2UgY2FzZSAjNjU2NjogaW5uZXIgY2xpY2sgZXZlbnQgdHJpZ2dlcnMgcGF0Y2gsIGV2ZW50IGhhbmRsZXIKICAgIC8vIGF0dGFjaGVkIHRvIG91dGVyIGVsZW1lbnQgZHVyaW5nIHBhdGNoLCBhbmQgdHJpZ2dlcmVkIGFnYWluLiBUaGlzCiAgICAvLyBoYXBwZW5zIGJlY2F1c2UgYnJvd3NlcnMgZmlyZSBtaWNyb3Rhc2sgdGlja3MgYmV0d2VlbiBldmVudCBwcm9wYWdhdGlvbi4KICAgIC8vIHRoZSBzb2x1dGlvbiBpcyBzaW1wbGU6IHdlIHNhdmUgdGhlIHRpbWVzdGFtcCB3aGVuIGEgaGFuZGxlciBpcyBhdHRhY2hlZCwKICAgIC8vIGFuZCB0aGUgaGFuZGxlciB3b3VsZCBvbmx5IGZpcmUgaWYgdGhlIGV2ZW50IHBhc3NlZCB0byBpdCB3YXMgZmlyZWQKICAgIC8vIEFGVEVSIGl0IHdhcyBhdHRhY2hlZC4KICAgIGlmICh1c2VNaWNyb3Rhc2tGaXgpIHsKICAgICAgdmFyIGF0dGFjaGVkVGltZXN0YW1wID0gY3VycmVudEZsdXNoVGltZXN0YW1wOwogICAgICB2YXIgb3JpZ2luYWwgPSBoYW5kbGVyOwogICAgICBoYW5kbGVyID0gb3JpZ2luYWwuX3dyYXBwZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICgKICAgICAgICAgIC8vIG5vIGJ1YmJsaW5nLCBzaG91bGQgYWx3YXlzIGZpcmUuCiAgICAgICAgICAvLyB0aGlzIGlzIGp1c3QgYSBzYWZldHkgbmV0IGluIGNhc2UgZXZlbnQudGltZVN0YW1wIGlzIHVucmVsaWFibGUgaW4KICAgICAgICAgIC8vIGNlcnRhaW4gd2VpcmQgZW52aXJvbm1lbnRzLi4uCiAgICAgICAgICBlLnRhcmdldCA9PT0gZS5jdXJyZW50VGFyZ2V0IHx8CiAgICAgICAgICAvLyBldmVudCBpcyBmaXJlZCBhZnRlciBoYW5kbGVyIGF0dGFjaG1lbnQKICAgICAgICAgIGUudGltZVN0YW1wID49IGF0dGFjaGVkVGltZXN0YW1wIHx8CiAgICAgICAgICAvLyBiYWlsIGZvciBlbnZpcm9ubWVudHMgdGhhdCBoYXZlIGJ1Z2d5IGV2ZW50LnRpbWVTdGFtcCBpbXBsZW1lbnRhdGlvbnMKICAgICAgICAgIC8vICM5NDYyIGlPUyA5IGJ1ZzogZXZlbnQudGltZVN0YW1wIGlzIDAgYWZ0ZXIgaGlzdG9yeS5wdXNoU3RhdGUKICAgICAgICAgIC8vICM5NjgxIFF0V2ViRW5naW5lIGV2ZW50LnRpbWVTdGFtcCBpcyBuZWdhdGl2ZSB2YWx1ZQogICAgICAgICAgZS50aW1lU3RhbXAgPD0gMCB8fAogICAgICAgICAgLy8gIzk0NDggYmFpbCBpZiBldmVudCBpcyBmaXJlZCBpbiBhbm90aGVyIGRvY3VtZW50IGluIGEgbXVsdGktcGFnZQogICAgICAgICAgLy8gZWxlY3Ryb24vbncuanMgYXBwLCBzaW5jZSBldmVudC50aW1lU3RhbXAgd2lsbCBiZSB1c2luZyBhIGRpZmZlcmVudAogICAgICAgICAgLy8gc3RhcnRpbmcgcmVmZXJlbmNlCiAgICAgICAgICBlLnRhcmdldC5vd25lckRvY3VtZW50ICE9PSBkb2N1bWVudAogICAgICAgICkgewogICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICB0YXJnZXQkMS5hZGRFdmVudExpc3RlbmVyKAogICAgICBuYW1lLAogICAgICBoYW5kbGVyLAogICAgICBzdXBwb3J0c1Bhc3NpdmUKICAgICAgICA/IHsgY2FwdHVyZTogY2FwdHVyZSwgcGFzc2l2ZTogcGFzc2l2ZSB9CiAgICAgICAgOiBjYXB0dXJlCiAgICApOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlJDIgKAogICAgbmFtZSwKICAgIGhhbmRsZXIsCiAgICBjYXB0dXJlLAogICAgX3RhcmdldAogICkgewogICAgKF90YXJnZXQgfHwgdGFyZ2V0JDEpLnJlbW92ZUV2ZW50TGlzdGVuZXIoCiAgICAgIG5hbWUsCiAgICAgIGhhbmRsZXIuX3dyYXBwZXIgfHwgaGFuZGxlciwKICAgICAgY2FwdHVyZQogICAgKTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZURPTUxpc3RlbmVycyAob2xkVm5vZGUsIHZub2RlKSB7CiAgICBpZiAoaXNVbmRlZihvbGRWbm9kZS5kYXRhLm9uKSAmJiBpc1VuZGVmKHZub2RlLmRhdGEub24pKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIG9uID0gdm5vZGUuZGF0YS5vbiB8fCB7fTsKICAgIHZhciBvbGRPbiA9IG9sZFZub2RlLmRhdGEub24gfHwge307CiAgICB0YXJnZXQkMSA9IHZub2RlLmVsbTsKICAgIG5vcm1hbGl6ZUV2ZW50cyhvbik7CiAgICB1cGRhdGVMaXN0ZW5lcnMob24sIG9sZE9uLCBhZGQkMSwgcmVtb3ZlJDIsIGNyZWF0ZU9uY2VIYW5kbGVyJDEsIHZub2RlLmNvbnRleHQpOwogICAgdGFyZ2V0JDEgPSB1bmRlZmluZWQ7CiAgfQoKICB2YXIgZXZlbnRzID0gewogICAgY3JlYXRlOiB1cGRhdGVET01MaXN0ZW5lcnMsCiAgICB1cGRhdGU6IHVwZGF0ZURPTUxpc3RlbmVycwogIH07CgogIC8qICAqLwoKICB2YXIgc3ZnQ29udGFpbmVyOwoKICBmdW5jdGlvbiB1cGRhdGVET01Qcm9wcyAob2xkVm5vZGUsIHZub2RlKSB7CiAgICBpZiAoaXNVbmRlZihvbGRWbm9kZS5kYXRhLmRvbVByb3BzKSAmJiBpc1VuZGVmKHZub2RlLmRhdGEuZG9tUHJvcHMpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIGtleSwgY3VyOwogICAgdmFyIGVsbSA9IHZub2RlLmVsbTsKICAgIHZhciBvbGRQcm9wcyA9IG9sZFZub2RlLmRhdGEuZG9tUHJvcHMgfHwge307CiAgICB2YXIgcHJvcHMgPSB2bm9kZS5kYXRhLmRvbVByb3BzIHx8IHt9OwogICAgLy8gY2xvbmUgb2JzZXJ2ZWQgb2JqZWN0cywgYXMgdGhlIHVzZXIgcHJvYmFibHkgd2FudHMgdG8gbXV0YXRlIGl0CiAgICBpZiAoaXNEZWYocHJvcHMuX19vYl9fKSkgewogICAgICBwcm9wcyA9IHZub2RlLmRhdGEuZG9tUHJvcHMgPSBleHRlbmQoe30sIHByb3BzKTsKICAgIH0KCiAgICBmb3IgKGtleSBpbiBvbGRQcm9wcykgewogICAgICBpZiAoIShrZXkgaW4gcHJvcHMpKSB7CiAgICAgICAgZWxtW2tleV0gPSAnJzsKICAgICAgfQogICAgfQoKICAgIGZvciAoa2V5IGluIHByb3BzKSB7CiAgICAgIGN1ciA9IHByb3BzW2tleV07CiAgICAgIC8vIGlnbm9yZSBjaGlsZHJlbiBpZiB0aGUgbm9kZSBoYXMgdGV4dENvbnRlbnQgb3IgaW5uZXJIVE1MLAogICAgICAvLyBhcyB0aGVzZSB3aWxsIHRocm93IGF3YXkgZXhpc3RpbmcgRE9NIG5vZGVzIGFuZCBjYXVzZSByZW1vdmFsIGVycm9ycwogICAgICAvLyBvbiBzdWJzZXF1ZW50IHBhdGNoZXMgKCMzMzYwKQogICAgICBpZiAoa2V5ID09PSAndGV4dENvbnRlbnQnIHx8IGtleSA9PT0gJ2lubmVySFRNTCcpIHsKICAgICAgICBpZiAodm5vZGUuY2hpbGRyZW4pIHsgdm5vZGUuY2hpbGRyZW4ubGVuZ3RoID0gMDsgfQogICAgICAgIGlmIChjdXIgPT09IG9sZFByb3BzW2tleV0pIHsgY29udGludWUgfQogICAgICAgIC8vICM2NjAxIHdvcmsgYXJvdW5kIENocm9tZSB2ZXJzaW9uIDw9IDU1IGJ1ZyB3aGVyZSBzaW5nbGUgdGV4dE5vZGUKICAgICAgICAvLyByZXBsYWNlZCBieSBpbm5lckhUTUwvdGV4dENvbnRlbnQgcmV0YWlucyBpdHMgcGFyZW50Tm9kZSBwcm9wZXJ0eQogICAgICAgIGlmIChlbG0uY2hpbGROb2Rlcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIGVsbS5yZW1vdmVDaGlsZChlbG0uY2hpbGROb2Rlc1swXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoa2V5ID09PSAndmFsdWUnICYmIGVsbS50YWdOYW1lICE9PSAnUFJPR1JFU1MnKSB7CiAgICAgICAgLy8gc3RvcmUgdmFsdWUgYXMgX3ZhbHVlIGFzIHdlbGwgc2luY2UKICAgICAgICAvLyBub24tc3RyaW5nIHZhbHVlcyB3aWxsIGJlIHN0cmluZ2lmaWVkCiAgICAgICAgZWxtLl92YWx1ZSA9IGN1cjsKICAgICAgICAvLyBhdm9pZCByZXNldHRpbmcgY3Vyc29yIHBvc2l0aW9uIHdoZW4gdmFsdWUgaXMgdGhlIHNhbWUKICAgICAgICB2YXIgc3RyQ3VyID0gaXNVbmRlZihjdXIpID8gJycgOiBTdHJpbmcoY3VyKTsKICAgICAgICBpZiAoc2hvdWxkVXBkYXRlVmFsdWUoZWxtLCBzdHJDdXIpKSB7CiAgICAgICAgICBlbG0udmFsdWUgPSBzdHJDdXI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2lubmVySFRNTCcgJiYgaXNTVkcoZWxtLnRhZ05hbWUpICYmIGlzVW5kZWYoZWxtLmlubmVySFRNTCkpIHsKICAgICAgICAvLyBJRSBkb2Vzbid0IHN1cHBvcnQgaW5uZXJIVE1MIGZvciBTVkcgZWxlbWVudHMKICAgICAgICBzdmdDb250YWluZXIgPSBzdmdDb250YWluZXIgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgc3ZnQ29udGFpbmVyLmlubmVySFRNTCA9ICI8c3ZnPiIgKyBjdXIgKyAiPC9zdmc+IjsKICAgICAgICB2YXIgc3ZnID0gc3ZnQ29udGFpbmVyLmZpcnN0Q2hpbGQ7CiAgICAgICAgd2hpbGUgKGVsbS5maXJzdENoaWxkKSB7CiAgICAgICAgICBlbG0ucmVtb3ZlQ2hpbGQoZWxtLmZpcnN0Q2hpbGQpOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoc3ZnLmZpcnN0Q2hpbGQpIHsKICAgICAgICAgIGVsbS5hcHBlbmRDaGlsZChzdmcuZmlyc3RDaGlsZCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKAogICAgICAgIC8vIHNraXAgdGhlIHVwZGF0ZSBpZiBvbGQgYW5kIG5ldyBWRE9NIHN0YXRlIGlzIHRoZSBzYW1lLgogICAgICAgIC8vIGB2YWx1ZWAgaXMgaGFuZGxlZCBzZXBhcmF0ZWx5IGJlY2F1c2UgdGhlIERPTSB2YWx1ZSBtYXkgYmUgdGVtcG9yYXJpbHkKICAgICAgICAvLyBvdXQgb2Ygc3luYyB3aXRoIFZET00gc3RhdGUgZHVlIHRvIGZvY3VzLCBjb21wb3NpdGlvbiBhbmQgbW9kaWZpZXJzLgogICAgICAgIC8vIFRoaXMgICM0NTIxIGJ5IHNraXBwaW5nIHRoZSB1bm5lY2VzYXJyeSBgY2hlY2tlZGAgdXBkYXRlLgogICAgICAgIGN1ciAhPT0gb2xkUHJvcHNba2V5XQogICAgICApIHsKICAgICAgICAvLyBzb21lIHByb3BlcnR5IHVwZGF0ZXMgY2FuIHRocm93CiAgICAgICAgLy8gZS5nLiBgdmFsdWVgIG9uIDxwcm9ncmVzcz4gdy8gbm9uLWZpbml0ZSB2YWx1ZQogICAgICAgIHRyeSB7CiAgICAgICAgICBlbG1ba2V5XSA9IGN1cjsKICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICB9CiAgICB9CiAgfQoKICAvLyBjaGVjayBwbGF0Zm9ybXMvd2ViL3V0aWwvYXR0cnMuanMgYWNjZXB0VmFsdWUKCgogIGZ1bmN0aW9uIHNob3VsZFVwZGF0ZVZhbHVlIChlbG0sIGNoZWNrVmFsKSB7CiAgICByZXR1cm4gKCFlbG0uY29tcG9zaW5nICYmICgKICAgICAgZWxtLnRhZ05hbWUgPT09ICdPUFRJT04nIHx8CiAgICAgIGlzTm90SW5Gb2N1c0FuZERpcnR5KGVsbSwgY2hlY2tWYWwpIHx8CiAgICAgIGlzRGlydHlXaXRoTW9kaWZpZXJzKGVsbSwgY2hlY2tWYWwpCiAgICApKQogIH0KCiAgZnVuY3Rpb24gaXNOb3RJbkZvY3VzQW5kRGlydHkgKGVsbSwgY2hlY2tWYWwpIHsKICAgIC8vIHJldHVybiB0cnVlIHdoZW4gdGV4dGJveCAoLm51bWJlciBhbmQgLnRyaW0pIGxvc2VzIGZvY3VzIGFuZCBpdHMgdmFsdWUgaXMKICAgIC8vIG5vdCBlcXVhbCB0byB0aGUgdXBkYXRlZCB2YWx1ZQogICAgdmFyIG5vdEluRm9jdXMgPSB0cnVlOwogICAgLy8gIzYxNTcKICAgIC8vIHdvcmsgYXJvdW5kIElFIGJ1ZyB3aGVuIGFjY2Vzc2luZyBkb2N1bWVudC5hY3RpdmVFbGVtZW50IGluIGFuIGlmcmFtZQogICAgdHJ5IHsgbm90SW5Gb2N1cyA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IGVsbTsgfSBjYXRjaCAoZSkge30KICAgIHJldHVybiBub3RJbkZvY3VzICYmIGVsbS52YWx1ZSAhPT0gY2hlY2tWYWwKICB9CgogIGZ1bmN0aW9uIGlzRGlydHlXaXRoTW9kaWZpZXJzIChlbG0sIG5ld1ZhbCkgewogICAgdmFyIHZhbHVlID0gZWxtLnZhbHVlOwogICAgdmFyIG1vZGlmaWVycyA9IGVsbS5fdk1vZGlmaWVyczsgLy8gaW5qZWN0ZWQgYnkgdi1tb2RlbCBydW50aW1lCiAgICBpZiAoaXNEZWYobW9kaWZpZXJzKSkgewogICAgICBpZiAobW9kaWZpZXJzLm51bWJlcikgewogICAgICAgIHJldHVybiB0b051bWJlcih2YWx1ZSkgIT09IHRvTnVtYmVyKG5ld1ZhbCkKICAgICAgfQogICAgICBpZiAobW9kaWZpZXJzLnRyaW0pIHsKICAgICAgICByZXR1cm4gdmFsdWUudHJpbSgpICE9PSBuZXdWYWwudHJpbSgpCiAgICAgIH0KICAgIH0KICAgIHJldHVybiB2YWx1ZSAhPT0gbmV3VmFsCiAgfQoKICB2YXIgZG9tUHJvcHMgPSB7CiAgICBjcmVhdGU6IHVwZGF0ZURPTVByb3BzLAogICAgdXBkYXRlOiB1cGRhdGVET01Qcm9wcwogIH07CgogIC8qICAqLwoKICB2YXIgcGFyc2VTdHlsZVRleHQgPSBjYWNoZWQoZnVuY3Rpb24gKGNzc1RleHQpIHsKICAgIHZhciByZXMgPSB7fTsKICAgIHZhciBsaXN0RGVsaW1pdGVyID0gLzsoPyFbXihdKlwpKS9nOwogICAgdmFyIHByb3BlcnR5RGVsaW1pdGVyID0gLzooLispLzsKICAgIGNzc1RleHQuc3BsaXQobGlzdERlbGltaXRlcikuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICBpZiAoaXRlbSkgewogICAgICAgIHZhciB0bXAgPSBpdGVtLnNwbGl0KHByb3BlcnR5RGVsaW1pdGVyKTsKICAgICAgICB0bXAubGVuZ3RoID4gMSAmJiAocmVzW3RtcFswXS50cmltKCldID0gdG1wWzFdLnRyaW0oKSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlcwogIH0pOwoKICAvLyBtZXJnZSBzdGF0aWMgYW5kIGR5bmFtaWMgc3R5bGUgZGF0YSBvbiB0aGUgc2FtZSB2bm9kZQogIGZ1bmN0aW9uIG5vcm1hbGl6ZVN0eWxlRGF0YSAoZGF0YSkgewogICAgdmFyIHN0eWxlID0gbm9ybWFsaXplU3R5bGVCaW5kaW5nKGRhdGEuc3R5bGUpOwogICAgLy8gc3RhdGljIHN0eWxlIGlzIHByZS1wcm9jZXNzZWQgaW50byBhbiBvYmplY3QgZHVyaW5nIGNvbXBpbGF0aW9uCiAgICAvLyBhbmQgaXMgYWx3YXlzIGEgZnJlc2ggb2JqZWN0LCBzbyBpdCdzIHNhZmUgdG8gbWVyZ2UgaW50byBpdAogICAgcmV0dXJuIGRhdGEuc3RhdGljU3R5bGUKICAgICAgPyBleHRlbmQoZGF0YS5zdGF0aWNTdHlsZSwgc3R5bGUpCiAgICAgIDogc3R5bGUKICB9CgogIC8vIG5vcm1hbGl6ZSBwb3NzaWJsZSBhcnJheSAvIHN0cmluZyB2YWx1ZXMgaW50byBPYmplY3QKICBmdW5jdGlvbiBub3JtYWxpemVTdHlsZUJpbmRpbmcgKGJpbmRpbmdTdHlsZSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoYmluZGluZ1N0eWxlKSkgewogICAgICByZXR1cm4gdG9PYmplY3QoYmluZGluZ1N0eWxlKQogICAgfQogICAgaWYgKHR5cGVvZiBiaW5kaW5nU3R5bGUgPT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiBwYXJzZVN0eWxlVGV4dChiaW5kaW5nU3R5bGUpCiAgICB9CiAgICByZXR1cm4gYmluZGluZ1N0eWxlCiAgfQoKICAvKioKICAgKiBwYXJlbnQgY29tcG9uZW50IHN0eWxlIHNob3VsZCBiZSBhZnRlciBjaGlsZCdzCiAgICogc28gdGhhdCBwYXJlbnQgY29tcG9uZW50J3Mgc3R5bGUgY291bGQgb3ZlcnJpZGUgaXQKICAgKi8KICBmdW5jdGlvbiBnZXRTdHlsZSAodm5vZGUsIGNoZWNrQ2hpbGQpIHsKICAgIHZhciByZXMgPSB7fTsKICAgIHZhciBzdHlsZURhdGE7CgogICAgaWYgKGNoZWNrQ2hpbGQpIHsKICAgICAgdmFyIGNoaWxkTm9kZSA9IHZub2RlOwogICAgICB3aGlsZSAoY2hpbGROb2RlLmNvbXBvbmVudEluc3RhbmNlKSB7CiAgICAgICAgY2hpbGROb2RlID0gY2hpbGROb2RlLmNvbXBvbmVudEluc3RhbmNlLl92bm9kZTsKICAgICAgICBpZiAoCiAgICAgICAgICBjaGlsZE5vZGUgJiYgY2hpbGROb2RlLmRhdGEgJiYKICAgICAgICAgIChzdHlsZURhdGEgPSBub3JtYWxpemVTdHlsZURhdGEoY2hpbGROb2RlLmRhdGEpKQogICAgICAgICkgewogICAgICAgICAgZXh0ZW5kKHJlcywgc3R5bGVEYXRhKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoKHN0eWxlRGF0YSA9IG5vcm1hbGl6ZVN0eWxlRGF0YSh2bm9kZS5kYXRhKSkpIHsKICAgICAgZXh0ZW5kKHJlcywgc3R5bGVEYXRhKTsKICAgIH0KCiAgICB2YXIgcGFyZW50Tm9kZSA9IHZub2RlOwogICAgd2hpbGUgKChwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5wYXJlbnQpKSB7CiAgICAgIGlmIChwYXJlbnROb2RlLmRhdGEgJiYgKHN0eWxlRGF0YSA9IG5vcm1hbGl6ZVN0eWxlRGF0YShwYXJlbnROb2RlLmRhdGEpKSkgewogICAgICAgIGV4dGVuZChyZXMsIHN0eWxlRGF0YSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIC8qICAqLwoKICB2YXIgY3NzVmFyUkUgPSAvXi0tLzsKICB2YXIgaW1wb3J0YW50UkUgPSAvXHMqIWltcG9ydGFudCQvOwogIHZhciBzZXRQcm9wID0gZnVuY3Rpb24gKGVsLCBuYW1lLCB2YWwpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGNzc1ZhclJFLnRlc3QobmFtZSkpIHsKICAgICAgZWwuc3R5bGUuc2V0UHJvcGVydHkobmFtZSwgdmFsKTsKICAgIH0gZWxzZSBpZiAoaW1wb3J0YW50UkUudGVzdCh2YWwpKSB7CiAgICAgIGVsLnN0eWxlLnNldFByb3BlcnR5KGh5cGhlbmF0ZShuYW1lKSwgdmFsLnJlcGxhY2UoaW1wb3J0YW50UkUsICcnKSwgJ2ltcG9ydGFudCcpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIG5vcm1hbGl6ZWROYW1lID0gbm9ybWFsaXplKG5hbWUpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7CiAgICAgICAgLy8gU3VwcG9ydCB2YWx1ZXMgYXJyYXkgY3JlYXRlZCBieSBhdXRvcHJlZml4ZXIsIGUuZy4KICAgICAgICAvLyB7ZGlzcGxheTogWyItd2Via2l0LWJveCIsICItbXMtZmxleGJveCIsICJmbGV4Il19CiAgICAgICAgLy8gU2V0IHRoZW0gb25lIGJ5IG9uZSwgYW5kIHRoZSBicm93c2VyIHdpbGwgb25seSBzZXQgdGhvc2UgaXQgY2FuIHJlY29nbml6ZQogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWwubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGVsLnN0eWxlW25vcm1hbGl6ZWROYW1lXSA9IHZhbFtpXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwuc3R5bGVbbm9ybWFsaXplZE5hbWVdID0gdmFsOwogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIHZlbmRvck5hbWVzID0gWydXZWJraXQnLCAnTW96JywgJ21zJ107CgogIHZhciBlbXB0eVN0eWxlOwogIHZhciBub3JtYWxpemUgPSBjYWNoZWQoZnVuY3Rpb24gKHByb3ApIHsKICAgIGVtcHR5U3R5bGUgPSBlbXB0eVN0eWxlIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLnN0eWxlOwogICAgcHJvcCA9IGNhbWVsaXplKHByb3ApOwogICAgaWYgKHByb3AgIT09ICdmaWx0ZXInICYmIChwcm9wIGluIGVtcHR5U3R5bGUpKSB7CiAgICAgIHJldHVybiBwcm9wCiAgICB9CiAgICB2YXIgY2FwTmFtZSA9IHByb3AuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm9wLnNsaWNlKDEpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2ZW5kb3JOYW1lcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgbmFtZSA9IHZlbmRvck5hbWVzW2ldICsgY2FwTmFtZTsKICAgICAgaWYgKG5hbWUgaW4gZW1wdHlTdHlsZSkgewogICAgICAgIHJldHVybiBuYW1lCiAgICAgIH0KICAgIH0KICB9KTsKCiAgZnVuY3Rpb24gdXBkYXRlU3R5bGUgKG9sZFZub2RlLCB2bm9kZSkgewogICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwogICAgdmFyIG9sZERhdGEgPSBvbGRWbm9kZS5kYXRhOwoKICAgIGlmIChpc1VuZGVmKGRhdGEuc3RhdGljU3R5bGUpICYmIGlzVW5kZWYoZGF0YS5zdHlsZSkgJiYKICAgICAgaXNVbmRlZihvbGREYXRhLnN0YXRpY1N0eWxlKSAmJiBpc1VuZGVmKG9sZERhdGEuc3R5bGUpCiAgICApIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgdmFyIGN1ciwgbmFtZTsKICAgIHZhciBlbCA9IHZub2RlLmVsbTsKICAgIHZhciBvbGRTdGF0aWNTdHlsZSA9IG9sZERhdGEuc3RhdGljU3R5bGU7CiAgICB2YXIgb2xkU3R5bGVCaW5kaW5nID0gb2xkRGF0YS5ub3JtYWxpemVkU3R5bGUgfHwgb2xkRGF0YS5zdHlsZSB8fCB7fTsKCiAgICAvLyBpZiBzdGF0aWMgc3R5bGUgZXhpc3RzLCBzdHlsZWJpbmRpbmcgYWxyZWFkeSBtZXJnZWQgaW50byBpdCB3aGVuIGRvaW5nIG5vcm1hbGl6ZVN0eWxlRGF0YQogICAgdmFyIG9sZFN0eWxlID0gb2xkU3RhdGljU3R5bGUgfHwgb2xkU3R5bGVCaW5kaW5nOwoKICAgIHZhciBzdHlsZSA9IG5vcm1hbGl6ZVN0eWxlQmluZGluZyh2bm9kZS5kYXRhLnN0eWxlKSB8fCB7fTsKCiAgICAvLyBzdG9yZSBub3JtYWxpemVkIHN0eWxlIHVuZGVyIGEgZGlmZmVyZW50IGtleSBmb3IgbmV4dCBkaWZmCiAgICAvLyBtYWtlIHN1cmUgdG8gY2xvbmUgaXQgaWYgaXQncyByZWFjdGl2ZSwgc2luY2UgdGhlIHVzZXIgbGlrZWx5IHdhbnRzCiAgICAvLyB0byBtdXRhdGUgaXQuCiAgICB2bm9kZS5kYXRhLm5vcm1hbGl6ZWRTdHlsZSA9IGlzRGVmKHN0eWxlLl9fb2JfXykKICAgICAgPyBleHRlbmQoe30sIHN0eWxlKQogICAgICA6IHN0eWxlOwoKICAgIHZhciBuZXdTdHlsZSA9IGdldFN0eWxlKHZub2RlLCB0cnVlKTsKCiAgICBmb3IgKG5hbWUgaW4gb2xkU3R5bGUpIHsKICAgICAgaWYgKGlzVW5kZWYobmV3U3R5bGVbbmFtZV0pKSB7CiAgICAgICAgc2V0UHJvcChlbCwgbmFtZSwgJycpOwogICAgICB9CiAgICB9CiAgICBmb3IgKG5hbWUgaW4gbmV3U3R5bGUpIHsKICAgICAgY3VyID0gbmV3U3R5bGVbbmFtZV07CiAgICAgIGlmIChjdXIgIT09IG9sZFN0eWxlW25hbWVdKSB7CiAgICAgICAgLy8gaWU5IHNldHRpbmcgdG8gbnVsbCBoYXMgbm8gZWZmZWN0LCBtdXN0IHVzZSBlbXB0eSBzdHJpbmcKICAgICAgICBzZXRQcm9wKGVsLCBuYW1lLCBjdXIgPT0gbnVsbCA/ICcnIDogY3VyKTsKICAgICAgfQogICAgfQogIH0KCiAgdmFyIHN0eWxlID0gewogICAgY3JlYXRlOiB1cGRhdGVTdHlsZSwKICAgIHVwZGF0ZTogdXBkYXRlU3R5bGUKICB9OwoKICAvKiAgKi8KCiAgdmFyIHdoaXRlc3BhY2VSRSA9IC9ccysvOwoKICAvKioKICAgKiBBZGQgY2xhc3Mgd2l0aCBjb21wYXRpYmlsaXR5IGZvciBTVkcgc2luY2UgY2xhc3NMaXN0IGlzIG5vdCBzdXBwb3J0ZWQgb24KICAgKiBTVkcgZWxlbWVudHMgaW4gSUUKICAgKi8KICBmdW5jdGlvbiBhZGRDbGFzcyAoZWwsIGNscykgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoIWNscyB8fCAhKGNscyA9IGNscy50cmltKCkpKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAoZWwuY2xhc3NMaXN0KSB7CiAgICAgIGlmIChjbHMuaW5kZXhPZignICcpID4gLTEpIHsKICAgICAgICBjbHMuc3BsaXQod2hpdGVzcGFjZVJFKS5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7IHJldHVybiBlbC5jbGFzc0xpc3QuYWRkKGMpOyB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKGNscyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBjdXIgPSAiICIgKyAoZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnKSArICIgIjsKICAgICAgaWYgKGN1ci5pbmRleE9mKCcgJyArIGNscyArICcgJykgPCAwKSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdjbGFzcycsIChjdXIgKyBjbHMpLnRyaW0oKSk7CiAgICAgIH0KICAgIH0KICB9CgogIC8qKgogICAqIFJlbW92ZSBjbGFzcyB3aXRoIGNvbXBhdGliaWxpdHkgZm9yIFNWRyBzaW5jZSBjbGFzc0xpc3QgaXMgbm90IHN1cHBvcnRlZCBvbgogICAqIFNWRyBlbGVtZW50cyBpbiBJRQogICAqLwogIGZ1bmN0aW9uIHJlbW92ZUNsYXNzIChlbCwgY2xzKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICghY2xzIHx8ICEoY2xzID0gY2xzLnRyaW0oKSkpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIGlmIChlbC5jbGFzc0xpc3QpIHsKICAgICAgaWYgKGNscy5pbmRleE9mKCcgJykgPiAtMSkgewogICAgICAgIGNscy5zcGxpdCh3aGl0ZXNwYWNlUkUpLmZvckVhY2goZnVuY3Rpb24gKGMpIHsgcmV0dXJuIGVsLmNsYXNzTGlzdC5yZW1vdmUoYyk7IH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xzKTsKICAgICAgfQogICAgICBpZiAoIWVsLmNsYXNzTGlzdC5sZW5ndGgpIHsKICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzJyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBjdXIgPSAiICIgKyAoZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnKSArICIgIjsKICAgICAgdmFyIHRhciA9ICcgJyArIGNscyArICcgJzsKICAgICAgd2hpbGUgKGN1ci5pbmRleE9mKHRhcikgPj0gMCkgewogICAgICAgIGN1ciA9IGN1ci5yZXBsYWNlKHRhciwgJyAnKTsKICAgICAgfQogICAgICBjdXIgPSBjdXIudHJpbSgpOwogICAgICBpZiAoY3VyKSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdjbGFzcycsIGN1cik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwucmVtb3ZlQXR0cmlidXRlKCdjbGFzcycpOwogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gcmVzb2x2ZVRyYW5zaXRpb24gKGRlZiQkMSkgewogICAgaWYgKCFkZWYkJDEpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgaWYgKHR5cGVvZiBkZWYkJDEgPT09ICdvYmplY3QnKSB7CiAgICAgIHZhciByZXMgPSB7fTsKICAgICAgaWYgKGRlZiQkMS5jc3MgIT09IGZhbHNlKSB7CiAgICAgICAgZXh0ZW5kKHJlcywgYXV0b0Nzc1RyYW5zaXRpb24oZGVmJCQxLm5hbWUgfHwgJ3YnKSk7CiAgICAgIH0KICAgICAgZXh0ZW5kKHJlcywgZGVmJCQxKTsKICAgICAgcmV0dXJuIHJlcwogICAgfSBlbHNlIGlmICh0eXBlb2YgZGVmJCQxID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gYXV0b0Nzc1RyYW5zaXRpb24oZGVmJCQxKQogICAgfQogIH0KCiAgdmFyIGF1dG9Dc3NUcmFuc2l0aW9uID0gY2FjaGVkKGZ1bmN0aW9uIChuYW1lKSB7CiAgICByZXR1cm4gewogICAgICBlbnRlckNsYXNzOiAobmFtZSArICItZW50ZXIiKSwKICAgICAgZW50ZXJUb0NsYXNzOiAobmFtZSArICItZW50ZXItdG8iKSwKICAgICAgZW50ZXJBY3RpdmVDbGFzczogKG5hbWUgKyAiLWVudGVyLWFjdGl2ZSIpLAogICAgICBsZWF2ZUNsYXNzOiAobmFtZSArICItbGVhdmUiKSwKICAgICAgbGVhdmVUb0NsYXNzOiAobmFtZSArICItbGVhdmUtdG8iKSwKICAgICAgbGVhdmVBY3RpdmVDbGFzczogKG5hbWUgKyAiLWxlYXZlLWFjdGl2ZSIpCiAgICB9CiAgfSk7CgogIHZhciBoYXNUcmFuc2l0aW9uID0gaW5Ccm93c2VyICYmICFpc0lFOTsKICB2YXIgVFJBTlNJVElPTiA9ICd0cmFuc2l0aW9uJzsKICB2YXIgQU5JTUFUSU9OID0gJ2FuaW1hdGlvbic7CgogIC8vIFRyYW5zaXRpb24gcHJvcGVydHkvZXZlbnQgc25pZmZpbmcKICB2YXIgdHJhbnNpdGlvblByb3AgPSAndHJhbnNpdGlvbic7CiAgdmFyIHRyYW5zaXRpb25FbmRFdmVudCA9ICd0cmFuc2l0aW9uZW5kJzsKICB2YXIgYW5pbWF0aW9uUHJvcCA9ICdhbmltYXRpb24nOwogIHZhciBhbmltYXRpb25FbmRFdmVudCA9ICdhbmltYXRpb25lbmQnOwogIGlmIChoYXNUcmFuc2l0aW9uKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICh3aW5kb3cub250cmFuc2l0aW9uZW5kID09PSB1bmRlZmluZWQgJiYKICAgICAgd2luZG93Lm9ud2Via2l0dHJhbnNpdGlvbmVuZCAhPT0gdW5kZWZpbmVkCiAgICApIHsKICAgICAgdHJhbnNpdGlvblByb3AgPSAnV2Via2l0VHJhbnNpdGlvbic7CiAgICAgIHRyYW5zaXRpb25FbmRFdmVudCA9ICd3ZWJraXRUcmFuc2l0aW9uRW5kJzsKICAgIH0KICAgIGlmICh3aW5kb3cub25hbmltYXRpb25lbmQgPT09IHVuZGVmaW5lZCAmJgogICAgICB3aW5kb3cub253ZWJraXRhbmltYXRpb25lbmQgIT09IHVuZGVmaW5lZAogICAgKSB7CiAgICAgIGFuaW1hdGlvblByb3AgPSAnV2Via2l0QW5pbWF0aW9uJzsKICAgICAgYW5pbWF0aW9uRW5kRXZlbnQgPSAnd2Via2l0QW5pbWF0aW9uRW5kJzsKICAgIH0KICB9CgogIC8vIGJpbmRpbmcgdG8gd2luZG93IGlzIG5lY2Vzc2FyeSB0byBtYWtlIGhvdCByZWxvYWQgd29yayBpbiBJRSBpbiBzdHJpY3QgbW9kZQogIHZhciByYWYgPSBpbkJyb3dzZXIKICAgID8gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZQogICAgICA/IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuYmluZCh3aW5kb3cpCiAgICAgIDogc2V0VGltZW91dAogICAgOiAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyBmdW5jdGlvbiAoZm4pIHsgcmV0dXJuIGZuKCk7IH07CgogIGZ1bmN0aW9uIG5leHRGcmFtZSAoZm4pIHsKICAgIHJhZihmdW5jdGlvbiAoKSB7CiAgICAgIHJhZihmbik7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGFkZFRyYW5zaXRpb25DbGFzcyAoZWwsIGNscykgewogICAgdmFyIHRyYW5zaXRpb25DbGFzc2VzID0gZWwuX3RyYW5zaXRpb25DbGFzc2VzIHx8IChlbC5fdHJhbnNpdGlvbkNsYXNzZXMgPSBbXSk7CiAgICBpZiAodHJhbnNpdGlvbkNsYXNzZXMuaW5kZXhPZihjbHMpIDwgMCkgewogICAgICB0cmFuc2l0aW9uQ2xhc3Nlcy5wdXNoKGNscyk7CiAgICAgIGFkZENsYXNzKGVsLCBjbHMpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlVHJhbnNpdGlvbkNsYXNzIChlbCwgY2xzKSB7CiAgICBpZiAoZWwuX3RyYW5zaXRpb25DbGFzc2VzKSB7CiAgICAgIHJlbW92ZShlbC5fdHJhbnNpdGlvbkNsYXNzZXMsIGNscyk7CiAgICB9CiAgICByZW1vdmVDbGFzcyhlbCwgY2xzKTsKICB9CgogIGZ1bmN0aW9uIHdoZW5UcmFuc2l0aW9uRW5kcyAoCiAgICBlbCwKICAgIGV4cGVjdGVkVHlwZSwKICAgIGNiCiAgKSB7CiAgICB2YXIgcmVmID0gZ2V0VHJhbnNpdGlvbkluZm8oZWwsIGV4cGVjdGVkVHlwZSk7CiAgICB2YXIgdHlwZSA9IHJlZi50eXBlOwogICAgdmFyIHRpbWVvdXQgPSByZWYudGltZW91dDsKICAgIHZhciBwcm9wQ291bnQgPSByZWYucHJvcENvdW50OwogICAgaWYgKCF0eXBlKSB7IHJldHVybiBjYigpIH0KICAgIHZhciBldmVudCA9IHR5cGUgPT09IFRSQU5TSVRJT04gPyB0cmFuc2l0aW9uRW5kRXZlbnQgOiBhbmltYXRpb25FbmRFdmVudDsKICAgIHZhciBlbmRlZCA9IDA7CiAgICB2YXIgZW5kID0gZnVuY3Rpb24gKCkgewogICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBvbkVuZCk7CiAgICAgIGNiKCk7CiAgICB9OwogICAgdmFyIG9uRW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGUudGFyZ2V0ID09PSBlbCkgewogICAgICAgIGlmICgrK2VuZGVkID49IHByb3BDb3VudCkgewogICAgICAgICAgZW5kKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChlbmRlZCA8IHByb3BDb3VudCkgewogICAgICAgIGVuZCgpOwogICAgICB9CiAgICB9LCB0aW1lb3V0ICsgMSk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBvbkVuZCk7CiAgfQoKICB2YXIgdHJhbnNmb3JtUkUgPSAvXGIodHJhbnNmb3JtfGFsbCkoLHwkKS87CgogIGZ1bmN0aW9uIGdldFRyYW5zaXRpb25JbmZvIChlbCwgZXhwZWN0ZWRUeXBlKSB7CiAgICB2YXIgc3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpOwogICAgLy8gSlNET00gbWF5IHJldHVybiB1bmRlZmluZWQgZm9yIHRyYW5zaXRpb24gcHJvcGVydGllcwogICAgdmFyIHRyYW5zaXRpb25EZWxheXMgPSAoc3R5bGVzW3RyYW5zaXRpb25Qcm9wICsgJ0RlbGF5J10gfHwgJycpLnNwbGl0KCcsICcpOwogICAgdmFyIHRyYW5zaXRpb25EdXJhdGlvbnMgPSAoc3R5bGVzW3RyYW5zaXRpb25Qcm9wICsgJ0R1cmF0aW9uJ10gfHwgJycpLnNwbGl0KCcsICcpOwogICAgdmFyIHRyYW5zaXRpb25UaW1lb3V0ID0gZ2V0VGltZW91dCh0cmFuc2l0aW9uRGVsYXlzLCB0cmFuc2l0aW9uRHVyYXRpb25zKTsKICAgIHZhciBhbmltYXRpb25EZWxheXMgPSAoc3R5bGVzW2FuaW1hdGlvblByb3AgKyAnRGVsYXknXSB8fCAnJykuc3BsaXQoJywgJyk7CiAgICB2YXIgYW5pbWF0aW9uRHVyYXRpb25zID0gKHN0eWxlc1thbmltYXRpb25Qcm9wICsgJ0R1cmF0aW9uJ10gfHwgJycpLnNwbGl0KCcsICcpOwogICAgdmFyIGFuaW1hdGlvblRpbWVvdXQgPSBnZXRUaW1lb3V0KGFuaW1hdGlvbkRlbGF5cywgYW5pbWF0aW9uRHVyYXRpb25zKTsKCiAgICB2YXIgdHlwZTsKICAgIHZhciB0aW1lb3V0ID0gMDsKICAgIHZhciBwcm9wQ291bnQgPSAwOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoZXhwZWN0ZWRUeXBlID09PSBUUkFOU0lUSU9OKSB7CiAgICAgIGlmICh0cmFuc2l0aW9uVGltZW91dCA+IDApIHsKICAgICAgICB0eXBlID0gVFJBTlNJVElPTjsKICAgICAgICB0aW1lb3V0ID0gdHJhbnNpdGlvblRpbWVvdXQ7CiAgICAgICAgcHJvcENvdW50ID0gdHJhbnNpdGlvbkR1cmF0aW9ucy5sZW5ndGg7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXhwZWN0ZWRUeXBlID09PSBBTklNQVRJT04pIHsKICAgICAgaWYgKGFuaW1hdGlvblRpbWVvdXQgPiAwKSB7CiAgICAgICAgdHlwZSA9IEFOSU1BVElPTjsKICAgICAgICB0aW1lb3V0ID0gYW5pbWF0aW9uVGltZW91dDsKICAgICAgICBwcm9wQ291bnQgPSBhbmltYXRpb25EdXJhdGlvbnMubGVuZ3RoOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aW1lb3V0ID0gTWF0aC5tYXgodHJhbnNpdGlvblRpbWVvdXQsIGFuaW1hdGlvblRpbWVvdXQpOwogICAgICB0eXBlID0gdGltZW91dCA+IDAKICAgICAgICA/IHRyYW5zaXRpb25UaW1lb3V0ID4gYW5pbWF0aW9uVGltZW91dAogICAgICAgICAgPyBUUkFOU0lUSU9OCiAgICAgICAgICA6IEFOSU1BVElPTgogICAgICAgIDogbnVsbDsKICAgICAgcHJvcENvdW50ID0gdHlwZQogICAgICAgID8gdHlwZSA9PT0gVFJBTlNJVElPTgogICAgICAgICAgPyB0cmFuc2l0aW9uRHVyYXRpb25zLmxlbmd0aAogICAgICAgICAgOiBhbmltYXRpb25EdXJhdGlvbnMubGVuZ3RoCiAgICAgICAgOiAwOwogICAgfQogICAgdmFyIGhhc1RyYW5zZm9ybSA9CiAgICAgIHR5cGUgPT09IFRSQU5TSVRJT04gJiYKICAgICAgdHJhbnNmb3JtUkUudGVzdChzdHlsZXNbdHJhbnNpdGlvblByb3AgKyAnUHJvcGVydHknXSk7CiAgICByZXR1cm4gewogICAgICB0eXBlOiB0eXBlLAogICAgICB0aW1lb3V0OiB0aW1lb3V0LAogICAgICBwcm9wQ291bnQ6IHByb3BDb3VudCwKICAgICAgaGFzVHJhbnNmb3JtOiBoYXNUcmFuc2Zvcm0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldFRpbWVvdXQgKGRlbGF5cywgZHVyYXRpb25zKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgd2hpbGUgKGRlbGF5cy5sZW5ndGggPCBkdXJhdGlvbnMubGVuZ3RoKSB7CiAgICAgIGRlbGF5cyA9IGRlbGF5cy5jb25jYXQoZGVsYXlzKTsKICAgIH0KCiAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkobnVsbCwgZHVyYXRpb25zLm1hcChmdW5jdGlvbiAoZCwgaSkgewogICAgICByZXR1cm4gdG9NcyhkKSArIHRvTXMoZGVsYXlzW2ldKQogICAgfSkpCiAgfQoKICAvLyBPbGQgdmVyc2lvbnMgb2YgQ2hyb21pdW0gKGJlbG93IDYxLjAuMzE2My4xMDApIGZvcm1hdHMgZmxvYXRpbmcgcG9pbnRlciBudW1iZXJzCiAgLy8gaW4gYSBsb2NhbGUtZGVwZW5kZW50IHdheSwgdXNpbmcgYSBjb21tYSBpbnN0ZWFkIG9mIGEgZG90LgogIC8vIElmIGNvbW1hIGlzIG5vdCByZXBsYWNlZCB3aXRoIGEgZG90LCB0aGUgaW5wdXQgd2lsbCBiZSByb3VuZGVkIGRvd24gKGkuZS4gYWN0aW5nCiAgLy8gYXMgYSBmbG9vciBmdW5jdGlvbikgY2F1c2luZyB1bmV4cGVjdGVkIGJlaGF2aW9ycwogIGZ1bmN0aW9uIHRvTXMgKHMpIHsKICAgIHJldHVybiBOdW1iZXIocy5zbGljZSgwLCAtMSkucmVwbGFjZSgnLCcsICcuJykpICogMTAwMAogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGVudGVyICh2bm9kZSwgdG9nZ2xlRGlzcGxheSkgewogICAgdmFyIGVsID0gdm5vZGUuZWxtOwoKICAgIC8vIGNhbGwgbGVhdmUgY2FsbGJhY2sgbm93CiAgICBpZiAoaXNEZWYoZWwuX2xlYXZlQ2IpKSB7CiAgICAgIGVsLl9sZWF2ZUNiLmNhbmNlbGxlZCA9IHRydWU7CiAgICAgIGVsLl9sZWF2ZUNiKCk7CiAgICB9CgogICAgdmFyIGRhdGEgPSByZXNvbHZlVHJhbnNpdGlvbih2bm9kZS5kYXRhLnRyYW5zaXRpb24pOwogICAgaWYgKGlzVW5kZWYoZGF0YSkpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNEZWYoZWwuX2VudGVyQ2IpIHx8IGVsLm5vZGVUeXBlICE9PSAxKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBjc3MgPSBkYXRhLmNzczsKICAgIHZhciB0eXBlID0gZGF0YS50eXBlOwogICAgdmFyIGVudGVyQ2xhc3MgPSBkYXRhLmVudGVyQ2xhc3M7CiAgICB2YXIgZW50ZXJUb0NsYXNzID0gZGF0YS5lbnRlclRvQ2xhc3M7CiAgICB2YXIgZW50ZXJBY3RpdmVDbGFzcyA9IGRhdGEuZW50ZXJBY3RpdmVDbGFzczsKICAgIHZhciBhcHBlYXJDbGFzcyA9IGRhdGEuYXBwZWFyQ2xhc3M7CiAgICB2YXIgYXBwZWFyVG9DbGFzcyA9IGRhdGEuYXBwZWFyVG9DbGFzczsKICAgIHZhciBhcHBlYXJBY3RpdmVDbGFzcyA9IGRhdGEuYXBwZWFyQWN0aXZlQ2xhc3M7CiAgICB2YXIgYmVmb3JlRW50ZXIgPSBkYXRhLmJlZm9yZUVudGVyOwogICAgdmFyIGVudGVyID0gZGF0YS5lbnRlcjsKICAgIHZhciBhZnRlckVudGVyID0gZGF0YS5hZnRlckVudGVyOwogICAgdmFyIGVudGVyQ2FuY2VsbGVkID0gZGF0YS5lbnRlckNhbmNlbGxlZDsKICAgIHZhciBiZWZvcmVBcHBlYXIgPSBkYXRhLmJlZm9yZUFwcGVhcjsKICAgIHZhciBhcHBlYXIgPSBkYXRhLmFwcGVhcjsKICAgIHZhciBhZnRlckFwcGVhciA9IGRhdGEuYWZ0ZXJBcHBlYXI7CiAgICB2YXIgYXBwZWFyQ2FuY2VsbGVkID0gZGF0YS5hcHBlYXJDYW5jZWxsZWQ7CiAgICB2YXIgZHVyYXRpb24gPSBkYXRhLmR1cmF0aW9uOwoKICAgIC8vIGFjdGl2ZUluc3RhbmNlIHdpbGwgYWx3YXlzIGJlIHRoZSA8dHJhbnNpdGlvbj4gY29tcG9uZW50IG1hbmFnaW5nIHRoaXMKICAgIC8vIHRyYW5zaXRpb24uIE9uZSBlZGdlIGNhc2UgdG8gY2hlY2sgaXMgd2hlbiB0aGUgPHRyYW5zaXRpb24+IGlzIHBsYWNlZAogICAgLy8gYXMgdGhlIHJvb3Qgbm9kZSBvZiBhIGNoaWxkIGNvbXBvbmVudC4gSW4gdGhhdCBjYXNlIHdlIG5lZWQgdG8gY2hlY2sKICAgIC8vIDx0cmFuc2l0aW9uPidzIHBhcmVudCBmb3IgYXBwZWFyIGNoZWNrLgogICAgdmFyIGNvbnRleHQgPSBhY3RpdmVJbnN0YW5jZTsKICAgIHZhciB0cmFuc2l0aW9uTm9kZSA9IGFjdGl2ZUluc3RhbmNlLiR2bm9kZTsKICAgIHdoaWxlICh0cmFuc2l0aW9uTm9kZSAmJiB0cmFuc2l0aW9uTm9kZS5wYXJlbnQpIHsKICAgICAgY29udGV4dCA9IHRyYW5zaXRpb25Ob2RlLmNvbnRleHQ7CiAgICAgIHRyYW5zaXRpb25Ob2RlID0gdHJhbnNpdGlvbk5vZGUucGFyZW50OwogICAgfQoKICAgIHZhciBpc0FwcGVhciA9ICFjb250ZXh0Ll9pc01vdW50ZWQgfHwgIXZub2RlLmlzUm9vdEluc2VydDsKCiAgICBpZiAoaXNBcHBlYXIgJiYgIWFwcGVhciAmJiBhcHBlYXIgIT09ICcnKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBzdGFydENsYXNzID0gaXNBcHBlYXIgJiYgYXBwZWFyQ2xhc3MKICAgICAgPyBhcHBlYXJDbGFzcwogICAgICA6IGVudGVyQ2xhc3M7CiAgICB2YXIgYWN0aXZlQ2xhc3MgPSBpc0FwcGVhciAmJiBhcHBlYXJBY3RpdmVDbGFzcwogICAgICA/IGFwcGVhckFjdGl2ZUNsYXNzCiAgICAgIDogZW50ZXJBY3RpdmVDbGFzczsKICAgIHZhciB0b0NsYXNzID0gaXNBcHBlYXIgJiYgYXBwZWFyVG9DbGFzcwogICAgICA/IGFwcGVhclRvQ2xhc3MKICAgICAgOiBlbnRlclRvQ2xhc3M7CgogICAgdmFyIGJlZm9yZUVudGVySG9vayA9IGlzQXBwZWFyCiAgICAgID8gKGJlZm9yZUFwcGVhciB8fCBiZWZvcmVFbnRlcikKICAgICAgOiBiZWZvcmVFbnRlcjsKICAgIHZhciBlbnRlckhvb2sgPSBpc0FwcGVhcgogICAgICA/ICh0eXBlb2YgYXBwZWFyID09PSAnZnVuY3Rpb24nID8gYXBwZWFyIDogZW50ZXIpCiAgICAgIDogZW50ZXI7CiAgICB2YXIgYWZ0ZXJFbnRlckhvb2sgPSBpc0FwcGVhcgogICAgICA/IChhZnRlckFwcGVhciB8fCBhZnRlckVudGVyKQogICAgICA6IGFmdGVyRW50ZXI7CiAgICB2YXIgZW50ZXJDYW5jZWxsZWRIb29rID0gaXNBcHBlYXIKICAgICAgPyAoYXBwZWFyQ2FuY2VsbGVkIHx8IGVudGVyQ2FuY2VsbGVkKQogICAgICA6IGVudGVyQ2FuY2VsbGVkOwoKICAgIHZhciBleHBsaWNpdEVudGVyRHVyYXRpb24gPSB0b051bWJlcigKICAgICAgaXNPYmplY3QoZHVyYXRpb24pCiAgICAgICAgPyBkdXJhdGlvbi5lbnRlcgogICAgICAgIDogZHVyYXRpb24KICAgICk7CgogICAgaWYgKGV4cGxpY2l0RW50ZXJEdXJhdGlvbiAhPSBudWxsKSB7CiAgICAgIGNoZWNrRHVyYXRpb24oZXhwbGljaXRFbnRlckR1cmF0aW9uLCAnZW50ZXInLCB2bm9kZSk7CiAgICB9CgogICAgdmFyIGV4cGVjdHNDU1MgPSBjc3MgIT09IGZhbHNlICYmICFpc0lFOTsKICAgIHZhciB1c2VyV2FudHNDb250cm9sID0gZ2V0SG9va0FyZ3VtZW50c0xlbmd0aChlbnRlckhvb2spOwoKICAgIHZhciBjYiA9IGVsLl9lbnRlckNiID0gb25jZShmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChleHBlY3RzQ1NTKSB7CiAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCB0b0NsYXNzKTsKICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIGFjdGl2ZUNsYXNzKTsKICAgICAgfQogICAgICBpZiAoY2IuY2FuY2VsbGVkKSB7CiAgICAgICAgaWYgKGV4cGVjdHNDU1MpIHsKICAgICAgICAgIHJlbW92ZVRyYW5zaXRpb25DbGFzcyhlbCwgc3RhcnRDbGFzcyk7CiAgICAgICAgfQogICAgICAgIGVudGVyQ2FuY2VsbGVkSG9vayAmJiBlbnRlckNhbmNlbGxlZEhvb2soZWwpOwogICAgICB9IGVsc2UgewogICAgICAgIGFmdGVyRW50ZXJIb29rICYmIGFmdGVyRW50ZXJIb29rKGVsKTsKICAgICAgfQogICAgICBlbC5fZW50ZXJDYiA9IG51bGw7CiAgICB9KTsKCiAgICBpZiAoIXZub2RlLmRhdGEuc2hvdykgewogICAgICAvLyByZW1vdmUgcGVuZGluZyBsZWF2ZSBlbGVtZW50IG9uIGVudGVyIGJ5IGluamVjdGluZyBhbiBpbnNlcnQgaG9vawogICAgICBtZXJnZVZOb2RlSG9vayh2bm9kZSwgJ2luc2VydCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcGFyZW50ID0gZWwucGFyZW50Tm9kZTsKICAgICAgICB2YXIgcGVuZGluZ05vZGUgPSBwYXJlbnQgJiYgcGFyZW50Ll9wZW5kaW5nICYmIHBhcmVudC5fcGVuZGluZ1t2bm9kZS5rZXldOwogICAgICAgIGlmIChwZW5kaW5nTm9kZSAmJgogICAgICAgICAgcGVuZGluZ05vZGUudGFnID09PSB2bm9kZS50YWcgJiYKICAgICAgICAgIHBlbmRpbmdOb2RlLmVsbS5fbGVhdmVDYgogICAgICAgICkgewogICAgICAgICAgcGVuZGluZ05vZGUuZWxtLl9sZWF2ZUNiKCk7CiAgICAgICAgfQogICAgICAgIGVudGVySG9vayAmJiBlbnRlckhvb2soZWwsIGNiKTsKICAgICAgfSk7CiAgICB9CgogICAgLy8gc3RhcnQgZW50ZXIgdHJhbnNpdGlvbgogICAgYmVmb3JlRW50ZXJIb29rICYmIGJlZm9yZUVudGVySG9vayhlbCk7CiAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIHN0YXJ0Q2xhc3MpOwogICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIGFjdGl2ZUNsYXNzKTsKICAgICAgbmV4dEZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIHN0YXJ0Q2xhc3MpOwogICAgICAgIGlmICghY2IuY2FuY2VsbGVkKSB7CiAgICAgICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIHRvQ2xhc3MpOwogICAgICAgICAgaWYgKCF1c2VyV2FudHNDb250cm9sKSB7CiAgICAgICAgICAgIGlmIChpc1ZhbGlkRHVyYXRpb24oZXhwbGljaXRFbnRlckR1cmF0aW9uKSkgewogICAgICAgICAgICAgIHNldFRpbWVvdXQoY2IsIGV4cGxpY2l0RW50ZXJEdXJhdGlvbik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgd2hlblRyYW5zaXRpb25FbmRzKGVsLCB0eXBlLCBjYik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGlmICh2bm9kZS5kYXRhLnNob3cpIHsKICAgICAgdG9nZ2xlRGlzcGxheSAmJiB0b2dnbGVEaXNwbGF5KCk7CiAgICAgIGVudGVySG9vayAmJiBlbnRlckhvb2soZWwsIGNiKTsKICAgIH0KCiAgICBpZiAoIWV4cGVjdHNDU1MgJiYgIXVzZXJXYW50c0NvbnRyb2wpIHsKICAgICAgY2IoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGxlYXZlICh2bm9kZSwgcm0pIHsKICAgIHZhciBlbCA9IHZub2RlLmVsbTsKCiAgICAvLyBjYWxsIGVudGVyIGNhbGxiYWNrIG5vdwogICAgaWYgKGlzRGVmKGVsLl9lbnRlckNiKSkgewogICAgICBlbC5fZW50ZXJDYi5jYW5jZWxsZWQgPSB0cnVlOwogICAgICBlbC5fZW50ZXJDYigpOwogICAgfQoKICAgIHZhciBkYXRhID0gcmVzb2x2ZVRyYW5zaXRpb24odm5vZGUuZGF0YS50cmFuc2l0aW9uKTsKICAgIGlmIChpc1VuZGVmKGRhdGEpIHx8IGVsLm5vZGVUeXBlICE9PSAxKSB7CiAgICAgIHJldHVybiBybSgpCiAgICB9CgogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNEZWYoZWwuX2xlYXZlQ2IpKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBjc3MgPSBkYXRhLmNzczsKICAgIHZhciB0eXBlID0gZGF0YS50eXBlOwogICAgdmFyIGxlYXZlQ2xhc3MgPSBkYXRhLmxlYXZlQ2xhc3M7CiAgICB2YXIgbGVhdmVUb0NsYXNzID0gZGF0YS5sZWF2ZVRvQ2xhc3M7CiAgICB2YXIgbGVhdmVBY3RpdmVDbGFzcyA9IGRhdGEubGVhdmVBY3RpdmVDbGFzczsKICAgIHZhciBiZWZvcmVMZWF2ZSA9IGRhdGEuYmVmb3JlTGVhdmU7CiAgICB2YXIgbGVhdmUgPSBkYXRhLmxlYXZlOwogICAgdmFyIGFmdGVyTGVhdmUgPSBkYXRhLmFmdGVyTGVhdmU7CiAgICB2YXIgbGVhdmVDYW5jZWxsZWQgPSBkYXRhLmxlYXZlQ2FuY2VsbGVkOwogICAgdmFyIGRlbGF5TGVhdmUgPSBkYXRhLmRlbGF5TGVhdmU7CiAgICB2YXIgZHVyYXRpb24gPSBkYXRhLmR1cmF0aW9uOwoKICAgIHZhciBleHBlY3RzQ1NTID0gY3NzICE9PSBmYWxzZSAmJiAhaXNJRTk7CiAgICB2YXIgdXNlcldhbnRzQ29udHJvbCA9IGdldEhvb2tBcmd1bWVudHNMZW5ndGgobGVhdmUpOwoKICAgIHZhciBleHBsaWNpdExlYXZlRHVyYXRpb24gPSB0b051bWJlcigKICAgICAgaXNPYmplY3QoZHVyYXRpb24pCiAgICAgICAgPyBkdXJhdGlvbi5sZWF2ZQogICAgICAgIDogZHVyYXRpb24KICAgICk7CgogICAgaWYgKGlzRGVmKGV4cGxpY2l0TGVhdmVEdXJhdGlvbikpIHsKICAgICAgY2hlY2tEdXJhdGlvbihleHBsaWNpdExlYXZlRHVyYXRpb24sICdsZWF2ZScsIHZub2RlKTsKICAgIH0KCiAgICB2YXIgY2IgPSBlbC5fbGVhdmVDYiA9IG9uY2UoZnVuY3Rpb24gKCkgewogICAgICBpZiAoZWwucGFyZW50Tm9kZSAmJiBlbC5wYXJlbnROb2RlLl9wZW5kaW5nKSB7CiAgICAgICAgZWwucGFyZW50Tm9kZS5fcGVuZGluZ1t2bm9kZS5rZXldID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICAgIHJlbW92ZVRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVUb0NsYXNzKTsKICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIGxlYXZlQWN0aXZlQ2xhc3MpOwogICAgICB9CiAgICAgIGlmIChjYi5jYW5jZWxsZWQpIHsKICAgICAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCBsZWF2ZUNsYXNzKTsKICAgICAgICB9CiAgICAgICAgbGVhdmVDYW5jZWxsZWQgJiYgbGVhdmVDYW5jZWxsZWQoZWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHJtKCk7CiAgICAgICAgYWZ0ZXJMZWF2ZSAmJiBhZnRlckxlYXZlKGVsKTsKICAgICAgfQogICAgICBlbC5fbGVhdmVDYiA9IG51bGw7CiAgICB9KTsKCiAgICBpZiAoZGVsYXlMZWF2ZSkgewogICAgICBkZWxheUxlYXZlKHBlcmZvcm1MZWF2ZSk7CiAgICB9IGVsc2UgewogICAgICBwZXJmb3JtTGVhdmUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwZXJmb3JtTGVhdmUgKCkgewogICAgICAvLyB0aGUgZGVsYXllZCBsZWF2ZSBtYXkgaGF2ZSBhbHJlYWR5IGJlZW4gY2FuY2VsbGVkCiAgICAgIGlmIChjYi5jYW5jZWxsZWQpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICAvLyByZWNvcmQgbGVhdmluZyBlbGVtZW50CiAgICAgIGlmICghdm5vZGUuZGF0YS5zaG93ICYmIGVsLnBhcmVudE5vZGUpIHsKICAgICAgICAoZWwucGFyZW50Tm9kZS5fcGVuZGluZyB8fCAoZWwucGFyZW50Tm9kZS5fcGVuZGluZyA9IHt9KSlbKHZub2RlLmtleSldID0gdm5vZGU7CiAgICAgIH0KICAgICAgYmVmb3JlTGVhdmUgJiYgYmVmb3JlTGVhdmUoZWwpOwogICAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICAgIGFkZFRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVDbGFzcyk7CiAgICAgICAgYWRkVHJhbnNpdGlvbkNsYXNzKGVsLCBsZWF2ZUFjdGl2ZUNsYXNzKTsKICAgICAgICBuZXh0RnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCBsZWF2ZUNsYXNzKTsKICAgICAgICAgIGlmICghY2IuY2FuY2VsbGVkKSB7CiAgICAgICAgICAgIGFkZFRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVUb0NsYXNzKTsKICAgICAgICAgICAgaWYgKCF1c2VyV2FudHNDb250cm9sKSB7CiAgICAgICAgICAgICAgaWYgKGlzVmFsaWREdXJhdGlvbihleHBsaWNpdExlYXZlRHVyYXRpb24pKSB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNiLCBleHBsaWNpdExlYXZlRHVyYXRpb24pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3aGVuVHJhbnNpdGlvbkVuZHMoZWwsIHR5cGUsIGNiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICBsZWF2ZSAmJiBsZWF2ZShlbCwgY2IpOwogICAgICBpZiAoIWV4cGVjdHNDU1MgJiYgIXVzZXJXYW50c0NvbnRyb2wpIHsKICAgICAgICBjYigpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBvbmx5IHVzZWQgaW4gZGV2IG1vZGUKICBmdW5jdGlvbiBjaGVja0R1cmF0aW9uICh2YWwsIG5hbWUsIHZub2RlKSB7CiAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ251bWJlcicpIHsKICAgICAgd2FybigKICAgICAgICAiPHRyYW5zaXRpb24+IGV4cGxpY2l0ICIgKyBuYW1lICsgIiBkdXJhdGlvbiBpcyBub3QgYSB2YWxpZCBudW1iZXIgLSAiICsKICAgICAgICAiZ290ICIgKyAoSlNPTi5zdHJpbmdpZnkodmFsKSkgKyAiLiIsCiAgICAgICAgdm5vZGUuY29udGV4dAogICAgICApOwogICAgfSBlbHNlIGlmIChpc05hTih2YWwpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgIjx0cmFuc2l0aW9uPiBleHBsaWNpdCAiICsgbmFtZSArICIgZHVyYXRpb24gaXMgTmFOIC0gIiArCiAgICAgICAgJ3RoZSBkdXJhdGlvbiBleHByZXNzaW9uIG1pZ2h0IGJlIGluY29ycmVjdC4nLAogICAgICAgIHZub2RlLmNvbnRleHQKICAgICAgKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzVmFsaWREdXJhdGlvbiAodmFsKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHZhbCkKICB9CgogIC8qKgogICAqIE5vcm1hbGl6ZSBhIHRyYW5zaXRpb24gaG9vaydzIGFyZ3VtZW50IGxlbmd0aC4gVGhlIGhvb2sgbWF5IGJlOgogICAqIC0gYSBtZXJnZWQgaG9vayAoaW52b2tlcikgd2l0aCB0aGUgb3JpZ2luYWwgaW4gLmZucwogICAqIC0gYSB3cmFwcGVkIGNvbXBvbmVudCBtZXRob2QgKGNoZWNrIC5fbGVuZ3RoKQogICAqIC0gYSBwbGFpbiBmdW5jdGlvbiAoLmxlbmd0aCkKICAgKi8KICBmdW5jdGlvbiBnZXRIb29rQXJndW1lbnRzTGVuZ3RoIChmbikgewogICAgaWYgKGlzVW5kZWYoZm4pKSB7CiAgICAgIHJldHVybiBmYWxzZQogICAgfQogICAgdmFyIGludm9rZXJGbnMgPSBmbi5mbnM7CiAgICBpZiAoaXNEZWYoaW52b2tlckZucykpIHsKICAgICAgLy8gaW52b2tlcgogICAgICByZXR1cm4gZ2V0SG9va0FyZ3VtZW50c0xlbmd0aCgKICAgICAgICBBcnJheS5pc0FycmF5KGludm9rZXJGbnMpCiAgICAgICAgICA/IGludm9rZXJGbnNbMF0KICAgICAgICAgIDogaW52b2tlckZucwogICAgICApCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gKGZuLl9sZW5ndGggfHwgZm4ubGVuZ3RoKSA+IDEKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9lbnRlciAoXywgdm5vZGUpIHsKICAgIGlmICh2bm9kZS5kYXRhLnNob3cgIT09IHRydWUpIHsKICAgICAgZW50ZXIodm5vZGUpOwogICAgfQogIH0KCiAgdmFyIHRyYW5zaXRpb24gPSBpbkJyb3dzZXIgPyB7CiAgICBjcmVhdGU6IF9lbnRlciwKICAgIGFjdGl2YXRlOiBfZW50ZXIsCiAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZSQkMSAodm5vZGUsIHJtKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgIGlmICh2bm9kZS5kYXRhLnNob3cgIT09IHRydWUpIHsKICAgICAgICBsZWF2ZSh2bm9kZSwgcm0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJtKCk7CiAgICAgIH0KICAgIH0KICB9IDoge307CgogIHZhciBwbGF0Zm9ybU1vZHVsZXMgPSBbCiAgICBhdHRycywKICAgIGtsYXNzLAogICAgZXZlbnRzLAogICAgZG9tUHJvcHMsCiAgICBzdHlsZSwKICAgIHRyYW5zaXRpb24KICBdOwoKICAvKiAgKi8KCiAgLy8gdGhlIGRpcmVjdGl2ZSBtb2R1bGUgc2hvdWxkIGJlIGFwcGxpZWQgbGFzdCwgYWZ0ZXIgYWxsCiAgLy8gYnVpbHQtaW4gbW9kdWxlcyBoYXZlIGJlZW4gYXBwbGllZC4KICB2YXIgbW9kdWxlcyA9IHBsYXRmb3JtTW9kdWxlcy5jb25jYXQoYmFzZU1vZHVsZXMpOwoKICB2YXIgcGF0Y2ggPSBjcmVhdGVQYXRjaEZ1bmN0aW9uKHsgbm9kZU9wczogbm9kZU9wcywgbW9kdWxlczogbW9kdWxlcyB9KTsKCiAgLyoqCiAgICogTm90IHR5cGUgY2hlY2tpbmcgdGhpcyBmaWxlIGJlY2F1c2UgZmxvdyBkb2Vzbid0IGxpa2UgYXR0YWNoaW5nCiAgICogcHJvcGVydGllcyB0byBFbGVtZW50cy4KICAgKi8KCiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKGlzSUU5KSB7CiAgICAvLyBodHRwOi8vd3d3Lm1hdHRzNDExLmNvbS9wb3N0L2ludGVybmV0LWV4cGxvcmVyLTktb25pbnB1dC8KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3NlbGVjdGlvbmNoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKICAgICAgaWYgKGVsICYmIGVsLnZtb2RlbCkgewogICAgICAgIHRyaWdnZXIoZWwsICdpbnB1dCcpOwogICAgICB9CiAgICB9KTsKICB9CgogIHZhciBkaXJlY3RpdmUgPSB7CiAgICBpbnNlcnRlZDogZnVuY3Rpb24gaW5zZXJ0ZWQgKGVsLCBiaW5kaW5nLCB2bm9kZSwgb2xkVm5vZGUpIHsKICAgICAgaWYgKHZub2RlLnRhZyA9PT0gJ3NlbGVjdCcpIHsKICAgICAgICAvLyAjNjkwMwogICAgICAgIGlmIChvbGRWbm9kZS5lbG0gJiYgIW9sZFZub2RlLmVsbS5fdk9wdGlvbnMpIHsKICAgICAgICAgIG1lcmdlVk5vZGVIb29rKHZub2RlLCAncG9zdHBhdGNoJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkaXJlY3RpdmUuY29tcG9uZW50VXBkYXRlZChlbCwgYmluZGluZywgdm5vZGUpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldFNlbGVjdGVkKGVsLCBiaW5kaW5nLCB2bm9kZS5jb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgZWwuX3ZPcHRpb25zID0gW10ubWFwLmNhbGwoZWwub3B0aW9ucywgZ2V0VmFsdWUpOwogICAgICB9IGVsc2UgaWYgKHZub2RlLnRhZyA9PT0gJ3RleHRhcmVhJyB8fCBpc1RleHRJbnB1dFR5cGUoZWwudHlwZSkpIHsKICAgICAgICBlbC5fdk1vZGlmaWVycyA9IGJpbmRpbmcubW9kaWZpZXJzOwogICAgICAgIGlmICghYmluZGluZy5tb2RpZmllcnMubGF6eSkgewogICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY29tcG9zaXRpb25zdGFydCcsIG9uQ29tcG9zaXRpb25TdGFydCk7CiAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjb21wb3NpdGlvbmVuZCcsIG9uQ29tcG9zaXRpb25FbmQpOwogICAgICAgICAgLy8gU2FmYXJpIDwgMTAuMiAmIFVJV2ViVmlldyBkb2Vzbid0IGZpcmUgY29tcG9zaXRpb25lbmQgd2hlbgogICAgICAgICAgLy8gc3dpdGNoaW5nIGZvY3VzIGJlZm9yZSBjb25maXJtaW5nIGNvbXBvc2l0aW9uIGNob2ljZQogICAgICAgICAgLy8gdGhpcyBhbHNvIGZpeGVzIHRoZSBpc3N1ZSB3aGVyZSBzb21lIGJyb3dzZXJzIGUuZy4gaU9TIENocm9tZQogICAgICAgICAgLy8gZmlyZXMgImNoYW5nZSIgaW5zdGVhZCBvZiAiaW5wdXQiIG9uIGF1dG9jb21wbGV0ZS4KICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQ29tcG9zaXRpb25FbmQpOwogICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgICBpZiAoaXNJRTkpIHsKICAgICAgICAgICAgZWwudm1vZGVsID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgY29tcG9uZW50VXBkYXRlZDogZnVuY3Rpb24gY29tcG9uZW50VXBkYXRlZCAoZWwsIGJpbmRpbmcsIHZub2RlKSB7CiAgICAgIGlmICh2bm9kZS50YWcgPT09ICdzZWxlY3QnKSB7CiAgICAgICAgc2V0U2VsZWN0ZWQoZWwsIGJpbmRpbmcsIHZub2RlLmNvbnRleHQpOwogICAgICAgIC8vIGluIGNhc2UgdGhlIG9wdGlvbnMgcmVuZGVyZWQgYnkgdi1mb3IgaGF2ZSBjaGFuZ2VkLAogICAgICAgIC8vIGl0J3MgcG9zc2libGUgdGhhdCB0aGUgdmFsdWUgaXMgb3V0LW9mLXN5bmMgd2l0aCB0aGUgcmVuZGVyZWQgb3B0aW9ucy4KICAgICAgICAvLyBkZXRlY3Qgc3VjaCBjYXNlcyBhbmQgZmlsdGVyIG91dCB2YWx1ZXMgdGhhdCBubyBsb25nZXIgaGFzIGEgbWF0Y2hpbmcKICAgICAgICAvLyBvcHRpb24gaW4gdGhlIERPTS4KICAgICAgICB2YXIgcHJldk9wdGlvbnMgPSBlbC5fdk9wdGlvbnM7CiAgICAgICAgdmFyIGN1ck9wdGlvbnMgPSBlbC5fdk9wdGlvbnMgPSBbXS5tYXAuY2FsbChlbC5vcHRpb25zLCBnZXRWYWx1ZSk7CiAgICAgICAgaWYgKGN1ck9wdGlvbnMuc29tZShmdW5jdGlvbiAobywgaSkgeyByZXR1cm4gIWxvb3NlRXF1YWwobywgcHJldk9wdGlvbnNbaV0pOyB9KSkgewogICAgICAgICAgLy8gdHJpZ2dlciBjaGFuZ2UgZXZlbnQgaWYKICAgICAgICAgIC8vIG5vIG1hdGNoaW5nIG9wdGlvbiBmb3VuZCBmb3IgYXQgbGVhc3Qgb25lIHZhbHVlCiAgICAgICAgICB2YXIgbmVlZFJlc2V0ID0gZWwubXVsdGlwbGUKICAgICAgICAgICAgPyBiaW5kaW5nLnZhbHVlLnNvbWUoZnVuY3Rpb24gKHYpIHsgcmV0dXJuIGhhc05vTWF0Y2hpbmdPcHRpb24odiwgY3VyT3B0aW9ucyk7IH0pCiAgICAgICAgICAgIDogYmluZGluZy52YWx1ZSAhPT0gYmluZGluZy5vbGRWYWx1ZSAmJiBoYXNOb01hdGNoaW5nT3B0aW9uKGJpbmRpbmcudmFsdWUsIGN1ck9wdGlvbnMpOwogICAgICAgICAgaWYgKG5lZWRSZXNldCkgewogICAgICAgICAgICB0cmlnZ2VyKGVsLCAnY2hhbmdlJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gc2V0U2VsZWN0ZWQgKGVsLCBiaW5kaW5nLCB2bSkgewogICAgYWN0dWFsbHlTZXRTZWxlY3RlZChlbCwgYmluZGluZywgdm0pOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNJRSB8fCBpc0VkZ2UpIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgYWN0dWFsbHlTZXRTZWxlY3RlZChlbCwgYmluZGluZywgdm0pOwogICAgICB9LCAwKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFjdHVhbGx5U2V0U2VsZWN0ZWQgKGVsLCBiaW5kaW5nLCB2bSkgewogICAgdmFyIHZhbHVlID0gYmluZGluZy52YWx1ZTsKICAgIHZhciBpc011bHRpcGxlID0gZWwubXVsdGlwbGU7CiAgICBpZiAoaXNNdWx0aXBsZSAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgd2FybigKICAgICAgICAiPHNlbGVjdCBtdWx0aXBsZSB2LW1vZGVsPVwiIiArIChiaW5kaW5nLmV4cHJlc3Npb24pICsgIlwiPiAiICsKICAgICAgICAiZXhwZWN0cyBhbiBBcnJheSB2YWx1ZSBmb3IgaXRzIGJpbmRpbmcsIGJ1dCBnb3QgIiArIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpLnNsaWNlKDgsIC0xKSksCiAgICAgICAgdm0KICAgICAgKTsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgc2VsZWN0ZWQsIG9wdGlvbjsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gZWwub3B0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgb3B0aW9uID0gZWwub3B0aW9uc1tpXTsKICAgICAgaWYgKGlzTXVsdGlwbGUpIHsKICAgICAgICBzZWxlY3RlZCA9IGxvb3NlSW5kZXhPZih2YWx1ZSwgZ2V0VmFsdWUob3B0aW9uKSkgPiAtMTsKICAgICAgICBpZiAob3B0aW9uLnNlbGVjdGVkICE9PSBzZWxlY3RlZCkgewogICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gc2VsZWN0ZWQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChsb29zZUVxdWFsKGdldFZhbHVlKG9wdGlvbiksIHZhbHVlKSkgewogICAgICAgICAgaWYgKGVsLnNlbGVjdGVkSW5kZXggIT09IGkpIHsKICAgICAgICAgICAgZWwuc2VsZWN0ZWRJbmRleCA9IGk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICghaXNNdWx0aXBsZSkgewogICAgICBlbC5zZWxlY3RlZEluZGV4ID0gLTE7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYXNOb01hdGNoaW5nT3B0aW9uICh2YWx1ZSwgb3B0aW9ucykgewogICAgcmV0dXJuIG9wdGlvbnMuZXZlcnkoZnVuY3Rpb24gKG8pIHsgcmV0dXJuICFsb29zZUVxdWFsKG8sIHZhbHVlKTsgfSkKICB9CgogIGZ1bmN0aW9uIGdldFZhbHVlIChvcHRpb24pIHsKICAgIHJldHVybiAnX3ZhbHVlJyBpbiBvcHRpb24KICAgICAgPyBvcHRpb24uX3ZhbHVlCiAgICAgIDogb3B0aW9uLnZhbHVlCiAgfQoKICBmdW5jdGlvbiBvbkNvbXBvc2l0aW9uU3RhcnQgKGUpIHsKICAgIGUudGFyZ2V0LmNvbXBvc2luZyA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiBvbkNvbXBvc2l0aW9uRW5kIChlKSB7CiAgICAvLyBwcmV2ZW50IHRyaWdnZXJpbmcgYW4gaW5wdXQgZXZlbnQgZm9yIG5vIHJlYXNvbgogICAgaWYgKCFlLnRhcmdldC5jb21wb3NpbmcpIHsgcmV0dXJuIH0KICAgIGUudGFyZ2V0LmNvbXBvc2luZyA9IGZhbHNlOwogICAgdHJpZ2dlcihlLnRhcmdldCwgJ2lucHV0Jyk7CiAgfQoKICBmdW5jdGlvbiB0cmlnZ2VyIChlbCwgdHlwZSkgewogICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpOwogICAgZS5pbml0RXZlbnQodHlwZSwgdHJ1ZSwgdHJ1ZSk7CiAgICBlbC5kaXNwYXRjaEV2ZW50KGUpOwogIH0KCiAgLyogICovCgogIC8vIHJlY3Vyc2l2ZWx5IHNlYXJjaCBmb3IgcG9zc2libGUgdHJhbnNpdGlvbiBkZWZpbmVkIGluc2lkZSB0aGUgY29tcG9uZW50IHJvb3QKICBmdW5jdGlvbiBsb2NhdGVOb2RlICh2bm9kZSkgewogICAgcmV0dXJuIHZub2RlLmNvbXBvbmVudEluc3RhbmNlICYmICghdm5vZGUuZGF0YSB8fCAhdm5vZGUuZGF0YS50cmFuc2l0aW9uKQogICAgICA/IGxvY2F0ZU5vZGUodm5vZGUuY29tcG9uZW50SW5zdGFuY2UuX3Zub2RlKQogICAgICA6IHZub2RlCiAgfQoKICB2YXIgc2hvdyA9IHsKICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQgKGVsLCByZWYsIHZub2RlKSB7CiAgICAgIHZhciB2YWx1ZSA9IHJlZi52YWx1ZTsKCiAgICAgIHZub2RlID0gbG9jYXRlTm9kZSh2bm9kZSk7CiAgICAgIHZhciB0cmFuc2l0aW9uJCQxID0gdm5vZGUuZGF0YSAmJiB2bm9kZS5kYXRhLnRyYW5zaXRpb247CiAgICAgIHZhciBvcmlnaW5hbERpc3BsYXkgPSBlbC5fX3ZPcmlnaW5hbERpc3BsYXkgPQogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJyA/ICcnIDogZWwuc3R5bGUuZGlzcGxheTsKICAgICAgaWYgKHZhbHVlICYmIHRyYW5zaXRpb24kJDEpIHsKICAgICAgICB2bm9kZS5kYXRhLnNob3cgPSB0cnVlOwogICAgICAgIGVudGVyKHZub2RlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gb3JpZ2luYWxEaXNwbGF5OwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSB2YWx1ZSA/IG9yaWdpbmFsRGlzcGxheSA6ICdub25lJzsKICAgICAgfQogICAgfSwKCiAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZSAoZWwsIHJlZiwgdm5vZGUpIHsKICAgICAgdmFyIHZhbHVlID0gcmVmLnZhbHVlOwogICAgICB2YXIgb2xkVmFsdWUgPSByZWYub2xkVmFsdWU7CgogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCF2YWx1ZSA9PT0gIW9sZFZhbHVlKSB7IHJldHVybiB9CiAgICAgIHZub2RlID0gbG9jYXRlTm9kZSh2bm9kZSk7CiAgICAgIHZhciB0cmFuc2l0aW9uJCQxID0gdm5vZGUuZGF0YSAmJiB2bm9kZS5kYXRhLnRyYW5zaXRpb247CiAgICAgIGlmICh0cmFuc2l0aW9uJCQxKSB7CiAgICAgICAgdm5vZGUuZGF0YS5zaG93ID0gdHJ1ZTsKICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgIGVudGVyKHZub2RlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSBlbC5fX3ZPcmlnaW5hbERpc3BsYXk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGVhdmUodm5vZGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gdmFsdWUgPyBlbC5fX3ZPcmlnaW5hbERpc3BsYXkgOiAnbm9uZSc7CiAgICAgIH0KICAgIH0sCgogICAgdW5iaW5kOiBmdW5jdGlvbiB1bmJpbmQgKAogICAgICBlbCwKICAgICAgYmluZGluZywKICAgICAgdm5vZGUsCiAgICAgIG9sZFZub2RlLAogICAgICBpc0Rlc3Ryb3kKICAgICkgewogICAgICBpZiAoIWlzRGVzdHJveSkgewogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSBlbC5fX3ZPcmlnaW5hbERpc3BsYXk7CiAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgcGxhdGZvcm1EaXJlY3RpdmVzID0gewogICAgbW9kZWw6IGRpcmVjdGl2ZSwKICAgIHNob3c6IHNob3cKICB9OwoKICAvKiAgKi8KCiAgdmFyIHRyYW5zaXRpb25Qcm9wcyA9IHsKICAgIG5hbWU6IFN0cmluZywKICAgIGFwcGVhcjogQm9vbGVhbiwKICAgIGNzczogQm9vbGVhbiwKICAgIG1vZGU6IFN0cmluZywKICAgIHR5cGU6IFN0cmluZywKICAgIGVudGVyQ2xhc3M6IFN0cmluZywKICAgIGxlYXZlQ2xhc3M6IFN0cmluZywKICAgIGVudGVyVG9DbGFzczogU3RyaW5nLAogICAgbGVhdmVUb0NsYXNzOiBTdHJpbmcsCiAgICBlbnRlckFjdGl2ZUNsYXNzOiBTdHJpbmcsCiAgICBsZWF2ZUFjdGl2ZUNsYXNzOiBTdHJpbmcsCiAgICBhcHBlYXJDbGFzczogU3RyaW5nLAogICAgYXBwZWFyQWN0aXZlQ2xhc3M6IFN0cmluZywKICAgIGFwcGVhclRvQ2xhc3M6IFN0cmluZywKICAgIGR1cmF0aW9uOiBbTnVtYmVyLCBTdHJpbmcsIE9iamVjdF0KICB9OwoKICAvLyBpbiBjYXNlIHRoZSBjaGlsZCBpcyBhbHNvIGFuIGFic3RyYWN0IGNvbXBvbmVudCwgZS5nLiA8a2VlcC1hbGl2ZT4KICAvLyB3ZSB3YW50IHRvIHJlY3Vyc2l2ZWx5IHJldHJpZXZlIHRoZSByZWFsIGNvbXBvbmVudCB0byBiZSByZW5kZXJlZAogIGZ1bmN0aW9uIGdldFJlYWxDaGlsZCAodm5vZGUpIHsKICAgIHZhciBjb21wT3B0aW9ucyA9IHZub2RlICYmIHZub2RlLmNvbXBvbmVudE9wdGlvbnM7CiAgICBpZiAoY29tcE9wdGlvbnMgJiYgY29tcE9wdGlvbnMuQ3Rvci5vcHRpb25zLmFic3RyYWN0KSB7CiAgICAgIHJldHVybiBnZXRSZWFsQ2hpbGQoZ2V0Rmlyc3RDb21wb25lbnRDaGlsZChjb21wT3B0aW9ucy5jaGlsZHJlbikpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gdm5vZGUKICAgIH0KICB9CgogIGZ1bmN0aW9uIGV4dHJhY3RUcmFuc2l0aW9uRGF0YSAoY29tcCkgewogICAgdmFyIGRhdGEgPSB7fTsKICAgIHZhciBvcHRpb25zID0gY29tcC4kb3B0aW9uczsKICAgIC8vIHByb3BzCiAgICBmb3IgKHZhciBrZXkgaW4gb3B0aW9ucy5wcm9wc0RhdGEpIHsKICAgICAgZGF0YVtrZXldID0gY29tcFtrZXldOwogICAgfQogICAgLy8gZXZlbnRzLgogICAgLy8gZXh0cmFjdCBsaXN0ZW5lcnMgYW5kIHBhc3MgdGhlbSBkaXJlY3RseSB0byB0aGUgdHJhbnNpdGlvbiBtZXRob2RzCiAgICB2YXIgbGlzdGVuZXJzID0gb3B0aW9ucy5fcGFyZW50TGlzdGVuZXJzOwogICAgZm9yICh2YXIga2V5JDEgaW4gbGlzdGVuZXJzKSB7CiAgICAgIGRhdGFbY2FtZWxpemUoa2V5JDEpXSA9IGxpc3RlbmVyc1trZXkkMV07CiAgICB9CiAgICByZXR1cm4gZGF0YQogIH0KCiAgZnVuY3Rpb24gcGxhY2Vob2xkZXIgKGgsIHJhd0NoaWxkKSB7CiAgICBpZiAoL1xkLWtlZXAtYWxpdmUkLy50ZXN0KHJhd0NoaWxkLnRhZykpIHsKICAgICAgcmV0dXJuIGgoJ2tlZXAtYWxpdmUnLCB7CiAgICAgICAgcHJvcHM6IHJhd0NoaWxkLmNvbXBvbmVudE9wdGlvbnMucHJvcHNEYXRhCiAgICAgIH0pCiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYXNQYXJlbnRUcmFuc2l0aW9uICh2bm9kZSkgewogICAgd2hpbGUgKCh2bm9kZSA9IHZub2RlLnBhcmVudCkpIHsKICAgICAgaWYgKHZub2RlLmRhdGEudHJhbnNpdGlvbikgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzU2FtZUNoaWxkIChjaGlsZCwgb2xkQ2hpbGQpIHsKICAgIHJldHVybiBvbGRDaGlsZC5rZXkgPT09IGNoaWxkLmtleSAmJiBvbGRDaGlsZC50YWcgPT09IGNoaWxkLnRhZwogIH0KCiAgdmFyIGlzTm90VGV4dE5vZGUgPSBmdW5jdGlvbiAoYykgeyByZXR1cm4gYy50YWcgfHwgaXNBc3luY1BsYWNlaG9sZGVyKGMpOyB9OwoKICB2YXIgaXNWU2hvd0RpcmVjdGl2ZSA9IGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLm5hbWUgPT09ICdzaG93JzsgfTsKCiAgdmFyIFRyYW5zaXRpb24gPSB7CiAgICBuYW1lOiAndHJhbnNpdGlvbicsCiAgICBwcm9wczogdHJhbnNpdGlvblByb3BzLAogICAgYWJzdHJhY3Q6IHRydWUsCgogICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIgKGgpIHsKICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7CgogICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLiRzbG90cy5kZWZhdWx0OwogICAgICBpZiAoIWNoaWxkcmVuKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIC8vIGZpbHRlciBvdXQgdGV4dCBub2RlcyAocG9zc2libGUgd2hpdGVzcGFjZXMpCiAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uZmlsdGVyKGlzTm90VGV4dE5vZGUpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gd2FybiBtdWx0aXBsZSBlbGVtZW50cwogICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAnPHRyYW5zaXRpb24+IGNhbiBvbmx5IGJlIHVzZWQgb24gYSBzaW5nbGUgZWxlbWVudC4gVXNlICcgKwogICAgICAgICAgJzx0cmFuc2l0aW9uLWdyb3VwPiBmb3IgbGlzdHMuJywKICAgICAgICAgIHRoaXMuJHBhcmVudAogICAgICAgICk7CiAgICAgIH0KCiAgICAgIHZhciBtb2RlID0gdGhpcy5tb2RlOwoKICAgICAgLy8gd2FybiBpbnZhbGlkIG1vZGUKICAgICAgaWYgKG1vZGUgJiYgbW9kZSAhPT0gJ2luLW91dCcgJiYgbW9kZSAhPT0gJ291dC1pbicKICAgICAgKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdpbnZhbGlkIDx0cmFuc2l0aW9uPiBtb2RlOiAnICsgbW9kZSwKICAgICAgICAgIHRoaXMuJHBhcmVudAogICAgICAgICk7CiAgICAgIH0KCiAgICAgIHZhciByYXdDaGlsZCA9IGNoaWxkcmVuWzBdOwoKICAgICAgLy8gaWYgdGhpcyBpcyBhIGNvbXBvbmVudCByb290IG5vZGUgYW5kIHRoZSBjb21wb25lbnQncwogICAgICAvLyBwYXJlbnQgY29udGFpbmVyIG5vZGUgYWxzbyBoYXMgdHJhbnNpdGlvbiwgc2tpcC4KICAgICAgaWYgKGhhc1BhcmVudFRyYW5zaXRpb24odGhpcy4kdm5vZGUpKSB7CiAgICAgICAgcmV0dXJuIHJhd0NoaWxkCiAgICAgIH0KCiAgICAgIC8vIGFwcGx5IHRyYW5zaXRpb24gZGF0YSB0byBjaGlsZAogICAgICAvLyB1c2UgZ2V0UmVhbENoaWxkKCkgdG8gaWdub3JlIGFic3RyYWN0IGNvbXBvbmVudHMgZS5nLiBrZWVwLWFsaXZlCiAgICAgIHZhciBjaGlsZCA9IGdldFJlYWxDaGlsZChyYXdDaGlsZCk7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoIWNoaWxkKSB7CiAgICAgICAgcmV0dXJuIHJhd0NoaWxkCiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9sZWF2aW5nKSB7CiAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyKGgsIHJhd0NoaWxkKQogICAgICB9CgogICAgICAvLyBlbnN1cmUgYSBrZXkgdGhhdCBpcyB1bmlxdWUgdG8gdGhlIHZub2RlIHR5cGUgYW5kIHRvIHRoaXMgdHJhbnNpdGlvbgogICAgICAvLyBjb21wb25lbnQgaW5zdGFuY2UuIFRoaXMga2V5IHdpbGwgYmUgdXNlZCB0byByZW1vdmUgcGVuZGluZyBsZWF2aW5nIG5vZGVzCiAgICAgIC8vIGR1cmluZyBlbnRlcmluZy4KICAgICAgdmFyIGlkID0gIl9fdHJhbnNpdGlvbi0iICsgKHRoaXMuX3VpZCkgKyAiLSI7CiAgICAgIGNoaWxkLmtleSA9IGNoaWxkLmtleSA9PSBudWxsCiAgICAgICAgPyBjaGlsZC5pc0NvbW1lbnQKICAgICAgICAgID8gaWQgKyAnY29tbWVudCcKICAgICAgICAgIDogaWQgKyBjaGlsZC50YWcKICAgICAgICA6IGlzUHJpbWl0aXZlKGNoaWxkLmtleSkKICAgICAgICAgID8gKFN0cmluZyhjaGlsZC5rZXkpLmluZGV4T2YoaWQpID09PSAwID8gY2hpbGQua2V5IDogaWQgKyBjaGlsZC5rZXkpCiAgICAgICAgICA6IGNoaWxkLmtleTsKCiAgICAgIHZhciBkYXRhID0gKGNoaWxkLmRhdGEgfHwgKGNoaWxkLmRhdGEgPSB7fSkpLnRyYW5zaXRpb24gPSBleHRyYWN0VHJhbnNpdGlvbkRhdGEodGhpcyk7CiAgICAgIHZhciBvbGRSYXdDaGlsZCA9IHRoaXMuX3Zub2RlOwogICAgICB2YXIgb2xkQ2hpbGQgPSBnZXRSZWFsQ2hpbGQob2xkUmF3Q2hpbGQpOwoKICAgICAgLy8gbWFyayB2LXNob3cKICAgICAgLy8gc28gdGhhdCB0aGUgdHJhbnNpdGlvbiBtb2R1bGUgY2FuIGhhbmQgb3ZlciB0aGUgY29udHJvbCB0byB0aGUgZGlyZWN0aXZlCiAgICAgIGlmIChjaGlsZC5kYXRhLmRpcmVjdGl2ZXMgJiYgY2hpbGQuZGF0YS5kaXJlY3RpdmVzLnNvbWUoaXNWU2hvd0RpcmVjdGl2ZSkpIHsKICAgICAgICBjaGlsZC5kYXRhLnNob3cgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAoCiAgICAgICAgb2xkQ2hpbGQgJiYKICAgICAgICBvbGRDaGlsZC5kYXRhICYmCiAgICAgICAgIWlzU2FtZUNoaWxkKGNoaWxkLCBvbGRDaGlsZCkgJiYKICAgICAgICAhaXNBc3luY1BsYWNlaG9sZGVyKG9sZENoaWxkKSAmJgogICAgICAgIC8vICM2Njg3IGNvbXBvbmVudCByb290IGlzIGEgY29tbWVudCBub2RlCiAgICAgICAgIShvbGRDaGlsZC5jb21wb25lbnRJbnN0YW5jZSAmJiBvbGRDaGlsZC5jb21wb25lbnRJbnN0YW5jZS5fdm5vZGUuaXNDb21tZW50KQogICAgICApIHsKICAgICAgICAvLyByZXBsYWNlIG9sZCBjaGlsZCB0cmFuc2l0aW9uIGRhdGEgd2l0aCBmcmVzaCBvbmUKICAgICAgICAvLyBpbXBvcnRhbnQgZm9yIGR5bmFtaWMgdHJhbnNpdGlvbnMhCiAgICAgICAgdmFyIG9sZERhdGEgPSBvbGRDaGlsZC5kYXRhLnRyYW5zaXRpb24gPSBleHRlbmQoe30sIGRhdGEpOwogICAgICAgIC8vIGhhbmRsZSB0cmFuc2l0aW9uIG1vZGUKICAgICAgICBpZiAobW9kZSA9PT0gJ291dC1pbicpIHsKICAgICAgICAgIC8vIHJldHVybiBwbGFjZWhvbGRlciBub2RlIGFuZCBxdWV1ZSB1cGRhdGUgd2hlbiBsZWF2ZSBmaW5pc2hlcwogICAgICAgICAgdGhpcy5fbGVhdmluZyA9IHRydWU7CiAgICAgICAgICBtZXJnZVZOb2RlSG9vayhvbGREYXRhLCAnYWZ0ZXJMZWF2ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcyQxLl9sZWF2aW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMkMS4kZm9yY2VVcGRhdGUoKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyKGgsIHJhd0NoaWxkKQogICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ2luLW91dCcpIHsKICAgICAgICAgIGlmIChpc0FzeW5jUGxhY2Vob2xkZXIoY2hpbGQpKSB7CiAgICAgICAgICAgIHJldHVybiBvbGRSYXdDaGlsZAogICAgICAgICAgfQogICAgICAgICAgdmFyIGRlbGF5ZWRMZWF2ZTsKICAgICAgICAgIHZhciBwZXJmb3JtTGVhdmUgPSBmdW5jdGlvbiAoKSB7IGRlbGF5ZWRMZWF2ZSgpOyB9OwogICAgICAgICAgbWVyZ2VWTm9kZUhvb2soZGF0YSwgJ2FmdGVyRW50ZXInLCBwZXJmb3JtTGVhdmUpOwogICAgICAgICAgbWVyZ2VWTm9kZUhvb2soZGF0YSwgJ2VudGVyQ2FuY2VsbGVkJywgcGVyZm9ybUxlYXZlKTsKICAgICAgICAgIG1lcmdlVk5vZGVIb29rKG9sZERhdGEsICdkZWxheUxlYXZlJywgZnVuY3Rpb24gKGxlYXZlKSB7IGRlbGF5ZWRMZWF2ZSA9IGxlYXZlOyB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByYXdDaGlsZAogICAgfQogIH07CgogIC8qICAqLwoKICB2YXIgcHJvcHMgPSBleHRlbmQoewogICAgdGFnOiBTdHJpbmcsCiAgICBtb3ZlQ2xhc3M6IFN0cmluZwogIH0sIHRyYW5zaXRpb25Qcm9wcyk7CgogIGRlbGV0ZSBwcm9wcy5tb2RlOwoKICB2YXIgVHJhbnNpdGlvbkdyb3VwID0gewogICAgcHJvcHM6IHByb3BzLAoKICAgIGJlZm9yZU1vdW50OiBmdW5jdGlvbiBiZWZvcmVNb3VudCAoKSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwoKICAgICAgdmFyIHVwZGF0ZSA9IHRoaXMuX3VwZGF0ZTsKICAgICAgdGhpcy5fdXBkYXRlID0gZnVuY3Rpb24gKHZub2RlLCBoeWRyYXRpbmcpIHsKICAgICAgICB2YXIgcmVzdG9yZUFjdGl2ZUluc3RhbmNlID0gc2V0QWN0aXZlSW5zdGFuY2UodGhpcyQxKTsKICAgICAgICAvLyBmb3JjZSByZW1vdmluZyBwYXNzCiAgICAgICAgdGhpcyQxLl9fcGF0Y2hfXygKICAgICAgICAgIHRoaXMkMS5fdm5vZGUsCiAgICAgICAgICB0aGlzJDEua2VwdCwKICAgICAgICAgIGZhbHNlLCAvLyBoeWRyYXRpbmcKICAgICAgICAgIHRydWUgLy8gcmVtb3ZlT25seSAoIWltcG9ydGFudCwgYXZvaWRzIHVubmVjZXNzYXJ5IG1vdmVzKQogICAgICAgICk7CiAgICAgICAgdGhpcyQxLl92bm9kZSA9IHRoaXMkMS5rZXB0OwogICAgICAgIHJlc3RvcmVBY3RpdmVJbnN0YW5jZSgpOwogICAgICAgIHVwZGF0ZS5jYWxsKHRoaXMkMSwgdm5vZGUsIGh5ZHJhdGluZyk7CiAgICAgIH07CiAgICB9LAoKICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyIChoKSB7CiAgICAgIHZhciB0YWcgPSB0aGlzLnRhZyB8fCB0aGlzLiR2bm9kZS5kYXRhLnRhZyB8fCAnc3Bhbic7CiAgICAgIHZhciBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB2YXIgcHJldkNoaWxkcmVuID0gdGhpcy5wcmV2Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICB2YXIgcmF3Q2hpbGRyZW4gPSB0aGlzLiRzbG90cy5kZWZhdWx0IHx8IFtdOwogICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuID0gW107CiAgICAgIHZhciB0cmFuc2l0aW9uRGF0YSA9IGV4dHJhY3RUcmFuc2l0aW9uRGF0YSh0aGlzKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmF3Q2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgYyA9IHJhd0NoaWxkcmVuW2ldOwogICAgICAgIGlmIChjLnRhZykgewogICAgICAgICAgaWYgKGMua2V5ICE9IG51bGwgJiYgU3RyaW5nKGMua2V5KS5pbmRleE9mKCdfX3ZsaXN0JykgIT09IDApIHsKICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChjKTsKICAgICAgICAgICAgbWFwW2Mua2V5XSA9IGMKICAgICAgICAgICAgOyhjLmRhdGEgfHwgKGMuZGF0YSA9IHt9KSkudHJhbnNpdGlvbiA9IHRyYW5zaXRpb25EYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG9wdHMgPSBjLmNvbXBvbmVudE9wdGlvbnM7CiAgICAgICAgICAgIHZhciBuYW1lID0gb3B0cyA/IChvcHRzLkN0b3Iub3B0aW9ucy5uYW1lIHx8IG9wdHMudGFnIHx8ICcnKSA6IGMudGFnOwogICAgICAgICAgICB3YXJuKCgiPHRyYW5zaXRpb24tZ3JvdXA+IGNoaWxkcmVuIG11c3QgYmUga2V5ZWQ6IDwiICsgbmFtZSArICI+IikpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHByZXZDaGlsZHJlbikgewogICAgICAgIHZhciBrZXB0ID0gW107CiAgICAgICAgdmFyIHJlbW92ZWQgPSBbXTsKICAgICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBwcmV2Q2hpbGRyZW4ubGVuZ3RoOyBpJDErKykgewogICAgICAgICAgdmFyIGMkMSA9IHByZXZDaGlsZHJlbltpJDFdOwogICAgICAgICAgYyQxLmRhdGEudHJhbnNpdGlvbiA9IHRyYW5zaXRpb25EYXRhOwogICAgICAgICAgYyQxLmRhdGEucG9zID0gYyQxLmVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgIGlmIChtYXBbYyQxLmtleV0pIHsKICAgICAgICAgICAga2VwdC5wdXNoKGMkMSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZW1vdmVkLnB1c2goYyQxKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5rZXB0ID0gaCh0YWcsIG51bGwsIGtlcHQpOwogICAgICAgIHRoaXMucmVtb3ZlZCA9IHJlbW92ZWQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBoKHRhZywgbnVsbCwgY2hpbGRyZW4pCiAgICB9LAoKICAgIHVwZGF0ZWQ6IGZ1bmN0aW9uIHVwZGF0ZWQgKCkgewogICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLnByZXZDaGlsZHJlbjsKICAgICAgdmFyIG1vdmVDbGFzcyA9IHRoaXMubW92ZUNsYXNzIHx8ICgodGhpcy5uYW1lIHx8ICd2JykgKyAnLW1vdmUnKTsKICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGggfHwgIXRoaXMuaGFzTW92ZShjaGlsZHJlblswXS5lbG0sIG1vdmVDbGFzcykpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gd2UgZGl2aWRlIHRoZSB3b3JrIGludG8gdGhyZWUgbG9vcHMgdG8gYXZvaWQgbWl4aW5nIERPTSByZWFkcyBhbmQgd3JpdGVzCiAgICAgIC8vIGluIGVhY2ggaXRlcmF0aW9uIC0gd2hpY2ggaGVscHMgcHJldmVudCBsYXlvdXQgdGhyYXNoaW5nLgogICAgICBjaGlsZHJlbi5mb3JFYWNoKGNhbGxQZW5kaW5nQ2JzKTsKICAgICAgY2hpbGRyZW4uZm9yRWFjaChyZWNvcmRQb3NpdGlvbik7CiAgICAgIGNoaWxkcmVuLmZvckVhY2goYXBwbHlUcmFuc2xhdGlvbik7CgogICAgICAvLyBmb3JjZSByZWZsb3cgdG8gcHV0IGV2ZXJ5dGhpbmcgaW4gcG9zaXRpb24KICAgICAgLy8gYXNzaWduIHRvIHRoaXMgdG8gYXZvaWQgYmVpbmcgcmVtb3ZlZCBpbiB0cmVlLXNoYWtpbmcKICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgIHRoaXMuX3JlZmxvdyA9IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0OwoKICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykgewogICAgICAgIGlmIChjLmRhdGEubW92ZWQpIHsKICAgICAgICAgIHZhciBlbCA9IGMuZWxtOwogICAgICAgICAgdmFyIHMgPSBlbC5zdHlsZTsKICAgICAgICAgIGFkZFRyYW5zaXRpb25DbGFzcyhlbCwgbW92ZUNsYXNzKTsKICAgICAgICAgIHMudHJhbnNmb3JtID0gcy5XZWJraXRUcmFuc2Zvcm0gPSBzLnRyYW5zaXRpb25EdXJhdGlvbiA9ICcnOwogICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcih0cmFuc2l0aW9uRW5kRXZlbnQsIGVsLl9tb3ZlQ2IgPSBmdW5jdGlvbiBjYiAoZSkgewogICAgICAgICAgICBpZiAoZSAmJiBlLnRhcmdldCAhPT0gZWwpIHsKICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWUgfHwgL3RyYW5zZm9ybSQvLnRlc3QoZS5wcm9wZXJ0eU5hbWUpKSB7CiAgICAgICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcih0cmFuc2l0aW9uRW5kRXZlbnQsIGNiKTsKICAgICAgICAgICAgICBlbC5fbW92ZUNiID0gbnVsbDsKICAgICAgICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIG1vdmVDbGFzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIG1ldGhvZHM6IHsKICAgICAgaGFzTW92ZTogZnVuY3Rpb24gaGFzTW92ZSAoZWwsIG1vdmVDbGFzcykgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmICghaGFzVHJhbnNpdGlvbikgewogICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmICh0aGlzLl9oYXNNb3ZlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faGFzTW92ZQogICAgICAgIH0KICAgICAgICAvLyBEZXRlY3Qgd2hldGhlciBhbiBlbGVtZW50IHdpdGggdGhlIG1vdmUgY2xhc3MgYXBwbGllZCBoYXMKICAgICAgICAvLyBDU1MgdHJhbnNpdGlvbnMuIFNpbmNlIHRoZSBlbGVtZW50IG1heSBiZSBpbnNpZGUgYW4gZW50ZXJpbmcKICAgICAgICAvLyB0cmFuc2l0aW9uIGF0IHRoaXMgdmVyeSBtb21lbnQsIHdlIG1ha2UgYSBjbG9uZSBvZiBpdCBhbmQgcmVtb3ZlCiAgICAgICAgLy8gYWxsIG90aGVyIHRyYW5zaXRpb24gY2xhc3NlcyBhcHBsaWVkIHRvIGVuc3VyZSBvbmx5IHRoZSBtb3ZlIGNsYXNzCiAgICAgICAgLy8gaXMgYXBwbGllZC4KICAgICAgICB2YXIgY2xvbmUgPSBlbC5jbG9uZU5vZGUoKTsKICAgICAgICBpZiAoZWwuX3RyYW5zaXRpb25DbGFzc2VzKSB7CiAgICAgICAgICBlbC5fdHJhbnNpdGlvbkNsYXNzZXMuZm9yRWFjaChmdW5jdGlvbiAoY2xzKSB7IHJlbW92ZUNsYXNzKGNsb25lLCBjbHMpOyB9KTsKICAgICAgICB9CiAgICAgICAgYWRkQ2xhc3MoY2xvbmUsIG1vdmVDbGFzcyk7CiAgICAgICAgY2xvbmUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB0aGlzLiRlbC5hcHBlbmRDaGlsZChjbG9uZSk7CiAgICAgICAgdmFyIGluZm8gPSBnZXRUcmFuc2l0aW9uSW5mbyhjbG9uZSk7CiAgICAgICAgdGhpcy4kZWwucmVtb3ZlQ2hpbGQoY2xvbmUpOwogICAgICAgIHJldHVybiAodGhpcy5faGFzTW92ZSA9IGluZm8uaGFzVHJhbnNmb3JtKQogICAgICB9CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gY2FsbFBlbmRpbmdDYnMgKGMpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGMuZWxtLl9tb3ZlQ2IpIHsKICAgICAgYy5lbG0uX21vdmVDYigpOwogICAgfQogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoYy5lbG0uX2VudGVyQ2IpIHsKICAgICAgYy5lbG0uX2VudGVyQ2IoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlY29yZFBvc2l0aW9uIChjKSB7CiAgICBjLmRhdGEubmV3UG9zID0gYy5lbG0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgfQoKICBmdW5jdGlvbiBhcHBseVRyYW5zbGF0aW9uIChjKSB7CiAgICB2YXIgb2xkUG9zID0gYy5kYXRhLnBvczsKICAgIHZhciBuZXdQb3MgPSBjLmRhdGEubmV3UG9zOwogICAgdmFyIGR4ID0gb2xkUG9zLmxlZnQgLSBuZXdQb3MubGVmdDsKICAgIHZhciBkeSA9IG9sZFBvcy50b3AgLSBuZXdQb3MudG9wOwogICAgaWYgKGR4IHx8IGR5KSB7CiAgICAgIGMuZGF0YS5tb3ZlZCA9IHRydWU7CiAgICAgIHZhciBzID0gYy5lbG0uc3R5bGU7CiAgICAgIHMudHJhbnNmb3JtID0gcy5XZWJraXRUcmFuc2Zvcm0gPSAidHJhbnNsYXRlKCIgKyBkeCArICJweCwiICsgZHkgKyAicHgpIjsKICAgICAgcy50cmFuc2l0aW9uRHVyYXRpb24gPSAnMHMnOwogICAgfQogIH0KCiAgdmFyIHBsYXRmb3JtQ29tcG9uZW50cyA9IHsKICAgIFRyYW5zaXRpb246IFRyYW5zaXRpb24sCiAgICBUcmFuc2l0aW9uR3JvdXA6IFRyYW5zaXRpb25Hcm91cAogIH07CgogIC8qICAqLwoKICAvLyBpbnN0YWxsIHBsYXRmb3JtIHNwZWNpZmljIHV0aWxzCiAgVnVlLmNvbmZpZy5tdXN0VXNlUHJvcCA9IG11c3RVc2VQcm9wOwogIFZ1ZS5jb25maWcuaXNSZXNlcnZlZFRhZyA9IGlzUmVzZXJ2ZWRUYWc7CiAgVnVlLmNvbmZpZy5pc1Jlc2VydmVkQXR0ciA9IGlzUmVzZXJ2ZWRBdHRyOwogIFZ1ZS5jb25maWcuZ2V0VGFnTmFtZXNwYWNlID0gZ2V0VGFnTmFtZXNwYWNlOwogIFZ1ZS5jb25maWcuaXNVbmtub3duRWxlbWVudCA9IGlzVW5rbm93bkVsZW1lbnQ7CgogIC8vIGluc3RhbGwgcGxhdGZvcm0gcnVudGltZSBkaXJlY3RpdmVzICYgY29tcG9uZW50cwogIGV4dGVuZChWdWUub3B0aW9ucy5kaXJlY3RpdmVzLCBwbGF0Zm9ybURpcmVjdGl2ZXMpOwogIGV4dGVuZChWdWUub3B0aW9ucy5jb21wb25lbnRzLCBwbGF0Zm9ybUNvbXBvbmVudHMpOwoKICAvLyBpbnN0YWxsIHBsYXRmb3JtIHBhdGNoIGZ1bmN0aW9uCiAgVnVlLnByb3RvdHlwZS5fX3BhdGNoX18gPSBpbkJyb3dzZXIgPyBwYXRjaCA6IG5vb3A7CgogIC8vIHB1YmxpYyBtb3VudCBtZXRob2QKICBWdWUucHJvdG90eXBlLiRtb3VudCA9IGZ1bmN0aW9uICgKICAgIGVsLAogICAgaHlkcmF0aW5nCiAgKSB7CiAgICBlbCA9IGVsICYmIGluQnJvd3NlciA/IHF1ZXJ5KGVsKSA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBtb3VudENvbXBvbmVudCh0aGlzLCBlbCwgaHlkcmF0aW5nKQogIH07CgogIC8vIGRldnRvb2xzIGdsb2JhbCBob29rCiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICBpZiAoaW5Ccm93c2VyKSB7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKGNvbmZpZy5kZXZ0b29scykgewogICAgICAgIGlmIChkZXZ0b29scykgewogICAgICAgICAgZGV2dG9vbHMuZW1pdCgnaW5pdCcsIFZ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGVbY29uc29sZS5pbmZvID8gJ2luZm8nIDogJ2xvZyddKAogICAgICAgICAgICAnRG93bmxvYWQgdGhlIFZ1ZSBEZXZ0b29scyBleHRlbnNpb24gZm9yIGEgYmV0dGVyIGRldmVsb3BtZW50IGV4cGVyaWVuY2U6XG4nICsKICAgICAgICAgICAgJ2h0dHBzOi8vZ2l0aHViLmNvbS92dWVqcy92dWUtZGV2dG9vbHMnCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY29uZmlnLnByb2R1Y3Rpb25UaXAgIT09IGZhbHNlICYmCiAgICAgICAgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnCiAgICAgICkgewogICAgICAgIGNvbnNvbGVbY29uc29sZS5pbmZvID8gJ2luZm8nIDogJ2xvZyddKAogICAgICAgICAgIllvdSBhcmUgcnVubmluZyBWdWUgaW4gZGV2ZWxvcG1lbnQgbW9kZS5cbiIgKwogICAgICAgICAgIk1ha2Ugc3VyZSB0byB0dXJuIG9uIHByb2R1Y3Rpb24gbW9kZSB3aGVuIGRlcGxveWluZyBmb3IgcHJvZHVjdGlvbi5cbiIgKwogICAgICAgICAgIlNlZSBtb3JlIHRpcHMgYXQgaHR0cHM6Ly92dWVqcy5vcmcvZ3VpZGUvZGVwbG95bWVudC5odG1sIgogICAgICAgICk7CiAgICAgIH0KICAgIH0sIDApOwogIH0KCiAgLyogICovCgogIHZhciBkZWZhdWx0VGFnUkUgPSAvXHtceygoPzoufFxyP1xuKSs/KVx9XH0vZzsKICB2YXIgcmVnZXhFc2NhcGVSRSA9IC9bLS4qKz9eJHt9KCl8W1xdXC9cXF0vZzsKCiAgdmFyIGJ1aWxkUmVnZXggPSBjYWNoZWQoZnVuY3Rpb24gKGRlbGltaXRlcnMpIHsKICAgIHZhciBvcGVuID0gZGVsaW1pdGVyc1swXS5yZXBsYWNlKHJlZ2V4RXNjYXBlUkUsICdcXCQmJyk7CiAgICB2YXIgY2xvc2UgPSBkZWxpbWl0ZXJzWzFdLnJlcGxhY2UocmVnZXhFc2NhcGVSRSwgJ1xcJCYnKTsKICAgIHJldHVybiBuZXcgUmVnRXhwKG9wZW4gKyAnKCg/Oi58XFxuKSs/KScgKyBjbG9zZSwgJ2cnKQogIH0pOwoKCgogIGZ1bmN0aW9uIHBhcnNlVGV4dCAoCiAgICB0ZXh0LAogICAgZGVsaW1pdGVycwogICkgewogICAgdmFyIHRhZ1JFID0gZGVsaW1pdGVycyA/IGJ1aWxkUmVnZXgoZGVsaW1pdGVycykgOiBkZWZhdWx0VGFnUkU7CiAgICBpZiAoIXRhZ1JFLnRlc3QodGV4dCkpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgdG9rZW5zID0gW107CiAgICB2YXIgcmF3VG9rZW5zID0gW107CiAgICB2YXIgbGFzdEluZGV4ID0gdGFnUkUubGFzdEluZGV4ID0gMDsKICAgIHZhciBtYXRjaCwgaW5kZXgsIHRva2VuVmFsdWU7CiAgICB3aGlsZSAoKG1hdGNoID0gdGFnUkUuZXhlYyh0ZXh0KSkpIHsKICAgICAgaW5kZXggPSBtYXRjaC5pbmRleDsKICAgICAgLy8gcHVzaCB0ZXh0IHRva2VuCiAgICAgIGlmIChpbmRleCA+IGxhc3RJbmRleCkgewogICAgICAgIHJhd1Rva2Vucy5wdXNoKHRva2VuVmFsdWUgPSB0ZXh0LnNsaWNlKGxhc3RJbmRleCwgaW5kZXgpKTsKICAgICAgICB0b2tlbnMucHVzaChKU09OLnN0cmluZ2lmeSh0b2tlblZhbHVlKSk7CiAgICAgIH0KICAgICAgLy8gdGFnIHRva2VuCiAgICAgIHZhciBleHAgPSBwYXJzZUZpbHRlcnMobWF0Y2hbMV0udHJpbSgpKTsKICAgICAgdG9rZW5zLnB1c2goKCJfcygiICsgZXhwICsgIikiKSk7CiAgICAgIHJhd1Rva2Vucy5wdXNoKHsgJ0BiaW5kaW5nJzogZXhwIH0pOwogICAgICBsYXN0SW5kZXggPSBpbmRleCArIG1hdGNoWzBdLmxlbmd0aDsKICAgIH0KICAgIGlmIChsYXN0SW5kZXggPCB0ZXh0Lmxlbmd0aCkgewogICAgICByYXdUb2tlbnMucHVzaCh0b2tlblZhbHVlID0gdGV4dC5zbGljZShsYXN0SW5kZXgpKTsKICAgICAgdG9rZW5zLnB1c2goSlNPTi5zdHJpbmdpZnkodG9rZW5WYWx1ZSkpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgZXhwcmVzc2lvbjogdG9rZW5zLmpvaW4oJysnKSwKICAgICAgdG9rZW5zOiByYXdUb2tlbnMKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiB0cmFuc2Zvcm1Ob2RlIChlbCwgb3B0aW9ucykgewogICAgdmFyIHdhcm4gPSBvcHRpb25zLndhcm4gfHwgYmFzZVdhcm47CiAgICB2YXIgc3RhdGljQ2xhc3MgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAnY2xhc3MnKTsKICAgIGlmIChzdGF0aWNDbGFzcykgewogICAgICB2YXIgcmVzID0gcGFyc2VUZXh0KHN0YXRpY0NsYXNzLCBvcHRpb25zLmRlbGltaXRlcnMpOwogICAgICBpZiAocmVzKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICJjbGFzcz1cIiIgKyBzdGF0aWNDbGFzcyArICJcIjogIiArCiAgICAgICAgICAnSW50ZXJwb2xhdGlvbiBpbnNpZGUgYXR0cmlidXRlcyBoYXMgYmVlbiByZW1vdmVkLiAnICsKICAgICAgICAgICdVc2Ugdi1iaW5kIG9yIHRoZSBjb2xvbiBzaG9ydGhhbmQgaW5zdGVhZC4gRm9yIGV4YW1wbGUsICcgKwogICAgICAgICAgJ2luc3RlYWQgb2YgPGRpdiBjbGFzcz0ie3sgdmFsIH19Ij4sIHVzZSA8ZGl2IDpjbGFzcz0idmFsIj4uJywKICAgICAgICAgIGVsLnJhd0F0dHJzTWFwWydjbGFzcyddCiAgICAgICAgKTsKICAgICAgfQogICAgfQogICAgaWYgKHN0YXRpY0NsYXNzKSB7CiAgICAgIGVsLnN0YXRpY0NsYXNzID0gSlNPTi5zdHJpbmdpZnkoc3RhdGljQ2xhc3MpOwogICAgfQogICAgdmFyIGNsYXNzQmluZGluZyA9IGdldEJpbmRpbmdBdHRyKGVsLCAnY2xhc3MnLCBmYWxzZSAvKiBnZXRTdGF0aWMgKi8pOwogICAgaWYgKGNsYXNzQmluZGluZykgewogICAgICBlbC5jbGFzc0JpbmRpbmcgPSBjbGFzc0JpbmRpbmc7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5EYXRhIChlbCkgewogICAgdmFyIGRhdGEgPSAnJzsKICAgIGlmIChlbC5zdGF0aWNDbGFzcykgewogICAgICBkYXRhICs9ICJzdGF0aWNDbGFzczoiICsgKGVsLnN0YXRpY0NsYXNzKSArICIsIjsKICAgIH0KICAgIGlmIChlbC5jbGFzc0JpbmRpbmcpIHsKICAgICAgZGF0YSArPSAiY2xhc3M6IiArIChlbC5jbGFzc0JpbmRpbmcpICsgIiwiOwogICAgfQogICAgcmV0dXJuIGRhdGEKICB9CgogIHZhciBrbGFzcyQxID0gewogICAgc3RhdGljS2V5czogWydzdGF0aWNDbGFzcyddLAogICAgdHJhbnNmb3JtTm9kZTogdHJhbnNmb3JtTm9kZSwKICAgIGdlbkRhdGE6IGdlbkRhdGEKICB9OwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gdHJhbnNmb3JtTm9kZSQxIChlbCwgb3B0aW9ucykgewogICAgdmFyIHdhcm4gPSBvcHRpb25zLndhcm4gfHwgYmFzZVdhcm47CiAgICB2YXIgc3RhdGljU3R5bGUgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAnc3R5bGUnKTsKICAgIGlmIChzdGF0aWNTdHlsZSkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgewogICAgICAgIHZhciByZXMgPSBwYXJzZVRleHQoc3RhdGljU3R5bGUsIG9wdGlvbnMuZGVsaW1pdGVycyk7CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgInN0eWxlPVwiIiArIHN0YXRpY1N0eWxlICsgIlwiOiAiICsKICAgICAgICAgICAgJ0ludGVycG9sYXRpb24gaW5zaWRlIGF0dHJpYnV0ZXMgaGFzIGJlZW4gcmVtb3ZlZC4gJyArCiAgICAgICAgICAgICdVc2Ugdi1iaW5kIG9yIHRoZSBjb2xvbiBzaG9ydGhhbmQgaW5zdGVhZC4gRm9yIGV4YW1wbGUsICcgKwogICAgICAgICAgICAnaW5zdGVhZCBvZiA8ZGl2IHN0eWxlPSJ7eyB2YWwgfX0iPiwgdXNlIDxkaXYgOnN0eWxlPSJ2YWwiPi4nLAogICAgICAgICAgICBlbC5yYXdBdHRyc01hcFsnc3R5bGUnXQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWwuc3RhdGljU3R5bGUgPSBKU09OLnN0cmluZ2lmeShwYXJzZVN0eWxlVGV4dChzdGF0aWNTdHlsZSkpOwogICAgfQoKICAgIHZhciBzdHlsZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3N0eWxlJywgZmFsc2UgLyogZ2V0U3RhdGljICovKTsKICAgIGlmIChzdHlsZUJpbmRpbmcpIHsKICAgICAgZWwuc3R5bGVCaW5kaW5nID0gc3R5bGVCaW5kaW5nOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2VuRGF0YSQxIChlbCkgewogICAgdmFyIGRhdGEgPSAnJzsKICAgIGlmIChlbC5zdGF0aWNTdHlsZSkgewogICAgICBkYXRhICs9ICJzdGF0aWNTdHlsZToiICsgKGVsLnN0YXRpY1N0eWxlKSArICIsIjsKICAgIH0KICAgIGlmIChlbC5zdHlsZUJpbmRpbmcpIHsKICAgICAgZGF0YSArPSAic3R5bGU6KCIgKyAoZWwuc3R5bGVCaW5kaW5nKSArICIpLCI7CiAgICB9CiAgICByZXR1cm4gZGF0YQogIH0KCiAgdmFyIHN0eWxlJDEgPSB7CiAgICBzdGF0aWNLZXlzOiBbJ3N0YXRpY1N0eWxlJ10sCiAgICB0cmFuc2Zvcm1Ob2RlOiB0cmFuc2Zvcm1Ob2RlJDEsCiAgICBnZW5EYXRhOiBnZW5EYXRhJDEKICB9OwoKICAvKiAgKi8KCiAgdmFyIGRlY29kZXI7CgogIHZhciBoZSA9IHsKICAgIGRlY29kZTogZnVuY3Rpb24gZGVjb2RlIChodG1sKSB7CiAgICAgIGRlY29kZXIgPSBkZWNvZGVyIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBkZWNvZGVyLmlubmVySFRNTCA9IGh0bWw7CiAgICAgIHJldHVybiBkZWNvZGVyLnRleHRDb250ZW50CiAgICB9CiAgfTsKCiAgLyogICovCgogIHZhciBpc1VuYXJ5VGFnID0gbWFrZU1hcCgKICAgICdhcmVhLGJhc2UsYnIsY29sLGVtYmVkLGZyYW1lLGhyLGltZyxpbnB1dCxpc2luZGV4LGtleWdlbiwnICsKICAgICdsaW5rLG1ldGEscGFyYW0sc291cmNlLHRyYWNrLHdicicKICApOwoKICAvLyBFbGVtZW50cyB0aGF0IHlvdSBjYW4sIGludGVudGlvbmFsbHksIGxlYXZlIG9wZW4KICAvLyAoYW5kIHdoaWNoIGNsb3NlIHRoZW1zZWx2ZXMpCiAgdmFyIGNhbkJlTGVmdE9wZW5UYWcgPSBtYWtlTWFwKAogICAgJ2NvbGdyb3VwLGRkLGR0LGxpLG9wdGlvbnMscCx0ZCx0Zm9vdCx0aCx0aGVhZCx0cixzb3VyY2UnCiAgKTsKCiAgLy8gSFRNTDUgdGFncyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9pbmRpY2VzLmh0bWwjZWxlbWVudHMtMwogIC8vIFBocmFzaW5nIENvbnRlbnQgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZG9tLmh0bWwjcGhyYXNpbmctY29udGVudAogIHZhciBpc05vblBocmFzaW5nVGFnID0gbWFrZU1hcCgKICAgICdhZGRyZXNzLGFydGljbGUsYXNpZGUsYmFzZSxibG9ja3F1b3RlLGJvZHksY2FwdGlvbixjb2wsY29sZ3JvdXAsZGQsJyArCiAgICAnZGV0YWlscyxkaWFsb2csZGl2LGRsLGR0LGZpZWxkc2V0LGZpZ2NhcHRpb24sZmlndXJlLGZvb3Rlcixmb3JtLCcgKwogICAgJ2gxLGgyLGgzLGg0LGg1LGg2LGhlYWQsaGVhZGVyLGhncm91cCxocixodG1sLGxlZ2VuZCxsaSxtZW51aXRlbSxtZXRhLCcgKwogICAgJ29wdGdyb3VwLG9wdGlvbixwYXJhbSxycCxydCxzb3VyY2Usc3R5bGUsc3VtbWFyeSx0Ym9keSx0ZCx0Zm9vdCx0aCx0aGVhZCwnICsKICAgICd0aXRsZSx0cix0cmFjaycKICApOwoKICAvKioKICAgKiBOb3QgdHlwZS1jaGVja2luZyB0aGlzIGZpbGUgYmVjYXVzZSBpdCdzIG1vc3RseSB2ZW5kb3IgY29kZS4KICAgKi8KCiAgLy8gUmVndWxhciBFeHByZXNzaW9ucyBmb3IgcGFyc2luZyB0YWdzIGFuZCBhdHRyaWJ1dGVzCiAgdmFyIGF0dHJpYnV0ZSA9IC9eXHMqKFteXHMiJzw+XC89XSspKD86XHMqKD0pXHMqKD86IihbXiJdKikiK3wnKFteJ10qKScrfChbXlxzIic9PD5gXSspKSk/LzsKICB2YXIgZHluYW1pY0FyZ0F0dHJpYnV0ZSA9IC9eXHMqKCg/OnYtW1x3LV0rOnxAfDp8IylcW1tePV0rXF1bXlxzIic8PlwvPV0qKSg/OlxzKig9KVxzKig/OiIoW14iXSopIit8JyhbXiddKiknK3woW15ccyInPTw+YF0rKSkpPy87CiAgdmFyIG5jbmFtZSA9ICJbYS16QS1aX11bXFwtXFwuMC05X2EtekEtWiIgKyAodW5pY29kZVJlZ0V4cC5zb3VyY2UpICsgIl0qIjsKICB2YXIgcW5hbWVDYXB0dXJlID0gIigoPzoiICsgbmNuYW1lICsgIlxcOik/IiArIG5jbmFtZSArICIpIjsKICB2YXIgc3RhcnRUYWdPcGVuID0gbmV3IFJlZ0V4cCgoIl48IiArIHFuYW1lQ2FwdHVyZSkpOwogIHZhciBzdGFydFRhZ0Nsb3NlID0gL15ccyooXC8/KT4vOwogIHZhciBlbmRUYWcgPSBuZXcgUmVnRXhwKCgiXjxcXC8iICsgcW5hbWVDYXB0dXJlICsgIltePl0qPiIpKTsKICB2YXIgZG9jdHlwZSA9IC9ePCFET0NUWVBFIFtePl0rPi9pOwogIC8vICM3Mjk4OiBlc2NhcGUgLSB0byBhdm9pZCBiZWluZyBwYXNzZWQgYXMgSFRNTCBjb21tZW50IHdoZW4gaW5saW5lZCBpbiBwYWdlCiAgdmFyIGNvbW1lbnQgPSAvXjwhXC0tLzsKICB2YXIgY29uZGl0aW9uYWxDb21tZW50ID0gL148IVxbLzsKCiAgLy8gU3BlY2lhbCBFbGVtZW50cyAoY2FuIGNvbnRhaW4gYW55dGhpbmcpCiAgdmFyIGlzUGxhaW5UZXh0RWxlbWVudCA9IG1ha2VNYXAoJ3NjcmlwdCxzdHlsZSx0ZXh0YXJlYScsIHRydWUpOwogIHZhciByZUNhY2hlID0ge307CgogIHZhciBkZWNvZGluZ01hcCA9IHsKICAgICcmbHQ7JzogJzwnLAogICAgJyZndDsnOiAnPicsCiAgICAnJnF1b3Q7JzogJyInLAogICAgJyZhbXA7JzogJyYnLAogICAgJyYjMTA7JzogJ1xuJywKICAgICcmIzk7JzogJ1x0JywKICAgICcmIzM5Oyc6ICInIgogIH07CiAgdmFyIGVuY29kZWRBdHRyID0gLyYoPzpsdHxndHxxdW90fGFtcHwjMzkpOy9nOwogIHZhciBlbmNvZGVkQXR0cldpdGhOZXdMaW5lcyA9IC8mKD86bHR8Z3R8cXVvdHxhbXB8IzM5fCMxMHwjOSk7L2c7CgogIC8vICM1OTkyCiAgdmFyIGlzSWdub3JlTmV3bGluZVRhZyA9IG1ha2VNYXAoJ3ByZSx0ZXh0YXJlYScsIHRydWUpOwogIHZhciBzaG91bGRJZ25vcmVGaXJzdE5ld2xpbmUgPSBmdW5jdGlvbiAodGFnLCBodG1sKSB7IHJldHVybiB0YWcgJiYgaXNJZ25vcmVOZXdsaW5lVGFnKHRhZykgJiYgaHRtbFswXSA9PT0gJ1xuJzsgfTsKCiAgZnVuY3Rpb24gZGVjb2RlQXR0ciAodmFsdWUsIHNob3VsZERlY29kZU5ld2xpbmVzKSB7CiAgICB2YXIgcmUgPSBzaG91bGREZWNvZGVOZXdsaW5lcyA/IGVuY29kZWRBdHRyV2l0aE5ld0xpbmVzIDogZW5jb2RlZEF0dHI7CiAgICByZXR1cm4gdmFsdWUucmVwbGFjZShyZSwgZnVuY3Rpb24gKG1hdGNoKSB7IHJldHVybiBkZWNvZGluZ01hcFttYXRjaF07IH0pCiAgfQoKICBmdW5jdGlvbiBwYXJzZUhUTUwgKGh0bWwsIG9wdGlvbnMpIHsKICAgIHZhciBzdGFjayA9IFtdOwogICAgdmFyIGV4cGVjdEhUTUwgPSBvcHRpb25zLmV4cGVjdEhUTUw7CiAgICB2YXIgaXNVbmFyeVRhZyQkMSA9IG9wdGlvbnMuaXNVbmFyeVRhZyB8fCBubzsKICAgIHZhciBjYW5CZUxlZnRPcGVuVGFnJCQxID0gb3B0aW9ucy5jYW5CZUxlZnRPcGVuVGFnIHx8IG5vOwogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBsYXN0LCBsYXN0VGFnOwogICAgd2hpbGUgKGh0bWwpIHsKICAgICAgbGFzdCA9IGh0bWw7CiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSdyZSBub3QgaW4gYSBwbGFpbnRleHQgY29udGVudCBlbGVtZW50IGxpa2Ugc2NyaXB0L3N0eWxlCiAgICAgIGlmICghbGFzdFRhZyB8fCAhaXNQbGFpblRleHRFbGVtZW50KGxhc3RUYWcpKSB7CiAgICAgICAgdmFyIHRleHRFbmQgPSBodG1sLmluZGV4T2YoJzwnKTsKICAgICAgICBpZiAodGV4dEVuZCA9PT0gMCkgewogICAgICAgICAgLy8gQ29tbWVudDoKICAgICAgICAgIGlmIChjb21tZW50LnRlc3QoaHRtbCkpIHsKICAgICAgICAgICAgdmFyIGNvbW1lbnRFbmQgPSBodG1sLmluZGV4T2YoJy0tPicpOwoKICAgICAgICAgICAgaWYgKGNvbW1lbnRFbmQgPj0gMCkgewogICAgICAgICAgICAgIGlmIChvcHRpb25zLnNob3VsZEtlZXBDb21tZW50KSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLmNvbW1lbnQoaHRtbC5zdWJzdHJpbmcoNCwgY29tbWVudEVuZCksIGluZGV4LCBpbmRleCArIGNvbW1lbnRFbmQgKyAzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYWR2YW5jZShjb21tZW50RW5kICsgMyk7CiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29uZGl0aW9uYWxfY29tbWVudCNEb3dubGV2ZWwtcmV2ZWFsZWRfY29uZGl0aW9uYWxfY29tbWVudAogICAgICAgICAgaWYgKGNvbmRpdGlvbmFsQ29tbWVudC50ZXN0KGh0bWwpKSB7CiAgICAgICAgICAgIHZhciBjb25kaXRpb25hbEVuZCA9IGh0bWwuaW5kZXhPZignXT4nKTsKCiAgICAgICAgICAgIGlmIChjb25kaXRpb25hbEVuZCA+PSAwKSB7CiAgICAgICAgICAgICAgYWR2YW5jZShjb25kaXRpb25hbEVuZCArIDIpOwogICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBEb2N0eXBlOgogICAgICAgICAgdmFyIGRvY3R5cGVNYXRjaCA9IGh0bWwubWF0Y2goZG9jdHlwZSk7CiAgICAgICAgICBpZiAoZG9jdHlwZU1hdGNoKSB7CiAgICAgICAgICAgIGFkdmFuY2UoZG9jdHlwZU1hdGNoWzBdLmxlbmd0aCk7CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CgogICAgICAgICAgLy8gRW5kIHRhZzoKICAgICAgICAgIHZhciBlbmRUYWdNYXRjaCA9IGh0bWwubWF0Y2goZW5kVGFnKTsKICAgICAgICAgIGlmIChlbmRUYWdNYXRjaCkgewogICAgICAgICAgICB2YXIgY3VySW5kZXggPSBpbmRleDsKICAgICAgICAgICAgYWR2YW5jZShlbmRUYWdNYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICBwYXJzZUVuZFRhZyhlbmRUYWdNYXRjaFsxXSwgY3VySW5kZXgsIGluZGV4KTsKICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBTdGFydCB0YWc6CiAgICAgICAgICB2YXIgc3RhcnRUYWdNYXRjaCA9IHBhcnNlU3RhcnRUYWcoKTsKICAgICAgICAgIGlmIChzdGFydFRhZ01hdGNoKSB7CiAgICAgICAgICAgIGhhbmRsZVN0YXJ0VGFnKHN0YXJ0VGFnTWF0Y2gpOwogICAgICAgICAgICBpZiAoc2hvdWxkSWdub3JlRmlyc3ROZXdsaW5lKHN0YXJ0VGFnTWF0Y2gudGFnTmFtZSwgaHRtbCkpIHsKICAgICAgICAgICAgICBhZHZhbmNlKDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgdGV4dCA9ICh2b2lkIDApLCByZXN0ID0gKHZvaWQgMCksIG5leHQgPSAodm9pZCAwKTsKICAgICAgICBpZiAodGV4dEVuZCA+PSAwKSB7CiAgICAgICAgICByZXN0ID0gaHRtbC5zbGljZSh0ZXh0RW5kKTsKICAgICAgICAgIHdoaWxlICgKICAgICAgICAgICAgIWVuZFRhZy50ZXN0KHJlc3QpICYmCiAgICAgICAgICAgICFzdGFydFRhZ09wZW4udGVzdChyZXN0KSAmJgogICAgICAgICAgICAhY29tbWVudC50ZXN0KHJlc3QpICYmCiAgICAgICAgICAgICFjb25kaXRpb25hbENvbW1lbnQudGVzdChyZXN0KQogICAgICAgICAgKSB7CiAgICAgICAgICAgIC8vIDwgaW4gcGxhaW4gdGV4dCwgYmUgZm9yZ2l2aW5nIGFuZCB0cmVhdCBpdCBhcyB0ZXh0CiAgICAgICAgICAgIG5leHQgPSByZXN0LmluZGV4T2YoJzwnLCAxKTsKICAgICAgICAgICAgaWYgKG5leHQgPCAwKSB7IGJyZWFrIH0KICAgICAgICAgICAgdGV4dEVuZCArPSBuZXh0OwogICAgICAgICAgICByZXN0ID0gaHRtbC5zbGljZSh0ZXh0RW5kKTsKICAgICAgICAgIH0KICAgICAgICAgIHRleHQgPSBodG1sLnN1YnN0cmluZygwLCB0ZXh0RW5kKTsKICAgICAgICB9CgogICAgICAgIGlmICh0ZXh0RW5kIDwgMCkgewogICAgICAgICAgdGV4dCA9IGh0bWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodGV4dCkgewogICAgICAgICAgYWR2YW5jZSh0ZXh0Lmxlbmd0aCk7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5jaGFycyAmJiB0ZXh0KSB7CiAgICAgICAgICBvcHRpb25zLmNoYXJzKHRleHQsIGluZGV4IC0gdGV4dC5sZW5ndGgsIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGVuZFRhZ0xlbmd0aCA9IDA7CiAgICAgICAgdmFyIHN0YWNrZWRUYWcgPSBsYXN0VGFnLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdmFyIHJlU3RhY2tlZFRhZyA9IHJlQ2FjaGVbc3RhY2tlZFRhZ10gfHwgKHJlQ2FjaGVbc3RhY2tlZFRhZ10gPSBuZXcgUmVnRXhwKCcoW1xcc1xcU10qPykoPC8nICsgc3RhY2tlZFRhZyArICdbXj5dKj4pJywgJ2knKSk7CiAgICAgICAgdmFyIHJlc3QkMSA9IGh0bWwucmVwbGFjZShyZVN0YWNrZWRUYWcsIGZ1bmN0aW9uIChhbGwsIHRleHQsIGVuZFRhZykgewogICAgICAgICAgZW5kVGFnTGVuZ3RoID0gZW5kVGFnLmxlbmd0aDsKICAgICAgICAgIGlmICghaXNQbGFpblRleHRFbGVtZW50KHN0YWNrZWRUYWcpICYmIHN0YWNrZWRUYWcgIT09ICdub3NjcmlwdCcpIHsKICAgICAgICAgICAgdGV4dCA9IHRleHQKICAgICAgICAgICAgICAucmVwbGFjZSgvPCFcLS0oW1xzXFNdKj8pLS0+L2csICckMScpIC8vICM3Mjk4CiAgICAgICAgICAgICAgLnJlcGxhY2UoLzwhXFtDREFUQVxbKFtcc1xTXSo/KV1dPi9nLCAnJDEnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzaG91bGRJZ25vcmVGaXJzdE5ld2xpbmUoc3RhY2tlZFRhZywgdGV4dCkpIHsKICAgICAgICAgICAgdGV4dCA9IHRleHQuc2xpY2UoMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0aW9ucy5jaGFycykgewogICAgICAgICAgICBvcHRpb25zLmNoYXJzKHRleHQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgfSk7CiAgICAgICAgaW5kZXggKz0gaHRtbC5sZW5ndGggLSByZXN0JDEubGVuZ3RoOwogICAgICAgIGh0bWwgPSByZXN0JDE7CiAgICAgICAgcGFyc2VFbmRUYWcoc3RhY2tlZFRhZywgaW5kZXggLSBlbmRUYWdMZW5ndGgsIGluZGV4KTsKICAgICAgfQoKICAgICAgaWYgKGh0bWwgPT09IGxhc3QpIHsKICAgICAgICBvcHRpb25zLmNoYXJzICYmIG9wdGlvbnMuY2hhcnMoaHRtbCk7CiAgICAgICAgaWYgKCFzdGFjay5sZW5ndGggJiYgb3B0aW9ucy53YXJuKSB7CiAgICAgICAgICBvcHRpb25zLndhcm4oKCJNYWwtZm9ybWF0dGVkIHRhZyBhdCBlbmQgb2YgdGVtcGxhdGU6IFwiIiArIGh0bWwgKyAiXCIiKSwgeyBzdGFydDogaW5kZXggKyBodG1sLmxlbmd0aCB9KTsKICAgICAgICB9CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQoKICAgIC8vIENsZWFuIHVwIGFueSByZW1haW5pbmcgdGFncwogICAgcGFyc2VFbmRUYWcoKTsKCiAgICBmdW5jdGlvbiBhZHZhbmNlIChuKSB7CiAgICAgIGluZGV4ICs9IG47CiAgICAgIGh0bWwgPSBodG1sLnN1YnN0cmluZyhuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZVN0YXJ0VGFnICgpIHsKICAgICAgdmFyIHN0YXJ0ID0gaHRtbC5tYXRjaChzdGFydFRhZ09wZW4pOwogICAgICBpZiAoc3RhcnQpIHsKICAgICAgICB2YXIgbWF0Y2ggPSB7CiAgICAgICAgICB0YWdOYW1lOiBzdGFydFsxXSwKICAgICAgICAgIGF0dHJzOiBbXSwKICAgICAgICAgIHN0YXJ0OiBpbmRleAogICAgICAgIH07CiAgICAgICAgYWR2YW5jZShzdGFydFswXS5sZW5ndGgpOwogICAgICAgIHZhciBlbmQsIGF0dHI7CiAgICAgICAgd2hpbGUgKCEoZW5kID0gaHRtbC5tYXRjaChzdGFydFRhZ0Nsb3NlKSkgJiYgKGF0dHIgPSBodG1sLm1hdGNoKGR5bmFtaWNBcmdBdHRyaWJ1dGUpIHx8IGh0bWwubWF0Y2goYXR0cmlidXRlKSkpIHsKICAgICAgICAgIGF0dHIuc3RhcnQgPSBpbmRleDsKICAgICAgICAgIGFkdmFuY2UoYXR0clswXS5sZW5ndGgpOwogICAgICAgICAgYXR0ci5lbmQgPSBpbmRleDsKICAgICAgICAgIG1hdGNoLmF0dHJzLnB1c2goYXR0cik7CiAgICAgICAgfQogICAgICAgIGlmIChlbmQpIHsKICAgICAgICAgIG1hdGNoLnVuYXJ5U2xhc2ggPSBlbmRbMV07CiAgICAgICAgICBhZHZhbmNlKGVuZFswXS5sZW5ndGgpOwogICAgICAgICAgbWF0Y2guZW5kID0gaW5kZXg7CiAgICAgICAgICByZXR1cm4gbWF0Y2gKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVTdGFydFRhZyAobWF0Y2gpIHsKICAgICAgdmFyIHRhZ05hbWUgPSBtYXRjaC50YWdOYW1lOwogICAgICB2YXIgdW5hcnlTbGFzaCA9IG1hdGNoLnVuYXJ5U2xhc2g7CgogICAgICBpZiAoZXhwZWN0SFRNTCkgewogICAgICAgIGlmIChsYXN0VGFnID09PSAncCcgJiYgaXNOb25QaHJhc2luZ1RhZyh0YWdOYW1lKSkgewogICAgICAgICAgcGFyc2VFbmRUYWcobGFzdFRhZyk7CiAgICAgICAgfQogICAgICAgIGlmIChjYW5CZUxlZnRPcGVuVGFnJCQxKHRhZ05hbWUpICYmIGxhc3RUYWcgPT09IHRhZ05hbWUpIHsKICAgICAgICAgIHBhcnNlRW5kVGFnKHRhZ05hbWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHVuYXJ5ID0gaXNVbmFyeVRhZyQkMSh0YWdOYW1lKSB8fCAhIXVuYXJ5U2xhc2g7CgogICAgICB2YXIgbCA9IG1hdGNoLmF0dHJzLmxlbmd0aDsKICAgICAgdmFyIGF0dHJzID0gbmV3IEFycmF5KGwpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykgewogICAgICAgIHZhciBhcmdzID0gbWF0Y2guYXR0cnNbaV07CiAgICAgICAgdmFyIHZhbHVlID0gYXJnc1szXSB8fCBhcmdzWzRdIHx8IGFyZ3NbNV0gfHwgJyc7CiAgICAgICAgdmFyIHNob3VsZERlY29kZU5ld2xpbmVzID0gdGFnTmFtZSA9PT0gJ2EnICYmIGFyZ3NbMV0gPT09ICdocmVmJwogICAgICAgICAgPyBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZgogICAgICAgICAgOiBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzOwogICAgICAgIGF0dHJzW2ldID0gewogICAgICAgICAgbmFtZTogYXJnc1sxXSwKICAgICAgICAgIHZhbHVlOiBkZWNvZGVBdHRyKHZhbHVlLCBzaG91bGREZWNvZGVOZXdsaW5lcykKICAgICAgICB9OwogICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICBhdHRyc1tpXS5zdGFydCA9IGFyZ3Muc3RhcnQgKyBhcmdzWzBdLm1hdGNoKC9eXHMqLykubGVuZ3RoOwogICAgICAgICAgYXR0cnNbaV0uZW5kID0gYXJncy5lbmQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIXVuYXJ5KSB7CiAgICAgICAgc3RhY2sucHVzaCh7IHRhZzogdGFnTmFtZSwgbG93ZXJDYXNlZFRhZzogdGFnTmFtZS50b0xvd2VyQ2FzZSgpLCBhdHRyczogYXR0cnMsIHN0YXJ0OiBtYXRjaC5zdGFydCwgZW5kOiBtYXRjaC5lbmQgfSk7CiAgICAgICAgbGFzdFRhZyA9IHRhZ05hbWU7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnN0YXJ0KSB7CiAgICAgICAgb3B0aW9ucy5zdGFydCh0YWdOYW1lLCBhdHRycywgdW5hcnksIG1hdGNoLnN0YXJ0LCBtYXRjaC5lbmQpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VFbmRUYWcgKHRhZ05hbWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgdmFyIHBvcywgbG93ZXJDYXNlZFRhZ05hbWU7CiAgICAgIGlmIChzdGFydCA9PSBudWxsKSB7IHN0YXJ0ID0gaW5kZXg7IH0KICAgICAgaWYgKGVuZCA9PSBudWxsKSB7IGVuZCA9IGluZGV4OyB9CgogICAgICAvLyBGaW5kIHRoZSBjbG9zZXN0IG9wZW5lZCB0YWcgb2YgdGhlIHNhbWUgdHlwZQogICAgICBpZiAodGFnTmFtZSkgewogICAgICAgIGxvd2VyQ2FzZWRUYWdOYW1lID0gdGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGZvciAocG9zID0gc3RhY2subGVuZ3RoIC0gMTsgcG9zID49IDA7IHBvcy0tKSB7CiAgICAgICAgICBpZiAoc3RhY2tbcG9zXS5sb3dlckNhc2VkVGFnID09PSBsb3dlckNhc2VkVGFnTmFtZSkgewogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBJZiBubyB0YWcgbmFtZSBpcyBwcm92aWRlZCwgY2xlYW4gc2hvcAogICAgICAgIHBvcyA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChwb3MgPj0gMCkgewogICAgICAgIC8vIENsb3NlIGFsbCB0aGUgb3BlbiBlbGVtZW50cywgdXAgdGhlIHN0YWNrCiAgICAgICAgZm9yICh2YXIgaSA9IHN0YWNrLmxlbmd0aCAtIDE7IGkgPj0gcG9zOyBpLS0pIHsKICAgICAgICAgIGlmIChpID4gcG9zIHx8ICF0YWdOYW1lICYmCiAgICAgICAgICAgIG9wdGlvbnMud2FybgogICAgICAgICAgKSB7CiAgICAgICAgICAgIG9wdGlvbnMud2FybigKICAgICAgICAgICAgICAoInRhZyA8IiArIChzdGFja1tpXS50YWcpICsgIj4gaGFzIG5vIG1hdGNoaW5nIGVuZCB0YWcuIiksCiAgICAgICAgICAgICAgeyBzdGFydDogc3RhY2tbaV0uc3RhcnQsIGVuZDogc3RhY2tbaV0uZW5kIH0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvcHRpb25zLmVuZCkgewogICAgICAgICAgICBvcHRpb25zLmVuZChzdGFja1tpXS50YWcsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBvcGVuIGVsZW1lbnRzIGZyb20gdGhlIHN0YWNrCiAgICAgICAgc3RhY2subGVuZ3RoID0gcG9zOwogICAgICAgIGxhc3RUYWcgPSBwb3MgJiYgc3RhY2tbcG9zIC0gMV0udGFnOwogICAgICB9IGVsc2UgaWYgKGxvd2VyQ2FzZWRUYWdOYW1lID09PSAnYnInKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQpIHsKICAgICAgICAgIG9wdGlvbnMuc3RhcnQodGFnTmFtZSwgW10sIHRydWUsIHN0YXJ0LCBlbmQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChsb3dlckNhc2VkVGFnTmFtZSA9PT0gJ3AnKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQpIHsKICAgICAgICAgIG9wdGlvbnMuc3RhcnQodGFnTmFtZSwgW10sIGZhbHNlLCBzdGFydCwgZW5kKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuZW5kKSB7CiAgICAgICAgICBvcHRpb25zLmVuZCh0YWdOYW1lLCBzdGFydCwgZW5kKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8qICAqLwoKICB2YXIgb25SRSA9IC9eQHxedi1vbjovOwogIHZhciBkaXJSRSA9IC9edi18XkB8Xjp8XiMvOwogIHZhciBmb3JBbGlhc1JFID0gLyhbXHNcU10qPylccysoPzppbnxvZilccysoW1xzXFNdKikvOwogIHZhciBmb3JJdGVyYXRvclJFID0gLywoW14sXH1cXV0qKSg/OiwoW14sXH1cXV0qKSk/JC87CiAgdmFyIHN0cmlwUGFyZW5zUkUgPSAvXlwofFwpJC9nOwogIHZhciBkeW5hbWljQXJnUkUgPSAvXlxbLipcXSQvOwoKICB2YXIgYXJnUkUgPSAvOiguKikkLzsKICB2YXIgYmluZFJFID0gL146fF5cLnxedi1iaW5kOi87CiAgdmFyIG1vZGlmaWVyUkUgPSAvXC5bXi5cXV0rKD89W15cXV0qJCkvZzsKCiAgdmFyIHNsb3RSRSA9IC9edi1zbG90KDp8JCl8XiMvOwoKICB2YXIgbGluZUJyZWFrUkUgPSAvW1xyXG5dLzsKICB2YXIgd2hpdGVzcGFjZVJFJDEgPSAvXHMrL2c7CgogIHZhciBpbnZhbGlkQXR0cmlidXRlUkUgPSAvW1xzIic8PlwvPV0vOwoKICB2YXIgZGVjb2RlSFRNTENhY2hlZCA9IGNhY2hlZChoZS5kZWNvZGUpOwoKICB2YXIgZW1wdHlTbG90U2NvcGVUb2tlbiA9ICJfZW1wdHlfIjsKCiAgLy8gY29uZmlndXJhYmxlIHN0YXRlCiAgdmFyIHdhcm4kMjsKICB2YXIgZGVsaW1pdGVyczsKICB2YXIgdHJhbnNmb3JtczsKICB2YXIgcHJlVHJhbnNmb3JtczsKICB2YXIgcG9zdFRyYW5zZm9ybXM7CiAgdmFyIHBsYXRmb3JtSXNQcmVUYWc7CiAgdmFyIHBsYXRmb3JtTXVzdFVzZVByb3A7CiAgdmFyIHBsYXRmb3JtR2V0VGFnTmFtZXNwYWNlOwogIHZhciBtYXliZUNvbXBvbmVudDsKCiAgZnVuY3Rpb24gY3JlYXRlQVNURWxlbWVudCAoCiAgICB0YWcsCiAgICBhdHRycywKICAgIHBhcmVudAogICkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogMSwKICAgICAgdGFnOiB0YWcsCiAgICAgIGF0dHJzTGlzdDogYXR0cnMsCiAgICAgIGF0dHJzTWFwOiBtYWtlQXR0cnNNYXAoYXR0cnMpLAogICAgICByYXdBdHRyc01hcDoge30sCiAgICAgIHBhcmVudDogcGFyZW50LAogICAgICBjaGlsZHJlbjogW10KICAgIH0KICB9CgogIC8qKgogICAqIENvbnZlcnQgSFRNTCBzdHJpbmcgdG8gQVNULgogICAqLwogIGZ1bmN0aW9uIHBhcnNlICgKICAgIHRlbXBsYXRlLAogICAgb3B0aW9ucwogICkgewogICAgd2FybiQyID0gb3B0aW9ucy53YXJuIHx8IGJhc2VXYXJuOwoKICAgIHBsYXRmb3JtSXNQcmVUYWcgPSBvcHRpb25zLmlzUHJlVGFnIHx8IG5vOwogICAgcGxhdGZvcm1NdXN0VXNlUHJvcCA9IG9wdGlvbnMubXVzdFVzZVByb3AgfHwgbm87CiAgICBwbGF0Zm9ybUdldFRhZ05hbWVzcGFjZSA9IG9wdGlvbnMuZ2V0VGFnTmFtZXNwYWNlIHx8IG5vOwogICAgdmFyIGlzUmVzZXJ2ZWRUYWcgPSBvcHRpb25zLmlzUmVzZXJ2ZWRUYWcgfHwgbm87CiAgICBtYXliZUNvbXBvbmVudCA9IGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gISFlbC5jb21wb25lbnQgfHwgIWlzUmVzZXJ2ZWRUYWcoZWwudGFnKTsgfTsKCiAgICB0cmFuc2Zvcm1zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICd0cmFuc2Zvcm1Ob2RlJyk7CiAgICBwcmVUcmFuc2Zvcm1zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICdwcmVUcmFuc2Zvcm1Ob2RlJyk7CiAgICBwb3N0VHJhbnNmb3JtcyA9IHBsdWNrTW9kdWxlRnVuY3Rpb24ob3B0aW9ucy5tb2R1bGVzLCAncG9zdFRyYW5zZm9ybU5vZGUnKTsKCiAgICBkZWxpbWl0ZXJzID0gb3B0aW9ucy5kZWxpbWl0ZXJzOwoKICAgIHZhciBzdGFjayA9IFtdOwogICAgdmFyIHByZXNlcnZlV2hpdGVzcGFjZSA9IG9wdGlvbnMucHJlc2VydmVXaGl0ZXNwYWNlICE9PSBmYWxzZTsKICAgIHZhciB3aGl0ZXNwYWNlT3B0aW9uID0gb3B0aW9ucy53aGl0ZXNwYWNlOwogICAgdmFyIHJvb3Q7CiAgICB2YXIgY3VycmVudFBhcmVudDsKICAgIHZhciBpblZQcmUgPSBmYWxzZTsKICAgIHZhciBpblByZSA9IGZhbHNlOwogICAgdmFyIHdhcm5lZCA9IGZhbHNlOwoKICAgIGZ1bmN0aW9uIHdhcm5PbmNlIChtc2csIHJhbmdlKSB7CiAgICAgIGlmICghd2FybmVkKSB7CiAgICAgICAgd2FybmVkID0gdHJ1ZTsKICAgICAgICB3YXJuJDIobXNnLCByYW5nZSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZUVsZW1lbnQgKGVsZW1lbnQpIHsKICAgICAgdHJpbUVuZGluZ1doaXRlc3BhY2UoZWxlbWVudCk7CiAgICAgIGlmICghaW5WUHJlICYmICFlbGVtZW50LnByb2Nlc3NlZCkgewogICAgICAgIGVsZW1lbnQgPSBwcm9jZXNzRWxlbWVudChlbGVtZW50LCBvcHRpb25zKTsKICAgICAgfQogICAgICAvLyB0cmVlIG1hbmFnZW1lbnQKICAgICAgaWYgKCFzdGFjay5sZW5ndGggJiYgZWxlbWVudCAhPT0gcm9vdCkgewogICAgICAgIC8vIGFsbG93IHJvb3QgZWxlbWVudHMgd2l0aCB2LWlmLCB2LWVsc2UtaWYgYW5kIHYtZWxzZQogICAgICAgIGlmIChyb290LmlmICYmIChlbGVtZW50LmVsc2VpZiB8fCBlbGVtZW50LmVsc2UpKSB7CiAgICAgICAgICB7CiAgICAgICAgICAgIGNoZWNrUm9vdENvbnN0cmFpbnRzKGVsZW1lbnQpOwogICAgICAgICAgfQogICAgICAgICAgYWRkSWZDb25kaXRpb24ocm9vdCwgewogICAgICAgICAgICBleHA6IGVsZW1lbnQuZWxzZWlmLAogICAgICAgICAgICBibG9jazogZWxlbWVudAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdhcm5PbmNlKAogICAgICAgICAgICAiQ29tcG9uZW50IHRlbXBsYXRlIHNob3VsZCBjb250YWluIGV4YWN0bHkgb25lIHJvb3QgZWxlbWVudC4gIiArCiAgICAgICAgICAgICJJZiB5b3UgYXJlIHVzaW5nIHYtaWYgb24gbXVsdGlwbGUgZWxlbWVudHMsICIgKwogICAgICAgICAgICAidXNlIHYtZWxzZS1pZiB0byBjaGFpbiB0aGVtIGluc3RlYWQuIiwKICAgICAgICAgICAgeyBzdGFydDogZWxlbWVudC5zdGFydCB9CiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY3VycmVudFBhcmVudCAmJiAhZWxlbWVudC5mb3JiaWRkZW4pIHsKICAgICAgICBpZiAoZWxlbWVudC5lbHNlaWYgfHwgZWxlbWVudC5lbHNlKSB7CiAgICAgICAgICBwcm9jZXNzSWZDb25kaXRpb25zKGVsZW1lbnQsIGN1cnJlbnRQYXJlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoZWxlbWVudC5zbG90U2NvcGUpIHsKICAgICAgICAgICAgLy8gc2NvcGVkIHNsb3QKICAgICAgICAgICAgLy8ga2VlcCBpdCBpbiB0aGUgY2hpbGRyZW4gbGlzdCBzbyB0aGF0IHYtZWxzZSgtaWYpIGNvbmRpdGlvbnMgY2FuCiAgICAgICAgICAgIC8vIGZpbmQgaXQgYXMgdGhlIHByZXYgbm9kZS4KICAgICAgICAgICAgdmFyIG5hbWUgPSBlbGVtZW50LnNsb3RUYXJnZXQgfHwgJyJkZWZhdWx0IicKICAgICAgICAgICAgOyhjdXJyZW50UGFyZW50LnNjb3BlZFNsb3RzIHx8IChjdXJyZW50UGFyZW50LnNjb3BlZFNsb3RzID0ge30pKVtuYW1lXSA9IGVsZW1lbnQ7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50UGFyZW50LmNoaWxkcmVuLnB1c2goZWxlbWVudCk7CiAgICAgICAgICBlbGVtZW50LnBhcmVudCA9IGN1cnJlbnRQYXJlbnQ7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBmaW5hbCBjaGlsZHJlbiBjbGVhbnVwCiAgICAgIC8vIGZpbHRlciBvdXQgc2NvcGVkIHNsb3RzCiAgICAgIGVsZW1lbnQuY2hpbGRyZW4gPSBlbGVtZW50LmNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoYykgeyByZXR1cm4gIShjKS5zbG90U2NvcGU7IH0pOwogICAgICAvLyByZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZSBub2RlIGFnYWluCiAgICAgIHRyaW1FbmRpbmdXaGl0ZXNwYWNlKGVsZW1lbnQpOwoKICAgICAgLy8gY2hlY2sgcHJlIHN0YXRlCiAgICAgIGlmIChlbGVtZW50LnByZSkgewogICAgICAgIGluVlByZSA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChwbGF0Zm9ybUlzUHJlVGFnKGVsZW1lbnQudGFnKSkgewogICAgICAgIGluUHJlID0gZmFsc2U7CiAgICAgIH0KICAgICAgLy8gYXBwbHkgcG9zdC10cmFuc2Zvcm1zCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zdFRyYW5zZm9ybXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBwb3N0VHJhbnNmb3Jtc1tpXShlbGVtZW50LCBvcHRpb25zKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyaW1FbmRpbmdXaGl0ZXNwYWNlIChlbCkgewogICAgICAvLyByZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZSBub2RlCiAgICAgIGlmICghaW5QcmUpIHsKICAgICAgICB2YXIgbGFzdE5vZGU7CiAgICAgICAgd2hpbGUgKAogICAgICAgICAgKGxhc3ROb2RlID0gZWwuY2hpbGRyZW5bZWwuY2hpbGRyZW4ubGVuZ3RoIC0gMV0pICYmCiAgICAgICAgICBsYXN0Tm9kZS50eXBlID09PSAzICYmCiAgICAgICAgICBsYXN0Tm9kZS50ZXh0ID09PSAnICcKICAgICAgICApIHsKICAgICAgICAgIGVsLmNoaWxkcmVuLnBvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrUm9vdENvbnN0cmFpbnRzIChlbCkgewogICAgICBpZiAoZWwudGFnID09PSAnc2xvdCcgfHwgZWwudGFnID09PSAndGVtcGxhdGUnKSB7CiAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAiQ2Fubm90IHVzZSA8IiArIChlbC50YWcpICsgIj4gYXMgY29tcG9uZW50IHJvb3QgZWxlbWVudCBiZWNhdXNlIGl0IG1heSAiICsKICAgICAgICAgICdjb250YWluIG11bHRpcGxlIG5vZGVzLicsCiAgICAgICAgICB7IHN0YXJ0OiBlbC5zdGFydCB9CiAgICAgICAgKTsKICAgICAgfQogICAgICBpZiAoZWwuYXR0cnNNYXAuaGFzT3duUHJvcGVydHkoJ3YtZm9yJykpIHsKICAgICAgICB3YXJuT25jZSgKICAgICAgICAgICdDYW5ub3QgdXNlIHYtZm9yIG9uIHN0YXRlZnVsIGNvbXBvbmVudCByb290IGVsZW1lbnQgYmVjYXVzZSAnICsKICAgICAgICAgICdpdCByZW5kZXJzIG11bHRpcGxlIGVsZW1lbnRzLicsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsndi1mb3InXQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBwYXJzZUhUTUwodGVtcGxhdGUsIHsKICAgICAgd2Fybjogd2FybiQyLAogICAgICBleHBlY3RIVE1MOiBvcHRpb25zLmV4cGVjdEhUTUwsCiAgICAgIGlzVW5hcnlUYWc6IG9wdGlvbnMuaXNVbmFyeVRhZywKICAgICAgY2FuQmVMZWZ0T3BlblRhZzogb3B0aW9ucy5jYW5CZUxlZnRPcGVuVGFnLAogICAgICBzaG91bGREZWNvZGVOZXdsaW5lczogb3B0aW9ucy5zaG91bGREZWNvZGVOZXdsaW5lcywKICAgICAgc2hvdWxkRGVjb2RlTmV3bGluZXNGb3JIcmVmOiBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZiwKICAgICAgc2hvdWxkS2VlcENvbW1lbnQ6IG9wdGlvbnMuY29tbWVudHMsCiAgICAgIG91dHB1dFNvdXJjZVJhbmdlOiBvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlLAogICAgICBzdGFydDogZnVuY3Rpb24gc3RhcnQgKHRhZywgYXR0cnMsIHVuYXJ5LCBzdGFydCQxLCBlbmQpIHsKICAgICAgICAvLyBjaGVjayBuYW1lc3BhY2UuCiAgICAgICAgLy8gaW5oZXJpdCBwYXJlbnQgbnMgaWYgdGhlcmUgaXMgb25lCiAgICAgICAgdmFyIG5zID0gKGN1cnJlbnRQYXJlbnQgJiYgY3VycmVudFBhcmVudC5ucykgfHwgcGxhdGZvcm1HZXRUYWdOYW1lc3BhY2UodGFnKTsKCiAgICAgICAgLy8gaGFuZGxlIElFIHN2ZyBidWcKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoaXNJRSAmJiBucyA9PT0gJ3N2ZycpIHsKICAgICAgICAgIGF0dHJzID0gZ3VhcmRJRVNWR0J1ZyhhdHRycyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZWxlbWVudCA9IGNyZWF0ZUFTVEVsZW1lbnQodGFnLCBhdHRycywgY3VycmVudFBhcmVudCk7CiAgICAgICAgaWYgKG5zKSB7CiAgICAgICAgICBlbGVtZW50Lm5zID0gbnM7CiAgICAgICAgfQoKICAgICAgICB7CiAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICBlbGVtZW50LnN0YXJ0ID0gc3RhcnQkMTsKICAgICAgICAgICAgZWxlbWVudC5lbmQgPSBlbmQ7CiAgICAgICAgICAgIGVsZW1lbnQucmF3QXR0cnNNYXAgPSBlbGVtZW50LmF0dHJzTGlzdC5yZWR1Y2UoZnVuY3Rpb24gKGN1bXVsYXRlZCwgYXR0cikgewogICAgICAgICAgICAgIGN1bXVsYXRlZFthdHRyLm5hbWVdID0gYXR0cjsKICAgICAgICAgICAgICByZXR1cm4gY3VtdWxhdGVkCiAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgIH0KICAgICAgICAgIGF0dHJzLmZvckVhY2goZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgICAgICAgaWYgKGludmFsaWRBdHRyaWJ1dGVSRS50ZXN0KGF0dHIubmFtZSkpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiSW52YWxpZCBkeW5hbWljIGFyZ3VtZW50IGV4cHJlc3Npb246IGF0dHJpYnV0ZSBuYW1lcyBjYW5ub3QgY29udGFpbiAiICsKICAgICAgICAgICAgICAgICJzcGFjZXMsIHF1b3RlcywgPCwgPiwgLyBvciA9LiIsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0OiBhdHRyLnN0YXJ0ICsgYXR0ci5uYW1lLmluZGV4T2YoIlsiKSwKICAgICAgICAgICAgICAgICAgZW5kOiBhdHRyLnN0YXJ0ICsgYXR0ci5uYW1lLmxlbmd0aAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzRm9yYmlkZGVuVGFnKGVsZW1lbnQpICYmICFpc1NlcnZlclJlbmRlcmluZygpKSB7CiAgICAgICAgICBlbGVtZW50LmZvcmJpZGRlbiA9IHRydWU7CiAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICdUZW1wbGF0ZXMgc2hvdWxkIG9ubHkgYmUgcmVzcG9uc2libGUgZm9yIG1hcHBpbmcgdGhlIHN0YXRlIHRvIHRoZSAnICsKICAgICAgICAgICAgJ1VJLiBBdm9pZCBwbGFjaW5nIHRhZ3Mgd2l0aCBzaWRlLWVmZmVjdHMgaW4geW91ciB0ZW1wbGF0ZXMsIHN1Y2ggYXMgJyArCiAgICAgICAgICAgICI8IiArIHRhZyArICI+IiArICcsIGFzIHRoZXkgd2lsbCBub3QgYmUgcGFyc2VkLicsCiAgICAgICAgICAgIHsgc3RhcnQ6IGVsZW1lbnQuc3RhcnQgfQogICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIC8vIGFwcGx5IHByZS10cmFuc2Zvcm1zCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmVUcmFuc2Zvcm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBlbGVtZW50ID0gcHJlVHJhbnNmb3Jtc1tpXShlbGVtZW50LCBvcHRpb25zKSB8fCBlbGVtZW50OwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpblZQcmUpIHsKICAgICAgICAgIHByb2Nlc3NQcmUoZWxlbWVudCk7CiAgICAgICAgICBpZiAoZWxlbWVudC5wcmUpIHsKICAgICAgICAgICAgaW5WUHJlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHBsYXRmb3JtSXNQcmVUYWcoZWxlbWVudC50YWcpKSB7CiAgICAgICAgICBpblByZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpblZQcmUpIHsKICAgICAgICAgIHByb2Nlc3NSYXdBdHRycyhlbGVtZW50KTsKICAgICAgICB9IGVsc2UgaWYgKCFlbGVtZW50LnByb2Nlc3NlZCkgewogICAgICAgICAgLy8gc3RydWN0dXJhbCBkaXJlY3RpdmVzCiAgICAgICAgICBwcm9jZXNzRm9yKGVsZW1lbnQpOwogICAgICAgICAgcHJvY2Vzc0lmKGVsZW1lbnQpOwogICAgICAgICAgcHJvY2Vzc09uY2UoZWxlbWVudCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJvb3QpIHsKICAgICAgICAgIHJvb3QgPSBlbGVtZW50OwogICAgICAgICAgewogICAgICAgICAgICBjaGVja1Jvb3RDb25zdHJhaW50cyhyb290KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghdW5hcnkpIHsKICAgICAgICAgIGN1cnJlbnRQYXJlbnQgPSBlbGVtZW50OwogICAgICAgICAgc3RhY2sucHVzaChlbGVtZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2xvc2VFbGVtZW50KGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGVuZDogZnVuY3Rpb24gZW5kICh0YWcsIHN0YXJ0LCBlbmQkMSkgewogICAgICAgIHZhciBlbGVtZW50ID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgLy8gcG9wIHN0YWNrCiAgICAgICAgc3RhY2subGVuZ3RoIC09IDE7CiAgICAgICAgY3VycmVudFBhcmVudCA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICBlbGVtZW50LmVuZCA9IGVuZCQxOwogICAgICAgIH0KICAgICAgICBjbG9zZUVsZW1lbnQoZWxlbWVudCk7CiAgICAgIH0sCgogICAgICBjaGFyczogZnVuY3Rpb24gY2hhcnMgKHRleHQsIHN0YXJ0LCBlbmQpIHsKICAgICAgICBpZiAoIWN1cnJlbnRQYXJlbnQpIHsKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKHRleHQgPT09IHRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAgICAgICAnQ29tcG9uZW50IHRlbXBsYXRlIHJlcXVpcmVzIGEgcm9vdCBlbGVtZW50LCByYXRoZXIgdGhhbiBqdXN0IHRleHQuJywKICAgICAgICAgICAgICAgIHsgc3RhcnQ6IHN0YXJ0IH0KICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgaWYgKCh0ZXh0ID0gdGV4dC50cmltKCkpKSB7CiAgICAgICAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAgICAgICAoInRleHQgXCIiICsgdGV4dCArICJcIiBvdXRzaWRlIHJvb3QgZWxlbWVudCB3aWxsIGJlIGlnbm9yZWQuIiksCiAgICAgICAgICAgICAgICB7IHN0YXJ0OiBzdGFydCB9CiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIC8vIElFIHRleHRhcmVhIHBsYWNlaG9sZGVyIGJ1ZwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmIChpc0lFICYmCiAgICAgICAgICBjdXJyZW50UGFyZW50LnRhZyA9PT0gJ3RleHRhcmVhJyAmJgogICAgICAgICAgY3VycmVudFBhcmVudC5hdHRyc01hcC5wbGFjZWhvbGRlciA9PT0gdGV4dAogICAgICAgICkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHZhciBjaGlsZHJlbiA9IGN1cnJlbnRQYXJlbnQuY2hpbGRyZW47CiAgICAgICAgaWYgKGluUHJlIHx8IHRleHQudHJpbSgpKSB7CiAgICAgICAgICB0ZXh0ID0gaXNUZXh0VGFnKGN1cnJlbnRQYXJlbnQpID8gdGV4dCA6IGRlY29kZUhUTUxDYWNoZWQodGV4dCk7CiAgICAgICAgfSBlbHNlIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICAvLyByZW1vdmUgdGhlIHdoaXRlc3BhY2Utb25seSBub2RlIHJpZ2h0IGFmdGVyIGFuIG9wZW5pbmcgdGFnCiAgICAgICAgICB0ZXh0ID0gJyc7CiAgICAgICAgfSBlbHNlIGlmICh3aGl0ZXNwYWNlT3B0aW9uKSB7CiAgICAgICAgICBpZiAod2hpdGVzcGFjZU9wdGlvbiA9PT0gJ2NvbmRlbnNlJykgewogICAgICAgICAgICAvLyBpbiBjb25kZW5zZSBtb2RlLCByZW1vdmUgdGhlIHdoaXRlc3BhY2Ugbm9kZSBpZiBpdCBjb250YWlucwogICAgICAgICAgICAvLyBsaW5lIGJyZWFrLCBvdGhlcndpc2UgY29uZGVuc2UgdG8gYSBzaW5nbGUgc3BhY2UKICAgICAgICAgICAgdGV4dCA9IGxpbmVCcmVha1JFLnRlc3QodGV4dCkgPyAnJyA6ICcgJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHQgPSAnICc7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRleHQgPSBwcmVzZXJ2ZVdoaXRlc3BhY2UgPyAnICcgOiAnJzsKICAgICAgICB9CiAgICAgICAgaWYgKHRleHQpIHsKICAgICAgICAgIGlmICghaW5QcmUgJiYgd2hpdGVzcGFjZU9wdGlvbiA9PT0gJ2NvbmRlbnNlJykgewogICAgICAgICAgICAvLyBjb25kZW5zZSBjb25zZWN1dGl2ZSB3aGl0ZXNwYWNlcyBpbnRvIHNpbmdsZSBzcGFjZQogICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHdoaXRlc3BhY2VSRSQxLCAnICcpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHJlczsKICAgICAgICAgIHZhciBjaGlsZDsKICAgICAgICAgIGlmICghaW5WUHJlICYmIHRleHQgIT09ICcgJyAmJiAocmVzID0gcGFyc2VUZXh0KHRleHQsIGRlbGltaXRlcnMpKSkgewogICAgICAgICAgICBjaGlsZCA9IHsKICAgICAgICAgICAgICB0eXBlOiAyLAogICAgICAgICAgICAgIGV4cHJlc3Npb246IHJlcy5leHByZXNzaW9uLAogICAgICAgICAgICAgIHRva2VuczogcmVzLnRva2VucywKICAgICAgICAgICAgICB0ZXh0OiB0ZXh0CiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgaWYgKHRleHQgIT09ICcgJyB8fCAhY2hpbGRyZW4ubGVuZ3RoIHx8IGNoaWxkcmVuW2NoaWxkcmVuLmxlbmd0aCAtIDFdLnRleHQgIT09ICcgJykgewogICAgICAgICAgICBjaGlsZCA9IHsKICAgICAgICAgICAgICB0eXBlOiAzLAogICAgICAgICAgICAgIHRleHQ6IHRleHQKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjaGlsZCkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICAgIGNoaWxkLnN0YXJ0ID0gc3RhcnQ7CiAgICAgICAgICAgICAgY2hpbGQuZW5kID0gZW5kOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgY29tbWVudDogZnVuY3Rpb24gY29tbWVudCAodGV4dCwgc3RhcnQsIGVuZCkgewogICAgICAgIC8vIGFkZGluZyBhbnl0aW5nIGFzIGEgc2libGluZyB0byB0aGUgcm9vdCBub2RlIGlzIGZvcmJpZGRlbgogICAgICAgIC8vIGNvbW1lbnRzIHNob3VsZCBzdGlsbCBiZSBhbGxvd2VkLCBidXQgaWdub3JlZAogICAgICAgIGlmIChjdXJyZW50UGFyZW50KSB7CiAgICAgICAgICB2YXIgY2hpbGQgPSB7CiAgICAgICAgICAgIHR5cGU6IDMsCiAgICAgICAgICAgIHRleHQ6IHRleHQsCiAgICAgICAgICAgIGlzQ29tbWVudDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICAgIGNoaWxkLnN0YXJ0ID0gc3RhcnQ7CiAgICAgICAgICAgIGNoaWxkLmVuZCA9IGVuZDsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRQYXJlbnQuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByb290CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzUHJlIChlbCkgewogICAgaWYgKGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LXByZScpICE9IG51bGwpIHsKICAgICAgZWwucHJlID0gdHJ1ZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NSYXdBdHRycyAoZWwpIHsKICAgIHZhciBsaXN0ID0gZWwuYXR0cnNMaXN0OwogICAgdmFyIGxlbiA9IGxpc3QubGVuZ3RoOwogICAgaWYgKGxlbikgewogICAgICB2YXIgYXR0cnMgPSBlbC5hdHRycyA9IG5ldyBBcnJheShsZW4pOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgYXR0cnNbaV0gPSB7CiAgICAgICAgICBuYW1lOiBsaXN0W2ldLm5hbWUsCiAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkobGlzdFtpXS52YWx1ZSkKICAgICAgICB9OwogICAgICAgIGlmIChsaXN0W2ldLnN0YXJ0ICE9IG51bGwpIHsKICAgICAgICAgIGF0dHJzW2ldLnN0YXJ0ID0gbGlzdFtpXS5zdGFydDsKICAgICAgICAgIGF0dHJzW2ldLmVuZCA9IGxpc3RbaV0uZW5kOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICghZWwucHJlKSB7CiAgICAgIC8vIG5vbiByb290IG5vZGUgaW4gcHJlIGJsb2NrcyB3aXRoIG5vIGF0dHJpYnV0ZXMKICAgICAgZWwucGxhaW4gPSB0cnVlOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc0VsZW1lbnQgKAogICAgZWxlbWVudCwKICAgIG9wdGlvbnMKICApIHsKICAgIHByb2Nlc3NLZXkoZWxlbWVudCk7CgogICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhpcyBpcyBhIHBsYWluIGVsZW1lbnQgYWZ0ZXIKICAgIC8vIHJlbW92aW5nIHN0cnVjdHVyYWwgYXR0cmlidXRlcwogICAgZWxlbWVudC5wbGFpbiA9ICgKICAgICAgIWVsZW1lbnQua2V5ICYmCiAgICAgICFlbGVtZW50LnNjb3BlZFNsb3RzICYmCiAgICAgICFlbGVtZW50LmF0dHJzTGlzdC5sZW5ndGgKICAgICk7CgogICAgcHJvY2Vzc1JlZihlbGVtZW50KTsKICAgIHByb2Nlc3NTbG90Q29udGVudChlbGVtZW50KTsKICAgIHByb2Nlc3NTbG90T3V0bGV0KGVsZW1lbnQpOwogICAgcHJvY2Vzc0NvbXBvbmVudChlbGVtZW50KTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJhbnNmb3Jtcy5sZW5ndGg7IGkrKykgewogICAgICBlbGVtZW50ID0gdHJhbnNmb3Jtc1tpXShlbGVtZW50LCBvcHRpb25zKSB8fCBlbGVtZW50OwogICAgfQogICAgcHJvY2Vzc0F0dHJzKGVsZW1lbnQpOwogICAgcmV0dXJuIGVsZW1lbnQKICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NLZXkgKGVsKSB7CiAgICB2YXIgZXhwID0gZ2V0QmluZGluZ0F0dHIoZWwsICdrZXknKTsKICAgIGlmIChleHApIHsKICAgICAgewogICAgICAgIGlmIChlbC50YWcgPT09ICd0ZW1wbGF0ZScpIHsKICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgIjx0ZW1wbGF0ZT4gY2Fubm90IGJlIGtleWVkLiBQbGFjZSB0aGUga2V5IG9uIHJlYWwgZWxlbWVudHMgaW5zdGVhZC4iLAogICAgICAgICAgICBnZXRSYXdCaW5kaW5nQXR0cihlbCwgJ2tleScpCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoZWwuZm9yKSB7CiAgICAgICAgICB2YXIgaXRlcmF0b3IgPSBlbC5pdGVyYXRvcjIgfHwgZWwuaXRlcmF0b3IxOwogICAgICAgICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudDsKICAgICAgICAgIGlmIChpdGVyYXRvciAmJiBpdGVyYXRvciA9PT0gZXhwICYmIHBhcmVudCAmJiBwYXJlbnQudGFnID09PSAndHJhbnNpdGlvbi1ncm91cCcpIHsKICAgICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAgICJEbyBub3QgdXNlIHYtZm9yIGluZGV4IGFzIGtleSBvbiA8dHJhbnNpdGlvbi1ncm91cD4gY2hpbGRyZW4sICIgKwogICAgICAgICAgICAgICJ0aGlzIGlzIHRoZSBzYW1lIGFzIG5vdCB1c2luZyBrZXlzLiIsCiAgICAgICAgICAgICAgZ2V0UmF3QmluZGluZ0F0dHIoZWwsICdrZXknKSwKICAgICAgICAgICAgICB0cnVlIC8qIHRpcCAqLwogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBlbC5rZXkgPSBleHA7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzUmVmIChlbCkgewogICAgdmFyIHJlZiA9IGdldEJpbmRpbmdBdHRyKGVsLCAncmVmJyk7CiAgICBpZiAocmVmKSB7CiAgICAgIGVsLnJlZiA9IHJlZjsKICAgICAgZWwucmVmSW5Gb3IgPSBjaGVja0luRm9yKGVsKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NGb3IgKGVsKSB7CiAgICB2YXIgZXhwOwogICAgaWYgKChleHAgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1mb3InKSkpIHsKICAgICAgdmFyIHJlcyA9IHBhcnNlRm9yKGV4cCk7CiAgICAgIGlmIChyZXMpIHsKICAgICAgICBleHRlbmQoZWwsIHJlcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybiQyKAogICAgICAgICAgKCJJbnZhbGlkIHYtZm9yIGV4cHJlc3Npb246ICIgKyBleHApLAogICAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3YtZm9yJ10KICAgICAgICApOwogICAgICB9CiAgICB9CiAgfQoKCgogIGZ1bmN0aW9uIHBhcnNlRm9yIChleHApIHsKICAgIHZhciBpbk1hdGNoID0gZXhwLm1hdGNoKGZvckFsaWFzUkUpOwogICAgaWYgKCFpbk1hdGNoKSB7IHJldHVybiB9CiAgICB2YXIgcmVzID0ge307CiAgICByZXMuZm9yID0gaW5NYXRjaFsyXS50cmltKCk7CiAgICB2YXIgYWxpYXMgPSBpbk1hdGNoWzFdLnRyaW0oKS5yZXBsYWNlKHN0cmlwUGFyZW5zUkUsICcnKTsKICAgIHZhciBpdGVyYXRvck1hdGNoID0gYWxpYXMubWF0Y2goZm9ySXRlcmF0b3JSRSk7CiAgICBpZiAoaXRlcmF0b3JNYXRjaCkgewogICAgICByZXMuYWxpYXMgPSBhbGlhcy5yZXBsYWNlKGZvckl0ZXJhdG9yUkUsICcnKS50cmltKCk7CiAgICAgIHJlcy5pdGVyYXRvcjEgPSBpdGVyYXRvck1hdGNoWzFdLnRyaW0oKTsKICAgICAgaWYgKGl0ZXJhdG9yTWF0Y2hbMl0pIHsKICAgICAgICByZXMuaXRlcmF0b3IyID0gaXRlcmF0b3JNYXRjaFsyXS50cmltKCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJlcy5hbGlhcyA9IGFsaWFzOwogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc0lmIChlbCkgewogICAgdmFyIGV4cCA9IGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LWlmJyk7CiAgICBpZiAoZXhwKSB7CiAgICAgIGVsLmlmID0gZXhwOwogICAgICBhZGRJZkNvbmRpdGlvbihlbCwgewogICAgICAgIGV4cDogZXhwLAogICAgICAgIGJsb2NrOiBlbAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1lbHNlJykgIT0gbnVsbCkgewogICAgICAgIGVsLmVsc2UgPSB0cnVlOwogICAgICB9CiAgICAgIHZhciBlbHNlaWYgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1lbHNlLWlmJyk7CiAgICAgIGlmIChlbHNlaWYpIHsKICAgICAgICBlbC5lbHNlaWYgPSBlbHNlaWY7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NJZkNvbmRpdGlvbnMgKGVsLCBwYXJlbnQpIHsKICAgIHZhciBwcmV2ID0gZmluZFByZXZFbGVtZW50KHBhcmVudC5jaGlsZHJlbik7CiAgICBpZiAocHJldiAmJiBwcmV2LmlmKSB7CiAgICAgIGFkZElmQ29uZGl0aW9uKHByZXYsIHsKICAgICAgICBleHA6IGVsLmVsc2VpZiwKICAgICAgICBibG9jazogZWwKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB3YXJuJDIoCiAgICAgICAgInYtIiArIChlbC5lbHNlaWYgPyAoJ2Vsc2UtaWY9IicgKyBlbC5lbHNlaWYgKyAnIicpIDogJ2Vsc2UnKSArICIgIiArCiAgICAgICAgInVzZWQgb24gZWxlbWVudCA8IiArIChlbC50YWcpICsgIj4gd2l0aG91dCBjb3JyZXNwb25kaW5nIHYtaWYuIiwKICAgICAgICBlbC5yYXdBdHRyc01hcFtlbC5lbHNlaWYgPyAndi1lbHNlLWlmJyA6ICd2LWVsc2UnXQogICAgICApOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZmluZFByZXZFbGVtZW50IChjaGlsZHJlbikgewogICAgdmFyIGkgPSBjaGlsZHJlbi5sZW5ndGg7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIGlmIChjaGlsZHJlbltpXS50eXBlID09PSAxKSB7CiAgICAgICAgcmV0dXJuIGNoaWxkcmVuW2ldCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGNoaWxkcmVuW2ldLnRleHQgIT09ICcgJykgewogICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAidGV4dCBcIiIgKyAoY2hpbGRyZW5baV0udGV4dC50cmltKCkpICsgIlwiIGJldHdlZW4gdi1pZiBhbmQgdi1lbHNlKC1pZikgIiArCiAgICAgICAgICAgICJ3aWxsIGJlIGlnbm9yZWQuIiwKICAgICAgICAgICAgY2hpbGRyZW5baV0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGNoaWxkcmVuLnBvcCgpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhZGRJZkNvbmRpdGlvbiAoZWwsIGNvbmRpdGlvbikgewogICAgaWYgKCFlbC5pZkNvbmRpdGlvbnMpIHsKICAgICAgZWwuaWZDb25kaXRpb25zID0gW107CiAgICB9CiAgICBlbC5pZkNvbmRpdGlvbnMucHVzaChjb25kaXRpb24pOwogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc09uY2UgKGVsKSB7CiAgICB2YXIgb25jZSQkMSA9IGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LW9uY2UnKTsKICAgIGlmIChvbmNlJCQxICE9IG51bGwpIHsKICAgICAgZWwub25jZSA9IHRydWU7CiAgICB9CiAgfQoKICAvLyBoYW5kbGUgY29udGVudCBiZWluZyBwYXNzZWQgdG8gYSBjb21wb25lbnQgYXMgc2xvdCwKICAvLyBlLmcuIDx0ZW1wbGF0ZSBzbG90PSJ4eHgiPiwgPGRpdiBzbG90LXNjb3BlPSJ4eHgiPgogIGZ1bmN0aW9uIHByb2Nlc3NTbG90Q29udGVudCAoZWwpIHsKICAgIHZhciBzbG90U2NvcGU7CiAgICBpZiAoZWwudGFnID09PSAndGVtcGxhdGUnKSB7CiAgICAgIHNsb3RTY29wZSA9IGdldEFuZFJlbW92ZUF0dHIoZWwsICdzY29wZScpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKHNsb3RTY29wZSkgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICJ0aGUgXCJzY29wZVwiIGF0dHJpYnV0ZSBmb3Igc2NvcGVkIHNsb3RzIGhhdmUgYmVlbiBkZXByZWNhdGVkIGFuZCAiICsKICAgICAgICAgICJyZXBsYWNlZCBieSBcInNsb3Qtc2NvcGVcIiBzaW5jZSAyLjUuIFRoZSBuZXcgXCJzbG90LXNjb3BlXCIgYXR0cmlidXRlICIgKwogICAgICAgICAgImNhbiBhbHNvIGJlIHVzZWQgb24gcGxhaW4gZWxlbWVudHMgaW4gYWRkaXRpb24gdG8gPHRlbXBsYXRlPiB0byAiICsKICAgICAgICAgICJkZW5vdGUgc2NvcGVkIHNsb3RzLiIsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsnc2NvcGUnXSwKICAgICAgICAgIHRydWUKICAgICAgICApOwogICAgICB9CiAgICAgIGVsLnNsb3RTY29wZSA9IHNsb3RTY29wZSB8fCBnZXRBbmRSZW1vdmVBdHRyKGVsLCAnc2xvdC1zY29wZScpOwogICAgfSBlbHNlIGlmICgoc2xvdFNjb3BlID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3Nsb3Qtc2NvcGUnKSkpIHsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmIChlbC5hdHRyc01hcFsndi1mb3InXSkgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICJBbWJpZ3VvdXMgY29tYmluZWQgdXNhZ2Ugb2Ygc2xvdC1zY29wZSBhbmQgdi1mb3Igb24gPCIgKyAoZWwudGFnKSArICI+ICIgKwogICAgICAgICAgIih2LWZvciB0YWtlcyBoaWdoZXIgcHJpb3JpdHkpLiBVc2UgYSB3cmFwcGVyIDx0ZW1wbGF0ZT4gZm9yIHRoZSAiICsKICAgICAgICAgICJzY29wZWQgc2xvdCB0byBtYWtlIGl0IGNsZWFyZXIuIiwKICAgICAgICAgIGVsLnJhd0F0dHJzTWFwWydzbG90LXNjb3BlJ10sCiAgICAgICAgICB0cnVlCiAgICAgICAgKTsKICAgICAgfQogICAgICBlbC5zbG90U2NvcGUgPSBzbG90U2NvcGU7CiAgICB9CgogICAgLy8gc2xvdD0ieHh4IgogICAgdmFyIHNsb3RUYXJnZXQgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3Nsb3QnKTsKICAgIGlmIChzbG90VGFyZ2V0KSB7CiAgICAgIGVsLnNsb3RUYXJnZXQgPSBzbG90VGFyZ2V0ID09PSAnIiInID8gJyJkZWZhdWx0IicgOiBzbG90VGFyZ2V0OwogICAgICBlbC5zbG90VGFyZ2V0RHluYW1pYyA9ICEhKGVsLmF0dHJzTWFwWyc6c2xvdCddIHx8IGVsLmF0dHJzTWFwWyd2LWJpbmQ6c2xvdCddKTsKICAgICAgLy8gcHJlc2VydmUgc2xvdCBhcyBhbiBhdHRyaWJ1dGUgZm9yIG5hdGl2ZSBzaGFkb3cgRE9NIGNvbXBhdAogICAgICAvLyBvbmx5IGZvciBub24tc2NvcGVkIHNsb3RzLgogICAgICBpZiAoZWwudGFnICE9PSAndGVtcGxhdGUnICYmICFlbC5zbG90U2NvcGUpIHsKICAgICAgICBhZGRBdHRyKGVsLCAnc2xvdCcsIHNsb3RUYXJnZXQsIGdldFJhd0JpbmRpbmdBdHRyKGVsLCAnc2xvdCcpKTsKICAgICAgfQogICAgfQoKICAgIC8vIDIuNiB2LXNsb3Qgc3ludGF4CiAgICB7CiAgICAgIGlmIChlbC50YWcgPT09ICd0ZW1wbGF0ZScpIHsKICAgICAgICAvLyB2LXNsb3Qgb24gPHRlbXBsYXRlPgogICAgICAgIHZhciBzbG90QmluZGluZyA9IGdldEFuZFJlbW92ZUF0dHJCeVJlZ2V4KGVsLCBzbG90UkUpOwogICAgICAgIGlmIChzbG90QmluZGluZykgewogICAgICAgICAgewogICAgICAgICAgICBpZiAoZWwuc2xvdFRhcmdldCB8fCBlbC5zbG90U2NvcGUpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiVW5leHBlY3RlZCBtaXhlZCB1c2FnZSBvZiBkaWZmZXJlbnQgc2xvdCBzeW50YXhlcy4iLAogICAgICAgICAgICAgICAgZWwKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbC5wYXJlbnQgJiYgIW1heWJlQ29tcG9uZW50KGVsLnBhcmVudCkpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiPHRlbXBsYXRlIHYtc2xvdD4gY2FuIG9ubHkgYXBwZWFyIGF0IHRoZSByb290IGxldmVsIGluc2lkZSAiICsKICAgICAgICAgICAgICAgICJ0aGUgcmVjZWl2aW5nIGNvbXBvbmVudCIsCiAgICAgICAgICAgICAgICBlbAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHZhciByZWYgPSBnZXRTbG90TmFtZShzbG90QmluZGluZyk7CiAgICAgICAgICB2YXIgbmFtZSA9IHJlZi5uYW1lOwogICAgICAgICAgdmFyIGR5bmFtaWMgPSByZWYuZHluYW1pYzsKICAgICAgICAgIGVsLnNsb3RUYXJnZXQgPSBuYW1lOwogICAgICAgICAgZWwuc2xvdFRhcmdldER5bmFtaWMgPSBkeW5hbWljOwogICAgICAgICAgZWwuc2xvdFNjb3BlID0gc2xvdEJpbmRpbmcudmFsdWUgfHwgZW1wdHlTbG90U2NvcGVUb2tlbjsgLy8gZm9yY2UgaXQgaW50byBhIHNjb3BlZCBzbG90IGZvciBwZXJmCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIHYtc2xvdCBvbiBjb21wb25lbnQsIGRlbm90ZXMgZGVmYXVsdCBzbG90CiAgICAgICAgdmFyIHNsb3RCaW5kaW5nJDEgPSBnZXRBbmRSZW1vdmVBdHRyQnlSZWdleChlbCwgc2xvdFJFKTsKICAgICAgICBpZiAoc2xvdEJpbmRpbmckMSkgewogICAgICAgICAgewogICAgICAgICAgICBpZiAoIW1heWJlQ29tcG9uZW50KGVsKSkgewogICAgICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgICAgICJ2LXNsb3QgY2FuIG9ubHkgYmUgdXNlZCBvbiBjb21wb25lbnRzIG9yIDx0ZW1wbGF0ZT4uIiwKICAgICAgICAgICAgICAgIHNsb3RCaW5kaW5nJDEKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbC5zbG90U2NvcGUgfHwgZWwuc2xvdFRhcmdldCkgewogICAgICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgICAgICJVbmV4cGVjdGVkIG1peGVkIHVzYWdlIG9mIGRpZmZlcmVudCBzbG90IHN5bnRheGVzLiIsCiAgICAgICAgICAgICAgICBlbAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGVsLnNjb3BlZFNsb3RzKSB7CiAgICAgICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAgICAgIlRvIGF2b2lkIHNjb3BlIGFtYmlndWl0eSwgdGhlIGRlZmF1bHQgc2xvdCBzaG91bGQgYWxzbyB1c2UgIiArCiAgICAgICAgICAgICAgICAiPHRlbXBsYXRlPiBzeW50YXggd2hlbiB0aGVyZSBhcmUgb3RoZXIgbmFtZWQgc2xvdHMuIiwKICAgICAgICAgICAgICAgIHNsb3RCaW5kaW5nJDEKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBhZGQgdGhlIGNvbXBvbmVudCdzIGNoaWxkcmVuIHRvIGl0cyBkZWZhdWx0IHNsb3QKICAgICAgICAgIHZhciBzbG90cyA9IGVsLnNjb3BlZFNsb3RzIHx8IChlbC5zY29wZWRTbG90cyA9IHt9KTsKICAgICAgICAgIHZhciByZWYkMSA9IGdldFNsb3ROYW1lKHNsb3RCaW5kaW5nJDEpOwogICAgICAgICAgdmFyIG5hbWUkMSA9IHJlZiQxLm5hbWU7CiAgICAgICAgICB2YXIgZHluYW1pYyQxID0gcmVmJDEuZHluYW1pYzsKICAgICAgICAgIHZhciBzbG90Q29udGFpbmVyID0gc2xvdHNbbmFtZSQxXSA9IGNyZWF0ZUFTVEVsZW1lbnQoJ3RlbXBsYXRlJywgW10sIGVsKTsKICAgICAgICAgIHNsb3RDb250YWluZXIuc2xvdFRhcmdldCA9IG5hbWUkMTsKICAgICAgICAgIHNsb3RDb250YWluZXIuc2xvdFRhcmdldER5bmFtaWMgPSBkeW5hbWljJDE7CiAgICAgICAgICBzbG90Q29udGFpbmVyLmNoaWxkcmVuID0gZWwuY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICAgIGlmICghYy5zbG90U2NvcGUpIHsKICAgICAgICAgICAgICBjLnBhcmVudCA9IHNsb3RDb250YWluZXI7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBzbG90Q29udGFpbmVyLnNsb3RTY29wZSA9IHNsb3RCaW5kaW5nJDEudmFsdWUgfHwgZW1wdHlTbG90U2NvcGVUb2tlbjsKICAgICAgICAgIC8vIHJlbW92ZSBjaGlsZHJlbiBhcyB0aGV5IGFyZSByZXR1cm5lZCBmcm9tIHNjb3BlZFNsb3RzIG5vdwogICAgICAgICAgZWwuY2hpbGRyZW4gPSBbXTsKICAgICAgICAgIC8vIG1hcmsgZWwgbm9uLXBsYWluIHNvIGRhdGEgZ2V0cyBnZW5lcmF0ZWQKICAgICAgICAgIGVsLnBsYWluID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRTbG90TmFtZSAoYmluZGluZykgewogICAgdmFyIG5hbWUgPSBiaW5kaW5nLm5hbWUucmVwbGFjZShzbG90UkUsICcnKTsKICAgIGlmICghbmFtZSkgewogICAgICBpZiAoYmluZGluZy5uYW1lWzBdICE9PSAnIycpIHsKICAgICAgICBuYW1lID0gJ2RlZmF1bHQnOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICJ2LXNsb3Qgc2hvcnRoYW5kIHN5bnRheCByZXF1aXJlcyBhIHNsb3QgbmFtZS4iLAogICAgICAgICAgYmluZGluZwogICAgICAgICk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkeW5hbWljQXJnUkUudGVzdChuYW1lKQogICAgICAvLyBkeW5hbWljIFtuYW1lXQogICAgICA/IHsgbmFtZTogbmFtZS5zbGljZSgxLCAtMSksIGR5bmFtaWM6IHRydWUgfQogICAgICAvLyBzdGF0aWMgbmFtZQogICAgICA6IHsgbmFtZTogKCJcIiIgKyBuYW1lICsgIlwiIiksIGR5bmFtaWM6IGZhbHNlIH0KICB9CgogIC8vIGhhbmRsZSA8c2xvdC8+IG91dGxldHMKICBmdW5jdGlvbiBwcm9jZXNzU2xvdE91dGxldCAoZWwpIHsKICAgIGlmIChlbC50YWcgPT09ICdzbG90JykgewogICAgICBlbC5zbG90TmFtZSA9IGdldEJpbmRpbmdBdHRyKGVsLCAnbmFtZScpOwogICAgICBpZiAoZWwua2V5KSB7CiAgICAgICAgd2FybiQyKAogICAgICAgICAgImBrZXlgIGRvZXMgbm90IHdvcmsgb24gPHNsb3Q+IGJlY2F1c2Ugc2xvdHMgYXJlIGFic3RyYWN0IG91dGxldHMgIiArCiAgICAgICAgICAiYW5kIGNhbiBwb3NzaWJseSBleHBhbmQgaW50byBtdWx0aXBsZSBlbGVtZW50cy4gIiArCiAgICAgICAgICAiVXNlIHRoZSBrZXkgb24gYSB3cmFwcGluZyBlbGVtZW50IGluc3RlYWQuIiwKICAgICAgICAgIGdldFJhd0JpbmRpbmdBdHRyKGVsLCAna2V5JykKICAgICAgICApOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzQ29tcG9uZW50IChlbCkgewogICAgdmFyIGJpbmRpbmc7CiAgICBpZiAoKGJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ2lzJykpKSB7CiAgICAgIGVsLmNvbXBvbmVudCA9IGJpbmRpbmc7CiAgICB9CiAgICBpZiAoZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ2lubGluZS10ZW1wbGF0ZScpICE9IG51bGwpIHsKICAgICAgZWwuaW5saW5lVGVtcGxhdGUgPSB0cnVlOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc0F0dHJzIChlbCkgewogICAgdmFyIGxpc3QgPSBlbC5hdHRyc0xpc3Q7CiAgICB2YXIgaSwgbCwgbmFtZSwgcmF3TmFtZSwgdmFsdWUsIG1vZGlmaWVycywgc3luY0dlbiwgaXNEeW5hbWljOwogICAgZm9yIChpID0gMCwgbCA9IGxpc3QubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIG5hbWUgPSByYXdOYW1lID0gbGlzdFtpXS5uYW1lOwogICAgICB2YWx1ZSA9IGxpc3RbaV0udmFsdWU7CiAgICAgIGlmIChkaXJSRS50ZXN0KG5hbWUpKSB7CiAgICAgICAgLy8gbWFyayBlbGVtZW50IGFzIGR5bmFtaWMKICAgICAgICBlbC5oYXNCaW5kaW5ncyA9IHRydWU7CiAgICAgICAgLy8gbW9kaWZpZXJzCiAgICAgICAgbW9kaWZpZXJzID0gcGFyc2VNb2RpZmllcnMobmFtZS5yZXBsYWNlKGRpclJFLCAnJykpOwogICAgICAgIC8vIHN1cHBvcnQgLmZvbyBzaG9ydGhhbmQgc3ludGF4IGZvciB0aGUgLnByb3AgbW9kaWZpZXIKICAgICAgICBpZiAobW9kaWZpZXJzKSB7CiAgICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKG1vZGlmaWVyUkUsICcnKTsKICAgICAgICB9CiAgICAgICAgaWYgKGJpbmRSRS50ZXN0KG5hbWUpKSB7IC8vIHYtYmluZAogICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZShiaW5kUkUsICcnKTsKICAgICAgICAgIHZhbHVlID0gcGFyc2VGaWx0ZXJzKHZhbHVlKTsKICAgICAgICAgIGlzRHluYW1pYyA9IGR5bmFtaWNBcmdSRS50ZXN0KG5hbWUpOwogICAgICAgICAgaWYgKGlzRHluYW1pYykgewogICAgICAgICAgICBuYW1lID0gbmFtZS5zbGljZSgxLCAtMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHZhbHVlLnRyaW0oKS5sZW5ndGggPT09IDAKICAgICAgICAgICkgewogICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgKCJUaGUgdmFsdWUgZm9yIGEgdi1iaW5kIGV4cHJlc3Npb24gY2Fubm90IGJlIGVtcHR5LiBGb3VuZCBpbiBcInYtYmluZDoiICsgbmFtZSArICJcIiIpCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7CiAgICAgICAgICAgIGlmIChtb2RpZmllcnMucHJvcCAmJiAhaXNEeW5hbWljKSB7CiAgICAgICAgICAgICAgbmFtZSA9IGNhbWVsaXplKG5hbWUpOwogICAgICAgICAgICAgIGlmIChuYW1lID09PSAnaW5uZXJIdG1sJykgeyBuYW1lID0gJ2lubmVySFRNTCc7IH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobW9kaWZpZXJzLmNhbWVsICYmICFpc0R5bmFtaWMpIHsKICAgICAgICAgICAgICBuYW1lID0gY2FtZWxpemUobmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1vZGlmaWVycy5zeW5jKSB7CiAgICAgICAgICAgICAgc3luY0dlbiA9IGdlbkFzc2lnbm1lbnRDb2RlKHZhbHVlLCAiJGV2ZW50Iik7CiAgICAgICAgICAgICAgaWYgKCFpc0R5bmFtaWMpIHsKICAgICAgICAgICAgICAgIGFkZEhhbmRsZXIoCiAgICAgICAgICAgICAgICAgIGVsLAogICAgICAgICAgICAgICAgICAoInVwZGF0ZToiICsgKGNhbWVsaXplKG5hbWUpKSksCiAgICAgICAgICAgICAgICAgIHN5bmNHZW4sCiAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgICB3YXJuJDIsCiAgICAgICAgICAgICAgICAgIGxpc3RbaV0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoaHlwaGVuYXRlKG5hbWUpICE9PSBjYW1lbGl6ZShuYW1lKSkgewogICAgICAgICAgICAgICAgICBhZGRIYW5kbGVyKAogICAgICAgICAgICAgICAgICAgIGVsLAogICAgICAgICAgICAgICAgICAgICgidXBkYXRlOiIgKyAoaHlwaGVuYXRlKG5hbWUpKSksCiAgICAgICAgICAgICAgICAgICAgc3luY0dlbiwKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHdhcm4kMiwKICAgICAgICAgICAgICAgICAgICBsaXN0W2ldCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIGhhbmRsZXIgdy8gZHluYW1pYyBldmVudCBuYW1lCiAgICAgICAgICAgICAgICBhZGRIYW5kbGVyKAogICAgICAgICAgICAgICAgICBlbCwKICAgICAgICAgICAgICAgICAgKCJcInVwZGF0ZTpcIisoIiArIG5hbWUgKyAiKSIpLAogICAgICAgICAgICAgICAgICBzeW5jR2VuLAogICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAgd2FybiQyLAogICAgICAgICAgICAgICAgICBsaXN0W2ldLAogICAgICAgICAgICAgICAgICB0cnVlIC8vIGR5bmFtaWMKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKG1vZGlmaWVycyAmJiBtb2RpZmllcnMucHJvcCkgfHwgKAogICAgICAgICAgICAhZWwuY29tcG9uZW50ICYmIHBsYXRmb3JtTXVzdFVzZVByb3AoZWwudGFnLCBlbC5hdHRyc01hcC50eXBlLCBuYW1lKQogICAgICAgICAgKSkgewogICAgICAgICAgICBhZGRQcm9wKGVsLCBuYW1lLCB2YWx1ZSwgbGlzdFtpXSwgaXNEeW5hbWljKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFkZEF0dHIoZWwsIG5hbWUsIHZhbHVlLCBsaXN0W2ldLCBpc0R5bmFtaWMpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob25SRS50ZXN0KG5hbWUpKSB7IC8vIHYtb24KICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2Uob25SRSwgJycpOwogICAgICAgICAgaXNEeW5hbWljID0gZHluYW1pY0FyZ1JFLnRlc3QobmFtZSk7CiAgICAgICAgICBpZiAoaXNEeW5hbWljKSB7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnNsaWNlKDEsIC0xKTsKICAgICAgICAgIH0KICAgICAgICAgIGFkZEhhbmRsZXIoZWwsIG5hbWUsIHZhbHVlLCBtb2RpZmllcnMsIGZhbHNlLCB3YXJuJDIsIGxpc3RbaV0sIGlzRHluYW1pYyk7CiAgICAgICAgfSBlbHNlIHsgLy8gbm9ybWFsIGRpcmVjdGl2ZXMKICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoZGlyUkUsICcnKTsKICAgICAgICAgIC8vIHBhcnNlIGFyZwogICAgICAgICAgdmFyIGFyZ01hdGNoID0gbmFtZS5tYXRjaChhcmdSRSk7CiAgICAgICAgICB2YXIgYXJnID0gYXJnTWF0Y2ggJiYgYXJnTWF0Y2hbMV07CiAgICAgICAgICBpc0R5bmFtaWMgPSBmYWxzZTsKICAgICAgICAgIGlmIChhcmcpIHsKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc2xpY2UoMCwgLShhcmcubGVuZ3RoICsgMSkpOwogICAgICAgICAgICBpZiAoZHluYW1pY0FyZ1JFLnRlc3QoYXJnKSkgewogICAgICAgICAgICAgIGFyZyA9IGFyZy5zbGljZSgxLCAtMSk7CiAgICAgICAgICAgICAgaXNEeW5hbWljID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYWRkRGlyZWN0aXZlKGVsLCBuYW1lLCByYXdOYW1lLCB2YWx1ZSwgYXJnLCBpc0R5bmFtaWMsIG1vZGlmaWVycywgbGlzdFtpXSk7CiAgICAgICAgICBpZiAobmFtZSA9PT0gJ21vZGVsJykgewogICAgICAgICAgICBjaGVja0ZvckFsaWFzTW9kZWwoZWwsIHZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gbGl0ZXJhbCBhdHRyaWJ1dGUKICAgICAgICB7CiAgICAgICAgICB2YXIgcmVzID0gcGFyc2VUZXh0KHZhbHVlLCBkZWxpbWl0ZXJzKTsKICAgICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAgIG5hbWUgKyAiPVwiIiArIHZhbHVlICsgIlwiOiAiICsKICAgICAgICAgICAgICAnSW50ZXJwb2xhdGlvbiBpbnNpZGUgYXR0cmlidXRlcyBoYXMgYmVlbiByZW1vdmVkLiAnICsKICAgICAgICAgICAgICAnVXNlIHYtYmluZCBvciB0aGUgY29sb24gc2hvcnRoYW5kIGluc3RlYWQuIEZvciBleGFtcGxlLCAnICsKICAgICAgICAgICAgICAnaW5zdGVhZCBvZiA8ZGl2IGlkPSJ7eyB2YWwgfX0iPiwgdXNlIDxkaXYgOmlkPSJ2YWwiPi4nLAogICAgICAgICAgICAgIGxpc3RbaV0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYWRkQXR0cihlbCwgbmFtZSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpLCBsaXN0W2ldKTsKICAgICAgICAvLyAjNjg4NyBmaXJlZm94IGRvZXNuJ3QgdXBkYXRlIG11dGVkIHN0YXRlIGlmIHNldCB2aWEgYXR0cmlidXRlCiAgICAgICAgLy8gZXZlbiBpbW1lZGlhdGVseSBhZnRlciBlbGVtZW50IGNyZWF0aW9uCiAgICAgICAgaWYgKCFlbC5jb21wb25lbnQgJiYKICAgICAgICAgICAgbmFtZSA9PT0gJ211dGVkJyAmJgogICAgICAgICAgICBwbGF0Zm9ybU11c3RVc2VQcm9wKGVsLnRhZywgZWwuYXR0cnNNYXAudHlwZSwgbmFtZSkpIHsKICAgICAgICAgIGFkZFByb3AoZWwsIG5hbWUsICd0cnVlJywgbGlzdFtpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjaGVja0luRm9yIChlbCkgewogICAgdmFyIHBhcmVudCA9IGVsOwogICAgd2hpbGUgKHBhcmVudCkgewogICAgICBpZiAocGFyZW50LmZvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRydWUKICAgICAgfQogICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50OwogICAgfQogICAgcmV0dXJuIGZhbHNlCiAgfQoKICBmdW5jdGlvbiBwYXJzZU1vZGlmaWVycyAobmFtZSkgewogICAgdmFyIG1hdGNoID0gbmFtZS5tYXRjaChtb2RpZmllclJFKTsKICAgIGlmIChtYXRjaCkgewogICAgICB2YXIgcmV0ID0ge307CiAgICAgIG1hdGNoLmZvckVhY2goZnVuY3Rpb24gKG0pIHsgcmV0W20uc2xpY2UoMSldID0gdHJ1ZTsgfSk7CiAgICAgIHJldHVybiByZXQKICAgIH0KICB9CgogIGZ1bmN0aW9uIG1ha2VBdHRyc01hcCAoYXR0cnMpIHsKICAgIHZhciBtYXAgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXR0cnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIGlmICgKICAgICAgICBtYXBbYXR0cnNbaV0ubmFtZV0gJiYgIWlzSUUgJiYgIWlzRWRnZQogICAgICApIHsKICAgICAgICB3YXJuJDIoJ2R1cGxpY2F0ZSBhdHRyaWJ1dGU6ICcgKyBhdHRyc1tpXS5uYW1lLCBhdHRyc1tpXSk7CiAgICAgIH0KICAgICAgbWFwW2F0dHJzW2ldLm5hbWVdID0gYXR0cnNbaV0udmFsdWU7CiAgICB9CiAgICByZXR1cm4gbWFwCiAgfQoKICAvLyBmb3Igc2NyaXB0IChlLmcuIHR5cGU9IngvdGVtcGxhdGUiKSBvciBzdHlsZSwgZG8gbm90IGRlY29kZSBjb250ZW50CiAgZnVuY3Rpb24gaXNUZXh0VGFnIChlbCkgewogICAgcmV0dXJuIGVsLnRhZyA9PT0gJ3NjcmlwdCcgfHwgZWwudGFnID09PSAnc3R5bGUnCiAgfQoKICBmdW5jdGlvbiBpc0ZvcmJpZGRlblRhZyAoZWwpIHsKICAgIHJldHVybiAoCiAgICAgIGVsLnRhZyA9PT0gJ3N0eWxlJyB8fAogICAgICAoZWwudGFnID09PSAnc2NyaXB0JyAmJiAoCiAgICAgICAgIWVsLmF0dHJzTWFwLnR5cGUgfHwKICAgICAgICBlbC5hdHRyc01hcC50eXBlID09PSAndGV4dC9qYXZhc2NyaXB0JwogICAgICApKQogICAgKQogIH0KCiAgdmFyIGllTlNCdWcgPSAvXnhtbG5zOk5TXGQrLzsKICB2YXIgaWVOU1ByZWZpeCA9IC9eTlNcZCs6LzsKCiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICBmdW5jdGlvbiBndWFyZElFU1ZHQnVnIChhdHRycykgewogICAgdmFyIHJlcyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdHRycy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgYXR0ciA9IGF0dHJzW2ldOwogICAgICBpZiAoIWllTlNCdWcudGVzdChhdHRyLm5hbWUpKSB7CiAgICAgICAgYXR0ci5uYW1lID0gYXR0ci5uYW1lLnJlcGxhY2UoaWVOU1ByZWZpeCwgJycpOwogICAgICAgIHJlcy5wdXNoKGF0dHIpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICBmdW5jdGlvbiBjaGVja0ZvckFsaWFzTW9kZWwgKGVsLCB2YWx1ZSkgewogICAgdmFyIF9lbCA9IGVsOwogICAgd2hpbGUgKF9lbCkgewogICAgICBpZiAoX2VsLmZvciAmJiBfZWwuYWxpYXMgPT09IHZhbHVlKSB7CiAgICAgICAgd2FybiQyKAogICAgICAgICAgIjwiICsgKGVsLnRhZykgKyAiIHYtbW9kZWw9XCIiICsgdmFsdWUgKyAiXCI+OiAiICsKICAgICAgICAgICJZb3UgYXJlIGJpbmRpbmcgdi1tb2RlbCBkaXJlY3RseSB0byBhIHYtZm9yIGl0ZXJhdGlvbiBhbGlhcy4gIiArCiAgICAgICAgICAiVGhpcyB3aWxsIG5vdCBiZSBhYmxlIHRvIG1vZGlmeSB0aGUgdi1mb3Igc291cmNlIGFycmF5IGJlY2F1c2UgIiArCiAgICAgICAgICAid3JpdGluZyB0byB0aGUgYWxpYXMgaXMgbGlrZSBtb2RpZnlpbmcgYSBmdW5jdGlvbiBsb2NhbCB2YXJpYWJsZS4gIiArCiAgICAgICAgICAiQ29uc2lkZXIgdXNpbmcgYW4gYXJyYXkgb2Ygb2JqZWN0cyBhbmQgdXNlIHYtbW9kZWwgb24gYW4gb2JqZWN0IHByb3BlcnR5IGluc3RlYWQuIiwKICAgICAgICAgIGVsLnJhd0F0dHJzTWFwWyd2LW1vZGVsJ10KICAgICAgICApOwogICAgICB9CiAgICAgIF9lbCA9IF9lbC5wYXJlbnQ7CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gcHJlVHJhbnNmb3JtTm9kZSAoZWwsIG9wdGlvbnMpIHsKICAgIGlmIChlbC50YWcgPT09ICdpbnB1dCcpIHsKICAgICAgdmFyIG1hcCA9IGVsLmF0dHJzTWFwOwogICAgICBpZiAoIW1hcFsndi1tb2RlbCddKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHZhciB0eXBlQmluZGluZzsKICAgICAgaWYgKG1hcFsnOnR5cGUnXSB8fCBtYXBbJ3YtYmluZDp0eXBlJ10pIHsKICAgICAgICB0eXBlQmluZGluZyA9IGdldEJpbmRpbmdBdHRyKGVsLCAndHlwZScpOwogICAgICB9CiAgICAgIGlmICghbWFwLnR5cGUgJiYgIXR5cGVCaW5kaW5nICYmIG1hcFsndi1iaW5kJ10pIHsKICAgICAgICB0eXBlQmluZGluZyA9ICIoIiArIChtYXBbJ3YtYmluZCddKSArICIpLnR5cGUiOwogICAgICB9CgogICAgICBpZiAodHlwZUJpbmRpbmcpIHsKICAgICAgICB2YXIgaWZDb25kaXRpb24gPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1pZicsIHRydWUpOwogICAgICAgIHZhciBpZkNvbmRpdGlvbkV4dHJhID0gaWZDb25kaXRpb24gPyAoIiYmKCIgKyBpZkNvbmRpdGlvbiArICIpIikgOiAiIjsKICAgICAgICB2YXIgaGFzRWxzZSA9IGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LWVsc2UnLCB0cnVlKSAhPSBudWxsOwogICAgICAgIHZhciBlbHNlSWZDb25kaXRpb24gPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1lbHNlLWlmJywgdHJ1ZSk7CiAgICAgICAgLy8gMS4gY2hlY2tib3gKICAgICAgICB2YXIgYnJhbmNoMCA9IGNsb25lQVNURWxlbWVudChlbCk7CiAgICAgICAgLy8gcHJvY2VzcyBmb3Igb24gdGhlIG1haW4gbm9kZQogICAgICAgIHByb2Nlc3NGb3IoYnJhbmNoMCk7CiAgICAgICAgYWRkUmF3QXR0cihicmFuY2gwLCAndHlwZScsICdjaGVja2JveCcpOwogICAgICAgIHByb2Nlc3NFbGVtZW50KGJyYW5jaDAsIG9wdGlvbnMpOwogICAgICAgIGJyYW5jaDAucHJvY2Vzc2VkID0gdHJ1ZTsgLy8gcHJldmVudCBpdCBmcm9tIGRvdWJsZS1wcm9jZXNzZWQKICAgICAgICBicmFuY2gwLmlmID0gIigiICsgdHlwZUJpbmRpbmcgKyAiKT09PSdjaGVja2JveCciICsgaWZDb25kaXRpb25FeHRyYTsKICAgICAgICBhZGRJZkNvbmRpdGlvbihicmFuY2gwLCB7CiAgICAgICAgICBleHA6IGJyYW5jaDAuaWYsCiAgICAgICAgICBibG9jazogYnJhbmNoMAogICAgICAgIH0pOwogICAgICAgIC8vIDIuIGFkZCByYWRpbyBlbHNlLWlmIGNvbmRpdGlvbgogICAgICAgIHZhciBicmFuY2gxID0gY2xvbmVBU1RFbGVtZW50KGVsKTsKICAgICAgICBnZXRBbmRSZW1vdmVBdHRyKGJyYW5jaDEsICd2LWZvcicsIHRydWUpOwogICAgICAgIGFkZFJhd0F0dHIoYnJhbmNoMSwgJ3R5cGUnLCAncmFkaW8nKTsKICAgICAgICBwcm9jZXNzRWxlbWVudChicmFuY2gxLCBvcHRpb25zKTsKICAgICAgICBhZGRJZkNvbmRpdGlvbihicmFuY2gwLCB7CiAgICAgICAgICBleHA6ICIoIiArIHR5cGVCaW5kaW5nICsgIik9PT0ncmFkaW8nIiArIGlmQ29uZGl0aW9uRXh0cmEsCiAgICAgICAgICBibG9jazogYnJhbmNoMQogICAgICAgIH0pOwogICAgICAgIC8vIDMuIG90aGVyCiAgICAgICAgdmFyIGJyYW5jaDIgPSBjbG9uZUFTVEVsZW1lbnQoZWwpOwogICAgICAgIGdldEFuZFJlbW92ZUF0dHIoYnJhbmNoMiwgJ3YtZm9yJywgdHJ1ZSk7CiAgICAgICAgYWRkUmF3QXR0cihicmFuY2gyLCAnOnR5cGUnLCB0eXBlQmluZGluZyk7CiAgICAgICAgcHJvY2Vzc0VsZW1lbnQoYnJhbmNoMiwgb3B0aW9ucyk7CiAgICAgICAgYWRkSWZDb25kaXRpb24oYnJhbmNoMCwgewogICAgICAgICAgZXhwOiBpZkNvbmRpdGlvbiwKICAgICAgICAgIGJsb2NrOiBicmFuY2gyCiAgICAgICAgfSk7CgogICAgICAgIGlmIChoYXNFbHNlKSB7CiAgICAgICAgICBicmFuY2gwLmVsc2UgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAoZWxzZUlmQ29uZGl0aW9uKSB7CiAgICAgICAgICBicmFuY2gwLmVsc2VpZiA9IGVsc2VJZkNvbmRpdGlvbjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBicmFuY2gwCiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGNsb25lQVNURWxlbWVudCAoZWwpIHsKICAgIHJldHVybiBjcmVhdGVBU1RFbGVtZW50KGVsLnRhZywgZWwuYXR0cnNMaXN0LnNsaWNlKCksIGVsLnBhcmVudCkKICB9CgogIHZhciBtb2RlbCQxID0gewogICAgcHJlVHJhbnNmb3JtTm9kZTogcHJlVHJhbnNmb3JtTm9kZQogIH07CgogIHZhciBtb2R1bGVzJDEgPSBbCiAgICBrbGFzcyQxLAogICAgc3R5bGUkMSwKICAgIG1vZGVsJDEKICBdOwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gdGV4dCAoZWwsIGRpcikgewogICAgaWYgKGRpci52YWx1ZSkgewogICAgICBhZGRQcm9wKGVsLCAndGV4dENvbnRlbnQnLCAoIl9zKCIgKyAoZGlyLnZhbHVlKSArICIpIiksIGRpcik7CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaHRtbCAoZWwsIGRpcikgewogICAgaWYgKGRpci52YWx1ZSkgewogICAgICBhZGRQcm9wKGVsLCAnaW5uZXJIVE1MJywgKCJfcygiICsgKGRpci52YWx1ZSkgKyAiKSIpLCBkaXIpOwogICAgfQogIH0KCiAgdmFyIGRpcmVjdGl2ZXMkMSA9IHsKICAgIG1vZGVsOiBtb2RlbCwKICAgIHRleHQ6IHRleHQsCiAgICBodG1sOiBodG1sCiAgfTsKCiAgLyogICovCgogIHZhciBiYXNlT3B0aW9ucyA9IHsKICAgIGV4cGVjdEhUTUw6IHRydWUsCiAgICBtb2R1bGVzOiBtb2R1bGVzJDEsCiAgICBkaXJlY3RpdmVzOiBkaXJlY3RpdmVzJDEsCiAgICBpc1ByZVRhZzogaXNQcmVUYWcsCiAgICBpc1VuYXJ5VGFnOiBpc1VuYXJ5VGFnLAogICAgbXVzdFVzZVByb3A6IG11c3RVc2VQcm9wLAogICAgY2FuQmVMZWZ0T3BlblRhZzogY2FuQmVMZWZ0T3BlblRhZywKICAgIGlzUmVzZXJ2ZWRUYWc6IGlzUmVzZXJ2ZWRUYWcsCiAgICBnZXRUYWdOYW1lc3BhY2U6IGdldFRhZ05hbWVzcGFjZSwKICAgIHN0YXRpY0tleXM6IGdlblN0YXRpY0tleXMobW9kdWxlcyQxKQogIH07CgogIC8qICAqLwoKICB2YXIgaXNTdGF0aWNLZXk7CiAgdmFyIGlzUGxhdGZvcm1SZXNlcnZlZFRhZzsKCiAgdmFyIGdlblN0YXRpY0tleXNDYWNoZWQgPSBjYWNoZWQoZ2VuU3RhdGljS2V5cyQxKTsKCiAgLyoqCiAgICogR29hbCBvZiB0aGUgb3B0aW1pemVyOiB3YWxrIHRoZSBnZW5lcmF0ZWQgdGVtcGxhdGUgQVNUIHRyZWUKICAgKiBhbmQgZGV0ZWN0IHN1Yi10cmVlcyB0aGF0IGFyZSBwdXJlbHkgc3RhdGljLCBpLmUuIHBhcnRzIG9mCiAgICogdGhlIERPTSB0aGF0IG5ldmVyIG5lZWRzIHRvIGNoYW5nZS4KICAgKgogICAqIE9uY2Ugd2UgZGV0ZWN0IHRoZXNlIHN1Yi10cmVlcywgd2UgY2FuOgogICAqCiAgICogMS4gSG9pc3QgdGhlbSBpbnRvIGNvbnN0YW50cywgc28gdGhhdCB3ZSBubyBsb25nZXIgbmVlZCB0bwogICAqICAgIGNyZWF0ZSBmcmVzaCBub2RlcyBmb3IgdGhlbSBvbiBlYWNoIHJlLXJlbmRlcjsKICAgKiAyLiBDb21wbGV0ZWx5IHNraXAgdGhlbSBpbiB0aGUgcGF0Y2hpbmcgcHJvY2Vzcy4KICAgKi8KICBmdW5jdGlvbiBvcHRpbWl6ZSAocm9vdCwgb3B0aW9ucykgewogICAgaWYgKCFyb290KSB7IHJldHVybiB9CiAgICBpc1N0YXRpY0tleSA9IGdlblN0YXRpY0tleXNDYWNoZWQob3B0aW9ucy5zdGF0aWNLZXlzIHx8ICcnKTsKICAgIGlzUGxhdGZvcm1SZXNlcnZlZFRhZyA9IG9wdGlvbnMuaXNSZXNlcnZlZFRhZyB8fCBubzsKICAgIC8vIGZpcnN0IHBhc3M6IG1hcmsgYWxsIG5vbi1zdGF0aWMgbm9kZXMuCiAgICBtYXJrU3RhdGljJDEocm9vdCk7CiAgICAvLyBzZWNvbmQgcGFzczogbWFyayBzdGF0aWMgcm9vdHMuCiAgICBtYXJrU3RhdGljUm9vdHMocm9vdCwgZmFsc2UpOwogIH0KCiAgZnVuY3Rpb24gZ2VuU3RhdGljS2V5cyQxIChrZXlzKSB7CiAgICByZXR1cm4gbWFrZU1hcCgKICAgICAgJ3R5cGUsdGFnLGF0dHJzTGlzdCxhdHRyc01hcCxwbGFpbixwYXJlbnQsY2hpbGRyZW4sYXR0cnMsc3RhcnQsZW5kLHJhd0F0dHJzTWFwJyArCiAgICAgIChrZXlzID8gJywnICsga2V5cyA6ICcnKQogICAgKQogIH0KCiAgZnVuY3Rpb24gbWFya1N0YXRpYyQxIChub2RlKSB7CiAgICBub2RlLnN0YXRpYyA9IGlzU3RhdGljKG5vZGUpOwogICAgaWYgKG5vZGUudHlwZSA9PT0gMSkgewogICAgICAvLyBkbyBub3QgbWFrZSBjb21wb25lbnQgc2xvdCBjb250ZW50IHN0YXRpYy4gdGhpcyBhdm9pZHMKICAgICAgLy8gMS4gY29tcG9uZW50cyBub3QgYWJsZSB0byBtdXRhdGUgc2xvdCBub2RlcwogICAgICAvLyAyLiBzdGF0aWMgc2xvdCBjb250ZW50IGZhaWxzIGZvciBob3QtcmVsb2FkaW5nCiAgICAgIGlmICgKICAgICAgICAhaXNQbGF0Zm9ybVJlc2VydmVkVGFnKG5vZGUudGFnKSAmJgogICAgICAgIG5vZGUudGFnICE9PSAnc2xvdCcgJiYKICAgICAgICBub2RlLmF0dHJzTWFwWydpbmxpbmUtdGVtcGxhdGUnXSA9PSBudWxsCiAgICAgICkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkcmVuW2ldOwogICAgICAgIG1hcmtTdGF0aWMkMShjaGlsZCk7CiAgICAgICAgaWYgKCFjaGlsZC5zdGF0aWMpIHsKICAgICAgICAgIG5vZGUuc3RhdGljID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChub2RlLmlmQ29uZGl0aW9ucykgewogICAgICAgIGZvciAodmFyIGkkMSA9IDEsIGwkMSA9IG5vZGUuaWZDb25kaXRpb25zLmxlbmd0aDsgaSQxIDwgbCQxOyBpJDErKykgewogICAgICAgICAgdmFyIGJsb2NrID0gbm9kZS5pZkNvbmRpdGlvbnNbaSQxXS5ibG9jazsKICAgICAgICAgIG1hcmtTdGF0aWMkMShibG9jayk7CiAgICAgICAgICBpZiAoIWJsb2NrLnN0YXRpYykgewogICAgICAgICAgICBub2RlLnN0YXRpYyA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gbWFya1N0YXRpY1Jvb3RzIChub2RlLCBpc0luRm9yKSB7CiAgICBpZiAobm9kZS50eXBlID09PSAxKSB7CiAgICAgIGlmIChub2RlLnN0YXRpYyB8fCBub2RlLm9uY2UpIHsKICAgICAgICBub2RlLnN0YXRpY0luRm9yID0gaXNJbkZvcjsKICAgICAgfQogICAgICAvLyBGb3IgYSBub2RlIHRvIHF1YWxpZnkgYXMgYSBzdGF0aWMgcm9vdCwgaXQgc2hvdWxkIGhhdmUgY2hpbGRyZW4gdGhhdAogICAgICAvLyBhcmUgbm90IGp1c3Qgc3RhdGljIHRleHQuIE90aGVyd2lzZSB0aGUgY29zdCBvZiBob2lzdGluZyBvdXQgd2lsbAogICAgICAvLyBvdXR3ZWlnaCB0aGUgYmVuZWZpdHMgYW5kIGl0J3MgYmV0dGVyIG9mZiB0byBqdXN0IGFsd2F5cyByZW5kZXIgaXQgZnJlc2guCiAgICAgIGlmIChub2RlLnN0YXRpYyAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCAmJiAhKAogICAgICAgIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAxICYmCiAgICAgICAgbm9kZS5jaGlsZHJlblswXS50eXBlID09PSAzCiAgICAgICkpIHsKICAgICAgICBub2RlLnN0YXRpY1Jvb3QgPSB0cnVlOwogICAgICAgIHJldHVybgogICAgICB9IGVsc2UgewogICAgICAgIG5vZGUuc3RhdGljUm9vdCA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChub2RlLmNoaWxkcmVuKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBub2RlLmNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgbWFya1N0YXRpY1Jvb3RzKG5vZGUuY2hpbGRyZW5baV0sIGlzSW5Gb3IgfHwgISFub2RlLmZvcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChub2RlLmlmQ29uZGl0aW9ucykgewogICAgICAgIGZvciAodmFyIGkkMSA9IDEsIGwkMSA9IG5vZGUuaWZDb25kaXRpb25zLmxlbmd0aDsgaSQxIDwgbCQxOyBpJDErKykgewogICAgICAgICAgbWFya1N0YXRpY1Jvb3RzKG5vZGUuaWZDb25kaXRpb25zW2kkMV0uYmxvY2ssIGlzSW5Gb3IpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNTdGF0aWMgKG5vZGUpIHsKICAgIGlmIChub2RlLnR5cGUgPT09IDIpIHsgLy8gZXhwcmVzc2lvbgogICAgICByZXR1cm4gZmFsc2UKICAgIH0KICAgIGlmIChub2RlLnR5cGUgPT09IDMpIHsgLy8gdGV4dAogICAgICByZXR1cm4gdHJ1ZQogICAgfQogICAgcmV0dXJuICEhKG5vZGUucHJlIHx8ICgKICAgICAgIW5vZGUuaGFzQmluZGluZ3MgJiYgLy8gbm8gZHluYW1pYyBiaW5kaW5ncwogICAgICAhbm9kZS5pZiAmJiAhbm9kZS5mb3IgJiYgLy8gbm90IHYtaWYgb3Igdi1mb3Igb3Igdi1lbHNlCiAgICAgICFpc0J1aWx0SW5UYWcobm9kZS50YWcpICYmIC8vIG5vdCBhIGJ1aWx0LWluCiAgICAgIGlzUGxhdGZvcm1SZXNlcnZlZFRhZyhub2RlLnRhZykgJiYgLy8gbm90IGEgY29tcG9uZW50CiAgICAgICFpc0RpcmVjdENoaWxkT2ZUZW1wbGF0ZUZvcihub2RlKSAmJgogICAgICBPYmplY3Qua2V5cyhub2RlKS5ldmVyeShpc1N0YXRpY0tleSkKICAgICkpCiAgfQoKICBmdW5jdGlvbiBpc0RpcmVjdENoaWxkT2ZUZW1wbGF0ZUZvciAobm9kZSkgewogICAgd2hpbGUgKG5vZGUucGFyZW50KSB7CiAgICAgIG5vZGUgPSBub2RlLnBhcmVudDsKICAgICAgaWYgKG5vZGUudGFnICE9PSAndGVtcGxhdGUnKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgICAgaWYgKG5vZGUuZm9yKSB7CiAgICAgICAgcmV0dXJuIHRydWUKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlCiAgfQoKICAvKiAgKi8KCiAgdmFyIGZuRXhwUkUgPSAvXihbXHckX10rfFwoW14pXSo/XCkpXHMqPT58XmZ1bmN0aW9uKD86XHMrW1x3JF0rKT9ccypcKC87CiAgdmFyIGZuSW52b2tlUkUgPSAvXChbXildKj9cKTsqJC87CiAgdmFyIHNpbXBsZVBhdGhSRSA9IC9eW0EtWmEtel8kXVtcdyRdKig/OlwuW0EtWmEtel8kXVtcdyRdKnxcWydbXiddKj8nXXxcWyJbXiJdKj8iXXxcW1xkK118XFtbQS1aYS16XyRdW1x3JF0qXSkqJC87CgogIC8vIEtleWJvYXJkRXZlbnQua2V5Q29kZSBhbGlhc2VzCiAgdmFyIGtleUNvZGVzID0gewogICAgZXNjOiAyNywKICAgIHRhYjogOSwKICAgIGVudGVyOiAxMywKICAgIHNwYWNlOiAzMiwKICAgIHVwOiAzOCwKICAgIGxlZnQ6IDM3LAogICAgcmlnaHQ6IDM5LAogICAgZG93bjogNDAsCiAgICAnZGVsZXRlJzogWzgsIDQ2XQogIH07CgogIC8vIEtleWJvYXJkRXZlbnQua2V5IGFsaWFzZXMKICB2YXIga2V5TmFtZXMgPSB7CiAgICAvLyAjNzg4MDogSUUxMSBhbmQgRWRnZSB1c2UgYEVzY2AgZm9yIEVzY2FwZSBrZXkgbmFtZS4KICAgIGVzYzogWydFc2MnLCAnRXNjYXBlJ10sCiAgICB0YWI6ICdUYWInLAogICAgZW50ZXI6ICdFbnRlcicsCiAgICAvLyAjOTExMjogSUUxMSB1c2VzIGBTcGFjZWJhcmAgZm9yIFNwYWNlIGtleSBuYW1lLgogICAgc3BhY2U6IFsnICcsICdTcGFjZWJhciddLAogICAgLy8gIzc4MDY6IElFMTEgdXNlcyBrZXkgbmFtZXMgd2l0aG91dCBgQXJyb3dgIHByZWZpeCBmb3IgYXJyb3cga2V5cy4KICAgIHVwOiBbJ1VwJywgJ0Fycm93VXAnXSwKICAgIGxlZnQ6IFsnTGVmdCcsICdBcnJvd0xlZnQnXSwKICAgIHJpZ2h0OiBbJ1JpZ2h0JywgJ0Fycm93UmlnaHQnXSwKICAgIGRvd246IFsnRG93bicsICdBcnJvd0Rvd24nXSwKICAgIC8vICM5MTEyOiBJRTExIHVzZXMgYERlbGAgZm9yIERlbGV0ZSBrZXkgbmFtZS4KICAgICdkZWxldGUnOiBbJ0JhY2tzcGFjZScsICdEZWxldGUnLCAnRGVsJ10KICB9OwoKICAvLyAjNDg2ODogbW9kaWZpZXJzIHRoYXQgcHJldmVudCB0aGUgZXhlY3V0aW9uIG9mIHRoZSBsaXN0ZW5lcgogIC8vIG5lZWQgdG8gZXhwbGljaXRseSByZXR1cm4gbnVsbCBzbyB0aGF0IHdlIGNhbiBkZXRlcm1pbmUgd2hldGhlciB0byByZW1vdmUKICAvLyB0aGUgbGlzdGVuZXIgZm9yIC5vbmNlCiAgdmFyIGdlbkd1YXJkID0gZnVuY3Rpb24gKGNvbmRpdGlvbikgeyByZXR1cm4gKCJpZigiICsgY29uZGl0aW9uICsgIilyZXR1cm4gbnVsbDsiKTsgfTsKCiAgdmFyIG1vZGlmaWVyQ29kZSA9IHsKICAgIHN0b3A6ICckZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7JywKICAgIHByZXZlbnQ6ICckZXZlbnQucHJldmVudERlZmF1bHQoKTsnLAogICAgc2VsZjogZ2VuR3VhcmQoIiRldmVudC50YXJnZXQgIT09ICRldmVudC5jdXJyZW50VGFyZ2V0IiksCiAgICBjdHJsOiBnZW5HdWFyZCgiISRldmVudC5jdHJsS2V5IiksCiAgICBzaGlmdDogZ2VuR3VhcmQoIiEkZXZlbnQuc2hpZnRLZXkiKSwKICAgIGFsdDogZ2VuR3VhcmQoIiEkZXZlbnQuYWx0S2V5IiksCiAgICBtZXRhOiBnZW5HdWFyZCgiISRldmVudC5tZXRhS2V5IiksCiAgICBsZWZ0OiBnZW5HdWFyZCgiJ2J1dHRvbicgaW4gJGV2ZW50ICYmICRldmVudC5idXR0b24gIT09IDAiKSwKICAgIG1pZGRsZTogZ2VuR3VhcmQoIididXR0b24nIGluICRldmVudCAmJiAkZXZlbnQuYnV0dG9uICE9PSAxIiksCiAgICByaWdodDogZ2VuR3VhcmQoIididXR0b24nIGluICRldmVudCAmJiAkZXZlbnQuYnV0dG9uICE9PSAyIikKICB9OwoKICBmdW5jdGlvbiBnZW5IYW5kbGVycyAoCiAgICBldmVudHMsCiAgICBpc05hdGl2ZQogICkgewogICAgdmFyIHByZWZpeCA9IGlzTmF0aXZlID8gJ25hdGl2ZU9uOicgOiAnb246JzsKICAgIHZhciBzdGF0aWNIYW5kbGVycyA9ICIiOwogICAgdmFyIGR5bmFtaWNIYW5kbGVycyA9ICIiOwogICAgZm9yICh2YXIgbmFtZSBpbiBldmVudHMpIHsKICAgICAgdmFyIGhhbmRsZXJDb2RlID0gZ2VuSGFuZGxlcihldmVudHNbbmFtZV0pOwogICAgICBpZiAoZXZlbnRzW25hbWVdICYmIGV2ZW50c1tuYW1lXS5keW5hbWljKSB7CiAgICAgICAgZHluYW1pY0hhbmRsZXJzICs9IG5hbWUgKyAiLCIgKyBoYW5kbGVyQ29kZSArICIsIjsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdGF0aWNIYW5kbGVycyArPSAiXCIiICsgbmFtZSArICJcIjoiICsgaGFuZGxlckNvZGUgKyAiLCI7CiAgICAgIH0KICAgIH0KICAgIHN0YXRpY0hhbmRsZXJzID0gInsiICsgKHN0YXRpY0hhbmRsZXJzLnNsaWNlKDAsIC0xKSkgKyAifSI7CiAgICBpZiAoZHluYW1pY0hhbmRsZXJzKSB7CiAgICAgIHJldHVybiBwcmVmaXggKyAiX2QoIiArIHN0YXRpY0hhbmRsZXJzICsgIixbIiArIChkeW5hbWljSGFuZGxlcnMuc2xpY2UoMCwgLTEpKSArICJdKSIKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBwcmVmaXggKyBzdGF0aWNIYW5kbGVycwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2VuSGFuZGxlciAoaGFuZGxlcikgewogICAgaWYgKCFoYW5kbGVyKSB7CiAgICAgIHJldHVybiAnZnVuY3Rpb24oKXt9JwogICAgfQoKICAgIGlmIChBcnJheS5pc0FycmF5KGhhbmRsZXIpKSB7CiAgICAgIHJldHVybiAoIlsiICsgKGhhbmRsZXIubWFwKGZ1bmN0aW9uIChoYW5kbGVyKSB7IHJldHVybiBnZW5IYW5kbGVyKGhhbmRsZXIpOyB9KS5qb2luKCcsJykpICsgIl0iKQogICAgfQoKICAgIHZhciBpc01ldGhvZFBhdGggPSBzaW1wbGVQYXRoUkUudGVzdChoYW5kbGVyLnZhbHVlKTsKICAgIHZhciBpc0Z1bmN0aW9uRXhwcmVzc2lvbiA9IGZuRXhwUkUudGVzdChoYW5kbGVyLnZhbHVlKTsKICAgIHZhciBpc0Z1bmN0aW9uSW52b2NhdGlvbiA9IHNpbXBsZVBhdGhSRS50ZXN0KGhhbmRsZXIudmFsdWUucmVwbGFjZShmbkludm9rZVJFLCAnJykpOwoKICAgIGlmICghaGFuZGxlci5tb2RpZmllcnMpIHsKICAgICAgaWYgKGlzTWV0aG9kUGF0aCB8fCBpc0Z1bmN0aW9uRXhwcmVzc2lvbikgewogICAgICAgIHJldHVybiBoYW5kbGVyLnZhbHVlCiAgICAgIH0KICAgICAgcmV0dXJuICgiZnVuY3Rpb24oJGV2ZW50KXsiICsgKGlzRnVuY3Rpb25JbnZvY2F0aW9uID8gKCJyZXR1cm4gIiArIChoYW5kbGVyLnZhbHVlKSkgOiBoYW5kbGVyLnZhbHVlKSArICJ9IikgLy8gaW5saW5lIHN0YXRlbWVudAogICAgfSBlbHNlIHsKICAgICAgdmFyIGNvZGUgPSAnJzsKICAgICAgdmFyIGdlbk1vZGlmaWVyQ29kZSA9ICcnOwogICAgICB2YXIga2V5cyA9IFtdOwogICAgICBmb3IgKHZhciBrZXkgaW4gaGFuZGxlci5tb2RpZmllcnMpIHsKICAgICAgICBpZiAobW9kaWZpZXJDb2RlW2tleV0pIHsKICAgICAgICAgIGdlbk1vZGlmaWVyQ29kZSArPSBtb2RpZmllckNvZGVba2V5XTsKICAgICAgICAgIC8vIGxlZnQvcmlnaHQKICAgICAgICAgIGlmIChrZXlDb2Rlc1trZXldKSB7CiAgICAgICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnZXhhY3QnKSB7CiAgICAgICAgICB2YXIgbW9kaWZpZXJzID0gKGhhbmRsZXIubW9kaWZpZXJzKTsKICAgICAgICAgIGdlbk1vZGlmaWVyQ29kZSArPSBnZW5HdWFyZCgKICAgICAgICAgICAgWydjdHJsJywgJ3NoaWZ0JywgJ2FsdCcsICdtZXRhJ10KICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChrZXlNb2RpZmllcikgeyByZXR1cm4gIW1vZGlmaWVyc1trZXlNb2RpZmllcl07IH0pCiAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoa2V5TW9kaWZpZXIpIHsgcmV0dXJuICgiJGV2ZW50LiIgKyBrZXlNb2RpZmllciArICJLZXkiKTsgfSkKICAgICAgICAgICAgICAuam9pbignfHwnKQogICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChrZXlzLmxlbmd0aCkgewogICAgICAgIGNvZGUgKz0gZ2VuS2V5RmlsdGVyKGtleXMpOwogICAgICB9CiAgICAgIC8vIE1ha2Ugc3VyZSBtb2RpZmllcnMgbGlrZSBwcmV2ZW50IGFuZCBzdG9wIGdldCBleGVjdXRlZCBhZnRlciBrZXkgZmlsdGVyaW5nCiAgICAgIGlmIChnZW5Nb2RpZmllckNvZGUpIHsKICAgICAgICBjb2RlICs9IGdlbk1vZGlmaWVyQ29kZTsKICAgICAgfQogICAgICB2YXIgaGFuZGxlckNvZGUgPSBpc01ldGhvZFBhdGgKICAgICAgICA/ICgicmV0dXJuICIgKyAoaGFuZGxlci52YWx1ZSkgKyAiKCRldmVudCkiKQogICAgICAgIDogaXNGdW5jdGlvbkV4cHJlc3Npb24KICAgICAgICAgID8gKCJyZXR1cm4gKCIgKyAoaGFuZGxlci52YWx1ZSkgKyAiKSgkZXZlbnQpIikKICAgICAgICAgIDogaXNGdW5jdGlvbkludm9jYXRpb24KICAgICAgICAgICAgPyAoInJldHVybiAiICsgKGhhbmRsZXIudmFsdWUpKQogICAgICAgICAgICA6IGhhbmRsZXIudmFsdWU7CiAgICAgIHJldHVybiAoImZ1bmN0aW9uKCRldmVudCl7IiArIGNvZGUgKyBoYW5kbGVyQ29kZSArICJ9IikKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlbktleUZpbHRlciAoa2V5cykgewogICAgcmV0dXJuICgKICAgICAgLy8gbWFrZSBzdXJlIHRoZSBrZXkgZmlsdGVycyBvbmx5IGFwcGx5IHRvIEtleWJvYXJkRXZlbnRzCiAgICAgIC8vICM5NDQxOiBjYW4ndCB1c2UgJ2tleUNvZGUnIGluICRldmVudCBiZWNhdXNlIENocm9tZSBhdXRvZmlsbCBmaXJlcyBmYWtlCiAgICAgIC8vIGtleSBldmVudHMgdGhhdCBkbyBub3QgaGF2ZSBrZXlDb2RlIHByb3BlcnR5Li4uCiAgICAgICJpZighJGV2ZW50LnR5cGUuaW5kZXhPZigna2V5JykmJiIgKwogICAgICAoa2V5cy5tYXAoZ2VuRmlsdGVyQ29kZSkuam9pbignJiYnKSkgKyAiKXJldHVybiBudWxsOyIKICAgICkKICB9CgogIGZ1bmN0aW9uIGdlbkZpbHRlckNvZGUgKGtleSkgewogICAgdmFyIGtleVZhbCA9IHBhcnNlSW50KGtleSwgMTApOwogICAgaWYgKGtleVZhbCkgewogICAgICByZXR1cm4gKCIkZXZlbnQua2V5Q29kZSE9PSIgKyBrZXlWYWwpCiAgICB9CiAgICB2YXIga2V5Q29kZSA9IGtleUNvZGVzW2tleV07CiAgICB2YXIga2V5TmFtZSA9IGtleU5hbWVzW2tleV07CiAgICByZXR1cm4gKAogICAgICAiX2soJGV2ZW50LmtleUNvZGUsIiArCiAgICAgIChKU09OLnN0cmluZ2lmeShrZXkpKSArICIsIiArCiAgICAgIChKU09OLnN0cmluZ2lmeShrZXlDb2RlKSkgKyAiLCIgKwogICAgICAiJGV2ZW50LmtleSwiICsKICAgICAgIiIgKyAoSlNPTi5zdHJpbmdpZnkoa2V5TmFtZSkpICsKICAgICAgIikiCiAgICApCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gb24gKGVsLCBkaXIpIHsKICAgIGlmIChkaXIubW9kaWZpZXJzKSB7CiAgICAgIHdhcm4oInYtb24gd2l0aG91dCBhcmd1bWVudCBkb2VzIG5vdCBzdXBwb3J0IG1vZGlmaWVycy4iKTsKICAgIH0KICAgIGVsLndyYXBMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoY29kZSkgeyByZXR1cm4gKCJfZygiICsgY29kZSArICIsIiArIChkaXIudmFsdWUpICsgIikiKTsgfTsKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBiaW5kJDEgKGVsLCBkaXIpIHsKICAgIGVsLndyYXBEYXRhID0gZnVuY3Rpb24gKGNvZGUpIHsKICAgICAgcmV0dXJuICgiX2IoIiArIGNvZGUgKyAiLCciICsgKGVsLnRhZykgKyAiJywiICsgKGRpci52YWx1ZSkgKyAiLCIgKyAoZGlyLm1vZGlmaWVycyAmJiBkaXIubW9kaWZpZXJzLnByb3AgPyAndHJ1ZScgOiAnZmFsc2UnKSArIChkaXIubW9kaWZpZXJzICYmIGRpci5tb2RpZmllcnMuc3luYyA/ICcsdHJ1ZScgOiAnJykgKyAiKSIpCiAgICB9OwogIH0KCiAgLyogICovCgogIHZhciBiYXNlRGlyZWN0aXZlcyA9IHsKICAgIG9uOiBvbiwKICAgIGJpbmQ6IGJpbmQkMSwKICAgIGNsb2FrOiBub29wCiAgfTsKCiAgLyogICovCgoKCgoKICB2YXIgQ29kZWdlblN0YXRlID0gZnVuY3Rpb24gQ29kZWdlblN0YXRlIChvcHRpb25zKSB7CiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgdGhpcy53YXJuID0gb3B0aW9ucy53YXJuIHx8IGJhc2VXYXJuOwogICAgdGhpcy50cmFuc2Zvcm1zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICd0cmFuc2Zvcm1Db2RlJyk7CiAgICB0aGlzLmRhdGFHZW5GbnMgPSBwbHVja01vZHVsZUZ1bmN0aW9uKG9wdGlvbnMubW9kdWxlcywgJ2dlbkRhdGEnKTsKICAgIHRoaXMuZGlyZWN0aXZlcyA9IGV4dGVuZChleHRlbmQoe30sIGJhc2VEaXJlY3RpdmVzKSwgb3B0aW9ucy5kaXJlY3RpdmVzKTsKICAgIHZhciBpc1Jlc2VydmVkVGFnID0gb3B0aW9ucy5pc1Jlc2VydmVkVGFnIHx8IG5vOwogICAgdGhpcy5tYXliZUNvbXBvbmVudCA9IGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gISFlbC5jb21wb25lbnQgfHwgIWlzUmVzZXJ2ZWRUYWcoZWwudGFnKTsgfTsKICAgIHRoaXMub25jZUlkID0gMDsKICAgIHRoaXMuc3RhdGljUmVuZGVyRm5zID0gW107CiAgICB0aGlzLnByZSA9IGZhbHNlOwogIH07CgoKCiAgZnVuY3Rpb24gZ2VuZXJhdGUgKAogICAgYXN0LAogICAgb3B0aW9ucwogICkgewogICAgdmFyIHN0YXRlID0gbmV3IENvZGVnZW5TdGF0ZShvcHRpb25zKTsKICAgIHZhciBjb2RlID0gYXN0ID8gZ2VuRWxlbWVudChhc3QsIHN0YXRlKSA6ICdfYygiZGl2IiknOwogICAgcmV0dXJuIHsKICAgICAgcmVuZGVyOiAoIndpdGgodGhpcyl7cmV0dXJuICIgKyBjb2RlICsgIn0iKSwKICAgICAgc3RhdGljUmVuZGVyRm5zOiBzdGF0ZS5zdGF0aWNSZW5kZXJGbnMKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlbkVsZW1lbnQgKGVsLCBzdGF0ZSkgewogICAgaWYgKGVsLnBhcmVudCkgewogICAgICBlbC5wcmUgPSBlbC5wcmUgfHwgZWwucGFyZW50LnByZTsKICAgIH0KCiAgICBpZiAoZWwuc3RhdGljUm9vdCAmJiAhZWwuc3RhdGljUHJvY2Vzc2VkKSB7CiAgICAgIHJldHVybiBnZW5TdGF0aWMoZWwsIHN0YXRlKQogICAgfSBlbHNlIGlmIChlbC5vbmNlICYmICFlbC5vbmNlUHJvY2Vzc2VkKSB7CiAgICAgIHJldHVybiBnZW5PbmNlKGVsLCBzdGF0ZSkKICAgIH0gZWxzZSBpZiAoZWwuZm9yICYmICFlbC5mb3JQcm9jZXNzZWQpIHsKICAgICAgcmV0dXJuIGdlbkZvcihlbCwgc3RhdGUpCiAgICB9IGVsc2UgaWYgKGVsLmlmICYmICFlbC5pZlByb2Nlc3NlZCkgewogICAgICByZXR1cm4gZ2VuSWYoZWwsIHN0YXRlKQogICAgfSBlbHNlIGlmIChlbC50YWcgPT09ICd0ZW1wbGF0ZScgJiYgIWVsLnNsb3RUYXJnZXQgJiYgIXN0YXRlLnByZSkgewogICAgICByZXR1cm4gZ2VuQ2hpbGRyZW4oZWwsIHN0YXRlKSB8fCAndm9pZCAwJwogICAgfSBlbHNlIGlmIChlbC50YWcgPT09ICdzbG90JykgewogICAgICByZXR1cm4gZ2VuU2xvdChlbCwgc3RhdGUpCiAgICB9IGVsc2UgewogICAgICAvLyBjb21wb25lbnQgb3IgZWxlbWVudAogICAgICB2YXIgY29kZTsKICAgICAgaWYgKGVsLmNvbXBvbmVudCkgewogICAgICAgIGNvZGUgPSBnZW5Db21wb25lbnQoZWwuY29tcG9uZW50LCBlbCwgc3RhdGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBkYXRhOwogICAgICAgIGlmICghZWwucGxhaW4gfHwgKGVsLnByZSAmJiBzdGF0ZS5tYXliZUNvbXBvbmVudChlbCkpKSB7CiAgICAgICAgICBkYXRhID0gZ2VuRGF0YSQyKGVsLCBzdGF0ZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2hpbGRyZW4gPSBlbC5pbmxpbmVUZW1wbGF0ZSA/IG51bGwgOiBnZW5DaGlsZHJlbihlbCwgc3RhdGUsIHRydWUpOwogICAgICAgIGNvZGUgPSAiX2MoJyIgKyAoZWwudGFnKSArICInIiArIChkYXRhID8gKCIsIiArIGRhdGEpIDogJycpICsgKGNoaWxkcmVuID8gKCIsIiArIGNoaWxkcmVuKSA6ICcnKSArICIpIjsKICAgICAgfQogICAgICAvLyBtb2R1bGUgdHJhbnNmb3JtcwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0YXRlLnRyYW5zZm9ybXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb2RlID0gc3RhdGUudHJhbnNmb3Jtc1tpXShlbCwgY29kZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvZGUKICAgIH0KICB9CgogIC8vIGhvaXN0IHN0YXRpYyBzdWItdHJlZXMgb3V0CiAgZnVuY3Rpb24gZ2VuU3RhdGljIChlbCwgc3RhdGUpIHsKICAgIGVsLnN0YXRpY1Byb2Nlc3NlZCA9IHRydWU7CiAgICAvLyBTb21lIGVsZW1lbnRzICh0ZW1wbGF0ZXMpIG5lZWQgdG8gYmVoYXZlIGRpZmZlcmVudGx5IGluc2lkZSBvZiBhIHYtcHJlCiAgICAvLyBub2RlLiAgQWxsIHByZSBub2RlcyBhcmUgc3RhdGljIHJvb3RzLCBzbyB3ZSBjYW4gdXNlIHRoaXMgYXMgYSBsb2NhdGlvbiB0bwogICAgLy8gd3JhcCBhIHN0YXRlIGNoYW5nZSBhbmQgcmVzZXQgaXQgdXBvbiBleGl0aW5nIHRoZSBwcmUgbm9kZS4KICAgIHZhciBvcmlnaW5hbFByZVN0YXRlID0gc3RhdGUucHJlOwogICAgaWYgKGVsLnByZSkgewogICAgICBzdGF0ZS5wcmUgPSBlbC5wcmU7CiAgICB9CiAgICBzdGF0ZS5zdGF0aWNSZW5kZXJGbnMucHVzaCgoIndpdGgodGhpcyl7cmV0dXJuICIgKyAoZ2VuRWxlbWVudChlbCwgc3RhdGUpKSArICJ9IikpOwogICAgc3RhdGUucHJlID0gb3JpZ2luYWxQcmVTdGF0ZTsKICAgIHJldHVybiAoIl9tKCIgKyAoc3RhdGUuc3RhdGljUmVuZGVyRm5zLmxlbmd0aCAtIDEpICsgKGVsLnN0YXRpY0luRm9yID8gJyx0cnVlJyA6ICcnKSArICIpIikKICB9CgogIC8vIHYtb25jZQogIGZ1bmN0aW9uIGdlbk9uY2UgKGVsLCBzdGF0ZSkgewogICAgZWwub25jZVByb2Nlc3NlZCA9IHRydWU7CiAgICBpZiAoZWwuaWYgJiYgIWVsLmlmUHJvY2Vzc2VkKSB7CiAgICAgIHJldHVybiBnZW5JZihlbCwgc3RhdGUpCiAgICB9IGVsc2UgaWYgKGVsLnN0YXRpY0luRm9yKSB7CiAgICAgIHZhciBrZXkgPSAnJzsKICAgICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudDsKICAgICAgd2hpbGUgKHBhcmVudCkgewogICAgICAgIGlmIChwYXJlbnQuZm9yKSB7CiAgICAgICAgICBrZXkgPSBwYXJlbnQua2V5OwogICAgICAgICAgYnJlYWsKICAgICAgICB9CiAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDsKICAgICAgfQogICAgICBpZiAoIWtleSkgewogICAgICAgIHN0YXRlLndhcm4oCiAgICAgICAgICAidi1vbmNlIGNhbiBvbmx5IGJlIHVzZWQgaW5zaWRlIHYtZm9yIHRoYXQgaXMga2V5ZWQuICIsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsndi1vbmNlJ10KICAgICAgICApOwogICAgICAgIHJldHVybiBnZW5FbGVtZW50KGVsLCBzdGF0ZSkKICAgICAgfQogICAgICByZXR1cm4gKCJfbygiICsgKGdlbkVsZW1lbnQoZWwsIHN0YXRlKSkgKyAiLCIgKyAoc3RhdGUub25jZUlkKyspICsgIiwiICsga2V5ICsgIikiKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGdlblN0YXRpYyhlbCwgc3RhdGUpCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5JZiAoCiAgICBlbCwKICAgIHN0YXRlLAogICAgYWx0R2VuLAogICAgYWx0RW1wdHkKICApIHsKICAgIGVsLmlmUHJvY2Vzc2VkID0gdHJ1ZTsgLy8gYXZvaWQgcmVjdXJzaW9uCiAgICByZXR1cm4gZ2VuSWZDb25kaXRpb25zKGVsLmlmQ29uZGl0aW9ucy5zbGljZSgpLCBzdGF0ZSwgYWx0R2VuLCBhbHRFbXB0eSkKICB9CgogIGZ1bmN0aW9uIGdlbklmQ29uZGl0aW9ucyAoCiAgICBjb25kaXRpb25zLAogICAgc3RhdGUsCiAgICBhbHRHZW4sCiAgICBhbHRFbXB0eQogICkgewogICAgaWYgKCFjb25kaXRpb25zLmxlbmd0aCkgewogICAgICByZXR1cm4gYWx0RW1wdHkgfHwgJ19lKCknCiAgICB9CgogICAgdmFyIGNvbmRpdGlvbiA9IGNvbmRpdGlvbnMuc2hpZnQoKTsKICAgIGlmIChjb25kaXRpb24uZXhwKSB7CiAgICAgIHJldHVybiAoIigiICsgKGNvbmRpdGlvbi5leHApICsgIik/IiArIChnZW5UZXJuYXJ5RXhwKGNvbmRpdGlvbi5ibG9jaykpICsgIjoiICsgKGdlbklmQ29uZGl0aW9ucyhjb25kaXRpb25zLCBzdGF0ZSwgYWx0R2VuLCBhbHRFbXB0eSkpKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICgiIiArIChnZW5UZXJuYXJ5RXhwKGNvbmRpdGlvbi5ibG9jaykpKQogICAgfQoKICAgIC8vIHYtaWYgd2l0aCB2LW9uY2Ugc2hvdWxkIGdlbmVyYXRlIGNvZGUgbGlrZSAoYSk/X20oMCk6X20oMSkKICAgIGZ1bmN0aW9uIGdlblRlcm5hcnlFeHAgKGVsKSB7CiAgICAgIHJldHVybiBhbHRHZW4KICAgICAgICA/IGFsdEdlbihlbCwgc3RhdGUpCiAgICAgICAgOiBlbC5vbmNlCiAgICAgICAgICA/IGdlbk9uY2UoZWwsIHN0YXRlKQogICAgICAgICAgOiBnZW5FbGVtZW50KGVsLCBzdGF0ZSkKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlbkZvciAoCiAgICBlbCwKICAgIHN0YXRlLAogICAgYWx0R2VuLAogICAgYWx0SGVscGVyCiAgKSB7CiAgICB2YXIgZXhwID0gZWwuZm9yOwogICAgdmFyIGFsaWFzID0gZWwuYWxpYXM7CiAgICB2YXIgaXRlcmF0b3IxID0gZWwuaXRlcmF0b3IxID8gKCIsIiArIChlbC5pdGVyYXRvcjEpKSA6ICcnOwogICAgdmFyIGl0ZXJhdG9yMiA9IGVsLml0ZXJhdG9yMiA/ICgiLCIgKyAoZWwuaXRlcmF0b3IyKSkgOiAnJzsKCiAgICBpZiAoc3RhdGUubWF5YmVDb21wb25lbnQoZWwpICYmCiAgICAgIGVsLnRhZyAhPT0gJ3Nsb3QnICYmCiAgICAgIGVsLnRhZyAhPT0gJ3RlbXBsYXRlJyAmJgogICAgICAhZWwua2V5CiAgICApIHsKICAgICAgc3RhdGUud2FybigKICAgICAgICAiPCIgKyAoZWwudGFnKSArICIgdi1mb3I9XCIiICsgYWxpYXMgKyAiIGluICIgKyBleHAgKyAiXCI+OiBjb21wb25lbnQgbGlzdHMgcmVuZGVyZWQgd2l0aCAiICsKICAgICAgICAidi1mb3Igc2hvdWxkIGhhdmUgZXhwbGljaXQga2V5cy4gIiArCiAgICAgICAgIlNlZSBodHRwczovL3Z1ZWpzLm9yZy9ndWlkZS9saXN0Lmh0bWwja2V5IGZvciBtb3JlIGluZm8uIiwKICAgICAgICBlbC5yYXdBdHRyc01hcFsndi1mb3InXSwKICAgICAgICB0cnVlIC8qIHRpcCAqLwogICAgICApOwogICAgfQoKICAgIGVsLmZvclByb2Nlc3NlZCA9IHRydWU7IC8vIGF2b2lkIHJlY3Vyc2lvbgogICAgcmV0dXJuIChhbHRIZWxwZXIgfHwgJ19sJykgKyAiKCgiICsgZXhwICsgIiksIiArCiAgICAgICJmdW5jdGlvbigiICsgYWxpYXMgKyBpdGVyYXRvcjEgKyBpdGVyYXRvcjIgKyAiKXsiICsKICAgICAgICAicmV0dXJuICIgKyAoKGFsdEdlbiB8fCBnZW5FbGVtZW50KShlbCwgc3RhdGUpKSArCiAgICAgICd9KScKICB9CgogIGZ1bmN0aW9uIGdlbkRhdGEkMiAoZWwsIHN0YXRlKSB7CiAgICB2YXIgZGF0YSA9ICd7JzsKCiAgICAvLyBkaXJlY3RpdmVzIGZpcnN0LgogICAgLy8gZGlyZWN0aXZlcyBtYXkgbXV0YXRlIHRoZSBlbCdzIG90aGVyIHByb3BlcnRpZXMgYmVmb3JlIHRoZXkgYXJlIGdlbmVyYXRlZC4KICAgIHZhciBkaXJzID0gZ2VuRGlyZWN0aXZlcyhlbCwgc3RhdGUpOwogICAgaWYgKGRpcnMpIHsgZGF0YSArPSBkaXJzICsgJywnOyB9CgogICAgLy8ga2V5CiAgICBpZiAoZWwua2V5KSB7CiAgICAgIGRhdGEgKz0gImtleToiICsgKGVsLmtleSkgKyAiLCI7CiAgICB9CiAgICAvLyByZWYKICAgIGlmIChlbC5yZWYpIHsKICAgICAgZGF0YSArPSAicmVmOiIgKyAoZWwucmVmKSArICIsIjsKICAgIH0KICAgIGlmIChlbC5yZWZJbkZvcikgewogICAgICBkYXRhICs9ICJyZWZJbkZvcjp0cnVlLCI7CiAgICB9CiAgICAvLyBwcmUKICAgIGlmIChlbC5wcmUpIHsKICAgICAgZGF0YSArPSAicHJlOnRydWUsIjsKICAgIH0KICAgIC8vIHJlY29yZCBvcmlnaW5hbCB0YWcgbmFtZSBmb3IgY29tcG9uZW50cyB1c2luZyAiaXMiIGF0dHJpYnV0ZQogICAgaWYgKGVsLmNvbXBvbmVudCkgewogICAgICBkYXRhICs9ICJ0YWc6XCIiICsgKGVsLnRhZykgKyAiXCIsIjsKICAgIH0KICAgIC8vIG1vZHVsZSBkYXRhIGdlbmVyYXRpb24gZnVuY3Rpb25zCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0YXRlLmRhdGFHZW5GbnMubGVuZ3RoOyBpKyspIHsKICAgICAgZGF0YSArPSBzdGF0ZS5kYXRhR2VuRm5zW2ldKGVsKTsKICAgIH0KICAgIC8vIGF0dHJpYnV0ZXMKICAgIGlmIChlbC5hdHRycykgewogICAgICBkYXRhICs9ICJhdHRyczoiICsgKGdlblByb3BzKGVsLmF0dHJzKSkgKyAiLCI7CiAgICB9CiAgICAvLyBET00gcHJvcHMKICAgIGlmIChlbC5wcm9wcykgewogICAgICBkYXRhICs9ICJkb21Qcm9wczoiICsgKGdlblByb3BzKGVsLnByb3BzKSkgKyAiLCI7CiAgICB9CiAgICAvLyBldmVudCBoYW5kbGVycwogICAgaWYgKGVsLmV2ZW50cykgewogICAgICBkYXRhICs9IChnZW5IYW5kbGVycyhlbC5ldmVudHMsIGZhbHNlKSkgKyAiLCI7CiAgICB9CiAgICBpZiAoZWwubmF0aXZlRXZlbnRzKSB7CiAgICAgIGRhdGEgKz0gKGdlbkhhbmRsZXJzKGVsLm5hdGl2ZUV2ZW50cywgdHJ1ZSkpICsgIiwiOwogICAgfQogICAgLy8gc2xvdCB0YXJnZXQKICAgIC8vIG9ubHkgZm9yIG5vbi1zY29wZWQgc2xvdHMKICAgIGlmIChlbC5zbG90VGFyZ2V0ICYmICFlbC5zbG90U2NvcGUpIHsKICAgICAgZGF0YSArPSAic2xvdDoiICsgKGVsLnNsb3RUYXJnZXQpICsgIiwiOwogICAgfQogICAgLy8gc2NvcGVkIHNsb3RzCiAgICBpZiAoZWwuc2NvcGVkU2xvdHMpIHsKICAgICAgZGF0YSArPSAoZ2VuU2NvcGVkU2xvdHMoZWwsIGVsLnNjb3BlZFNsb3RzLCBzdGF0ZSkpICsgIiwiOwogICAgfQogICAgLy8gY29tcG9uZW50IHYtbW9kZWwKICAgIGlmIChlbC5tb2RlbCkgewogICAgICBkYXRhICs9ICJtb2RlbDp7dmFsdWU6IiArIChlbC5tb2RlbC52YWx1ZSkgKyAiLGNhbGxiYWNrOiIgKyAoZWwubW9kZWwuY2FsbGJhY2spICsgIixleHByZXNzaW9uOiIgKyAoZWwubW9kZWwuZXhwcmVzc2lvbikgKyAifSwiOwogICAgfQogICAgLy8gaW5saW5lLXRlbXBsYXRlCiAgICBpZiAoZWwuaW5saW5lVGVtcGxhdGUpIHsKICAgICAgdmFyIGlubGluZVRlbXBsYXRlID0gZ2VuSW5saW5lVGVtcGxhdGUoZWwsIHN0YXRlKTsKICAgICAgaWYgKGlubGluZVRlbXBsYXRlKSB7CiAgICAgICAgZGF0YSArPSBpbmxpbmVUZW1wbGF0ZSArICIsIjsKICAgICAgfQogICAgfQogICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvLCQvLCAnJykgKyAnfSc7CiAgICAvLyB2LWJpbmQgZHluYW1pYyBhcmd1bWVudCB3cmFwCiAgICAvLyB2LWJpbmQgd2l0aCBkeW5hbWljIGFyZ3VtZW50cyBtdXN0IGJlIGFwcGxpZWQgdXNpbmcgdGhlIHNhbWUgdi1iaW5kIG9iamVjdAogICAgLy8gbWVyZ2UgaGVscGVyIHNvIHRoYXQgY2xhc3Mvc3R5bGUvbXVzdFVzZVByb3AgYXR0cnMgYXJlIGhhbmRsZWQgY29ycmVjdGx5LgogICAgaWYgKGVsLmR5bmFtaWNBdHRycykgewogICAgICBkYXRhID0gIl9iKCIgKyBkYXRhICsgIixcIiIgKyAoZWwudGFnKSArICJcIiwiICsgKGdlblByb3BzKGVsLmR5bmFtaWNBdHRycykpICsgIikiOwogICAgfQogICAgLy8gdi1iaW5kIGRhdGEgd3JhcAogICAgaWYgKGVsLndyYXBEYXRhKSB7CiAgICAgIGRhdGEgPSBlbC53cmFwRGF0YShkYXRhKTsKICAgIH0KICAgIC8vIHYtb24gZGF0YSB3cmFwCiAgICBpZiAoZWwud3JhcExpc3RlbmVycykgewogICAgICBkYXRhID0gZWwud3JhcExpc3RlbmVycyhkYXRhKTsKICAgIH0KICAgIHJldHVybiBkYXRhCiAgfQoKICBmdW5jdGlvbiBnZW5EaXJlY3RpdmVzIChlbCwgc3RhdGUpIHsKICAgIHZhciBkaXJzID0gZWwuZGlyZWN0aXZlczsKICAgIGlmICghZGlycykgeyByZXR1cm4gfQogICAgdmFyIHJlcyA9ICdkaXJlY3RpdmVzOlsnOwogICAgdmFyIGhhc1J1bnRpbWUgPSBmYWxzZTsKICAgIHZhciBpLCBsLCBkaXIsIG5lZWRSdW50aW1lOwogICAgZm9yIChpID0gMCwgbCA9IGRpcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIGRpciA9IGRpcnNbaV07CiAgICAgIG5lZWRSdW50aW1lID0gdHJ1ZTsKICAgICAgdmFyIGdlbiA9IHN0YXRlLmRpcmVjdGl2ZXNbZGlyLm5hbWVdOwogICAgICBpZiAoZ2VuKSB7CiAgICAgICAgLy8gY29tcGlsZS10aW1lIGRpcmVjdGl2ZSB0aGF0IG1hbmlwdWxhdGVzIEFTVC4KICAgICAgICAvLyByZXR1cm5zIHRydWUgaWYgaXQgYWxzbyBuZWVkcyBhIHJ1bnRpbWUgY291bnRlcnBhcnQuCiAgICAgICAgbmVlZFJ1bnRpbWUgPSAhIWdlbihlbCwgZGlyLCBzdGF0ZS53YXJuKTsKICAgICAgfQogICAgICBpZiAobmVlZFJ1bnRpbWUpIHsKICAgICAgICBoYXNSdW50aW1lID0gdHJ1ZTsKICAgICAgICByZXMgKz0gIntuYW1lOlwiIiArIChkaXIubmFtZSkgKyAiXCIscmF3TmFtZTpcIiIgKyAoZGlyLnJhd05hbWUpICsgIlwiIiArIChkaXIudmFsdWUgPyAoIix2YWx1ZTooIiArIChkaXIudmFsdWUpICsgIiksZXhwcmVzc2lvbjoiICsgKEpTT04uc3RyaW5naWZ5KGRpci52YWx1ZSkpKSA6ICcnKSArIChkaXIuYXJnID8gKCIsYXJnOiIgKyAoZGlyLmlzRHluYW1pY0FyZyA/IGRpci5hcmcgOiAoIlwiIiArIChkaXIuYXJnKSArICJcIiIpKSkgOiAnJykgKyAoZGlyLm1vZGlmaWVycyA/ICgiLG1vZGlmaWVyczoiICsgKEpTT04uc3RyaW5naWZ5KGRpci5tb2RpZmllcnMpKSkgOiAnJykgKyAifSwiOwogICAgICB9CiAgICB9CiAgICBpZiAoaGFzUnVudGltZSkgewogICAgICByZXR1cm4gcmVzLnNsaWNlKDAsIC0xKSArICddJwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2VuSW5saW5lVGVtcGxhdGUgKGVsLCBzdGF0ZSkgewogICAgdmFyIGFzdCA9IGVsLmNoaWxkcmVuWzBdOwogICAgaWYgKGVsLmNoaWxkcmVuLmxlbmd0aCAhPT0gMSB8fCBhc3QudHlwZSAhPT0gMSkgewogICAgICBzdGF0ZS53YXJuKAogICAgICAgICdJbmxpbmUtdGVtcGxhdGUgY29tcG9uZW50cyBtdXN0IGhhdmUgZXhhY3RseSBvbmUgY2hpbGQgZWxlbWVudC4nLAogICAgICAgIHsgc3RhcnQ6IGVsLnN0YXJ0IH0KICAgICAgKTsKICAgIH0KICAgIGlmIChhc3QgJiYgYXN0LnR5cGUgPT09IDEpIHsKICAgICAgdmFyIGlubGluZVJlbmRlckZucyA9IGdlbmVyYXRlKGFzdCwgc3RhdGUub3B0aW9ucyk7CiAgICAgIHJldHVybiAoImlubGluZVRlbXBsYXRlOntyZW5kZXI6ZnVuY3Rpb24oKXsiICsgKGlubGluZVJlbmRlckZucy5yZW5kZXIpICsgIn0sc3RhdGljUmVuZGVyRm5zOlsiICsgKGlubGluZVJlbmRlckZucy5zdGF0aWNSZW5kZXJGbnMubWFwKGZ1bmN0aW9uIChjb2RlKSB7IHJldHVybiAoImZ1bmN0aW9uKCl7IiArIGNvZGUgKyAifSIpOyB9KS5qb2luKCcsJykpICsgIl19IikKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlblNjb3BlZFNsb3RzICgKICAgIGVsLAogICAgc2xvdHMsCiAgICBzdGF0ZQogICkgewogICAgLy8gYnkgZGVmYXVsdCBzY29wZWQgc2xvdHMgYXJlIGNvbnNpZGVyZWQgInN0YWJsZSIsIHRoaXMgYWxsb3dzIGNoaWxkCiAgICAvLyBjb21wb25lbnRzIHdpdGggb25seSBzY29wZWQgc2xvdHMgdG8gc2tpcCBmb3JjZWQgdXBkYXRlcyBmcm9tIHBhcmVudC4KICAgIC8vIGJ1dCBpbiBzb21lIGNhc2VzIHdlIGhhdmUgdG8gYmFpbC1vdXQgb2YgdGhpcyBvcHRpbWl6YXRpb24KICAgIC8vIGZvciBleGFtcGxlIGlmIHRoZSBzbG90IGNvbnRhaW5zIGR5bmFtaWMgbmFtZXMsIGhhcyB2LWlmIG9yIHYtZm9yIG9uIHRoZW0uLi4KICAgIHZhciBuZWVkc0ZvcmNlVXBkYXRlID0gZWwuZm9yIHx8IE9iamVjdC5rZXlzKHNsb3RzKS5zb21lKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgdmFyIHNsb3QgPSBzbG90c1trZXldOwogICAgICByZXR1cm4gKAogICAgICAgIHNsb3Quc2xvdFRhcmdldER5bmFtaWMgfHwKICAgICAgICBzbG90LmlmIHx8CiAgICAgICAgc2xvdC5mb3IgfHwKICAgICAgICBjb250YWluc1Nsb3RDaGlsZChzbG90KSAvLyBpcyBwYXNzaW5nIGRvd24gc2xvdCBmcm9tIHBhcmVudCB3aGljaCBtYXkgYmUgZHluYW1pYwogICAgICApCiAgICB9KTsKCiAgICAvLyAjOTUzNDogaWYgYSBjb21wb25lbnQgd2l0aCBzY29wZWQgc2xvdHMgaXMgaW5zaWRlIGEgY29uZGl0aW9uYWwgYnJhbmNoLAogICAgLy8gaXQncyBwb3NzaWJsZSBmb3IgdGhlIHNhbWUgY29tcG9uZW50IHRvIGJlIHJldXNlZCBidXQgd2l0aCBkaWZmZXJlbnQKICAgIC8vIGNvbXBpbGVkIHNsb3QgY29udGVudC4gVG8gYXZvaWQgdGhhdCwgd2UgZ2VuZXJhdGUgYSB1bmlxdWUga2V5IGJhc2VkIG9uCiAgICAvLyB0aGUgZ2VuZXJhdGVkIGNvZGUgb2YgYWxsIHRoZSBzbG90IGNvbnRlbnRzLgogICAgdmFyIG5lZWRzS2V5ID0gISFlbC5pZjsKCiAgICAvLyBPUiB3aGVuIGl0IGlzIGluc2lkZSBhbm90aGVyIHNjb3BlZCBzbG90IG9yIHYtZm9yICh0aGUgcmVhY3Rpdml0eSBtYXkgYmUKICAgIC8vIGRpc2Nvbm5lY3RlZCBkdWUgdG8gdGhlIGludGVybWVkaWF0ZSBzY29wZSB2YXJpYWJsZSkKICAgIC8vICM5NDM4LCAjOTUwNgogICAgLy8gVE9ETzogdGhpcyBjYW4gYmUgZnVydGhlciBvcHRpbWl6ZWQgYnkgcHJvcGVybHkgYW5hbHl6aW5nIGluLXNjb3BlIGJpbmRpbmdzCiAgICAvLyBhbmQgc2tpcCBmb3JjZSB1cGRhdGluZyBvbmVzIHRoYXQgZG8gbm90IGFjdHVhbGx5IHVzZSBzY29wZSB2YXJpYWJsZXMuCiAgICBpZiAoIW5lZWRzRm9yY2VVcGRhdGUpIHsKICAgICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudDsKICAgICAgd2hpbGUgKHBhcmVudCkgewogICAgICAgIGlmICgKICAgICAgICAgIChwYXJlbnQuc2xvdFNjb3BlICYmIHBhcmVudC5zbG90U2NvcGUgIT09IGVtcHR5U2xvdFNjb3BlVG9rZW4pIHx8CiAgICAgICAgICBwYXJlbnQuZm9yCiAgICAgICAgKSB7CiAgICAgICAgICBuZWVkc0ZvcmNlVXBkYXRlID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICAgIGlmIChwYXJlbnQuaWYpIHsKICAgICAgICAgIG5lZWRzS2V5ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDsKICAgICAgfQogICAgfQoKICAgIHZhciBnZW5lcmF0ZWRTbG90cyA9IE9iamVjdC5rZXlzKHNsb3RzKQogICAgICAubWFwKGZ1bmN0aW9uIChrZXkpIHsgcmV0dXJuIGdlblNjb3BlZFNsb3Qoc2xvdHNba2V5XSwgc3RhdGUpOyB9KQogICAgICAuam9pbignLCcpOwoKICAgIHJldHVybiAoInNjb3BlZFNsb3RzOl91KFsiICsgZ2VuZXJhdGVkU2xvdHMgKyAiXSIgKyAobmVlZHNGb3JjZVVwZGF0ZSA/ICIsbnVsbCx0cnVlIiA6ICIiKSArICghbmVlZHNGb3JjZVVwZGF0ZSAmJiBuZWVkc0tleSA/ICgiLG51bGwsZmFsc2UsIiArIChoYXNoKGdlbmVyYXRlZFNsb3RzKSkpIDogIiIpICsgIikiKQogIH0KCiAgZnVuY3Rpb24gaGFzaChzdHIpIHsKICAgIHZhciBoYXNoID0gNTM4MTsKICAgIHZhciBpID0gc3RyLmxlbmd0aDsKICAgIHdoaWxlKGkpIHsKICAgICAgaGFzaCA9IChoYXNoICogMzMpIF4gc3RyLmNoYXJDb2RlQXQoLS1pKTsKICAgIH0KICAgIHJldHVybiBoYXNoID4+PiAwCiAgfQoKICBmdW5jdGlvbiBjb250YWluc1Nsb3RDaGlsZCAoZWwpIHsKICAgIGlmIChlbC50eXBlID09PSAxKSB7CiAgICAgIGlmIChlbC50YWcgPT09ICdzbG90JykgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgICAgcmV0dXJuIGVsLmNoaWxkcmVuLnNvbWUoY29udGFpbnNTbG90Q2hpbGQpCiAgICB9CiAgICByZXR1cm4gZmFsc2UKICB9CgogIGZ1bmN0aW9uIGdlblNjb3BlZFNsb3QgKAogICAgZWwsCiAgICBzdGF0ZQogICkgewogICAgdmFyIGlzTGVnYWN5U3ludGF4ID0gZWwuYXR0cnNNYXBbJ3Nsb3Qtc2NvcGUnXTsKICAgIGlmIChlbC5pZiAmJiAhZWwuaWZQcm9jZXNzZWQgJiYgIWlzTGVnYWN5U3ludGF4KSB7CiAgICAgIHJldHVybiBnZW5JZihlbCwgc3RhdGUsIGdlblNjb3BlZFNsb3QsICJudWxsIikKICAgIH0KICAgIGlmIChlbC5mb3IgJiYgIWVsLmZvclByb2Nlc3NlZCkgewogICAgICByZXR1cm4gZ2VuRm9yKGVsLCBzdGF0ZSwgZ2VuU2NvcGVkU2xvdCkKICAgIH0KICAgIHZhciBzbG90U2NvcGUgPSBlbC5zbG90U2NvcGUgPT09IGVtcHR5U2xvdFNjb3BlVG9rZW4KICAgICAgPyAiIgogICAgICA6IFN0cmluZyhlbC5zbG90U2NvcGUpOwogICAgdmFyIGZuID0gImZ1bmN0aW9uKCIgKyBzbG90U2NvcGUgKyAiKXsiICsKICAgICAgInJldHVybiAiICsgKGVsLnRhZyA9PT0gJ3RlbXBsYXRlJwogICAgICAgID8gZWwuaWYgJiYgaXNMZWdhY3lTeW50YXgKICAgICAgICAgID8gKCIoIiArIChlbC5pZikgKyAiKT8iICsgKGdlbkNoaWxkcmVuKGVsLCBzdGF0ZSkgfHwgJ3VuZGVmaW5lZCcpICsgIjp1bmRlZmluZWQiKQogICAgICAgICAgOiBnZW5DaGlsZHJlbihlbCwgc3RhdGUpIHx8ICd1bmRlZmluZWQnCiAgICAgICAgOiBnZW5FbGVtZW50KGVsLCBzdGF0ZSkpICsgIn0iOwogICAgLy8gcmV2ZXJzZSBwcm94eSB2LXNsb3Qgd2l0aG91dCBzY29wZSBvbiB0aGlzLiRzbG90cwogICAgdmFyIHJldmVyc2VQcm94eSA9IHNsb3RTY29wZSA/ICIiIDogIixwcm94eTp0cnVlIjsKICAgIHJldHVybiAoIntrZXk6IiArIChlbC5zbG90VGFyZ2V0IHx8ICJcImRlZmF1bHRcIiIpICsgIixmbjoiICsgZm4gKyByZXZlcnNlUHJveHkgKyAifSIpCiAgfQoKICBmdW5jdGlvbiBnZW5DaGlsZHJlbiAoCiAgICBlbCwKICAgIHN0YXRlLAogICAgY2hlY2tTa2lwLAogICAgYWx0R2VuRWxlbWVudCwKICAgIGFsdEdlbk5vZGUKICApIHsKICAgIHZhciBjaGlsZHJlbiA9IGVsLmNoaWxkcmVuOwogICAgaWYgKGNoaWxkcmVuLmxlbmd0aCkgewogICAgICB2YXIgZWwkMSA9IGNoaWxkcmVuWzBdOwogICAgICAvLyBvcHRpbWl6ZSBzaW5nbGUgdi1mb3IKICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJgogICAgICAgIGVsJDEuZm9yICYmCiAgICAgICAgZWwkMS50YWcgIT09ICd0ZW1wbGF0ZScgJiYKICAgICAgICBlbCQxLnRhZyAhPT0gJ3Nsb3QnCiAgICAgICkgewogICAgICAgIHZhciBub3JtYWxpemF0aW9uVHlwZSA9IGNoZWNrU2tpcAogICAgICAgICAgPyBzdGF0ZS5tYXliZUNvbXBvbmVudChlbCQxKSA/ICIsMSIgOiAiLDAiCiAgICAgICAgICA6ICIiOwogICAgICAgIHJldHVybiAoIiIgKyAoKGFsdEdlbkVsZW1lbnQgfHwgZ2VuRWxlbWVudCkoZWwkMSwgc3RhdGUpKSArIG5vcm1hbGl6YXRpb25UeXBlKQogICAgICB9CiAgICAgIHZhciBub3JtYWxpemF0aW9uVHlwZSQxID0gY2hlY2tTa2lwCiAgICAgICAgPyBnZXROb3JtYWxpemF0aW9uVHlwZShjaGlsZHJlbiwgc3RhdGUubWF5YmVDb21wb25lbnQpCiAgICAgICAgOiAwOwogICAgICB2YXIgZ2VuID0gYWx0R2VuTm9kZSB8fCBnZW5Ob2RlOwogICAgICByZXR1cm4gKCJbIiArIChjaGlsZHJlbi5tYXAoZnVuY3Rpb24gKGMpIHsgcmV0dXJuIGdlbihjLCBzdGF0ZSk7IH0pLmpvaW4oJywnKSkgKyAiXSIgKyAobm9ybWFsaXphdGlvblR5cGUkMSA/ICgiLCIgKyBub3JtYWxpemF0aW9uVHlwZSQxKSA6ICcnKSkKICAgIH0KICB9CgogIC8vIGRldGVybWluZSB0aGUgbm9ybWFsaXphdGlvbiBuZWVkZWQgZm9yIHRoZSBjaGlsZHJlbiBhcnJheS4KICAvLyAwOiBubyBub3JtYWxpemF0aW9uIG5lZWRlZAogIC8vIDE6IHNpbXBsZSBub3JtYWxpemF0aW9uIG5lZWRlZCAocG9zc2libGUgMS1sZXZlbCBkZWVwIG5lc3RlZCBhcnJheSkKICAvLyAyOiBmdWxsIG5vcm1hbGl6YXRpb24gbmVlZGVkCiAgZnVuY3Rpb24gZ2V0Tm9ybWFsaXphdGlvblR5cGUgKAogICAgY2hpbGRyZW4sCiAgICBtYXliZUNvbXBvbmVudAogICkgewogICAgdmFyIHJlcyA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBlbCA9IGNoaWxkcmVuW2ldOwogICAgICBpZiAoZWwudHlwZSAhPT0gMSkgewogICAgICAgIGNvbnRpbnVlCiAgICAgIH0KICAgICAgaWYgKG5lZWRzTm9ybWFsaXphdGlvbihlbCkgfHwKICAgICAgICAgIChlbC5pZkNvbmRpdGlvbnMgJiYgZWwuaWZDb25kaXRpb25zLnNvbWUoZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5lZWRzTm9ybWFsaXphdGlvbihjLmJsb2NrKTsgfSkpKSB7CiAgICAgICAgcmVzID0gMjsKICAgICAgICBicmVhawogICAgICB9CiAgICAgIGlmIChtYXliZUNvbXBvbmVudChlbCkgfHwKICAgICAgICAgIChlbC5pZkNvbmRpdGlvbnMgJiYgZWwuaWZDb25kaXRpb25zLnNvbWUoZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG1heWJlQ29tcG9uZW50KGMuYmxvY2spOyB9KSkpIHsKICAgICAgICByZXMgPSAxOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICBmdW5jdGlvbiBuZWVkc05vcm1hbGl6YXRpb24gKGVsKSB7CiAgICByZXR1cm4gZWwuZm9yICE9PSB1bmRlZmluZWQgfHwgZWwudGFnID09PSAndGVtcGxhdGUnIHx8IGVsLnRhZyA9PT0gJ3Nsb3QnCiAgfQoKICBmdW5jdGlvbiBnZW5Ob2RlIChub2RlLCBzdGF0ZSkgewogICAgaWYgKG5vZGUudHlwZSA9PT0gMSkgewogICAgICByZXR1cm4gZ2VuRWxlbWVudChub2RlLCBzdGF0ZSkKICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAzICYmIG5vZGUuaXNDb21tZW50KSB7CiAgICAgIHJldHVybiBnZW5Db21tZW50KG5vZGUpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZ2VuVGV4dChub2RlKQogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2VuVGV4dCAodGV4dCkgewogICAgcmV0dXJuICgiX3YoIiArICh0ZXh0LnR5cGUgPT09IDIKICAgICAgPyB0ZXh0LmV4cHJlc3Npb24gLy8gbm8gbmVlZCBmb3IgKCkgYmVjYXVzZSBhbHJlYWR5IHdyYXBwZWQgaW4gX3MoKQogICAgICA6IHRyYW5zZm9ybVNwZWNpYWxOZXdsaW5lcyhKU09OLnN0cmluZ2lmeSh0ZXh0LnRleHQpKSkgKyAiKSIpCiAgfQoKICBmdW5jdGlvbiBnZW5Db21tZW50IChjb21tZW50KSB7CiAgICByZXR1cm4gKCJfZSgiICsgKEpTT04uc3RyaW5naWZ5KGNvbW1lbnQudGV4dCkpICsgIikiKQogIH0KCiAgZnVuY3Rpb24gZ2VuU2xvdCAoZWwsIHN0YXRlKSB7CiAgICB2YXIgc2xvdE5hbWUgPSBlbC5zbG90TmFtZSB8fCAnImRlZmF1bHQiJzsKICAgIHZhciBjaGlsZHJlbiA9IGdlbkNoaWxkcmVuKGVsLCBzdGF0ZSk7CiAgICB2YXIgcmVzID0gIl90KCIgKyBzbG90TmFtZSArIChjaGlsZHJlbiA/ICgiLCIgKyBjaGlsZHJlbikgOiAnJyk7CiAgICB2YXIgYXR0cnMgPSBlbC5hdHRycyB8fCBlbC5keW5hbWljQXR0cnMKICAgICAgPyBnZW5Qcm9wcygoZWwuYXR0cnMgfHwgW10pLmNvbmNhdChlbC5keW5hbWljQXR0cnMgfHwgW10pLm1hcChmdW5jdGlvbiAoYXR0cikgeyByZXR1cm4gKHsKICAgICAgICAgIC8vIHNsb3QgcHJvcHMgYXJlIGNhbWVsaXplZAogICAgICAgICAgbmFtZTogY2FtZWxpemUoYXR0ci5uYW1lKSwKICAgICAgICAgIHZhbHVlOiBhdHRyLnZhbHVlLAogICAgICAgICAgZHluYW1pYzogYXR0ci5keW5hbWljCiAgICAgICAgfSk7IH0pKQogICAgICA6IG51bGw7CiAgICB2YXIgYmluZCQkMSA9IGVsLmF0dHJzTWFwWyd2LWJpbmQnXTsKICAgIGlmICgoYXR0cnMgfHwgYmluZCQkMSkgJiYgIWNoaWxkcmVuKSB7CiAgICAgIHJlcyArPSAiLG51bGwiOwogICAgfQogICAgaWYgKGF0dHJzKSB7CiAgICAgIHJlcyArPSAiLCIgKyBhdHRyczsKICAgIH0KICAgIGlmIChiaW5kJCQxKSB7CiAgICAgIHJlcyArPSAoYXR0cnMgPyAnJyA6ICcsbnVsbCcpICsgIiwiICsgYmluZCQkMTsKICAgIH0KICAgIHJldHVybiByZXMgKyAnKScKICB9CgogIC8vIGNvbXBvbmVudE5hbWUgaXMgZWwuY29tcG9uZW50LCB0YWtlIGl0IGFzIGFyZ3VtZW50IHRvIHNodW4gZmxvdydzIHBlc3NpbWlzdGljIHJlZmluZW1lbnQKICBmdW5jdGlvbiBnZW5Db21wb25lbnQgKAogICAgY29tcG9uZW50TmFtZSwKICAgIGVsLAogICAgc3RhdGUKICApIHsKICAgIHZhciBjaGlsZHJlbiA9IGVsLmlubGluZVRlbXBsYXRlID8gbnVsbCA6IGdlbkNoaWxkcmVuKGVsLCBzdGF0ZSwgdHJ1ZSk7CiAgICByZXR1cm4gKCJfYygiICsgY29tcG9uZW50TmFtZSArICIsIiArIChnZW5EYXRhJDIoZWwsIHN0YXRlKSkgKyAoY2hpbGRyZW4gPyAoIiwiICsgY2hpbGRyZW4pIDogJycpICsgIikiKQogIH0KCiAgZnVuY3Rpb24gZ2VuUHJvcHMgKHByb3BzKSB7CiAgICB2YXIgc3RhdGljUHJvcHMgPSAiIjsKICAgIHZhciBkeW5hbWljUHJvcHMgPSAiIjsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHByb3AgPSBwcm9wc1tpXTsKICAgICAgdmFyIHZhbHVlID0gdHJhbnNmb3JtU3BlY2lhbE5ld2xpbmVzKHByb3AudmFsdWUpOwogICAgICBpZiAocHJvcC5keW5hbWljKSB7CiAgICAgICAgZHluYW1pY1Byb3BzICs9IChwcm9wLm5hbWUpICsgIiwiICsgdmFsdWUgKyAiLCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RhdGljUHJvcHMgKz0gIlwiIiArIChwcm9wLm5hbWUpICsgIlwiOiIgKyB2YWx1ZSArICIsIjsKICAgICAgfQogICAgfQogICAgc3RhdGljUHJvcHMgPSAieyIgKyAoc3RhdGljUHJvcHMuc2xpY2UoMCwgLTEpKSArICJ9IjsKICAgIGlmIChkeW5hbWljUHJvcHMpIHsKICAgICAgcmV0dXJuICgiX2QoIiArIHN0YXRpY1Byb3BzICsgIixbIiArIChkeW5hbWljUHJvcHMuc2xpY2UoMCwgLTEpKSArICJdKSIpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gc3RhdGljUHJvcHMKICAgIH0KICB9CgogIC8vICMzODk1LCAjNDI2OAogIGZ1bmN0aW9uIHRyYW5zZm9ybVNwZWNpYWxOZXdsaW5lcyAodGV4dCkgewogICAgcmV0dXJuIHRleHQKICAgICAgLnJlcGxhY2UoL1x1MjAyOC9nLCAnXFx1MjAyOCcpCiAgICAgIC5yZXBsYWNlKC9cdTIwMjkvZywgJ1xcdTIwMjknKQogIH0KCiAgLyogICovCgoKCiAgLy8gdGhlc2Uga2V5d29yZHMgc2hvdWxkIG5vdCBhcHBlYXIgaW5zaWRlIGV4cHJlc3Npb25zLCBidXQgb3BlcmF0b3JzIGxpa2UKICAvLyB0eXBlb2YsIGluc3RhbmNlb2YgYW5kIGluIGFyZSBhbGxvd2VkCiAgdmFyIHByb2hpYml0ZWRLZXl3b3JkUkUgPSBuZXcgUmVnRXhwKCdcXGInICsgKAogICAgJ2RvLGlmLGZvcixsZXQsbmV3LHRyeSx2YXIsY2FzZSxlbHNlLHdpdGgsYXdhaXQsYnJlYWssY2F0Y2gsY2xhc3MsY29uc3QsJyArCiAgICAnc3VwZXIsdGhyb3csd2hpbGUseWllbGQsZGVsZXRlLGV4cG9ydCxpbXBvcnQscmV0dXJuLHN3aXRjaCxkZWZhdWx0LCcgKwogICAgJ2V4dGVuZHMsZmluYWxseSxjb250aW51ZSxkZWJ1Z2dlcixmdW5jdGlvbixhcmd1bWVudHMnCiAgKS5zcGxpdCgnLCcpLmpvaW4oJ1xcYnxcXGInKSArICdcXGInKTsKCiAgLy8gdGhlc2UgdW5hcnkgb3BlcmF0b3JzIHNob3VsZCBub3QgYmUgdXNlZCBhcyBwcm9wZXJ0eS9tZXRob2QgbmFtZXMKICB2YXIgdW5hcnlPcGVyYXRvcnNSRSA9IG5ldyBSZWdFeHAoJ1xcYicgKyAoCiAgICAnZGVsZXRlLHR5cGVvZix2b2lkJwogICkuc3BsaXQoJywnKS5qb2luKCdcXHMqXFwoW15cXCldKlxcKXxcXGInKSArICdcXHMqXFwoW15cXCldKlxcKScpOwoKICAvLyBzdHJpcCBzdHJpbmdzIGluIGV4cHJlc3Npb25zCiAgdmFyIHN0cmlwU3RyaW5nUkUgPSAvJyg/OlteJ1xcXXxcXC4pKid8Iig/OlteIlxcXXxcXC4pKiJ8YCg/OlteYFxcXXxcXC4pKlwkXHt8XH0oPzpbXmBcXF18XFwuKSpgfGAoPzpbXmBcXF18XFwuKSpgL2c7CgogIC8vIGRldGVjdCBwcm9ibGVtYXRpYyBleHByZXNzaW9ucyBpbiBhIHRlbXBsYXRlCiAgZnVuY3Rpb24gZGV0ZWN0RXJyb3JzIChhc3QsIHdhcm4pIHsKICAgIGlmIChhc3QpIHsKICAgICAgY2hlY2tOb2RlKGFzdCwgd2Fybik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjaGVja05vZGUgKG5vZGUsIHdhcm4pIHsKICAgIGlmIChub2RlLnR5cGUgPT09IDEpIHsKICAgICAgZm9yICh2YXIgbmFtZSBpbiBub2RlLmF0dHJzTWFwKSB7CiAgICAgICAgaWYgKGRpclJFLnRlc3QobmFtZSkpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IG5vZGUuYXR0cnNNYXBbbmFtZV07CiAgICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgICAgdmFyIHJhbmdlID0gbm9kZS5yYXdBdHRyc01hcFtuYW1lXTsKICAgICAgICAgICAgaWYgKG5hbWUgPT09ICd2LWZvcicpIHsKICAgICAgICAgICAgICBjaGVja0Zvcihub2RlLCAoInYtZm9yPVwiIiArIHZhbHVlICsgIlwiIiksIHdhcm4sIHJhbmdlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAndi1zbG90JyB8fCBuYW1lWzBdID09PSAnIycpIHsKICAgICAgICAgICAgICBjaGVja0Z1bmN0aW9uUGFyYW1ldGVyRXhwcmVzc2lvbih2YWx1ZSwgKG5hbWUgKyAiPVwiIiArIHZhbHVlICsgIlwiIiksIHdhcm4sIHJhbmdlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvblJFLnRlc3QobmFtZSkpIHsKICAgICAgICAgICAgICBjaGVja0V2ZW50KHZhbHVlLCAobmFtZSArICI9XCIiICsgdmFsdWUgKyAiXCIiKSwgd2FybiwgcmFuZ2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNoZWNrRXhwcmVzc2lvbih2YWx1ZSwgKG5hbWUgKyAiPVwiIiArIHZhbHVlICsgIlwiIiksIHdhcm4sIHJhbmdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobm9kZS5jaGlsZHJlbikgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgY2hlY2tOb2RlKG5vZGUuY2hpbGRyZW5baV0sIHdhcm4pOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmIChub2RlLnR5cGUgPT09IDIpIHsKICAgICAgY2hlY2tFeHByZXNzaW9uKG5vZGUuZXhwcmVzc2lvbiwgbm9kZS50ZXh0LCB3YXJuLCBub2RlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNoZWNrRXZlbnQgKGV4cCwgdGV4dCwgd2FybiwgcmFuZ2UpIHsKICAgIHZhciBzdHJpcHBlZCA9IGV4cC5yZXBsYWNlKHN0cmlwU3RyaW5nUkUsICcnKTsKICAgIHZhciBrZXl3b3JkTWF0Y2ggPSBzdHJpcHBlZC5tYXRjaCh1bmFyeU9wZXJhdG9yc1JFKTsKICAgIGlmIChrZXl3b3JkTWF0Y2ggJiYgc3RyaXBwZWQuY2hhckF0KGtleXdvcmRNYXRjaC5pbmRleCAtIDEpICE9PSAnJCcpIHsKICAgICAgd2FybigKICAgICAgICAiYXZvaWQgdXNpbmcgSmF2YVNjcmlwdCB1bmFyeSBvcGVyYXRvciBhcyBwcm9wZXJ0eSBuYW1lOiAiICsKICAgICAgICAiXCIiICsgKGtleXdvcmRNYXRjaFswXSkgKyAiXCIgaW4gZXhwcmVzc2lvbiAiICsgKHRleHQudHJpbSgpKSwKICAgICAgICByYW5nZQogICAgICApOwogICAgfQogICAgY2hlY2tFeHByZXNzaW9uKGV4cCwgdGV4dCwgd2FybiwgcmFuZ2UpOwogIH0KCiAgZnVuY3Rpb24gY2hlY2tGb3IgKG5vZGUsIHRleHQsIHdhcm4sIHJhbmdlKSB7CiAgICBjaGVja0V4cHJlc3Npb24obm9kZS5mb3IgfHwgJycsIHRleHQsIHdhcm4sIHJhbmdlKTsKICAgIGNoZWNrSWRlbnRpZmllcihub2RlLmFsaWFzLCAndi1mb3IgYWxpYXMnLCB0ZXh0LCB3YXJuLCByYW5nZSk7CiAgICBjaGVja0lkZW50aWZpZXIobm9kZS5pdGVyYXRvcjEsICd2LWZvciBpdGVyYXRvcicsIHRleHQsIHdhcm4sIHJhbmdlKTsKICAgIGNoZWNrSWRlbnRpZmllcihub2RlLml0ZXJhdG9yMiwgJ3YtZm9yIGl0ZXJhdG9yJywgdGV4dCwgd2FybiwgcmFuZ2UpOwogIH0KCiAgZnVuY3Rpb24gY2hlY2tJZGVudGlmaWVyICgKICAgIGlkZW50LAogICAgdHlwZSwKICAgIHRleHQsCiAgICB3YXJuLAogICAgcmFuZ2UKICApIHsKICAgIGlmICh0eXBlb2YgaWRlbnQgPT09ICdzdHJpbmcnKSB7CiAgICAgIHRyeSB7CiAgICAgICAgbmV3IEZ1bmN0aW9uKCgidmFyICIgKyBpZGVudCArICI9XyIpKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHdhcm4oKCJpbnZhbGlkICIgKyB0eXBlICsgIiBcIiIgKyBpZGVudCArICJcIiBpbiBleHByZXNzaW9uOiAiICsgKHRleHQudHJpbSgpKSksIHJhbmdlKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hlY2tFeHByZXNzaW9uIChleHAsIHRleHQsIHdhcm4sIHJhbmdlKSB7CiAgICB0cnkgewogICAgICBuZXcgRnVuY3Rpb24oKCJyZXR1cm4gIiArIGV4cCkpOwogICAgfSBjYXRjaCAoZSkgewogICAgICB2YXIga2V5d29yZE1hdGNoID0gZXhwLnJlcGxhY2Uoc3RyaXBTdHJpbmdSRSwgJycpLm1hdGNoKHByb2hpYml0ZWRLZXl3b3JkUkUpOwogICAgICBpZiAoa2V5d29yZE1hdGNoKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICJhdm9pZCB1c2luZyBKYXZhU2NyaXB0IGtleXdvcmQgYXMgcHJvcGVydHkgbmFtZTogIiArCiAgICAgICAgICAiXCIiICsgKGtleXdvcmRNYXRjaFswXSkgKyAiXCJcbiAgUmF3IGV4cHJlc3Npb246ICIgKyAodGV4dC50cmltKCkpLAogICAgICAgICAgcmFuZ2UKICAgICAgICApOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4oCiAgICAgICAgICAiaW52YWxpZCBleHByZXNzaW9uOiAiICsgKGUubWVzc2FnZSkgKyAiIGluXG5cbiIgKwogICAgICAgICAgIiAgICAiICsgZXhwICsgIlxuXG4iICsKICAgICAgICAgICIgIFJhdyBleHByZXNzaW9uOiAiICsgKHRleHQudHJpbSgpKSArICJcbiIsCiAgICAgICAgICByYW5nZQogICAgICAgICk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGNoZWNrRnVuY3Rpb25QYXJhbWV0ZXJFeHByZXNzaW9uIChleHAsIHRleHQsIHdhcm4sIHJhbmdlKSB7CiAgICB0cnkgewogICAgICBuZXcgRnVuY3Rpb24oZXhwLCAnJyk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHdhcm4oCiAgICAgICAgImludmFsaWQgZnVuY3Rpb24gcGFyYW1ldGVyIGV4cHJlc3Npb246ICIgKyAoZS5tZXNzYWdlKSArICIgaW5cblxuIiArCiAgICAgICAgIiAgICAiICsgZXhwICsgIlxuXG4iICsKICAgICAgICAiICBSYXcgZXhwcmVzc2lvbjogIiArICh0ZXh0LnRyaW0oKSkgKyAiXG4iLAogICAgICAgIHJhbmdlCiAgICAgICk7CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIHJhbmdlID0gMjsKCiAgZnVuY3Rpb24gZ2VuZXJhdGVDb2RlRnJhbWUgKAogICAgc291cmNlLAogICAgc3RhcnQsCiAgICBlbmQKICApIHsKICAgIGlmICggc3RhcnQgPT09IHZvaWQgMCApIHN0YXJ0ID0gMDsKICAgIGlmICggZW5kID09PSB2b2lkIDAgKSBlbmQgPSBzb3VyY2UubGVuZ3RoOwoKICAgIHZhciBsaW5lcyA9IHNvdXJjZS5zcGxpdCgvXHI/XG4vKTsKICAgIHZhciBjb3VudCA9IDA7CiAgICB2YXIgcmVzID0gW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvdW50ICs9IGxpbmVzW2ldLmxlbmd0aCArIDE7CiAgICAgIGlmIChjb3VudCA+PSBzdGFydCkgewogICAgICAgIGZvciAodmFyIGogPSBpIC0gcmFuZ2U7IGogPD0gaSArIHJhbmdlIHx8IGVuZCA+IGNvdW50OyBqKyspIHsKICAgICAgICAgIGlmIChqIDwgMCB8fCBqID49IGxpbmVzLmxlbmd0aCkgeyBjb250aW51ZSB9CiAgICAgICAgICByZXMucHVzaCgoIiIgKyAoaiArIDEpICsgKHJlcGVhdCQxKCIgIiwgMyAtIFN0cmluZyhqICsgMSkubGVuZ3RoKSkgKyAifCAgIiArIChsaW5lc1tqXSkpKTsKICAgICAgICAgIHZhciBsaW5lTGVuZ3RoID0gbGluZXNbal0ubGVuZ3RoOwogICAgICAgICAgaWYgKGogPT09IGkpIHsKICAgICAgICAgICAgLy8gcHVzaCB1bmRlcmxpbmUKICAgICAgICAgICAgdmFyIHBhZCA9IHN0YXJ0IC0gKGNvdW50IC0gbGluZUxlbmd0aCkgKyAxOwogICAgICAgICAgICB2YXIgbGVuZ3RoID0gZW5kID4gY291bnQgPyBsaW5lTGVuZ3RoIC0gcGFkIDogZW5kIC0gc3RhcnQ7CiAgICAgICAgICAgIHJlcy5wdXNoKCIgICB8ICAiICsgcmVwZWF0JDEoIiAiLCBwYWQpICsgcmVwZWF0JDEoIl4iLCBsZW5ndGgpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaiA+IGkpIHsKICAgICAgICAgICAgaWYgKGVuZCA+IGNvdW50KSB7CiAgICAgICAgICAgICAgdmFyIGxlbmd0aCQxID0gTWF0aC5taW4oZW5kIC0gY291bnQsIGxpbmVMZW5ndGgpOwogICAgICAgICAgICAgIHJlcy5wdXNoKCIgICB8ICAiICsgcmVwZWF0JDEoIl4iLCBsZW5ndGgkMSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvdW50ICs9IGxpbmVMZW5ndGggKyAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhawogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzLmpvaW4oJ1xuJykKICB9CgogIGZ1bmN0aW9uIHJlcGVhdCQxIChzdHIsIG4pIHsKICAgIHZhciByZXN1bHQgPSAnJzsKICAgIGlmIChuID4gMCkgewogICAgICB3aGlsZSAodHJ1ZSkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCiAgICAgICAgaWYgKG4gJiAxKSB7IHJlc3VsdCArPSBzdHI7IH0KICAgICAgICBuID4+Pj0gMTsKICAgICAgICBpZiAobiA8PSAwKSB7IGJyZWFrIH0KICAgICAgICBzdHIgKz0gc3RyOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0CiAgfQoKICAvKiAgKi8KCgoKICBmdW5jdGlvbiBjcmVhdGVGdW5jdGlvbiAoY29kZSwgZXJyb3JzKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKGNvZGUpCiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgZXJyb3JzLnB1c2goeyBlcnI6IGVyciwgY29kZTogY29kZSB9KTsKICAgICAgcmV0dXJuIG5vb3AKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbXBpbGVUb0Z1bmN0aW9uRm4gKGNvbXBpbGUpIHsKICAgIHZhciBjYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbXBpbGVUb0Z1bmN0aW9ucyAoCiAgICAgIHRlbXBsYXRlLAogICAgICBvcHRpb25zLAogICAgICB2bQogICAgKSB7CiAgICAgIG9wdGlvbnMgPSBleHRlbmQoe30sIG9wdGlvbnMpOwogICAgICB2YXIgd2FybiQkMSA9IG9wdGlvbnMud2FybiB8fCB3YXJuOwogICAgICBkZWxldGUgb3B0aW9ucy53YXJuOwoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIHsKICAgICAgICAvLyBkZXRlY3QgcG9zc2libGUgQ1NQIHJlc3RyaWN0aW9uCiAgICAgICAgdHJ5IHsKICAgICAgICAgIG5ldyBGdW5jdGlvbigncmV0dXJuIDEnKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBpZiAoZS50b1N0cmluZygpLm1hdGNoKC91bnNhZmUtZXZhbHxDU1AvKSkgewogICAgICAgICAgICB3YXJuJCQxKAogICAgICAgICAgICAgICdJdCBzZWVtcyB5b3UgYXJlIHVzaW5nIHRoZSBzdGFuZGFsb25lIGJ1aWxkIG9mIFZ1ZS5qcyBpbiBhbiAnICsKICAgICAgICAgICAgICAnZW52aXJvbm1lbnQgd2l0aCBDb250ZW50IFNlY3VyaXR5IFBvbGljeSB0aGF0IHByb2hpYml0cyB1bnNhZmUtZXZhbC4gJyArCiAgICAgICAgICAgICAgJ1RoZSB0ZW1wbGF0ZSBjb21waWxlciBjYW5ub3Qgd29yayBpbiB0aGlzIGVudmlyb25tZW50LiBDb25zaWRlciAnICsKICAgICAgICAgICAgICAncmVsYXhpbmcgdGhlIHBvbGljeSB0byBhbGxvdyB1bnNhZmUtZXZhbCBvciBwcmUtY29tcGlsaW5nIHlvdXIgJyArCiAgICAgICAgICAgICAgJ3RlbXBsYXRlcyBpbnRvIHJlbmRlciBmdW5jdGlvbnMuJwogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAgdmFyIGtleSA9IG9wdGlvbnMuZGVsaW1pdGVycwogICAgICAgID8gU3RyaW5nKG9wdGlvbnMuZGVsaW1pdGVycykgKyB0ZW1wbGF0ZQogICAgICAgIDogdGVtcGxhdGU7CiAgICAgIGlmIChjYWNoZVtrZXldKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlW2tleV0KICAgICAgfQoKICAgICAgLy8gY29tcGlsZQogICAgICB2YXIgY29tcGlsZWQgPSBjb21waWxlKHRlbXBsYXRlLCBvcHRpb25zKTsKCiAgICAgIC8vIGNoZWNrIGNvbXBpbGF0aW9uIGVycm9ycy90aXBzCiAgICAgIHsKICAgICAgICBpZiAoY29tcGlsZWQuZXJyb3JzICYmIGNvbXBpbGVkLmVycm9ycy5sZW5ndGgpIHsKICAgICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICAgIGNvbXBpbGVkLmVycm9ycy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgd2FybiQkMSgKICAgICAgICAgICAgICAgICJFcnJvciBjb21waWxpbmcgdGVtcGxhdGU6XG5cbiIgKyAoZS5tc2cpICsgIlxuXG4iICsKICAgICAgICAgICAgICAgIGdlbmVyYXRlQ29kZUZyYW1lKHRlbXBsYXRlLCBlLnN0YXJ0LCBlLmVuZCksCiAgICAgICAgICAgICAgICB2bQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2FybiQkMSgKICAgICAgICAgICAgICAiRXJyb3IgY29tcGlsaW5nIHRlbXBsYXRlOlxuXG4iICsgdGVtcGxhdGUgKyAiXG5cbiIgKwogICAgICAgICAgICAgIGNvbXBpbGVkLmVycm9ycy5tYXAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuICgiLSAiICsgZSk7IH0pLmpvaW4oJ1xuJykgKyAnXG4nLAogICAgICAgICAgICAgIHZtCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjb21waWxlZC50aXBzICYmIGNvbXBpbGVkLnRpcHMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICBjb21waWxlZC50aXBzLmZvckVhY2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRpcChlLm1zZywgdm0pOyB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbXBpbGVkLnRpcHMuZm9yRWFjaChmdW5jdGlvbiAobXNnKSB7IHJldHVybiB0aXAobXNnLCB2bSk7IH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gdHVybiBjb2RlIGludG8gZnVuY3Rpb25zCiAgICAgIHZhciByZXMgPSB7fTsKICAgICAgdmFyIGZuR2VuRXJyb3JzID0gW107CiAgICAgIHJlcy5yZW5kZXIgPSBjcmVhdGVGdW5jdGlvbihjb21waWxlZC5yZW5kZXIsIGZuR2VuRXJyb3JzKTsKICAgICAgcmVzLnN0YXRpY1JlbmRlckZucyA9IGNvbXBpbGVkLnN0YXRpY1JlbmRlckZucy5tYXAoZnVuY3Rpb24gKGNvZGUpIHsKICAgICAgICByZXR1cm4gY3JlYXRlRnVuY3Rpb24oY29kZSwgZm5HZW5FcnJvcnMpCiAgICAgIH0pOwoKICAgICAgLy8gY2hlY2sgZnVuY3Rpb24gZ2VuZXJhdGlvbiBlcnJvcnMuCiAgICAgIC8vIHRoaXMgc2hvdWxkIG9ubHkgaGFwcGVuIGlmIHRoZXJlIGlzIGEgYnVnIGluIHRoZSBjb21waWxlciBpdHNlbGYuCiAgICAgIC8vIG1vc3RseSBmb3IgY29kZWdlbiBkZXZlbG9wbWVudCB1c2UKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIHsKICAgICAgICBpZiAoKCFjb21waWxlZC5lcnJvcnMgfHwgIWNvbXBpbGVkLmVycm9ycy5sZW5ndGgpICYmIGZuR2VuRXJyb3JzLmxlbmd0aCkgewogICAgICAgICAgd2FybiQkMSgKICAgICAgICAgICAgIkZhaWxlZCB0byBnZW5lcmF0ZSByZW5kZXIgZnVuY3Rpb246XG5cbiIgKwogICAgICAgICAgICBmbkdlbkVycm9ycy5tYXAoZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICAgIHZhciBlcnIgPSByZWYuZXJyOwogICAgICAgICAgICAgIHZhciBjb2RlID0gcmVmLmNvZGU7CgogICAgICAgICAgICAgIHJldHVybiAoKGVyci50b1N0cmluZygpKSArICIgaW5cblxuIiArIGNvZGUgKyAiXG4iKTsKICAgICAgICAgIH0pLmpvaW4oJ1xuJyksCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIChjYWNoZVtrZXldID0gcmVzKQogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGNyZWF0ZUNvbXBpbGVyQ3JlYXRvciAoYmFzZUNvbXBpbGUpIHsKICAgIHJldHVybiBmdW5jdGlvbiBjcmVhdGVDb21waWxlciAoYmFzZU9wdGlvbnMpIHsKICAgICAgZnVuY3Rpb24gY29tcGlsZSAoCiAgICAgICAgdGVtcGxhdGUsCiAgICAgICAgb3B0aW9ucwogICAgICApIHsKICAgICAgICB2YXIgZmluYWxPcHRpb25zID0gT2JqZWN0LmNyZWF0ZShiYXNlT3B0aW9ucyk7CiAgICAgICAgdmFyIGVycm9ycyA9IFtdOwogICAgICAgIHZhciB0aXBzID0gW107CgogICAgICAgIHZhciB3YXJuID0gZnVuY3Rpb24gKG1zZywgcmFuZ2UsIHRpcCkgewogICAgICAgICAgKHRpcCA/IHRpcHMgOiBlcnJvcnMpLnB1c2gobXNnKTsKICAgICAgICB9OwoKICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgaWYgKG9wdGlvbnMub3V0cHV0U291cmNlUmFuZ2UpIHsKICAgICAgICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgICAgICAgIHZhciBsZWFkaW5nU3BhY2VMZW5ndGggPSB0ZW1wbGF0ZS5tYXRjaCgvXlxzKi8pWzBdLmxlbmd0aDsKCiAgICAgICAgICAgIHdhcm4gPSBmdW5jdGlvbiAobXNnLCByYW5nZSwgdGlwKSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7IG1zZzogbXNnIH07CiAgICAgICAgICAgICAgaWYgKHJhbmdlKSB7CiAgICAgICAgICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ID0gcmFuZ2Uuc3RhcnQgKyBsZWFkaW5nU3BhY2VMZW5ndGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmFuZ2UuZW5kICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZGF0YS5lbmQgPSByYW5nZS5lbmQgKyBsZWFkaW5nU3BhY2VMZW5ndGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICh0aXAgPyB0aXBzIDogZXJyb3JzKS5wdXNoKGRhdGEpOwogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgLy8gbWVyZ2UgY3VzdG9tIG1vZHVsZXMKICAgICAgICAgIGlmIChvcHRpb25zLm1vZHVsZXMpIHsKICAgICAgICAgICAgZmluYWxPcHRpb25zLm1vZHVsZXMgPQogICAgICAgICAgICAgIChiYXNlT3B0aW9ucy5tb2R1bGVzIHx8IFtdKS5jb25jYXQob3B0aW9ucy5tb2R1bGVzKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIG1lcmdlIGN1c3RvbSBkaXJlY3RpdmVzCiAgICAgICAgICBpZiAob3B0aW9ucy5kaXJlY3RpdmVzKSB7CiAgICAgICAgICAgIGZpbmFsT3B0aW9ucy5kaXJlY3RpdmVzID0gZXh0ZW5kKAogICAgICAgICAgICAgIE9iamVjdC5jcmVhdGUoYmFzZU9wdGlvbnMuZGlyZWN0aXZlcyB8fCBudWxsKSwKICAgICAgICAgICAgICBvcHRpb25zLmRpcmVjdGl2ZXMKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvcHkgb3RoZXIgb3B0aW9ucwogICAgICAgICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKGtleSAhPT0gJ21vZHVsZXMnICYmIGtleSAhPT0gJ2RpcmVjdGl2ZXMnKSB7CiAgICAgICAgICAgICAgZmluYWxPcHRpb25zW2tleV0gPSBvcHRpb25zW2tleV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpbmFsT3B0aW9ucy53YXJuID0gd2FybjsKCiAgICAgICAgdmFyIGNvbXBpbGVkID0gYmFzZUNvbXBpbGUodGVtcGxhdGUudHJpbSgpLCBmaW5hbE9wdGlvbnMpOwogICAgICAgIHsKICAgICAgICAgIGRldGVjdEVycm9ycyhjb21waWxlZC5hc3QsIHdhcm4pOwogICAgICAgIH0KICAgICAgICBjb21waWxlZC5lcnJvcnMgPSBlcnJvcnM7CiAgICAgICAgY29tcGlsZWQudGlwcyA9IHRpcHM7CiAgICAgICAgcmV0dXJuIGNvbXBpbGVkCiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgY29tcGlsZTogY29tcGlsZSwKICAgICAgICBjb21waWxlVG9GdW5jdGlvbnM6IGNyZWF0ZUNvbXBpbGVUb0Z1bmN0aW9uRm4oY29tcGlsZSkKICAgICAgfQogICAgfQogIH0KCiAgLyogICovCgogIC8vIGBjcmVhdGVDb21waWxlckNyZWF0b3JgIGFsbG93cyBjcmVhdGluZyBjb21waWxlcnMgdGhhdCB1c2UgYWx0ZXJuYXRpdmUKICAvLyBwYXJzZXIvb3B0aW1pemVyL2NvZGVnZW4sIGUuZyB0aGUgU1NSIG9wdGltaXppbmcgY29tcGlsZXIuCiAgLy8gSGVyZSB3ZSBqdXN0IGV4cG9ydCBhIGRlZmF1bHQgY29tcGlsZXIgdXNpbmcgdGhlIGRlZmF1bHQgcGFydHMuCiAgdmFyIGNyZWF0ZUNvbXBpbGVyID0gY3JlYXRlQ29tcGlsZXJDcmVhdG9yKGZ1bmN0aW9uIGJhc2VDb21waWxlICgKICAgIHRlbXBsYXRlLAogICAgb3B0aW9ucwogICkgewogICAgdmFyIGFzdCA9IHBhcnNlKHRlbXBsYXRlLnRyaW0oKSwgb3B0aW9ucyk7CiAgICBpZiAob3B0aW9ucy5vcHRpbWl6ZSAhPT0gZmFsc2UpIHsKICAgICAgb3B0aW1pemUoYXN0LCBvcHRpb25zKTsKICAgIH0KICAgIHZhciBjb2RlID0gZ2VuZXJhdGUoYXN0LCBvcHRpb25zKTsKICAgIHJldHVybiB7CiAgICAgIGFzdDogYXN0LAogICAgICByZW5kZXI6IGNvZGUucmVuZGVyLAogICAgICBzdGF0aWNSZW5kZXJGbnM6IGNvZGUuc3RhdGljUmVuZGVyRm5zCiAgICB9CiAgfSk7CgogIC8qICAqLwoKICB2YXIgcmVmJDEgPSBjcmVhdGVDb21waWxlcihiYXNlT3B0aW9ucyk7CiAgdmFyIGNvbXBpbGUgPSByZWYkMS5jb21waWxlOwogIHZhciBjb21waWxlVG9GdW5jdGlvbnMgPSByZWYkMS5jb21waWxlVG9GdW5jdGlvbnM7CgogIC8qICAqLwoKICAvLyBjaGVjayB3aGV0aGVyIGN1cnJlbnQgYnJvd3NlciBlbmNvZGVzIGEgY2hhciBpbnNpZGUgYXR0cmlidXRlIHZhbHVlcwogIHZhciBkaXY7CiAgZnVuY3Rpb24gZ2V0U2hvdWxkRGVjb2RlIChocmVmKSB7CiAgICBkaXYgPSBkaXYgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBkaXYuaW5uZXJIVE1MID0gaHJlZiA/ICI8YSBocmVmPVwiXG5cIi8+IiA6ICI8ZGl2IGE9XCJcblwiLz4iOwogICAgcmV0dXJuIGRpdi5pbm5lckhUTUwuaW5kZXhPZignJiMxMDsnKSA+IDAKICB9CgogIC8vICMzNjYzOiBJRSBlbmNvZGVzIG5ld2xpbmVzIGluc2lkZSBhdHRyaWJ1dGUgdmFsdWVzIHdoaWxlIG90aGVyIGJyb3dzZXJzIGRvbid0CiAgdmFyIHNob3VsZERlY29kZU5ld2xpbmVzID0gaW5Ccm93c2VyID8gZ2V0U2hvdWxkRGVjb2RlKGZhbHNlKSA6IGZhbHNlOwogIC8vICM2ODI4OiBjaHJvbWUgZW5jb2RlcyBjb250ZW50IGluIGFbaHJlZl0KICB2YXIgc2hvdWxkRGVjb2RlTmV3bGluZXNGb3JIcmVmID0gaW5Ccm93c2VyID8gZ2V0U2hvdWxkRGVjb2RlKHRydWUpIDogZmFsc2U7CgogIC8qICAqLwoKICB2YXIgaWRUb1RlbXBsYXRlID0gY2FjaGVkKGZ1bmN0aW9uIChpZCkgewogICAgdmFyIGVsID0gcXVlcnkoaWQpOwogICAgcmV0dXJuIGVsICYmIGVsLmlubmVySFRNTAogIH0pOwoKICB2YXIgbW91bnQgPSBWdWUucHJvdG90eXBlLiRtb3VudDsKICBWdWUucHJvdG90eXBlLiRtb3VudCA9IGZ1bmN0aW9uICgKICAgIGVsLAogICAgaHlkcmF0aW5nCiAgKSB7CiAgICBlbCA9IGVsICYmIHF1ZXJ5KGVsKTsKCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmIChlbCA9PT0gZG9jdW1lbnQuYm9keSB8fCBlbCA9PT0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkRvIG5vdCBtb3VudCBWdWUgdG8gPGh0bWw+IG9yIDxib2R5PiAtIG1vdW50IHRvIG5vcm1hbCBlbGVtZW50cyBpbnN0ZWFkLiIKICAgICAgKTsKICAgICAgcmV0dXJuIHRoaXMKICAgIH0KCiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuJG9wdGlvbnM7CiAgICAvLyByZXNvbHZlIHRlbXBsYXRlL2VsIGFuZCBjb252ZXJ0IHRvIHJlbmRlciBmdW5jdGlvbgogICAgaWYgKCFvcHRpb25zLnJlbmRlcikgewogICAgICB2YXIgdGVtcGxhdGUgPSBvcHRpb25zLnRlbXBsYXRlOwogICAgICBpZiAodGVtcGxhdGUpIHsKICAgICAgICBpZiAodHlwZW9mIHRlbXBsYXRlID09PSAnc3RyaW5nJykgewogICAgICAgICAgaWYgKHRlbXBsYXRlLmNoYXJBdCgwKSA9PT0gJyMnKSB7CiAgICAgICAgICAgIHRlbXBsYXRlID0gaWRUb1RlbXBsYXRlKHRlbXBsYXRlKTsKICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgICAgIGlmICghdGVtcGxhdGUpIHsKICAgICAgICAgICAgICB3YXJuKAogICAgICAgICAgICAgICAgKCJUZW1wbGF0ZSBlbGVtZW50IG5vdCBmb3VuZCBvciBpcyBlbXB0eTogIiArIChvcHRpb25zLnRlbXBsYXRlKSksCiAgICAgICAgICAgICAgICB0aGlzCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUubm9kZVR5cGUpIHsKICAgICAgICAgIHRlbXBsYXRlID0gdGVtcGxhdGUuaW5uZXJIVE1MOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB7CiAgICAgICAgICAgIHdhcm4oJ2ludmFsaWQgdGVtcGxhdGUgb3B0aW9uOicgKyB0ZW1wbGF0ZSwgdGhpcyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChlbCkgewogICAgICAgIHRlbXBsYXRlID0gZ2V0T3V0ZXJIVE1MKGVsKTsKICAgICAgfQogICAgICBpZiAodGVtcGxhdGUpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoY29uZmlnLnBlcmZvcm1hbmNlICYmIG1hcmspIHsKICAgICAgICAgIG1hcmsoJ2NvbXBpbGUnKTsKICAgICAgICB9CgogICAgICAgIHZhciByZWYgPSBjb21waWxlVG9GdW5jdGlvbnModGVtcGxhdGUsIHsKICAgICAgICAgIG91dHB1dFNvdXJjZVJhbmdlOiAiZGV2ZWxvcG1lbnQiICE9PSAncHJvZHVjdGlvbicsCiAgICAgICAgICBzaG91bGREZWNvZGVOZXdsaW5lczogc2hvdWxkRGVjb2RlTmV3bGluZXMsCiAgICAgICAgICBzaG91bGREZWNvZGVOZXdsaW5lc0ZvckhyZWY6IHNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZiwKICAgICAgICAgIGRlbGltaXRlcnM6IG9wdGlvbnMuZGVsaW1pdGVycywKICAgICAgICAgIGNvbW1lbnRzOiBvcHRpb25zLmNvbW1lbnRzCiAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgdmFyIHJlbmRlciA9IHJlZi5yZW5kZXI7CiAgICAgICAgdmFyIHN0YXRpY1JlbmRlckZucyA9IHJlZi5zdGF0aWNSZW5kZXJGbnM7CiAgICAgICAgb3B0aW9ucy5yZW5kZXIgPSByZW5kZXI7CiAgICAgICAgb3B0aW9ucy5zdGF0aWNSZW5kZXJGbnMgPSBzdGF0aWNSZW5kZXJGbnM7CgogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmIChjb25maWcucGVyZm9ybWFuY2UgJiYgbWFyaykgewogICAgICAgICAgbWFyaygnY29tcGlsZSBlbmQnKTsKICAgICAgICAgIG1lYXN1cmUoKCJ2dWUgIiArICh0aGlzLl9uYW1lKSArICIgY29tcGlsZSIpLCAnY29tcGlsZScsICdjb21waWxlIGVuZCcpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIG1vdW50LmNhbGwodGhpcywgZWwsIGh5ZHJhdGluZykKICB9OwoKICAvKioKICAgKiBHZXQgb3V0ZXJIVE1MIG9mIGVsZW1lbnRzLCB0YWtpbmcgY2FyZQogICAqIG9mIFNWRyBlbGVtZW50cyBpbiBJRSBhcyB3ZWxsLgogICAqLwogIGZ1bmN0aW9uIGdldE91dGVySFRNTCAoZWwpIHsKICAgIGlmIChlbC5vdXRlckhUTUwpIHsKICAgICAgcmV0dXJuIGVsLm91dGVySFRNTAogICAgfSBlbHNlIHsKICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZWwuY2xvbmVOb2RlKHRydWUpKTsKICAgICAgcmV0dXJuIGNvbnRhaW5lci5pbm5lckhUTUwKICAgIH0KICB9CgogIFZ1ZS5jb21waWxlID0gY29tcGlsZVRvRnVuY3Rpb25zOwoKICByZXR1cm4gVnVlOwoKfSkpOwo="},{"meta":{"name":"vue.js","url":"https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js","ts":1605621954166,"mimetype":"text/javascript"},"source":"LyohCiAqIFZ1ZS5qcyB2Mi42LjEyCiAqIChjKSAyMDE0LTIwMjAgRXZhbiBZb3UKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLgogKi8KKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6CiAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDoKICAoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGdsb2JhbC5WdWUgPSBmYWN0b3J5KCkpOwp9KHRoaXMsIGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnOwoKICAvKiAgKi8KCiAgdmFyIGVtcHR5T2JqZWN0ID0gT2JqZWN0LmZyZWV6ZSh7fSk7CgogIC8vIFRoZXNlIGhlbHBlcnMgcHJvZHVjZSBiZXR0ZXIgVk0gY29kZSBpbiBKUyBlbmdpbmVzIGR1ZSB0byB0aGVpcgogIC8vIGV4cGxpY2l0bmVzcyBhbmQgZnVuY3Rpb24gaW5saW5pbmcuCiAgZnVuY3Rpb24gaXNVbmRlZiAodikgewogICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCB8fCB2ID09PSBudWxsCiAgfQoKICBmdW5jdGlvbiBpc0RlZiAodikgewogICAgcmV0dXJuIHYgIT09IHVuZGVmaW5lZCAmJiB2ICE9PSBudWxsCiAgfQoKICBmdW5jdGlvbiBpc1RydWUgKHYpIHsKICAgIHJldHVybiB2ID09PSB0cnVlCiAgfQoKICBmdW5jdGlvbiBpc0ZhbHNlICh2KSB7CiAgICByZXR1cm4gdiA9PT0gZmFsc2UKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHZhbHVlIGlzIHByaW1pdGl2ZS4KICAgKi8KICBmdW5jdGlvbiBpc1ByaW1pdGl2ZSAodmFsdWUpIHsKICAgIHJldHVybiAoCiAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwKICAgICAgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyB8fAogICAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgICAgdHlwZW9mIHZhbHVlID09PSAnc3ltYm9sJyB8fAogICAgICB0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJwogICAgKQogIH0KCiAgLyoqCiAgICogUXVpY2sgb2JqZWN0IGNoZWNrIC0gdGhpcyBpcyBwcmltYXJpbHkgdXNlZCB0byB0ZWxsCiAgICogT2JqZWN0cyBmcm9tIHByaW1pdGl2ZSB2YWx1ZXMgd2hlbiB3ZSBrbm93IHRoZSB2YWx1ZQogICAqIGlzIGEgSlNPTi1jb21wbGlhbnQgdHlwZS4KICAgKi8KICBmdW5jdGlvbiBpc09iamVjdCAob2JqKSB7CiAgICByZXR1cm4gb2JqICE9PSBudWxsICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnCiAgfQoKICAvKioKICAgKiBHZXQgdGhlIHJhdyB0eXBlIHN0cmluZyBvZiBhIHZhbHVlLCBlLmcuLCBbb2JqZWN0IE9iamVjdF0uCiAgICovCiAgdmFyIF90b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CgogIGZ1bmN0aW9uIHRvUmF3VHlwZSAodmFsdWUpIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbCh2YWx1ZSkuc2xpY2UoOCwgLTEpCiAgfQoKICAvKioKICAgKiBTdHJpY3Qgb2JqZWN0IHR5cGUgY2hlY2suIE9ubHkgcmV0dXJucyB0cnVlCiAgICogZm9yIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0cy4KICAgKi8KICBmdW5jdGlvbiBpc1BsYWluT2JqZWN0IChvYmopIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBPYmplY3RdJwogIH0KCiAgZnVuY3Rpb24gaXNSZWdFeHAgKHYpIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgUmVnRXhwXScKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHZhbCBpcyBhIHZhbGlkIGFycmF5IGluZGV4LgogICAqLwogIGZ1bmN0aW9uIGlzVmFsaWRBcnJheUluZGV4ICh2YWwpIHsKICAgIHZhciBuID0gcGFyc2VGbG9hdChTdHJpbmcodmFsKSk7CiAgICByZXR1cm4gbiA+PSAwICYmIE1hdGguZmxvb3IobikgPT09IG4gJiYgaXNGaW5pdGUodmFsKQogIH0KCiAgZnVuY3Rpb24gaXNQcm9taXNlICh2YWwpIHsKICAgIHJldHVybiAoCiAgICAgIGlzRGVmKHZhbCkgJiYKICAgICAgdHlwZW9mIHZhbC50aGVuID09PSAnZnVuY3Rpb24nICYmCiAgICAgIHR5cGVvZiB2YWwuY2F0Y2ggPT09ICdmdW5jdGlvbicKICAgICkKICB9CgogIC8qKgogICAqIENvbnZlcnQgYSB2YWx1ZSB0byBhIHN0cmluZyB0aGF0IGlzIGFjdHVhbGx5IHJlbmRlcmVkLgogICAqLwogIGZ1bmN0aW9uIHRvU3RyaW5nICh2YWwpIHsKICAgIHJldHVybiB2YWwgPT0gbnVsbAogICAgICA/ICcnCiAgICAgIDogQXJyYXkuaXNBcnJheSh2YWwpIHx8IChpc1BsYWluT2JqZWN0KHZhbCkgJiYgdmFsLnRvU3RyaW5nID09PSBfdG9TdHJpbmcpCiAgICAgICAgPyBKU09OLnN0cmluZ2lmeSh2YWwsIG51bGwsIDIpCiAgICAgICAgOiBTdHJpbmcodmFsKQogIH0KCiAgLyoqCiAgICogQ29udmVydCBhbiBpbnB1dCB2YWx1ZSB0byBhIG51bWJlciBmb3IgcGVyc2lzdGVuY2UuCiAgICogSWYgdGhlIGNvbnZlcnNpb24gZmFpbHMsIHJldHVybiBvcmlnaW5hbCBzdHJpbmcuCiAgICovCiAgZnVuY3Rpb24gdG9OdW1iZXIgKHZhbCkgewogICAgdmFyIG4gPSBwYXJzZUZsb2F0KHZhbCk7CiAgICByZXR1cm4gaXNOYU4obikgPyB2YWwgOiBuCiAgfQoKICAvKioKICAgKiBNYWtlIGEgbWFwIGFuZCByZXR1cm4gYSBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYSBrZXkKICAgKiBpcyBpbiB0aGF0IG1hcC4KICAgKi8KICBmdW5jdGlvbiBtYWtlTWFwICgKICAgIHN0ciwKICAgIGV4cGVjdHNMb3dlckNhc2UKICApIHsKICAgIHZhciBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdmFyIGxpc3QgPSBzdHIuc3BsaXQoJywnKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgewogICAgICBtYXBbbGlzdFtpXV0gPSB0cnVlOwogICAgfQogICAgcmV0dXJuIGV4cGVjdHNMb3dlckNhc2UKICAgICAgPyBmdW5jdGlvbiAodmFsKSB7IHJldHVybiBtYXBbdmFsLnRvTG93ZXJDYXNlKCldOyB9CiAgICAgIDogZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gbWFwW3ZhbF07IH0KICB9CgogIC8qKgogICAqIENoZWNrIGlmIGEgdGFnIGlzIGEgYnVpbHQtaW4gdGFnLgogICAqLwogIHZhciBpc0J1aWx0SW5UYWcgPSBtYWtlTWFwKCdzbG90LGNvbXBvbmVudCcsIHRydWUpOwoKICAvKioKICAgKiBDaGVjayBpZiBhbiBhdHRyaWJ1dGUgaXMgYSByZXNlcnZlZCBhdHRyaWJ1dGUuCiAgICovCiAgdmFyIGlzUmVzZXJ2ZWRBdHRyaWJ1dGUgPSBtYWtlTWFwKCdrZXkscmVmLHNsb3Qsc2xvdC1zY29wZSxpcycpOwoKICAvKioKICAgKiBSZW1vdmUgYW4gaXRlbSBmcm9tIGFuIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIHJlbW92ZSAoYXJyLCBpdGVtKSB7CiAgICBpZiAoYXJyLmxlbmd0aCkgewogICAgICB2YXIgaW5kZXggPSBhcnIuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICByZXR1cm4gYXJyLnNwbGljZShpbmRleCwgMSkKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogQ2hlY2sgd2hldGhlciBhbiBvYmplY3QgaGFzIHRoZSBwcm9wZXJ0eS4KICAgKi8KICB2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwogIGZ1bmN0aW9uIGhhc093biAob2JqLCBrZXkpIHsKICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KQogIH0KCiAgLyoqCiAgICogQ3JlYXRlIGEgY2FjaGVkIHZlcnNpb24gb2YgYSBwdXJlIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNhY2hlZCAoZm4pIHsKICAgIHZhciBjYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICByZXR1cm4gKGZ1bmN0aW9uIGNhY2hlZEZuIChzdHIpIHsKICAgICAgdmFyIGhpdCA9IGNhY2hlW3N0cl07CiAgICAgIHJldHVybiBoaXQgfHwgKGNhY2hlW3N0cl0gPSBmbihzdHIpKQogICAgfSkKICB9CgogIC8qKgogICAqIENhbWVsaXplIGEgaHlwaGVuLWRlbGltaXRlZCBzdHJpbmcuCiAgICovCiAgdmFyIGNhbWVsaXplUkUgPSAvLShcdykvZzsKICB2YXIgY2FtZWxpemUgPSBjYWNoZWQoZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuIHN0ci5yZXBsYWNlKGNhbWVsaXplUkUsIGZ1bmN0aW9uIChfLCBjKSB7IHJldHVybiBjID8gYy50b1VwcGVyQ2FzZSgpIDogJyc7IH0pCiAgfSk7CgogIC8qKgogICAqIENhcGl0YWxpemUgYSBzdHJpbmcuCiAgICovCiAgdmFyIGNhcGl0YWxpemUgPSBjYWNoZWQoZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKQogIH0pOwoKICAvKioKICAgKiBIeXBoZW5hdGUgYSBjYW1lbENhc2Ugc3RyaW5nLgogICAqLwogIHZhciBoeXBoZW5hdGVSRSA9IC9cQihbQS1aXSkvZzsKICB2YXIgaHlwaGVuYXRlID0gY2FjaGVkKGZ1bmN0aW9uIChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZShoeXBoZW5hdGVSRSwgJy0kMScpLnRvTG93ZXJDYXNlKCkKICB9KTsKCiAgLyoqCiAgICogU2ltcGxlIGJpbmQgcG9seWZpbGwgZm9yIGVudmlyb25tZW50cyB0aGF0IGRvIG5vdCBzdXBwb3J0IGl0LAogICAqIGUuZy4sIFBoYW50b21KUyAxLnguIFRlY2huaWNhbGx5LCB3ZSBkb24ndCBuZWVkIHRoaXMgYW55bW9yZQogICAqIHNpbmNlIG5hdGl2ZSBiaW5kIGlzIG5vdyBwZXJmb3JtYW50IGVub3VnaCBpbiBtb3N0IGJyb3dzZXJzLgogICAqIEJ1dCByZW1vdmluZyBpdCB3b3VsZCBtZWFuIGJyZWFraW5nIGNvZGUgdGhhdCB3YXMgYWJsZSB0byBydW4gaW4KICAgKiBQaGFudG9tSlMgMS54LCBzbyB0aGlzIG11c3QgYmUga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS4KICAgKi8KCiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICBmdW5jdGlvbiBwb2x5ZmlsbEJpbmQgKGZuLCBjdHgpIHsKICAgIGZ1bmN0aW9uIGJvdW5kRm4gKGEpIHsKICAgICAgdmFyIGwgPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICByZXR1cm4gbAogICAgICAgID8gbCA+IDEKICAgICAgICAgID8gZm4uYXBwbHkoY3R4LCBhcmd1bWVudHMpCiAgICAgICAgICA6IGZuLmNhbGwoY3R4LCBhKQogICAgICAgIDogZm4uY2FsbChjdHgpCiAgICB9CgogICAgYm91bmRGbi5fbGVuZ3RoID0gZm4ubGVuZ3RoOwogICAgcmV0dXJuIGJvdW5kRm4KICB9CgogIGZ1bmN0aW9uIG5hdGl2ZUJpbmQgKGZuLCBjdHgpIHsKICAgIHJldHVybiBmbi5iaW5kKGN0eCkKICB9CgogIHZhciBiaW5kID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQKICAgID8gbmF0aXZlQmluZAogICAgOiBwb2x5ZmlsbEJpbmQ7CgogIC8qKgogICAqIENvbnZlcnQgYW4gQXJyYXktbGlrZSBvYmplY3QgdG8gYSByZWFsIEFycmF5LgogICAqLwogIGZ1bmN0aW9uIHRvQXJyYXkgKGxpc3QsIHN0YXJ0KSB7CiAgICBzdGFydCA9IHN0YXJ0IHx8IDA7CiAgICB2YXIgaSA9IGxpc3QubGVuZ3RoIC0gc3RhcnQ7CiAgICB2YXIgcmV0ID0gbmV3IEFycmF5KGkpOwogICAgd2hpbGUgKGktLSkgewogICAgICByZXRbaV0gPSBsaXN0W2kgKyBzdGFydF07CiAgICB9CiAgICByZXR1cm4gcmV0CiAgfQoKICAvKioKICAgKiBNaXggcHJvcGVydGllcyBpbnRvIHRhcmdldCBvYmplY3QuCiAgICovCiAgZnVuY3Rpb24gZXh0ZW5kICh0bywgX2Zyb20pIHsKICAgIGZvciAodmFyIGtleSBpbiBfZnJvbSkgewogICAgICB0b1trZXldID0gX2Zyb21ba2V5XTsKICAgIH0KICAgIHJldHVybiB0bwogIH0KCiAgLyoqCiAgICogTWVyZ2UgYW4gQXJyYXkgb2YgT2JqZWN0cyBpbnRvIGEgc2luZ2xlIE9iamVjdC4KICAgKi8KICBmdW5jdGlvbiB0b09iamVjdCAoYXJyKSB7CiAgICB2YXIgcmVzID0ge307CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBpZiAoYXJyW2ldKSB7CiAgICAgICAgZXh0ZW5kKHJlcywgYXJyW2ldKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCiAgLyoqCiAgICogUGVyZm9ybSBubyBvcGVyYXRpb24uCiAgICogU3R1YmJpbmcgYXJncyB0byBtYWtlIEZsb3cgaGFwcHkgd2l0aG91dCBsZWF2aW5nIHVzZWxlc3MgdHJhbnNwaWxlZCBjb2RlCiAgICogd2l0aCAuLi5yZXN0IChodHRwczovL2Zsb3cub3JnL2Jsb2cvMjAxNy8wNS8wNy9TdHJpY3QtRnVuY3Rpb24tQ2FsbC1Bcml0eS8pLgogICAqLwogIGZ1bmN0aW9uIG5vb3AgKGEsIGIsIGMpIHt9CgogIC8qKgogICAqIEFsd2F5cyByZXR1cm4gZmFsc2UuCiAgICovCiAgdmFyIG5vID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIGZhbHNlOyB9OwoKICAvKiBlc2xpbnQtZW5hYmxlIG5vLXVudXNlZC12YXJzICovCgogIC8qKgogICAqIFJldHVybiB0aGUgc2FtZSB2YWx1ZS4KICAgKi8KICB2YXIgaWRlbnRpdHkgPSBmdW5jdGlvbiAoXykgeyByZXR1cm4gXzsgfTsKCiAgLyoqCiAgICogR2VuZXJhdGUgYSBzdHJpbmcgY29udGFpbmluZyBzdGF0aWMga2V5cyBmcm9tIGNvbXBpbGVyIG1vZHVsZXMuCiAgICovCiAgZnVuY3Rpb24gZ2VuU3RhdGljS2V5cyAobW9kdWxlcykgewogICAgcmV0dXJuIG1vZHVsZXMucmVkdWNlKGZ1bmN0aW9uIChrZXlzLCBtKSB7CiAgICAgIHJldHVybiBrZXlzLmNvbmNhdChtLnN0YXRpY0tleXMgfHwgW10pCiAgICB9LCBbXSkuam9pbignLCcpCiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0d28gdmFsdWVzIGFyZSBsb29zZWx5IGVxdWFsIC0gdGhhdCBpcywKICAgKiBpZiB0aGV5IGFyZSBwbGFpbiBvYmplY3RzLCBkbyB0aGV5IGhhdmUgdGhlIHNhbWUgc2hhcGU/CiAgICovCiAgZnVuY3Rpb24gbG9vc2VFcXVhbCAoYSwgYikgewogICAgaWYgKGEgPT09IGIpIHsgcmV0dXJuIHRydWUgfQogICAgdmFyIGlzT2JqZWN0QSA9IGlzT2JqZWN0KGEpOwogICAgdmFyIGlzT2JqZWN0QiA9IGlzT2JqZWN0KGIpOwogICAgaWYgKGlzT2JqZWN0QSAmJiBpc09iamVjdEIpIHsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgaXNBcnJheUEgPSBBcnJheS5pc0FycmF5KGEpOwogICAgICAgIHZhciBpc0FycmF5QiA9IEFycmF5LmlzQXJyYXkoYik7CiAgICAgICAgaWYgKGlzQXJyYXlBICYmIGlzQXJyYXlCKSB7CiAgICAgICAgICByZXR1cm4gYS5sZW5ndGggPT09IGIubGVuZ3RoICYmIGEuZXZlcnkoZnVuY3Rpb24gKGUsIGkpIHsKICAgICAgICAgICAgcmV0dXJuIGxvb3NlRXF1YWwoZSwgYltpXSkKICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIGlmIChhIGluc3RhbmNlb2YgRGF0ZSAmJiBiIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgcmV0dXJuIGEuZ2V0VGltZSgpID09PSBiLmdldFRpbWUoKQogICAgICAgIH0gZWxzZSBpZiAoIWlzQXJyYXlBICYmICFpc0FycmF5QikgewogICAgICAgICAgdmFyIGtleXNBID0gT2JqZWN0LmtleXMoYSk7CiAgICAgICAgICB2YXIga2V5c0IgPSBPYmplY3Qua2V5cyhiKTsKICAgICAgICAgIHJldHVybiBrZXlzQS5sZW5ndGggPT09IGtleXNCLmxlbmd0aCAmJiBrZXlzQS5ldmVyeShmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiBsb29zZUVxdWFsKGFba2V5XSwgYltrZXldKQogICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIWlzT2JqZWN0QSAmJiAhaXNPYmplY3RCKSB7CiAgICAgIHJldHVybiBTdHJpbmcoYSkgPT09IFN0cmluZyhiKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgfQoKICAvKioKICAgKiBSZXR1cm4gdGhlIGZpcnN0IGluZGV4IGF0IHdoaWNoIGEgbG9vc2VseSBlcXVhbCB2YWx1ZSBjYW4gYmUKICAgKiBmb3VuZCBpbiB0aGUgYXJyYXkgKGlmIHZhbHVlIGlzIGEgcGxhaW4gb2JqZWN0LCB0aGUgYXJyYXkgbXVzdAogICAqIGNvbnRhaW4gYW4gb2JqZWN0IG9mIHRoZSBzYW1lIHNoYXBlKSwgb3IgLTEgaWYgaXQgaXMgbm90IHByZXNlbnQuCiAgICovCiAgZnVuY3Rpb24gbG9vc2VJbmRleE9mIChhcnIsIHZhbCkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGxvb3NlRXF1YWwoYXJyW2ldLCB2YWwpKSB7IHJldHVybiBpIH0KICAgIH0KICAgIHJldHVybiAtMQogIH0KCiAgLyoqCiAgICogRW5zdXJlIGEgZnVuY3Rpb24gaXMgY2FsbGVkIG9ubHkgb25jZS4KICAgKi8KICBmdW5jdGlvbiBvbmNlIChmbikgewogICAgdmFyIGNhbGxlZCA9IGZhbHNlOwogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCFjYWxsZWQpIHsKICAgICAgICBjYWxsZWQgPSB0cnVlOwogICAgICAgIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBTU1JfQVRUUiA9ICdkYXRhLXNlcnZlci1yZW5kZXJlZCc7CgogIHZhciBBU1NFVF9UWVBFUyA9IFsKICAgICdjb21wb25lbnQnLAogICAgJ2RpcmVjdGl2ZScsCiAgICAnZmlsdGVyJwogIF07CgogIHZhciBMSUZFQ1lDTEVfSE9PS1MgPSBbCiAgICAnYmVmb3JlQ3JlYXRlJywKICAgICdjcmVhdGVkJywKICAgICdiZWZvcmVNb3VudCcsCiAgICAnbW91bnRlZCcsCiAgICAnYmVmb3JlVXBkYXRlJywKICAgICd1cGRhdGVkJywKICAgICdiZWZvcmVEZXN0cm95JywKICAgICdkZXN0cm95ZWQnLAogICAgJ2FjdGl2YXRlZCcsCiAgICAnZGVhY3RpdmF0ZWQnLAogICAgJ2Vycm9yQ2FwdHVyZWQnLAogICAgJ3NlcnZlclByZWZldGNoJwogIF07CgogIC8qICAqLwoKCgogIHZhciBjb25maWcgPSAoewogICAgLyoqCiAgICAgKiBPcHRpb24gbWVyZ2Ugc3RyYXRlZ2llcyAodXNlZCBpbiBjb3JlL3V0aWwvb3B0aW9ucykKICAgICAqLwogICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICBvcHRpb25NZXJnZVN0cmF0ZWdpZXM6IE9iamVjdC5jcmVhdGUobnVsbCksCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHN1cHByZXNzIHdhcm5pbmdzLgogICAgICovCiAgICBzaWxlbnQ6IGZhbHNlLAoKICAgIC8qKgogICAgICogU2hvdyBwcm9kdWN0aW9uIG1vZGUgdGlwIG1lc3NhZ2Ugb24gYm9vdD8KICAgICAqLwogICAgcHJvZHVjdGlvblRpcDogImRldmVsb3BtZW50IiAhPT0gJ3Byb2R1Y3Rpb24nLAoKICAgIC8qKgogICAgICogV2hldGhlciB0byBlbmFibGUgZGV2dG9vbHMKICAgICAqLwogICAgZGV2dG9vbHM6ICJkZXZlbG9wbWVudCIgIT09ICdwcm9kdWN0aW9uJywKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcmVjb3JkIHBlcmYKICAgICAqLwogICAgcGVyZm9ybWFuY2U6IGZhbHNlLAoKICAgIC8qKgogICAgICogRXJyb3IgaGFuZGxlciBmb3Igd2F0Y2hlciBlcnJvcnMKICAgICAqLwogICAgZXJyb3JIYW5kbGVyOiBudWxsLAoKICAgIC8qKgogICAgICogV2FybiBoYW5kbGVyIGZvciB3YXRjaGVyIHdhcm5zCiAgICAgKi8KICAgIHdhcm5IYW5kbGVyOiBudWxsLAoKICAgIC8qKgogICAgICogSWdub3JlIGNlcnRhaW4gY3VzdG9tIGVsZW1lbnRzCiAgICAgKi8KICAgIGlnbm9yZWRFbGVtZW50czogW10sCgogICAgLyoqCiAgICAgKiBDdXN0b20gdXNlciBrZXkgYWxpYXNlcyBmb3Igdi1vbgogICAgICovCiAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgIGtleUNvZGVzOiBPYmplY3QuY3JlYXRlKG51bGwpLAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB0YWcgaXMgcmVzZXJ2ZWQgc28gdGhhdCBpdCBjYW5ub3QgYmUgcmVnaXN0ZXJlZCBhcyBhCiAgICAgKiBjb21wb25lbnQuIFRoaXMgaXMgcGxhdGZvcm0tZGVwZW5kZW50IGFuZCBtYXkgYmUgb3ZlcndyaXR0ZW4uCiAgICAgKi8KICAgIGlzUmVzZXJ2ZWRUYWc6IG5vLAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gYXR0cmlidXRlIGlzIHJlc2VydmVkIHNvIHRoYXQgaXQgY2Fubm90IGJlIHVzZWQgYXMgYSBjb21wb25lbnQKICAgICAqIHByb3AuIFRoaXMgaXMgcGxhdGZvcm0tZGVwZW5kZW50IGFuZCBtYXkgYmUgb3ZlcndyaXR0ZW4uCiAgICAgKi8KICAgIGlzUmVzZXJ2ZWRBdHRyOiBubywKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdGFnIGlzIGFuIHVua25vd24gZWxlbWVudC4KICAgICAqIFBsYXRmb3JtLWRlcGVuZGVudC4KICAgICAqLwogICAgaXNVbmtub3duRWxlbWVudDogbm8sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIG5hbWVzcGFjZSBvZiBhbiBlbGVtZW50CiAgICAgKi8KICAgIGdldFRhZ05hbWVzcGFjZTogbm9vcCwKCiAgICAvKioKICAgICAqIFBhcnNlIHRoZSByZWFsIHRhZyBuYW1lIGZvciB0aGUgc3BlY2lmaWMgcGxhdGZvcm0uCiAgICAgKi8KICAgIHBhcnNlUGxhdGZvcm1UYWdOYW1lOiBpZGVudGl0eSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGF0dHJpYnV0ZSBtdXN0IGJlIGJvdW5kIHVzaW5nIHByb3BlcnR5LCBlLmcuIHZhbHVlCiAgICAgKiBQbGF0Zm9ybS1kZXBlbmRlbnQuCiAgICAgKi8KICAgIG11c3RVc2VQcm9wOiBubywKCiAgICAvKioKICAgICAqIFBlcmZvcm0gdXBkYXRlcyBhc3luY2hyb25vdXNseS4gSW50ZW5kZWQgdG8gYmUgdXNlZCBieSBWdWUgVGVzdCBVdGlscwogICAgICogVGhpcyB3aWxsIHNpZ25pZmljYW50bHkgcmVkdWNlIHBlcmZvcm1hbmNlIGlmIHNldCB0byBmYWxzZS4KICAgICAqLwogICAgYXN5bmM6IHRydWUsCgogICAgLyoqCiAgICAgKiBFeHBvc2VkIGZvciBsZWdhY3kgcmVhc29ucwogICAgICovCiAgICBfbGlmZWN5Y2xlSG9va3M6IExJRkVDWUNMRV9IT09LUwogIH0pOwoKICAvKiAgKi8KCiAgLyoqCiAgICogdW5pY29kZSBsZXR0ZXJzIHVzZWQgZm9yIHBhcnNpbmcgaHRtbCB0YWdzLCBjb21wb25lbnQgbmFtZXMgYW5kIHByb3BlcnR5IHBhdGhzLgogICAqIHVzaW5nIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9odG1sNTMvc2VtYW50aWNzLXNjcmlwdGluZy5odG1sI3BvdGVudGlhbGN1c3RvbWVsZW1lbnRuYW1lCiAgICogc2tpcHBpbmcgXHUxMDAwMC1cdUVGRkZGIGR1ZSB0byBpdCBmcmVlemluZyB1cCBQaGFudG9tSlMKICAgKi8KICB2YXIgdW5pY29kZVJlZ0V4cCA9IC9hLXpBLVpcdTAwQjdcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjAzRi1cdTIwNDBcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRC87CgogIC8qKgogICAqIENoZWNrIGlmIGEgc3RyaW5nIHN0YXJ0cyB3aXRoICQgb3IgXwogICAqLwogIGZ1bmN0aW9uIGlzUmVzZXJ2ZWQgKHN0cikgewogICAgdmFyIGMgPSAoc3RyICsgJycpLmNoYXJDb2RlQXQoMCk7CiAgICByZXR1cm4gYyA9PT0gMHgyNCB8fCBjID09PSAweDVGCiAgfQoKICAvKioKICAgKiBEZWZpbmUgYSBwcm9wZXJ0eS4KICAgKi8KICBmdW5jdGlvbiBkZWYgKG9iaiwga2V5LCB2YWwsIGVudW1lcmFibGUpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsLAogICAgICBlbnVtZXJhYmxlOiAhIWVudW1lcmFibGUsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0pOwogIH0KCiAgLyoqCiAgICogUGFyc2Ugc2ltcGxlIHBhdGguCiAgICovCiAgdmFyIGJhaWxSRSA9IG5ldyBSZWdFeHAoKCJbXiIgKyAodW5pY29kZVJlZ0V4cC5zb3VyY2UpICsgIi4kX1xcZF0iKSk7CiAgZnVuY3Rpb24gcGFyc2VQYXRoIChwYXRoKSB7CiAgICBpZiAoYmFpbFJFLnRlc3QocGF0aCkpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgc2VnbWVudHMgPSBwYXRoLnNwbGl0KCcuJyk7CiAgICByZXR1cm4gZnVuY3Rpb24gKG9iaikgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKCFvYmopIHsgcmV0dXJuIH0KICAgICAgICBvYmogPSBvYmpbc2VnbWVudHNbaV1dOwogICAgICB9CiAgICAgIHJldHVybiBvYmoKICAgIH0KICB9CgogIC8qICAqLwoKICAvLyBjYW4gd2UgdXNlIF9fcHJvdG9fXz8KICB2YXIgaGFzUHJvdG8gPSAnX19wcm90b19fJyBpbiB7fTsKCiAgLy8gQnJvd3NlciBlbnZpcm9ubWVudCBzbmlmZmluZwogIHZhciBpbkJyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJzsKICB2YXIgaW5XZWV4ID0gdHlwZW9mIFdYRW52aXJvbm1lbnQgIT09ICd1bmRlZmluZWQnICYmICEhV1hFbnZpcm9ubWVudC5wbGF0Zm9ybTsKICB2YXIgd2VleFBsYXRmb3JtID0gaW5XZWV4ICYmIFdYRW52aXJvbm1lbnQucGxhdGZvcm0udG9Mb3dlckNhc2UoKTsKICB2YXIgVUEgPSBpbkJyb3dzZXIgJiYgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsKICB2YXIgaXNJRSA9IFVBICYmIC9tc2llfHRyaWRlbnQvLnRlc3QoVUEpOwogIHZhciBpc0lFOSA9IFVBICYmIFVBLmluZGV4T2YoJ21zaWUgOS4wJykgPiAwOwogIHZhciBpc0VkZ2UgPSBVQSAmJiBVQS5pbmRleE9mKCdlZGdlLycpID4gMDsKICB2YXIgaXNBbmRyb2lkID0gKFVBICYmIFVBLmluZGV4T2YoJ2FuZHJvaWQnKSA+IDApIHx8ICh3ZWV4UGxhdGZvcm0gPT09ICdhbmRyb2lkJyk7CiAgdmFyIGlzSU9TID0gKFVBICYmIC9pcGhvbmV8aXBhZHxpcG9kfGlvcy8udGVzdChVQSkpIHx8ICh3ZWV4UGxhdGZvcm0gPT09ICdpb3MnKTsKICB2YXIgaXNDaHJvbWUgPSBVQSAmJiAvY2hyb21lXC9cZCsvLnRlc3QoVUEpICYmICFpc0VkZ2U7CiAgdmFyIGlzUGhhbnRvbUpTID0gVUEgJiYgL3BoYW50b21qcy8udGVzdChVQSk7CiAgdmFyIGlzRkYgPSBVQSAmJiBVQS5tYXRjaCgvZmlyZWZveFwvKFxkKykvKTsKCiAgLy8gRmlyZWZveCBoYXMgYSAid2F0Y2giIGZ1bmN0aW9uIG9uIE9iamVjdC5wcm90b3R5cGUuLi4KICB2YXIgbmF0aXZlV2F0Y2ggPSAoe30pLndhdGNoOwoKICB2YXIgc3VwcG9ydHNQYXNzaXZlID0gZmFsc2U7CiAgaWYgKGluQnJvd3NlcikgewogICAgdHJ5IHsKICAgICAgdmFyIG9wdHMgPSB7fTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9wdHMsICdwYXNzaXZlJywgKHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCAoKSB7CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgICAgc3VwcG9ydHNQYXNzaXZlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pKTsgLy8gaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL2Zsb3cvaXNzdWVzLzI4NQogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndGVzdC1wYXNzaXZlJywgbnVsbCwgb3B0cyk7CiAgICB9IGNhdGNoIChlKSB7fQogIH0KCiAgLy8gdGhpcyBuZWVkcyB0byBiZSBsYXp5LWV2YWxlZCBiZWNhdXNlIHZ1ZSBtYXkgYmUgcmVxdWlyZWQgYmVmb3JlCiAgLy8gdnVlLXNlcnZlci1yZW5kZXJlciBjYW4gc2V0IFZVRV9FTlYKICB2YXIgX2lzU2VydmVyOwogIHZhciBpc1NlcnZlclJlbmRlcmluZyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChfaXNTZXJ2ZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCFpbkJyb3dzZXIgJiYgIWluV2VleCAmJiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIC8vIGRldGVjdCBwcmVzZW5jZSBvZiB2dWUtc2VydmVyLXJlbmRlcmVyIGFuZCBhdm9pZAogICAgICAgIC8vIFdlYnBhY2sgc2hpbW1pbmcgdGhlIHByb2Nlc3MKICAgICAgICBfaXNTZXJ2ZXIgPSBnbG9iYWxbJ3Byb2Nlc3MnXSAmJiBnbG9iYWxbJ3Byb2Nlc3MnXS5lbnYuVlVFX0VOViA9PT0gJ3NlcnZlcic7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX2lzU2VydmVyID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBfaXNTZXJ2ZXIKICB9OwoKICAvLyBkZXRlY3QgZGV2dG9vbHMKICB2YXIgZGV2dG9vbHMgPSBpbkJyb3dzZXIgJiYgd2luZG93Ll9fVlVFX0RFVlRPT0xTX0dMT0JBTF9IT09LX187CgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gaXNOYXRpdmUgKEN0b3IpIHsKICAgIHJldHVybiB0eXBlb2YgQ3RvciA9PT0gJ2Z1bmN0aW9uJyAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoQ3Rvci50b1N0cmluZygpKQogIH0KCiAgdmFyIGhhc1N5bWJvbCA9CiAgICB0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBpc05hdGl2ZShTeW1ib2wpICYmCiAgICB0eXBlb2YgUmVmbGVjdCAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoUmVmbGVjdC5vd25LZXlzKTsKCiAgdmFyIF9TZXQ7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovIC8vICRmbG93LWRpc2FibGUtbGluZQogIGlmICh0eXBlb2YgU2V0ICE9PSAndW5kZWZpbmVkJyAmJiBpc05hdGl2ZShTZXQpKSB7CiAgICAvLyB1c2UgbmF0aXZlIFNldCB3aGVuIGF2YWlsYWJsZS4KICAgIF9TZXQgPSBTZXQ7CiAgfSBlbHNlIHsKICAgIC8vIGEgbm9uLXN0YW5kYXJkIFNldCBwb2x5ZmlsbCB0aGF0IG9ubHkgd29ya3Mgd2l0aCBwcmltaXRpdmUga2V5cy4KICAgIF9TZXQgPSAvKkBfX1BVUkVfXyovKGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gU2V0ICgpIHsKICAgICAgICB0aGlzLnNldCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH0KICAgICAgU2V0LnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbiBoYXMgKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLnNldFtrZXldID09PSB0cnVlCiAgICAgIH07CiAgICAgIFNldC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gYWRkIChrZXkpIHsKICAgICAgICB0aGlzLnNldFtrZXldID0gdHJ1ZTsKICAgICAgfTsKICAgICAgU2V0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIGNsZWFyICgpIHsKICAgICAgICB0aGlzLnNldCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH07CgogICAgICByZXR1cm4gU2V0OwogICAgfSgpKTsKICB9CgogIC8qICAqLwoKICB2YXIgd2FybiA9IG5vb3A7CiAgdmFyIHRpcCA9IG5vb3A7CiAgdmFyIGdlbmVyYXRlQ29tcG9uZW50VHJhY2UgPSAobm9vcCk7IC8vIHdvcmsgYXJvdW5kIGZsb3cgY2hlY2sKICB2YXIgZm9ybWF0Q29tcG9uZW50TmFtZSA9IChub29wKTsKCiAgewogICAgdmFyIGhhc0NvbnNvbGUgPSB0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCc7CiAgICB2YXIgY2xhc3NpZnlSRSA9IC8oPzpefFstX10pKFx3KS9nOwogICAgdmFyIGNsYXNzaWZ5ID0gZnVuY3Rpb24gKHN0cikgeyByZXR1cm4gc3RyCiAgICAgIC5yZXBsYWNlKGNsYXNzaWZ5UkUsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBjLnRvVXBwZXJDYXNlKCk7IH0pCiAgICAgIC5yZXBsYWNlKC9bLV9dL2csICcnKTsgfTsKCiAgICB3YXJuID0gZnVuY3Rpb24gKG1zZywgdm0pIHsKICAgICAgdmFyIHRyYWNlID0gdm0gPyBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlKHZtKSA6ICcnOwoKICAgICAgaWYgKGNvbmZpZy53YXJuSGFuZGxlcikgewogICAgICAgIGNvbmZpZy53YXJuSGFuZGxlci5jYWxsKG51bGwsIG1zZywgdm0sIHRyYWNlKTsKICAgICAgfSBlbHNlIGlmIChoYXNDb25zb2xlICYmICghY29uZmlnLnNpbGVudCkpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCgiW1Z1ZSB3YXJuXTogIiArIG1zZyArIHRyYWNlKSk7CiAgICAgIH0KICAgIH07CgogICAgdGlwID0gZnVuY3Rpb24gKG1zZywgdm0pIHsKICAgICAgaWYgKGhhc0NvbnNvbGUgJiYgKCFjb25maWcuc2lsZW50KSkgewogICAgICAgIGNvbnNvbGUud2FybigiW1Z1ZSB0aXBdOiAiICsgbXNnICsgKAogICAgICAgICAgdm0gPyBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlKHZtKSA6ICcnCiAgICAgICAgKSk7CiAgICAgIH0KICAgIH07CgogICAgZm9ybWF0Q29tcG9uZW50TmFtZSA9IGZ1bmN0aW9uICh2bSwgaW5jbHVkZUZpbGUpIHsKICAgICAgaWYgKHZtLiRyb290ID09PSB2bSkgewogICAgICAgIHJldHVybiAnPFJvb3Q+JwogICAgICB9CiAgICAgIHZhciBvcHRpb25zID0gdHlwZW9mIHZtID09PSAnZnVuY3Rpb24nICYmIHZtLmNpZCAhPSBudWxsCiAgICAgICAgPyB2bS5vcHRpb25zCiAgICAgICAgOiB2bS5faXNWdWUKICAgICAgICAgID8gdm0uJG9wdGlvbnMgfHwgdm0uY29uc3RydWN0b3Iub3B0aW9ucwogICAgICAgICAgOiB2bTsKICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLm5hbWUgfHwgb3B0aW9ucy5fY29tcG9uZW50VGFnOwogICAgICB2YXIgZmlsZSA9IG9wdGlvbnMuX19maWxlOwogICAgICBpZiAoIW5hbWUgJiYgZmlsZSkgewogICAgICAgIHZhciBtYXRjaCA9IGZpbGUubWF0Y2goLyhbXi9cXF0rKVwudnVlJC8pOwogICAgICAgIG5hbWUgPSBtYXRjaCAmJiBtYXRjaFsxXTsKICAgICAgfQoKICAgICAgcmV0dXJuICgKICAgICAgICAobmFtZSA/ICgiPCIgKyAoY2xhc3NpZnkobmFtZSkpICsgIj4iKSA6ICI8QW5vbnltb3VzPiIpICsKICAgICAgICAoZmlsZSAmJiBpbmNsdWRlRmlsZSAhPT0gZmFsc2UgPyAoIiBhdCAiICsgZmlsZSkgOiAnJykKICAgICAgKQogICAgfTsKCiAgICB2YXIgcmVwZWF0ID0gZnVuY3Rpb24gKHN0ciwgbikgewogICAgICB2YXIgcmVzID0gJyc7CiAgICAgIHdoaWxlIChuKSB7CiAgICAgICAgaWYgKG4gJSAyID09PSAxKSB7IHJlcyArPSBzdHI7IH0KICAgICAgICBpZiAobiA+IDEpIHsgc3RyICs9IHN0cjsgfQogICAgICAgIG4gPj49IDE7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlcwogICAgfTsKCiAgICBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlID0gZnVuY3Rpb24gKHZtKSB7CiAgICAgIGlmICh2bS5faXNWdWUgJiYgdm0uJHBhcmVudCkgewogICAgICAgIHZhciB0cmVlID0gW107CiAgICAgICAgdmFyIGN1cnJlbnRSZWN1cnNpdmVTZXF1ZW5jZSA9IDA7CiAgICAgICAgd2hpbGUgKHZtKSB7CiAgICAgICAgICBpZiAodHJlZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBsYXN0ID0gdHJlZVt0cmVlLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBpZiAobGFzdC5jb25zdHJ1Y3RvciA9PT0gdm0uY29uc3RydWN0b3IpIHsKICAgICAgICAgICAgICBjdXJyZW50UmVjdXJzaXZlU2VxdWVuY2UrKzsKICAgICAgICAgICAgICB2bSA9IHZtLiRwYXJlbnQ7CiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50UmVjdXJzaXZlU2VxdWVuY2UgPiAwKSB7CiAgICAgICAgICAgICAgdHJlZVt0cmVlLmxlbmd0aCAtIDFdID0gW2xhc3QsIGN1cnJlbnRSZWN1cnNpdmVTZXF1ZW5jZV07CiAgICAgICAgICAgICAgY3VycmVudFJlY3Vyc2l2ZVNlcXVlbmNlID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdHJlZS5wdXNoKHZtKTsKICAgICAgICAgIHZtID0gdm0uJHBhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdcblxuZm91bmQgaW5cblxuJyArIHRyZWUKICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHZtLCBpKSB7IHJldHVybiAoIiIgKyAoaSA9PT0gMCA/ICctLS0+ICcgOiByZXBlYXQoJyAnLCA1ICsgaSAqIDIpKSArIChBcnJheS5pc0FycmF5KHZtKQogICAgICAgICAgICAgID8gKChmb3JtYXRDb21wb25lbnROYW1lKHZtWzBdKSkgKyAiLi4uICgiICsgKHZtWzFdKSArICIgcmVjdXJzaXZlIGNhbGxzKSIpCiAgICAgICAgICAgICAgOiBmb3JtYXRDb21wb25lbnROYW1lKHZtKSkpOyB9KQogICAgICAgICAgLmpvaW4oJ1xuJykKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gKCJcblxuKGZvdW5kIGluICIgKyAoZm9ybWF0Q29tcG9uZW50TmFtZSh2bSkpICsgIikiKQogICAgICB9CiAgICB9OwogIH0KCiAgLyogICovCgogIHZhciB1aWQgPSAwOwoKICAvKioKICAgKiBBIGRlcCBpcyBhbiBvYnNlcnZhYmxlIHRoYXQgY2FuIGhhdmUgbXVsdGlwbGUKICAgKiBkaXJlY3RpdmVzIHN1YnNjcmliaW5nIHRvIGl0LgogICAqLwogIHZhciBEZXAgPSBmdW5jdGlvbiBEZXAgKCkgewogICAgdGhpcy5pZCA9IHVpZCsrOwogICAgdGhpcy5zdWJzID0gW107CiAgfTsKCiAgRGVwLnByb3RvdHlwZS5hZGRTdWIgPSBmdW5jdGlvbiBhZGRTdWIgKHN1YikgewogICAgdGhpcy5zdWJzLnB1c2goc3ViKTsKICB9OwoKICBEZXAucHJvdG90eXBlLnJlbW92ZVN1YiA9IGZ1bmN0aW9uIHJlbW92ZVN1YiAoc3ViKSB7CiAgICByZW1vdmUodGhpcy5zdWJzLCBzdWIpOwogIH07CgogIERlcC5wcm90b3R5cGUuZGVwZW5kID0gZnVuY3Rpb24gZGVwZW5kICgpIHsKICAgIGlmIChEZXAudGFyZ2V0KSB7CiAgICAgIERlcC50YXJnZXQuYWRkRGVwKHRoaXMpOwogICAgfQogIH07CgogIERlcC5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5ICgpIHsKICAgIC8vIHN0YWJpbGl6ZSB0aGUgc3Vic2NyaWJlciBsaXN0IGZpcnN0CiAgICB2YXIgc3VicyA9IHRoaXMuc3Vicy5zbGljZSgpOwogICAgaWYgKCFjb25maWcuYXN5bmMpIHsKICAgICAgLy8gc3VicyBhcmVuJ3Qgc29ydGVkIGluIHNjaGVkdWxlciBpZiBub3QgcnVubmluZyBhc3luYwogICAgICAvLyB3ZSBuZWVkIHRvIHNvcnQgdGhlbSBub3cgdG8gbWFrZSBzdXJlIHRoZXkgZmlyZSBpbiBjb3JyZWN0CiAgICAgIC8vIG9yZGVyCiAgICAgIHN1YnMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5pZCAtIGIuaWQ7IH0pOwogICAgfQogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzdWJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBzdWJzW2ldLnVwZGF0ZSgpOwogICAgfQogIH07CgogIC8vIFRoZSBjdXJyZW50IHRhcmdldCB3YXRjaGVyIGJlaW5nIGV2YWx1YXRlZC4KICAvLyBUaGlzIGlzIGdsb2JhbGx5IHVuaXF1ZSBiZWNhdXNlIG9ubHkgb25lIHdhdGNoZXIKICAvLyBjYW4gYmUgZXZhbHVhdGVkIGF0IGEgdGltZS4KICBEZXAudGFyZ2V0ID0gbnVsbDsKICB2YXIgdGFyZ2V0U3RhY2sgPSBbXTsKCiAgZnVuY3Rpb24gcHVzaFRhcmdldCAodGFyZ2V0KSB7CiAgICB0YXJnZXRTdGFjay5wdXNoKHRhcmdldCk7CiAgICBEZXAudGFyZ2V0ID0gdGFyZ2V0OwogIH0KCiAgZnVuY3Rpb24gcG9wVGFyZ2V0ICgpIHsKICAgIHRhcmdldFN0YWNrLnBvcCgpOwogICAgRGVwLnRhcmdldCA9IHRhcmdldFN0YWNrW3RhcmdldFN0YWNrLmxlbmd0aCAtIDFdOwogIH0KCiAgLyogICovCgogIHZhciBWTm9kZSA9IGZ1bmN0aW9uIFZOb2RlICgKICAgIHRhZywKICAgIGRhdGEsCiAgICBjaGlsZHJlbiwKICAgIHRleHQsCiAgICBlbG0sCiAgICBjb250ZXh0LAogICAgY29tcG9uZW50T3B0aW9ucywKICAgIGFzeW5jRmFjdG9yeQogICkgewogICAgdGhpcy50YWcgPSB0YWc7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuOwogICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgIHRoaXMuZWxtID0gZWxtOwogICAgdGhpcy5ucyA9IHVuZGVmaW5lZDsKICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgICB0aGlzLmZuQ29udGV4dCA9IHVuZGVmaW5lZDsKICAgIHRoaXMuZm5PcHRpb25zID0gdW5kZWZpbmVkOwogICAgdGhpcy5mblNjb3BlSWQgPSB1bmRlZmluZWQ7CiAgICB0aGlzLmtleSA9IGRhdGEgJiYgZGF0YS5rZXk7CiAgICB0aGlzLmNvbXBvbmVudE9wdGlvbnMgPSBjb21wb25lbnRPcHRpb25zOwogICAgdGhpcy5jb21wb25lbnRJbnN0YW5jZSA9IHVuZGVmaW5lZDsKICAgIHRoaXMucGFyZW50ID0gdW5kZWZpbmVkOwogICAgdGhpcy5yYXcgPSBmYWxzZTsKICAgIHRoaXMuaXNTdGF0aWMgPSBmYWxzZTsKICAgIHRoaXMuaXNSb290SW5zZXJ0ID0gdHJ1ZTsKICAgIHRoaXMuaXNDb21tZW50ID0gZmFsc2U7CiAgICB0aGlzLmlzQ2xvbmVkID0gZmFsc2U7CiAgICB0aGlzLmlzT25jZSA9IGZhbHNlOwogICAgdGhpcy5hc3luY0ZhY3RvcnkgPSBhc3luY0ZhY3Rvcnk7CiAgICB0aGlzLmFzeW5jTWV0YSA9IHVuZGVmaW5lZDsKICAgIHRoaXMuaXNBc3luY1BsYWNlaG9sZGVyID0gZmFsc2U7CiAgfTsKCiAgdmFyIHByb3RvdHlwZUFjY2Vzc29ycyA9IHsgY2hpbGQ6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTsKCiAgLy8gREVQUkVDQVRFRDogYWxpYXMgZm9yIGNvbXBvbmVudEluc3RhbmNlIGZvciBiYWNrd2FyZHMgY29tcGF0LgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgcHJvdG90eXBlQWNjZXNzb3JzLmNoaWxkLmdldCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmNvbXBvbmVudEluc3RhbmNlCiAgfTsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIFZOb2RlLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzICk7CgogIHZhciBjcmVhdGVFbXB0eVZOb2RlID0gZnVuY3Rpb24gKHRleHQpIHsKICAgIGlmICggdGV4dCA9PT0gdm9pZCAwICkgdGV4dCA9ICcnOwoKICAgIHZhciBub2RlID0gbmV3IFZOb2RlKCk7CiAgICBub2RlLnRleHQgPSB0ZXh0OwogICAgbm9kZS5pc0NvbW1lbnQgPSB0cnVlOwogICAgcmV0dXJuIG5vZGUKICB9OwoKICBmdW5jdGlvbiBjcmVhdGVUZXh0Vk5vZGUgKHZhbCkgewogICAgcmV0dXJuIG5ldyBWTm9kZSh1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBTdHJpbmcodmFsKSkKICB9CgogIC8vIG9wdGltaXplZCBzaGFsbG93IGNsb25lCiAgLy8gdXNlZCBmb3Igc3RhdGljIG5vZGVzIGFuZCBzbG90IG5vZGVzIGJlY2F1c2UgdGhleSBtYXkgYmUgcmV1c2VkIGFjcm9zcwogIC8vIG11bHRpcGxlIHJlbmRlcnMsIGNsb25pbmcgdGhlbSBhdm9pZHMgZXJyb3JzIHdoZW4gRE9NIG1hbmlwdWxhdGlvbnMgcmVseQogIC8vIG9uIHRoZWlyIGVsbSByZWZlcmVuY2UuCiAgZnVuY3Rpb24gY2xvbmVWTm9kZSAodm5vZGUpIHsKICAgIHZhciBjbG9uZWQgPSBuZXcgVk5vZGUoCiAgICAgIHZub2RlLnRhZywKICAgICAgdm5vZGUuZGF0YSwKICAgICAgLy8gIzc5NzUKICAgICAgLy8gY2xvbmUgY2hpbGRyZW4gYXJyYXkgdG8gYXZvaWQgbXV0YXRpbmcgb3JpZ2luYWwgaW4gY2FzZSBvZiBjbG9uaW5nCiAgICAgIC8vIGEgY2hpbGQuCiAgICAgIHZub2RlLmNoaWxkcmVuICYmIHZub2RlLmNoaWxkcmVuLnNsaWNlKCksCiAgICAgIHZub2RlLnRleHQsCiAgICAgIHZub2RlLmVsbSwKICAgICAgdm5vZGUuY29udGV4dCwKICAgICAgdm5vZGUuY29tcG9uZW50T3B0aW9ucywKICAgICAgdm5vZGUuYXN5bmNGYWN0b3J5CiAgICApOwogICAgY2xvbmVkLm5zID0gdm5vZGUubnM7CiAgICBjbG9uZWQuaXNTdGF0aWMgPSB2bm9kZS5pc1N0YXRpYzsKICAgIGNsb25lZC5rZXkgPSB2bm9kZS5rZXk7CiAgICBjbG9uZWQuaXNDb21tZW50ID0gdm5vZGUuaXNDb21tZW50OwogICAgY2xvbmVkLmZuQ29udGV4dCA9IHZub2RlLmZuQ29udGV4dDsKICAgIGNsb25lZC5mbk9wdGlvbnMgPSB2bm9kZS5mbk9wdGlvbnM7CiAgICBjbG9uZWQuZm5TY29wZUlkID0gdm5vZGUuZm5TY29wZUlkOwogICAgY2xvbmVkLmFzeW5jTWV0YSA9IHZub2RlLmFzeW5jTWV0YTsKICAgIGNsb25lZC5pc0Nsb25lZCA9IHRydWU7CiAgICByZXR1cm4gY2xvbmVkCiAgfQoKICAvKgogICAqIG5vdCB0eXBlIGNoZWNraW5nIHRoaXMgZmlsZSBiZWNhdXNlIGZsb3cgZG9lc24ndCBwbGF5IHdlbGwgd2l0aAogICAqIGR5bmFtaWNhbGx5IGFjY2Vzc2luZyBtZXRob2RzIG9uIEFycmF5IHByb3RvdHlwZQogICAqLwoKICB2YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsKICB2YXIgYXJyYXlNZXRob2RzID0gT2JqZWN0LmNyZWF0ZShhcnJheVByb3RvKTsKCiAgdmFyIG1ldGhvZHNUb1BhdGNoID0gWwogICAgJ3B1c2gnLAogICAgJ3BvcCcsCiAgICAnc2hpZnQnLAogICAgJ3Vuc2hpZnQnLAogICAgJ3NwbGljZScsCiAgICAnc29ydCcsCiAgICAncmV2ZXJzZScKICBdOwoKICAvKioKICAgKiBJbnRlcmNlcHQgbXV0YXRpbmcgbWV0aG9kcyBhbmQgZW1pdCBldmVudHMKICAgKi8KICBtZXRob2RzVG9QYXRjaC5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHsKICAgIC8vIGNhY2hlIG9yaWdpbmFsIG1ldGhvZAogICAgdmFyIG9yaWdpbmFsID0gYXJyYXlQcm90b1ttZXRob2RdOwogICAgZGVmKGFycmF5TWV0aG9kcywgbWV0aG9kLCBmdW5jdGlvbiBtdXRhdG9yICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKCiAgICAgIHZhciByZXN1bHQgPSBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgdmFyIG9iID0gdGhpcy5fX29iX187CiAgICAgIHZhciBpbnNlcnRlZDsKICAgICAgc3dpdGNoIChtZXRob2QpIHsKICAgICAgICBjYXNlICdwdXNoJzoKICAgICAgICBjYXNlICd1bnNoaWZ0JzoKICAgICAgICAgIGluc2VydGVkID0gYXJnczsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnc3BsaWNlJzoKICAgICAgICAgIGluc2VydGVkID0gYXJncy5zbGljZSgyKTsKICAgICAgICAgIGJyZWFrCiAgICAgIH0KICAgICAgaWYgKGluc2VydGVkKSB7IG9iLm9ic2VydmVBcnJheShpbnNlcnRlZCk7IH0KICAgICAgLy8gbm90aWZ5IGNoYW5nZQogICAgICBvYi5kZXAubm90aWZ5KCk7CiAgICAgIHJldHVybiByZXN1bHQKICAgIH0pOwogIH0pOwoKICAvKiAgKi8KCiAgdmFyIGFycmF5S2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGFycmF5TWV0aG9kcyk7CgogIC8qKgogICAqIEluIHNvbWUgY2FzZXMgd2UgbWF5IHdhbnQgdG8gZGlzYWJsZSBvYnNlcnZhdGlvbiBpbnNpZGUgYSBjb21wb25lbnQncwogICAqIHVwZGF0ZSBjb21wdXRhdGlvbi4KICAgKi8KICB2YXIgc2hvdWxkT2JzZXJ2ZSA9IHRydWU7CgogIGZ1bmN0aW9uIHRvZ2dsZU9ic2VydmluZyAodmFsdWUpIHsKICAgIHNob3VsZE9ic2VydmUgPSB2YWx1ZTsKICB9CgogIC8qKgogICAqIE9ic2VydmVyIGNsYXNzIHRoYXQgaXMgYXR0YWNoZWQgdG8gZWFjaCBvYnNlcnZlZAogICAqIG9iamVjdC4gT25jZSBhdHRhY2hlZCwgdGhlIG9ic2VydmVyIGNvbnZlcnRzIHRoZSB0YXJnZXQKICAgKiBvYmplY3QncyBwcm9wZXJ0eSBrZXlzIGludG8gZ2V0dGVyL3NldHRlcnMgdGhhdAogICAqIGNvbGxlY3QgZGVwZW5kZW5jaWVzIGFuZCBkaXNwYXRjaCB1cGRhdGVzLgogICAqLwogIHZhciBPYnNlcnZlciA9IGZ1bmN0aW9uIE9ic2VydmVyICh2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgdGhpcy5kZXAgPSBuZXcgRGVwKCk7CiAgICB0aGlzLnZtQ291bnQgPSAwOwogICAgZGVmKHZhbHVlLCAnX19vYl9fJywgdGhpcyk7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgaWYgKGhhc1Byb3RvKSB7CiAgICAgICAgcHJvdG9BdWdtZW50KHZhbHVlLCBhcnJheU1ldGhvZHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvcHlBdWdtZW50KHZhbHVlLCBhcnJheU1ldGhvZHMsIGFycmF5S2V5cyk7CiAgICAgIH0KICAgICAgdGhpcy5vYnNlcnZlQXJyYXkodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy53YWxrKHZhbHVlKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBXYWxrIHRocm91Z2ggYWxsIHByb3BlcnRpZXMgYW5kIGNvbnZlcnQgdGhlbSBpbnRvCiAgICogZ2V0dGVyL3NldHRlcnMuIFRoaXMgbWV0aG9kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuCiAgICogdmFsdWUgdHlwZSBpcyBPYmplY3QuCiAgICovCiAgT2JzZXJ2ZXIucHJvdG90eXBlLndhbGsgPSBmdW5jdGlvbiB3YWxrIChvYmopIHsKICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICBkZWZpbmVSZWFjdGl2ZSQkMShvYmosIGtleXNbaV0pOwogICAgfQogIH07CgogIC8qKgogICAqIE9ic2VydmUgYSBsaXN0IG9mIEFycmF5IGl0ZW1zLgogICAqLwogIE9ic2VydmVyLnByb3RvdHlwZS5vYnNlcnZlQXJyYXkgPSBmdW5jdGlvbiBvYnNlcnZlQXJyYXkgKGl0ZW1zKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGl0ZW1zLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBvYnNlcnZlKGl0ZW1zW2ldKTsKICAgIH0KICB9OwoKICAvLyBoZWxwZXJzCgogIC8qKgogICAqIEF1Z21lbnQgYSB0YXJnZXQgT2JqZWN0IG9yIEFycmF5IGJ5IGludGVyY2VwdGluZwogICAqIHRoZSBwcm90b3R5cGUgY2hhaW4gdXNpbmcgX19wcm90b19fCiAgICovCiAgZnVuY3Rpb24gcHJvdG9BdWdtZW50ICh0YXJnZXQsIHNyYykgewogICAgLyogZXNsaW50LWRpc2FibGUgbm8tcHJvdG8gKi8KICAgIHRhcmdldC5fX3Byb3RvX18gPSBzcmM7CiAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXByb3RvICovCiAgfQoKICAvKioKICAgKiBBdWdtZW50IGEgdGFyZ2V0IE9iamVjdCBvciBBcnJheSBieSBkZWZpbmluZwogICAqIGhpZGRlbiBwcm9wZXJ0aWVzLgogICAqLwogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gY29weUF1Z21lbnQgKHRhcmdldCwgc3JjLCBrZXlzKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICBkZWYodGFyZ2V0LCBrZXksIHNyY1trZXldKTsKICAgIH0KICB9CgogIC8qKgogICAqIEF0dGVtcHQgdG8gY3JlYXRlIGFuIG9ic2VydmVyIGluc3RhbmNlIGZvciBhIHZhbHVlLAogICAqIHJldHVybnMgdGhlIG5ldyBvYnNlcnZlciBpZiBzdWNjZXNzZnVsbHkgb2JzZXJ2ZWQsCiAgICogb3IgdGhlIGV4aXN0aW5nIG9ic2VydmVyIGlmIHRoZSB2YWx1ZSBhbHJlYWR5IGhhcyBvbmUuCiAgICovCiAgZnVuY3Rpb24gb2JzZXJ2ZSAodmFsdWUsIGFzUm9vdERhdGEpIHsKICAgIGlmICghaXNPYmplY3QodmFsdWUpIHx8IHZhbHVlIGluc3RhbmNlb2YgVk5vZGUpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgb2I7CiAgICBpZiAoaGFzT3duKHZhbHVlLCAnX19vYl9fJykgJiYgdmFsdWUuX19vYl9fIGluc3RhbmNlb2YgT2JzZXJ2ZXIpIHsKICAgICAgb2IgPSB2YWx1ZS5fX29iX187CiAgICB9IGVsc2UgaWYgKAogICAgICBzaG91bGRPYnNlcnZlICYmCiAgICAgICFpc1NlcnZlclJlbmRlcmluZygpICYmCiAgICAgIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBpc1BsYWluT2JqZWN0KHZhbHVlKSkgJiYKICAgICAgT2JqZWN0LmlzRXh0ZW5zaWJsZSh2YWx1ZSkgJiYKICAgICAgIXZhbHVlLl9pc1Z1ZQogICAgKSB7CiAgICAgIG9iID0gbmV3IE9ic2VydmVyKHZhbHVlKTsKICAgIH0KICAgIGlmIChhc1Jvb3REYXRhICYmIG9iKSB7CiAgICAgIG9iLnZtQ291bnQrKzsKICAgIH0KICAgIHJldHVybiBvYgogIH0KCiAgLyoqCiAgICogRGVmaW5lIGEgcmVhY3RpdmUgcHJvcGVydHkgb24gYW4gT2JqZWN0LgogICAqLwogIGZ1bmN0aW9uIGRlZmluZVJlYWN0aXZlJCQxICgKICAgIG9iaiwKICAgIGtleSwKICAgIHZhbCwKICAgIGN1c3RvbVNldHRlciwKICAgIHNoYWxsb3cKICApIHsKICAgIHZhciBkZXAgPSBuZXcgRGVwKCk7CgogICAgdmFyIHByb3BlcnR5ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSk7CiAgICBpZiAocHJvcGVydHkgJiYgcHJvcGVydHkuY29uZmlndXJhYmxlID09PSBmYWxzZSkgewogICAgICByZXR1cm4KICAgIH0KCiAgICAvLyBjYXRlciBmb3IgcHJlLWRlZmluZWQgZ2V0dGVyL3NldHRlcnMKICAgIHZhciBnZXR0ZXIgPSBwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5nZXQ7CiAgICB2YXIgc2V0dGVyID0gcHJvcGVydHkgJiYgcHJvcGVydHkuc2V0OwogICAgaWYgKCghZ2V0dGVyIHx8IHNldHRlcikgJiYgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICB2YWwgPSBvYmpba2V5XTsKICAgIH0KCiAgICB2YXIgY2hpbGRPYiA9ICFzaGFsbG93ICYmIG9ic2VydmUodmFsKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gcmVhY3RpdmVHZXR0ZXIgKCkgewogICAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWw7CiAgICAgICAgaWYgKERlcC50YXJnZXQpIHsKICAgICAgICAgIGRlcC5kZXBlbmQoKTsKICAgICAgICAgIGlmIChjaGlsZE9iKSB7CiAgICAgICAgICAgIGNoaWxkT2IuZGVwLmRlcGVuZCgpOwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgICAgICBkZXBlbmRBcnJheSh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gcmVhY3RpdmVTZXR0ZXIgKG5ld1ZhbCkgewogICAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWw7CiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tc2VsZi1jb21wYXJlICovCiAgICAgICAgaWYgKG5ld1ZhbCA9PT0gdmFsdWUgfHwgKG5ld1ZhbCAhPT0gbmV3VmFsICYmIHZhbHVlICE9PSB2YWx1ZSkpIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXNlbGYtY29tcGFyZSAqLwogICAgICAgIGlmIChjdXN0b21TZXR0ZXIpIHsKICAgICAgICAgIGN1c3RvbVNldHRlcigpOwogICAgICAgIH0KICAgICAgICAvLyAjNzk4MTogZm9yIGFjY2Vzc29yIHByb3BlcnRpZXMgd2l0aG91dCBzZXR0ZXIKICAgICAgICBpZiAoZ2V0dGVyICYmICFzZXR0ZXIpIHsgcmV0dXJuIH0KICAgICAgICBpZiAoc2V0dGVyKSB7CiAgICAgICAgICBzZXR0ZXIuY2FsbChvYmosIG5ld1ZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbCA9IG5ld1ZhbDsKICAgICAgICB9CiAgICAgICAgY2hpbGRPYiA9ICFzaGFsbG93ICYmIG9ic2VydmUobmV3VmFsKTsKICAgICAgICBkZXAubm90aWZ5KCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLyoqCiAgICogU2V0IGEgcHJvcGVydHkgb24gYW4gb2JqZWN0LiBBZGRzIHRoZSBuZXcgcHJvcGVydHkgYW5kCiAgICogdHJpZ2dlcnMgY2hhbmdlIG5vdGlmaWNhdGlvbiBpZiB0aGUgcHJvcGVydHkgZG9lc24ndAogICAqIGFscmVhZHkgZXhpc3QuCiAgICovCiAgZnVuY3Rpb24gc2V0ICh0YXJnZXQsIGtleSwgdmFsKSB7CiAgICBpZiAoaXNVbmRlZih0YXJnZXQpIHx8IGlzUHJpbWl0aXZlKHRhcmdldCkKICAgICkgewogICAgICB3YXJuKCgiQ2Fubm90IHNldCByZWFjdGl2ZSBwcm9wZXJ0eSBvbiB1bmRlZmluZWQsIG51bGwsIG9yIHByaW1pdGl2ZSB2YWx1ZTogIiArICgodGFyZ2V0KSkpKTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHRhcmdldCkgJiYgaXNWYWxpZEFycmF5SW5kZXgoa2V5KSkgewogICAgICB0YXJnZXQubGVuZ3RoID0gTWF0aC5tYXgodGFyZ2V0Lmxlbmd0aCwga2V5KTsKICAgICAgdGFyZ2V0LnNwbGljZShrZXksIDEsIHZhbCk7CiAgICAgIHJldHVybiB2YWwKICAgIH0KICAgIGlmIChrZXkgaW4gdGFyZ2V0ICYmICEoa2V5IGluIE9iamVjdC5wcm90b3R5cGUpKSB7CiAgICAgIHRhcmdldFtrZXldID0gdmFsOwogICAgICByZXR1cm4gdmFsCiAgICB9CiAgICB2YXIgb2IgPSAodGFyZ2V0KS5fX29iX187CiAgICBpZiAodGFyZ2V0Ll9pc1Z1ZSB8fCAob2IgJiYgb2Iudm1Db3VudCkpIHsKICAgICAgd2FybigKICAgICAgICAnQXZvaWQgYWRkaW5nIHJlYWN0aXZlIHByb3BlcnRpZXMgdG8gYSBWdWUgaW5zdGFuY2Ugb3IgaXRzIHJvb3QgJGRhdGEgJyArCiAgICAgICAgJ2F0IHJ1bnRpbWUgLSBkZWNsYXJlIGl0IHVwZnJvbnQgaW4gdGhlIGRhdGEgb3B0aW9uLicKICAgICAgKTsKICAgICAgcmV0dXJuIHZhbAogICAgfQogICAgaWYgKCFvYikgewogICAgICB0YXJnZXRba2V5XSA9IHZhbDsKICAgICAgcmV0dXJuIHZhbAogICAgfQogICAgZGVmaW5lUmVhY3RpdmUkJDEob2IudmFsdWUsIGtleSwgdmFsKTsKICAgIG9iLmRlcC5ub3RpZnkoKTsKICAgIHJldHVybiB2YWwKICB9CgogIC8qKgogICAqIERlbGV0ZSBhIHByb3BlcnR5IGFuZCB0cmlnZ2VyIGNoYW5nZSBpZiBuZWNlc3NhcnkuCiAgICovCiAgZnVuY3Rpb24gZGVsICh0YXJnZXQsIGtleSkgewogICAgaWYgKGlzVW5kZWYodGFyZ2V0KSB8fCBpc1ByaW1pdGl2ZSh0YXJnZXQpCiAgICApIHsKICAgICAgd2FybigoIkNhbm5vdCBkZWxldGUgcmVhY3RpdmUgcHJvcGVydHkgb24gdW5kZWZpbmVkLCBudWxsLCBvciBwcmltaXRpdmUgdmFsdWU6ICIgKyAoKHRhcmdldCkpKSk7CiAgICB9CiAgICBpZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpICYmIGlzVmFsaWRBcnJheUluZGV4KGtleSkpIHsKICAgICAgdGFyZ2V0LnNwbGljZShrZXksIDEpOwogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBvYiA9ICh0YXJnZXQpLl9fb2JfXzsKICAgIGlmICh0YXJnZXQuX2lzVnVlIHx8IChvYiAmJiBvYi52bUNvdW50KSkgewogICAgICB3YXJuKAogICAgICAgICdBdm9pZCBkZWxldGluZyBwcm9wZXJ0aWVzIG9uIGEgVnVlIGluc3RhbmNlIG9yIGl0cyByb290ICRkYXRhICcgKwogICAgICAgICctIGp1c3Qgc2V0IGl0IHRvIG51bGwuJwogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIGlmICghaGFzT3duKHRhcmdldCwga2V5KSkgewogICAgICByZXR1cm4KICAgIH0KICAgIGRlbGV0ZSB0YXJnZXRba2V5XTsKICAgIGlmICghb2IpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICBvYi5kZXAubm90aWZ5KCk7CiAgfQoKICAvKioKICAgKiBDb2xsZWN0IGRlcGVuZGVuY2llcyBvbiBhcnJheSBlbGVtZW50cyB3aGVuIHRoZSBhcnJheSBpcyB0b3VjaGVkLCBzaW5jZQogICAqIHdlIGNhbm5vdCBpbnRlcmNlcHQgYXJyYXkgZWxlbWVudCBhY2Nlc3MgbGlrZSBwcm9wZXJ0eSBnZXR0ZXJzLgogICAqLwogIGZ1bmN0aW9uIGRlcGVuZEFycmF5ICh2YWx1ZSkgewogICAgZm9yICh2YXIgZSA9ICh2b2lkIDApLCBpID0gMCwgbCA9IHZhbHVlLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBlID0gdmFsdWVbaV07CiAgICAgIGUgJiYgZS5fX29iX18gJiYgZS5fX29iX18uZGVwLmRlcGVuZCgpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShlKSkgewogICAgICAgIGRlcGVuZEFycmF5KGUpOwogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogT3B0aW9uIG92ZXJ3cml0aW5nIHN0cmF0ZWdpZXMgYXJlIGZ1bmN0aW9ucyB0aGF0IGhhbmRsZQogICAqIGhvdyB0byBtZXJnZSBhIHBhcmVudCBvcHRpb24gdmFsdWUgYW5kIGEgY2hpbGQgb3B0aW9uCiAgICogdmFsdWUgaW50byB0aGUgZmluYWwgdmFsdWUuCiAgICovCiAgdmFyIHN0cmF0cyA9IGNvbmZpZy5vcHRpb25NZXJnZVN0cmF0ZWdpZXM7CgogIC8qKgogICAqIE9wdGlvbnMgd2l0aCByZXN0cmljdGlvbnMKICAgKi8KICB7CiAgICBzdHJhdHMuZWwgPSBzdHJhdHMucHJvcHNEYXRhID0gZnVuY3Rpb24gKHBhcmVudCwgY2hpbGQsIHZtLCBrZXkpIHsKICAgICAgaWYgKCF2bSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAib3B0aW9uIFwiIiArIGtleSArICJcIiBjYW4gb25seSBiZSB1c2VkIGR1cmluZyBpbnN0YW5jZSAiICsKICAgICAgICAgICdjcmVhdGlvbiB3aXRoIHRoZSBgbmV3YCBrZXl3b3JkLicKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiBkZWZhdWx0U3RyYXQocGFyZW50LCBjaGlsZCkKICAgIH07CiAgfQoKICAvKioKICAgKiBIZWxwZXIgdGhhdCByZWN1cnNpdmVseSBtZXJnZXMgdHdvIGRhdGEgb2JqZWN0cyB0b2dldGhlci4KICAgKi8KICBmdW5jdGlvbiBtZXJnZURhdGEgKHRvLCBmcm9tKSB7CiAgICBpZiAoIWZyb20pIHsgcmV0dXJuIHRvIH0KICAgIHZhciBrZXksIHRvVmFsLCBmcm9tVmFsOwoKICAgIHZhciBrZXlzID0gaGFzU3ltYm9sCiAgICAgID8gUmVmbGVjdC5vd25LZXlzKGZyb20pCiAgICAgIDogT2JqZWN0LmtleXMoZnJvbSk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGtleSA9IGtleXNbaV07CiAgICAgIC8vIGluIGNhc2UgdGhlIG9iamVjdCBpcyBhbHJlYWR5IG9ic2VydmVkLi4uCiAgICAgIGlmIChrZXkgPT09ICdfX29iX18nKSB7IGNvbnRpbnVlIH0KICAgICAgdG9WYWwgPSB0b1trZXldOwogICAgICBmcm9tVmFsID0gZnJvbVtrZXldOwogICAgICBpZiAoIWhhc093bih0bywga2V5KSkgewogICAgICAgIHNldCh0bywga2V5LCBmcm9tVmFsKTsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB0b1ZhbCAhPT0gZnJvbVZhbCAmJgogICAgICAgIGlzUGxhaW5PYmplY3QodG9WYWwpICYmCiAgICAgICAgaXNQbGFpbk9iamVjdChmcm9tVmFsKQogICAgICApIHsKICAgICAgICBtZXJnZURhdGEodG9WYWwsIGZyb21WYWwpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdG8KICB9CgogIC8qKgogICAqIERhdGEKICAgKi8KICBmdW5jdGlvbiBtZXJnZURhdGFPckZuICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0KICApIHsKICAgIGlmICghdm0pIHsKICAgICAgLy8gaW4gYSBWdWUuZXh0ZW5kIG1lcmdlLCBib3RoIHNob3VsZCBiZSBmdW5jdGlvbnMKICAgICAgaWYgKCFjaGlsZFZhbCkgewogICAgICAgIHJldHVybiBwYXJlbnRWYWwKICAgICAgfQogICAgICBpZiAoIXBhcmVudFZhbCkgewogICAgICAgIHJldHVybiBjaGlsZFZhbAogICAgICB9CiAgICAgIC8vIHdoZW4gcGFyZW50VmFsICYgY2hpbGRWYWwgYXJlIGJvdGggcHJlc2VudCwKICAgICAgLy8gd2UgbmVlZCB0byByZXR1cm4gYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlCiAgICAgIC8vIG1lcmdlZCByZXN1bHQgb2YgYm90aCBmdW5jdGlvbnMuLi4gbm8gbmVlZCB0bwogICAgICAvLyBjaGVjayBpZiBwYXJlbnRWYWwgaXMgYSBmdW5jdGlvbiBoZXJlIGJlY2F1c2UKICAgICAgLy8gaXQgaGFzIHRvIGJlIGEgZnVuY3Rpb24gdG8gcGFzcyBwcmV2aW91cyBtZXJnZXMuCiAgICAgIHJldHVybiBmdW5jdGlvbiBtZXJnZWREYXRhRm4gKCkgewogICAgICAgIHJldHVybiBtZXJnZURhdGEoCiAgICAgICAgICB0eXBlb2YgY2hpbGRWYWwgPT09ICdmdW5jdGlvbicgPyBjaGlsZFZhbC5jYWxsKHRoaXMsIHRoaXMpIDogY2hpbGRWYWwsCiAgICAgICAgICB0eXBlb2YgcGFyZW50VmFsID09PSAnZnVuY3Rpb24nID8gcGFyZW50VmFsLmNhbGwodGhpcywgdGhpcykgOiBwYXJlbnRWYWwKICAgICAgICApCiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiBtZXJnZWRJbnN0YW5jZURhdGFGbiAoKSB7CiAgICAgICAgLy8gaW5zdGFuY2UgbWVyZ2UKICAgICAgICB2YXIgaW5zdGFuY2VEYXRhID0gdHlwZW9mIGNoaWxkVmFsID09PSAnZnVuY3Rpb24nCiAgICAgICAgICA/IGNoaWxkVmFsLmNhbGwodm0sIHZtKQogICAgICAgICAgOiBjaGlsZFZhbDsKICAgICAgICB2YXIgZGVmYXVsdERhdGEgPSB0eXBlb2YgcGFyZW50VmFsID09PSAnZnVuY3Rpb24nCiAgICAgICAgICA/IHBhcmVudFZhbC5jYWxsKHZtLCB2bSkKICAgICAgICAgIDogcGFyZW50VmFsOwogICAgICAgIGlmIChpbnN0YW5jZURhdGEpIHsKICAgICAgICAgIHJldHVybiBtZXJnZURhdGEoaW5zdGFuY2VEYXRhLCBkZWZhdWx0RGF0YSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGRlZmF1bHREYXRhCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBzdHJhdHMuZGF0YSA9IGZ1bmN0aW9uICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0KICApIHsKICAgIGlmICghdm0pIHsKICAgICAgaWYgKGNoaWxkVmFsICYmIHR5cGVvZiBjaGlsZFZhbCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHdhcm4oCiAgICAgICAgICAnVGhlICJkYXRhIiBvcHRpb24gc2hvdWxkIGJlIGEgZnVuY3Rpb24gJyArCiAgICAgICAgICAndGhhdCByZXR1cm5zIGEgcGVyLWluc3RhbmNlIHZhbHVlIGluIGNvbXBvbmVudCAnICsKICAgICAgICAgICdkZWZpbml0aW9ucy4nLAogICAgICAgICAgdm0KICAgICAgICApOwoKICAgICAgICByZXR1cm4gcGFyZW50VmFsCiAgICAgIH0KICAgICAgcmV0dXJuIG1lcmdlRGF0YU9yRm4ocGFyZW50VmFsLCBjaGlsZFZhbCkKICAgIH0KCiAgICByZXR1cm4gbWVyZ2VEYXRhT3JGbihwYXJlbnRWYWwsIGNoaWxkVmFsLCB2bSkKICB9OwoKICAvKioKICAgKiBIb29rcyBhbmQgcHJvcHMgYXJlIG1lcmdlZCBhcyBhcnJheXMuCiAgICovCiAgZnVuY3Rpb24gbWVyZ2VIb29rICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsCiAgKSB7CiAgICB2YXIgcmVzID0gY2hpbGRWYWwKICAgICAgPyBwYXJlbnRWYWwKICAgICAgICA/IHBhcmVudFZhbC5jb25jYXQoY2hpbGRWYWwpCiAgICAgICAgOiBBcnJheS5pc0FycmF5KGNoaWxkVmFsKQogICAgICAgICAgPyBjaGlsZFZhbAogICAgICAgICAgOiBbY2hpbGRWYWxdCiAgICAgIDogcGFyZW50VmFsOwogICAgcmV0dXJuIHJlcwogICAgICA/IGRlZHVwZUhvb2tzKHJlcykKICAgICAgOiByZXMKICB9CgogIGZ1bmN0aW9uIGRlZHVwZUhvb2tzIChob29rcykgewogICAgdmFyIHJlcyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAocmVzLmluZGV4T2YoaG9va3NbaV0pID09PSAtMSkgewogICAgICAgIHJlcy5wdXNoKGhvb2tzW2ldKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgTElGRUNZQ0xFX0hPT0tTLmZvckVhY2goZnVuY3Rpb24gKGhvb2spIHsKICAgIHN0cmF0c1tob29rXSA9IG1lcmdlSG9vazsKICB9KTsKCiAgLyoqCiAgICogQXNzZXRzCiAgICoKICAgKiBXaGVuIGEgdm0gaXMgcHJlc2VudCAoaW5zdGFuY2UgY3JlYXRpb24pLCB3ZSBuZWVkIHRvIGRvCiAgICogYSB0aHJlZS13YXkgbWVyZ2UgYmV0d2VlbiBjb25zdHJ1Y3RvciBvcHRpb25zLCBpbnN0YW5jZQogICAqIG9wdGlvbnMgYW5kIHBhcmVudCBvcHRpb25zLgogICAqLwogIGZ1bmN0aW9uIG1lcmdlQXNzZXRzICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0sCiAgICBrZXkKICApIHsKICAgIHZhciByZXMgPSBPYmplY3QuY3JlYXRlKHBhcmVudFZhbCB8fCBudWxsKTsKICAgIGlmIChjaGlsZFZhbCkgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgICAgcmV0dXJuIGV4dGVuZChyZXMsIGNoaWxkVmFsKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHJlcwogICAgfQogIH0KCiAgQVNTRVRfVFlQRVMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgc3RyYXRzW3R5cGUgKyAncyddID0gbWVyZ2VBc3NldHM7CiAgfSk7CgogIC8qKgogICAqIFdhdGNoZXJzLgogICAqCiAgICogV2F0Y2hlcnMgaGFzaGVzIHNob3VsZCBub3Qgb3ZlcndyaXRlIG9uZQogICAqIGFub3RoZXIsIHNvIHdlIG1lcmdlIHRoZW0gYXMgYXJyYXlzLgogICAqLwogIHN0cmF0cy53YXRjaCA9IGZ1bmN0aW9uICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0sCiAgICBrZXkKICApIHsKICAgIC8vIHdvcmsgYXJvdW5kIEZpcmVmb3gncyBPYmplY3QucHJvdG90eXBlLndhdGNoLi4uCiAgICBpZiAocGFyZW50VmFsID09PSBuYXRpdmVXYXRjaCkgeyBwYXJlbnRWYWwgPSB1bmRlZmluZWQ7IH0KICAgIGlmIChjaGlsZFZhbCA9PT0gbmF0aXZlV2F0Y2gpIHsgY2hpbGRWYWwgPSB1bmRlZmluZWQ7IH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKCFjaGlsZFZhbCkgeyByZXR1cm4gT2JqZWN0LmNyZWF0ZShwYXJlbnRWYWwgfHwgbnVsbCkgfQogICAgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgIH0KICAgIGlmICghcGFyZW50VmFsKSB7IHJldHVybiBjaGlsZFZhbCB9CiAgICB2YXIgcmV0ID0ge307CiAgICBleHRlbmQocmV0LCBwYXJlbnRWYWwpOwogICAgZm9yICh2YXIga2V5JDEgaW4gY2hpbGRWYWwpIHsKICAgICAgdmFyIHBhcmVudCA9IHJldFtrZXkkMV07CiAgICAgIHZhciBjaGlsZCA9IGNoaWxkVmFsW2tleSQxXTsKICAgICAgaWYgKHBhcmVudCAmJiAhQXJyYXkuaXNBcnJheShwYXJlbnQpKSB7CiAgICAgICAgcGFyZW50ID0gW3BhcmVudF07CiAgICAgIH0KICAgICAgcmV0W2tleSQxXSA9IHBhcmVudAogICAgICAgID8gcGFyZW50LmNvbmNhdChjaGlsZCkKICAgICAgICA6IEFycmF5LmlzQXJyYXkoY2hpbGQpID8gY2hpbGQgOiBbY2hpbGRdOwogICAgfQogICAgcmV0dXJuIHJldAogIH07CgogIC8qKgogICAqIE90aGVyIG9iamVjdCBoYXNoZXMuCiAgICovCiAgc3RyYXRzLnByb3BzID0KICBzdHJhdHMubWV0aG9kcyA9CiAgc3RyYXRzLmluamVjdCA9CiAgc3RyYXRzLmNvbXB1dGVkID0gZnVuY3Rpb24gKAogICAgcGFyZW50VmFsLAogICAgY2hpbGRWYWwsCiAgICB2bSwKICAgIGtleQogICkgewogICAgaWYgKGNoaWxkVmFsICYmICJkZXZlbG9wbWVudCIgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgIH0KICAgIGlmICghcGFyZW50VmFsKSB7IHJldHVybiBjaGlsZFZhbCB9CiAgICB2YXIgcmV0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGV4dGVuZChyZXQsIHBhcmVudFZhbCk7CiAgICBpZiAoY2hpbGRWYWwpIHsgZXh0ZW5kKHJldCwgY2hpbGRWYWwpOyB9CiAgICByZXR1cm4gcmV0CiAgfTsKICBzdHJhdHMucHJvdmlkZSA9IG1lcmdlRGF0YU9yRm47CgogIC8qKgogICAqIERlZmF1bHQgc3RyYXRlZ3kuCiAgICovCiAgdmFyIGRlZmF1bHRTdHJhdCA9IGZ1bmN0aW9uIChwYXJlbnRWYWwsIGNoaWxkVmFsKSB7CiAgICByZXR1cm4gY2hpbGRWYWwgPT09IHVuZGVmaW5lZAogICAgICA/IHBhcmVudFZhbAogICAgICA6IGNoaWxkVmFsCiAgfTsKCiAgLyoqCiAgICogVmFsaWRhdGUgY29tcG9uZW50IG5hbWVzCiAgICovCiAgZnVuY3Rpb24gY2hlY2tDb21wb25lbnRzIChvcHRpb25zKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gb3B0aW9ucy5jb21wb25lbnRzKSB7CiAgICAgIHZhbGlkYXRlQ29tcG9uZW50TmFtZShrZXkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdmFsaWRhdGVDb21wb25lbnROYW1lIChuYW1lKSB7CiAgICBpZiAoIW5ldyBSZWdFeHAoKCJeW2EtekEtWl1bXFwtXFwuMC05XyIgKyAodW5pY29kZVJlZ0V4cC5zb3VyY2UpICsgIl0qJCIpKS50ZXN0KG5hbWUpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgJ0ludmFsaWQgY29tcG9uZW50IG5hbWU6ICInICsgbmFtZSArICciLiBDb21wb25lbnQgbmFtZXMgJyArCiAgICAgICAgJ3Nob3VsZCBjb25mb3JtIHRvIHZhbGlkIGN1c3RvbSBlbGVtZW50IG5hbWUgaW4gaHRtbDUgc3BlY2lmaWNhdGlvbi4nCiAgICAgICk7CiAgICB9CiAgICBpZiAoaXNCdWlsdEluVGFnKG5hbWUpIHx8IGNvbmZpZy5pc1Jlc2VydmVkVGFnKG5hbWUpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgJ0RvIG5vdCB1c2UgYnVpbHQtaW4gb3IgcmVzZXJ2ZWQgSFRNTCBlbGVtZW50cyBhcyBjb21wb25lbnQgJyArCiAgICAgICAgJ2lkOiAnICsgbmFtZQogICAgICApOwogICAgfQogIH0KCiAgLyoqCiAgICogRW5zdXJlIGFsbCBwcm9wcyBvcHRpb24gc3ludGF4IGFyZSBub3JtYWxpemVkIGludG8gdGhlCiAgICogT2JqZWN0LWJhc2VkIGZvcm1hdC4KICAgKi8KICBmdW5jdGlvbiBub3JtYWxpemVQcm9wcyAob3B0aW9ucywgdm0pIHsKICAgIHZhciBwcm9wcyA9IG9wdGlvbnMucHJvcHM7CiAgICBpZiAoIXByb3BzKSB7IHJldHVybiB9CiAgICB2YXIgcmVzID0ge307CiAgICB2YXIgaSwgdmFsLCBuYW1lOwogICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcHMpKSB7CiAgICAgIGkgPSBwcm9wcy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2YWwgPSBwcm9wc1tpXTsKICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIG5hbWUgPSBjYW1lbGl6ZSh2YWwpOwogICAgICAgICAgcmVzW25hbWVdID0geyB0eXBlOiBudWxsIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdhcm4oJ3Byb3BzIG11c3QgYmUgc3RyaW5ncyB3aGVuIHVzaW5nIGFycmF5IHN5bnRheC4nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChwcm9wcykpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHByb3BzKSB7CiAgICAgICAgdmFsID0gcHJvcHNba2V5XTsKICAgICAgICBuYW1lID0gY2FtZWxpemUoa2V5KTsKICAgICAgICByZXNbbmFtZV0gPSBpc1BsYWluT2JqZWN0KHZhbCkKICAgICAgICAgID8gdmFsCiAgICAgICAgICA6IHsgdHlwZTogdmFsIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkludmFsaWQgdmFsdWUgZm9yIG9wdGlvbiBcInByb3BzXCI6IGV4cGVjdGVkIGFuIEFycmF5IG9yIGFuIE9iamVjdCwgIiArCiAgICAgICAgImJ1dCBnb3QgIiArICh0b1Jhd1R5cGUocHJvcHMpKSArICIuIiwKICAgICAgICB2bQogICAgICApOwogICAgfQogICAgb3B0aW9ucy5wcm9wcyA9IHJlczsKICB9CgogIC8qKgogICAqIE5vcm1hbGl6ZSBhbGwgaW5qZWN0aW9ucyBpbnRvIE9iamVjdC1iYXNlZCBmb3JtYXQKICAgKi8KICBmdW5jdGlvbiBub3JtYWxpemVJbmplY3QgKG9wdGlvbnMsIHZtKSB7CiAgICB2YXIgaW5qZWN0ID0gb3B0aW9ucy5pbmplY3Q7CiAgICBpZiAoIWluamVjdCkgeyByZXR1cm4gfQogICAgdmFyIG5vcm1hbGl6ZWQgPSBvcHRpb25zLmluamVjdCA9IHt9OwogICAgaWYgKEFycmF5LmlzQXJyYXkoaW5qZWN0KSkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluamVjdC5sZW5ndGg7IGkrKykgewogICAgICAgIG5vcm1hbGl6ZWRbaW5qZWN0W2ldXSA9IHsgZnJvbTogaW5qZWN0W2ldIH07CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChpbmplY3QpKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBpbmplY3QpIHsKICAgICAgICB2YXIgdmFsID0gaW5qZWN0W2tleV07CiAgICAgICAgbm9ybWFsaXplZFtrZXldID0gaXNQbGFpbk9iamVjdCh2YWwpCiAgICAgICAgICA/IGV4dGVuZCh7IGZyb206IGtleSB9LCB2YWwpCiAgICAgICAgICA6IHsgZnJvbTogdmFsIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkludmFsaWQgdmFsdWUgZm9yIG9wdGlvbiBcImluamVjdFwiOiBleHBlY3RlZCBhbiBBcnJheSBvciBhbiBPYmplY3QsICIgKwogICAgICAgICJidXQgZ290ICIgKyAodG9SYXdUeXBlKGluamVjdCkpICsgIi4iLAogICAgICAgIHZtCiAgICAgICk7CiAgICB9CiAgfQoKICAvKioKICAgKiBOb3JtYWxpemUgcmF3IGZ1bmN0aW9uIGRpcmVjdGl2ZXMgaW50byBvYmplY3QgZm9ybWF0LgogICAqLwogIGZ1bmN0aW9uIG5vcm1hbGl6ZURpcmVjdGl2ZXMgKG9wdGlvbnMpIHsKICAgIHZhciBkaXJzID0gb3B0aW9ucy5kaXJlY3RpdmVzOwogICAgaWYgKGRpcnMpIHsKICAgICAgZm9yICh2YXIga2V5IGluIGRpcnMpIHsKICAgICAgICB2YXIgZGVmJCQxID0gZGlyc1trZXldOwogICAgICAgIGlmICh0eXBlb2YgZGVmJCQxID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBkaXJzW2tleV0gPSB7IGJpbmQ6IGRlZiQkMSwgdXBkYXRlOiBkZWYkJDEgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFzc2VydE9iamVjdFR5cGUgKG5hbWUsIHZhbHVlLCB2bSkgewogICAgaWYgKCFpc1BsYWluT2JqZWN0KHZhbHVlKSkgewogICAgICB3YXJuKAogICAgICAgICJJbnZhbGlkIHZhbHVlIGZvciBvcHRpb24gXCIiICsgbmFtZSArICJcIjogZXhwZWN0ZWQgYW4gT2JqZWN0LCAiICsKICAgICAgICAiYnV0IGdvdCAiICsgKHRvUmF3VHlwZSh2YWx1ZSkpICsgIi4iLAogICAgICAgIHZtCiAgICAgICk7CiAgICB9CiAgfQoKICAvKioKICAgKiBNZXJnZSB0d28gb3B0aW9uIG9iamVjdHMgaW50byBhIG5ldyBvbmUuCiAgICogQ29yZSB1dGlsaXR5IHVzZWQgaW4gYm90aCBpbnN0YW50aWF0aW9uIGFuZCBpbmhlcml0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBtZXJnZU9wdGlvbnMgKAogICAgcGFyZW50LAogICAgY2hpbGQsCiAgICB2bQogICkgewogICAgewogICAgICBjaGVja0NvbXBvbmVudHMoY2hpbGQpOwogICAgfQoKICAgIGlmICh0eXBlb2YgY2hpbGQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgY2hpbGQgPSBjaGlsZC5vcHRpb25zOwogICAgfQoKICAgIG5vcm1hbGl6ZVByb3BzKGNoaWxkLCB2bSk7CiAgICBub3JtYWxpemVJbmplY3QoY2hpbGQsIHZtKTsKICAgIG5vcm1hbGl6ZURpcmVjdGl2ZXMoY2hpbGQpOwoKICAgIC8vIEFwcGx5IGV4dGVuZHMgYW5kIG1peGlucyBvbiB0aGUgY2hpbGQgb3B0aW9ucywKICAgIC8vIGJ1dCBvbmx5IGlmIGl0IGlzIGEgcmF3IG9wdGlvbnMgb2JqZWN0IHRoYXQgaXNuJ3QKICAgIC8vIHRoZSByZXN1bHQgb2YgYW5vdGhlciBtZXJnZU9wdGlvbnMgY2FsbC4KICAgIC8vIE9ubHkgbWVyZ2VkIG9wdGlvbnMgaGFzIHRoZSBfYmFzZSBwcm9wZXJ0eS4KICAgIGlmICghY2hpbGQuX2Jhc2UpIHsKICAgICAgaWYgKGNoaWxkLmV4dGVuZHMpIHsKICAgICAgICBwYXJlbnQgPSBtZXJnZU9wdGlvbnMocGFyZW50LCBjaGlsZC5leHRlbmRzLCB2bSk7CiAgICAgIH0KICAgICAgaWYgKGNoaWxkLm1peGlucykgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2hpbGQubWl4aW5zLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgcGFyZW50ID0gbWVyZ2VPcHRpb25zKHBhcmVudCwgY2hpbGQubWl4aW5zW2ldLCB2bSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIG9wdGlvbnMgPSB7fTsKICAgIHZhciBrZXk7CiAgICBmb3IgKGtleSBpbiBwYXJlbnQpIHsKICAgICAgbWVyZ2VGaWVsZChrZXkpOwogICAgfQogICAgZm9yIChrZXkgaW4gY2hpbGQpIHsKICAgICAgaWYgKCFoYXNPd24ocGFyZW50LCBrZXkpKSB7CiAgICAgICAgbWVyZ2VGaWVsZChrZXkpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBtZXJnZUZpZWxkIChrZXkpIHsKICAgICAgdmFyIHN0cmF0ID0gc3RyYXRzW2tleV0gfHwgZGVmYXVsdFN0cmF0OwogICAgICBvcHRpb25zW2tleV0gPSBzdHJhdChwYXJlbnRba2V5XSwgY2hpbGRba2V5XSwgdm0sIGtleSk7CiAgICB9CiAgICByZXR1cm4gb3B0aW9ucwogIH0KCiAgLyoqCiAgICogUmVzb2x2ZSBhbiBhc3NldC4KICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgYmVjYXVzZSBjaGlsZCBpbnN0YW5jZXMgbmVlZCBhY2Nlc3MKICAgKiB0byBhc3NldHMgZGVmaW5lZCBpbiBpdHMgYW5jZXN0b3IgY2hhaW4uCiAgICovCiAgZnVuY3Rpb24gcmVzb2x2ZUFzc2V0ICgKICAgIG9wdGlvbnMsCiAgICB0eXBlLAogICAgaWQsCiAgICB3YXJuTWlzc2luZwogICkgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAodHlwZW9mIGlkICE9PSAnc3RyaW5nJykgewogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBhc3NldHMgPSBvcHRpb25zW3R5cGVdOwogICAgLy8gY2hlY2sgbG9jYWwgcmVnaXN0cmF0aW9uIHZhcmlhdGlvbnMgZmlyc3QKICAgIGlmIChoYXNPd24oYXNzZXRzLCBpZCkpIHsgcmV0dXJuIGFzc2V0c1tpZF0gfQogICAgdmFyIGNhbWVsaXplZElkID0gY2FtZWxpemUoaWQpOwogICAgaWYgKGhhc093bihhc3NldHMsIGNhbWVsaXplZElkKSkgeyByZXR1cm4gYXNzZXRzW2NhbWVsaXplZElkXSB9CiAgICB2YXIgUGFzY2FsQ2FzZUlkID0gY2FwaXRhbGl6ZShjYW1lbGl6ZWRJZCk7CiAgICBpZiAoaGFzT3duKGFzc2V0cywgUGFzY2FsQ2FzZUlkKSkgeyByZXR1cm4gYXNzZXRzW1Bhc2NhbENhc2VJZF0gfQogICAgLy8gZmFsbGJhY2sgdG8gcHJvdG90eXBlIGNoYWluCiAgICB2YXIgcmVzID0gYXNzZXRzW2lkXSB8fCBhc3NldHNbY2FtZWxpemVkSWRdIHx8IGFzc2V0c1tQYXNjYWxDYXNlSWRdOwogICAgaWYgKHdhcm5NaXNzaW5nICYmICFyZXMpIHsKICAgICAgd2FybigKICAgICAgICAnRmFpbGVkIHRvIHJlc29sdmUgJyArIHR5cGUuc2xpY2UoMCwgLTEpICsgJzogJyArIGlkLAogICAgICAgIG9wdGlvbnMKICAgICAgKTsKICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIC8qICAqLwoKCgogIGZ1bmN0aW9uIHZhbGlkYXRlUHJvcCAoCiAgICBrZXksCiAgICBwcm9wT3B0aW9ucywKICAgIHByb3BzRGF0YSwKICAgIHZtCiAgKSB7CiAgICB2YXIgcHJvcCA9IHByb3BPcHRpb25zW2tleV07CiAgICB2YXIgYWJzZW50ID0gIWhhc093bihwcm9wc0RhdGEsIGtleSk7CiAgICB2YXIgdmFsdWUgPSBwcm9wc0RhdGFba2V5XTsKICAgIC8vIGJvb2xlYW4gY2FzdGluZwogICAgdmFyIGJvb2xlYW5JbmRleCA9IGdldFR5cGVJbmRleChCb29sZWFuLCBwcm9wLnR5cGUpOwogICAgaWYgKGJvb2xlYW5JbmRleCA+IC0xKSB7CiAgICAgIGlmIChhYnNlbnQgJiYgIWhhc093bihwcm9wLCAnZGVmYXVsdCcpKSB7CiAgICAgICAgdmFsdWUgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IGh5cGhlbmF0ZShrZXkpKSB7CiAgICAgICAgLy8gb25seSBjYXN0IGVtcHR5IHN0cmluZyAvIHNhbWUgbmFtZSB0byBib29sZWFuIGlmCiAgICAgICAgLy8gYm9vbGVhbiBoYXMgaGlnaGVyIHByaW9yaXR5CiAgICAgICAgdmFyIHN0cmluZ0luZGV4ID0gZ2V0VHlwZUluZGV4KFN0cmluZywgcHJvcC50eXBlKTsKICAgICAgICBpZiAoc3RyaW5nSW5kZXggPCAwIHx8IGJvb2xlYW5JbmRleCA8IHN0cmluZ0luZGV4KSB7CiAgICAgICAgICB2YWx1ZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyBjaGVjayBkZWZhdWx0IHZhbHVlCiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IGdldFByb3BEZWZhdWx0VmFsdWUodm0sIHByb3AsIGtleSk7CiAgICAgIC8vIHNpbmNlIHRoZSBkZWZhdWx0IHZhbHVlIGlzIGEgZnJlc2ggY29weSwKICAgICAgLy8gbWFrZSBzdXJlIHRvIG9ic2VydmUgaXQuCiAgICAgIHZhciBwcmV2U2hvdWxkT2JzZXJ2ZSA9IHNob3VsZE9ic2VydmU7CiAgICAgIHRvZ2dsZU9ic2VydmluZyh0cnVlKTsKICAgICAgb2JzZXJ2ZSh2YWx1ZSk7CiAgICAgIHRvZ2dsZU9ic2VydmluZyhwcmV2U2hvdWxkT2JzZXJ2ZSk7CiAgICB9CiAgICB7CiAgICAgIGFzc2VydFByb3AocHJvcCwga2V5LCB2YWx1ZSwgdm0sIGFic2VudCk7CiAgICB9CiAgICByZXR1cm4gdmFsdWUKICB9CgogIC8qKgogICAqIEdldCB0aGUgZGVmYXVsdCB2YWx1ZSBvZiBhIHByb3AuCiAgICovCiAgZnVuY3Rpb24gZ2V0UHJvcERlZmF1bHRWYWx1ZSAodm0sIHByb3AsIGtleSkgewogICAgLy8gbm8gZGVmYXVsdCwgcmV0dXJuIHVuZGVmaW5lZAogICAgaWYgKCFoYXNPd24ocHJvcCwgJ2RlZmF1bHQnKSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICB9CiAgICB2YXIgZGVmID0gcHJvcC5kZWZhdWx0OwogICAgLy8gd2FybiBhZ2FpbnN0IG5vbi1mYWN0b3J5IGRlZmF1bHRzIGZvciBPYmplY3QgJiBBcnJheQogICAgaWYgKGlzT2JqZWN0KGRlZikpIHsKICAgICAgd2FybigKICAgICAgICAnSW52YWxpZCBkZWZhdWx0IHZhbHVlIGZvciBwcm9wICInICsga2V5ICsgJyI6ICcgKwogICAgICAgICdQcm9wcyB3aXRoIHR5cGUgT2JqZWN0L0FycmF5IG11c3QgdXNlIGEgZmFjdG9yeSBmdW5jdGlvbiAnICsKICAgICAgICAndG8gcmV0dXJuIHRoZSBkZWZhdWx0IHZhbHVlLicsCiAgICAgICAgdm0KICAgICAgKTsKICAgIH0KICAgIC8vIHRoZSByYXcgcHJvcCB2YWx1ZSB3YXMgYWxzbyB1bmRlZmluZWQgZnJvbSBwcmV2aW91cyByZW5kZXIsCiAgICAvLyByZXR1cm4gcHJldmlvdXMgZGVmYXVsdCB2YWx1ZSB0byBhdm9pZCB1bm5lY2Vzc2FyeSB3YXRjaGVyIHRyaWdnZXIKICAgIGlmICh2bSAmJiB2bS4kb3B0aW9ucy5wcm9wc0RhdGEgJiYKICAgICAgdm0uJG9wdGlvbnMucHJvcHNEYXRhW2tleV0gPT09IHVuZGVmaW5lZCAmJgogICAgICB2bS5fcHJvcHNba2V5XSAhPT0gdW5kZWZpbmVkCiAgICApIHsKICAgICAgcmV0dXJuIHZtLl9wcm9wc1trZXldCiAgICB9CiAgICAvLyBjYWxsIGZhY3RvcnkgZnVuY3Rpb24gZm9yIG5vbi1GdW5jdGlvbiB0eXBlcwogICAgLy8gYSB2YWx1ZSBpcyBGdW5jdGlvbiBpZiBpdHMgcHJvdG90eXBlIGlzIGZ1bmN0aW9uIGV2ZW4gYWNyb3NzIGRpZmZlcmVudCBleGVjdXRpb24gY29udGV4dAogICAgcmV0dXJuIHR5cGVvZiBkZWYgPT09ICdmdW5jdGlvbicgJiYgZ2V0VHlwZShwcm9wLnR5cGUpICE9PSAnRnVuY3Rpb24nCiAgICAgID8gZGVmLmNhbGwodm0pCiAgICAgIDogZGVmCiAgfQoKICAvKioKICAgKiBBc3NlcnQgd2hldGhlciBhIHByb3AgaXMgdmFsaWQuCiAgICovCiAgZnVuY3Rpb24gYXNzZXJ0UHJvcCAoCiAgICBwcm9wLAogICAgbmFtZSwKICAgIHZhbHVlLAogICAgdm0sCiAgICBhYnNlbnQKICApIHsKICAgIGlmIChwcm9wLnJlcXVpcmVkICYmIGFic2VudCkgewogICAgICB3YXJuKAogICAgICAgICdNaXNzaW5nIHJlcXVpcmVkIHByb3A6ICInICsgbmFtZSArICciJywKICAgICAgICB2bQogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIGlmICh2YWx1ZSA9PSBudWxsICYmICFwcm9wLnJlcXVpcmVkKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIHR5cGUgPSBwcm9wLnR5cGU7CiAgICB2YXIgdmFsaWQgPSAhdHlwZSB8fCB0eXBlID09PSB0cnVlOwogICAgdmFyIGV4cGVjdGVkVHlwZXMgPSBbXTsKICAgIGlmICh0eXBlKSB7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0eXBlKSkgewogICAgICAgIHR5cGUgPSBbdHlwZV07CiAgICAgIH0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0eXBlLmxlbmd0aCAmJiAhdmFsaWQ7IGkrKykgewogICAgICAgIHZhciBhc3NlcnRlZFR5cGUgPSBhc3NlcnRUeXBlKHZhbHVlLCB0eXBlW2ldKTsKICAgICAgICBleHBlY3RlZFR5cGVzLnB1c2goYXNzZXJ0ZWRUeXBlLmV4cGVjdGVkVHlwZSB8fCAnJyk7CiAgICAgICAgdmFsaWQgPSBhc3NlcnRlZFR5cGUudmFsaWQ7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIXZhbGlkKSB7CiAgICAgIHdhcm4oCiAgICAgICAgZ2V0SW52YWxpZFR5cGVNZXNzYWdlKG5hbWUsIHZhbHVlLCBleHBlY3RlZFR5cGVzKSwKICAgICAgICB2bQogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIHZhciB2YWxpZGF0b3IgPSBwcm9wLnZhbGlkYXRvcjsKICAgIGlmICh2YWxpZGF0b3IpIHsKICAgICAgaWYgKCF2YWxpZGF0b3IodmFsdWUpKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdJbnZhbGlkIHByb3A6IGN1c3RvbSB2YWxpZGF0b3IgY2hlY2sgZmFpbGVkIGZvciBwcm9wICInICsgbmFtZSArICciLicsCiAgICAgICAgICB2bQogICAgICAgICk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBzaW1wbGVDaGVja1JFID0gL14oU3RyaW5nfE51bWJlcnxCb29sZWFufEZ1bmN0aW9ufFN5bWJvbCkkLzsKCiAgZnVuY3Rpb24gYXNzZXJ0VHlwZSAodmFsdWUsIHR5cGUpIHsKICAgIHZhciB2YWxpZDsKICAgIHZhciBleHBlY3RlZFR5cGUgPSBnZXRUeXBlKHR5cGUpOwogICAgaWYgKHNpbXBsZUNoZWNrUkUudGVzdChleHBlY3RlZFR5cGUpKSB7CiAgICAgIHZhciB0ID0gdHlwZW9mIHZhbHVlOwogICAgICB2YWxpZCA9IHQgPT09IGV4cGVjdGVkVHlwZS50b0xvd2VyQ2FzZSgpOwogICAgICAvLyBmb3IgcHJpbWl0aXZlIHdyYXBwZXIgb2JqZWN0cwogICAgICBpZiAoIXZhbGlkICYmIHQgPT09ICdvYmplY3QnKSB7CiAgICAgICAgdmFsaWQgPSB2YWx1ZSBpbnN0YW5jZW9mIHR5cGU7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXhwZWN0ZWRUeXBlID09PSAnT2JqZWN0JykgewogICAgICB2YWxpZCA9IGlzUGxhaW5PYmplY3QodmFsdWUpOwogICAgfSBlbHNlIGlmIChleHBlY3RlZFR5cGUgPT09ICdBcnJheScpIHsKICAgICAgdmFsaWQgPSBBcnJheS5pc0FycmF5KHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhbGlkID0gdmFsdWUgaW5zdGFuY2VvZiB0eXBlOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IHZhbGlkLAogICAgICBleHBlY3RlZFR5cGU6IGV4cGVjdGVkVHlwZQogICAgfQogIH0KCiAgLyoqCiAgICogVXNlIGZ1bmN0aW9uIHN0cmluZyBuYW1lIHRvIGNoZWNrIGJ1aWx0LWluIHR5cGVzLAogICAqIGJlY2F1c2UgYSBzaW1wbGUgZXF1YWxpdHkgY2hlY2sgd2lsbCBmYWlsIHdoZW4gcnVubmluZwogICAqIGFjcm9zcyBkaWZmZXJlbnQgdm1zIC8gaWZyYW1lcy4KICAgKi8KICBmdW5jdGlvbiBnZXRUeXBlIChmbikgewogICAgdmFyIG1hdGNoID0gZm4gJiYgZm4udG9TdHJpbmcoKS5tYXRjaCgvXlxzKmZ1bmN0aW9uIChcdyspLyk7CiAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6ICcnCiAgfQoKICBmdW5jdGlvbiBpc1NhbWVUeXBlIChhLCBiKSB7CiAgICByZXR1cm4gZ2V0VHlwZShhKSA9PT0gZ2V0VHlwZShiKQogIH0KCiAgZnVuY3Rpb24gZ2V0VHlwZUluZGV4ICh0eXBlLCBleHBlY3RlZFR5cGVzKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZXhwZWN0ZWRUeXBlcykpIHsKICAgICAgcmV0dXJuIGlzU2FtZVR5cGUoZXhwZWN0ZWRUeXBlcywgdHlwZSkgPyAwIDogLTEKICAgIH0KICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBleHBlY3RlZFR5cGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGlmIChpc1NhbWVUeXBlKGV4cGVjdGVkVHlwZXNbaV0sIHR5cGUpKSB7CiAgICAgICAgcmV0dXJuIGkKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xCiAgfQoKICBmdW5jdGlvbiBnZXRJbnZhbGlkVHlwZU1lc3NhZ2UgKG5hbWUsIHZhbHVlLCBleHBlY3RlZFR5cGVzKSB7CiAgICB2YXIgbWVzc2FnZSA9ICJJbnZhbGlkIHByb3A6IHR5cGUgY2hlY2sgZmFpbGVkIGZvciBwcm9wIFwiIiArIG5hbWUgKyAiXCIuIiArCiAgICAgICIgRXhwZWN0ZWQgIiArIChleHBlY3RlZFR5cGVzLm1hcChjYXBpdGFsaXplKS5qb2luKCcsICcpKTsKICAgIHZhciBleHBlY3RlZFR5cGUgPSBleHBlY3RlZFR5cGVzWzBdOwogICAgdmFyIHJlY2VpdmVkVHlwZSA9IHRvUmF3VHlwZSh2YWx1ZSk7CiAgICB2YXIgZXhwZWN0ZWRWYWx1ZSA9IHN0eWxlVmFsdWUodmFsdWUsIGV4cGVjdGVkVHlwZSk7CiAgICB2YXIgcmVjZWl2ZWRWYWx1ZSA9IHN0eWxlVmFsdWUodmFsdWUsIHJlY2VpdmVkVHlwZSk7CiAgICAvLyBjaGVjayBpZiB3ZSBuZWVkIHRvIHNwZWNpZnkgZXhwZWN0ZWQgdmFsdWUKICAgIGlmIChleHBlY3RlZFR5cGVzLmxlbmd0aCA9PT0gMSAmJgogICAgICAgIGlzRXhwbGljYWJsZShleHBlY3RlZFR5cGUpICYmCiAgICAgICAgIWlzQm9vbGVhbihleHBlY3RlZFR5cGUsIHJlY2VpdmVkVHlwZSkpIHsKICAgICAgbWVzc2FnZSArPSAiIHdpdGggdmFsdWUgIiArIGV4cGVjdGVkVmFsdWU7CiAgICB9CiAgICBtZXNzYWdlICs9ICIsIGdvdCAiICsgcmVjZWl2ZWRUeXBlICsgIiAiOwogICAgLy8gY2hlY2sgaWYgd2UgbmVlZCB0byBzcGVjaWZ5IHJlY2VpdmVkIHZhbHVlCiAgICBpZiAoaXNFeHBsaWNhYmxlKHJlY2VpdmVkVHlwZSkpIHsKICAgICAgbWVzc2FnZSArPSAid2l0aCB2YWx1ZSAiICsgcmVjZWl2ZWRWYWx1ZSArICIuIjsKICAgIH0KICAgIHJldHVybiBtZXNzYWdlCiAgfQoKICBmdW5jdGlvbiBzdHlsZVZhbHVlICh2YWx1ZSwgdHlwZSkgewogICAgaWYgKHR5cGUgPT09ICdTdHJpbmcnKSB7CiAgICAgIHJldHVybiAoIlwiIiArIHZhbHVlICsgIlwiIikKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ051bWJlcicpIHsKICAgICAgcmV0dXJuICgiIiArIChOdW1iZXIodmFsdWUpKSkKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAoIiIgKyB2YWx1ZSkKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzRXhwbGljYWJsZSAodmFsdWUpIHsKICAgIHZhciBleHBsaWNpdFR5cGVzID0gWydzdHJpbmcnLCAnbnVtYmVyJywgJ2Jvb2xlYW4nXTsKICAgIHJldHVybiBleHBsaWNpdFR5cGVzLnNvbWUoZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IGVsZW07IH0pCiAgfQoKICBmdW5jdGlvbiBpc0Jvb2xlYW4gKCkgewogICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07CgogICAgcmV0dXJuIGFyZ3Muc29tZShmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gZWxlbS50b0xvd2VyQ2FzZSgpID09PSAnYm9vbGVhbic7IH0pCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaGFuZGxlRXJyb3IgKGVyciwgdm0sIGluZm8pIHsKICAgIC8vIERlYWN0aXZhdGUgZGVwcyB0cmFja2luZyB3aGlsZSBwcm9jZXNzaW5nIGVycm9yIGhhbmRsZXIgdG8gYXZvaWQgcG9zc2libGUgaW5maW5pdGUgcmVuZGVyaW5nLgogICAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vdnVlanMvdnVleC9pc3N1ZXMvMTUwNQogICAgcHVzaFRhcmdldCgpOwogICAgdHJ5IHsKICAgICAgaWYgKHZtKSB7CiAgICAgICAgdmFyIGN1ciA9IHZtOwogICAgICAgIHdoaWxlICgoY3VyID0gY3VyLiRwYXJlbnQpKSB7CiAgICAgICAgICB2YXIgaG9va3MgPSBjdXIuJG9wdGlvbnMuZXJyb3JDYXB0dXJlZDsKICAgICAgICAgIGlmIChob29rcykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhvb2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBjYXB0dXJlID0gaG9va3NbaV0uY2FsbChjdXIsIGVyciwgdm0sIGluZm8pID09PSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChjYXB0dXJlKSB7IHJldHVybiB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgZ2xvYmFsSGFuZGxlRXJyb3IoZSwgY3VyLCAnZXJyb3JDYXB0dXJlZCBob29rJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGdsb2JhbEhhbmRsZUVycm9yKGVyciwgdm0sIGluZm8pOwogICAgfSBmaW5hbGx5IHsKICAgICAgcG9wVGFyZ2V0KCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyAoCiAgICBoYW5kbGVyLAogICAgY29udGV4dCwKICAgIGFyZ3MsCiAgICB2bSwKICAgIGluZm8KICApIHsKICAgIHZhciByZXM7CiAgICB0cnkgewogICAgICByZXMgPSBhcmdzID8gaGFuZGxlci5hcHBseShjb250ZXh0LCBhcmdzKSA6IGhhbmRsZXIuY2FsbChjb250ZXh0KTsKICAgICAgaWYgKHJlcyAmJiAhcmVzLl9pc1Z1ZSAmJiBpc1Byb21pc2UocmVzKSAmJiAhcmVzLl9oYW5kbGVkKSB7CiAgICAgICAgcmVzLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBoYW5kbGVFcnJvcihlLCB2bSwgaW5mbyArICIgKFByb21pc2UvYXN5bmMpIik7IH0pOwogICAgICAgIC8vIGlzc3VlICM5NTExCiAgICAgICAgLy8gYXZvaWQgY2F0Y2ggdHJpZ2dlcmluZyBtdWx0aXBsZSB0aW1lcyB3aGVuIG5lc3RlZCBjYWxscwogICAgICAgIHJlcy5faGFuZGxlZCA9IHRydWU7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sIGluZm8pOwogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gZ2xvYmFsSGFuZGxlRXJyb3IgKGVyciwgdm0sIGluZm8pIHsKICAgIGlmIChjb25maWcuZXJyb3JIYW5kbGVyKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGNvbmZpZy5lcnJvckhhbmRsZXIuY2FsbChudWxsLCBlcnIsIHZtLCBpbmZvKQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gaWYgdGhlIHVzZXIgaW50ZW50aW9uYWxseSB0aHJvd3MgdGhlIG9yaWdpbmFsIGVycm9yIGluIHRoZSBoYW5kbGVyLAogICAgICAgIC8vIGRvIG5vdCBsb2cgaXQgdHdpY2UKICAgICAgICBpZiAoZSAhPT0gZXJyKSB7CiAgICAgICAgICBsb2dFcnJvcihlLCBudWxsLCAnY29uZmlnLmVycm9ySGFuZGxlcicpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbG9nRXJyb3IoZXJyLCB2bSwgaW5mbyk7CiAgfQoKICBmdW5jdGlvbiBsb2dFcnJvciAoZXJyLCB2bSwgaW5mbykgewogICAgewogICAgICB3YXJuKCgiRXJyb3IgaW4gIiArIGluZm8gKyAiOiBcIiIgKyAoZXJyLnRvU3RyaW5nKCkpICsgIlwiIiksIHZtKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAoKGluQnJvd3NlciB8fCBpbldlZXgpICYmIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgewogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBlcnIKICAgIH0KICB9CgogIC8qICAqLwoKICB2YXIgaXNVc2luZ01pY3JvVGFzayA9IGZhbHNlOwoKICB2YXIgY2FsbGJhY2tzID0gW107CiAgdmFyIHBlbmRpbmcgPSBmYWxzZTsKCiAgZnVuY3Rpb24gZmx1c2hDYWxsYmFja3MgKCkgewogICAgcGVuZGluZyA9IGZhbHNlOwogICAgdmFyIGNvcGllcyA9IGNhbGxiYWNrcy5zbGljZSgwKTsKICAgIGNhbGxiYWNrcy5sZW5ndGggPSAwOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3BpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgY29waWVzW2ldKCk7CiAgICB9CiAgfQoKICAvLyBIZXJlIHdlIGhhdmUgYXN5bmMgZGVmZXJyaW5nIHdyYXBwZXJzIHVzaW5nIG1pY3JvdGFza3MuCiAgLy8gSW4gMi41IHdlIHVzZWQgKG1hY3JvKSB0YXNrcyAoaW4gY29tYmluYXRpb24gd2l0aCBtaWNyb3Rhc2tzKS4KICAvLyBIb3dldmVyLCBpdCBoYXMgc3VidGxlIHByb2JsZW1zIHdoZW4gc3RhdGUgaXMgY2hhbmdlZCByaWdodCBiZWZvcmUgcmVwYWludAogIC8vIChlLmcuICM2ODEzLCBvdXQtaW4gdHJhbnNpdGlvbnMpLgogIC8vIEFsc28sIHVzaW5nIChtYWNybykgdGFza3MgaW4gZXZlbnQgaGFuZGxlciB3b3VsZCBjYXVzZSBzb21lIHdlaXJkIGJlaGF2aW9ycwogIC8vIHRoYXQgY2Fubm90IGJlIGNpcmN1bXZlbnRlZCAoZS5nLiAjNzEwOSwgIzcxNTMsICM3NTQ2LCAjNzgzNCwgIzgxMDkpLgogIC8vIFNvIHdlIG5vdyB1c2UgbWljcm90YXNrcyBldmVyeXdoZXJlLCBhZ2Fpbi4KICAvLyBBIG1ham9yIGRyYXdiYWNrIG9mIHRoaXMgdHJhZGVvZmYgaXMgdGhhdCB0aGVyZSBhcmUgc29tZSBzY2VuYXJpb3MKICAvLyB3aGVyZSBtaWNyb3Rhc2tzIGhhdmUgdG9vIGhpZ2ggYSBwcmlvcml0eSBhbmQgZmlyZSBpbiBiZXR3ZWVuIHN1cHBvc2VkbHkKICAvLyBzZXF1ZW50aWFsIGV2ZW50cyAoZS5nLiAjNDUyMSwgIzY2OTAsIHdoaWNoIGhhdmUgd29ya2Fyb3VuZHMpCiAgLy8gb3IgZXZlbiBiZXR3ZWVuIGJ1YmJsaW5nIG9mIHRoZSBzYW1lIGV2ZW50ICgjNjU2NikuCiAgdmFyIHRpbWVyRnVuYzsKCiAgLy8gVGhlIG5leHRUaWNrIGJlaGF2aW9yIGxldmVyYWdlcyB0aGUgbWljcm90YXNrIHF1ZXVlLCB3aGljaCBjYW4gYmUgYWNjZXNzZWQKICAvLyB2aWEgZWl0aGVyIG5hdGl2ZSBQcm9taXNlLnRoZW4gb3IgTXV0YXRpb25PYnNlcnZlci4KICAvLyBNdXRhdGlvbk9ic2VydmVyIGhhcyB3aWRlciBzdXBwb3J0LCBob3dldmVyIGl0IGlzIHNlcmlvdXNseSBidWdnZWQgaW4KICAvLyBVSVdlYlZpZXcgaW4gaU9TID49IDkuMy4zIHdoZW4gdHJpZ2dlcmVkIGluIHRvdWNoIGV2ZW50IGhhbmRsZXJzLiBJdAogIC8vIGNvbXBsZXRlbHkgc3RvcHMgd29ya2luZyBhZnRlciB0cmlnZ2VyaW5nIGEgZmV3IHRpbWVzLi4uIHNvLCBpZiBuYXRpdmUKICAvLyBQcm9taXNlIGlzIGF2YWlsYWJsZSwgd2Ugd2lsbCB1c2UgaXQ6CiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQsICRmbG93LWRpc2FibGUtbGluZSAqLwogIGlmICh0eXBlb2YgUHJvbWlzZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoUHJvbWlzZSkpIHsKICAgIHZhciBwID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICB0aW1lckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHAudGhlbihmbHVzaENhbGxiYWNrcyk7CiAgICAgIC8vIEluIHByb2JsZW1hdGljIFVJV2ViVmlld3MsIFByb21pc2UudGhlbiBkb2Vzbid0IGNvbXBsZXRlbHkgYnJlYWssIGJ1dAogICAgICAvLyBpdCBjYW4gZ2V0IHN0dWNrIGluIGEgd2VpcmQgc3RhdGUgd2hlcmUgY2FsbGJhY2tzIGFyZSBwdXNoZWQgaW50byB0aGUKICAgICAgLy8gbWljcm90YXNrIHF1ZXVlIGJ1dCB0aGUgcXVldWUgaXNuJ3QgYmVpbmcgZmx1c2hlZCwgdW50aWwgdGhlIGJyb3dzZXIKICAgICAgLy8gbmVlZHMgdG8gZG8gc29tZSBvdGhlciB3b3JrLCBlLmcuIGhhbmRsZSBhIHRpbWVyLiBUaGVyZWZvcmUgd2UgY2FuCiAgICAgIC8vICJmb3JjZSIgdGhlIG1pY3JvdGFzayBxdWV1ZSB0byBiZSBmbHVzaGVkIGJ5IGFkZGluZyBhbiBlbXB0eSB0aW1lci4KICAgICAgaWYgKGlzSU9TKSB7IHNldFRpbWVvdXQobm9vcCk7IH0KICAgIH07CiAgICBpc1VzaW5nTWljcm9UYXNrID0gdHJ1ZTsKICB9IGVsc2UgaWYgKCFpc0lFICYmIHR5cGVvZiBNdXRhdGlvbk9ic2VydmVyICE9PSAndW5kZWZpbmVkJyAmJiAoCiAgICBpc05hdGl2ZShNdXRhdGlvbk9ic2VydmVyKSB8fAogICAgLy8gUGhhbnRvbUpTIGFuZCBpT1MgNy54CiAgICBNdXRhdGlvbk9ic2VydmVyLnRvU3RyaW5nKCkgPT09ICdbb2JqZWN0IE11dGF0aW9uT2JzZXJ2ZXJDb25zdHJ1Y3Rvcl0nCiAgKSkgewogICAgLy8gVXNlIE11dGF0aW9uT2JzZXJ2ZXIgd2hlcmUgbmF0aXZlIFByb21pc2UgaXMgbm90IGF2YWlsYWJsZSwKICAgIC8vIGUuZy4gUGhhbnRvbUpTLCBpT1M3LCBBbmRyb2lkIDQuNAogICAgLy8gKCM2NDY2IE11dGF0aW9uT2JzZXJ2ZXIgaXMgdW5yZWxpYWJsZSBpbiBJRTExKQogICAgdmFyIGNvdW50ZXIgPSAxOwogICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZmx1c2hDYWxsYmFja3MpOwogICAgdmFyIHRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoU3RyaW5nKGNvdW50ZXIpKTsKICAgIG9ic2VydmVyLm9ic2VydmUodGV4dE5vZGUsIHsKICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZQogICAgfSk7CiAgICB0aW1lckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvdW50ZXIgPSAoY291bnRlciArIDEpICUgMjsKICAgICAgdGV4dE5vZGUuZGF0YSA9IFN0cmluZyhjb3VudGVyKTsKICAgIH07CiAgICBpc1VzaW5nTWljcm9UYXNrID0gdHJ1ZTsKICB9IGVsc2UgaWYgKHR5cGVvZiBzZXRJbW1lZGlhdGUgIT09ICd1bmRlZmluZWQnICYmIGlzTmF0aXZlKHNldEltbWVkaWF0ZSkpIHsKICAgIC8vIEZhbGxiYWNrIHRvIHNldEltbWVkaWF0ZS4KICAgIC8vIFRlY2huaWNhbGx5IGl0IGxldmVyYWdlcyB0aGUgKG1hY3JvKSB0YXNrIHF1ZXVlLAogICAgLy8gYnV0IGl0IGlzIHN0aWxsIGEgYmV0dGVyIGNob2ljZSB0aGFuIHNldFRpbWVvdXQuCiAgICB0aW1lckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHNldEltbWVkaWF0ZShmbHVzaENhbGxiYWNrcyk7CiAgICB9OwogIH0gZWxzZSB7CiAgICAvLyBGYWxsYmFjayB0byBzZXRUaW1lb3V0LgogICAgdGltZXJGdW5jID0gZnVuY3Rpb24gKCkgewogICAgICBzZXRUaW1lb3V0KGZsdXNoQ2FsbGJhY2tzLCAwKTsKICAgIH07CiAgfQoKICBmdW5jdGlvbiBuZXh0VGljayAoY2IsIGN0eCkgewogICAgdmFyIF9yZXNvbHZlOwogICAgY2FsbGJhY2tzLnB1c2goZnVuY3Rpb24gKCkgewogICAgICBpZiAoY2IpIHsKICAgICAgICB0cnkgewogICAgICAgICAgY2IuY2FsbChjdHgpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGhhbmRsZUVycm9yKGUsIGN0eCwgJ25leHRUaWNrJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKF9yZXNvbHZlKSB7CiAgICAgICAgX3Jlc29sdmUoY3R4KTsKICAgICAgfQogICAgfSk7CiAgICBpZiAoIXBlbmRpbmcpIHsKICAgICAgcGVuZGluZyA9IHRydWU7CiAgICAgIHRpbWVyRnVuYygpOwogICAgfQogICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICBpZiAoIWNiICYmIHR5cGVvZiBQcm9taXNlICE9PSAndW5kZWZpbmVkJykgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBfcmVzb2x2ZSA9IHJlc29sdmU7CiAgICAgIH0pCiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIG1hcms7CiAgdmFyIG1lYXN1cmU7CgogIHsKICAgIHZhciBwZXJmID0gaW5Ccm93c2VyICYmIHdpbmRvdy5wZXJmb3JtYW5jZTsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKAogICAgICBwZXJmICYmCiAgICAgIHBlcmYubWFyayAmJgogICAgICBwZXJmLm1lYXN1cmUgJiYKICAgICAgcGVyZi5jbGVhck1hcmtzICYmCiAgICAgIHBlcmYuY2xlYXJNZWFzdXJlcwogICAgKSB7CiAgICAgIG1hcmsgPSBmdW5jdGlvbiAodGFnKSB7IHJldHVybiBwZXJmLm1hcmsodGFnKTsgfTsKICAgICAgbWVhc3VyZSA9IGZ1bmN0aW9uIChuYW1lLCBzdGFydFRhZywgZW5kVGFnKSB7CiAgICAgICAgcGVyZi5tZWFzdXJlKG5hbWUsIHN0YXJ0VGFnLCBlbmRUYWcpOwogICAgICAgIHBlcmYuY2xlYXJNYXJrcyhzdGFydFRhZyk7CiAgICAgICAgcGVyZi5jbGVhck1hcmtzKGVuZFRhZyk7CiAgICAgICAgLy8gcGVyZi5jbGVhck1lYXN1cmVzKG5hbWUpCiAgICAgIH07CiAgICB9CiAgfQoKICAvKiBub3QgdHlwZSBjaGVja2luZyB0aGlzIGZpbGUgYmVjYXVzZSBmbG93IGRvZXNuJ3QgcGxheSB3ZWxsIHdpdGggUHJveHkgKi8KCiAgdmFyIGluaXRQcm94eTsKCiAgewogICAgdmFyIGFsbG93ZWRHbG9iYWxzID0gbWFrZU1hcCgKICAgICAgJ0luZmluaXR5LHVuZGVmaW5lZCxOYU4saXNGaW5pdGUsaXNOYU4sJyArCiAgICAgICdwYXJzZUZsb2F0LHBhcnNlSW50LGRlY29kZVVSSSxkZWNvZGVVUklDb21wb25lbnQsZW5jb2RlVVJJLGVuY29kZVVSSUNvbXBvbmVudCwnICsKICAgICAgJ01hdGgsTnVtYmVyLERhdGUsQXJyYXksT2JqZWN0LEJvb2xlYW4sU3RyaW5nLFJlZ0V4cCxNYXAsU2V0LEpTT04sSW50bCwnICsKICAgICAgJ3JlcXVpcmUnIC8vIGZvciBXZWJwYWNrL0Jyb3dzZXJpZnkKICAgICk7CgogICAgdmFyIHdhcm5Ob25QcmVzZW50ID0gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7CiAgICAgIHdhcm4oCiAgICAgICAgIlByb3BlcnR5IG9yIG1ldGhvZCBcIiIgKyBrZXkgKyAiXCIgaXMgbm90IGRlZmluZWQgb24gdGhlIGluc3RhbmNlIGJ1dCAiICsKICAgICAgICAncmVmZXJlbmNlZCBkdXJpbmcgcmVuZGVyLiBNYWtlIHN1cmUgdGhhdCB0aGlzIHByb3BlcnR5IGlzIHJlYWN0aXZlLCAnICsKICAgICAgICAnZWl0aGVyIGluIHRoZSBkYXRhIG9wdGlvbiwgb3IgZm9yIGNsYXNzLWJhc2VkIGNvbXBvbmVudHMsIGJ5ICcgKwogICAgICAgICdpbml0aWFsaXppbmcgdGhlIHByb3BlcnR5LiAnICsKICAgICAgICAnU2VlOiBodHRwczovL3Z1ZWpzLm9yZy92Mi9ndWlkZS9yZWFjdGl2aXR5Lmh0bWwjRGVjbGFyaW5nLVJlYWN0aXZlLVByb3BlcnRpZXMuJywKICAgICAgICB0YXJnZXQKICAgICAgKTsKICAgIH07CgogICAgdmFyIHdhcm5SZXNlcnZlZFByZWZpeCA9IGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgewogICAgICB3YXJuKAogICAgICAgICJQcm9wZXJ0eSBcIiIgKyBrZXkgKyAiXCIgbXVzdCBiZSBhY2Nlc3NlZCB3aXRoIFwiJGRhdGEuIiArIGtleSArICJcIiBiZWNhdXNlICIgKwogICAgICAgICdwcm9wZXJ0aWVzIHN0YXJ0aW5nIHdpdGggIiQiIG9yICJfIiBhcmUgbm90IHByb3hpZWQgaW4gdGhlIFZ1ZSBpbnN0YW5jZSB0byAnICsKICAgICAgICAncHJldmVudCBjb25mbGljdHMgd2l0aCBWdWUgaW50ZXJuYWxzLiAnICsKICAgICAgICAnU2VlOiBodHRwczovL3Z1ZWpzLm9yZy92Mi9hcGkvI2RhdGEnLAogICAgICAgIHRhcmdldAogICAgICApOwogICAgfTsKCiAgICB2YXIgaGFzUHJveHkgPQogICAgICB0eXBlb2YgUHJveHkgIT09ICd1bmRlZmluZWQnICYmIGlzTmF0aXZlKFByb3h5KTsKCiAgICBpZiAoaGFzUHJveHkpIHsKICAgICAgdmFyIGlzQnVpbHRJbk1vZGlmaWVyID0gbWFrZU1hcCgnc3RvcCxwcmV2ZW50LHNlbGYsY3RybCxzaGlmdCxhbHQsbWV0YSxleGFjdCcpOwogICAgICBjb25maWcua2V5Q29kZXMgPSBuZXcgUHJveHkoY29uZmlnLmtleUNvZGVzLCB7CiAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQgKHRhcmdldCwga2V5LCB2YWx1ZSkgewogICAgICAgICAgaWYgKGlzQnVpbHRJbk1vZGlmaWVyKGtleSkpIHsKICAgICAgICAgICAgd2FybigoIkF2b2lkIG92ZXJ3cml0aW5nIGJ1aWx0LWluIG1vZGlmaWVyIGluIGNvbmZpZy5rZXlDb2RlczogLiIgKyBrZXkpKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YXJnZXRba2V5XSA9IHZhbHVlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgdmFyIGhhc0hhbmRsZXIgPSB7CiAgICAgIGhhczogZnVuY3Rpb24gaGFzICh0YXJnZXQsIGtleSkgewogICAgICAgIHZhciBoYXMgPSBrZXkgaW4gdGFyZ2V0OwogICAgICAgIHZhciBpc0FsbG93ZWQgPSBhbGxvd2VkR2xvYmFscyhrZXkpIHx8CiAgICAgICAgICAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycgJiYga2V5LmNoYXJBdCgwKSA9PT0gJ18nICYmICEoa2V5IGluIHRhcmdldC4kZGF0YSkpOwogICAgICAgIGlmICghaGFzICYmICFpc0FsbG93ZWQpIHsKICAgICAgICAgIGlmIChrZXkgaW4gdGFyZ2V0LiRkYXRhKSB7IHdhcm5SZXNlcnZlZFByZWZpeCh0YXJnZXQsIGtleSk7IH0KICAgICAgICAgIGVsc2UgeyB3YXJuTm9uUHJlc2VudCh0YXJnZXQsIGtleSk7IH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhhcyB8fCAhaXNBbGxvd2VkCiAgICAgIH0KICAgIH07CgogICAgdmFyIGdldEhhbmRsZXIgPSB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0ICh0YXJnZXQsIGtleSkgewogICAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyAmJiAhKGtleSBpbiB0YXJnZXQpKSB7CiAgICAgICAgICBpZiAoa2V5IGluIHRhcmdldC4kZGF0YSkgeyB3YXJuUmVzZXJ2ZWRQcmVmaXgodGFyZ2V0LCBrZXkpOyB9CiAgICAgICAgICBlbHNlIHsgd2Fybk5vblByZXNlbnQodGFyZ2V0LCBrZXkpOyB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0YXJnZXRba2V5XQogICAgICB9CiAgICB9OwoKICAgIGluaXRQcm94eSA9IGZ1bmN0aW9uIGluaXRQcm94eSAodm0pIHsKICAgICAgaWYgKGhhc1Byb3h5KSB7CiAgICAgICAgLy8gZGV0ZXJtaW5lIHdoaWNoIHByb3h5IGhhbmRsZXIgdG8gdXNlCiAgICAgICAgdmFyIG9wdGlvbnMgPSB2bS4kb3B0aW9uczsKICAgICAgICB2YXIgaGFuZGxlcnMgPSBvcHRpb25zLnJlbmRlciAmJiBvcHRpb25zLnJlbmRlci5fd2l0aFN0cmlwcGVkCiAgICAgICAgICA/IGdldEhhbmRsZXIKICAgICAgICAgIDogaGFzSGFuZGxlcjsKICAgICAgICB2bS5fcmVuZGVyUHJveHkgPSBuZXcgUHJveHkodm0sIGhhbmRsZXJzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS5fcmVuZGVyUHJveHkgPSB2bTsKICAgICAgfQogICAgfTsKICB9CgogIC8qICAqLwoKICB2YXIgc2Vlbk9iamVjdHMgPSBuZXcgX1NldCgpOwoKICAvKioKICAgKiBSZWN1cnNpdmVseSB0cmF2ZXJzZSBhbiBvYmplY3QgdG8gZXZva2UgYWxsIGNvbnZlcnRlZAogICAqIGdldHRlcnMsIHNvIHRoYXQgZXZlcnkgbmVzdGVkIHByb3BlcnR5IGluc2lkZSB0aGUgb2JqZWN0CiAgICogaXMgY29sbGVjdGVkIGFzIGEgImRlZXAiIGRlcGVuZGVuY3kuCiAgICovCiAgZnVuY3Rpb24gdHJhdmVyc2UgKHZhbCkgewogICAgX3RyYXZlcnNlKHZhbCwgc2Vlbk9iamVjdHMpOwogICAgc2Vlbk9iamVjdHMuY2xlYXIoKTsKICB9CgogIGZ1bmN0aW9uIF90cmF2ZXJzZSAodmFsLCBzZWVuKSB7CiAgICB2YXIgaSwga2V5czsKICAgIHZhciBpc0EgPSBBcnJheS5pc0FycmF5KHZhbCk7CiAgICBpZiAoKCFpc0EgJiYgIWlzT2JqZWN0KHZhbCkpIHx8IE9iamVjdC5pc0Zyb3plbih2YWwpIHx8IHZhbCBpbnN0YW5jZW9mIFZOb2RlKSB7CiAgICAgIHJldHVybgogICAgfQogICAgaWYgKHZhbC5fX29iX18pIHsKICAgICAgdmFyIGRlcElkID0gdmFsLl9fb2JfXy5kZXAuaWQ7CiAgICAgIGlmIChzZWVuLmhhcyhkZXBJZCkpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBzZWVuLmFkZChkZXBJZCk7CiAgICB9CiAgICBpZiAoaXNBKSB7CiAgICAgIGkgPSB2YWwubGVuZ3RoOwogICAgICB3aGlsZSAoaS0tKSB7IF90cmF2ZXJzZSh2YWxbaV0sIHNlZW4pOyB9CiAgICB9IGVsc2UgewogICAgICBrZXlzID0gT2JqZWN0LmtleXModmFsKTsKICAgICAgaSA9IGtleXMubGVuZ3RoOwogICAgICB3aGlsZSAoaS0tKSB7IF90cmF2ZXJzZSh2YWxba2V5c1tpXV0sIHNlZW4pOyB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIG5vcm1hbGl6ZUV2ZW50ID0gY2FjaGVkKGZ1bmN0aW9uIChuYW1lKSB7CiAgICB2YXIgcGFzc2l2ZSA9IG5hbWUuY2hhckF0KDApID09PSAnJic7CiAgICBuYW1lID0gcGFzc2l2ZSA/IG5hbWUuc2xpY2UoMSkgOiBuYW1lOwogICAgdmFyIG9uY2UkJDEgPSBuYW1lLmNoYXJBdCgwKSA9PT0gJ34nOyAvLyBQcmVmaXhlZCBsYXN0LCBjaGVja2VkIGZpcnN0CiAgICBuYW1lID0gb25jZSQkMSA/IG5hbWUuc2xpY2UoMSkgOiBuYW1lOwogICAgdmFyIGNhcHR1cmUgPSBuYW1lLmNoYXJBdCgwKSA9PT0gJyEnOwogICAgbmFtZSA9IGNhcHR1cmUgPyBuYW1lLnNsaWNlKDEpIDogbmFtZTsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIG9uY2U6IG9uY2UkJDEsCiAgICAgIGNhcHR1cmU6IGNhcHR1cmUsCiAgICAgIHBhc3NpdmU6IHBhc3NpdmUKICAgIH0KICB9KTsKCiAgZnVuY3Rpb24gY3JlYXRlRm5JbnZva2VyIChmbnMsIHZtKSB7CiAgICBmdW5jdGlvbiBpbnZva2VyICgpIHsKICAgICAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKICAgICAgdmFyIGZucyA9IGludm9rZXIuZm5zOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShmbnMpKSB7CiAgICAgICAgdmFyIGNsb25lZCA9IGZucy5zbGljZSgpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2xvbmVkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyhjbG9uZWRbaV0sIG51bGwsIGFyZ3VtZW50cyQxLCB2bSwgInYtb24gaGFuZGxlciIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyByZXR1cm4gaGFuZGxlciByZXR1cm4gdmFsdWUgZm9yIHNpbmdsZSBoYW5kbGVycwogICAgICAgIHJldHVybiBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyhmbnMsIG51bGwsIGFyZ3VtZW50cywgdm0sICJ2LW9uIGhhbmRsZXIiKQogICAgICB9CiAgICB9CiAgICBpbnZva2VyLmZucyA9IGZuczsKICAgIHJldHVybiBpbnZva2VyCiAgfQoKICBmdW5jdGlvbiB1cGRhdGVMaXN0ZW5lcnMgKAogICAgb24sCiAgICBvbGRPbiwKICAgIGFkZCwKICAgIHJlbW92ZSQkMSwKICAgIGNyZWF0ZU9uY2VIYW5kbGVyLAogICAgdm0KICApIHsKICAgIHZhciBuYW1lLCBkZWYkJDEsIGN1ciwgb2xkLCBldmVudDsKICAgIGZvciAobmFtZSBpbiBvbikgewogICAgICBkZWYkJDEgPSBjdXIgPSBvbltuYW1lXTsKICAgICAgb2xkID0gb2xkT25bbmFtZV07CiAgICAgIGV2ZW50ID0gbm9ybWFsaXplRXZlbnQobmFtZSk7CiAgICAgIGlmIChpc1VuZGVmKGN1cikpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgIkludmFsaWQgaGFuZGxlciBmb3IgZXZlbnQgXCIiICsgKGV2ZW50Lm5hbWUpICsgIlwiOiBnb3QgIiArIFN0cmluZyhjdXIpLAogICAgICAgICAgdm0KICAgICAgICApOwogICAgICB9IGVsc2UgaWYgKGlzVW5kZWYob2xkKSkgewogICAgICAgIGlmIChpc1VuZGVmKGN1ci5mbnMpKSB7CiAgICAgICAgICBjdXIgPSBvbltuYW1lXSA9IGNyZWF0ZUZuSW52b2tlcihjdXIsIHZtKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzVHJ1ZShldmVudC5vbmNlKSkgewogICAgICAgICAgY3VyID0gb25bbmFtZV0gPSBjcmVhdGVPbmNlSGFuZGxlcihldmVudC5uYW1lLCBjdXIsIGV2ZW50LmNhcHR1cmUpOwogICAgICAgIH0KICAgICAgICBhZGQoZXZlbnQubmFtZSwgY3VyLCBldmVudC5jYXB0dXJlLCBldmVudC5wYXNzaXZlLCBldmVudC5wYXJhbXMpOwogICAgICB9IGVsc2UgaWYgKGN1ciAhPT0gb2xkKSB7CiAgICAgICAgb2xkLmZucyA9IGN1cjsKICAgICAgICBvbltuYW1lXSA9IG9sZDsKICAgICAgfQogICAgfQogICAgZm9yIChuYW1lIGluIG9sZE9uKSB7CiAgICAgIGlmIChpc1VuZGVmKG9uW25hbWVdKSkgewogICAgICAgIGV2ZW50ID0gbm9ybWFsaXplRXZlbnQobmFtZSk7CiAgICAgICAgcmVtb3ZlJCQxKGV2ZW50Lm5hbWUsIG9sZE9uW25hbWVdLCBldmVudC5jYXB0dXJlKTsKICAgICAgfQogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIG1lcmdlVk5vZGVIb29rIChkZWYsIGhvb2tLZXksIGhvb2spIHsKICAgIGlmIChkZWYgaW5zdGFuY2VvZiBWTm9kZSkgewogICAgICBkZWYgPSBkZWYuZGF0YS5ob29rIHx8IChkZWYuZGF0YS5ob29rID0ge30pOwogICAgfQogICAgdmFyIGludm9rZXI7CiAgICB2YXIgb2xkSG9vayA9IGRlZltob29rS2V5XTsKCiAgICBmdW5jdGlvbiB3cmFwcGVkSG9vayAoKSB7CiAgICAgIGhvb2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgLy8gaW1wb3J0YW50OiByZW1vdmUgbWVyZ2VkIGhvb2sgdG8gZW5zdXJlIGl0J3MgY2FsbGVkIG9ubHkgb25jZQogICAgICAvLyBhbmQgcHJldmVudCBtZW1vcnkgbGVhawogICAgICByZW1vdmUoaW52b2tlci5mbnMsIHdyYXBwZWRIb29rKTsKICAgIH0KCiAgICBpZiAoaXNVbmRlZihvbGRIb29rKSkgewogICAgICAvLyBubyBleGlzdGluZyBob29rCiAgICAgIGludm9rZXIgPSBjcmVhdGVGbkludm9rZXIoW3dyYXBwZWRIb29rXSk7CiAgICB9IGVsc2UgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKGlzRGVmKG9sZEhvb2suZm5zKSAmJiBpc1RydWUob2xkSG9vay5tZXJnZWQpKSB7CiAgICAgICAgLy8gYWxyZWFkeSBhIG1lcmdlZCBpbnZva2VyCiAgICAgICAgaW52b2tlciA9IG9sZEhvb2s7CiAgICAgICAgaW52b2tlci5mbnMucHVzaCh3cmFwcGVkSG9vayk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZXhpc3RpbmcgcGxhaW4gaG9vawogICAgICAgIGludm9rZXIgPSBjcmVhdGVGbkludm9rZXIoW29sZEhvb2ssIHdyYXBwZWRIb29rXSk7CiAgICAgIH0KICAgIH0KCiAgICBpbnZva2VyLm1lcmdlZCA9IHRydWU7CiAgICBkZWZbaG9va0tleV0gPSBpbnZva2VyOwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGV4dHJhY3RQcm9wc0Zyb21WTm9kZURhdGEgKAogICAgZGF0YSwKICAgIEN0b3IsCiAgICB0YWcKICApIHsKICAgIC8vIHdlIGFyZSBvbmx5IGV4dHJhY3RpbmcgcmF3IHZhbHVlcyBoZXJlLgogICAgLy8gdmFsaWRhdGlvbiBhbmQgZGVmYXVsdCB2YWx1ZXMgYXJlIGhhbmRsZWQgaW4gdGhlIGNoaWxkCiAgICAvLyBjb21wb25lbnQgaXRzZWxmLgogICAgdmFyIHByb3BPcHRpb25zID0gQ3Rvci5vcHRpb25zLnByb3BzOwogICAgaWYgKGlzVW5kZWYocHJvcE9wdGlvbnMpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIHJlcyA9IHt9OwogICAgdmFyIGF0dHJzID0gZGF0YS5hdHRyczsKICAgIHZhciBwcm9wcyA9IGRhdGEucHJvcHM7CiAgICBpZiAoaXNEZWYoYXR0cnMpIHx8IGlzRGVmKHByb3BzKSkgewogICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcE9wdGlvbnMpIHsKICAgICAgICB2YXIgYWx0S2V5ID0gaHlwaGVuYXRlKGtleSk7CiAgICAgICAgewogICAgICAgICAgdmFyIGtleUluTG93ZXJDYXNlID0ga2V5LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGtleSAhPT0ga2V5SW5Mb3dlckNhc2UgJiYKICAgICAgICAgICAgYXR0cnMgJiYgaGFzT3duKGF0dHJzLCBrZXlJbkxvd2VyQ2FzZSkKICAgICAgICAgICkgewogICAgICAgICAgICB0aXAoCiAgICAgICAgICAgICAgIlByb3AgXCIiICsga2V5SW5Mb3dlckNhc2UgKyAiXCIgaXMgcGFzc2VkIHRvIGNvbXBvbmVudCAiICsKICAgICAgICAgICAgICAoZm9ybWF0Q29tcG9uZW50TmFtZSh0YWcgfHwgQ3RvcikpICsgIiwgYnV0IHRoZSBkZWNsYXJlZCBwcm9wIG5hbWUgaXMiICsKICAgICAgICAgICAgICAiIFwiIiArIGtleSArICJcIi4gIiArCiAgICAgICAgICAgICAgIk5vdGUgdGhhdCBIVE1MIGF0dHJpYnV0ZXMgYXJlIGNhc2UtaW5zZW5zaXRpdmUgYW5kIGNhbWVsQ2FzZWQgIiArCiAgICAgICAgICAgICAgInByb3BzIG5lZWQgdG8gdXNlIHRoZWlyIGtlYmFiLWNhc2UgZXF1aXZhbGVudHMgd2hlbiB1c2luZyBpbi1ET00gIiArCiAgICAgICAgICAgICAgInRlbXBsYXRlcy4gWW91IHNob3VsZCBwcm9iYWJseSB1c2UgXCIiICsgYWx0S2V5ICsgIlwiIGluc3RlYWQgb2YgXCIiICsga2V5ICsgIlwiLiIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2hlY2tQcm9wKHJlcywgcHJvcHMsIGtleSwgYWx0S2V5LCB0cnVlKSB8fAogICAgICAgIGNoZWNrUHJvcChyZXMsIGF0dHJzLCBrZXksIGFsdEtleSwgZmFsc2UpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICBmdW5jdGlvbiBjaGVja1Byb3AgKAogICAgcmVzLAogICAgaGFzaCwKICAgIGtleSwKICAgIGFsdEtleSwKICAgIHByZXNlcnZlCiAgKSB7CiAgICBpZiAoaXNEZWYoaGFzaCkpIHsKICAgICAgaWYgKGhhc093bihoYXNoLCBrZXkpKSB7CiAgICAgICAgcmVzW2tleV0gPSBoYXNoW2tleV07CiAgICAgICAgaWYgKCFwcmVzZXJ2ZSkgewogICAgICAgICAgZGVsZXRlIGhhc2hba2V5XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWUKICAgICAgfSBlbHNlIGlmIChoYXNPd24oaGFzaCwgYWx0S2V5KSkgewogICAgICAgIHJlc1trZXldID0gaGFzaFthbHRLZXldOwogICAgICAgIGlmICghcHJlc2VydmUpIHsKICAgICAgICAgIGRlbGV0ZSBoYXNoW2FsdEtleV07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZQogIH0KCiAgLyogICovCgogIC8vIFRoZSB0ZW1wbGF0ZSBjb21waWxlciBhdHRlbXB0cyB0byBtaW5pbWl6ZSB0aGUgbmVlZCBmb3Igbm9ybWFsaXphdGlvbiBieQogIC8vIHN0YXRpY2FsbHkgYW5hbHl6aW5nIHRoZSB0ZW1wbGF0ZSBhdCBjb21waWxlIHRpbWUuCiAgLy8KICAvLyBGb3IgcGxhaW4gSFRNTCBtYXJrdXAsIG5vcm1hbGl6YXRpb24gY2FuIGJlIGNvbXBsZXRlbHkgc2tpcHBlZCBiZWNhdXNlIHRoZQogIC8vIGdlbmVyYXRlZCByZW5kZXIgZnVuY3Rpb24gaXMgZ3VhcmFudGVlZCB0byByZXR1cm4gQXJyYXk8Vk5vZGU+LiBUaGVyZSBhcmUKICAvLyB0d28gY2FzZXMgd2hlcmUgZXh0cmEgbm9ybWFsaXphdGlvbiBpcyBuZWVkZWQ6CgogIC8vIDEuIFdoZW4gdGhlIGNoaWxkcmVuIGNvbnRhaW5zIGNvbXBvbmVudHMgLSBiZWNhdXNlIGEgZnVuY3Rpb25hbCBjb21wb25lbnQKICAvLyBtYXkgcmV0dXJuIGFuIEFycmF5IGluc3RlYWQgb2YgYSBzaW5nbGUgcm9vdC4gSW4gdGhpcyBjYXNlLCBqdXN0IGEgc2ltcGxlCiAgLy8gbm9ybWFsaXphdGlvbiBpcyBuZWVkZWQgLSBpZiBhbnkgY2hpbGQgaXMgYW4gQXJyYXksIHdlIGZsYXR0ZW4gdGhlIHdob2xlCiAgLy8gdGhpbmcgd2l0aCBBcnJheS5wcm90b3R5cGUuY29uY2F0LiBJdCBpcyBndWFyYW50ZWVkIHRvIGJlIG9ubHkgMS1sZXZlbCBkZWVwCiAgLy8gYmVjYXVzZSBmdW5jdGlvbmFsIGNvbXBvbmVudHMgYWxyZWFkeSBub3JtYWxpemUgdGhlaXIgb3duIGNoaWxkcmVuLgogIGZ1bmN0aW9uIHNpbXBsZU5vcm1hbGl6ZUNoaWxkcmVuIChjaGlsZHJlbikgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbltpXSkpIHsKICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5hcHBseShbXSwgY2hpbGRyZW4pCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjaGlsZHJlbgogIH0KCiAgLy8gMi4gV2hlbiB0aGUgY2hpbGRyZW4gY29udGFpbnMgY29uc3RydWN0cyB0aGF0IGFsd2F5cyBnZW5lcmF0ZWQgbmVzdGVkIEFycmF5cywKICAvLyBlLmcuIDx0ZW1wbGF0ZT4sIDxzbG90Piwgdi1mb3IsIG9yIHdoZW4gdGhlIGNoaWxkcmVuIGlzIHByb3ZpZGVkIGJ5IHVzZXIKICAvLyB3aXRoIGhhbmQtd3JpdHRlbiByZW5kZXIgZnVuY3Rpb25zIC8gSlNYLiBJbiBzdWNoIGNhc2VzIGEgZnVsbCBub3JtYWxpemF0aW9uCiAgLy8gaXMgbmVlZGVkIHRvIGNhdGVyIHRvIGFsbCBwb3NzaWJsZSB0eXBlcyBvZiBjaGlsZHJlbiB2YWx1ZXMuCiAgZnVuY3Rpb24gbm9ybWFsaXplQ2hpbGRyZW4gKGNoaWxkcmVuKSB7CiAgICByZXR1cm4gaXNQcmltaXRpdmUoY2hpbGRyZW4pCiAgICAgID8gW2NyZWF0ZVRleHRWTm9kZShjaGlsZHJlbildCiAgICAgIDogQXJyYXkuaXNBcnJheShjaGlsZHJlbikKICAgICAgICA/IG5vcm1hbGl6ZUFycmF5Q2hpbGRyZW4oY2hpbGRyZW4pCiAgICAgICAgOiB1bmRlZmluZWQKICB9CgogIGZ1bmN0aW9uIGlzVGV4dE5vZGUgKG5vZGUpIHsKICAgIHJldHVybiBpc0RlZihub2RlKSAmJiBpc0RlZihub2RlLnRleHQpICYmIGlzRmFsc2Uobm9kZS5pc0NvbW1lbnQpCiAgfQoKICBmdW5jdGlvbiBub3JtYWxpemVBcnJheUNoaWxkcmVuIChjaGlsZHJlbiwgbmVzdGVkSW5kZXgpIHsKICAgIHZhciByZXMgPSBbXTsKICAgIHZhciBpLCBjLCBsYXN0SW5kZXgsIGxhc3Q7CiAgICBmb3IgKGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgYyA9IGNoaWxkcmVuW2ldOwogICAgICBpZiAoaXNVbmRlZihjKSB8fCB0eXBlb2YgYyA9PT0gJ2Jvb2xlYW4nKSB7IGNvbnRpbnVlIH0KICAgICAgbGFzdEluZGV4ID0gcmVzLmxlbmd0aCAtIDE7CiAgICAgIGxhc3QgPSByZXNbbGFzdEluZGV4XTsKICAgICAgLy8gIG5lc3RlZAogICAgICBpZiAoQXJyYXkuaXNBcnJheShjKSkgewogICAgICAgIGlmIChjLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGMgPSBub3JtYWxpemVBcnJheUNoaWxkcmVuKGMsICgobmVzdGVkSW5kZXggfHwgJycpICsgIl8iICsgaSkpOwogICAgICAgICAgLy8gbWVyZ2UgYWRqYWNlbnQgdGV4dCBub2RlcwogICAgICAgICAgaWYgKGlzVGV4dE5vZGUoY1swXSkgJiYgaXNUZXh0Tm9kZShsYXN0KSkgewogICAgICAgICAgICByZXNbbGFzdEluZGV4XSA9IGNyZWF0ZVRleHRWTm9kZShsYXN0LnRleHQgKyAoY1swXSkudGV4dCk7CiAgICAgICAgICAgIGMuc2hpZnQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlcy5wdXNoLmFwcGx5KHJlcywgYyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGlzUHJpbWl0aXZlKGMpKSB7CiAgICAgICAgaWYgKGlzVGV4dE5vZGUobGFzdCkpIHsKICAgICAgICAgIC8vIG1lcmdlIGFkamFjZW50IHRleHQgbm9kZXMKICAgICAgICAgIC8vIHRoaXMgaXMgbmVjZXNzYXJ5IGZvciBTU1IgaHlkcmF0aW9uIGJlY2F1c2UgdGV4dCBub2RlcyBhcmUKICAgICAgICAgIC8vIGVzc2VudGlhbGx5IG1lcmdlZCB3aGVuIHJlbmRlcmVkIHRvIEhUTUwgc3RyaW5ncwogICAgICAgICAgcmVzW2xhc3RJbmRleF0gPSBjcmVhdGVUZXh0Vk5vZGUobGFzdC50ZXh0ICsgYyk7CiAgICAgICAgfSBlbHNlIGlmIChjICE9PSAnJykgewogICAgICAgICAgLy8gY29udmVydCBwcmltaXRpdmUgdG8gdm5vZGUKICAgICAgICAgIHJlcy5wdXNoKGNyZWF0ZVRleHRWTm9kZShjKSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChpc1RleHROb2RlKGMpICYmIGlzVGV4dE5vZGUobGFzdCkpIHsKICAgICAgICAgIC8vIG1lcmdlIGFkamFjZW50IHRleHQgbm9kZXMKICAgICAgICAgIHJlc1tsYXN0SW5kZXhdID0gY3JlYXRlVGV4dFZOb2RlKGxhc3QudGV4dCArIGMudGV4dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGRlZmF1bHQga2V5IGZvciBuZXN0ZWQgYXJyYXkgY2hpbGRyZW4gKGxpa2VseSBnZW5lcmF0ZWQgYnkgdi1mb3IpCiAgICAgICAgICBpZiAoaXNUcnVlKGNoaWxkcmVuLl9pc1ZMaXN0KSAmJgogICAgICAgICAgICBpc0RlZihjLnRhZykgJiYKICAgICAgICAgICAgaXNVbmRlZihjLmtleSkgJiYKICAgICAgICAgICAgaXNEZWYobmVzdGVkSW5kZXgpKSB7CiAgICAgICAgICAgIGMua2V5ID0gIl9fdmxpc3QiICsgbmVzdGVkSW5kZXggKyAiXyIgKyBpICsgIl9fIjsKICAgICAgICAgIH0KICAgICAgICAgIHJlcy5wdXNoKGMpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRQcm92aWRlICh2bSkgewogICAgdmFyIHByb3ZpZGUgPSB2bS4kb3B0aW9ucy5wcm92aWRlOwogICAgaWYgKHByb3ZpZGUpIHsKICAgICAgdm0uX3Byb3ZpZGVkID0gdHlwZW9mIHByb3ZpZGUgPT09ICdmdW5jdGlvbicKICAgICAgICA/IHByb3ZpZGUuY2FsbCh2bSkKICAgICAgICA6IHByb3ZpZGU7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0SW5qZWN0aW9ucyAodm0pIHsKICAgIHZhciByZXN1bHQgPSByZXNvbHZlSW5qZWN0KHZtLiRvcHRpb25zLmluamVjdCwgdm0pOwogICAgaWYgKHJlc3VsdCkgewogICAgICB0b2dnbGVPYnNlcnZpbmcoZmFsc2UpOwogICAgICBPYmplY3Qua2V5cyhyZXN1bHQpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgICAgewogICAgICAgICAgZGVmaW5lUmVhY3RpdmUkJDEodm0sIGtleSwgcmVzdWx0W2tleV0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgd2FybigKICAgICAgICAgICAgICAiQXZvaWQgbXV0YXRpbmcgYW4gaW5qZWN0ZWQgdmFsdWUgZGlyZWN0bHkgc2luY2UgdGhlIGNoYW5nZXMgd2lsbCBiZSAiICsKICAgICAgICAgICAgICAib3ZlcndyaXR0ZW4gd2hlbmV2ZXIgdGhlIHByb3ZpZGVkIGNvbXBvbmVudCByZS1yZW5kZXJzLiAiICsKICAgICAgICAgICAgICAiaW5qZWN0aW9uIGJlaW5nIG11dGF0ZWQ6IFwiIiArIGtleSArICJcIiIsCiAgICAgICAgICAgICAgdm0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRvZ2dsZU9ic2VydmluZyh0cnVlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlc29sdmVJbmplY3QgKGluamVjdCwgdm0pIHsKICAgIGlmIChpbmplY3QpIHsKICAgICAgLy8gaW5qZWN0IGlzIDphbnkgYmVjYXVzZSBmbG93IGlzIG5vdCBzbWFydCBlbm91Z2ggdG8gZmlndXJlIG91dCBjYWNoZWQKICAgICAgdmFyIHJlc3VsdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHZhciBrZXlzID0gaGFzU3ltYm9sCiAgICAgICAgPyBSZWZsZWN0Lm93bktleXMoaW5qZWN0KQogICAgICAgIDogT2JqZWN0LmtleXMoaW5qZWN0KTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICAgIC8vICM2NTc0IGluIGNhc2UgdGhlIGluamVjdCBvYmplY3QgaXMgb2JzZXJ2ZWQuLi4KICAgICAgICBpZiAoa2V5ID09PSAnX19vYl9fJykgeyBjb250aW51ZSB9CiAgICAgICAgdmFyIHByb3ZpZGVLZXkgPSBpbmplY3Rba2V5XS5mcm9tOwogICAgICAgIHZhciBzb3VyY2UgPSB2bTsKICAgICAgICB3aGlsZSAoc291cmNlKSB7CiAgICAgICAgICBpZiAoc291cmNlLl9wcm92aWRlZCAmJiBoYXNPd24oc291cmNlLl9wcm92aWRlZCwgcHJvdmlkZUtleSkpIHsKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBzb3VyY2UuX3Byb3ZpZGVkW3Byb3ZpZGVLZXldOwogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgICAgc291cmNlID0gc291cmNlLiRwYXJlbnQ7CiAgICAgICAgfQogICAgICAgIGlmICghc291cmNlKSB7CiAgICAgICAgICBpZiAoJ2RlZmF1bHQnIGluIGluamVjdFtrZXldKSB7CiAgICAgICAgICAgIHZhciBwcm92aWRlRGVmYXVsdCA9IGluamVjdFtrZXldLmRlZmF1bHQ7CiAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdHlwZW9mIHByb3ZpZGVEZWZhdWx0ID09PSAnZnVuY3Rpb24nCiAgICAgICAgICAgICAgPyBwcm92aWRlRGVmYXVsdC5jYWxsKHZtKQogICAgICAgICAgICAgIDogcHJvdmlkZURlZmF1bHQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3YXJuKCgiSW5qZWN0aW9uIFwiIiArIGtleSArICJcIiBub3QgZm91bmQiKSwgdm0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0CiAgICB9CiAgfQoKICAvKiAgKi8KCgoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3IgcmVzb2x2aW5nIHJhdyBjaGlsZHJlbiBWTm9kZXMgaW50byBhIHNsb3Qgb2JqZWN0LgogICAqLwogIGZ1bmN0aW9uIHJlc29sdmVTbG90cyAoCiAgICBjaGlsZHJlbiwKICAgIGNvbnRleHQKICApIHsKICAgIGlmICghY2hpbGRyZW4gfHwgIWNoaWxkcmVuLmxlbmd0aCkgewogICAgICByZXR1cm4ge30KICAgIH0KICAgIHZhciBzbG90cyA9IHt9OwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07CiAgICAgIHZhciBkYXRhID0gY2hpbGQuZGF0YTsKICAgICAgLy8gcmVtb3ZlIHNsb3QgYXR0cmlidXRlIGlmIHRoZSBub2RlIGlzIHJlc29sdmVkIGFzIGEgVnVlIHNsb3Qgbm9kZQogICAgICBpZiAoZGF0YSAmJiBkYXRhLmF0dHJzICYmIGRhdGEuYXR0cnMuc2xvdCkgewogICAgICAgIGRlbGV0ZSBkYXRhLmF0dHJzLnNsb3Q7CiAgICAgIH0KICAgICAgLy8gbmFtZWQgc2xvdHMgc2hvdWxkIG9ubHkgYmUgcmVzcGVjdGVkIGlmIHRoZSB2bm9kZSB3YXMgcmVuZGVyZWQgaW4gdGhlCiAgICAgIC8vIHNhbWUgY29udGV4dC4KICAgICAgaWYgKChjaGlsZC5jb250ZXh0ID09PSBjb250ZXh0IHx8IGNoaWxkLmZuQ29udGV4dCA9PT0gY29udGV4dCkgJiYKICAgICAgICBkYXRhICYmIGRhdGEuc2xvdCAhPSBudWxsCiAgICAgICkgewogICAgICAgIHZhciBuYW1lID0gZGF0YS5zbG90OwogICAgICAgIHZhciBzbG90ID0gKHNsb3RzW25hbWVdIHx8IChzbG90c1tuYW1lXSA9IFtdKSk7CiAgICAgICAgaWYgKGNoaWxkLnRhZyA9PT0gJ3RlbXBsYXRlJykgewogICAgICAgICAgc2xvdC5wdXNoLmFwcGx5KHNsb3QsIGNoaWxkLmNoaWxkcmVuIHx8IFtdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2xvdC5wdXNoKGNoaWxkKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKHNsb3RzLmRlZmF1bHQgfHwgKHNsb3RzLmRlZmF1bHQgPSBbXSkpLnB1c2goY2hpbGQpOwogICAgICB9CiAgICB9CiAgICAvLyBpZ25vcmUgc2xvdHMgdGhhdCBjb250YWlucyBvbmx5IHdoaXRlc3BhY2UKICAgIGZvciAodmFyIG5hbWUkMSBpbiBzbG90cykgewogICAgICBpZiAoc2xvdHNbbmFtZSQxXS5ldmVyeShpc1doaXRlc3BhY2UpKSB7CiAgICAgICAgZGVsZXRlIHNsb3RzW25hbWUkMV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzbG90cwogIH0KCiAgZnVuY3Rpb24gaXNXaGl0ZXNwYWNlIChub2RlKSB7CiAgICByZXR1cm4gKG5vZGUuaXNDb21tZW50ICYmICFub2RlLmFzeW5jRmFjdG9yeSkgfHwgbm9kZS50ZXh0ID09PSAnICcKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBub3JtYWxpemVTY29wZWRTbG90cyAoCiAgICBzbG90cywKICAgIG5vcm1hbFNsb3RzLAogICAgcHJldlNsb3RzCiAgKSB7CiAgICB2YXIgcmVzOwogICAgdmFyIGhhc05vcm1hbFNsb3RzID0gT2JqZWN0LmtleXMobm9ybWFsU2xvdHMpLmxlbmd0aCA+IDA7CiAgICB2YXIgaXNTdGFibGUgPSBzbG90cyA/ICEhc2xvdHMuJHN0YWJsZSA6ICFoYXNOb3JtYWxTbG90czsKICAgIHZhciBrZXkgPSBzbG90cyAmJiBzbG90cy4ka2V5OwogICAgaWYgKCFzbG90cykgewogICAgICByZXMgPSB7fTsKICAgIH0gZWxzZSBpZiAoc2xvdHMuX25vcm1hbGl6ZWQpIHsKICAgICAgLy8gZmFzdCBwYXRoIDE6IGNoaWxkIGNvbXBvbmVudCByZS1yZW5kZXIgb25seSwgcGFyZW50IGRpZCBub3QgY2hhbmdlCiAgICAgIHJldHVybiBzbG90cy5fbm9ybWFsaXplZAogICAgfSBlbHNlIGlmICgKICAgICAgaXNTdGFibGUgJiYKICAgICAgcHJldlNsb3RzICYmCiAgICAgIHByZXZTbG90cyAhPT0gZW1wdHlPYmplY3QgJiYKICAgICAga2V5ID09PSBwcmV2U2xvdHMuJGtleSAmJgogICAgICAhaGFzTm9ybWFsU2xvdHMgJiYKICAgICAgIXByZXZTbG90cy4kaGFzTm9ybWFsCiAgICApIHsKICAgICAgLy8gZmFzdCBwYXRoIDI6IHN0YWJsZSBzY29wZWQgc2xvdHMgdy8gbm8gbm9ybWFsIHNsb3RzIHRvIHByb3h5LAogICAgICAvLyBvbmx5IG5lZWQgdG8gbm9ybWFsaXplIG9uY2UKICAgICAgcmV0dXJuIHByZXZTbG90cwogICAgfSBlbHNlIHsKICAgICAgcmVzID0ge307CiAgICAgIGZvciAodmFyIGtleSQxIGluIHNsb3RzKSB7CiAgICAgICAgaWYgKHNsb3RzW2tleSQxXSAmJiBrZXkkMVswXSAhPT0gJyQnKSB7CiAgICAgICAgICByZXNba2V5JDFdID0gbm9ybWFsaXplU2NvcGVkU2xvdChub3JtYWxTbG90cywga2V5JDEsIHNsb3RzW2tleSQxXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyBleHBvc2Ugbm9ybWFsIHNsb3RzIG9uIHNjb3BlZFNsb3RzCiAgICBmb3IgKHZhciBrZXkkMiBpbiBub3JtYWxTbG90cykgewogICAgICBpZiAoIShrZXkkMiBpbiByZXMpKSB7CiAgICAgICAgcmVzW2tleSQyXSA9IHByb3h5Tm9ybWFsU2xvdChub3JtYWxTbG90cywga2V5JDIpOwogICAgICB9CiAgICB9CiAgICAvLyBhdm9yaWF6IHNlZW1zIHRvIG1vY2sgYSBub24tZXh0ZW5zaWJsZSAkc2NvcGVkU2xvdHMgb2JqZWN0CiAgICAvLyBhbmQgd2hlbiB0aGF0IGlzIHBhc3NlZCBkb3duIHRoaXMgd291bGQgY2F1c2UgYW4gZXJyb3IKICAgIGlmIChzbG90cyAmJiBPYmplY3QuaXNFeHRlbnNpYmxlKHNsb3RzKSkgewogICAgICAoc2xvdHMpLl9ub3JtYWxpemVkID0gcmVzOwogICAgfQogICAgZGVmKHJlcywgJyRzdGFibGUnLCBpc1N0YWJsZSk7CiAgICBkZWYocmVzLCAnJGtleScsIGtleSk7CiAgICBkZWYocmVzLCAnJGhhc05vcm1hbCcsIGhhc05vcm1hbFNsb3RzKTsKICAgIHJldHVybiByZXMKICB9CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZVNjb3BlZFNsb3Qobm9ybWFsU2xvdHMsIGtleSwgZm4pIHsKICAgIHZhciBub3JtYWxpemVkID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgcmVzID0gYXJndW1lbnRzLmxlbmd0aCA/IGZuLmFwcGx5KG51bGwsIGFyZ3VtZW50cykgOiBmbih7fSk7CiAgICAgIHJlcyA9IHJlcyAmJiB0eXBlb2YgcmVzID09PSAnb2JqZWN0JyAmJiAhQXJyYXkuaXNBcnJheShyZXMpCiAgICAgICAgPyBbcmVzXSAvLyBzaW5nbGUgdm5vZGUKICAgICAgICA6IG5vcm1hbGl6ZUNoaWxkcmVuKHJlcyk7CiAgICAgIHJldHVybiByZXMgJiYgKAogICAgICAgIHJlcy5sZW5ndGggPT09IDAgfHwKICAgICAgICAocmVzLmxlbmd0aCA9PT0gMSAmJiByZXNbMF0uaXNDb21tZW50KSAvLyAjOTY1OAogICAgICApID8gdW5kZWZpbmVkCiAgICAgICAgOiByZXMKICAgIH07CiAgICAvLyB0aGlzIGlzIGEgc2xvdCB1c2luZyB0aGUgbmV3IHYtc2xvdCBzeW50YXggd2l0aG91dCBzY29wZS4gYWx0aG91Z2ggaXQgaXMKICAgIC8vIGNvbXBpbGVkIGFzIGEgc2NvcGVkIHNsb3QsIHJlbmRlciBmbiB1c2VycyB3b3VsZCBleHBlY3QgaXQgdG8gYmUgcHJlc2VudAogICAgLy8gb24gdGhpcy4kc2xvdHMgYmVjYXVzZSB0aGUgdXNhZ2UgaXMgc2VtYW50aWNhbGx5IGEgbm9ybWFsIHNsb3QuCiAgICBpZiAoZm4ucHJveHkpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5vcm1hbFNsb3RzLCBrZXksIHsKICAgICAgICBnZXQ6IG5vcm1hbGl6ZWQsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gbm9ybWFsaXplZAogIH0KCiAgZnVuY3Rpb24gcHJveHlOb3JtYWxTbG90KHNsb3RzLCBrZXkpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiBzbG90c1trZXldOyB9CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHJlbmRlcmluZyB2LWZvciBsaXN0cy4KICAgKi8KICBmdW5jdGlvbiByZW5kZXJMaXN0ICgKICAgIHZhbCwKICAgIHJlbmRlcgogICkgewogICAgdmFyIHJldCwgaSwgbCwga2V5cywga2V5OwogICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSB8fCB0eXBlb2YgdmFsID09PSAnc3RyaW5nJykgewogICAgICByZXQgPSBuZXcgQXJyYXkodmFsLmxlbmd0aCk7CiAgICAgIGZvciAoaSA9IDAsIGwgPSB2YWwubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgcmV0W2ldID0gcmVuZGVyKHZhbFtpXSwgaSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpIHsKICAgICAgcmV0ID0gbmV3IEFycmF5KHZhbCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCB2YWw7IGkrKykgewogICAgICAgIHJldFtpXSA9IHJlbmRlcihpICsgMSwgaSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNPYmplY3QodmFsKSkgewogICAgICBpZiAoaGFzU3ltYm9sICYmIHZhbFtTeW1ib2wuaXRlcmF0b3JdKSB7CiAgICAgICAgcmV0ID0gW107CiAgICAgICAgdmFyIGl0ZXJhdG9yID0gdmFsW1N5bWJvbC5pdGVyYXRvcl0oKTsKICAgICAgICB2YXIgcmVzdWx0ID0gaXRlcmF0b3IubmV4dCgpOwogICAgICAgIHdoaWxlICghcmVzdWx0LmRvbmUpIHsKICAgICAgICAgIHJldC5wdXNoKHJlbmRlcihyZXN1bHQudmFsdWUsIHJldC5sZW5ndGgpKTsKICAgICAgICAgIHJlc3VsdCA9IGl0ZXJhdG9yLm5leHQoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAga2V5cyA9IE9iamVjdC5rZXlzKHZhbCk7CiAgICAgICAgcmV0ID0gbmV3IEFycmF5KGtleXMubGVuZ3RoKTsKICAgICAgICBmb3IgKGkgPSAwLCBsID0ga2V5cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGtleSA9IGtleXNbaV07CiAgICAgICAgICByZXRbaV0gPSByZW5kZXIodmFsW2tleV0sIGtleSwgaSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIWlzRGVmKHJldCkpIHsKICAgICAgcmV0ID0gW107CiAgICB9CiAgICAocmV0KS5faXNWTGlzdCA9IHRydWU7CiAgICByZXR1cm4gcmV0CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHJlbmRlcmluZyA8c2xvdD4KICAgKi8KICBmdW5jdGlvbiByZW5kZXJTbG90ICgKICAgIG5hbWUsCiAgICBmYWxsYmFjaywKICAgIHByb3BzLAogICAgYmluZE9iamVjdAogICkgewogICAgdmFyIHNjb3BlZFNsb3RGbiA9IHRoaXMuJHNjb3BlZFNsb3RzW25hbWVdOwogICAgdmFyIG5vZGVzOwogICAgaWYgKHNjb3BlZFNsb3RGbikgeyAvLyBzY29wZWQgc2xvdAogICAgICBwcm9wcyA9IHByb3BzIHx8IHt9OwogICAgICBpZiAoYmluZE9iamVjdCkgewogICAgICAgIGlmICghaXNPYmplY3QoYmluZE9iamVjdCkpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICdzbG90IHYtYmluZCB3aXRob3V0IGFyZ3VtZW50IGV4cGVjdHMgYW4gT2JqZWN0JywKICAgICAgICAgICAgdGhpcwogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcHJvcHMgPSBleHRlbmQoZXh0ZW5kKHt9LCBiaW5kT2JqZWN0KSwgcHJvcHMpOwogICAgICB9CiAgICAgIG5vZGVzID0gc2NvcGVkU2xvdEZuKHByb3BzKSB8fCBmYWxsYmFjazsKICAgIH0gZWxzZSB7CiAgICAgIG5vZGVzID0gdGhpcy4kc2xvdHNbbmFtZV0gfHwgZmFsbGJhY2s7CiAgICB9CgogICAgdmFyIHRhcmdldCA9IHByb3BzICYmIHByb3BzLnNsb3Q7CiAgICBpZiAodGFyZ2V0KSB7CiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScsIHsgc2xvdDogdGFyZ2V0IH0sIG5vZGVzKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG5vZGVzCiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHJlc29sdmluZyBmaWx0ZXJzCiAgICovCiAgZnVuY3Rpb24gcmVzb2x2ZUZpbHRlciAoaWQpIHsKICAgIHJldHVybiByZXNvbHZlQXNzZXQodGhpcy4kb3B0aW9ucywgJ2ZpbHRlcnMnLCBpZCwgdHJ1ZSkgfHwgaWRlbnRpdHkKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBpc0tleU5vdE1hdGNoIChleHBlY3QsIGFjdHVhbCkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoZXhwZWN0KSkgewogICAgICByZXR1cm4gZXhwZWN0LmluZGV4T2YoYWN0dWFsKSA9PT0gLTEKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBleHBlY3QgIT09IGFjdHVhbAogICAgfQogIH0KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIGNoZWNraW5nIGtleUNvZGVzIGZyb20gY29uZmlnLgogICAqIGV4cG9zZWQgYXMgVnVlLnByb3RvdHlwZS5fawogICAqIHBhc3NpbmcgaW4gZXZlbnRLZXlOYW1lIGFzIGxhc3QgYXJndW1lbnQgc2VwYXJhdGVseSBmb3IgYmFja3dhcmRzIGNvbXBhdAogICAqLwogIGZ1bmN0aW9uIGNoZWNrS2V5Q29kZXMgKAogICAgZXZlbnRLZXlDb2RlLAogICAga2V5LAogICAgYnVpbHRJbktleUNvZGUsCiAgICBldmVudEtleU5hbWUsCiAgICBidWlsdEluS2V5TmFtZQogICkgewogICAgdmFyIG1hcHBlZEtleUNvZGUgPSBjb25maWcua2V5Q29kZXNba2V5XSB8fCBidWlsdEluS2V5Q29kZTsKICAgIGlmIChidWlsdEluS2V5TmFtZSAmJiBldmVudEtleU5hbWUgJiYgIWNvbmZpZy5rZXlDb2Rlc1trZXldKSB7CiAgICAgIHJldHVybiBpc0tleU5vdE1hdGNoKGJ1aWx0SW5LZXlOYW1lLCBldmVudEtleU5hbWUpCiAgICB9IGVsc2UgaWYgKG1hcHBlZEtleUNvZGUpIHsKICAgICAgcmV0dXJuIGlzS2V5Tm90TWF0Y2gobWFwcGVkS2V5Q29kZSwgZXZlbnRLZXlDb2RlKQogICAgfSBlbHNlIGlmIChldmVudEtleU5hbWUpIHsKICAgICAgcmV0dXJuIGh5cGhlbmF0ZShldmVudEtleU5hbWUpICE9PSBrZXkKICAgIH0KICB9CgogIC8qICAqLwoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3IgbWVyZ2luZyB2LWJpbmQ9Im9iamVjdCIgaW50byBhIFZOb2RlJ3MgZGF0YS4KICAgKi8KICBmdW5jdGlvbiBiaW5kT2JqZWN0UHJvcHMgKAogICAgZGF0YSwKICAgIHRhZywKICAgIHZhbHVlLAogICAgYXNQcm9wLAogICAgaXNTeW5jCiAgKSB7CiAgICBpZiAodmFsdWUpIHsKICAgICAgaWYgKCFpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ3YtYmluZCB3aXRob3V0IGFyZ3VtZW50IGV4cGVjdHMgYW4gT2JqZWN0IG9yIEFycmF5IHZhbHVlJywKICAgICAgICAgIHRoaXMKICAgICAgICApOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgICAgdmFsdWUgPSB0b09iamVjdCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHZhciBoYXNoOwogICAgICAgIHZhciBsb29wID0gZnVuY3Rpb24gKCBrZXkgKSB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGtleSA9PT0gJ2NsYXNzJyB8fAogICAgICAgICAgICBrZXkgPT09ICdzdHlsZScgfHwKICAgICAgICAgICAgaXNSZXNlcnZlZEF0dHJpYnV0ZShrZXkpCiAgICAgICAgICApIHsKICAgICAgICAgICAgaGFzaCA9IGRhdGE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgdHlwZSA9IGRhdGEuYXR0cnMgJiYgZGF0YS5hdHRycy50eXBlOwogICAgICAgICAgICBoYXNoID0gYXNQcm9wIHx8IGNvbmZpZy5tdXN0VXNlUHJvcCh0YWcsIHR5cGUsIGtleSkKICAgICAgICAgICAgICA/IGRhdGEuZG9tUHJvcHMgfHwgKGRhdGEuZG9tUHJvcHMgPSB7fSkKICAgICAgICAgICAgICA6IGRhdGEuYXR0cnMgfHwgKGRhdGEuYXR0cnMgPSB7fSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgY2FtZWxpemVkS2V5ID0gY2FtZWxpemUoa2V5KTsKICAgICAgICAgIHZhciBoeXBoZW5hdGVkS2V5ID0gaHlwaGVuYXRlKGtleSk7CiAgICAgICAgICBpZiAoIShjYW1lbGl6ZWRLZXkgaW4gaGFzaCkgJiYgIShoeXBoZW5hdGVkS2V5IGluIGhhc2gpKSB7CiAgICAgICAgICAgIGhhc2hba2V5XSA9IHZhbHVlW2tleV07CgogICAgICAgICAgICBpZiAoaXNTeW5jKSB7CiAgICAgICAgICAgICAgdmFyIG9uID0gZGF0YS5vbiB8fCAoZGF0YS5vbiA9IHt9KTsKICAgICAgICAgICAgICBvblsoInVwZGF0ZToiICsga2V5KV0gPSBmdW5jdGlvbiAoJGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YWx1ZVtrZXldID0gJGV2ZW50OwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIGxvb3AoIGtleSApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZGF0YQogIH0KCiAgLyogICovCgogIC8qKgogICAqIFJ1bnRpbWUgaGVscGVyIGZvciByZW5kZXJpbmcgc3RhdGljIHRyZWVzLgogICAqLwogIGZ1bmN0aW9uIHJlbmRlclN0YXRpYyAoCiAgICBpbmRleCwKICAgIGlzSW5Gb3IKICApIHsKICAgIHZhciBjYWNoZWQgPSB0aGlzLl9zdGF0aWNUcmVlcyB8fCAodGhpcy5fc3RhdGljVHJlZXMgPSBbXSk7CiAgICB2YXIgdHJlZSA9IGNhY2hlZFtpbmRleF07CiAgICAvLyBpZiBoYXMgYWxyZWFkeS1yZW5kZXJlZCBzdGF0aWMgdHJlZSBhbmQgbm90IGluc2lkZSB2LWZvciwKICAgIC8vIHdlIGNhbiByZXVzZSB0aGUgc2FtZSB0cmVlLgogICAgaWYgKHRyZWUgJiYgIWlzSW5Gb3IpIHsKICAgICAgcmV0dXJuIHRyZWUKICAgIH0KICAgIC8vIG90aGVyd2lzZSwgcmVuZGVyIGEgZnJlc2ggdHJlZS4KICAgIHRyZWUgPSBjYWNoZWRbaW5kZXhdID0gdGhpcy4kb3B0aW9ucy5zdGF0aWNSZW5kZXJGbnNbaW5kZXhdLmNhbGwoCiAgICAgIHRoaXMuX3JlbmRlclByb3h5LAogICAgICBudWxsLAogICAgICB0aGlzIC8vIGZvciByZW5kZXIgZm5zIGdlbmVyYXRlZCBmb3IgZnVuY3Rpb25hbCBjb21wb25lbnQgdGVtcGxhdGVzCiAgICApOwogICAgbWFya1N0YXRpYyh0cmVlLCAoIl9fc3RhdGljX18iICsgaW5kZXgpLCBmYWxzZSk7CiAgICByZXR1cm4gdHJlZQogIH0KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHYtb25jZS4KICAgKiBFZmZlY3RpdmVseSBpdCBtZWFucyBtYXJraW5nIHRoZSBub2RlIGFzIHN0YXRpYyB3aXRoIGEgdW5pcXVlIGtleS4KICAgKi8KICBmdW5jdGlvbiBtYXJrT25jZSAoCiAgICB0cmVlLAogICAgaW5kZXgsCiAgICBrZXkKICApIHsKICAgIG1hcmtTdGF0aWModHJlZSwgKCJfX29uY2VfXyIgKyBpbmRleCArIChrZXkgPyAoIl8iICsga2V5KSA6ICIiKSksIHRydWUpOwogICAgcmV0dXJuIHRyZWUKICB9CgogIGZ1bmN0aW9uIG1hcmtTdGF0aWMgKAogICAgdHJlZSwKICAgIGtleSwKICAgIGlzT25jZQogICkgewogICAgaWYgKEFycmF5LmlzQXJyYXkodHJlZSkpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0cmVlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHRyZWVbaV0gJiYgdHlwZW9mIHRyZWVbaV0gIT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBtYXJrU3RhdGljTm9kZSh0cmVlW2ldLCAoa2V5ICsgIl8iICsgaSksIGlzT25jZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBtYXJrU3RhdGljTm9kZSh0cmVlLCBrZXksIGlzT25jZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBtYXJrU3RhdGljTm9kZSAobm9kZSwga2V5LCBpc09uY2UpIHsKICAgIG5vZGUuaXNTdGF0aWMgPSB0cnVlOwogICAgbm9kZS5rZXkgPSBrZXk7CiAgICBub2RlLmlzT25jZSA9IGlzT25jZTsKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBiaW5kT2JqZWN0TGlzdGVuZXJzIChkYXRhLCB2YWx1ZSkgewogICAgaWYgKHZhbHVlKSB7CiAgICAgIGlmICghaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ3Ytb24gd2l0aG91dCBhcmd1bWVudCBleHBlY3RzIGFuIE9iamVjdCB2YWx1ZScsCiAgICAgICAgICB0aGlzCiAgICAgICAgKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgb24gPSBkYXRhLm9uID0gZGF0YS5vbiA/IGV4dGVuZCh7fSwgZGF0YS5vbikgOiB7fTsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHsKICAgICAgICAgIHZhciBleGlzdGluZyA9IG9uW2tleV07CiAgICAgICAgICB2YXIgb3VycyA9IHZhbHVlW2tleV07CiAgICAgICAgICBvbltrZXldID0gZXhpc3RpbmcgPyBbXS5jb25jYXQoZXhpc3RpbmcsIG91cnMpIDogb3VyczsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gcmVzb2x2ZVNjb3BlZFNsb3RzICgKICAgIGZucywgLy8gc2VlIGZsb3cvdm5vZGUKICAgIHJlcywKICAgIC8vIHRoZSBmb2xsb3dpbmcgYXJlIGFkZGVkIGluIDIuNgogICAgaGFzRHluYW1pY0tleXMsCiAgICBjb250ZW50SGFzaEtleQogICkgewogICAgcmVzID0gcmVzIHx8IHsgJHN0YWJsZTogIWhhc0R5bmFtaWNLZXlzIH07CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZucy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc2xvdCA9IGZuc1tpXTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2xvdCkpIHsKICAgICAgICByZXNvbHZlU2NvcGVkU2xvdHMoc2xvdCwgcmVzLCBoYXNEeW5hbWljS2V5cyk7CiAgICAgIH0gZWxzZSBpZiAoc2xvdCkgewogICAgICAgIC8vIG1hcmtlciBmb3IgcmV2ZXJzZSBwcm94eWluZyB2LXNsb3Qgd2l0aG91dCBzY29wZSBvbiB0aGlzLiRzbG90cwogICAgICAgIGlmIChzbG90LnByb3h5KSB7CiAgICAgICAgICBzbG90LmZuLnByb3h5ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmVzW3Nsb3Qua2V5XSA9IHNsb3QuZm47CiAgICAgIH0KICAgIH0KICAgIGlmIChjb250ZW50SGFzaEtleSkgewogICAgICAocmVzKS4ka2V5ID0gY29udGVudEhhc2hLZXk7CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gYmluZER5bmFtaWNLZXlzIChiYXNlT2JqLCB2YWx1ZXMpIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgIHZhciBrZXkgPSB2YWx1ZXNbaV07CiAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyAmJiBrZXkpIHsKICAgICAgICBiYXNlT2JqW3ZhbHVlc1tpXV0gPSB2YWx1ZXNbaSArIDFdOwogICAgICB9IGVsc2UgaWYgKGtleSAhPT0gJycgJiYga2V5ICE9PSBudWxsKSB7CiAgICAgICAgLy8gbnVsbCBpcyBhIHNwZWNpYWwgdmFsdWUgZm9yIGV4cGxpY2l0bHkgcmVtb3ZpbmcgYSBiaW5kaW5nCiAgICAgICAgd2FybigKICAgICAgICAgICgiSW52YWxpZCB2YWx1ZSBmb3IgZHluYW1pYyBkaXJlY3RpdmUgYXJndW1lbnQgKGV4cGVjdGVkIHN0cmluZyBvciBudWxsKTogIiArIGtleSksCiAgICAgICAgICB0aGlzCiAgICAgICAgKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGJhc2VPYmoKICB9CgogIC8vIGhlbHBlciB0byBkeW5hbWljYWxseSBhcHBlbmQgbW9kaWZpZXIgcnVudGltZSBtYXJrZXJzIHRvIGV2ZW50IG5hbWVzLgogIC8vIGVuc3VyZSBvbmx5IGFwcGVuZCB3aGVuIHZhbHVlIGlzIGFscmVhZHkgc3RyaW5nLCBvdGhlcndpc2UgaXQgd2lsbCBiZSBjYXN0CiAgLy8gdG8gc3RyaW5nIGFuZCBjYXVzZSB0aGUgdHlwZSBjaGVjayB0byBtaXNzLgogIGZ1bmN0aW9uIHByZXBlbmRNb2RpZmllciAodmFsdWUsIHN5bWJvbCkgewogICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyBzeW1ib2wgKyB2YWx1ZSA6IHZhbHVlCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5zdGFsbFJlbmRlckhlbHBlcnMgKHRhcmdldCkgewogICAgdGFyZ2V0Ll9vID0gbWFya09uY2U7CiAgICB0YXJnZXQuX24gPSB0b051bWJlcjsKICAgIHRhcmdldC5fcyA9IHRvU3RyaW5nOwogICAgdGFyZ2V0Ll9sID0gcmVuZGVyTGlzdDsKICAgIHRhcmdldC5fdCA9IHJlbmRlclNsb3Q7CiAgICB0YXJnZXQuX3EgPSBsb29zZUVxdWFsOwogICAgdGFyZ2V0Ll9pID0gbG9vc2VJbmRleE9mOwogICAgdGFyZ2V0Ll9tID0gcmVuZGVyU3RhdGljOwogICAgdGFyZ2V0Ll9mID0gcmVzb2x2ZUZpbHRlcjsKICAgIHRhcmdldC5fayA9IGNoZWNrS2V5Q29kZXM7CiAgICB0YXJnZXQuX2IgPSBiaW5kT2JqZWN0UHJvcHM7CiAgICB0YXJnZXQuX3YgPSBjcmVhdGVUZXh0Vk5vZGU7CiAgICB0YXJnZXQuX2UgPSBjcmVhdGVFbXB0eVZOb2RlOwogICAgdGFyZ2V0Ll91ID0gcmVzb2x2ZVNjb3BlZFNsb3RzOwogICAgdGFyZ2V0Ll9nID0gYmluZE9iamVjdExpc3RlbmVyczsKICAgIHRhcmdldC5fZCA9IGJpbmREeW5hbWljS2V5czsKICAgIHRhcmdldC5fcCA9IHByZXBlbmRNb2RpZmllcjsKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBGdW5jdGlvbmFsUmVuZGVyQ29udGV4dCAoCiAgICBkYXRhLAogICAgcHJvcHMsCiAgICBjaGlsZHJlbiwKICAgIHBhcmVudCwKICAgIEN0b3IKICApIHsKICAgIHZhciB0aGlzJDEgPSB0aGlzOwoKICAgIHZhciBvcHRpb25zID0gQ3Rvci5vcHRpb25zOwogICAgLy8gZW5zdXJlIHRoZSBjcmVhdGVFbGVtZW50IGZ1bmN0aW9uIGluIGZ1bmN0aW9uYWwgY29tcG9uZW50cwogICAgLy8gZ2V0cyBhIHVuaXF1ZSBjb250ZXh0IC0gdGhpcyBpcyBuZWNlc3NhcnkgZm9yIGNvcnJlY3QgbmFtZWQgc2xvdCBjaGVjawogICAgdmFyIGNvbnRleHRWbTsKICAgIGlmIChoYXNPd24ocGFyZW50LCAnX3VpZCcpKSB7CiAgICAgIGNvbnRleHRWbSA9IE9iamVjdC5jcmVhdGUocGFyZW50KTsKICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgIGNvbnRleHRWbS5fb3JpZ2luYWwgPSBwYXJlbnQ7CiAgICB9IGVsc2UgewogICAgICAvLyB0aGUgY29udGV4dCB2bSBwYXNzZWQgaW4gaXMgYSBmdW5jdGlvbmFsIGNvbnRleHQgYXMgd2VsbC4KICAgICAgLy8gaW4gdGhpcyBjYXNlIHdlIHdhbnQgdG8gbWFrZSBzdXJlIHdlIGFyZSBhYmxlIHRvIGdldCBhIGhvbGQgdG8gdGhlCiAgICAgIC8vIHJlYWwgY29udGV4dCBpbnN0YW5jZS4KICAgICAgY29udGV4dFZtID0gcGFyZW50OwogICAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgICAgcGFyZW50ID0gcGFyZW50Ll9vcmlnaW5hbDsKICAgIH0KICAgIHZhciBpc0NvbXBpbGVkID0gaXNUcnVlKG9wdGlvbnMuX2NvbXBpbGVkKTsKICAgIHZhciBuZWVkTm9ybWFsaXphdGlvbiA9ICFpc0NvbXBpbGVkOwoKICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICB0aGlzLnByb3BzID0gcHJvcHM7CiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47CiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICAgIHRoaXMubGlzdGVuZXJzID0gZGF0YS5vbiB8fCBlbXB0eU9iamVjdDsKICAgIHRoaXMuaW5qZWN0aW9ucyA9IHJlc29sdmVJbmplY3Qob3B0aW9ucy5pbmplY3QsIHBhcmVudCk7CiAgICB0aGlzLnNsb3RzID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAoIXRoaXMkMS4kc2xvdHMpIHsKICAgICAgICBub3JtYWxpemVTY29wZWRTbG90cygKICAgICAgICAgIGRhdGEuc2NvcGVkU2xvdHMsCiAgICAgICAgICB0aGlzJDEuJHNsb3RzID0gcmVzb2x2ZVNsb3RzKGNoaWxkcmVuLCBwYXJlbnQpCiAgICAgICAgKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcyQxLiRzbG90cwogICAgfTsKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ3Njb3BlZFNsb3RzJywgKHsKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQgKCkgewogICAgICAgIHJldHVybiBub3JtYWxpemVTY29wZWRTbG90cyhkYXRhLnNjb3BlZFNsb3RzLCB0aGlzLnNsb3RzKCkpCiAgICAgIH0KICAgIH0pKTsKCiAgICAvLyBzdXBwb3J0IGZvciBjb21waWxlZCBmdW5jdGlvbmFsIHRlbXBsYXRlCiAgICBpZiAoaXNDb21waWxlZCkgewogICAgICAvLyBleHBvc2luZyAkb3B0aW9ucyBmb3IgcmVuZGVyU3RhdGljKCkKICAgICAgdGhpcy4kb3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIC8vIHByZS1yZXNvbHZlIHNsb3RzIGZvciByZW5kZXJTbG90KCkKICAgICAgdGhpcy4kc2xvdHMgPSB0aGlzLnNsb3RzKCk7CiAgICAgIHRoaXMuJHNjb3BlZFNsb3RzID0gbm9ybWFsaXplU2NvcGVkU2xvdHMoZGF0YS5zY29wZWRTbG90cywgdGhpcy4kc2xvdHMpOwogICAgfQoKICAgIGlmIChvcHRpb25zLl9zY29wZUlkKSB7CiAgICAgIHRoaXMuX2MgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIHZhciB2bm9kZSA9IGNyZWF0ZUVsZW1lbnQoY29udGV4dFZtLCBhLCBiLCBjLCBkLCBuZWVkTm9ybWFsaXphdGlvbik7CiAgICAgICAgaWYgKHZub2RlICYmICFBcnJheS5pc0FycmF5KHZub2RlKSkgewogICAgICAgICAgdm5vZGUuZm5TY29wZUlkID0gb3B0aW9ucy5fc2NvcGVJZDsKICAgICAgICAgIHZub2RlLmZuQ29udGV4dCA9IHBhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZub2RlCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9jID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgcmV0dXJuIGNyZWF0ZUVsZW1lbnQoY29udGV4dFZtLCBhLCBiLCBjLCBkLCBuZWVkTm9ybWFsaXphdGlvbik7IH07CiAgICB9CiAgfQoKICBpbnN0YWxsUmVuZGVySGVscGVycyhGdW5jdGlvbmFsUmVuZGVyQ29udGV4dC5wcm90b3R5cGUpOwoKICBmdW5jdGlvbiBjcmVhdGVGdW5jdGlvbmFsQ29tcG9uZW50ICgKICAgIEN0b3IsCiAgICBwcm9wc0RhdGEsCiAgICBkYXRhLAogICAgY29udGV4dFZtLAogICAgY2hpbGRyZW4KICApIHsKICAgIHZhciBvcHRpb25zID0gQ3Rvci5vcHRpb25zOwogICAgdmFyIHByb3BzID0ge307CiAgICB2YXIgcHJvcE9wdGlvbnMgPSBvcHRpb25zLnByb3BzOwogICAgaWYgKGlzRGVmKHByb3BPcHRpb25zKSkgewogICAgICBmb3IgKHZhciBrZXkgaW4gcHJvcE9wdGlvbnMpIHsKICAgICAgICBwcm9wc1trZXldID0gdmFsaWRhdGVQcm9wKGtleSwgcHJvcE9wdGlvbnMsIHByb3BzRGF0YSB8fCBlbXB0eU9iamVjdCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChpc0RlZihkYXRhLmF0dHJzKSkgeyBtZXJnZVByb3BzKHByb3BzLCBkYXRhLmF0dHJzKTsgfQogICAgICBpZiAoaXNEZWYoZGF0YS5wcm9wcykpIHsgbWVyZ2VQcm9wcyhwcm9wcywgZGF0YS5wcm9wcyk7IH0KICAgIH0KCiAgICB2YXIgcmVuZGVyQ29udGV4dCA9IG5ldyBGdW5jdGlvbmFsUmVuZGVyQ29udGV4dCgKICAgICAgZGF0YSwKICAgICAgcHJvcHMsCiAgICAgIGNoaWxkcmVuLAogICAgICBjb250ZXh0Vm0sCiAgICAgIEN0b3IKICAgICk7CgogICAgdmFyIHZub2RlID0gb3B0aW9ucy5yZW5kZXIuY2FsbChudWxsLCByZW5kZXJDb250ZXh0Ll9jLCByZW5kZXJDb250ZXh0KTsKCiAgICBpZiAodm5vZGUgaW5zdGFuY2VvZiBWTm9kZSkgewogICAgICByZXR1cm4gY2xvbmVBbmRNYXJrRnVuY3Rpb25hbFJlc3VsdCh2bm9kZSwgZGF0YSwgcmVuZGVyQ29udGV4dC5wYXJlbnQsIG9wdGlvbnMsIHJlbmRlckNvbnRleHQpCiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodm5vZGUpKSB7CiAgICAgIHZhciB2bm9kZXMgPSBub3JtYWxpemVDaGlsZHJlbih2bm9kZSkgfHwgW107CiAgICAgIHZhciByZXMgPSBuZXcgQXJyYXkodm5vZGVzLmxlbmd0aCk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcmVzW2ldID0gY2xvbmVBbmRNYXJrRnVuY3Rpb25hbFJlc3VsdCh2bm9kZXNbaV0sIGRhdGEsIHJlbmRlckNvbnRleHQucGFyZW50LCBvcHRpb25zLCByZW5kZXJDb250ZXh0KTsKICAgICAgfQogICAgICByZXR1cm4gcmVzCiAgICB9CiAgfQoKICBmdW5jdGlvbiBjbG9uZUFuZE1hcmtGdW5jdGlvbmFsUmVzdWx0ICh2bm9kZSwgZGF0YSwgY29udGV4dFZtLCBvcHRpb25zLCByZW5kZXJDb250ZXh0KSB7CiAgICAvLyAjNzgxNyBjbG9uZSBub2RlIGJlZm9yZSBzZXR0aW5nIGZuQ29udGV4dCwgb3RoZXJ3aXNlIGlmIHRoZSBub2RlIGlzIHJldXNlZAogICAgLy8gKGUuZy4gaXQgd2FzIGZyb20gYSBjYWNoZWQgbm9ybWFsIHNsb3QpIHRoZSBmbkNvbnRleHQgY2F1c2VzIG5hbWVkIHNsb3RzCiAgICAvLyB0aGF0IHNob3VsZCBub3QgYmUgbWF0Y2hlZCB0byBtYXRjaC4KICAgIHZhciBjbG9uZSA9IGNsb25lVk5vZGUodm5vZGUpOwogICAgY2xvbmUuZm5Db250ZXh0ID0gY29udGV4dFZtOwogICAgY2xvbmUuZm5PcHRpb25zID0gb3B0aW9uczsKICAgIHsKICAgICAgKGNsb25lLmRldnRvb2xzTWV0YSA9IGNsb25lLmRldnRvb2xzTWV0YSB8fCB7fSkucmVuZGVyQ29udGV4dCA9IHJlbmRlckNvbnRleHQ7CiAgICB9CiAgICBpZiAoZGF0YS5zbG90KSB7CiAgICAgIChjbG9uZS5kYXRhIHx8IChjbG9uZS5kYXRhID0ge30pKS5zbG90ID0gZGF0YS5zbG90OwogICAgfQogICAgcmV0dXJuIGNsb25lCiAgfQoKICBmdW5jdGlvbiBtZXJnZVByb3BzICh0bywgZnJvbSkgewogICAgZm9yICh2YXIga2V5IGluIGZyb20pIHsKICAgICAgdG9bY2FtZWxpemUoa2V5KV0gPSBmcm9tW2tleV07CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyogICovCgogIC8qICAqLwoKICAvKiAgKi8KCiAgLy8gaW5saW5lIGhvb2tzIHRvIGJlIGludm9rZWQgb24gY29tcG9uZW50IFZOb2RlcyBkdXJpbmcgcGF0Y2gKICB2YXIgY29tcG9uZW50Vk5vZGVIb29rcyA9IHsKICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQgKHZub2RlLCBoeWRyYXRpbmcpIHsKICAgICAgaWYgKAogICAgICAgIHZub2RlLmNvbXBvbmVudEluc3RhbmNlICYmCiAgICAgICAgIXZub2RlLmNvbXBvbmVudEluc3RhbmNlLl9pc0Rlc3Ryb3llZCAmJgogICAgICAgIHZub2RlLmRhdGEua2VlcEFsaXZlCiAgICAgICkgewogICAgICAgIC8vIGtlcHQtYWxpdmUgY29tcG9uZW50cywgdHJlYXQgYXMgYSBwYXRjaAogICAgICAgIHZhciBtb3VudGVkTm9kZSA9IHZub2RlOyAvLyB3b3JrIGFyb3VuZCBmbG93CiAgICAgICAgY29tcG9uZW50Vk5vZGVIb29rcy5wcmVwYXRjaChtb3VudGVkTm9kZSwgbW91bnRlZE5vZGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBjaGlsZCA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlID0gY3JlYXRlQ29tcG9uZW50SW5zdGFuY2VGb3JWbm9kZSgKICAgICAgICAgIHZub2RlLAogICAgICAgICAgYWN0aXZlSW5zdGFuY2UKICAgICAgICApOwogICAgICAgIGNoaWxkLiRtb3VudChoeWRyYXRpbmcgPyB2bm9kZS5lbG0gOiB1bmRlZmluZWQsIGh5ZHJhdGluZyk7CiAgICAgIH0KICAgIH0sCgogICAgcHJlcGF0Y2g6IGZ1bmN0aW9uIHByZXBhdGNoIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSB2bm9kZS5jb21wb25lbnRPcHRpb25zOwogICAgICB2YXIgY2hpbGQgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSA9IG9sZFZub2RlLmNvbXBvbmVudEluc3RhbmNlOwogICAgICB1cGRhdGVDaGlsZENvbXBvbmVudCgKICAgICAgICBjaGlsZCwKICAgICAgICBvcHRpb25zLnByb3BzRGF0YSwgLy8gdXBkYXRlZCBwcm9wcwogICAgICAgIG9wdGlvbnMubGlzdGVuZXJzLCAvLyB1cGRhdGVkIGxpc3RlbmVycwogICAgICAgIHZub2RlLCAvLyBuZXcgcGFyZW50IHZub2RlCiAgICAgICAgb3B0aW9ucy5jaGlsZHJlbiAvLyBuZXcgY2hpbGRyZW4KICAgICAgKTsKICAgIH0sCgogICAgaW5zZXJ0OiBmdW5jdGlvbiBpbnNlcnQgKHZub2RlKSB7CiAgICAgIHZhciBjb250ZXh0ID0gdm5vZGUuY29udGV4dDsKICAgICAgdmFyIGNvbXBvbmVudEluc3RhbmNlID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICAgIGlmICghY29tcG9uZW50SW5zdGFuY2UuX2lzTW91bnRlZCkgewogICAgICAgIGNvbXBvbmVudEluc3RhbmNlLl9pc01vdW50ZWQgPSB0cnVlOwogICAgICAgIGNhbGxIb29rKGNvbXBvbmVudEluc3RhbmNlLCAnbW91bnRlZCcpOwogICAgICB9CiAgICAgIGlmICh2bm9kZS5kYXRhLmtlZXBBbGl2ZSkgewogICAgICAgIGlmIChjb250ZXh0Ll9pc01vdW50ZWQpIHsKICAgICAgICAgIC8vIHZ1ZS1yb3V0ZXIjMTIxMgogICAgICAgICAgLy8gRHVyaW5nIHVwZGF0ZXMsIGEga2VwdC1hbGl2ZSBjb21wb25lbnQncyBjaGlsZCBjb21wb25lbnRzIG1heQogICAgICAgICAgLy8gY2hhbmdlLCBzbyBkaXJlY3RseSB3YWxraW5nIHRoZSB0cmVlIGhlcmUgbWF5IGNhbGwgYWN0aXZhdGVkIGhvb2tzCiAgICAgICAgICAvLyBvbiBpbmNvcnJlY3QgY2hpbGRyZW4uIEluc3RlYWQgd2UgcHVzaCB0aGVtIGludG8gYSBxdWV1ZSB3aGljaCB3aWxsCiAgICAgICAgICAvLyBiZSBwcm9jZXNzZWQgYWZ0ZXIgdGhlIHdob2xlIHBhdGNoIHByb2Nlc3MgZW5kZWQuCiAgICAgICAgICBxdWV1ZUFjdGl2YXRlZENvbXBvbmVudChjb21wb25lbnRJbnN0YW5jZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFjdGl2YXRlQ2hpbGRDb21wb25lbnQoY29tcG9uZW50SW5zdGFuY2UsIHRydWUgLyogZGlyZWN0ICovKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSAodm5vZGUpIHsKICAgICAgdmFyIGNvbXBvbmVudEluc3RhbmNlID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICAgIGlmICghY29tcG9uZW50SW5zdGFuY2UuX2lzRGVzdHJveWVkKSB7CiAgICAgICAgaWYgKCF2bm9kZS5kYXRhLmtlZXBBbGl2ZSkgewogICAgICAgICAgY29tcG9uZW50SW5zdGFuY2UuJGRlc3Ryb3koKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVhY3RpdmF0ZUNoaWxkQ29tcG9uZW50KGNvbXBvbmVudEluc3RhbmNlLCB0cnVlIC8qIGRpcmVjdCAqLyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIGhvb2tzVG9NZXJnZSA9IE9iamVjdC5rZXlzKGNvbXBvbmVudFZOb2RlSG9va3MpOwoKICBmdW5jdGlvbiBjcmVhdGVDb21wb25lbnQgKAogICAgQ3RvciwKICAgIGRhdGEsCiAgICBjb250ZXh0LAogICAgY2hpbGRyZW4sCiAgICB0YWcKICApIHsKICAgIGlmIChpc1VuZGVmKEN0b3IpKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBiYXNlQ3RvciA9IGNvbnRleHQuJG9wdGlvbnMuX2Jhc2U7CgogICAgLy8gcGxhaW4gb3B0aW9ucyBvYmplY3Q6IHR1cm4gaXQgaW50byBhIGNvbnN0cnVjdG9yCiAgICBpZiAoaXNPYmplY3QoQ3RvcikpIHsKICAgICAgQ3RvciA9IGJhc2VDdG9yLmV4dGVuZChDdG9yKTsKICAgIH0KCiAgICAvLyBpZiBhdCB0aGlzIHN0YWdlIGl0J3Mgbm90IGEgY29uc3RydWN0b3Igb3IgYW4gYXN5bmMgY29tcG9uZW50IGZhY3RvcnksCiAgICAvLyByZWplY3QuCiAgICBpZiAodHlwZW9mIEN0b3IgIT09ICdmdW5jdGlvbicpIHsKICAgICAgewogICAgICAgIHdhcm4oKCJJbnZhbGlkIENvbXBvbmVudCBkZWZpbml0aW9uOiAiICsgKFN0cmluZyhDdG9yKSkpLCBjb250ZXh0KTsKICAgICAgfQogICAgICByZXR1cm4KICAgIH0KCiAgICAvLyBhc3luYyBjb21wb25lbnQKICAgIHZhciBhc3luY0ZhY3Rvcnk7CiAgICBpZiAoaXNVbmRlZihDdG9yLmNpZCkpIHsKICAgICAgYXN5bmNGYWN0b3J5ID0gQ3RvcjsKICAgICAgQ3RvciA9IHJlc29sdmVBc3luY0NvbXBvbmVudChhc3luY0ZhY3RvcnksIGJhc2VDdG9yKTsKICAgICAgaWYgKEN0b3IgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIHJldHVybiBhIHBsYWNlaG9sZGVyIG5vZGUgZm9yIGFzeW5jIGNvbXBvbmVudCwgd2hpY2ggaXMgcmVuZGVyZWQKICAgICAgICAvLyBhcyBhIGNvbW1lbnQgbm9kZSBidXQgcHJlc2VydmVzIGFsbCB0aGUgcmF3IGluZm9ybWF0aW9uIGZvciB0aGUgbm9kZS4KICAgICAgICAvLyB0aGUgaW5mb3JtYXRpb24gd2lsbCBiZSB1c2VkIGZvciBhc3luYyBzZXJ2ZXItcmVuZGVyaW5nIGFuZCBoeWRyYXRpb24uCiAgICAgICAgcmV0dXJuIGNyZWF0ZUFzeW5jUGxhY2Vob2xkZXIoCiAgICAgICAgICBhc3luY0ZhY3RvcnksCiAgICAgICAgICBkYXRhLAogICAgICAgICAgY29udGV4dCwKICAgICAgICAgIGNoaWxkcmVuLAogICAgICAgICAgdGFnCiAgICAgICAgKQogICAgICB9CiAgICB9CgogICAgZGF0YSA9IGRhdGEgfHwge307CgogICAgLy8gcmVzb2x2ZSBjb25zdHJ1Y3RvciBvcHRpb25zIGluIGNhc2UgZ2xvYmFsIG1peGlucyBhcmUgYXBwbGllZCBhZnRlcgogICAgLy8gY29tcG9uZW50IGNvbnN0cnVjdG9yIGNyZWF0aW9uCiAgICByZXNvbHZlQ29uc3RydWN0b3JPcHRpb25zKEN0b3IpOwoKICAgIC8vIHRyYW5zZm9ybSBjb21wb25lbnQgdi1tb2RlbCBkYXRhIGludG8gcHJvcHMgJiBldmVudHMKICAgIGlmIChpc0RlZihkYXRhLm1vZGVsKSkgewogICAgICB0cmFuc2Zvcm1Nb2RlbChDdG9yLm9wdGlvbnMsIGRhdGEpOwogICAgfQoKICAgIC8vIGV4dHJhY3QgcHJvcHMKICAgIHZhciBwcm9wc0RhdGEgPSBleHRyYWN0UHJvcHNGcm9tVk5vZGVEYXRhKGRhdGEsIEN0b3IsIHRhZyk7CgogICAgLy8gZnVuY3Rpb25hbCBjb21wb25lbnQKICAgIGlmIChpc1RydWUoQ3Rvci5vcHRpb25zLmZ1bmN0aW9uYWwpKSB7CiAgICAgIHJldHVybiBjcmVhdGVGdW5jdGlvbmFsQ29tcG9uZW50KEN0b3IsIHByb3BzRGF0YSwgZGF0YSwgY29udGV4dCwgY2hpbGRyZW4pCiAgICB9CgogICAgLy8gZXh0cmFjdCBsaXN0ZW5lcnMsIHNpbmNlIHRoZXNlIG5lZWRzIHRvIGJlIHRyZWF0ZWQgYXMKICAgIC8vIGNoaWxkIGNvbXBvbmVudCBsaXN0ZW5lcnMgaW5zdGVhZCBvZiBET00gbGlzdGVuZXJzCiAgICB2YXIgbGlzdGVuZXJzID0gZGF0YS5vbjsKICAgIC8vIHJlcGxhY2Ugd2l0aCBsaXN0ZW5lcnMgd2l0aCAubmF0aXZlIG1vZGlmaWVyCiAgICAvLyBzbyBpdCBnZXRzIHByb2Nlc3NlZCBkdXJpbmcgcGFyZW50IGNvbXBvbmVudCBwYXRjaC4KICAgIGRhdGEub24gPSBkYXRhLm5hdGl2ZU9uOwoKICAgIGlmIChpc1RydWUoQ3Rvci5vcHRpb25zLmFic3RyYWN0KSkgewogICAgICAvLyBhYnN0cmFjdCBjb21wb25lbnRzIGRvIG5vdCBrZWVwIGFueXRoaW5nCiAgICAgIC8vIG90aGVyIHRoYW4gcHJvcHMgJiBsaXN0ZW5lcnMgJiBzbG90CgogICAgICAvLyB3b3JrIGFyb3VuZCBmbG93CiAgICAgIHZhciBzbG90ID0gZGF0YS5zbG90OwogICAgICBkYXRhID0ge307CiAgICAgIGlmIChzbG90KSB7CiAgICAgICAgZGF0YS5zbG90ID0gc2xvdDsKICAgICAgfQogICAgfQoKICAgIC8vIGluc3RhbGwgY29tcG9uZW50IG1hbmFnZW1lbnQgaG9va3Mgb250byB0aGUgcGxhY2Vob2xkZXIgbm9kZQogICAgaW5zdGFsbENvbXBvbmVudEhvb2tzKGRhdGEpOwoKICAgIC8vIHJldHVybiBhIHBsYWNlaG9sZGVyIHZub2RlCiAgICB2YXIgbmFtZSA9IEN0b3Iub3B0aW9ucy5uYW1lIHx8IHRhZzsKICAgIHZhciB2bm9kZSA9IG5ldyBWTm9kZSgKICAgICAgKCJ2dWUtY29tcG9uZW50LSIgKyAoQ3Rvci5jaWQpICsgKG5hbWUgPyAoIi0iICsgbmFtZSkgOiAnJykpLAogICAgICBkYXRhLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjb250ZXh0LAogICAgICB7IEN0b3I6IEN0b3IsIHByb3BzRGF0YTogcHJvcHNEYXRhLCBsaXN0ZW5lcnM6IGxpc3RlbmVycywgdGFnOiB0YWcsIGNoaWxkcmVuOiBjaGlsZHJlbiB9LAogICAgICBhc3luY0ZhY3RvcnkKICAgICk7CgogICAgcmV0dXJuIHZub2RlCiAgfQoKICBmdW5jdGlvbiBjcmVhdGVDb21wb25lbnRJbnN0YW5jZUZvclZub2RlICgKICAgIHZub2RlLCAvLyB3ZSBrbm93IGl0J3MgTW91bnRlZENvbXBvbmVudFZOb2RlIGJ1dCBmbG93IGRvZXNuJ3QKICAgIHBhcmVudCAvLyBhY3RpdmVJbnN0YW5jZSBpbiBsaWZlY3ljbGUgc3RhdGUKICApIHsKICAgIHZhciBvcHRpb25zID0gewogICAgICBfaXNDb21wb25lbnQ6IHRydWUsCiAgICAgIF9wYXJlbnRWbm9kZTogdm5vZGUsCiAgICAgIHBhcmVudDogcGFyZW50CiAgICB9OwogICAgLy8gY2hlY2sgaW5saW5lLXRlbXBsYXRlIHJlbmRlciBmdW5jdGlvbnMKICAgIHZhciBpbmxpbmVUZW1wbGF0ZSA9IHZub2RlLmRhdGEuaW5saW5lVGVtcGxhdGU7CiAgICBpZiAoaXNEZWYoaW5saW5lVGVtcGxhdGUpKSB7CiAgICAgIG9wdGlvbnMucmVuZGVyID0gaW5saW5lVGVtcGxhdGUucmVuZGVyOwogICAgICBvcHRpb25zLnN0YXRpY1JlbmRlckZucyA9IGlubGluZVRlbXBsYXRlLnN0YXRpY1JlbmRlckZuczsKICAgIH0KICAgIHJldHVybiBuZXcgdm5vZGUuY29tcG9uZW50T3B0aW9ucy5DdG9yKG9wdGlvbnMpCiAgfQoKICBmdW5jdGlvbiBpbnN0YWxsQ29tcG9uZW50SG9va3MgKGRhdGEpIHsKICAgIHZhciBob29rcyA9IGRhdGEuaG9vayB8fCAoZGF0YS5ob29rID0ge30pOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rc1RvTWVyZ2UubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGtleSA9IGhvb2tzVG9NZXJnZVtpXTsKICAgICAgdmFyIGV4aXN0aW5nID0gaG9va3Nba2V5XTsKICAgICAgdmFyIHRvTWVyZ2UgPSBjb21wb25lbnRWTm9kZUhvb2tzW2tleV07CiAgICAgIGlmIChleGlzdGluZyAhPT0gdG9NZXJnZSAmJiAhKGV4aXN0aW5nICYmIGV4aXN0aW5nLl9tZXJnZWQpKSB7CiAgICAgICAgaG9va3Nba2V5XSA9IGV4aXN0aW5nID8gbWVyZ2VIb29rJDEodG9NZXJnZSwgZXhpc3RpbmcpIDogdG9NZXJnZTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gbWVyZ2VIb29rJDEgKGYxLCBmMikgewogICAgdmFyIG1lcmdlZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgIC8vIGZsb3cgY29tcGxhaW5zIGFib3V0IGV4dHJhIGFyZ3Mgd2hpY2ggaXMgd2h5IHdlIHVzZSBhbnkKICAgICAgZjEoYSwgYik7CiAgICAgIGYyKGEsIGIpOwogICAgfTsKICAgIG1lcmdlZC5fbWVyZ2VkID0gdHJ1ZTsKICAgIHJldHVybiBtZXJnZWQKICB9CgogIC8vIHRyYW5zZm9ybSBjb21wb25lbnQgdi1tb2RlbCBpbmZvICh2YWx1ZSBhbmQgY2FsbGJhY2spIGludG8KICAvLyBwcm9wIGFuZCBldmVudCBoYW5kbGVyIHJlc3BlY3RpdmVseS4KICBmdW5jdGlvbiB0cmFuc2Zvcm1Nb2RlbCAob3B0aW9ucywgZGF0YSkgewogICAgdmFyIHByb3AgPSAob3B0aW9ucy5tb2RlbCAmJiBvcHRpb25zLm1vZGVsLnByb3ApIHx8ICd2YWx1ZSc7CiAgICB2YXIgZXZlbnQgPSAob3B0aW9ucy5tb2RlbCAmJiBvcHRpb25zLm1vZGVsLmV2ZW50KSB8fCAnaW5wdXQnCiAgICA7KGRhdGEuYXR0cnMgfHwgKGRhdGEuYXR0cnMgPSB7fSkpW3Byb3BdID0gZGF0YS5tb2RlbC52YWx1ZTsKICAgIHZhciBvbiA9IGRhdGEub24gfHwgKGRhdGEub24gPSB7fSk7CiAgICB2YXIgZXhpc3RpbmcgPSBvbltldmVudF07CiAgICB2YXIgY2FsbGJhY2sgPSBkYXRhLm1vZGVsLmNhbGxiYWNrOwogICAgaWYgKGlzRGVmKGV4aXN0aW5nKSkgewogICAgICBpZiAoCiAgICAgICAgQXJyYXkuaXNBcnJheShleGlzdGluZykKICAgICAgICAgID8gZXhpc3RpbmcuaW5kZXhPZihjYWxsYmFjaykgPT09IC0xCiAgICAgICAgICA6IGV4aXN0aW5nICE9PSBjYWxsYmFjawogICAgICApIHsKICAgICAgICBvbltldmVudF0gPSBbY2FsbGJhY2tdLmNvbmNhdChleGlzdGluZyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIG9uW2V2ZW50XSA9IGNhbGxiYWNrOwogICAgfQogIH0KCiAgLyogICovCgogIHZhciBTSU1QTEVfTk9STUFMSVpFID0gMTsKICB2YXIgQUxXQVlTX05PUk1BTElaRSA9IDI7CgogIC8vIHdyYXBwZXIgZnVuY3Rpb24gZm9yIHByb3ZpZGluZyBhIG1vcmUgZmxleGlibGUgaW50ZXJmYWNlCiAgLy8gd2l0aG91dCBnZXR0aW5nIHllbGxlZCBhdCBieSBmbG93CiAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCAoCiAgICBjb250ZXh0LAogICAgdGFnLAogICAgZGF0YSwKICAgIGNoaWxkcmVuLAogICAgbm9ybWFsaXphdGlvblR5cGUsCiAgICBhbHdheXNOb3JtYWxpemUKICApIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpIHx8IGlzUHJpbWl0aXZlKGRhdGEpKSB7CiAgICAgIG5vcm1hbGl6YXRpb25UeXBlID0gY2hpbGRyZW47CiAgICAgIGNoaWxkcmVuID0gZGF0YTsKICAgICAgZGF0YSA9IHVuZGVmaW5lZDsKICAgIH0KICAgIGlmIChpc1RydWUoYWx3YXlzTm9ybWFsaXplKSkgewogICAgICBub3JtYWxpemF0aW9uVHlwZSA9IEFMV0FZU19OT1JNQUxJWkU7CiAgICB9CiAgICByZXR1cm4gX2NyZWF0ZUVsZW1lbnQoY29udGV4dCwgdGFnLCBkYXRhLCBjaGlsZHJlbiwgbm9ybWFsaXphdGlvblR5cGUpCiAgfQoKICBmdW5jdGlvbiBfY3JlYXRlRWxlbWVudCAoCiAgICBjb250ZXh0LAogICAgdGFnLAogICAgZGF0YSwKICAgIGNoaWxkcmVuLAogICAgbm9ybWFsaXphdGlvblR5cGUKICApIHsKICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZigoZGF0YSkuX19vYl9fKSkgewogICAgICB3YXJuKAogICAgICAgICJBdm9pZCB1c2luZyBvYnNlcnZlZCBkYXRhIG9iamVjdCBhcyB2bm9kZSBkYXRhOiAiICsgKEpTT04uc3RyaW5naWZ5KGRhdGEpKSArICJcbiIgKwogICAgICAgICdBbHdheXMgY3JlYXRlIGZyZXNoIHZub2RlIGRhdGEgb2JqZWN0cyBpbiBlYWNoIHJlbmRlciEnLAogICAgICAgIGNvbnRleHQKICAgICAgKTsKICAgICAgcmV0dXJuIGNyZWF0ZUVtcHR5Vk5vZGUoKQogICAgfQogICAgLy8gb2JqZWN0IHN5bnRheCBpbiB2LWJpbmQKICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZihkYXRhLmlzKSkgewogICAgICB0YWcgPSBkYXRhLmlzOwogICAgfQogICAgaWYgKCF0YWcpIHsKICAgICAgLy8gaW4gY2FzZSBvZiBjb21wb25lbnQgOmlzIHNldCB0byBmYWxzeSB2YWx1ZQogICAgICByZXR1cm4gY3JlYXRlRW1wdHlWTm9kZSgpCiAgICB9CiAgICAvLyB3YXJuIGFnYWluc3Qgbm9uLXByaW1pdGl2ZSBrZXkKICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZihkYXRhLmtleSkgJiYgIWlzUHJpbWl0aXZlKGRhdGEua2V5KQogICAgKSB7CiAgICAgIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ0F2b2lkIHVzaW5nIG5vbi1wcmltaXRpdmUgdmFsdWUgYXMga2V5LCAnICsKICAgICAgICAgICd1c2Ugc3RyaW5nL251bWJlciB2YWx1ZSBpbnN0ZWFkLicsCiAgICAgICAgICBjb250ZXh0CiAgICAgICAgKTsKICAgICAgfQogICAgfQogICAgLy8gc3VwcG9ydCBzaW5nbGUgZnVuY3Rpb24gY2hpbGRyZW4gYXMgZGVmYXVsdCBzY29wZWQgc2xvdAogICAgaWYgKEFycmF5LmlzQXJyYXkoY2hpbGRyZW4pICYmCiAgICAgIHR5cGVvZiBjaGlsZHJlblswXSA9PT0gJ2Z1bmN0aW9uJwogICAgKSB7CiAgICAgIGRhdGEgPSBkYXRhIHx8IHt9OwogICAgICBkYXRhLnNjb3BlZFNsb3RzID0geyBkZWZhdWx0OiBjaGlsZHJlblswXSB9OwogICAgICBjaGlsZHJlbi5sZW5ndGggPSAwOwogICAgfQogICAgaWYgKG5vcm1hbGl6YXRpb25UeXBlID09PSBBTFdBWVNfTk9STUFMSVpFKSB7CiAgICAgIGNoaWxkcmVuID0gbm9ybWFsaXplQ2hpbGRyZW4oY2hpbGRyZW4pOwogICAgfSBlbHNlIGlmIChub3JtYWxpemF0aW9uVHlwZSA9PT0gU0lNUExFX05PUk1BTElaRSkgewogICAgICBjaGlsZHJlbiA9IHNpbXBsZU5vcm1hbGl6ZUNoaWxkcmVuKGNoaWxkcmVuKTsKICAgIH0KICAgIHZhciB2bm9kZSwgbnM7CiAgICBpZiAodHlwZW9mIHRhZyA9PT0gJ3N0cmluZycpIHsKICAgICAgdmFyIEN0b3I7CiAgICAgIG5zID0gKGNvbnRleHQuJHZub2RlICYmIGNvbnRleHQuJHZub2RlLm5zKSB8fCBjb25maWcuZ2V0VGFnTmFtZXNwYWNlKHRhZyk7CiAgICAgIGlmIChjb25maWcuaXNSZXNlcnZlZFRhZyh0YWcpKSB7CiAgICAgICAgLy8gcGxhdGZvcm0gYnVpbHQtaW4gZWxlbWVudHMKICAgICAgICBpZiAoaXNEZWYoZGF0YSkgJiYgaXNEZWYoZGF0YS5uYXRpdmVPbikpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICgiVGhlIC5uYXRpdmUgbW9kaWZpZXIgZm9yIHYtb24gaXMgb25seSB2YWxpZCBvbiBjb21wb25lbnRzIGJ1dCBpdCB3YXMgdXNlZCBvbiA8IiArIHRhZyArICI+LiIpLAogICAgICAgICAgICBjb250ZXh0CiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB2bm9kZSA9IG5ldyBWTm9kZSgKICAgICAgICAgIGNvbmZpZy5wYXJzZVBsYXRmb3JtVGFnTmFtZSh0YWcpLCBkYXRhLCBjaGlsZHJlbiwKICAgICAgICAgIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjb250ZXh0CiAgICAgICAgKTsKICAgICAgfSBlbHNlIGlmICgoIWRhdGEgfHwgIWRhdGEucHJlKSAmJiBpc0RlZihDdG9yID0gcmVzb2x2ZUFzc2V0KGNvbnRleHQuJG9wdGlvbnMsICdjb21wb25lbnRzJywgdGFnKSkpIHsKICAgICAgICAvLyBjb21wb25lbnQKICAgICAgICB2bm9kZSA9IGNyZWF0ZUNvbXBvbmVudChDdG9yLCBkYXRhLCBjb250ZXh0LCBjaGlsZHJlbiwgdGFnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB1bmtub3duIG9yIHVubGlzdGVkIG5hbWVzcGFjZWQgZWxlbWVudHMKICAgICAgICAvLyBjaGVjayBhdCBydW50aW1lIGJlY2F1c2UgaXQgbWF5IGdldCBhc3NpZ25lZCBhIG5hbWVzcGFjZSB3aGVuIGl0cwogICAgICAgIC8vIHBhcmVudCBub3JtYWxpemVzIGNoaWxkcmVuCiAgICAgICAgdm5vZGUgPSBuZXcgVk5vZGUoCiAgICAgICAgICB0YWcsIGRhdGEsIGNoaWxkcmVuLAogICAgICAgICAgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvbnRleHQKICAgICAgICApOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAvLyBkaXJlY3QgY29tcG9uZW50IG9wdGlvbnMgLyBjb25zdHJ1Y3RvcgogICAgICB2bm9kZSA9IGNyZWF0ZUNvbXBvbmVudCh0YWcsIGRhdGEsIGNvbnRleHQsIGNoaWxkcmVuKTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHZub2RlKSkgewogICAgICByZXR1cm4gdm5vZGUKICAgIH0gZWxzZSBpZiAoaXNEZWYodm5vZGUpKSB7CiAgICAgIGlmIChpc0RlZihucykpIHsgYXBwbHlOUyh2bm9kZSwgbnMpOyB9CiAgICAgIGlmIChpc0RlZihkYXRhKSkgeyByZWdpc3RlckRlZXBCaW5kaW5ncyhkYXRhKTsgfQogICAgICByZXR1cm4gdm5vZGUKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBjcmVhdGVFbXB0eVZOb2RlKCkKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFwcGx5TlMgKHZub2RlLCBucywgZm9yY2UpIHsKICAgIHZub2RlLm5zID0gbnM7CiAgICBpZiAodm5vZGUudGFnID09PSAnZm9yZWlnbk9iamVjdCcpIHsKICAgICAgLy8gdXNlIGRlZmF1bHQgbmFtZXNwYWNlIGluc2lkZSBmb3JlaWduT2JqZWN0CiAgICAgIG5zID0gdW5kZWZpbmVkOwogICAgICBmb3JjZSA9IHRydWU7CiAgICB9CiAgICBpZiAoaXNEZWYodm5vZGUuY2hpbGRyZW4pKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdm5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdmFyIGNoaWxkID0gdm5vZGUuY2hpbGRyZW5baV07CiAgICAgICAgaWYgKGlzRGVmKGNoaWxkLnRhZykgJiYgKAogICAgICAgICAgaXNVbmRlZihjaGlsZC5ucykgfHwgKGlzVHJ1ZShmb3JjZSkgJiYgY2hpbGQudGFnICE9PSAnc3ZnJykpKSB7CiAgICAgICAgICBhcHBseU5TKGNoaWxkLCBucywgZm9yY2UpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8gcmVmICM1MzE4CiAgLy8gbmVjZXNzYXJ5IHRvIGVuc3VyZSBwYXJlbnQgcmUtcmVuZGVyIHdoZW4gZGVlcCBiaW5kaW5ncyBsaWtlIDpzdHlsZSBhbmQKICAvLyA6Y2xhc3MgYXJlIHVzZWQgb24gc2xvdCBub2RlcwogIGZ1bmN0aW9uIHJlZ2lzdGVyRGVlcEJpbmRpbmdzIChkYXRhKSB7CiAgICBpZiAoaXNPYmplY3QoZGF0YS5zdHlsZSkpIHsKICAgICAgdHJhdmVyc2UoZGF0YS5zdHlsZSk7CiAgICB9CiAgICBpZiAoaXNPYmplY3QoZGF0YS5jbGFzcykpIHsKICAgICAgdHJhdmVyc2UoZGF0YS5jbGFzcyk7CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdFJlbmRlciAodm0pIHsKICAgIHZtLl92bm9kZSA9IG51bGw7IC8vIHRoZSByb290IG9mIHRoZSBjaGlsZCB0cmVlCiAgICB2bS5fc3RhdGljVHJlZXMgPSBudWxsOyAvLyB2LW9uY2UgY2FjaGVkIHRyZWVzCiAgICB2YXIgb3B0aW9ucyA9IHZtLiRvcHRpb25zOwogICAgdmFyIHBhcmVudFZub2RlID0gdm0uJHZub2RlID0gb3B0aW9ucy5fcGFyZW50Vm5vZGU7IC8vIHRoZSBwbGFjZWhvbGRlciBub2RlIGluIHBhcmVudCB0cmVlCiAgICB2YXIgcmVuZGVyQ29udGV4dCA9IHBhcmVudFZub2RlICYmIHBhcmVudFZub2RlLmNvbnRleHQ7CiAgICB2bS4kc2xvdHMgPSByZXNvbHZlU2xvdHMob3B0aW9ucy5fcmVuZGVyQ2hpbGRyZW4sIHJlbmRlckNvbnRleHQpOwogICAgdm0uJHNjb3BlZFNsb3RzID0gZW1wdHlPYmplY3Q7CiAgICAvLyBiaW5kIHRoZSBjcmVhdGVFbGVtZW50IGZuIHRvIHRoaXMgaW5zdGFuY2UKICAgIC8vIHNvIHRoYXQgd2UgZ2V0IHByb3BlciByZW5kZXIgY29udGV4dCBpbnNpZGUgaXQuCiAgICAvLyBhcmdzIG9yZGVyOiB0YWcsIGRhdGEsIGNoaWxkcmVuLCBub3JtYWxpemF0aW9uVHlwZSwgYWx3YXlzTm9ybWFsaXplCiAgICAvLyBpbnRlcm5hbCB2ZXJzaW9uIGlzIHVzZWQgYnkgcmVuZGVyIGZ1bmN0aW9ucyBjb21waWxlZCBmcm9tIHRlbXBsYXRlcwogICAgdm0uX2MgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyByZXR1cm4gY3JlYXRlRWxlbWVudCh2bSwgYSwgYiwgYywgZCwgZmFsc2UpOyB9OwogICAgLy8gbm9ybWFsaXphdGlvbiBpcyBhbHdheXMgYXBwbGllZCBmb3IgdGhlIHB1YmxpYyB2ZXJzaW9uLCB1c2VkIGluCiAgICAvLyB1c2VyLXdyaXR0ZW4gcmVuZGVyIGZ1bmN0aW9ucy4KICAgIHZtLiRjcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsgcmV0dXJuIGNyZWF0ZUVsZW1lbnQodm0sIGEsIGIsIGMsIGQsIHRydWUpOyB9OwoKICAgIC8vICRhdHRycyAmICRsaXN0ZW5lcnMgYXJlIGV4cG9zZWQgZm9yIGVhc2llciBIT0MgY3JlYXRpb24uCiAgICAvLyB0aGV5IG5lZWQgdG8gYmUgcmVhY3RpdmUgc28gdGhhdCBIT0NzIHVzaW5nIHRoZW0gYXJlIGFsd2F5cyB1cGRhdGVkCiAgICB2YXIgcGFyZW50RGF0YSA9IHBhcmVudFZub2RlICYmIHBhcmVudFZub2RlLmRhdGE7CgogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIHsKICAgICAgZGVmaW5lUmVhY3RpdmUkJDEodm0sICckYXR0cnMnLCBwYXJlbnREYXRhICYmIHBhcmVudERhdGEuYXR0cnMgfHwgZW1wdHlPYmplY3QsIGZ1bmN0aW9uICgpIHsKICAgICAgICAhaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50ICYmIHdhcm4oIiRhdHRycyBpcyByZWFkb25seS4iLCB2bSk7CiAgICAgIH0sIHRydWUpOwogICAgICBkZWZpbmVSZWFjdGl2ZSQkMSh2bSwgJyRsaXN0ZW5lcnMnLCBvcHRpb25zLl9wYXJlbnRMaXN0ZW5lcnMgfHwgZW1wdHlPYmplY3QsIGZ1bmN0aW9uICgpIHsKICAgICAgICAhaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50ICYmIHdhcm4oIiRsaXN0ZW5lcnMgaXMgcmVhZG9ubHkuIiwgdm0pOwogICAgICB9LCB0cnVlKTsKICAgIH0KICB9CgogIHZhciBjdXJyZW50UmVuZGVyaW5nSW5zdGFuY2UgPSBudWxsOwoKICBmdW5jdGlvbiByZW5kZXJNaXhpbiAoVnVlKSB7CiAgICAvLyBpbnN0YWxsIHJ1bnRpbWUgY29udmVuaWVuY2UgaGVscGVycwogICAgaW5zdGFsbFJlbmRlckhlbHBlcnMoVnVlLnByb3RvdHlwZSk7CgogICAgVnVlLnByb3RvdHlwZS4kbmV4dFRpY2sgPSBmdW5jdGlvbiAoZm4pIHsKICAgICAgcmV0dXJuIG5leHRUaWNrKGZuLCB0aGlzKQogICAgfTsKCiAgICBWdWUucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHZhciByZWYgPSB2bS4kb3B0aW9uczsKICAgICAgdmFyIHJlbmRlciA9IHJlZi5yZW5kZXI7CiAgICAgIHZhciBfcGFyZW50Vm5vZGUgPSByZWYuX3BhcmVudFZub2RlOwoKICAgICAgaWYgKF9wYXJlbnRWbm9kZSkgewogICAgICAgIHZtLiRzY29wZWRTbG90cyA9IG5vcm1hbGl6ZVNjb3BlZFNsb3RzKAogICAgICAgICAgX3BhcmVudFZub2RlLmRhdGEuc2NvcGVkU2xvdHMsCiAgICAgICAgICB2bS4kc2xvdHMsCiAgICAgICAgICB2bS4kc2NvcGVkU2xvdHMKICAgICAgICApOwogICAgICB9CgogICAgICAvLyBzZXQgcGFyZW50IHZub2RlLiB0aGlzIGFsbG93cyByZW5kZXIgZnVuY3Rpb25zIHRvIGhhdmUgYWNjZXNzCiAgICAgIC8vIHRvIHRoZSBkYXRhIG9uIHRoZSBwbGFjZWhvbGRlciBub2RlLgogICAgICB2bS4kdm5vZGUgPSBfcGFyZW50Vm5vZGU7CiAgICAgIC8vIHJlbmRlciBzZWxmCiAgICAgIHZhciB2bm9kZTsKICAgICAgdHJ5IHsKICAgICAgICAvLyBUaGVyZSdzIG5vIG5lZWQgdG8gbWFpbnRhaW4gYSBzdGFjayBiZWNhdXNlIGFsbCByZW5kZXIgZm5zIGFyZSBjYWxsZWQKICAgICAgICAvLyBzZXBhcmF0ZWx5IGZyb20gb25lIGFub3RoZXIuIE5lc3RlZCBjb21wb25lbnQncyByZW5kZXIgZm5zIGFyZSBjYWxsZWQKICAgICAgICAvLyB3aGVuIHBhcmVudCBjb21wb25lbnQgaXMgcGF0Y2hlZC4KICAgICAgICBjdXJyZW50UmVuZGVyaW5nSW5zdGFuY2UgPSB2bTsKICAgICAgICB2bm9kZSA9IHJlbmRlci5jYWxsKHZtLl9yZW5kZXJQcm94eSwgdm0uJGNyZWF0ZUVsZW1lbnQpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sICJyZW5kZXIiKTsKICAgICAgICAvLyByZXR1cm4gZXJyb3IgcmVuZGVyIHJlc3VsdCwKICAgICAgICAvLyBvciBwcmV2aW91cyB2bm9kZSB0byBwcmV2ZW50IHJlbmRlciBlcnJvciBjYXVzaW5nIGJsYW5rIGNvbXBvbmVudAogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgICAgaWYgKHZtLiRvcHRpb25zLnJlbmRlckVycm9yKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2bm9kZSA9IHZtLiRvcHRpb25zLnJlbmRlckVycm9yLmNhbGwodm0uX3JlbmRlclByb3h5LCB2bS4kY3JlYXRlRWxlbWVudCwgZSk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGhhbmRsZUVycm9yKGUsIHZtLCAicmVuZGVyRXJyb3IiKTsKICAgICAgICAgICAgdm5vZGUgPSB2bS5fdm5vZGU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZub2RlID0gdm0uX3Zub2RlOwogICAgICAgIH0KICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBjdXJyZW50UmVuZGVyaW5nSW5zdGFuY2UgPSBudWxsOwogICAgICB9CiAgICAgIC8vIGlmIHRoZSByZXR1cm5lZCBhcnJheSBjb250YWlucyBvbmx5IGEgc2luZ2xlIG5vZGUsIGFsbG93IGl0CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZub2RlKSAmJiB2bm9kZS5sZW5ndGggPT09IDEpIHsKICAgICAgICB2bm9kZSA9IHZub2RlWzBdOwogICAgICB9CiAgICAgIC8vIHJldHVybiBlbXB0eSB2bm9kZSBpbiBjYXNlIHRoZSByZW5kZXIgZnVuY3Rpb24gZXJyb3JlZCBvdXQKICAgICAgaWYgKCEodm5vZGUgaW5zdGFuY2VvZiBWTm9kZSkpIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2bm9kZSkpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICdNdWx0aXBsZSByb290IG5vZGVzIHJldHVybmVkIGZyb20gcmVuZGVyIGZ1bmN0aW9uLiBSZW5kZXIgZnVuY3Rpb24gJyArCiAgICAgICAgICAgICdzaG91bGQgcmV0dXJuIGEgc2luZ2xlIHJvb3Qgbm9kZS4nLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgdm5vZGUgPSBjcmVhdGVFbXB0eVZOb2RlKCk7CiAgICAgIH0KICAgICAgLy8gc2V0IHBhcmVudAogICAgICB2bm9kZS5wYXJlbnQgPSBfcGFyZW50Vm5vZGU7CiAgICAgIHJldHVybiB2bm9kZQogICAgfTsKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBlbnN1cmVDdG9yIChjb21wLCBiYXNlKSB7CiAgICBpZiAoCiAgICAgIGNvbXAuX19lc01vZHVsZSB8fAogICAgICAoaGFzU3ltYm9sICYmIGNvbXBbU3ltYm9sLnRvU3RyaW5nVGFnXSA9PT0gJ01vZHVsZScpCiAgICApIHsKICAgICAgY29tcCA9IGNvbXAuZGVmYXVsdDsKICAgIH0KICAgIHJldHVybiBpc09iamVjdChjb21wKQogICAgICA/IGJhc2UuZXh0ZW5kKGNvbXApCiAgICAgIDogY29tcAogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQXN5bmNQbGFjZWhvbGRlciAoCiAgICBmYWN0b3J5LAogICAgZGF0YSwKICAgIGNvbnRleHQsCiAgICBjaGlsZHJlbiwKICAgIHRhZwogICkgewogICAgdmFyIG5vZGUgPSBjcmVhdGVFbXB0eVZOb2RlKCk7CiAgICBub2RlLmFzeW5jRmFjdG9yeSA9IGZhY3Rvcnk7CiAgICBub2RlLmFzeW5jTWV0YSA9IHsgZGF0YTogZGF0YSwgY29udGV4dDogY29udGV4dCwgY2hpbGRyZW46IGNoaWxkcmVuLCB0YWc6IHRhZyB9OwogICAgcmV0dXJuIG5vZGUKICB9CgogIGZ1bmN0aW9uIHJlc29sdmVBc3luY0NvbXBvbmVudCAoCiAgICBmYWN0b3J5LAogICAgYmFzZUN0b3IKICApIHsKICAgIGlmIChpc1RydWUoZmFjdG9yeS5lcnJvcikgJiYgaXNEZWYoZmFjdG9yeS5lcnJvckNvbXApKSB7CiAgICAgIHJldHVybiBmYWN0b3J5LmVycm9yQ29tcAogICAgfQoKICAgIGlmIChpc0RlZihmYWN0b3J5LnJlc29sdmVkKSkgewogICAgICByZXR1cm4gZmFjdG9yeS5yZXNvbHZlZAogICAgfQoKICAgIHZhciBvd25lciA9IGN1cnJlbnRSZW5kZXJpbmdJbnN0YW5jZTsKICAgIGlmIChvd25lciAmJiBpc0RlZihmYWN0b3J5Lm93bmVycykgJiYgZmFjdG9yeS5vd25lcnMuaW5kZXhPZihvd25lcikgPT09IC0xKSB7CiAgICAgIC8vIGFscmVhZHkgcGVuZGluZwogICAgICBmYWN0b3J5Lm93bmVycy5wdXNoKG93bmVyKTsKICAgIH0KCiAgICBpZiAoaXNUcnVlKGZhY3RvcnkubG9hZGluZykgJiYgaXNEZWYoZmFjdG9yeS5sb2FkaW5nQ29tcCkpIHsKICAgICAgcmV0dXJuIGZhY3RvcnkubG9hZGluZ0NvbXAKICAgIH0KCiAgICBpZiAob3duZXIgJiYgIWlzRGVmKGZhY3Rvcnkub3duZXJzKSkgewogICAgICB2YXIgb3duZXJzID0gZmFjdG9yeS5vd25lcnMgPSBbb3duZXJdOwogICAgICB2YXIgc3luYyA9IHRydWU7CiAgICAgIHZhciB0aW1lckxvYWRpbmcgPSBudWxsOwogICAgICB2YXIgdGltZXJUaW1lb3V0ID0gbnVsbAoKICAgICAgOyhvd25lcikuJG9uKCdob29rOmRlc3Ryb3llZCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlbW92ZShvd25lcnMsIG93bmVyKTsgfSk7CgogICAgICB2YXIgZm9yY2VSZW5kZXIgPSBmdW5jdGlvbiAocmVuZGVyQ29tcGxldGVkKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBvd25lcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAob3duZXJzW2ldKS4kZm9yY2VVcGRhdGUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChyZW5kZXJDb21wbGV0ZWQpIHsKICAgICAgICAgIG93bmVycy5sZW5ndGggPSAwOwogICAgICAgICAgaWYgKHRpbWVyTG9hZGluZyAhPT0gbnVsbCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJMb2FkaW5nKTsKICAgICAgICAgICAgdGltZXJMb2FkaW5nID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aW1lclRpbWVvdXQgIT09IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyVGltZW91dCk7CiAgICAgICAgICAgIHRpbWVyVGltZW91dCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAgdmFyIHJlc29sdmUgPSBvbmNlKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgICAvLyBjYWNoZSByZXNvbHZlZAogICAgICAgIGZhY3RvcnkucmVzb2x2ZWQgPSBlbnN1cmVDdG9yKHJlcywgYmFzZUN0b3IpOwogICAgICAgIC8vIGludm9rZSBjYWxsYmFja3Mgb25seSBpZiB0aGlzIGlzIG5vdCBhIHN5bmNocm9ub3VzIHJlc29sdmUKICAgICAgICAvLyAoYXN5bmMgcmVzb2x2ZXMgYXJlIHNoaW1tZWQgYXMgc3luY2hyb25vdXMgZHVyaW5nIFNTUikKICAgICAgICBpZiAoIXN5bmMpIHsKICAgICAgICAgIGZvcmNlUmVuZGVyKHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvd25lcnMubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdmFyIHJlamVjdCA9IG9uY2UoZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIHdhcm4oCiAgICAgICAgICAiRmFpbGVkIHRvIHJlc29sdmUgYXN5bmMgY29tcG9uZW50OiAiICsgKFN0cmluZyhmYWN0b3J5KSkgKwogICAgICAgICAgKHJlYXNvbiA/ICgiXG5SZWFzb246ICIgKyByZWFzb24pIDogJycpCiAgICAgICAgKTsKICAgICAgICBpZiAoaXNEZWYoZmFjdG9yeS5lcnJvckNvbXApKSB7CiAgICAgICAgICBmYWN0b3J5LmVycm9yID0gdHJ1ZTsKICAgICAgICAgIGZvcmNlUmVuZGVyKHRydWUpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgcmVzID0gZmFjdG9yeShyZXNvbHZlLCByZWplY3QpOwoKICAgICAgaWYgKGlzT2JqZWN0KHJlcykpIHsKICAgICAgICBpZiAoaXNQcm9taXNlKHJlcykpIHsKICAgICAgICAgIC8vICgpID0+IFByb21pc2UKICAgICAgICAgIGlmIChpc1VuZGVmKGZhY3RvcnkucmVzb2x2ZWQpKSB7CiAgICAgICAgICAgIHJlcy50aGVuKHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChpc1Byb21pc2UocmVzLmNvbXBvbmVudCkpIHsKICAgICAgICAgIHJlcy5jb21wb25lbnQudGhlbihyZXNvbHZlLCByZWplY3QpOwoKICAgICAgICAgIGlmIChpc0RlZihyZXMuZXJyb3IpKSB7CiAgICAgICAgICAgIGZhY3RvcnkuZXJyb3JDb21wID0gZW5zdXJlQ3RvcihyZXMuZXJyb3IsIGJhc2VDdG9yKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaXNEZWYocmVzLmxvYWRpbmcpKSB7CiAgICAgICAgICAgIGZhY3RvcnkubG9hZGluZ0NvbXAgPSBlbnN1cmVDdG9yKHJlcy5sb2FkaW5nLCBiYXNlQ3Rvcik7CiAgICAgICAgICAgIGlmIChyZXMuZGVsYXkgPT09IDApIHsKICAgICAgICAgICAgICBmYWN0b3J5LmxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRpbWVyTG9hZGluZyA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGltZXJMb2FkaW5nID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChpc1VuZGVmKGZhY3RvcnkucmVzb2x2ZWQpICYmIGlzVW5kZWYoZmFjdG9yeS5lcnJvcikpIHsKICAgICAgICAgICAgICAgICAgZmFjdG9yeS5sb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgZm9yY2VSZW5kZXIoZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIHJlcy5kZWxheSB8fCAyMDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGlzRGVmKHJlcy50aW1lb3V0KSkgewogICAgICAgICAgICB0aW1lclRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB0aW1lclRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgIGlmIChpc1VuZGVmKGZhY3RvcnkucmVzb2x2ZWQpKSB7CiAgICAgICAgICAgICAgICByZWplY3QoCiAgICAgICAgICAgICAgICAgICJ0aW1lb3V0ICgiICsgKHJlcy50aW1lb3V0KSArICJtcykiCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgcmVzLnRpbWVvdXQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgc3luYyA9IGZhbHNlOwogICAgICAvLyByZXR1cm4gaW4gY2FzZSByZXNvbHZlZCBzeW5jaHJvbm91c2x5CiAgICAgIHJldHVybiBmYWN0b3J5LmxvYWRpbmcKICAgICAgICA/IGZhY3RvcnkubG9hZGluZ0NvbXAKICAgICAgICA6IGZhY3RvcnkucmVzb2x2ZWQKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBpc0FzeW5jUGxhY2Vob2xkZXIgKG5vZGUpIHsKICAgIHJldHVybiBub2RlLmlzQ29tbWVudCAmJiBub2RlLmFzeW5jRmFjdG9yeQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGdldEZpcnN0Q29tcG9uZW50Q2hpbGQgKGNoaWxkcmVuKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbikpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjID0gY2hpbGRyZW5baV07CiAgICAgICAgaWYgKGlzRGVmKGMpICYmIChpc0RlZihjLmNvbXBvbmVudE9wdGlvbnMpIHx8IGlzQXN5bmNQbGFjZWhvbGRlcihjKSkpIHsKICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRFdmVudHMgKHZtKSB7CiAgICB2bS5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHZtLl9oYXNIb29rRXZlbnQgPSBmYWxzZTsKICAgIC8vIGluaXQgcGFyZW50IGF0dGFjaGVkIGV2ZW50cwogICAgdmFyIGxpc3RlbmVycyA9IHZtLiRvcHRpb25zLl9wYXJlbnRMaXN0ZW5lcnM7CiAgICBpZiAobGlzdGVuZXJzKSB7CiAgICAgIHVwZGF0ZUNvbXBvbmVudExpc3RlbmVycyh2bSwgbGlzdGVuZXJzKTsKICAgIH0KICB9CgogIHZhciB0YXJnZXQ7CgogIGZ1bmN0aW9uIGFkZCAoZXZlbnQsIGZuKSB7CiAgICB0YXJnZXQuJG9uKGV2ZW50LCBmbik7CiAgfQoKICBmdW5jdGlvbiByZW1vdmUkMSAoZXZlbnQsIGZuKSB7CiAgICB0YXJnZXQuJG9mZihldmVudCwgZm4pOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlT25jZUhhbmRsZXIgKGV2ZW50LCBmbikgewogICAgdmFyIF90YXJnZXQgPSB0YXJnZXQ7CiAgICByZXR1cm4gZnVuY3Rpb24gb25jZUhhbmRsZXIgKCkgewogICAgICB2YXIgcmVzID0gZm4uYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgaWYgKHJlcyAhPT0gbnVsbCkgewogICAgICAgIF90YXJnZXQuJG9mZihldmVudCwgb25jZUhhbmRsZXIpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVDb21wb25lbnRMaXN0ZW5lcnMgKAogICAgdm0sCiAgICBsaXN0ZW5lcnMsCiAgICBvbGRMaXN0ZW5lcnMKICApIHsKICAgIHRhcmdldCA9IHZtOwogICAgdXBkYXRlTGlzdGVuZXJzKGxpc3RlbmVycywgb2xkTGlzdGVuZXJzIHx8IHt9LCBhZGQsIHJlbW92ZSQxLCBjcmVhdGVPbmNlSGFuZGxlciwgdm0pOwogICAgdGFyZ2V0ID0gdW5kZWZpbmVkOwogIH0KCiAgZnVuY3Rpb24gZXZlbnRzTWl4aW4gKFZ1ZSkgewogICAgdmFyIGhvb2tSRSA9IC9eaG9vazovOwogICAgVnVlLnByb3RvdHlwZS4kb24gPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGV2ZW50KSkgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gZXZlbnQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB2bS4kb24oZXZlbnRbaV0sIGZuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKHZtLl9ldmVudHNbZXZlbnRdIHx8ICh2bS5fZXZlbnRzW2V2ZW50XSA9IFtdKSkucHVzaChmbik7CiAgICAgICAgLy8gb3B0aW1pemUgaG9vazpldmVudCBjb3N0IGJ5IHVzaW5nIGEgYm9vbGVhbiBmbGFnIG1hcmtlZCBhdCByZWdpc3RyYXRpb24KICAgICAgICAvLyBpbnN0ZWFkIG9mIGEgaGFzaCBsb29rdXAKICAgICAgICBpZiAoaG9va1JFLnRlc3QoZXZlbnQpKSB7CiAgICAgICAgICB2bS5faGFzSG9va0V2ZW50ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHZtCiAgICB9OwoKICAgIFZ1ZS5wcm90b3R5cGUuJG9uY2UgPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGZ1bmN0aW9uIG9uICgpIHsKICAgICAgICB2bS4kb2ZmKGV2ZW50LCBvbik7CiAgICAgICAgZm4uYXBwbHkodm0sIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgb24uZm4gPSBmbjsKICAgICAgdm0uJG9uKGV2ZW50LCBvbik7CiAgICAgIHJldHVybiB2bQogICAgfTsKCiAgICBWdWUucHJvdG90eXBlLiRvZmYgPSBmdW5jdGlvbiAoZXZlbnQsIGZuKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIC8vIGFsbAogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICB2bS5fZXZlbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICByZXR1cm4gdm0KICAgICAgfQogICAgICAvLyBhcnJheSBvZiBldmVudHMKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7CiAgICAgICAgZm9yICh2YXIgaSQxID0gMCwgbCA9IGV2ZW50Lmxlbmd0aDsgaSQxIDwgbDsgaSQxKyspIHsKICAgICAgICAgIHZtLiRvZmYoZXZlbnRbaSQxXSwgZm4pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdm0KICAgICAgfQogICAgICAvLyBzcGVjaWZpYyBldmVudAogICAgICB2YXIgY2JzID0gdm0uX2V2ZW50c1tldmVudF07CiAgICAgIGlmICghY2JzKSB7CiAgICAgICAgcmV0dXJuIHZtCiAgICAgIH0KICAgICAgaWYgKCFmbikgewogICAgICAgIHZtLl9ldmVudHNbZXZlbnRdID0gbnVsbDsKICAgICAgICByZXR1cm4gdm0KICAgICAgfQogICAgICAvLyBzcGVjaWZpYyBoYW5kbGVyCiAgICAgIHZhciBjYjsKICAgICAgdmFyIGkgPSBjYnMubGVuZ3RoOwogICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgY2IgPSBjYnNbaV07CiAgICAgICAgaWYgKGNiID09PSBmbiB8fCBjYi5mbiA9PT0gZm4pIHsKICAgICAgICAgIGNicy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdm0KICAgIH07CgogICAgVnVlLnByb3RvdHlwZS4kZW1pdCA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB7CiAgICAgICAgdmFyIGxvd2VyQ2FzZUV2ZW50ID0gZXZlbnQudG9Mb3dlckNhc2UoKTsKICAgICAgICBpZiAobG93ZXJDYXNlRXZlbnQgIT09IGV2ZW50ICYmIHZtLl9ldmVudHNbbG93ZXJDYXNlRXZlbnRdKSB7CiAgICAgICAgICB0aXAoCiAgICAgICAgICAgICJFdmVudCBcIiIgKyBsb3dlckNhc2VFdmVudCArICJcIiBpcyBlbWl0dGVkIGluIGNvbXBvbmVudCAiICsKICAgICAgICAgICAgKGZvcm1hdENvbXBvbmVudE5hbWUodm0pKSArICIgYnV0IHRoZSBoYW5kbGVyIGlzIHJlZ2lzdGVyZWQgZm9yIFwiIiArIGV2ZW50ICsgIlwiLiAiICsKICAgICAgICAgICAgIk5vdGUgdGhhdCBIVE1MIGF0dHJpYnV0ZXMgYXJlIGNhc2UtaW5zZW5zaXRpdmUgYW5kIHlvdSBjYW5ub3QgdXNlICIgKwogICAgICAgICAgICAidi1vbiB0byBsaXN0ZW4gdG8gY2FtZWxDYXNlIGV2ZW50cyB3aGVuIHVzaW5nIGluLURPTSB0ZW1wbGF0ZXMuICIgKwogICAgICAgICAgICAiWW91IHNob3VsZCBwcm9iYWJseSB1c2UgXCIiICsgKGh5cGhlbmF0ZShldmVudCkpICsgIlwiIGluc3RlYWQgb2YgXCIiICsgZXZlbnQgKyAiXCIuIgogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIGNicyA9IHZtLl9ldmVudHNbZXZlbnRdOwogICAgICBpZiAoY2JzKSB7CiAgICAgICAgY2JzID0gY2JzLmxlbmd0aCA+IDEgPyB0b0FycmF5KGNicykgOiBjYnM7CiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cywgMSk7CiAgICAgICAgdmFyIGluZm8gPSAiZXZlbnQgaGFuZGxlciBmb3IgXCIiICsgZXZlbnQgKyAiXCIiOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2JzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgaW52b2tlV2l0aEVycm9ySGFuZGxpbmcoY2JzW2ldLCB2bSwgYXJncywgdm0sIGluZm8pOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdm0KICAgIH07CiAgfQoKICAvKiAgKi8KCiAgdmFyIGFjdGl2ZUluc3RhbmNlID0gbnVsbDsKICB2YXIgaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50ID0gZmFsc2U7CgogIGZ1bmN0aW9uIHNldEFjdGl2ZUluc3RhbmNlKHZtKSB7CiAgICB2YXIgcHJldkFjdGl2ZUluc3RhbmNlID0gYWN0aXZlSW5zdGFuY2U7CiAgICBhY3RpdmVJbnN0YW5jZSA9IHZtOwogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgYWN0aXZlSW5zdGFuY2UgPSBwcmV2QWN0aXZlSW5zdGFuY2U7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0TGlmZWN5Y2xlICh2bSkgewogICAgdmFyIG9wdGlvbnMgPSB2bS4kb3B0aW9uczsKCiAgICAvLyBsb2NhdGUgZmlyc3Qgbm9uLWFic3RyYWN0IHBhcmVudAogICAgdmFyIHBhcmVudCA9IG9wdGlvbnMucGFyZW50OwogICAgaWYgKHBhcmVudCAmJiAhb3B0aW9ucy5hYnN0cmFjdCkgewogICAgICB3aGlsZSAocGFyZW50LiRvcHRpb25zLmFic3RyYWN0ICYmIHBhcmVudC4kcGFyZW50KSB7CiAgICAgICAgcGFyZW50ID0gcGFyZW50LiRwYXJlbnQ7CiAgICAgIH0KICAgICAgcGFyZW50LiRjaGlsZHJlbi5wdXNoKHZtKTsKICAgIH0KCiAgICB2bS4kcGFyZW50ID0gcGFyZW50OwogICAgdm0uJHJvb3QgPSBwYXJlbnQgPyBwYXJlbnQuJHJvb3QgOiB2bTsKCiAgICB2bS4kY2hpbGRyZW4gPSBbXTsKICAgIHZtLiRyZWZzID0ge307CgogICAgdm0uX3dhdGNoZXIgPSBudWxsOwogICAgdm0uX2luYWN0aXZlID0gbnVsbDsKICAgIHZtLl9kaXJlY3RJbmFjdGl2ZSA9IGZhbHNlOwogICAgdm0uX2lzTW91bnRlZCA9IGZhbHNlOwogICAgdm0uX2lzRGVzdHJveWVkID0gZmFsc2U7CiAgICB2bS5faXNCZWluZ0Rlc3Ryb3llZCA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gbGlmZWN5Y2xlTWl4aW4gKFZ1ZSkgewogICAgVnVlLnByb3RvdHlwZS5fdXBkYXRlID0gZnVuY3Rpb24gKHZub2RlLCBoeWRyYXRpbmcpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdmFyIHByZXZFbCA9IHZtLiRlbDsKICAgICAgdmFyIHByZXZWbm9kZSA9IHZtLl92bm9kZTsKICAgICAgdmFyIHJlc3RvcmVBY3RpdmVJbnN0YW5jZSA9IHNldEFjdGl2ZUluc3RhbmNlKHZtKTsKICAgICAgdm0uX3Zub2RlID0gdm5vZGU7CiAgICAgIC8vIFZ1ZS5wcm90b3R5cGUuX19wYXRjaF9fIGlzIGluamVjdGVkIGluIGVudHJ5IHBvaW50cwogICAgICAvLyBiYXNlZCBvbiB0aGUgcmVuZGVyaW5nIGJhY2tlbmQgdXNlZC4KICAgICAgaWYgKCFwcmV2Vm5vZGUpIHsKICAgICAgICAvLyBpbml0aWFsIHJlbmRlcgogICAgICAgIHZtLiRlbCA9IHZtLl9fcGF0Y2hfXyh2bS4kZWwsIHZub2RlLCBoeWRyYXRpbmcsIGZhbHNlIC8qIHJlbW92ZU9ubHkgKi8pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHVwZGF0ZXMKICAgICAgICB2bS4kZWwgPSB2bS5fX3BhdGNoX18ocHJldlZub2RlLCB2bm9kZSk7CiAgICAgIH0KICAgICAgcmVzdG9yZUFjdGl2ZUluc3RhbmNlKCk7CiAgICAgIC8vIHVwZGF0ZSBfX3Z1ZV9fIHJlZmVyZW5jZQogICAgICBpZiAocHJldkVsKSB7CiAgICAgICAgcHJldkVsLl9fdnVlX18gPSBudWxsOwogICAgICB9CiAgICAgIGlmICh2bS4kZWwpIHsKICAgICAgICB2bS4kZWwuX192dWVfXyA9IHZtOwogICAgICB9CiAgICAgIC8vIGlmIHBhcmVudCBpcyBhbiBIT0MsIHVwZGF0ZSBpdHMgJGVsIGFzIHdlbGwKICAgICAgaWYgKHZtLiR2bm9kZSAmJiB2bS4kcGFyZW50ICYmIHZtLiR2bm9kZSA9PT0gdm0uJHBhcmVudC5fdm5vZGUpIHsKICAgICAgICB2bS4kcGFyZW50LiRlbCA9IHZtLiRlbDsKICAgICAgfQogICAgICAvLyB1cGRhdGVkIGhvb2sgaXMgY2FsbGVkIGJ5IHRoZSBzY2hlZHVsZXIgdG8gZW5zdXJlIHRoYXQgY2hpbGRyZW4gYXJlCiAgICAgIC8vIHVwZGF0ZWQgaW4gYSBwYXJlbnQncyB1cGRhdGVkIGhvb2suCiAgICB9OwoKICAgIFZ1ZS5wcm90b3R5cGUuJGZvcmNlVXBkYXRlID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBpZiAodm0uX3dhdGNoZXIpIHsKICAgICAgICB2bS5fd2F0Y2hlci51cGRhdGUoKTsKICAgICAgfQogICAgfTsKCiAgICBWdWUucHJvdG90eXBlLiRkZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBpZiAodm0uX2lzQmVpbmdEZXN0cm95ZWQpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBjYWxsSG9vayh2bSwgJ2JlZm9yZURlc3Ryb3knKTsKICAgICAgdm0uX2lzQmVpbmdEZXN0cm95ZWQgPSB0cnVlOwogICAgICAvLyByZW1vdmUgc2VsZiBmcm9tIHBhcmVudAogICAgICB2YXIgcGFyZW50ID0gdm0uJHBhcmVudDsKICAgICAgaWYgKHBhcmVudCAmJiAhcGFyZW50Ll9pc0JlaW5nRGVzdHJveWVkICYmICF2bS4kb3B0aW9ucy5hYnN0cmFjdCkgewogICAgICAgIHJlbW92ZShwYXJlbnQuJGNoaWxkcmVuLCB2bSk7CiAgICAgIH0KICAgICAgLy8gdGVhcmRvd24gd2F0Y2hlcnMKICAgICAgaWYgKHZtLl93YXRjaGVyKSB7CiAgICAgICAgdm0uX3dhdGNoZXIudGVhcmRvd24oKTsKICAgICAgfQogICAgICB2YXIgaSA9IHZtLl93YXRjaGVycy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2bS5fd2F0Y2hlcnNbaV0udGVhcmRvd24oKTsKICAgICAgfQogICAgICAvLyByZW1vdmUgcmVmZXJlbmNlIGZyb20gZGF0YSBvYgogICAgICAvLyBmcm96ZW4gb2JqZWN0IG1heSBub3QgaGF2ZSBvYnNlcnZlci4KICAgICAgaWYgKHZtLl9kYXRhLl9fb2JfXykgewogICAgICAgIHZtLl9kYXRhLl9fb2JfXy52bUNvdW50LS07CiAgICAgIH0KICAgICAgLy8gY2FsbCB0aGUgbGFzdCBob29rLi4uCiAgICAgIHZtLl9pc0Rlc3Ryb3llZCA9IHRydWU7CiAgICAgIC8vIGludm9rZSBkZXN0cm95IGhvb2tzIG9uIGN1cnJlbnQgcmVuZGVyZWQgdHJlZQogICAgICB2bS5fX3BhdGNoX18odm0uX3Zub2RlLCBudWxsKTsKICAgICAgLy8gZmlyZSBkZXN0cm95ZWQgaG9vawogICAgICBjYWxsSG9vayh2bSwgJ2Rlc3Ryb3llZCcpOwogICAgICAvLyB0dXJuIG9mZiBhbGwgaW5zdGFuY2UgbGlzdGVuZXJzLgogICAgICB2bS4kb2ZmKCk7CiAgICAgIC8vIHJlbW92ZSBfX3Z1ZV9fIHJlZmVyZW5jZQogICAgICBpZiAodm0uJGVsKSB7CiAgICAgICAgdm0uJGVsLl9fdnVlX18gPSBudWxsOwogICAgICB9CiAgICAgIC8vIHJlbGVhc2UgY2lyY3VsYXIgcmVmZXJlbmNlICgjNjc1OSkKICAgICAgaWYgKHZtLiR2bm9kZSkgewogICAgICAgIHZtLiR2bm9kZS5wYXJlbnQgPSBudWxsOwogICAgICB9CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbW91bnRDb21wb25lbnQgKAogICAgdm0sCiAgICBlbCwKICAgIGh5ZHJhdGluZwogICkgewogICAgdm0uJGVsID0gZWw7CiAgICBpZiAoIXZtLiRvcHRpb25zLnJlbmRlcikgewogICAgICB2bS4kb3B0aW9ucy5yZW5kZXIgPSBjcmVhdGVFbXB0eVZOb2RlOwogICAgICB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgaWYgKCh2bS4kb3B0aW9ucy50ZW1wbGF0ZSAmJiB2bS4kb3B0aW9ucy50ZW1wbGF0ZS5jaGFyQXQoMCkgIT09ICcjJykgfHwKICAgICAgICAgIHZtLiRvcHRpb25zLmVsIHx8IGVsKSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAnWW91IGFyZSB1c2luZyB0aGUgcnVudGltZS1vbmx5IGJ1aWxkIG9mIFZ1ZSB3aGVyZSB0aGUgdGVtcGxhdGUgJyArCiAgICAgICAgICAgICdjb21waWxlciBpcyBub3QgYXZhaWxhYmxlLiBFaXRoZXIgcHJlLWNvbXBpbGUgdGhlIHRlbXBsYXRlcyBpbnRvICcgKwogICAgICAgICAgICAncmVuZGVyIGZ1bmN0aW9ucywgb3IgdXNlIHRoZSBjb21waWxlci1pbmNsdWRlZCBidWlsZC4nLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgJ0ZhaWxlZCB0byBtb3VudCBjb21wb25lbnQ6IHRlbXBsYXRlIG9yIHJlbmRlciBmdW5jdGlvbiBub3QgZGVmaW5lZC4nLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNhbGxIb29rKHZtLCAnYmVmb3JlTW91bnQnKTsKCiAgICB2YXIgdXBkYXRlQ29tcG9uZW50OwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoY29uZmlnLnBlcmZvcm1hbmNlICYmIG1hcmspIHsKICAgICAgdXBkYXRlQ29tcG9uZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBuYW1lID0gdm0uX25hbWU7CiAgICAgICAgdmFyIGlkID0gdm0uX3VpZDsKICAgICAgICB2YXIgc3RhcnRUYWcgPSAidnVlLXBlcmYtc3RhcnQ6IiArIGlkOwogICAgICAgIHZhciBlbmRUYWcgPSAidnVlLXBlcmYtZW5kOiIgKyBpZDsKCiAgICAgICAgbWFyayhzdGFydFRhZyk7CiAgICAgICAgdmFyIHZub2RlID0gdm0uX3JlbmRlcigpOwogICAgICAgIG1hcmsoZW5kVGFnKTsKICAgICAgICBtZWFzdXJlKCgidnVlICIgKyBuYW1lICsgIiByZW5kZXIiKSwgc3RhcnRUYWcsIGVuZFRhZyk7CgogICAgICAgIG1hcmsoc3RhcnRUYWcpOwogICAgICAgIHZtLl91cGRhdGUodm5vZGUsIGh5ZHJhdGluZyk7CiAgICAgICAgbWFyayhlbmRUYWcpOwogICAgICAgIG1lYXN1cmUoKCJ2dWUgIiArIG5hbWUgKyAiIHBhdGNoIiksIHN0YXJ0VGFnLCBlbmRUYWcpOwogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgdXBkYXRlQ29tcG9uZW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZtLl91cGRhdGUodm0uX3JlbmRlcigpLCBoeWRyYXRpbmcpOwogICAgICB9OwogICAgfQoKICAgIC8vIHdlIHNldCB0aGlzIHRvIHZtLl93YXRjaGVyIGluc2lkZSB0aGUgd2F0Y2hlcidzIGNvbnN0cnVjdG9yCiAgICAvLyBzaW5jZSB0aGUgd2F0Y2hlcidzIGluaXRpYWwgcGF0Y2ggbWF5IGNhbGwgJGZvcmNlVXBkYXRlIChlLmcuIGluc2lkZSBjaGlsZAogICAgLy8gY29tcG9uZW50J3MgbW91bnRlZCBob29rKSwgd2hpY2ggcmVsaWVzIG9uIHZtLl93YXRjaGVyIGJlaW5nIGFscmVhZHkgZGVmaW5lZAogICAgbmV3IFdhdGNoZXIodm0sIHVwZGF0ZUNvbXBvbmVudCwgbm9vcCwgewogICAgICBiZWZvcmU6IGZ1bmN0aW9uIGJlZm9yZSAoKSB7CiAgICAgICAgaWYgKHZtLl9pc01vdW50ZWQgJiYgIXZtLl9pc0Rlc3Ryb3llZCkgewogICAgICAgICAgY2FsbEhvb2sodm0sICdiZWZvcmVVcGRhdGUnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHRydWUgLyogaXNSZW5kZXJXYXRjaGVyICovKTsKICAgIGh5ZHJhdGluZyA9IGZhbHNlOwoKICAgIC8vIG1hbnVhbGx5IG1vdW50ZWQgaW5zdGFuY2UsIGNhbGwgbW91bnRlZCBvbiBzZWxmCiAgICAvLyBtb3VudGVkIGlzIGNhbGxlZCBmb3IgcmVuZGVyLWNyZWF0ZWQgY2hpbGQgY29tcG9uZW50cyBpbiBpdHMgaW5zZXJ0ZWQgaG9vawogICAgaWYgKHZtLiR2bm9kZSA9PSBudWxsKSB7CiAgICAgIHZtLl9pc01vdW50ZWQgPSB0cnVlOwogICAgICBjYWxsSG9vayh2bSwgJ21vdW50ZWQnKTsKICAgIH0KICAgIHJldHVybiB2bQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlQ2hpbGRDb21wb25lbnQgKAogICAgdm0sCiAgICBwcm9wc0RhdGEsCiAgICBsaXN0ZW5lcnMsCiAgICBwYXJlbnRWbm9kZSwKICAgIHJlbmRlckNoaWxkcmVuCiAgKSB7CiAgICB7CiAgICAgIGlzVXBkYXRpbmdDaGlsZENvbXBvbmVudCA9IHRydWU7CiAgICB9CgogICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgY29tcG9uZW50IGhhcyBzbG90IGNoaWxkcmVuCiAgICAvLyB3ZSBuZWVkIHRvIGRvIHRoaXMgYmVmb3JlIG92ZXJ3cml0aW5nICRvcHRpb25zLl9yZW5kZXJDaGlsZHJlbi4KCiAgICAvLyBjaGVjayBpZiB0aGVyZSBhcmUgZHluYW1pYyBzY29wZWRTbG90cyAoaGFuZC13cml0dGVuIG9yIGNvbXBpbGVkIGJ1dCB3aXRoCiAgICAvLyBkeW5hbWljIHNsb3QgbmFtZXMpLiBTdGF0aWMgc2NvcGVkIHNsb3RzIGNvbXBpbGVkIGZyb20gdGVtcGxhdGUgaGFzIHRoZQogICAgLy8gIiRzdGFibGUiIG1hcmtlci4KICAgIHZhciBuZXdTY29wZWRTbG90cyA9IHBhcmVudFZub2RlLmRhdGEuc2NvcGVkU2xvdHM7CiAgICB2YXIgb2xkU2NvcGVkU2xvdHMgPSB2bS4kc2NvcGVkU2xvdHM7CiAgICB2YXIgaGFzRHluYW1pY1Njb3BlZFNsb3QgPSAhISgKICAgICAgKG5ld1Njb3BlZFNsb3RzICYmICFuZXdTY29wZWRTbG90cy4kc3RhYmxlKSB8fAogICAgICAob2xkU2NvcGVkU2xvdHMgIT09IGVtcHR5T2JqZWN0ICYmICFvbGRTY29wZWRTbG90cy4kc3RhYmxlKSB8fAogICAgICAobmV3U2NvcGVkU2xvdHMgJiYgdm0uJHNjb3BlZFNsb3RzLiRrZXkgIT09IG5ld1Njb3BlZFNsb3RzLiRrZXkpCiAgICApOwoKICAgIC8vIEFueSBzdGF0aWMgc2xvdCBjaGlsZHJlbiBmcm9tIHRoZSBwYXJlbnQgbWF5IGhhdmUgY2hhbmdlZCBkdXJpbmcgcGFyZW50J3MKICAgIC8vIHVwZGF0ZS4gRHluYW1pYyBzY29wZWQgc2xvdHMgbWF5IGFsc28gaGF2ZSBjaGFuZ2VkLiBJbiBzdWNoIGNhc2VzLCBhIGZvcmNlZAogICAgLy8gdXBkYXRlIGlzIG5lY2Vzc2FyeSB0byBlbnN1cmUgY29ycmVjdG5lc3MuCiAgICB2YXIgbmVlZHNGb3JjZVVwZGF0ZSA9ICEhKAogICAgICByZW5kZXJDaGlsZHJlbiB8fCAgICAgICAgICAgICAgIC8vIGhhcyBuZXcgc3RhdGljIHNsb3RzCiAgICAgIHZtLiRvcHRpb25zLl9yZW5kZXJDaGlsZHJlbiB8fCAgLy8gaGFzIG9sZCBzdGF0aWMgc2xvdHMKICAgICAgaGFzRHluYW1pY1Njb3BlZFNsb3QKICAgICk7CgogICAgdm0uJG9wdGlvbnMuX3BhcmVudFZub2RlID0gcGFyZW50Vm5vZGU7CiAgICB2bS4kdm5vZGUgPSBwYXJlbnRWbm9kZTsgLy8gdXBkYXRlIHZtJ3MgcGxhY2Vob2xkZXIgbm9kZSB3aXRob3V0IHJlLXJlbmRlcgoKICAgIGlmICh2bS5fdm5vZGUpIHsgLy8gdXBkYXRlIGNoaWxkIHRyZWUncyBwYXJlbnQKICAgICAgdm0uX3Zub2RlLnBhcmVudCA9IHBhcmVudFZub2RlOwogICAgfQogICAgdm0uJG9wdGlvbnMuX3JlbmRlckNoaWxkcmVuID0gcmVuZGVyQ2hpbGRyZW47CgogICAgLy8gdXBkYXRlICRhdHRycyBhbmQgJGxpc3RlbmVycyBoYXNoCiAgICAvLyB0aGVzZSBhcmUgYWxzbyByZWFjdGl2ZSBzbyB0aGV5IG1heSB0cmlnZ2VyIGNoaWxkIHVwZGF0ZSBpZiB0aGUgY2hpbGQKICAgIC8vIHVzZWQgdGhlbSBkdXJpbmcgcmVuZGVyCiAgICB2bS4kYXR0cnMgPSBwYXJlbnRWbm9kZS5kYXRhLmF0dHJzIHx8IGVtcHR5T2JqZWN0OwogICAgdm0uJGxpc3RlbmVycyA9IGxpc3RlbmVycyB8fCBlbXB0eU9iamVjdDsKCiAgICAvLyB1cGRhdGUgcHJvcHMKICAgIGlmIChwcm9wc0RhdGEgJiYgdm0uJG9wdGlvbnMucHJvcHMpIHsKICAgICAgdG9nZ2xlT2JzZXJ2aW5nKGZhbHNlKTsKICAgICAgdmFyIHByb3BzID0gdm0uX3Byb3BzOwogICAgICB2YXIgcHJvcEtleXMgPSB2bS4kb3B0aW9ucy5fcHJvcEtleXMgfHwgW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIga2V5ID0gcHJvcEtleXNbaV07CiAgICAgICAgdmFyIHByb3BPcHRpb25zID0gdm0uJG9wdGlvbnMucHJvcHM7IC8vIHd0ZiBmbG93PwogICAgICAgIHByb3BzW2tleV0gPSB2YWxpZGF0ZVByb3Aoa2V5LCBwcm9wT3B0aW9ucywgcHJvcHNEYXRhLCB2bSk7CiAgICAgIH0KICAgICAgdG9nZ2xlT2JzZXJ2aW5nKHRydWUpOwogICAgICAvLyBrZWVwIGEgY29weSBvZiByYXcgcHJvcHNEYXRhCiAgICAgIHZtLiRvcHRpb25zLnByb3BzRGF0YSA9IHByb3BzRGF0YTsKICAgIH0KCiAgICAvLyB1cGRhdGUgbGlzdGVuZXJzCiAgICBsaXN0ZW5lcnMgPSBsaXN0ZW5lcnMgfHwgZW1wdHlPYmplY3Q7CiAgICB2YXIgb2xkTGlzdGVuZXJzID0gdm0uJG9wdGlvbnMuX3BhcmVudExpc3RlbmVyczsKICAgIHZtLiRvcHRpb25zLl9wYXJlbnRMaXN0ZW5lcnMgPSBsaXN0ZW5lcnM7CiAgICB1cGRhdGVDb21wb25lbnRMaXN0ZW5lcnModm0sIGxpc3RlbmVycywgb2xkTGlzdGVuZXJzKTsKCiAgICAvLyByZXNvbHZlIHNsb3RzICsgZm9yY2UgdXBkYXRlIGlmIGhhcyBjaGlsZHJlbgogICAgaWYgKG5lZWRzRm9yY2VVcGRhdGUpIHsKICAgICAgdm0uJHNsb3RzID0gcmVzb2x2ZVNsb3RzKHJlbmRlckNoaWxkcmVuLCBwYXJlbnRWbm9kZS5jb250ZXh0KTsKICAgICAgdm0uJGZvcmNlVXBkYXRlKCk7CiAgICB9CgogICAgewogICAgICBpc1VwZGF0aW5nQ2hpbGRDb21wb25lbnQgPSBmYWxzZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzSW5JbmFjdGl2ZVRyZWUgKHZtKSB7CiAgICB3aGlsZSAodm0gJiYgKHZtID0gdm0uJHBhcmVudCkpIHsKICAgICAgaWYgKHZtLl9pbmFjdGl2ZSkgeyByZXR1cm4gdHJ1ZSB9CiAgICB9CiAgICByZXR1cm4gZmFsc2UKICB9CgogIGZ1bmN0aW9uIGFjdGl2YXRlQ2hpbGRDb21wb25lbnQgKHZtLCBkaXJlY3QpIHsKICAgIGlmIChkaXJlY3QpIHsKICAgICAgdm0uX2RpcmVjdEluYWN0aXZlID0gZmFsc2U7CiAgICAgIGlmIChpc0luSW5hY3RpdmVUcmVlKHZtKSkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICB9IGVsc2UgaWYgKHZtLl9kaXJlY3RJbmFjdGl2ZSkgewogICAgICByZXR1cm4KICAgIH0KICAgIGlmICh2bS5faW5hY3RpdmUgfHwgdm0uX2luYWN0aXZlID09PSBudWxsKSB7CiAgICAgIHZtLl9pbmFjdGl2ZSA9IGZhbHNlOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLiRjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIGFjdGl2YXRlQ2hpbGRDb21wb25lbnQodm0uJGNoaWxkcmVuW2ldKTsKICAgICAgfQogICAgICBjYWxsSG9vayh2bSwgJ2FjdGl2YXRlZCcpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZGVhY3RpdmF0ZUNoaWxkQ29tcG9uZW50ICh2bSwgZGlyZWN0KSB7CiAgICBpZiAoZGlyZWN0KSB7CiAgICAgIHZtLl9kaXJlY3RJbmFjdGl2ZSA9IHRydWU7CiAgICAgIGlmIChpc0luSW5hY3RpdmVUcmVlKHZtKSkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICB9CiAgICBpZiAoIXZtLl9pbmFjdGl2ZSkgewogICAgICB2bS5faW5hY3RpdmUgPSB0cnVlOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLiRjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIGRlYWN0aXZhdGVDaGlsZENvbXBvbmVudCh2bS4kY2hpbGRyZW5baV0pOwogICAgICB9CiAgICAgIGNhbGxIb29rKHZtLCAnZGVhY3RpdmF0ZWQnKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNhbGxIb29rICh2bSwgaG9vaykgewogICAgLy8gIzc1NzMgZGlzYWJsZSBkZXAgY29sbGVjdGlvbiB3aGVuIGludm9raW5nIGxpZmVjeWNsZSBob29rcwogICAgcHVzaFRhcmdldCgpOwogICAgdmFyIGhhbmRsZXJzID0gdm0uJG9wdGlvbnNbaG9va107CiAgICB2YXIgaW5mbyA9IGhvb2sgKyAiIGhvb2siOwogICAgaWYgKGhhbmRsZXJzKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgajsgaSsrKSB7CiAgICAgICAgaW52b2tlV2l0aEVycm9ySGFuZGxpbmcoaGFuZGxlcnNbaV0sIHZtLCBudWxsLCB2bSwgaW5mbyk7CiAgICAgIH0KICAgIH0KICAgIGlmICh2bS5faGFzSG9va0V2ZW50KSB7CiAgICAgIHZtLiRlbWl0KCdob29rOicgKyBob29rKTsKICAgIH0KICAgIHBvcFRhcmdldCgpOwogIH0KCiAgLyogICovCgogIHZhciBNQVhfVVBEQVRFX0NPVU5UID0gMTAwOwoKICB2YXIgcXVldWUgPSBbXTsKICB2YXIgYWN0aXZhdGVkQ2hpbGRyZW4gPSBbXTsKICB2YXIgaGFzID0ge307CiAgdmFyIGNpcmN1bGFyID0ge307CiAgdmFyIHdhaXRpbmcgPSBmYWxzZTsKICB2YXIgZmx1c2hpbmcgPSBmYWxzZTsKICB2YXIgaW5kZXggPSAwOwoKICAvKioKICAgKiBSZXNldCB0aGUgc2NoZWR1bGVyJ3Mgc3RhdGUuCiAgICovCiAgZnVuY3Rpb24gcmVzZXRTY2hlZHVsZXJTdGF0ZSAoKSB7CiAgICBpbmRleCA9IHF1ZXVlLmxlbmd0aCA9IGFjdGl2YXRlZENoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICBoYXMgPSB7fTsKICAgIHsKICAgICAgY2lyY3VsYXIgPSB7fTsKICAgIH0KICAgIHdhaXRpbmcgPSBmbHVzaGluZyA9IGZhbHNlOwogIH0KCiAgLy8gQXN5bmMgZWRnZSBjYXNlICM2NTY2IHJlcXVpcmVzIHNhdmluZyB0aGUgdGltZXN0YW1wIHdoZW4gZXZlbnQgbGlzdGVuZXJzIGFyZQogIC8vIGF0dGFjaGVkLiBIb3dldmVyLCBjYWxsaW5nIHBlcmZvcm1hbmNlLm5vdygpIGhhcyBhIHBlcmYgb3ZlcmhlYWQgZXNwZWNpYWxseQogIC8vIGlmIHRoZSBwYWdlIGhhcyB0aG91c2FuZHMgb2YgZXZlbnQgbGlzdGVuZXJzLiBJbnN0ZWFkLCB3ZSB0YWtlIGEgdGltZXN0YW1wCiAgLy8gZXZlcnkgdGltZSB0aGUgc2NoZWR1bGVyIGZsdXNoZXMgYW5kIHVzZSB0aGF0IGZvciBhbGwgZXZlbnQgbGlzdGVuZXJzCiAgLy8gYXR0YWNoZWQgZHVyaW5nIHRoYXQgZmx1c2guCiAgdmFyIGN1cnJlbnRGbHVzaFRpbWVzdGFtcCA9IDA7CgogIC8vIEFzeW5jIGVkZ2UgY2FzZSBmaXggcmVxdWlyZXMgc3RvcmluZyBhbiBldmVudCBsaXN0ZW5lcidzIGF0dGFjaCB0aW1lc3RhbXAuCiAgdmFyIGdldE5vdyA9IERhdGUubm93OwoKICAvLyBEZXRlcm1pbmUgd2hhdCBldmVudCB0aW1lc3RhbXAgdGhlIGJyb3dzZXIgaXMgdXNpbmcuIEFubm95aW5nbHksIHRoZQogIC8vIHRpbWVzdGFtcCBjYW4gZWl0aGVyIGJlIGhpLXJlcyAocmVsYXRpdmUgdG8gcGFnZSBsb2FkKSBvciBsb3ctcmVzCiAgLy8gKHJlbGF0aXZlIHRvIFVOSVggZXBvY2gpLCBzbyBpbiBvcmRlciB0byBjb21wYXJlIHRpbWUgd2UgaGF2ZSB0byB1c2UgdGhlCiAgLy8gc2FtZSB0aW1lc3RhbXAgdHlwZSB3aGVuIHNhdmluZyB0aGUgZmx1c2ggdGltZXN0YW1wLgogIC8vIEFsbCBJRSB2ZXJzaW9ucyB1c2UgbG93LXJlcyBldmVudCB0aW1lc3RhbXBzLCBhbmQgaGF2ZSBwcm9ibGVtYXRpYyBjbG9jawogIC8vIGltcGxlbWVudGF0aW9ucyAoIzk2MzIpCiAgaWYgKGluQnJvd3NlciAmJiAhaXNJRSkgewogICAgdmFyIHBlcmZvcm1hbmNlID0gd2luZG93LnBlcmZvcm1hbmNlOwogICAgaWYgKAogICAgICBwZXJmb3JtYW5jZSAmJgogICAgICB0eXBlb2YgcGVyZm9ybWFuY2Uubm93ID09PSAnZnVuY3Rpb24nICYmCiAgICAgIGdldE5vdygpID4gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50JykudGltZVN0YW1wCiAgICApIHsKICAgICAgLy8gaWYgdGhlIGV2ZW50IHRpbWVzdGFtcCwgYWx0aG91Z2ggZXZhbHVhdGVkIEFGVEVSIHRoZSBEYXRlLm5vdygpLCBpcwogICAgICAvLyBzbWFsbGVyIHRoYW4gaXQsIGl0IG1lYW5zIHRoZSBldmVudCBpcyB1c2luZyBhIGhpLXJlcyB0aW1lc3RhbXAsCiAgICAgIC8vIGFuZCB3ZSBuZWVkIHRvIHVzZSB0aGUgaGktcmVzIHZlcnNpb24gZm9yIGV2ZW50IGxpc3RlbmVyIHRpbWVzdGFtcHMgYXMKICAgICAgLy8gd2VsbC4KICAgICAgZ2V0Tm93ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCk7IH07CiAgICB9CiAgfQoKICAvKioKICAgKiBGbHVzaCBib3RoIHF1ZXVlcyBhbmQgcnVuIHRoZSB3YXRjaGVycy4KICAgKi8KICBmdW5jdGlvbiBmbHVzaFNjaGVkdWxlclF1ZXVlICgpIHsKICAgIGN1cnJlbnRGbHVzaFRpbWVzdGFtcCA9IGdldE5vdygpOwogICAgZmx1c2hpbmcgPSB0cnVlOwogICAgdmFyIHdhdGNoZXIsIGlkOwoKICAgIC8vIFNvcnQgcXVldWUgYmVmb3JlIGZsdXNoLgogICAgLy8gVGhpcyBlbnN1cmVzIHRoYXQ6CiAgICAvLyAxLiBDb21wb25lbnRzIGFyZSB1cGRhdGVkIGZyb20gcGFyZW50IHRvIGNoaWxkLiAoYmVjYXVzZSBwYXJlbnQgaXMgYWx3YXlzCiAgICAvLyAgICBjcmVhdGVkIGJlZm9yZSB0aGUgY2hpbGQpCiAgICAvLyAyLiBBIGNvbXBvbmVudCdzIHVzZXIgd2F0Y2hlcnMgYXJlIHJ1biBiZWZvcmUgaXRzIHJlbmRlciB3YXRjaGVyIChiZWNhdXNlCiAgICAvLyAgICB1c2VyIHdhdGNoZXJzIGFyZSBjcmVhdGVkIGJlZm9yZSB0aGUgcmVuZGVyIHdhdGNoZXIpCiAgICAvLyAzLiBJZiBhIGNvbXBvbmVudCBpcyBkZXN0cm95ZWQgZHVyaW5nIGEgcGFyZW50IGNvbXBvbmVudCdzIHdhdGNoZXIgcnVuLAogICAgLy8gICAgaXRzIHdhdGNoZXJzIGNhbiBiZSBza2lwcGVkLgogICAgcXVldWUuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5pZCAtIGIuaWQ7IH0pOwoKICAgIC8vIGRvIG5vdCBjYWNoZSBsZW5ndGggYmVjYXVzZSBtb3JlIHdhdGNoZXJzIG1pZ2h0IGJlIHB1c2hlZAogICAgLy8gYXMgd2UgcnVuIGV4aXN0aW5nIHdhdGNoZXJzCiAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBxdWV1ZS5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgd2F0Y2hlciA9IHF1ZXVlW2luZGV4XTsKICAgICAgaWYgKHdhdGNoZXIuYmVmb3JlKSB7CiAgICAgICAgd2F0Y2hlci5iZWZvcmUoKTsKICAgICAgfQogICAgICBpZCA9IHdhdGNoZXIuaWQ7CiAgICAgIGhhc1tpZF0gPSBudWxsOwogICAgICB3YXRjaGVyLnJ1bigpOwogICAgICAvLyBpbiBkZXYgYnVpbGQsIGNoZWNrIGFuZCBzdG9wIGNpcmN1bGFyIHVwZGF0ZXMuCiAgICAgIGlmIChoYXNbaWRdICE9IG51bGwpIHsKICAgICAgICBjaXJjdWxhcltpZF0gPSAoY2lyY3VsYXJbaWRdIHx8IDApICsgMTsKICAgICAgICBpZiAoY2lyY3VsYXJbaWRdID4gTUFYX1VQREFURV9DT1VOVCkgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgJ1lvdSBtYXkgaGF2ZSBhbiBpbmZpbml0ZSB1cGRhdGUgbG9vcCAnICsgKAogICAgICAgICAgICAgIHdhdGNoZXIudXNlcgogICAgICAgICAgICAgICAgPyAoImluIHdhdGNoZXIgd2l0aCBleHByZXNzaW9uIFwiIiArICh3YXRjaGVyLmV4cHJlc3Npb24pICsgIlwiIikKICAgICAgICAgICAgICAgIDogImluIGEgY29tcG9uZW50IHJlbmRlciBmdW5jdGlvbi4iCiAgICAgICAgICAgICksCiAgICAgICAgICAgIHdhdGNoZXIudm0KICAgICAgICAgICk7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8vIGtlZXAgY29waWVzIG9mIHBvc3QgcXVldWVzIGJlZm9yZSByZXNldHRpbmcgc3RhdGUKICAgIHZhciBhY3RpdmF0ZWRRdWV1ZSA9IGFjdGl2YXRlZENoaWxkcmVuLnNsaWNlKCk7CiAgICB2YXIgdXBkYXRlZFF1ZXVlID0gcXVldWUuc2xpY2UoKTsKCiAgICByZXNldFNjaGVkdWxlclN0YXRlKCk7CgogICAgLy8gY2FsbCBjb21wb25lbnQgdXBkYXRlZCBhbmQgYWN0aXZhdGVkIGhvb2tzCiAgICBjYWxsQWN0aXZhdGVkSG9va3MoYWN0aXZhdGVkUXVldWUpOwogICAgY2FsbFVwZGF0ZWRIb29rcyh1cGRhdGVkUXVldWUpOwoKICAgIC8vIGRldnRvb2wgaG9vawogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoZGV2dG9vbHMgJiYgY29uZmlnLmRldnRvb2xzKSB7CiAgICAgIGRldnRvb2xzLmVtaXQoJ2ZsdXNoJyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjYWxsVXBkYXRlZEhvb2tzIChxdWV1ZSkgewogICAgdmFyIGkgPSBxdWV1ZS5sZW5ndGg7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIHZhciB3YXRjaGVyID0gcXVldWVbaV07CiAgICAgIHZhciB2bSA9IHdhdGNoZXIudm07CiAgICAgIGlmICh2bS5fd2F0Y2hlciA9PT0gd2F0Y2hlciAmJiB2bS5faXNNb3VudGVkICYmICF2bS5faXNEZXN0cm95ZWQpIHsKICAgICAgICBjYWxsSG9vayh2bSwgJ3VwZGF0ZWQnKTsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogUXVldWUgYSBrZXB0LWFsaXZlIGNvbXBvbmVudCB0aGF0IHdhcyBhY3RpdmF0ZWQgZHVyaW5nIHBhdGNoLgogICAqIFRoZSBxdWV1ZSB3aWxsIGJlIHByb2Nlc3NlZCBhZnRlciB0aGUgZW50aXJlIHRyZWUgaGFzIGJlZW4gcGF0Y2hlZC4KICAgKi8KICBmdW5jdGlvbiBxdWV1ZUFjdGl2YXRlZENvbXBvbmVudCAodm0pIHsKICAgIC8vIHNldHRpbmcgX2luYWN0aXZlIHRvIGZhbHNlIGhlcmUgc28gdGhhdCBhIHJlbmRlciBmdW5jdGlvbiBjYW4KICAgIC8vIHJlbHkgb24gY2hlY2tpbmcgd2hldGhlciBpdCdzIGluIGFuIGluYWN0aXZlIHRyZWUgKGUuZy4gcm91dGVyLXZpZXcpCiAgICB2bS5faW5hY3RpdmUgPSBmYWxzZTsKICAgIGFjdGl2YXRlZENoaWxkcmVuLnB1c2godm0pOwogIH0KCiAgZnVuY3Rpb24gY2FsbEFjdGl2YXRlZEhvb2tzIChxdWV1ZSkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykgewogICAgICBxdWV1ZVtpXS5faW5hY3RpdmUgPSB0cnVlOwogICAgICBhY3RpdmF0ZUNoaWxkQ29tcG9uZW50KHF1ZXVlW2ldLCB0cnVlIC8qIHRydWUgKi8pOwogICAgfQogIH0KCiAgLyoqCiAgICogUHVzaCBhIHdhdGNoZXIgaW50byB0aGUgd2F0Y2hlciBxdWV1ZS4KICAgKiBKb2JzIHdpdGggZHVwbGljYXRlIElEcyB3aWxsIGJlIHNraXBwZWQgdW5sZXNzIGl0J3MKICAgKiBwdXNoZWQgd2hlbiB0aGUgcXVldWUgaXMgYmVpbmcgZmx1c2hlZC4KICAgKi8KICBmdW5jdGlvbiBxdWV1ZVdhdGNoZXIgKHdhdGNoZXIpIHsKICAgIHZhciBpZCA9IHdhdGNoZXIuaWQ7CiAgICBpZiAoaGFzW2lkXSA9PSBudWxsKSB7CiAgICAgIGhhc1tpZF0gPSB0cnVlOwogICAgICBpZiAoIWZsdXNoaW5nKSB7CiAgICAgICAgcXVldWUucHVzaCh3YXRjaGVyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBpZiBhbHJlYWR5IGZsdXNoaW5nLCBzcGxpY2UgdGhlIHdhdGNoZXIgYmFzZWQgb24gaXRzIGlkCiAgICAgICAgLy8gaWYgYWxyZWFkeSBwYXN0IGl0cyBpZCwgaXQgd2lsbCBiZSBydW4gbmV4dCBpbW1lZGlhdGVseS4KICAgICAgICB2YXIgaSA9IHF1ZXVlLmxlbmd0aCAtIDE7CiAgICAgICAgd2hpbGUgKGkgPiBpbmRleCAmJiBxdWV1ZVtpXS5pZCA+IHdhdGNoZXIuaWQpIHsKICAgICAgICAgIGktLTsKICAgICAgICB9CiAgICAgICAgcXVldWUuc3BsaWNlKGkgKyAxLCAwLCB3YXRjaGVyKTsKICAgICAgfQogICAgICAvLyBxdWV1ZSB0aGUgZmx1c2gKICAgICAgaWYgKCF3YWl0aW5nKSB7CiAgICAgICAgd2FpdGluZyA9IHRydWU7CgogICAgICAgIGlmICghY29uZmlnLmFzeW5jKSB7CiAgICAgICAgICBmbHVzaFNjaGVkdWxlclF1ZXVlKCk7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgbmV4dFRpY2soZmx1c2hTY2hlZHVsZXJRdWV1ZSk7CiAgICAgIH0KICAgIH0KICB9CgogIC8qICAqLwoKCgogIHZhciB1aWQkMiA9IDA7CgogIC8qKgogICAqIEEgd2F0Y2hlciBwYXJzZXMgYW4gZXhwcmVzc2lvbiwgY29sbGVjdHMgZGVwZW5kZW5jaWVzLAogICAqIGFuZCBmaXJlcyBjYWxsYmFjayB3aGVuIHRoZSBleHByZXNzaW9uIHZhbHVlIGNoYW5nZXMuCiAgICogVGhpcyBpcyB1c2VkIGZvciBib3RoIHRoZSAkd2F0Y2goKSBhcGkgYW5kIGRpcmVjdGl2ZXMuCiAgICovCiAgdmFyIFdhdGNoZXIgPSBmdW5jdGlvbiBXYXRjaGVyICgKICAgIHZtLAogICAgZXhwT3JGbiwKICAgIGNiLAogICAgb3B0aW9ucywKICAgIGlzUmVuZGVyV2F0Y2hlcgogICkgewogICAgdGhpcy52bSA9IHZtOwogICAgaWYgKGlzUmVuZGVyV2F0Y2hlcikgewogICAgICB2bS5fd2F0Y2hlciA9IHRoaXM7CiAgICB9CiAgICB2bS5fd2F0Y2hlcnMucHVzaCh0aGlzKTsKICAgIC8vIG9wdGlvbnMKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIHRoaXMuZGVlcCA9ICEhb3B0aW9ucy5kZWVwOwogICAgICB0aGlzLnVzZXIgPSAhIW9wdGlvbnMudXNlcjsKICAgICAgdGhpcy5sYXp5ID0gISFvcHRpb25zLmxhenk7CiAgICAgIHRoaXMuc3luYyA9ICEhb3B0aW9ucy5zeW5jOwogICAgICB0aGlzLmJlZm9yZSA9IG9wdGlvbnMuYmVmb3JlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kZWVwID0gdGhpcy51c2VyID0gdGhpcy5sYXp5ID0gdGhpcy5zeW5jID0gZmFsc2U7CiAgICB9CiAgICB0aGlzLmNiID0gY2I7CiAgICB0aGlzLmlkID0gKyt1aWQkMjsgLy8gdWlkIGZvciBiYXRjaGluZwogICAgdGhpcy5hY3RpdmUgPSB0cnVlOwogICAgdGhpcy5kaXJ0eSA9IHRoaXMubGF6eTsgLy8gZm9yIGxhenkgd2F0Y2hlcnMKICAgIHRoaXMuZGVwcyA9IFtdOwogICAgdGhpcy5uZXdEZXBzID0gW107CiAgICB0aGlzLmRlcElkcyA9IG5ldyBfU2V0KCk7CiAgICB0aGlzLm5ld0RlcElkcyA9IG5ldyBfU2V0KCk7CiAgICB0aGlzLmV4cHJlc3Npb24gPSBleHBPckZuLnRvU3RyaW5nKCk7CiAgICAvLyBwYXJzZSBleHByZXNzaW9uIGZvciBnZXR0ZXIKICAgIGlmICh0eXBlb2YgZXhwT3JGbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICB0aGlzLmdldHRlciA9IGV4cE9yRm47CiAgICB9IGVsc2UgewogICAgICB0aGlzLmdldHRlciA9IHBhcnNlUGF0aChleHBPckZuKTsKICAgICAgaWYgKCF0aGlzLmdldHRlcikgewogICAgICAgIHRoaXMuZ2V0dGVyID0gbm9vcDsKICAgICAgICB3YXJuKAogICAgICAgICAgIkZhaWxlZCB3YXRjaGluZyBwYXRoOiBcIiIgKyBleHBPckZuICsgIlwiICIgKwogICAgICAgICAgJ1dhdGNoZXIgb25seSBhY2NlcHRzIHNpbXBsZSBkb3QtZGVsaW1pdGVkIHBhdGhzLiAnICsKICAgICAgICAgICdGb3IgZnVsbCBjb250cm9sLCB1c2UgYSBmdW5jdGlvbiBpbnN0ZWFkLicsCiAgICAgICAgICB2bQogICAgICAgICk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMudmFsdWUgPSB0aGlzLmxhenkKICAgICAgPyB1bmRlZmluZWQKICAgICAgOiB0aGlzLmdldCgpOwogIH07CgogIC8qKgogICAqIEV2YWx1YXRlIHRoZSBnZXR0ZXIsIGFuZCByZS1jb2xsZWN0IGRlcGVuZGVuY2llcy4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiBnZXQgKCkgewogICAgcHVzaFRhcmdldCh0aGlzKTsKICAgIHZhciB2YWx1ZTsKICAgIHZhciB2bSA9IHRoaXMudm07CiAgICB0cnkgewogICAgICB2YWx1ZSA9IHRoaXMuZ2V0dGVyLmNhbGwodm0sIHZtKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaWYgKHRoaXMudXNlcikgewogICAgICAgIGhhbmRsZUVycm9yKGUsIHZtLCAoImdldHRlciBmb3Igd2F0Y2hlciBcIiIgKyAodGhpcy5leHByZXNzaW9uKSArICJcIiIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBlCiAgICAgIH0KICAgIH0gZmluYWxseSB7CiAgICAgIC8vICJ0b3VjaCIgZXZlcnkgcHJvcGVydHkgc28gdGhleSBhcmUgYWxsIHRyYWNrZWQgYXMKICAgICAgLy8gZGVwZW5kZW5jaWVzIGZvciBkZWVwIHdhdGNoaW5nCiAgICAgIGlmICh0aGlzLmRlZXApIHsKICAgICAgICB0cmF2ZXJzZSh2YWx1ZSk7CiAgICAgIH0KICAgICAgcG9wVGFyZ2V0KCk7CiAgICAgIHRoaXMuY2xlYW51cERlcHMoKTsKICAgIH0KICAgIHJldHVybiB2YWx1ZQogIH07CgogIC8qKgogICAqIEFkZCBhIGRlcGVuZGVuY3kgdG8gdGhpcyBkaXJlY3RpdmUuCiAgICovCiAgV2F0Y2hlci5wcm90b3R5cGUuYWRkRGVwID0gZnVuY3Rpb24gYWRkRGVwIChkZXApIHsKICAgIHZhciBpZCA9IGRlcC5pZDsKICAgIGlmICghdGhpcy5uZXdEZXBJZHMuaGFzKGlkKSkgewogICAgICB0aGlzLm5ld0RlcElkcy5hZGQoaWQpOwogICAgICB0aGlzLm5ld0RlcHMucHVzaChkZXApOwogICAgICBpZiAoIXRoaXMuZGVwSWRzLmhhcyhpZCkpIHsKICAgICAgICBkZXAuYWRkU3ViKHRoaXMpOwogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogQ2xlYW4gdXAgZm9yIGRlcGVuZGVuY3kgY29sbGVjdGlvbi4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5jbGVhbnVwRGVwcyA9IGZ1bmN0aW9uIGNsZWFudXBEZXBzICgpIHsKICAgIHZhciBpID0gdGhpcy5kZXBzLmxlbmd0aDsKICAgIHdoaWxlIChpLS0pIHsKICAgICAgdmFyIGRlcCA9IHRoaXMuZGVwc1tpXTsKICAgICAgaWYgKCF0aGlzLm5ld0RlcElkcy5oYXMoZGVwLmlkKSkgewogICAgICAgIGRlcC5yZW1vdmVTdWIodGhpcyk7CiAgICAgIH0KICAgIH0KICAgIHZhciB0bXAgPSB0aGlzLmRlcElkczsKICAgIHRoaXMuZGVwSWRzID0gdGhpcy5uZXdEZXBJZHM7CiAgICB0aGlzLm5ld0RlcElkcyA9IHRtcDsKICAgIHRoaXMubmV3RGVwSWRzLmNsZWFyKCk7CiAgICB0bXAgPSB0aGlzLmRlcHM7CiAgICB0aGlzLmRlcHMgPSB0aGlzLm5ld0RlcHM7CiAgICB0aGlzLm5ld0RlcHMgPSB0bXA7CiAgICB0aGlzLm5ld0RlcHMubGVuZ3RoID0gMDsKICB9OwoKICAvKioKICAgKiBTdWJzY3JpYmVyIGludGVyZmFjZS4KICAgKiBXaWxsIGJlIGNhbGxlZCB3aGVuIGEgZGVwZW5kZW5jeSBjaGFuZ2VzLgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIHVwZGF0ZSAoKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgaWYgKHRoaXMubGF6eSkgewogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAodGhpcy5zeW5jKSB7CiAgICAgIHRoaXMucnVuKCk7CiAgICB9IGVsc2UgewogICAgICBxdWV1ZVdhdGNoZXIodGhpcyk7CiAgICB9CiAgfTsKCiAgLyoqCiAgICogU2NoZWR1bGVyIGpvYiBpbnRlcmZhY2UuCiAgICogV2lsbCBiZSBjYWxsZWQgYnkgdGhlIHNjaGVkdWxlci4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiBydW4gKCkgewogICAgaWYgKHRoaXMuYWN0aXZlKSB7CiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0KCk7CiAgICAgIGlmICgKICAgICAgICB2YWx1ZSAhPT0gdGhpcy52YWx1ZSB8fAogICAgICAgIC8vIERlZXAgd2F0Y2hlcnMgYW5kIHdhdGNoZXJzIG9uIE9iamVjdC9BcnJheXMgc2hvdWxkIGZpcmUgZXZlbgogICAgICAgIC8vIHdoZW4gdGhlIHZhbHVlIGlzIHRoZSBzYW1lLCBiZWNhdXNlIHRoZSB2YWx1ZSBtYXkKICAgICAgICAvLyBoYXZlIG11dGF0ZWQuCiAgICAgICAgaXNPYmplY3QodmFsdWUpIHx8CiAgICAgICAgdGhpcy5kZWVwCiAgICAgICkgewogICAgICAgIC8vIHNldCBuZXcgdmFsdWUKICAgICAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLnZhbHVlOwogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICBpZiAodGhpcy51c2VyKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLmNiLmNhbGwodGhpcy52bSwgdmFsdWUsIG9sZFZhbHVlKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaGFuZGxlRXJyb3IoZSwgdGhpcy52bSwgKCJjYWxsYmFjayBmb3Igd2F0Y2hlciBcIiIgKyAodGhpcy5leHByZXNzaW9uKSArICJcIiIpKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jYi5jYWxsKHRoaXMudm0sIHZhbHVlLCBvbGRWYWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLyoqCiAgICogRXZhbHVhdGUgdGhlIHZhbHVlIG9mIHRoZSB3YXRjaGVyLgogICAqIFRoaXMgb25seSBnZXRzIGNhbGxlZCBmb3IgbGF6eSB3YXRjaGVycy4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlICgpIHsKICAgIHRoaXMudmFsdWUgPSB0aGlzLmdldCgpOwogICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogIH07CgogIC8qKgogICAqIERlcGVuZCBvbiBhbGwgZGVwcyBjb2xsZWN0ZWQgYnkgdGhpcyB3YXRjaGVyLgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLmRlcGVuZCA9IGZ1bmN0aW9uIGRlcGVuZCAoKSB7CiAgICB2YXIgaSA9IHRoaXMuZGVwcy5sZW5ndGg7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIHRoaXMuZGVwc1tpXS5kZXBlbmQoKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBSZW1vdmUgc2VsZiBmcm9tIGFsbCBkZXBlbmRlbmNpZXMnIHN1YnNjcmliZXIgbGlzdC4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS50ZWFyZG93biA9IGZ1bmN0aW9uIHRlYXJkb3duICgpIHsKICAgIGlmICh0aGlzLmFjdGl2ZSkgewogICAgICAvLyByZW1vdmUgc2VsZiBmcm9tIHZtJ3Mgd2F0Y2hlciBsaXN0CiAgICAgIC8vIHRoaXMgaXMgYSBzb21ld2hhdCBleHBlbnNpdmUgb3BlcmF0aW9uIHNvIHdlIHNraXAgaXQKICAgICAgLy8gaWYgdGhlIHZtIGlzIGJlaW5nIGRlc3Ryb3llZC4KICAgICAgaWYgKCF0aGlzLnZtLl9pc0JlaW5nRGVzdHJveWVkKSB7CiAgICAgICAgcmVtb3ZlKHRoaXMudm0uX3dhdGNoZXJzLCB0aGlzKTsKICAgICAgfQogICAgICB2YXIgaSA9IHRoaXMuZGVwcy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB0aGlzLmRlcHNbaV0ucmVtb3ZlU3ViKHRoaXMpOwogICAgICB9CiAgICAgIHRoaXMuYWN0aXZlID0gZmFsc2U7CiAgICB9CiAgfTsKCiAgLyogICovCgogIHZhciBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24gPSB7CiAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgZ2V0OiBub29wLAogICAgc2V0OiBub29wCiAgfTsKCiAgZnVuY3Rpb24gcHJveHkgKHRhcmdldCwgc291cmNlS2V5LCBrZXkpIHsKICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5nZXQgPSBmdW5jdGlvbiBwcm94eUdldHRlciAoKSB7CiAgICAgIHJldHVybiB0aGlzW3NvdXJjZUtleV1ba2V5XQogICAgfTsKICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5zZXQgPSBmdW5jdGlvbiBwcm94eVNldHRlciAodmFsKSB7CiAgICAgIHRoaXNbc291cmNlS2V5XVtrZXldID0gdmFsOwogICAgfTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc2hhcmVkUHJvcGVydHlEZWZpbml0aW9uKTsKICB9CgogIGZ1bmN0aW9uIGluaXRTdGF0ZSAodm0pIHsKICAgIHZtLl93YXRjaGVycyA9IFtdOwogICAgdmFyIG9wdHMgPSB2bS4kb3B0aW9uczsKICAgIGlmIChvcHRzLnByb3BzKSB7IGluaXRQcm9wcyh2bSwgb3B0cy5wcm9wcyk7IH0KICAgIGlmIChvcHRzLm1ldGhvZHMpIHsgaW5pdE1ldGhvZHModm0sIG9wdHMubWV0aG9kcyk7IH0KICAgIGlmIChvcHRzLmRhdGEpIHsKICAgICAgaW5pdERhdGEodm0pOwogICAgfSBlbHNlIHsKICAgICAgb2JzZXJ2ZSh2bS5fZGF0YSA9IHt9LCB0cnVlIC8qIGFzUm9vdERhdGEgKi8pOwogICAgfQogICAgaWYgKG9wdHMuY29tcHV0ZWQpIHsgaW5pdENvbXB1dGVkKHZtLCBvcHRzLmNvbXB1dGVkKTsgfQogICAgaWYgKG9wdHMud2F0Y2ggJiYgb3B0cy53YXRjaCAhPT0gbmF0aXZlV2F0Y2gpIHsKICAgICAgaW5pdFdhdGNoKHZtLCBvcHRzLndhdGNoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRQcm9wcyAodm0sIHByb3BzT3B0aW9ucykgewogICAgdmFyIHByb3BzRGF0YSA9IHZtLiRvcHRpb25zLnByb3BzRGF0YSB8fCB7fTsKICAgIHZhciBwcm9wcyA9IHZtLl9wcm9wcyA9IHt9OwogICAgLy8gY2FjaGUgcHJvcCBrZXlzIHNvIHRoYXQgZnV0dXJlIHByb3BzIHVwZGF0ZXMgY2FuIGl0ZXJhdGUgdXNpbmcgQXJyYXkKICAgIC8vIGluc3RlYWQgb2YgZHluYW1pYyBvYmplY3Qga2V5IGVudW1lcmF0aW9uLgogICAgdmFyIGtleXMgPSB2bS4kb3B0aW9ucy5fcHJvcEtleXMgPSBbXTsKICAgIHZhciBpc1Jvb3QgPSAhdm0uJHBhcmVudDsKICAgIC8vIHJvb3QgaW5zdGFuY2UgcHJvcHMgc2hvdWxkIGJlIGNvbnZlcnRlZAogICAgaWYgKCFpc1Jvb3QpIHsKICAgICAgdG9nZ2xlT2JzZXJ2aW5nKGZhbHNlKTsKICAgIH0KICAgIHZhciBsb29wID0gZnVuY3Rpb24gKCBrZXkgKSB7CiAgICAgIGtleXMucHVzaChrZXkpOwogICAgICB2YXIgdmFsdWUgPSB2YWxpZGF0ZVByb3Aoa2V5LCBwcm9wc09wdGlvbnMsIHByb3BzRGF0YSwgdm0pOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgICB7CiAgICAgICAgdmFyIGh5cGhlbmF0ZWRLZXkgPSBoeXBoZW5hdGUoa2V5KTsKICAgICAgICBpZiAoaXNSZXNlcnZlZEF0dHJpYnV0ZShoeXBoZW5hdGVkS2V5KSB8fAogICAgICAgICAgICBjb25maWcuaXNSZXNlcnZlZEF0dHIoaHlwaGVuYXRlZEtleSkpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICgiXCIiICsgaHlwaGVuYXRlZEtleSArICJcIiBpcyBhIHJlc2VydmVkIGF0dHJpYnV0ZSBhbmQgY2Fubm90IGJlIHVzZWQgYXMgY29tcG9uZW50IHByb3AuIiksCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBkZWZpbmVSZWFjdGl2ZSQkMShwcm9wcywga2V5LCB2YWx1ZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFpc1Jvb3QgJiYgIWlzVXBkYXRpbmdDaGlsZENvbXBvbmVudCkgewogICAgICAgICAgICB3YXJuKAogICAgICAgICAgICAgICJBdm9pZCBtdXRhdGluZyBhIHByb3AgZGlyZWN0bHkgc2luY2UgdGhlIHZhbHVlIHdpbGwgYmUgIiArCiAgICAgICAgICAgICAgIm92ZXJ3cml0dGVuIHdoZW5ldmVyIHRoZSBwYXJlbnQgY29tcG9uZW50IHJlLXJlbmRlcnMuICIgKwogICAgICAgICAgICAgICJJbnN0ZWFkLCB1c2UgYSBkYXRhIG9yIGNvbXB1dGVkIHByb3BlcnR5IGJhc2VkIG9uIHRoZSBwcm9wJ3MgIiArCiAgICAgICAgICAgICAgInZhbHVlLiBQcm9wIGJlaW5nIG11dGF0ZWQ6IFwiIiArIGtleSArICJcIiIsCiAgICAgICAgICAgICAgdm0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICAvLyBzdGF0aWMgcHJvcHMgYXJlIGFscmVhZHkgcHJveGllZCBvbiB0aGUgY29tcG9uZW50J3MgcHJvdG90eXBlCiAgICAgIC8vIGR1cmluZyBWdWUuZXh0ZW5kKCkuIFdlIG9ubHkgbmVlZCB0byBwcm94eSBwcm9wcyBkZWZpbmVkIGF0CiAgICAgIC8vIGluc3RhbnRpYXRpb24gaGVyZS4KICAgICAgaWYgKCEoa2V5IGluIHZtKSkgewogICAgICAgIHByb3h5KHZtLCAiX3Byb3BzIiwga2V5KTsKICAgICAgfQogICAgfTsKCiAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHNPcHRpb25zKSBsb29wKCBrZXkgKTsKICAgIHRvZ2dsZU9ic2VydmluZyh0cnVlKTsKICB9CgogIGZ1bmN0aW9uIGluaXREYXRhICh2bSkgewogICAgdmFyIGRhdGEgPSB2bS4kb3B0aW9ucy5kYXRhOwogICAgZGF0YSA9IHZtLl9kYXRhID0gdHlwZW9mIGRhdGEgPT09ICdmdW5jdGlvbicKICAgICAgPyBnZXREYXRhKGRhdGEsIHZtKQogICAgICA6IGRhdGEgfHwge307CiAgICBpZiAoIWlzUGxhaW5PYmplY3QoZGF0YSkpIHsKICAgICAgZGF0YSA9IHt9OwogICAgICB3YXJuKAogICAgICAgICdkYXRhIGZ1bmN0aW9ucyBzaG91bGQgcmV0dXJuIGFuIG9iamVjdDpcbicgKwogICAgICAgICdodHRwczovL3Z1ZWpzLm9yZy92Mi9ndWlkZS9jb21wb25lbnRzLmh0bWwjZGF0YS1NdXN0LUJlLWEtRnVuY3Rpb24nLAogICAgICAgIHZtCiAgICAgICk7CiAgICB9CiAgICAvLyBwcm94eSBkYXRhIG9uIGluc3RhbmNlCiAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpOwogICAgdmFyIHByb3BzID0gdm0uJG9wdGlvbnMucHJvcHM7CiAgICB2YXIgbWV0aG9kcyA9IHZtLiRvcHRpb25zLm1ldGhvZHM7CiAgICB2YXIgaSA9IGtleXMubGVuZ3RoOwogICAgd2hpbGUgKGktLSkgewogICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgewogICAgICAgIGlmIChtZXRob2RzICYmIGhhc093bihtZXRob2RzLCBrZXkpKSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAoIk1ldGhvZCBcIiIgKyBrZXkgKyAiXCIgaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkIGFzIGEgZGF0YSBwcm9wZXJ0eS4iKSwKICAgICAgICAgICAgdm0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwcm9wcyAmJiBoYXNPd24ocHJvcHMsIGtleSkpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgIlRoZSBkYXRhIHByb3BlcnR5IFwiIiArIGtleSArICJcIiBpcyBhbHJlYWR5IGRlY2xhcmVkIGFzIGEgcHJvcC4gIiArCiAgICAgICAgICAiVXNlIHByb3AgZGVmYXVsdCB2YWx1ZSBpbnN0ZWFkLiIsCiAgICAgICAgICB2bQogICAgICAgICk7CiAgICAgIH0gZWxzZSBpZiAoIWlzUmVzZXJ2ZWQoa2V5KSkgewogICAgICAgIHByb3h5KHZtLCAiX2RhdGEiLCBrZXkpOwogICAgICB9CiAgICB9CiAgICAvLyBvYnNlcnZlIGRhdGEKICAgIG9ic2VydmUoZGF0YSwgdHJ1ZSAvKiBhc1Jvb3REYXRhICovKTsKICB9CgogIGZ1bmN0aW9uIGdldERhdGEgKGRhdGEsIHZtKSB7CiAgICAvLyAjNzU3MyBkaXNhYmxlIGRlcCBjb2xsZWN0aW9uIHdoZW4gaW52b2tpbmcgZGF0YSBnZXR0ZXJzCiAgICBwdXNoVGFyZ2V0KCk7CiAgICB0cnkgewogICAgICByZXR1cm4gZGF0YS5jYWxsKHZtLCB2bSkKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sICJkYXRhKCkiKTsKICAgICAgcmV0dXJuIHt9CiAgICB9IGZpbmFsbHkgewogICAgICBwb3BUYXJnZXQoKTsKICAgIH0KICB9CgogIHZhciBjb21wdXRlZFdhdGNoZXJPcHRpb25zID0geyBsYXp5OiB0cnVlIH07CgogIGZ1bmN0aW9uIGluaXRDb21wdXRlZCAodm0sIGNvbXB1dGVkKSB7CiAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgIHZhciB3YXRjaGVycyA9IHZtLl9jb21wdXRlZFdhdGNoZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIC8vIGNvbXB1dGVkIHByb3BlcnRpZXMgYXJlIGp1c3QgZ2V0dGVycyBkdXJpbmcgU1NSCiAgICB2YXIgaXNTU1IgPSBpc1NlcnZlclJlbmRlcmluZygpOwoKICAgIGZvciAodmFyIGtleSBpbiBjb21wdXRlZCkgewogICAgICB2YXIgdXNlckRlZiA9IGNvbXB1dGVkW2tleV07CiAgICAgIHZhciBnZXR0ZXIgPSB0eXBlb2YgdXNlckRlZiA9PT0gJ2Z1bmN0aW9uJyA/IHVzZXJEZWYgOiB1c2VyRGVmLmdldDsKICAgICAgaWYgKGdldHRlciA9PSBudWxsKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICgiR2V0dGVyIGlzIG1pc3NpbmcgZm9yIGNvbXB1dGVkIHByb3BlcnR5IFwiIiArIGtleSArICJcIi4iKSwKICAgICAgICAgIHZtCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgaWYgKCFpc1NTUikgewogICAgICAgIC8vIGNyZWF0ZSBpbnRlcm5hbCB3YXRjaGVyIGZvciB0aGUgY29tcHV0ZWQgcHJvcGVydHkuCiAgICAgICAgd2F0Y2hlcnNba2V5XSA9IG5ldyBXYXRjaGVyKAogICAgICAgICAgdm0sCiAgICAgICAgICBnZXR0ZXIgfHwgbm9vcCwKICAgICAgICAgIG5vb3AsCiAgICAgICAgICBjb21wdXRlZFdhdGNoZXJPcHRpb25zCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgLy8gY29tcG9uZW50LWRlZmluZWQgY29tcHV0ZWQgcHJvcGVydGllcyBhcmUgYWxyZWFkeSBkZWZpbmVkIG9uIHRoZQogICAgICAvLyBjb21wb25lbnQgcHJvdG90eXBlLiBXZSBvbmx5IG5lZWQgdG8gZGVmaW5lIGNvbXB1dGVkIHByb3BlcnRpZXMgZGVmaW5lZAogICAgICAvLyBhdCBpbnN0YW50aWF0aW9uIGhlcmUuCiAgICAgIGlmICghKGtleSBpbiB2bSkpIHsKICAgICAgICBkZWZpbmVDb21wdXRlZCh2bSwga2V5LCB1c2VyRGVmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoa2V5IGluIHZtLiRkYXRhKSB7CiAgICAgICAgICB3YXJuKCgiVGhlIGNvbXB1dGVkIHByb3BlcnR5IFwiIiArIGtleSArICJcIiBpcyBhbHJlYWR5IGRlZmluZWQgaW4gZGF0YS4iKSwgdm0pOwogICAgICAgIH0gZWxzZSBpZiAodm0uJG9wdGlvbnMucHJvcHMgJiYga2V5IGluIHZtLiRvcHRpb25zLnByb3BzKSB7CiAgICAgICAgICB3YXJuKCgiVGhlIGNvbXB1dGVkIHByb3BlcnR5IFwiIiArIGtleSArICJcIiBpcyBhbHJlYWR5IGRlZmluZWQgYXMgYSBwcm9wLiIpLCB2bSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkZWZpbmVDb21wdXRlZCAoCiAgICB0YXJnZXQsCiAgICBrZXksCiAgICB1c2VyRGVmCiAgKSB7CiAgICB2YXIgc2hvdWxkQ2FjaGUgPSAhaXNTZXJ2ZXJSZW5kZXJpbmcoKTsKICAgIGlmICh0eXBlb2YgdXNlckRlZiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24uZ2V0ID0gc2hvdWxkQ2FjaGUKICAgICAgICA/IGNyZWF0ZUNvbXB1dGVkR2V0dGVyKGtleSkKICAgICAgICA6IGNyZWF0ZUdldHRlckludm9rZXIodXNlckRlZik7CiAgICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5zZXQgPSBub29wOwogICAgfSBlbHNlIHsKICAgICAgc2hhcmVkUHJvcGVydHlEZWZpbml0aW9uLmdldCA9IHVzZXJEZWYuZ2V0CiAgICAgICAgPyBzaG91bGRDYWNoZSAmJiB1c2VyRGVmLmNhY2hlICE9PSBmYWxzZQogICAgICAgICAgPyBjcmVhdGVDb21wdXRlZEdldHRlcihrZXkpCiAgICAgICAgICA6IGNyZWF0ZUdldHRlckludm9rZXIodXNlckRlZi5nZXQpCiAgICAgICAgOiBub29wOwogICAgICBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24uc2V0ID0gdXNlckRlZi5zZXQgfHwgbm9vcDsKICAgIH0KICAgIGlmIChzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24uc2V0ID09PSBub29wKSB7CiAgICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5zZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICgiQ29tcHV0ZWQgcHJvcGVydHkgXCIiICsga2V5ICsgIlwiIHdhcyBhc3NpZ25lZCB0byBidXQgaXQgaGFzIG5vIHNldHRlci4iKSwKICAgICAgICAgIHRoaXMKICAgICAgICApOwogICAgICB9OwogICAgfQogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24pOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQ29tcHV0ZWRHZXR0ZXIgKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbXB1dGVkR2V0dGVyICgpIHsKICAgICAgdmFyIHdhdGNoZXIgPSB0aGlzLl9jb21wdXRlZFdhdGNoZXJzICYmIHRoaXMuX2NvbXB1dGVkV2F0Y2hlcnNba2V5XTsKICAgICAgaWYgKHdhdGNoZXIpIHsKICAgICAgICBpZiAod2F0Y2hlci5kaXJ0eSkgewogICAgICAgICAgd2F0Y2hlci5ldmFsdWF0ZSgpOwogICAgICAgIH0KICAgICAgICBpZiAoRGVwLnRhcmdldCkgewogICAgICAgICAgd2F0Y2hlci5kZXBlbmQoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHdhdGNoZXIudmFsdWUKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlR2V0dGVySW52b2tlcihmbikgewogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbXB1dGVkR2V0dGVyICgpIHsKICAgICAgcmV0dXJuIGZuLmNhbGwodGhpcywgdGhpcykKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRNZXRob2RzICh2bSwgbWV0aG9kcykgewogICAgdmFyIHByb3BzID0gdm0uJG9wdGlvbnMucHJvcHM7CiAgICBmb3IgKHZhciBrZXkgaW4gbWV0aG9kcykgewogICAgICB7CiAgICAgICAgaWYgKHR5cGVvZiBtZXRob2RzW2tleV0gIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICJNZXRob2QgXCIiICsga2V5ICsgIlwiIGhhcyB0eXBlIFwiIiArICh0eXBlb2YgbWV0aG9kc1trZXldKSArICJcIiBpbiB0aGUgY29tcG9uZW50IGRlZmluaXRpb24uICIgKwogICAgICAgICAgICAiRGlkIHlvdSByZWZlcmVuY2UgdGhlIGZ1bmN0aW9uIGNvcnJlY3RseT8iLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKHByb3BzICYmIGhhc093bihwcm9wcywga2V5KSkgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgKCJNZXRob2QgXCIiICsga2V5ICsgIlwiIGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZCBhcyBhIHByb3AuIiksCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoKGtleSBpbiB2bSkgJiYgaXNSZXNlcnZlZChrZXkpKSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAiTWV0aG9kIFwiIiArIGtleSArICJcIiBjb25mbGljdHMgd2l0aCBhbiBleGlzdGluZyBWdWUgaW5zdGFuY2UgbWV0aG9kLiAiICsKICAgICAgICAgICAgIkF2b2lkIGRlZmluaW5nIGNvbXBvbmVudCBtZXRob2RzIHRoYXQgc3RhcnQgd2l0aCBfIG9yICQuIgogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdm1ba2V5XSA9IHR5cGVvZiBtZXRob2RzW2tleV0gIT09ICdmdW5jdGlvbicgPyBub29wIDogYmluZChtZXRob2RzW2tleV0sIHZtKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRXYXRjaCAodm0sIHdhdGNoKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gd2F0Y2gpIHsKICAgICAgdmFyIGhhbmRsZXIgPSB3YXRjaFtrZXldOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShoYW5kbGVyKSkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFuZGxlci5sZW5ndGg7IGkrKykgewogICAgICAgICAgY3JlYXRlV2F0Y2hlcih2bSwga2V5LCBoYW5kbGVyW2ldKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY3JlYXRlV2F0Y2hlcih2bSwga2V5LCBoYW5kbGVyKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlV2F0Y2hlciAoCiAgICB2bSwKICAgIGV4cE9yRm4sCiAgICBoYW5kbGVyLAogICAgb3B0aW9ucwogICkgewogICAgaWYgKGlzUGxhaW5PYmplY3QoaGFuZGxlcikpIHsKICAgICAgb3B0aW9ucyA9IGhhbmRsZXI7CiAgICAgIGhhbmRsZXIgPSBoYW5kbGVyLmhhbmRsZXI7CiAgICB9CiAgICBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICdzdHJpbmcnKSB7CiAgICAgIGhhbmRsZXIgPSB2bVtoYW5kbGVyXTsKICAgIH0KICAgIHJldHVybiB2bS4kd2F0Y2goZXhwT3JGbiwgaGFuZGxlciwgb3B0aW9ucykKICB9CgogIGZ1bmN0aW9uIHN0YXRlTWl4aW4gKFZ1ZSkgewogICAgLy8gZmxvdyBzb21laG93IGhhcyBwcm9ibGVtcyB3aXRoIGRpcmVjdGx5IGRlY2xhcmVkIGRlZmluaXRpb24gb2JqZWN0CiAgICAvLyB3aGVuIHVzaW5nIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwgc28gd2UgaGF2ZSB0byBwcm9jZWR1cmFsbHkgYnVpbGQgdXAKICAgIC8vIHRoZSBvYmplY3QgaGVyZS4KICAgIHZhciBkYXRhRGVmID0ge307CiAgICBkYXRhRGVmLmdldCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2RhdGEgfTsKICAgIHZhciBwcm9wc0RlZiA9IHt9OwogICAgcHJvcHNEZWYuZ2V0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fcHJvcHMgfTsKICAgIHsKICAgICAgZGF0YURlZi5zZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdBdm9pZCByZXBsYWNpbmcgaW5zdGFuY2Ugcm9vdCAkZGF0YS4gJyArCiAgICAgICAgICAnVXNlIG5lc3RlZCBkYXRhIHByb3BlcnRpZXMgaW5zdGVhZC4nLAogICAgICAgICAgdGhpcwogICAgICAgICk7CiAgICAgIH07CiAgICAgIHByb3BzRGVmLnNldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB3YXJuKCIkcHJvcHMgaXMgcmVhZG9ubHkuIiwgdGhpcyk7CiAgICAgIH07CiAgICB9CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlLnByb3RvdHlwZSwgJyRkYXRhJywgZGF0YURlZik7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlLnByb3RvdHlwZSwgJyRwcm9wcycsIHByb3BzRGVmKTsKCiAgICBWdWUucHJvdG90eXBlLiRzZXQgPSBzZXQ7CiAgICBWdWUucHJvdG90eXBlLiRkZWxldGUgPSBkZWw7CgogICAgVnVlLnByb3RvdHlwZS4kd2F0Y2ggPSBmdW5jdGlvbiAoCiAgICAgIGV4cE9yRm4sCiAgICAgIGNiLAogICAgICBvcHRpb25zCiAgICApIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgaWYgKGlzUGxhaW5PYmplY3QoY2IpKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZVdhdGNoZXIodm0sIGV4cE9yRm4sIGNiLCBvcHRpb25zKQogICAgICB9CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICBvcHRpb25zLnVzZXIgPSB0cnVlOwogICAgICB2YXIgd2F0Y2hlciA9IG5ldyBXYXRjaGVyKHZtLCBleHBPckZuLCBjYiwgb3B0aW9ucyk7CiAgICAgIGlmIChvcHRpb25zLmltbWVkaWF0ZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjYi5jYWxsKHZtLCB3YXRjaGVyLnZhbHVlKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgaGFuZGxlRXJyb3IoZXJyb3IsIHZtLCAoImNhbGxiYWNrIGZvciBpbW1lZGlhdGUgd2F0Y2hlciBcIiIgKyAod2F0Y2hlci5leHByZXNzaW9uKSArICJcIiIpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIHVud2F0Y2hGbiAoKSB7CiAgICAgICAgd2F0Y2hlci50ZWFyZG93bigpOwogICAgICB9CiAgICB9OwogIH0KCiAgLyogICovCgogIHZhciB1aWQkMyA9IDA7CgogIGZ1bmN0aW9uIGluaXRNaXhpbiAoVnVlKSB7CiAgICBWdWUucHJvdG90eXBlLl9pbml0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgLy8gYSB1aWQKICAgICAgdm0uX3VpZCA9IHVpZCQzKys7CgogICAgICB2YXIgc3RhcnRUYWcsIGVuZFRhZzsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmIChjb25maWcucGVyZm9ybWFuY2UgJiYgbWFyaykgewogICAgICAgIHN0YXJ0VGFnID0gInZ1ZS1wZXJmLXN0YXJ0OiIgKyAodm0uX3VpZCk7CiAgICAgICAgZW5kVGFnID0gInZ1ZS1wZXJmLWVuZDoiICsgKHZtLl91aWQpOwogICAgICAgIG1hcmsoc3RhcnRUYWcpOwogICAgICB9CgogICAgICAvLyBhIGZsYWcgdG8gYXZvaWQgdGhpcyBiZWluZyBvYnNlcnZlZAogICAgICB2bS5faXNWdWUgPSB0cnVlOwogICAgICAvLyBtZXJnZSBvcHRpb25zCiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuX2lzQ29tcG9uZW50KSB7CiAgICAgICAgLy8gb3B0aW1pemUgaW50ZXJuYWwgY29tcG9uZW50IGluc3RhbnRpYXRpb24KICAgICAgICAvLyBzaW5jZSBkeW5hbWljIG9wdGlvbnMgbWVyZ2luZyBpcyBwcmV0dHkgc2xvdywgYW5kIG5vbmUgb2YgdGhlCiAgICAgICAgLy8gaW50ZXJuYWwgY29tcG9uZW50IG9wdGlvbnMgbmVlZHMgc3BlY2lhbCB0cmVhdG1lbnQuCiAgICAgICAgaW5pdEludGVybmFsQ29tcG9uZW50KHZtLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bS4kb3B0aW9ucyA9IG1lcmdlT3B0aW9ucygKICAgICAgICAgIHJlc29sdmVDb25zdHJ1Y3Rvck9wdGlvbnModm0uY29uc3RydWN0b3IpLAogICAgICAgICAgb3B0aW9ucyB8fCB7fSwKICAgICAgICAgIHZtCiAgICAgICAgKTsKICAgICAgfQogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgICB7CiAgICAgICAgaW5pdFByb3h5KHZtKTsKICAgICAgfQogICAgICAvLyBleHBvc2UgcmVhbCBzZWxmCiAgICAgIHZtLl9zZWxmID0gdm07CiAgICAgIGluaXRMaWZlY3ljbGUodm0pOwogICAgICBpbml0RXZlbnRzKHZtKTsKICAgICAgaW5pdFJlbmRlcih2bSk7CiAgICAgIGNhbGxIb29rKHZtLCAnYmVmb3JlQ3JlYXRlJyk7CiAgICAgIGluaXRJbmplY3Rpb25zKHZtKTsgLy8gcmVzb2x2ZSBpbmplY3Rpb25zIGJlZm9yZSBkYXRhL3Byb3BzCiAgICAgIGluaXRTdGF0ZSh2bSk7CiAgICAgIGluaXRQcm92aWRlKHZtKTsgLy8gcmVzb2x2ZSBwcm92aWRlIGFmdGVyIGRhdGEvcHJvcHMKICAgICAgY2FsbEhvb2sodm0sICdjcmVhdGVkJyk7CgogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKGNvbmZpZy5wZXJmb3JtYW5jZSAmJiBtYXJrKSB7CiAgICAgICAgdm0uX25hbWUgPSBmb3JtYXRDb21wb25lbnROYW1lKHZtLCBmYWxzZSk7CiAgICAgICAgbWFyayhlbmRUYWcpOwogICAgICAgIG1lYXN1cmUoKCJ2dWUgIiArICh2bS5fbmFtZSkgKyAiIGluaXQiKSwgc3RhcnRUYWcsIGVuZFRhZyk7CiAgICAgIH0KCiAgICAgIGlmICh2bS4kb3B0aW9ucy5lbCkgewogICAgICAgIHZtLiRtb3VudCh2bS4kb3B0aW9ucy5lbCk7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBpbml0SW50ZXJuYWxDb21wb25lbnQgKHZtLCBvcHRpb25zKSB7CiAgICB2YXIgb3B0cyA9IHZtLiRvcHRpb25zID0gT2JqZWN0LmNyZWF0ZSh2bS5jb25zdHJ1Y3Rvci5vcHRpb25zKTsKICAgIC8vIGRvaW5nIHRoaXMgYmVjYXVzZSBpdCdzIGZhc3RlciB0aGFuIGR5bmFtaWMgZW51bWVyYXRpb24uCiAgICB2YXIgcGFyZW50Vm5vZGUgPSBvcHRpb25zLl9wYXJlbnRWbm9kZTsKICAgIG9wdHMucGFyZW50ID0gb3B0aW9ucy5wYXJlbnQ7CiAgICBvcHRzLl9wYXJlbnRWbm9kZSA9IHBhcmVudFZub2RlOwoKICAgIHZhciB2bm9kZUNvbXBvbmVudE9wdGlvbnMgPSBwYXJlbnRWbm9kZS5jb21wb25lbnRPcHRpb25zOwogICAgb3B0cy5wcm9wc0RhdGEgPSB2bm9kZUNvbXBvbmVudE9wdGlvbnMucHJvcHNEYXRhOwogICAgb3B0cy5fcGFyZW50TGlzdGVuZXJzID0gdm5vZGVDb21wb25lbnRPcHRpb25zLmxpc3RlbmVyczsKICAgIG9wdHMuX3JlbmRlckNoaWxkcmVuID0gdm5vZGVDb21wb25lbnRPcHRpb25zLmNoaWxkcmVuOwogICAgb3B0cy5fY29tcG9uZW50VGFnID0gdm5vZGVDb21wb25lbnRPcHRpb25zLnRhZzsKCiAgICBpZiAob3B0aW9ucy5yZW5kZXIpIHsKICAgICAgb3B0cy5yZW5kZXIgPSBvcHRpb25zLnJlbmRlcjsKICAgICAgb3B0cy5zdGF0aWNSZW5kZXJGbnMgPSBvcHRpb25zLnN0YXRpY1JlbmRlckZuczsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlc29sdmVDb25zdHJ1Y3Rvck9wdGlvbnMgKEN0b3IpIHsKICAgIHZhciBvcHRpb25zID0gQ3Rvci5vcHRpb25zOwogICAgaWYgKEN0b3Iuc3VwZXIpIHsKICAgICAgdmFyIHN1cGVyT3B0aW9ucyA9IHJlc29sdmVDb25zdHJ1Y3Rvck9wdGlvbnMoQ3Rvci5zdXBlcik7CiAgICAgIHZhciBjYWNoZWRTdXBlck9wdGlvbnMgPSBDdG9yLnN1cGVyT3B0aW9uczsKICAgICAgaWYgKHN1cGVyT3B0aW9ucyAhPT0gY2FjaGVkU3VwZXJPcHRpb25zKSB7CiAgICAgICAgLy8gc3VwZXIgb3B0aW9uIGNoYW5nZWQsCiAgICAgICAgLy8gbmVlZCB0byByZXNvbHZlIG5ldyBvcHRpb25zLgogICAgICAgIEN0b3Iuc3VwZXJPcHRpb25zID0gc3VwZXJPcHRpb25zOwogICAgICAgIC8vIGNoZWNrIGlmIHRoZXJlIGFyZSBhbnkgbGF0ZS1tb2RpZmllZC9hdHRhY2hlZCBvcHRpb25zICgjNDk3NikKICAgICAgICB2YXIgbW9kaWZpZWRPcHRpb25zID0gcmVzb2x2ZU1vZGlmaWVkT3B0aW9ucyhDdG9yKTsKICAgICAgICAvLyB1cGRhdGUgYmFzZSBleHRlbmQgb3B0aW9ucwogICAgICAgIGlmIChtb2RpZmllZE9wdGlvbnMpIHsKICAgICAgICAgIGV4dGVuZChDdG9yLmV4dGVuZE9wdGlvbnMsIG1vZGlmaWVkT3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIG9wdGlvbnMgPSBDdG9yLm9wdGlvbnMgPSBtZXJnZU9wdGlvbnMoc3VwZXJPcHRpb25zLCBDdG9yLmV4dGVuZE9wdGlvbnMpOwogICAgICAgIGlmIChvcHRpb25zLm5hbWUpIHsKICAgICAgICAgIG9wdGlvbnMuY29tcG9uZW50c1tvcHRpb25zLm5hbWVdID0gQ3RvcjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvcHRpb25zCiAgfQoKICBmdW5jdGlvbiByZXNvbHZlTW9kaWZpZWRPcHRpb25zIChDdG9yKSB7CiAgICB2YXIgbW9kaWZpZWQ7CiAgICB2YXIgbGF0ZXN0ID0gQ3Rvci5vcHRpb25zOwogICAgdmFyIHNlYWxlZCA9IEN0b3Iuc2VhbGVkT3B0aW9uczsKICAgIGZvciAodmFyIGtleSBpbiBsYXRlc3QpIHsKICAgICAgaWYgKGxhdGVzdFtrZXldICE9PSBzZWFsZWRba2V5XSkgewogICAgICAgIGlmICghbW9kaWZpZWQpIHsgbW9kaWZpZWQgPSB7fTsgfQogICAgICAgIG1vZGlmaWVkW2tleV0gPSBsYXRlc3Rba2V5XTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG1vZGlmaWVkCiAgfQoKICBmdW5jdGlvbiBWdWUgKG9wdGlvbnMpIHsKICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBWdWUpCiAgICApIHsKICAgICAgd2FybignVnVlIGlzIGEgY29uc3RydWN0b3IgYW5kIHNob3VsZCBiZSBjYWxsZWQgd2l0aCB0aGUgYG5ld2Aga2V5d29yZCcpOwogICAgfQogICAgdGhpcy5faW5pdChvcHRpb25zKTsKICB9CgogIGluaXRNaXhpbihWdWUpOwogIHN0YXRlTWl4aW4oVnVlKTsKICBldmVudHNNaXhpbihWdWUpOwogIGxpZmVjeWNsZU1peGluKFZ1ZSk7CiAgcmVuZGVyTWl4aW4oVnVlKTsKCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRVc2UgKFZ1ZSkgewogICAgVnVlLnVzZSA9IGZ1bmN0aW9uIChwbHVnaW4pIHsKICAgICAgdmFyIGluc3RhbGxlZFBsdWdpbnMgPSAodGhpcy5faW5zdGFsbGVkUGx1Z2lucyB8fCAodGhpcy5faW5zdGFsbGVkUGx1Z2lucyA9IFtdKSk7CiAgICAgIGlmIChpbnN0YWxsZWRQbHVnaW5zLmluZGV4T2YocGx1Z2luKSA+IC0xKSB7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQoKICAgICAgLy8gYWRkaXRpb25hbCBwYXJhbWV0ZXJzCiAgICAgIHZhciBhcmdzID0gdG9BcnJheShhcmd1bWVudHMsIDEpOwogICAgICBhcmdzLnVuc2hpZnQodGhpcyk7CiAgICAgIGlmICh0eXBlb2YgcGx1Z2luLmluc3RhbGwgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBwbHVnaW4uaW5zdGFsbC5hcHBseShwbHVnaW4sIGFyZ3MpOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwbHVnaW4gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBwbHVnaW4uYXBwbHkobnVsbCwgYXJncyk7CiAgICAgIH0KICAgICAgaW5zdGFsbGVkUGx1Z2lucy5wdXNoKHBsdWdpbik7CiAgICAgIHJldHVybiB0aGlzCiAgICB9OwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRNaXhpbiQxIChWdWUpIHsKICAgIFZ1ZS5taXhpbiA9IGZ1bmN0aW9uIChtaXhpbikgewogICAgICB0aGlzLm9wdGlvbnMgPSBtZXJnZU9wdGlvbnModGhpcy5vcHRpb25zLCBtaXhpbik7CiAgICAgIHJldHVybiB0aGlzCiAgICB9OwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRFeHRlbmQgKFZ1ZSkgewogICAgLyoqCiAgICAgKiBFYWNoIGluc3RhbmNlIGNvbnN0cnVjdG9yLCBpbmNsdWRpbmcgVnVlLCBoYXMgYSB1bmlxdWUKICAgICAqIGNpZC4gVGhpcyBlbmFibGVzIHVzIHRvIGNyZWF0ZSB3cmFwcGVkICJjaGlsZAogICAgICogY29uc3RydWN0b3JzIiBmb3IgcHJvdG90eXBhbCBpbmhlcml0YW5jZSBhbmQgY2FjaGUgdGhlbS4KICAgICAqLwogICAgVnVlLmNpZCA9IDA7CiAgICB2YXIgY2lkID0gMTsKCiAgICAvKioKICAgICAqIENsYXNzIGluaGVyaXRhbmNlCiAgICAgKi8KICAgIFZ1ZS5leHRlbmQgPSBmdW5jdGlvbiAoZXh0ZW5kT3B0aW9ucykgewogICAgICBleHRlbmRPcHRpb25zID0gZXh0ZW5kT3B0aW9ucyB8fCB7fTsKICAgICAgdmFyIFN1cGVyID0gdGhpczsKICAgICAgdmFyIFN1cGVySWQgPSBTdXBlci5jaWQ7CiAgICAgIHZhciBjYWNoZWRDdG9ycyA9IGV4dGVuZE9wdGlvbnMuX0N0b3IgfHwgKGV4dGVuZE9wdGlvbnMuX0N0b3IgPSB7fSk7CiAgICAgIGlmIChjYWNoZWRDdG9yc1tTdXBlcklkXSkgewogICAgICAgIHJldHVybiBjYWNoZWRDdG9yc1tTdXBlcklkXQogICAgICB9CgogICAgICB2YXIgbmFtZSA9IGV4dGVuZE9wdGlvbnMubmFtZSB8fCBTdXBlci5vcHRpb25zLm5hbWU7CiAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgdmFsaWRhdGVDb21wb25lbnROYW1lKG5hbWUpOwogICAgICB9CgogICAgICB2YXIgU3ViID0gZnVuY3Rpb24gVnVlQ29tcG9uZW50IChvcHRpb25zKSB7CiAgICAgICAgdGhpcy5faW5pdChvcHRpb25zKTsKICAgICAgfTsKICAgICAgU3ViLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoU3VwZXIucHJvdG90eXBlKTsKICAgICAgU3ViLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFN1YjsKICAgICAgU3ViLmNpZCA9IGNpZCsrOwogICAgICBTdWIub3B0aW9ucyA9IG1lcmdlT3B0aW9ucygKICAgICAgICBTdXBlci5vcHRpb25zLAogICAgICAgIGV4dGVuZE9wdGlvbnMKICAgICAgKTsKICAgICAgU3ViWydzdXBlciddID0gU3VwZXI7CgogICAgICAvLyBGb3IgcHJvcHMgYW5kIGNvbXB1dGVkIHByb3BlcnRpZXMsIHdlIGRlZmluZSB0aGUgcHJveHkgZ2V0dGVycyBvbgogICAgICAvLyB0aGUgVnVlIGluc3RhbmNlcyBhdCBleHRlbnNpb24gdGltZSwgb24gdGhlIGV4dGVuZGVkIHByb3RvdHlwZS4gVGhpcwogICAgICAvLyBhdm9pZHMgT2JqZWN0LmRlZmluZVByb3BlcnR5IGNhbGxzIGZvciBlYWNoIGluc3RhbmNlIGNyZWF0ZWQuCiAgICAgIGlmIChTdWIub3B0aW9ucy5wcm9wcykgewogICAgICAgIGluaXRQcm9wcyQxKFN1Yik7CiAgICAgIH0KICAgICAgaWYgKFN1Yi5vcHRpb25zLmNvbXB1dGVkKSB7CiAgICAgICAgaW5pdENvbXB1dGVkJDEoU3ViKTsKICAgICAgfQoKICAgICAgLy8gYWxsb3cgZnVydGhlciBleHRlbnNpb24vbWl4aW4vcGx1Z2luIHVzYWdlCiAgICAgIFN1Yi5leHRlbmQgPSBTdXBlci5leHRlbmQ7CiAgICAgIFN1Yi5taXhpbiA9IFN1cGVyLm1peGluOwogICAgICBTdWIudXNlID0gU3VwZXIudXNlOwoKICAgICAgLy8gY3JlYXRlIGFzc2V0IHJlZ2lzdGVycywgc28gZXh0ZW5kZWQgY2xhc3NlcwogICAgICAvLyBjYW4gaGF2ZSB0aGVpciBwcml2YXRlIGFzc2V0cyB0b28uCiAgICAgIEFTU0VUX1RZUEVTLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICBTdWJbdHlwZV0gPSBTdXBlclt0eXBlXTsKICAgICAgfSk7CiAgICAgIC8vIGVuYWJsZSByZWN1cnNpdmUgc2VsZi1sb29rdXAKICAgICAgaWYgKG5hbWUpIHsKICAgICAgICBTdWIub3B0aW9ucy5jb21wb25lbnRzW25hbWVdID0gU3ViOwogICAgICB9CgogICAgICAvLyBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZSBzdXBlciBvcHRpb25zIGF0IGV4dGVuc2lvbiB0aW1lLgogICAgICAvLyBsYXRlciBhdCBpbnN0YW50aWF0aW9uIHdlIGNhbiBjaGVjayBpZiBTdXBlcidzIG9wdGlvbnMgaGF2ZQogICAgICAvLyBiZWVuIHVwZGF0ZWQuCiAgICAgIFN1Yi5zdXBlck9wdGlvbnMgPSBTdXBlci5vcHRpb25zOwogICAgICBTdWIuZXh0ZW5kT3B0aW9ucyA9IGV4dGVuZE9wdGlvbnM7CiAgICAgIFN1Yi5zZWFsZWRPcHRpb25zID0gZXh0ZW5kKHt9LCBTdWIub3B0aW9ucyk7CgogICAgICAvLyBjYWNoZSBjb25zdHJ1Y3RvcgogICAgICBjYWNoZWRDdG9yc1tTdXBlcklkXSA9IFN1YjsKICAgICAgcmV0dXJuIFN1YgogICAgfTsKICB9CgogIGZ1bmN0aW9uIGluaXRQcm9wcyQxIChDb21wKSB7CiAgICB2YXIgcHJvcHMgPSBDb21wLm9wdGlvbnMucHJvcHM7CiAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHMpIHsKICAgICAgcHJveHkoQ29tcC5wcm90b3R5cGUsICJfcHJvcHMiLCBrZXkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdENvbXB1dGVkJDEgKENvbXApIHsKICAgIHZhciBjb21wdXRlZCA9IENvbXAub3B0aW9ucy5jb21wdXRlZDsKICAgIGZvciAodmFyIGtleSBpbiBjb21wdXRlZCkgewogICAgICBkZWZpbmVDb21wdXRlZChDb21wLnByb3RvdHlwZSwga2V5LCBjb21wdXRlZFtrZXldKTsKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBpbml0QXNzZXRSZWdpc3RlcnMgKFZ1ZSkgewogICAgLyoqCiAgICAgKiBDcmVhdGUgYXNzZXQgcmVnaXN0cmF0aW9uIG1ldGhvZHMuCiAgICAgKi8KICAgIEFTU0VUX1RZUEVTLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgVnVlW3R5cGVdID0gZnVuY3Rpb24gKAogICAgICAgIGlkLAogICAgICAgIGRlZmluaXRpb24KICAgICAgKSB7CiAgICAgICAgaWYgKCFkZWZpbml0aW9uKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zW3R5cGUgKyAncyddW2lkXQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICAgIGlmICh0eXBlID09PSAnY29tcG9uZW50JykgewogICAgICAgICAgICB2YWxpZGF0ZUNvbXBvbmVudE5hbWUoaWQpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGUgPT09ICdjb21wb25lbnQnICYmIGlzUGxhaW5PYmplY3QoZGVmaW5pdGlvbikpIHsKICAgICAgICAgICAgZGVmaW5pdGlvbi5uYW1lID0gZGVmaW5pdGlvbi5uYW1lIHx8IGlkOwogICAgICAgICAgICBkZWZpbml0aW9uID0gdGhpcy5vcHRpb25zLl9iYXNlLmV4dGVuZChkZWZpbml0aW9uKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlID09PSAnZGlyZWN0aXZlJyAmJiB0eXBlb2YgZGVmaW5pdGlvbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBkZWZpbml0aW9uID0geyBiaW5kOiBkZWZpbml0aW9uLCB1cGRhdGU6IGRlZmluaXRpb24gfTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMub3B0aW9uc1t0eXBlICsgJ3MnXVtpZF0gPSBkZWZpbml0aW9uOwogICAgICAgICAgcmV0dXJuIGRlZmluaXRpb24KICAgICAgICB9CiAgICAgIH07CiAgICB9KTsKICB9CgogIC8qICAqLwoKCgogIGZ1bmN0aW9uIGdldENvbXBvbmVudE5hbWUgKG9wdHMpIHsKICAgIHJldHVybiBvcHRzICYmIChvcHRzLkN0b3Iub3B0aW9ucy5uYW1lIHx8IG9wdHMudGFnKQogIH0KCiAgZnVuY3Rpb24gbWF0Y2hlcyAocGF0dGVybiwgbmFtZSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkocGF0dGVybikpIHsKICAgICAgcmV0dXJuIHBhdHRlcm4uaW5kZXhPZihuYW1lKSA+IC0xCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXR0ZXJuID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gcGF0dGVybi5zcGxpdCgnLCcpLmluZGV4T2YobmFtZSkgPiAtMQogICAgfSBlbHNlIGlmIChpc1JlZ0V4cChwYXR0ZXJuKSkgewogICAgICByZXR1cm4gcGF0dGVybi50ZXN0KG5hbWUpCiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgcmV0dXJuIGZhbHNlCiAgfQoKICBmdW5jdGlvbiBwcnVuZUNhY2hlIChrZWVwQWxpdmVJbnN0YW5jZSwgZmlsdGVyKSB7CiAgICB2YXIgY2FjaGUgPSBrZWVwQWxpdmVJbnN0YW5jZS5jYWNoZTsKICAgIHZhciBrZXlzID0ga2VlcEFsaXZlSW5zdGFuY2Uua2V5czsKICAgIHZhciBfdm5vZGUgPSBrZWVwQWxpdmVJbnN0YW5jZS5fdm5vZGU7CiAgICBmb3IgKHZhciBrZXkgaW4gY2FjaGUpIHsKICAgICAgdmFyIGNhY2hlZE5vZGUgPSBjYWNoZVtrZXldOwogICAgICBpZiAoY2FjaGVkTm9kZSkgewogICAgICAgIHZhciBuYW1lID0gZ2V0Q29tcG9uZW50TmFtZShjYWNoZWROb2RlLmNvbXBvbmVudE9wdGlvbnMpOwogICAgICAgIGlmIChuYW1lICYmICFmaWx0ZXIobmFtZSkpIHsKICAgICAgICAgIHBydW5lQ2FjaGVFbnRyeShjYWNoZSwga2V5LCBrZXlzLCBfdm5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJ1bmVDYWNoZUVudHJ5ICgKICAgIGNhY2hlLAogICAga2V5LAogICAga2V5cywKICAgIGN1cnJlbnQKICApIHsKICAgIHZhciBjYWNoZWQkJDEgPSBjYWNoZVtrZXldOwogICAgaWYgKGNhY2hlZCQkMSAmJiAoIWN1cnJlbnQgfHwgY2FjaGVkJCQxLnRhZyAhPT0gY3VycmVudC50YWcpKSB7CiAgICAgIGNhY2hlZCQkMS5jb21wb25lbnRJbnN0YW5jZS4kZGVzdHJveSgpOwogICAgfQogICAgY2FjaGVba2V5XSA9IG51bGw7CiAgICByZW1vdmUoa2V5cywga2V5KTsKICB9CgogIHZhciBwYXR0ZXJuVHlwZXMgPSBbU3RyaW5nLCBSZWdFeHAsIEFycmF5XTsKCiAgdmFyIEtlZXBBbGl2ZSA9IHsKICAgIG5hbWU6ICdrZWVwLWFsaXZlJywKICAgIGFic3RyYWN0OiB0cnVlLAoKICAgIHByb3BzOiB7CiAgICAgIGluY2x1ZGU6IHBhdHRlcm5UeXBlcywKICAgICAgZXhjbHVkZTogcGF0dGVyblR5cGVzLAogICAgICBtYXg6IFtTdHJpbmcsIE51bWJlcl0KICAgIH0sCgogICAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCAoKSB7CiAgICAgIHRoaXMuY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB0aGlzLmtleXMgPSBbXTsKICAgIH0sCgogICAgZGVzdHJveWVkOiBmdW5jdGlvbiBkZXN0cm95ZWQgKCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5jYWNoZSkgewogICAgICAgIHBydW5lQ2FjaGVFbnRyeSh0aGlzLmNhY2hlLCBrZXksIHRoaXMua2V5cyk7CiAgICAgIH0KICAgIH0sCgogICAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCAoKSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwoKICAgICAgdGhpcy4kd2F0Y2goJ2luY2x1ZGUnLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcHJ1bmVDYWNoZSh0aGlzJDEsIGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiBtYXRjaGVzKHZhbCwgbmFtZSk7IH0pOwogICAgICB9KTsKICAgICAgdGhpcy4kd2F0Y2goJ2V4Y2x1ZGUnLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgcHJ1bmVDYWNoZSh0aGlzJDEsIGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiAhbWF0Y2hlcyh2YWwsIG5hbWUpOyB9KTsKICAgICAgfSk7CiAgICB9LAoKICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyICgpIHsKICAgICAgdmFyIHNsb3QgPSB0aGlzLiRzbG90cy5kZWZhdWx0OwogICAgICB2YXIgdm5vZGUgPSBnZXRGaXJzdENvbXBvbmVudENoaWxkKHNsb3QpOwogICAgICB2YXIgY29tcG9uZW50T3B0aW9ucyA9IHZub2RlICYmIHZub2RlLmNvbXBvbmVudE9wdGlvbnM7CiAgICAgIGlmIChjb21wb25lbnRPcHRpb25zKSB7CiAgICAgICAgLy8gY2hlY2sgcGF0dGVybgogICAgICAgIHZhciBuYW1lID0gZ2V0Q29tcG9uZW50TmFtZShjb21wb25lbnRPcHRpb25zKTsKICAgICAgICB2YXIgcmVmID0gdGhpczsKICAgICAgICB2YXIgaW5jbHVkZSA9IHJlZi5pbmNsdWRlOwogICAgICAgIHZhciBleGNsdWRlID0gcmVmLmV4Y2x1ZGU7CiAgICAgICAgaWYgKAogICAgICAgICAgLy8gbm90IGluY2x1ZGVkCiAgICAgICAgICAoaW5jbHVkZSAmJiAoIW5hbWUgfHwgIW1hdGNoZXMoaW5jbHVkZSwgbmFtZSkpKSB8fAogICAgICAgICAgLy8gZXhjbHVkZWQKICAgICAgICAgIChleGNsdWRlICYmIG5hbWUgJiYgbWF0Y2hlcyhleGNsdWRlLCBuYW1lKSkKICAgICAgICApIHsKICAgICAgICAgIHJldHVybiB2bm9kZQogICAgICAgIH0KCiAgICAgICAgdmFyIHJlZiQxID0gdGhpczsKICAgICAgICB2YXIgY2FjaGUgPSByZWYkMS5jYWNoZTsKICAgICAgICB2YXIga2V5cyA9IHJlZiQxLmtleXM7CiAgICAgICAgdmFyIGtleSA9IHZub2RlLmtleSA9PSBudWxsCiAgICAgICAgICAvLyBzYW1lIGNvbnN0cnVjdG9yIG1heSBnZXQgcmVnaXN0ZXJlZCBhcyBkaWZmZXJlbnQgbG9jYWwgY29tcG9uZW50cwogICAgICAgICAgLy8gc28gY2lkIGFsb25lIGlzIG5vdCBlbm91Z2ggKCMzMjY5KQogICAgICAgICAgPyBjb21wb25lbnRPcHRpb25zLkN0b3IuY2lkICsgKGNvbXBvbmVudE9wdGlvbnMudGFnID8gKCI6OiIgKyAoY29tcG9uZW50T3B0aW9ucy50YWcpKSA6ICcnKQogICAgICAgICAgOiB2bm9kZS5rZXk7CiAgICAgICAgaWYgKGNhY2hlW2tleV0pIHsKICAgICAgICAgIHZub2RlLmNvbXBvbmVudEluc3RhbmNlID0gY2FjaGVba2V5XS5jb21wb25lbnRJbnN0YW5jZTsKICAgICAgICAgIC8vIG1ha2UgY3VycmVudCBrZXkgZnJlc2hlc3QKICAgICAgICAgIHJlbW92ZShrZXlzLCBrZXkpOwogICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNhY2hlW2tleV0gPSB2bm9kZTsKICAgICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgICAgLy8gcHJ1bmUgb2xkZXN0IGVudHJ5CiAgICAgICAgICBpZiAodGhpcy5tYXggJiYga2V5cy5sZW5ndGggPiBwYXJzZUludCh0aGlzLm1heCkpIHsKICAgICAgICAgICAgcHJ1bmVDYWNoZUVudHJ5KGNhY2hlLCBrZXlzWzBdLCBrZXlzLCB0aGlzLl92bm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2bm9kZS5kYXRhLmtlZXBBbGl2ZSA9IHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIHZub2RlIHx8IChzbG90ICYmIHNsb3RbMF0pCiAgICB9CiAgfTsKCiAgdmFyIGJ1aWx0SW5Db21wb25lbnRzID0gewogICAgS2VlcEFsaXZlOiBLZWVwQWxpdmUKICB9OwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdEdsb2JhbEFQSSAoVnVlKSB7CiAgICAvLyBjb25maWcKICAgIHZhciBjb25maWdEZWYgPSB7fTsKICAgIGNvbmZpZ0RlZi5nZXQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBjb25maWc7IH07CiAgICB7CiAgICAgIGNvbmZpZ0RlZi5zZXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdEbyBub3QgcmVwbGFjZSB0aGUgVnVlLmNvbmZpZyBvYmplY3QsIHNldCBpbmRpdmlkdWFsIGZpZWxkcyBpbnN0ZWFkLicKICAgICAgICApOwogICAgICB9OwogICAgfQogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZSwgJ2NvbmZpZycsIGNvbmZpZ0RlZik7CgogICAgLy8gZXhwb3NlZCB1dGlsIG1ldGhvZHMuCiAgICAvLyBOT1RFOiB0aGVzZSBhcmUgbm90IGNvbnNpZGVyZWQgcGFydCBvZiB0aGUgcHVibGljIEFQSSAtIGF2b2lkIHJlbHlpbmcgb24KICAgIC8vIHRoZW0gdW5sZXNzIHlvdSBhcmUgYXdhcmUgb2YgdGhlIHJpc2suCiAgICBWdWUudXRpbCA9IHsKICAgICAgd2Fybjogd2FybiwKICAgICAgZXh0ZW5kOiBleHRlbmQsCiAgICAgIG1lcmdlT3B0aW9uczogbWVyZ2VPcHRpb25zLAogICAgICBkZWZpbmVSZWFjdGl2ZTogZGVmaW5lUmVhY3RpdmUkJDEKICAgIH07CgogICAgVnVlLnNldCA9IHNldDsKICAgIFZ1ZS5kZWxldGUgPSBkZWw7CiAgICBWdWUubmV4dFRpY2sgPSBuZXh0VGljazsKCiAgICAvLyAyLjYgZXhwbGljaXQgb2JzZXJ2YWJsZSBBUEkKICAgIFZ1ZS5vYnNlcnZhYmxlID0gZnVuY3Rpb24gKG9iaikgewogICAgICBvYnNlcnZlKG9iaik7CiAgICAgIHJldHVybiBvYmoKICAgIH07CgogICAgVnVlLm9wdGlvbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgQVNTRVRfVFlQRVMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgICBWdWUub3B0aW9uc1t0eXBlICsgJ3MnXSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB9KTsKCiAgICAvLyB0aGlzIGlzIHVzZWQgdG8gaWRlbnRpZnkgdGhlICJiYXNlIiBjb25zdHJ1Y3RvciB0byBleHRlbmQgYWxsIHBsYWluLW9iamVjdAogICAgLy8gY29tcG9uZW50cyB3aXRoIGluIFdlZXgncyBtdWx0aS1pbnN0YW5jZSBzY2VuYXJpb3MuCiAgICBWdWUub3B0aW9ucy5fYmFzZSA9IFZ1ZTsKCiAgICBleHRlbmQoVnVlLm9wdGlvbnMuY29tcG9uZW50cywgYnVpbHRJbkNvbXBvbmVudHMpOwoKICAgIGluaXRVc2UoVnVlKTsKICAgIGluaXRNaXhpbiQxKFZ1ZSk7CiAgICBpbml0RXh0ZW5kKFZ1ZSk7CiAgICBpbml0QXNzZXRSZWdpc3RlcnMoVnVlKTsKICB9CgogIGluaXRHbG9iYWxBUEkoVnVlKTsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckaXNTZXJ2ZXInLCB7CiAgICBnZXQ6IGlzU2VydmVyUmVuZGVyaW5nCiAgfSk7CgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUucHJvdG90eXBlLCAnJHNzckNvbnRleHQnLCB7CiAgICBnZXQ6IGZ1bmN0aW9uIGdldCAoKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgIHJldHVybiB0aGlzLiR2bm9kZSAmJiB0aGlzLiR2bm9kZS5zc3JDb250ZXh0CiAgICB9CiAgfSk7CgogIC8vIGV4cG9zZSBGdW5jdGlvbmFsUmVuZGVyQ29udGV4dCBmb3Igc3NyIHJ1bnRpbWUgaGVscGVyIGluc3RhbGxhdGlvbgogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUsICdGdW5jdGlvbmFsUmVuZGVyQ29udGV4dCcsIHsKICAgIHZhbHVlOiBGdW5jdGlvbmFsUmVuZGVyQ29udGV4dAogIH0pOwoKICBWdWUudmVyc2lvbiA9ICcyLjYuMTInOwoKICAvKiAgKi8KCiAgLy8gdGhlc2UgYXJlIHJlc2VydmVkIGZvciB3ZWIgYmVjYXVzZSB0aGV5IGFyZSBkaXJlY3RseSBjb21waWxlZCBhd2F5CiAgLy8gZHVyaW5nIHRlbXBsYXRlIGNvbXBpbGF0aW9uCiAgdmFyIGlzUmVzZXJ2ZWRBdHRyID0gbWFrZU1hcCgnc3R5bGUsY2xhc3MnKTsKCiAgLy8gYXR0cmlidXRlcyB0aGF0IHNob3VsZCBiZSB1c2luZyBwcm9wcyBmb3IgYmluZGluZwogIHZhciBhY2NlcHRWYWx1ZSA9IG1ha2VNYXAoJ2lucHV0LHRleHRhcmVhLG9wdGlvbixzZWxlY3QscHJvZ3Jlc3MnKTsKICB2YXIgbXVzdFVzZVByb3AgPSBmdW5jdGlvbiAodGFnLCB0eXBlLCBhdHRyKSB7CiAgICByZXR1cm4gKAogICAgICAoYXR0ciA9PT0gJ3ZhbHVlJyAmJiBhY2NlcHRWYWx1ZSh0YWcpKSAmJiB0eXBlICE9PSAnYnV0dG9uJyB8fAogICAgICAoYXR0ciA9PT0gJ3NlbGVjdGVkJyAmJiB0YWcgPT09ICdvcHRpb24nKSB8fAogICAgICAoYXR0ciA9PT0gJ2NoZWNrZWQnICYmIHRhZyA9PT0gJ2lucHV0JykgfHwKICAgICAgKGF0dHIgPT09ICdtdXRlZCcgJiYgdGFnID09PSAndmlkZW8nKQogICAgKQogIH07CgogIHZhciBpc0VudW1lcmF0ZWRBdHRyID0gbWFrZU1hcCgnY29udGVudGVkaXRhYmxlLGRyYWdnYWJsZSxzcGVsbGNoZWNrJyk7CgogIHZhciBpc1ZhbGlkQ29udGVudEVkaXRhYmxlVmFsdWUgPSBtYWtlTWFwKCdldmVudHMsY2FyZXQsdHlwaW5nLHBsYWludGV4dC1vbmx5Jyk7CgogIHZhciBjb252ZXJ0RW51bWVyYXRlZFZhbHVlID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgIHJldHVybiBpc0ZhbHN5QXR0clZhbHVlKHZhbHVlKSB8fCB2YWx1ZSA9PT0gJ2ZhbHNlJwogICAgICA/ICdmYWxzZScKICAgICAgLy8gYWxsb3cgYXJiaXRyYXJ5IHN0cmluZyB2YWx1ZSBmb3IgY29udGVudGVkaXRhYmxlCiAgICAgIDoga2V5ID09PSAnY29udGVudGVkaXRhYmxlJyAmJiBpc1ZhbGlkQ29udGVudEVkaXRhYmxlVmFsdWUodmFsdWUpCiAgICAgICAgPyB2YWx1ZQogICAgICAgIDogJ3RydWUnCiAgfTsKCiAgdmFyIGlzQm9vbGVhbkF0dHIgPSBtYWtlTWFwKAogICAgJ2FsbG93ZnVsbHNjcmVlbixhc3luYyxhdXRvZm9jdXMsYXV0b3BsYXksY2hlY2tlZCxjb21wYWN0LGNvbnRyb2xzLGRlY2xhcmUsJyArCiAgICAnZGVmYXVsdCxkZWZhdWx0Y2hlY2tlZCxkZWZhdWx0bXV0ZWQsZGVmYXVsdHNlbGVjdGVkLGRlZmVyLGRpc2FibGVkLCcgKwogICAgJ2VuYWJsZWQsZm9ybW5vdmFsaWRhdGUsaGlkZGVuLGluZGV0ZXJtaW5hdGUsaW5lcnQsaXNtYXAsaXRlbXNjb3BlLGxvb3AsbXVsdGlwbGUsJyArCiAgICAnbXV0ZWQsbm9ocmVmLG5vcmVzaXplLG5vc2hhZGUsbm92YWxpZGF0ZSxub3dyYXAsb3BlbixwYXVzZW9uZXhpdCxyZWFkb25seSwnICsKICAgICdyZXF1aXJlZCxyZXZlcnNlZCxzY29wZWQsc2VhbWxlc3Msc2VsZWN0ZWQsc29ydGFibGUsdHJhbnNsYXRlLCcgKwogICAgJ3RydWVzcGVlZCx0eXBlbXVzdG1hdGNoLHZpc2libGUnCiAgKTsKCiAgdmFyIHhsaW5rTlMgPSAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayc7CgogIHZhciBpc1hsaW5rID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgIHJldHVybiBuYW1lLmNoYXJBdCg1KSA9PT0gJzonICYmIG5hbWUuc2xpY2UoMCwgNSkgPT09ICd4bGluaycKICB9OwoKICB2YXIgZ2V0WGxpbmtQcm9wID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgIHJldHVybiBpc1hsaW5rKG5hbWUpID8gbmFtZS5zbGljZSg2LCBuYW1lLmxlbmd0aCkgOiAnJwogIH07CgogIHZhciBpc0ZhbHN5QXR0clZhbHVlID0gZnVuY3Rpb24gKHZhbCkgewogICAgcmV0dXJuIHZhbCA9PSBudWxsIHx8IHZhbCA9PT0gZmFsc2UKICB9OwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gZ2VuQ2xhc3NGb3JWbm9kZSAodm5vZGUpIHsKICAgIHZhciBkYXRhID0gdm5vZGUuZGF0YTsKICAgIHZhciBwYXJlbnROb2RlID0gdm5vZGU7CiAgICB2YXIgY2hpbGROb2RlID0gdm5vZGU7CiAgICB3aGlsZSAoaXNEZWYoY2hpbGROb2RlLmNvbXBvbmVudEluc3RhbmNlKSkgewogICAgICBjaGlsZE5vZGUgPSBjaGlsZE5vZGUuY29tcG9uZW50SW5zdGFuY2UuX3Zub2RlOwogICAgICBpZiAoY2hpbGROb2RlICYmIGNoaWxkTm9kZS5kYXRhKSB7CiAgICAgICAgZGF0YSA9IG1lcmdlQ2xhc3NEYXRhKGNoaWxkTm9kZS5kYXRhLCBkYXRhKTsKICAgICAgfQogICAgfQogICAgd2hpbGUgKGlzRGVmKHBhcmVudE5vZGUgPSBwYXJlbnROb2RlLnBhcmVudCkpIHsKICAgICAgaWYgKHBhcmVudE5vZGUgJiYgcGFyZW50Tm9kZS5kYXRhKSB7CiAgICAgICAgZGF0YSA9IG1lcmdlQ2xhc3NEYXRhKGRhdGEsIHBhcmVudE5vZGUuZGF0YSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZW5kZXJDbGFzcyhkYXRhLnN0YXRpY0NsYXNzLCBkYXRhLmNsYXNzKQogIH0KCiAgZnVuY3Rpb24gbWVyZ2VDbGFzc0RhdGEgKGNoaWxkLCBwYXJlbnQpIHsKICAgIHJldHVybiB7CiAgICAgIHN0YXRpY0NsYXNzOiBjb25jYXQoY2hpbGQuc3RhdGljQ2xhc3MsIHBhcmVudC5zdGF0aWNDbGFzcyksCiAgICAgIGNsYXNzOiBpc0RlZihjaGlsZC5jbGFzcykKICAgICAgICA/IFtjaGlsZC5jbGFzcywgcGFyZW50LmNsYXNzXQogICAgICAgIDogcGFyZW50LmNsYXNzCiAgICB9CiAgfQoKICBmdW5jdGlvbiByZW5kZXJDbGFzcyAoCiAgICBzdGF0aWNDbGFzcywKICAgIGR5bmFtaWNDbGFzcwogICkgewogICAgaWYgKGlzRGVmKHN0YXRpY0NsYXNzKSB8fCBpc0RlZihkeW5hbWljQ2xhc3MpKSB7CiAgICAgIHJldHVybiBjb25jYXQoc3RhdGljQ2xhc3MsIHN0cmluZ2lmeUNsYXNzKGR5bmFtaWNDbGFzcykpCiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgcmV0dXJuICcnCiAgfQoKICBmdW5jdGlvbiBjb25jYXQgKGEsIGIpIHsKICAgIHJldHVybiBhID8gYiA/IChhICsgJyAnICsgYikgOiBhIDogKGIgfHwgJycpCiAgfQoKICBmdW5jdGlvbiBzdHJpbmdpZnlDbGFzcyAodmFsdWUpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gc3RyaW5naWZ5QXJyYXkodmFsdWUpCiAgICB9CiAgICBpZiAoaXNPYmplY3QodmFsdWUpKSB7CiAgICAgIHJldHVybiBzdHJpbmdpZnlPYmplY3QodmFsdWUpCiAgICB9CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gdmFsdWUKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICByZXR1cm4gJycKICB9CgogIGZ1bmN0aW9uIHN0cmluZ2lmeUFycmF5ICh2YWx1ZSkgewogICAgdmFyIHJlcyA9ICcnOwogICAgdmFyIHN0cmluZ2lmaWVkOwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2YWx1ZS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgaWYgKGlzRGVmKHN0cmluZ2lmaWVkID0gc3RyaW5naWZ5Q2xhc3ModmFsdWVbaV0pKSAmJiBzdHJpbmdpZmllZCAhPT0gJycpIHsKICAgICAgICBpZiAocmVzKSB7IHJlcyArPSAnICc7IH0KICAgICAgICByZXMgKz0gc3RyaW5naWZpZWQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIGZ1bmN0aW9uIHN0cmluZ2lmeU9iamVjdCAodmFsdWUpIHsKICAgIHZhciByZXMgPSAnJzsKICAgIGZvciAodmFyIGtleSBpbiB2YWx1ZSkgewogICAgICBpZiAodmFsdWVba2V5XSkgewogICAgICAgIGlmIChyZXMpIHsgcmVzICs9ICcgJzsgfQogICAgICAgIHJlcyArPSBrZXk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIC8qICAqLwoKICB2YXIgbmFtZXNwYWNlTWFwID0gewogICAgc3ZnOiAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLAogICAgbWF0aDogJ2h0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwnCiAgfTsKCiAgdmFyIGlzSFRNTFRhZyA9IG1ha2VNYXAoCiAgICAnaHRtbCxib2R5LGJhc2UsaGVhZCxsaW5rLG1ldGEsc3R5bGUsdGl0bGUsJyArCiAgICAnYWRkcmVzcyxhcnRpY2xlLGFzaWRlLGZvb3RlcixoZWFkZXIsaDEsaDIsaDMsaDQsaDUsaDYsaGdyb3VwLG5hdixzZWN0aW9uLCcgKwogICAgJ2RpdixkZCxkbCxkdCxmaWdjYXB0aW9uLGZpZ3VyZSxwaWN0dXJlLGhyLGltZyxsaSxtYWluLG9sLHAscHJlLHVsLCcgKwogICAgJ2EsYixhYmJyLGJkaSxiZG8sYnIsY2l0ZSxjb2RlLGRhdGEsZGZuLGVtLGksa2JkLG1hcmsscSxycCxydCxydGMscnVieSwnICsKICAgICdzLHNhbXAsc21hbGwsc3BhbixzdHJvbmcsc3ViLHN1cCx0aW1lLHUsdmFyLHdicixhcmVhLGF1ZGlvLG1hcCx0cmFjayx2aWRlbywnICsKICAgICdlbWJlZCxvYmplY3QscGFyYW0sc291cmNlLGNhbnZhcyxzY3JpcHQsbm9zY3JpcHQsZGVsLGlucywnICsKICAgICdjYXB0aW9uLGNvbCxjb2xncm91cCx0YWJsZSx0aGVhZCx0Ym9keSx0ZCx0aCx0ciwnICsKICAgICdidXR0b24sZGF0YWxpc3QsZmllbGRzZXQsZm9ybSxpbnB1dCxsYWJlbCxsZWdlbmQsbWV0ZXIsb3B0Z3JvdXAsb3B0aW9uLCcgKwogICAgJ291dHB1dCxwcm9ncmVzcyxzZWxlY3QsdGV4dGFyZWEsJyArCiAgICAnZGV0YWlscyxkaWFsb2csbWVudSxtZW51aXRlbSxzdW1tYXJ5LCcgKwogICAgJ2NvbnRlbnQsZWxlbWVudCxzaGFkb3csdGVtcGxhdGUsYmxvY2txdW90ZSxpZnJhbWUsdGZvb3QnCiAgKTsKCiAgLy8gdGhpcyBtYXAgaXMgaW50ZW50aW9uYWxseSBzZWxlY3RpdmUsIG9ubHkgY292ZXJpbmcgU1ZHIGVsZW1lbnRzIHRoYXQgbWF5CiAgLy8gY29udGFpbiBjaGlsZCBlbGVtZW50cy4KICB2YXIgaXNTVkcgPSBtYWtlTWFwKAogICAgJ3N2ZyxhbmltYXRlLGNpcmNsZSxjbGlwcGF0aCxjdXJzb3IsZGVmcyxkZXNjLGVsbGlwc2UsZmlsdGVyLGZvbnQtZmFjZSwnICsKICAgICdmb3JlaWduT2JqZWN0LGcsZ2x5cGgsaW1hZ2UsbGluZSxtYXJrZXIsbWFzayxtaXNzaW5nLWdseXBoLHBhdGgscGF0dGVybiwnICsKICAgICdwb2x5Z29uLHBvbHlsaW5lLHJlY3Qsc3dpdGNoLHN5bWJvbCx0ZXh0LHRleHRwYXRoLHRzcGFuLHVzZSx2aWV3JywKICAgIHRydWUKICApOwoKICB2YXIgaXNQcmVUYWcgPSBmdW5jdGlvbiAodGFnKSB7IHJldHVybiB0YWcgPT09ICdwcmUnOyB9OwoKICB2YXIgaXNSZXNlcnZlZFRhZyA9IGZ1bmN0aW9uICh0YWcpIHsKICAgIHJldHVybiBpc0hUTUxUYWcodGFnKSB8fCBpc1NWRyh0YWcpCiAgfTsKCiAgZnVuY3Rpb24gZ2V0VGFnTmFtZXNwYWNlICh0YWcpIHsKICAgIGlmIChpc1NWRyh0YWcpKSB7CiAgICAgIHJldHVybiAnc3ZnJwogICAgfQogICAgLy8gYmFzaWMgc3VwcG9ydCBmb3IgTWF0aE1MCiAgICAvLyBub3RlIGl0IGRvZXNuJ3Qgc3VwcG9ydCBvdGhlciBNYXRoTUwgZWxlbWVudHMgYmVpbmcgY29tcG9uZW50IHJvb3RzCiAgICBpZiAodGFnID09PSAnbWF0aCcpIHsKICAgICAgcmV0dXJuICdtYXRoJwogICAgfQogIH0KCiAgdmFyIHVua25vd25FbGVtZW50Q2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGZ1bmN0aW9uIGlzVW5rbm93bkVsZW1lbnQgKHRhZykgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoIWluQnJvd3NlcikgewogICAgICByZXR1cm4gdHJ1ZQogICAgfQogICAgaWYgKGlzUmVzZXJ2ZWRUYWcodGFnKSkgewogICAgICByZXR1cm4gZmFsc2UKICAgIH0KICAgIHRhZyA9IHRhZy50b0xvd2VyQ2FzZSgpOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAodW5rbm93bkVsZW1lbnRDYWNoZVt0YWddICE9IG51bGwpIHsKICAgICAgcmV0dXJuIHVua25vd25FbGVtZW50Q2FjaGVbdGFnXQogICAgfQogICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwogICAgaWYgKHRhZy5pbmRleE9mKCctJykgPiAtMSkgewogICAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8yODIxMDM2NC8xMDcwMjQ0CiAgICAgIHJldHVybiAodW5rbm93bkVsZW1lbnRDYWNoZVt0YWddID0gKAogICAgICAgIGVsLmNvbnN0cnVjdG9yID09PSB3aW5kb3cuSFRNTFVua25vd25FbGVtZW50IHx8CiAgICAgICAgZWwuY29uc3RydWN0b3IgPT09IHdpbmRvdy5IVE1MRWxlbWVudAogICAgICApKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICh1bmtub3duRWxlbWVudENhY2hlW3RhZ10gPSAvSFRNTFVua25vd25FbGVtZW50Ly50ZXN0KGVsLnRvU3RyaW5nKCkpKQogICAgfQogIH0KCiAgdmFyIGlzVGV4dElucHV0VHlwZSA9IG1ha2VNYXAoJ3RleHQsbnVtYmVyLHBhc3N3b3JkLHNlYXJjaCxlbWFpbCx0ZWwsdXJsJyk7CgogIC8qICAqLwoKICAvKioKICAgKiBRdWVyeSBhbiBlbGVtZW50IHNlbGVjdG9yIGlmIGl0J3Mgbm90IGFuIGVsZW1lbnQgYWxyZWFkeS4KICAgKi8KICBmdW5jdGlvbiBxdWVyeSAoZWwpIHsKICAgIGlmICh0eXBlb2YgZWwgPT09ICdzdHJpbmcnKSB7CiAgICAgIHZhciBzZWxlY3RlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWwpOwogICAgICBpZiAoIXNlbGVjdGVkKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdDYW5ub3QgZmluZCBlbGVtZW50OiAnICsgZWwKICAgICAgICApOwogICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKQogICAgICB9CiAgICAgIHJldHVybiBzZWxlY3RlZAogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGVsCiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCQxICh0YWdOYW1lLCB2bm9kZSkgewogICAgdmFyIGVsbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7CiAgICBpZiAodGFnTmFtZSAhPT0gJ3NlbGVjdCcpIHsKICAgICAgcmV0dXJuIGVsbQogICAgfQogICAgLy8gZmFsc2Ugb3IgbnVsbCB3aWxsIHJlbW92ZSB0aGUgYXR0cmlidXRlIGJ1dCB1bmRlZmluZWQgd2lsbCBub3QKICAgIGlmICh2bm9kZS5kYXRhICYmIHZub2RlLmRhdGEuYXR0cnMgJiYgdm5vZGUuZGF0YS5hdHRycy5tdWx0aXBsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGVsbS5zZXRBdHRyaWJ1dGUoJ211bHRpcGxlJywgJ211bHRpcGxlJyk7CiAgICB9CiAgICByZXR1cm4gZWxtCiAgfQoKICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50TlMgKG5hbWVzcGFjZSwgdGFnTmFtZSkgewogICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VNYXBbbmFtZXNwYWNlXSwgdGFnTmFtZSkKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZVRleHROb2RlICh0ZXh0KSB7CiAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbW1lbnQgKHRleHQpIHsKICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVDb21tZW50KHRleHQpCiAgfQoKICBmdW5jdGlvbiBpbnNlcnRCZWZvcmUgKHBhcmVudE5vZGUsIG5ld05vZGUsIHJlZmVyZW5jZU5vZGUpIHsKICAgIHBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5ld05vZGUsIHJlZmVyZW5jZU5vZGUpOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlQ2hpbGQgKG5vZGUsIGNoaWxkKSB7CiAgICBub2RlLnJlbW92ZUNoaWxkKGNoaWxkKTsKICB9CgogIGZ1bmN0aW9uIGFwcGVuZENoaWxkIChub2RlLCBjaGlsZCkgewogICAgbm9kZS5hcHBlbmRDaGlsZChjaGlsZCk7CiAgfQoKICBmdW5jdGlvbiBwYXJlbnROb2RlIChub2RlKSB7CiAgICByZXR1cm4gbm9kZS5wYXJlbnROb2RlCiAgfQoKICBmdW5jdGlvbiBuZXh0U2libGluZyAobm9kZSkgewogICAgcmV0dXJuIG5vZGUubmV4dFNpYmxpbmcKICB9CgogIGZ1bmN0aW9uIHRhZ05hbWUgKG5vZGUpIHsKICAgIHJldHVybiBub2RlLnRhZ05hbWUKICB9CgogIGZ1bmN0aW9uIHNldFRleHRDb250ZW50IChub2RlLCB0ZXh0KSB7CiAgICBub2RlLnRleHRDb250ZW50ID0gdGV4dDsKICB9CgogIGZ1bmN0aW9uIHNldFN0eWxlU2NvcGUgKG5vZGUsIHNjb3BlSWQpIHsKICAgIG5vZGUuc2V0QXR0cmlidXRlKHNjb3BlSWQsICcnKTsKICB9CgogIHZhciBub2RlT3BzID0gLyojX19QVVJFX18qL09iamVjdC5mcmVlemUoewogICAgY3JlYXRlRWxlbWVudDogY3JlYXRlRWxlbWVudCQxLAogICAgY3JlYXRlRWxlbWVudE5TOiBjcmVhdGVFbGVtZW50TlMsCiAgICBjcmVhdGVUZXh0Tm9kZTogY3JlYXRlVGV4dE5vZGUsCiAgICBjcmVhdGVDb21tZW50OiBjcmVhdGVDb21tZW50LAogICAgaW5zZXJ0QmVmb3JlOiBpbnNlcnRCZWZvcmUsCiAgICByZW1vdmVDaGlsZDogcmVtb3ZlQ2hpbGQsCiAgICBhcHBlbmRDaGlsZDogYXBwZW5kQ2hpbGQsCiAgICBwYXJlbnROb2RlOiBwYXJlbnROb2RlLAogICAgbmV4dFNpYmxpbmc6IG5leHRTaWJsaW5nLAogICAgdGFnTmFtZTogdGFnTmFtZSwKICAgIHNldFRleHRDb250ZW50OiBzZXRUZXh0Q29udGVudCwKICAgIHNldFN0eWxlU2NvcGU6IHNldFN0eWxlU2NvcGUKICB9KTsKCiAgLyogICovCgogIHZhciByZWYgPSB7CiAgICBjcmVhdGU6IGZ1bmN0aW9uIGNyZWF0ZSAoXywgdm5vZGUpIHsKICAgICAgcmVnaXN0ZXJSZWYodm5vZGUpOwogICAgfSwKICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgICAgaWYgKG9sZFZub2RlLmRhdGEucmVmICE9PSB2bm9kZS5kYXRhLnJlZikgewogICAgICAgIHJlZ2lzdGVyUmVmKG9sZFZub2RlLCB0cnVlKTsKICAgICAgICByZWdpc3RlclJlZih2bm9kZSk7CiAgICAgIH0KICAgIH0sCiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95ICh2bm9kZSkgewogICAgICByZWdpc3RlclJlZih2bm9kZSwgdHJ1ZSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gcmVnaXN0ZXJSZWYgKHZub2RlLCBpc1JlbW92YWwpIHsKICAgIHZhciBrZXkgPSB2bm9kZS5kYXRhLnJlZjsKICAgIGlmICghaXNEZWYoa2V5KSkgeyByZXR1cm4gfQoKICAgIHZhciB2bSA9IHZub2RlLmNvbnRleHQ7CiAgICB2YXIgcmVmID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2UgfHwgdm5vZGUuZWxtOwogICAgdmFyIHJlZnMgPSB2bS4kcmVmczsKICAgIGlmIChpc1JlbW92YWwpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVmc1trZXldKSkgewogICAgICAgIHJlbW92ZShyZWZzW2tleV0sIHJlZik7CiAgICAgIH0gZWxzZSBpZiAocmVmc1trZXldID09PSByZWYpIHsKICAgICAgICByZWZzW2tleV0gPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmICh2bm9kZS5kYXRhLnJlZkluRm9yKSB7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJlZnNba2V5XSkpIHsKICAgICAgICAgIHJlZnNba2V5XSA9IFtyZWZdOwogICAgICAgIH0gZWxzZSBpZiAocmVmc1trZXldLmluZGV4T2YocmVmKSA8IDApIHsKICAgICAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICAgICAgcmVmc1trZXldLnB1c2gocmVmKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVmc1trZXldID0gcmVmOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBWaXJ0dWFsIERPTSBwYXRjaGluZyBhbGdvcml0aG0gYmFzZWQgb24gU25hYmJkb20gYnkKICAgKiBTaW1vbiBGcmlpcyBWaW5kdW0gKEBwYWxkZXBpbmQpCiAgICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlCiAgICogaHR0cHM6Ly9naXRodWIuY29tL3BhbGRlcGluZC9zbmFiYmRvbS9ibG9iL21hc3Rlci9MSUNFTlNFCiAgICoKICAgKiBtb2RpZmllZCBieSBFdmFuIFlvdSAoQHl5eDk5MDgwMykKICAgKgogICAqIE5vdCB0eXBlLWNoZWNraW5nIHRoaXMgYmVjYXVzZSB0aGlzIGZpbGUgaXMgcGVyZi1jcml0aWNhbCBhbmQgdGhlIGNvc3QKICAgKiBvZiBtYWtpbmcgZmxvdyB1bmRlcnN0YW5kIGl0IGlzIG5vdCB3b3J0aCBpdC4KICAgKi8KCiAgdmFyIGVtcHR5Tm9kZSA9IG5ldyBWTm9kZSgnJywge30sIFtdKTsKCiAgdmFyIGhvb2tzID0gWydjcmVhdGUnLCAnYWN0aXZhdGUnLCAndXBkYXRlJywgJ3JlbW92ZScsICdkZXN0cm95J107CgogIGZ1bmN0aW9uIHNhbWVWbm9kZSAoYSwgYikgewogICAgcmV0dXJuICgKICAgICAgYS5rZXkgPT09IGIua2V5ICYmICgKICAgICAgICAoCiAgICAgICAgICBhLnRhZyA9PT0gYi50YWcgJiYKICAgICAgICAgIGEuaXNDb21tZW50ID09PSBiLmlzQ29tbWVudCAmJgogICAgICAgICAgaXNEZWYoYS5kYXRhKSA9PT0gaXNEZWYoYi5kYXRhKSAmJgogICAgICAgICAgc2FtZUlucHV0VHlwZShhLCBiKQogICAgICAgICkgfHwgKAogICAgICAgICAgaXNUcnVlKGEuaXNBc3luY1BsYWNlaG9sZGVyKSAmJgogICAgICAgICAgYS5hc3luY0ZhY3RvcnkgPT09IGIuYXN5bmNGYWN0b3J5ICYmCiAgICAgICAgICBpc1VuZGVmKGIuYXN5bmNGYWN0b3J5LmVycm9yKQogICAgICAgICkKICAgICAgKQogICAgKQogIH0KCiAgZnVuY3Rpb24gc2FtZUlucHV0VHlwZSAoYSwgYikgewogICAgaWYgKGEudGFnICE9PSAnaW5wdXQnKSB7IHJldHVybiB0cnVlIH0KICAgIHZhciBpOwogICAgdmFyIHR5cGVBID0gaXNEZWYoaSA9IGEuZGF0YSkgJiYgaXNEZWYoaSA9IGkuYXR0cnMpICYmIGkudHlwZTsKICAgIHZhciB0eXBlQiA9IGlzRGVmKGkgPSBiLmRhdGEpICYmIGlzRGVmKGkgPSBpLmF0dHJzKSAmJiBpLnR5cGU7CiAgICByZXR1cm4gdHlwZUEgPT09IHR5cGVCIHx8IGlzVGV4dElucHV0VHlwZSh0eXBlQSkgJiYgaXNUZXh0SW5wdXRUeXBlKHR5cGVCKQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlS2V5VG9PbGRJZHggKGNoaWxkcmVuLCBiZWdpbklkeCwgZW5kSWR4KSB7CiAgICB2YXIgaSwga2V5OwogICAgdmFyIG1hcCA9IHt9OwogICAgZm9yIChpID0gYmVnaW5JZHg7IGkgPD0gZW5kSWR4OyArK2kpIHsKICAgICAga2V5ID0gY2hpbGRyZW5baV0ua2V5OwogICAgICBpZiAoaXNEZWYoa2V5KSkgeyBtYXBba2V5XSA9IGk7IH0KICAgIH0KICAgIHJldHVybiBtYXAKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZVBhdGNoRnVuY3Rpb24gKGJhY2tlbmQpIHsKICAgIHZhciBpLCBqOwogICAgdmFyIGNicyA9IHt9OwoKICAgIHZhciBtb2R1bGVzID0gYmFja2VuZC5tb2R1bGVzOwogICAgdmFyIG5vZGVPcHMgPSBiYWNrZW5kLm5vZGVPcHM7CgogICAgZm9yIChpID0gMDsgaSA8IGhvb2tzLmxlbmd0aDsgKytpKSB7CiAgICAgIGNic1tob29rc1tpXV0gPSBbXTsKICAgICAgZm9yIChqID0gMDsgaiA8IG1vZHVsZXMubGVuZ3RoOyArK2opIHsKICAgICAgICBpZiAoaXNEZWYobW9kdWxlc1tqXVtob29rc1tpXV0pKSB7CiAgICAgICAgICBjYnNbaG9va3NbaV1dLnB1c2gobW9kdWxlc1tqXVtob29rc1tpXV0pOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGVtcHR5Tm9kZUF0IChlbG0pIHsKICAgICAgcmV0dXJuIG5ldyBWTm9kZShub2RlT3BzLnRhZ05hbWUoZWxtKS50b0xvd2VyQ2FzZSgpLCB7fSwgW10sIHVuZGVmaW5lZCwgZWxtKQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZVJtQ2IgKGNoaWxkRWxtLCBsaXN0ZW5lcnMpIHsKICAgICAgZnVuY3Rpb24gcmVtb3ZlJCQxICgpIHsKICAgICAgICBpZiAoLS1yZW1vdmUkJDEubGlzdGVuZXJzID09PSAwKSB7CiAgICAgICAgICByZW1vdmVOb2RlKGNoaWxkRWxtKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmVtb3ZlJCQxLmxpc3RlbmVycyA9IGxpc3RlbmVyczsKICAgICAgcmV0dXJuIHJlbW92ZSQkMQogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZU5vZGUgKGVsKSB7CiAgICAgIHZhciBwYXJlbnQgPSBub2RlT3BzLnBhcmVudE5vZGUoZWwpOwogICAgICAvLyBlbGVtZW50IG1heSBoYXZlIGFscmVhZHkgYmVlbiByZW1vdmVkIGR1ZSB0byB2LWh0bWwgLyB2LXRleHQKICAgICAgaWYgKGlzRGVmKHBhcmVudCkpIHsKICAgICAgICBub2RlT3BzLnJlbW92ZUNoaWxkKHBhcmVudCwgZWwpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaXNVbmtub3duRWxlbWVudCQkMSAodm5vZGUsIGluVlByZSkgewogICAgICByZXR1cm4gKAogICAgICAgICFpblZQcmUgJiYKICAgICAgICAhdm5vZGUubnMgJiYKICAgICAgICAhKAogICAgICAgICAgY29uZmlnLmlnbm9yZWRFbGVtZW50cy5sZW5ndGggJiYKICAgICAgICAgIGNvbmZpZy5pZ25vcmVkRWxlbWVudHMuc29tZShmdW5jdGlvbiAoaWdub3JlKSB7CiAgICAgICAgICAgIHJldHVybiBpc1JlZ0V4cChpZ25vcmUpCiAgICAgICAgICAgICAgPyBpZ25vcmUudGVzdCh2bm9kZS50YWcpCiAgICAgICAgICAgICAgOiBpZ25vcmUgPT09IHZub2RlLnRhZwogICAgICAgICAgfSkKICAgICAgICApICYmCiAgICAgICAgY29uZmlnLmlzVW5rbm93bkVsZW1lbnQodm5vZGUudGFnKQogICAgICApCiAgICB9CgogICAgdmFyIGNyZWF0aW5nRWxtSW5WUHJlID0gMDsKCiAgICBmdW5jdGlvbiBjcmVhdGVFbG0gKAogICAgICB2bm9kZSwKICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLAogICAgICBwYXJlbnRFbG0sCiAgICAgIHJlZkVsbSwKICAgICAgbmVzdGVkLAogICAgICBvd25lckFycmF5LAogICAgICBpbmRleAogICAgKSB7CiAgICAgIGlmIChpc0RlZih2bm9kZS5lbG0pICYmIGlzRGVmKG93bmVyQXJyYXkpKSB7CiAgICAgICAgLy8gVGhpcyB2bm9kZSB3YXMgdXNlZCBpbiBhIHByZXZpb3VzIHJlbmRlciEKICAgICAgICAvLyBub3cgaXQncyB1c2VkIGFzIGEgbmV3IG5vZGUsIG92ZXJ3cml0aW5nIGl0cyBlbG0gd291bGQgY2F1c2UKICAgICAgICAvLyBwb3RlbnRpYWwgcGF0Y2ggZXJyb3JzIGRvd24gdGhlIHJvYWQgd2hlbiBpdCdzIHVzZWQgYXMgYW4gaW5zZXJ0aW9uCiAgICAgICAgLy8gcmVmZXJlbmNlIG5vZGUuIEluc3RlYWQsIHdlIGNsb25lIHRoZSBub2RlIG9uLWRlbWFuZCBiZWZvcmUgY3JlYXRpbmcKICAgICAgICAvLyBhc3NvY2lhdGVkIERPTSBlbGVtZW50IGZvciBpdC4KICAgICAgICB2bm9kZSA9IG93bmVyQXJyYXlbaW5kZXhdID0gY2xvbmVWTm9kZSh2bm9kZSk7CiAgICAgIH0KCiAgICAgIHZub2RlLmlzUm9vdEluc2VydCA9ICFuZXN0ZWQ7IC8vIGZvciB0cmFuc2l0aW9uIGVudGVyIGNoZWNrCiAgICAgIGlmIChjcmVhdGVDb21wb25lbnQodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCByZWZFbG0pKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gdm5vZGUuZGF0YTsKICAgICAgdmFyIGNoaWxkcmVuID0gdm5vZGUuY2hpbGRyZW47CiAgICAgIHZhciB0YWcgPSB2bm9kZS50YWc7CiAgICAgIGlmIChpc0RlZih0YWcpKSB7CiAgICAgICAgewogICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5wcmUpIHsKICAgICAgICAgICAgY3JlYXRpbmdFbG1JblZQcmUrKzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc1Vua25vd25FbGVtZW50JCQxKHZub2RlLCBjcmVhdGluZ0VsbUluVlByZSkpIHsKICAgICAgICAgICAgd2FybigKICAgICAgICAgICAgICAnVW5rbm93biBjdXN0b20gZWxlbWVudDogPCcgKyB0YWcgKyAnPiAtIGRpZCB5b3UgJyArCiAgICAgICAgICAgICAgJ3JlZ2lzdGVyIHRoZSBjb21wb25lbnQgY29ycmVjdGx5PyBGb3IgcmVjdXJzaXZlIGNvbXBvbmVudHMsICcgKwogICAgICAgICAgICAgICdtYWtlIHN1cmUgdG8gcHJvdmlkZSB0aGUgIm5hbWUiIG9wdGlvbi4nLAogICAgICAgICAgICAgIHZub2RlLmNvbnRleHQKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZub2RlLmVsbSA9IHZub2RlLm5zCiAgICAgICAgICA/IG5vZGVPcHMuY3JlYXRlRWxlbWVudE5TKHZub2RlLm5zLCB0YWcpCiAgICAgICAgICA6IG5vZGVPcHMuY3JlYXRlRWxlbWVudCh0YWcsIHZub2RlKTsKICAgICAgICBzZXRTY29wZSh2bm9kZSk7CgogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIHsKICAgICAgICAgIGNyZWF0ZUNoaWxkcmVuKHZub2RlLCBjaGlsZHJlbiwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgIGlmIChpc0RlZihkYXRhKSkgewogICAgICAgICAgICBpbnZva2VDcmVhdGVIb29rcyh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgICAgICB9CgogICAgICAgIGlmIChkYXRhICYmIGRhdGEucHJlKSB7CiAgICAgICAgICBjcmVhdGluZ0VsbUluVlByZS0tOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpc1RydWUodm5vZGUuaXNDb21tZW50KSkgewogICAgICAgIHZub2RlLmVsbSA9IG5vZGVPcHMuY3JlYXRlQ29tbWVudCh2bm9kZS50ZXh0KTsKICAgICAgICBpbnNlcnQocGFyZW50RWxtLCB2bm9kZS5lbG0sIHJlZkVsbSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm5vZGUuZWxtID0gbm9kZU9wcy5jcmVhdGVUZXh0Tm9kZSh2bm9kZS50ZXh0KTsKICAgICAgICBpbnNlcnQocGFyZW50RWxtLCB2bm9kZS5lbG0sIHJlZkVsbSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVDb21wb25lbnQgKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtKSB7CiAgICAgIHZhciBpID0gdm5vZGUuZGF0YTsKICAgICAgaWYgKGlzRGVmKGkpKSB7CiAgICAgICAgdmFyIGlzUmVhY3RpdmF0ZWQgPSBpc0RlZih2bm9kZS5jb21wb25lbnRJbnN0YW5jZSkgJiYgaS5rZWVwQWxpdmU7CiAgICAgICAgaWYgKGlzRGVmKGkgPSBpLmhvb2spICYmIGlzRGVmKGkgPSBpLmluaXQpKSB7CiAgICAgICAgICBpKHZub2RlLCBmYWxzZSAvKiBoeWRyYXRpbmcgKi8pOwogICAgICAgIH0KICAgICAgICAvLyBhZnRlciBjYWxsaW5nIHRoZSBpbml0IGhvb2ssIGlmIHRoZSB2bm9kZSBpcyBhIGNoaWxkIGNvbXBvbmVudAogICAgICAgIC8vIGl0IHNob3VsZCd2ZSBjcmVhdGVkIGEgY2hpbGQgaW5zdGFuY2UgYW5kIG1vdW50ZWQgaXQuIHRoZSBjaGlsZAogICAgICAgIC8vIGNvbXBvbmVudCBhbHNvIGhhcyBzZXQgdGhlIHBsYWNlaG9sZGVyIHZub2RlJ3MgZWxtLgogICAgICAgIC8vIGluIHRoYXQgY2FzZSB3ZSBjYW4ganVzdCByZXR1cm4gdGhlIGVsZW1lbnQgYW5kIGJlIGRvbmUuCiAgICAgICAgaWYgKGlzRGVmKHZub2RlLmNvbXBvbmVudEluc3RhbmNlKSkgewogICAgICAgICAgaW5pdENvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgICAgICAgIGlmIChpc1RydWUoaXNSZWFjdGl2YXRlZCkpIHsKICAgICAgICAgICAgcmVhY3RpdmF0ZUNvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBwYXJlbnRFbG0sIHJlZkVsbSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGluaXRDb21wb25lbnQgKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgICAgaWYgKGlzRGVmKHZub2RlLmRhdGEucGVuZGluZ0luc2VydCkpIHsKICAgICAgICBpbnNlcnRlZFZub2RlUXVldWUucHVzaC5hcHBseShpbnNlcnRlZFZub2RlUXVldWUsIHZub2RlLmRhdGEucGVuZGluZ0luc2VydCk7CiAgICAgICAgdm5vZGUuZGF0YS5wZW5kaW5nSW5zZXJ0ID0gbnVsbDsKICAgICAgfQogICAgICB2bm9kZS5lbG0gPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZS4kZWw7CiAgICAgIGlmIChpc1BhdGNoYWJsZSh2bm9kZSkpIHsKICAgICAgICBpbnZva2VDcmVhdGVIb29rcyh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICBzZXRTY29wZSh2bm9kZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZW1wdHkgY29tcG9uZW50IHJvb3QuCiAgICAgICAgLy8gc2tpcCBhbGwgZWxlbWVudC1yZWxhdGVkIG1vZHVsZXMgZXhjZXB0IGZvciByZWYgKCMzNDU1KQogICAgICAgIHJlZ2lzdGVyUmVmKHZub2RlKTsKICAgICAgICAvLyBtYWtlIHN1cmUgdG8gaW52b2tlIHRoZSBpbnNlcnQgaG9vawogICAgICAgIGluc2VydGVkVm5vZGVRdWV1ZS5wdXNoKHZub2RlKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJlYWN0aXZhdGVDb21wb25lbnQgKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtKSB7CiAgICAgIHZhciBpOwogICAgICAvLyBoYWNrIGZvciAjNDMzOTogYSByZWFjdGl2YXRlZCBjb21wb25lbnQgd2l0aCBpbm5lciB0cmFuc2l0aW9uCiAgICAgIC8vIGRvZXMgbm90IHRyaWdnZXIgYmVjYXVzZSB0aGUgaW5uZXIgbm9kZSdzIGNyZWF0ZWQgaG9va3MgYXJlIG5vdCBjYWxsZWQKICAgICAgLy8gYWdhaW4uIEl0J3Mgbm90IGlkZWFsIHRvIGludm9sdmUgbW9kdWxlLXNwZWNpZmljIGxvZ2ljIGluIGhlcmUgYnV0CiAgICAgIC8vIHRoZXJlIGRvZXNuJ3Qgc2VlbSB0byBiZSBhIGJldHRlciB3YXkgdG8gZG8gaXQuCiAgICAgIHZhciBpbm5lck5vZGUgPSB2bm9kZTsKICAgICAgd2hpbGUgKGlubmVyTm9kZS5jb21wb25lbnRJbnN0YW5jZSkgewogICAgICAgIGlubmVyTm9kZSA9IGlubmVyTm9kZS5jb21wb25lbnRJbnN0YW5jZS5fdm5vZGU7CiAgICAgICAgaWYgKGlzRGVmKGkgPSBpbm5lck5vZGUuZGF0YSkgJiYgaXNEZWYoaSA9IGkudHJhbnNpdGlvbikpIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjYnMuYWN0aXZhdGUubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgY2JzLmFjdGl2YXRlW2ldKGVtcHR5Tm9kZSwgaW5uZXJOb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGluc2VydGVkVm5vZGVRdWV1ZS5wdXNoKGlubmVyTm9kZSk7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgfQogICAgICAvLyB1bmxpa2UgYSBuZXdseSBjcmVhdGVkIGNvbXBvbmVudCwKICAgICAgLy8gYSByZWFjdGl2YXRlZCBrZWVwLWFsaXZlIGNvbXBvbmVudCBkb2Vzbid0IGluc2VydCBpdHNlbGYKICAgICAgaW5zZXJ0KHBhcmVudEVsbSwgdm5vZGUuZWxtLCByZWZFbG0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGluc2VydCAocGFyZW50LCBlbG0sIHJlZiQkMSkgewogICAgICBpZiAoaXNEZWYocGFyZW50KSkgewogICAgICAgIGlmIChpc0RlZihyZWYkJDEpKSB7CiAgICAgICAgICBpZiAobm9kZU9wcy5wYXJlbnROb2RlKHJlZiQkMSkgPT09IHBhcmVudCkgewogICAgICAgICAgICBub2RlT3BzLmluc2VydEJlZm9yZShwYXJlbnQsIGVsbSwgcmVmJCQxKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbm9kZU9wcy5hcHBlbmRDaGlsZChwYXJlbnQsIGVsbSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQ2hpbGRyZW4gKHZub2RlLCBjaGlsZHJlbiwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkcmVuKSkgewogICAgICAgIHsKICAgICAgICAgIGNoZWNrRHVwbGljYXRlS2V5cyhjaGlsZHJlbik7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGNyZWF0ZUVsbShjaGlsZHJlbltpXSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCB2bm9kZS5lbG0sIG51bGwsIHRydWUsIGNoaWxkcmVuLCBpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoaXNQcmltaXRpdmUodm5vZGUudGV4dCkpIHsKICAgICAgICBub2RlT3BzLmFwcGVuZENoaWxkKHZub2RlLmVsbSwgbm9kZU9wcy5jcmVhdGVUZXh0Tm9kZShTdHJpbmcodm5vZGUudGV4dCkpKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGlzUGF0Y2hhYmxlICh2bm9kZSkgewogICAgICB3aGlsZSAodm5vZGUuY29tcG9uZW50SW5zdGFuY2UpIHsKICAgICAgICB2bm9kZSA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlLl92bm9kZTsKICAgICAgfQogICAgICByZXR1cm4gaXNEZWYodm5vZGUudGFnKQogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZUNyZWF0ZUhvb2tzICh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSB7CiAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGNicy5jcmVhdGUubGVuZ3RoOyArK2kkMSkgewogICAgICAgIGNicy5jcmVhdGVbaSQxXShlbXB0eU5vZGUsIHZub2RlKTsKICAgICAgfQogICAgICBpID0gdm5vZGUuZGF0YS5ob29rOyAvLyBSZXVzZSB2YXJpYWJsZQogICAgICBpZiAoaXNEZWYoaSkpIHsKICAgICAgICBpZiAoaXNEZWYoaS5jcmVhdGUpKSB7IGkuY3JlYXRlKGVtcHR5Tm9kZSwgdm5vZGUpOyB9CiAgICAgICAgaWYgKGlzRGVmKGkuaW5zZXJ0KSkgeyBpbnNlcnRlZFZub2RlUXVldWUucHVzaCh2bm9kZSk7IH0KICAgICAgfQogICAgfQoKICAgIC8vIHNldCBzY29wZSBpZCBhdHRyaWJ1dGUgZm9yIHNjb3BlZCBDU1MuCiAgICAvLyB0aGlzIGlzIGltcGxlbWVudGVkIGFzIGEgc3BlY2lhbCBjYXNlIHRvIGF2b2lkIHRoZSBvdmVyaGVhZAogICAgLy8gb2YgZ29pbmcgdGhyb3VnaCB0aGUgbm9ybWFsIGF0dHJpYnV0ZSBwYXRjaGluZyBwcm9jZXNzLgogICAgZnVuY3Rpb24gc2V0U2NvcGUgKHZub2RlKSB7CiAgICAgIHZhciBpOwogICAgICBpZiAoaXNEZWYoaSA9IHZub2RlLmZuU2NvcGVJZCkpIHsKICAgICAgICBub2RlT3BzLnNldFN0eWxlU2NvcGUodm5vZGUuZWxtLCBpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgYW5jZXN0b3IgPSB2bm9kZTsKICAgICAgICB3aGlsZSAoYW5jZXN0b3IpIHsKICAgICAgICAgIGlmIChpc0RlZihpID0gYW5jZXN0b3IuY29udGV4dCkgJiYgaXNEZWYoaSA9IGkuJG9wdGlvbnMuX3Njb3BlSWQpKSB7CiAgICAgICAgICAgIG5vZGVPcHMuc2V0U3R5bGVTY29wZSh2bm9kZS5lbG0sIGkpOwogICAgICAgICAgfQogICAgICAgICAgYW5jZXN0b3IgPSBhbmNlc3Rvci5wYXJlbnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIGZvciBzbG90IGNvbnRlbnQgdGhleSBzaG91bGQgYWxzbyBnZXQgdGhlIHNjb3BlSWQgZnJvbSB0aGUgaG9zdCBpbnN0YW5jZS4KICAgICAgaWYgKGlzRGVmKGkgPSBhY3RpdmVJbnN0YW5jZSkgJiYKICAgICAgICBpICE9PSB2bm9kZS5jb250ZXh0ICYmCiAgICAgICAgaSAhPT0gdm5vZGUuZm5Db250ZXh0ICYmCiAgICAgICAgaXNEZWYoaSA9IGkuJG9wdGlvbnMuX3Njb3BlSWQpCiAgICAgICkgewogICAgICAgIG5vZGVPcHMuc2V0U3R5bGVTY29wZSh2bm9kZS5lbG0sIGkpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYWRkVm5vZGVzIChwYXJlbnRFbG0sIHJlZkVsbSwgdm5vZGVzLCBzdGFydElkeCwgZW5kSWR4LCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgICAgZm9yICg7IHN0YXJ0SWR4IDw9IGVuZElkeDsgKytzdGFydElkeCkgewogICAgICAgIGNyZWF0ZUVsbSh2bm9kZXNbc3RhcnRJZHhdLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtLCBmYWxzZSwgdm5vZGVzLCBzdGFydElkeCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2VEZXN0cm95SG9vayAodm5vZGUpIHsKICAgICAgdmFyIGksIGo7CiAgICAgIHZhciBkYXRhID0gdm5vZGUuZGF0YTsKICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgaWYgKGlzRGVmKGkgPSBkYXRhLmhvb2spICYmIGlzRGVmKGkgPSBpLmRlc3Ryb3kpKSB7IGkodm5vZGUpOyB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5kZXN0cm95Lmxlbmd0aDsgKytpKSB7IGNicy5kZXN0cm95W2ldKHZub2RlKTsgfQogICAgICB9CiAgICAgIGlmIChpc0RlZihpID0gdm5vZGUuY2hpbGRyZW4pKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IHZub2RlLmNoaWxkcmVuLmxlbmd0aDsgKytqKSB7CiAgICAgICAgICBpbnZva2VEZXN0cm95SG9vayh2bm9kZS5jaGlsZHJlbltqXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlVm5vZGVzICh2bm9kZXMsIHN0YXJ0SWR4LCBlbmRJZHgpIHsKICAgICAgZm9yICg7IHN0YXJ0SWR4IDw9IGVuZElkeDsgKytzdGFydElkeCkgewogICAgICAgIHZhciBjaCA9IHZub2Rlc1tzdGFydElkeF07CiAgICAgICAgaWYgKGlzRGVmKGNoKSkgewogICAgICAgICAgaWYgKGlzRGVmKGNoLnRhZykpIHsKICAgICAgICAgICAgcmVtb3ZlQW5kSW52b2tlUmVtb3ZlSG9vayhjaCk7CiAgICAgICAgICAgIGludm9rZURlc3Ryb3lIb29rKGNoKTsKICAgICAgICAgIH0gZWxzZSB7IC8vIFRleHQgbm9kZQogICAgICAgICAgICByZW1vdmVOb2RlKGNoLmVsbSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlQW5kSW52b2tlUmVtb3ZlSG9vayAodm5vZGUsIHJtKSB7CiAgICAgIGlmIChpc0RlZihybSkgfHwgaXNEZWYodm5vZGUuZGF0YSkpIHsKICAgICAgICB2YXIgaTsKICAgICAgICB2YXIgbGlzdGVuZXJzID0gY2JzLnJlbW92ZS5sZW5ndGggKyAxOwogICAgICAgIGlmIChpc0RlZihybSkpIHsKICAgICAgICAgIC8vIHdlIGhhdmUgYSByZWN1cnNpdmVseSBwYXNzZWQgZG93biBybSBjYWxsYmFjawogICAgICAgICAgLy8gaW5jcmVhc2UgdGhlIGxpc3RlbmVycyBjb3VudAogICAgICAgICAgcm0ubGlzdGVuZXJzICs9IGxpc3RlbmVyczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gZGlyZWN0bHkgcmVtb3ZpbmcKICAgICAgICAgIHJtID0gY3JlYXRlUm1DYih2bm9kZS5lbG0sIGxpc3RlbmVycyk7CiAgICAgICAgfQogICAgICAgIC8vIHJlY3Vyc2l2ZWx5IGludm9rZSBob29rcyBvbiBjaGlsZCBjb21wb25lbnQgcm9vdCBub2RlCiAgICAgICAgaWYgKGlzRGVmKGkgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSkgJiYgaXNEZWYoaSA9IGkuX3Zub2RlKSAmJiBpc0RlZihpLmRhdGEpKSB7CiAgICAgICAgICByZW1vdmVBbmRJbnZva2VSZW1vdmVIb29rKGksIHJtKTsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5yZW1vdmUubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIGNicy5yZW1vdmVbaV0odm5vZGUsIHJtKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzRGVmKGkgPSB2bm9kZS5kYXRhLmhvb2spICYmIGlzRGVmKGkgPSBpLnJlbW92ZSkpIHsKICAgICAgICAgIGkodm5vZGUsIHJtKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcm0oKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVtb3ZlTm9kZSh2bm9kZS5lbG0pOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlQ2hpbGRyZW4gKHBhcmVudEVsbSwgb2xkQ2gsIG5ld0NoLCBpbnNlcnRlZFZub2RlUXVldWUsIHJlbW92ZU9ubHkpIHsKICAgICAgdmFyIG9sZFN0YXJ0SWR4ID0gMDsKICAgICAgdmFyIG5ld1N0YXJ0SWR4ID0gMDsKICAgICAgdmFyIG9sZEVuZElkeCA9IG9sZENoLmxlbmd0aCAtIDE7CiAgICAgIHZhciBvbGRTdGFydFZub2RlID0gb2xkQ2hbMF07CiAgICAgIHZhciBvbGRFbmRWbm9kZSA9IG9sZENoW29sZEVuZElkeF07CiAgICAgIHZhciBuZXdFbmRJZHggPSBuZXdDaC5sZW5ndGggLSAxOwogICAgICB2YXIgbmV3U3RhcnRWbm9kZSA9IG5ld0NoWzBdOwogICAgICB2YXIgbmV3RW5kVm5vZGUgPSBuZXdDaFtuZXdFbmRJZHhdOwogICAgICB2YXIgb2xkS2V5VG9JZHgsIGlkeEluT2xkLCB2bm9kZVRvTW92ZSwgcmVmRWxtOwoKICAgICAgLy8gcmVtb3ZlT25seSBpcyBhIHNwZWNpYWwgZmxhZyB1c2VkIG9ubHkgYnkgPHRyYW5zaXRpb24tZ3JvdXA+CiAgICAgIC8vIHRvIGVuc3VyZSByZW1vdmVkIGVsZW1lbnRzIHN0YXkgaW4gY29ycmVjdCByZWxhdGl2ZSBwb3NpdGlvbnMKICAgICAgLy8gZHVyaW5nIGxlYXZpbmcgdHJhbnNpdGlvbnMKICAgICAgdmFyIGNhbk1vdmUgPSAhcmVtb3ZlT25seTsKCiAgICAgIHsKICAgICAgICBjaGVja0R1cGxpY2F0ZUtleXMobmV3Q2gpOwogICAgICB9CgogICAgICB3aGlsZSAob2xkU3RhcnRJZHggPD0gb2xkRW5kSWR4ICYmIG5ld1N0YXJ0SWR4IDw9IG5ld0VuZElkeCkgewogICAgICAgIGlmIChpc1VuZGVmKG9sZFN0YXJ0Vm5vZGUpKSB7CiAgICAgICAgICBvbGRTdGFydFZub2RlID0gb2xkQ2hbKytvbGRTdGFydElkeF07IC8vIFZub2RlIGhhcyBiZWVuIG1vdmVkIGxlZnQKICAgICAgICB9IGVsc2UgaWYgKGlzVW5kZWYob2xkRW5kVm5vZGUpKSB7CiAgICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICB9IGVsc2UgaWYgKHNhbWVWbm9kZShvbGRTdGFydFZub2RlLCBuZXdTdGFydFZub2RlKSkgewogICAgICAgICAgcGF0Y2hWbm9kZShvbGRTdGFydFZub2RlLCBuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICBvbGRTdGFydFZub2RlID0gb2xkQ2hbKytvbGRTdGFydElkeF07CiAgICAgICAgICBuZXdTdGFydFZub2RlID0gbmV3Q2hbKytuZXdTdGFydElkeF07CiAgICAgICAgfSBlbHNlIGlmIChzYW1lVm5vZGUob2xkRW5kVm5vZGUsIG5ld0VuZFZub2RlKSkgewogICAgICAgICAgcGF0Y2hWbm9kZShvbGRFbmRWbm9kZSwgbmV3RW5kVm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgbmV3Q2gsIG5ld0VuZElkeCk7CiAgICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICAgIG5ld0VuZFZub2RlID0gbmV3Q2hbLS1uZXdFbmRJZHhdOwogICAgICAgIH0gZWxzZSBpZiAoc2FtZVZub2RlKG9sZFN0YXJ0Vm5vZGUsIG5ld0VuZFZub2RlKSkgeyAvLyBWbm9kZSBtb3ZlZCByaWdodAogICAgICAgICAgcGF0Y2hWbm9kZShvbGRTdGFydFZub2RlLCBuZXdFbmRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBuZXdDaCwgbmV3RW5kSWR4KTsKICAgICAgICAgIGNhbk1vdmUgJiYgbm9kZU9wcy5pbnNlcnRCZWZvcmUocGFyZW50RWxtLCBvbGRTdGFydFZub2RlLmVsbSwgbm9kZU9wcy5uZXh0U2libGluZyhvbGRFbmRWbm9kZS5lbG0pKTsKICAgICAgICAgIG9sZFN0YXJ0Vm5vZGUgPSBvbGRDaFsrK29sZFN0YXJ0SWR4XTsKICAgICAgICAgIG5ld0VuZFZub2RlID0gbmV3Q2hbLS1uZXdFbmRJZHhdOwogICAgICAgIH0gZWxzZSBpZiAoc2FtZVZub2RlKG9sZEVuZFZub2RlLCBuZXdTdGFydFZub2RlKSkgeyAvLyBWbm9kZSBtb3ZlZCBsZWZ0CiAgICAgICAgICBwYXRjaFZub2RlKG9sZEVuZFZub2RlLCBuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICBjYW5Nb3ZlICYmIG5vZGVPcHMuaW5zZXJ0QmVmb3JlKHBhcmVudEVsbSwgb2xkRW5kVm5vZGUuZWxtLCBvbGRTdGFydFZub2RlLmVsbSk7CiAgICAgICAgICBvbGRFbmRWbm9kZSA9IG9sZENoWy0tb2xkRW5kSWR4XTsKICAgICAgICAgIG5ld1N0YXJ0Vm5vZGUgPSBuZXdDaFsrK25ld1N0YXJ0SWR4XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGlzVW5kZWYob2xkS2V5VG9JZHgpKSB7IG9sZEtleVRvSWR4ID0gY3JlYXRlS2V5VG9PbGRJZHgob2xkQ2gsIG9sZFN0YXJ0SWR4LCBvbGRFbmRJZHgpOyB9CiAgICAgICAgICBpZHhJbk9sZCA9IGlzRGVmKG5ld1N0YXJ0Vm5vZGUua2V5KQogICAgICAgICAgICA/IG9sZEtleVRvSWR4W25ld1N0YXJ0Vm5vZGUua2V5XQogICAgICAgICAgICA6IGZpbmRJZHhJbk9sZChuZXdTdGFydFZub2RlLCBvbGRDaCwgb2xkU3RhcnRJZHgsIG9sZEVuZElkeCk7CiAgICAgICAgICBpZiAoaXNVbmRlZihpZHhJbk9sZCkpIHsgLy8gTmV3IGVsZW1lbnQKICAgICAgICAgICAgY3JlYXRlRWxtKG5ld1N0YXJ0Vm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCBvbGRTdGFydFZub2RlLmVsbSwgZmFsc2UsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2bm9kZVRvTW92ZSA9IG9sZENoW2lkeEluT2xkXTsKICAgICAgICAgICAgaWYgKHNhbWVWbm9kZSh2bm9kZVRvTW92ZSwgbmV3U3RhcnRWbm9kZSkpIHsKICAgICAgICAgICAgICBwYXRjaFZub2RlKHZub2RlVG9Nb3ZlLCBuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICAgICAgb2xkQ2hbaWR4SW5PbGRdID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgIGNhbk1vdmUgJiYgbm9kZU9wcy5pbnNlcnRCZWZvcmUocGFyZW50RWxtLCB2bm9kZVRvTW92ZS5lbG0sIG9sZFN0YXJ0Vm5vZGUuZWxtKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBzYW1lIGtleSBidXQgZGlmZmVyZW50IGVsZW1lbnQuIHRyZWF0IGFzIG5ldyBlbGVtZW50CiAgICAgICAgICAgICAgY3JlYXRlRWxtKG5ld1N0YXJ0Vm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCBvbGRTdGFydFZub2RlLmVsbSwgZmFsc2UsIG5ld0NoLCBuZXdTdGFydElkeCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG5ld1N0YXJ0Vm5vZGUgPSBuZXdDaFsrK25ld1N0YXJ0SWR4XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG9sZFN0YXJ0SWR4ID4gb2xkRW5kSWR4KSB7CiAgICAgICAgcmVmRWxtID0gaXNVbmRlZihuZXdDaFtuZXdFbmRJZHggKyAxXSkgPyBudWxsIDogbmV3Q2hbbmV3RW5kSWR4ICsgMV0uZWxtOwogICAgICAgIGFkZFZub2RlcyhwYXJlbnRFbG0sIHJlZkVsbSwgbmV3Q2gsIG5ld1N0YXJ0SWR4LCBuZXdFbmRJZHgsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgIH0gZWxzZSBpZiAobmV3U3RhcnRJZHggPiBuZXdFbmRJZHgpIHsKICAgICAgICByZW1vdmVWbm9kZXMob2xkQ2gsIG9sZFN0YXJ0SWR4LCBvbGRFbmRJZHgpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tEdXBsaWNhdGVLZXlzIChjaGlsZHJlbikgewogICAgICB2YXIgc2VlbktleXMgPSB7fTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciB2bm9kZSA9IGNoaWxkcmVuW2ldOwogICAgICAgIHZhciBrZXkgPSB2bm9kZS5rZXk7CiAgICAgICAgaWYgKGlzRGVmKGtleSkpIHsKICAgICAgICAgIGlmIChzZWVuS2V5c1trZXldKSB7CiAgICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICAgKCJEdXBsaWNhdGUga2V5cyBkZXRlY3RlZDogJyIgKyBrZXkgKyAiJy4gVGhpcyBtYXkgY2F1c2UgYW4gdXBkYXRlIGVycm9yLiIpLAogICAgICAgICAgICAgIHZub2RlLmNvbnRleHQKICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlZW5LZXlzW2tleV0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRJZHhJbk9sZCAobm9kZSwgb2xkQ2gsIHN0YXJ0LCBlbmQpIHsKICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgICAgICB2YXIgYyA9IG9sZENoW2ldOwogICAgICAgIGlmIChpc0RlZihjKSAmJiBzYW1lVm5vZGUobm9kZSwgYykpIHsgcmV0dXJuIGkgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGF0Y2hWbm9kZSAoCiAgICAgIG9sZFZub2RlLAogICAgICB2bm9kZSwKICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLAogICAgICBvd25lckFycmF5LAogICAgICBpbmRleCwKICAgICAgcmVtb3ZlT25seQogICAgKSB7CiAgICAgIGlmIChvbGRWbm9kZSA9PT0gdm5vZGUpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgaWYgKGlzRGVmKHZub2RlLmVsbSkgJiYgaXNEZWYob3duZXJBcnJheSkpIHsKICAgICAgICAvLyBjbG9uZSByZXVzZWQgdm5vZGUKICAgICAgICB2bm9kZSA9IG93bmVyQXJyYXlbaW5kZXhdID0gY2xvbmVWTm9kZSh2bm9kZSk7CiAgICAgIH0KCiAgICAgIHZhciBlbG0gPSB2bm9kZS5lbG0gPSBvbGRWbm9kZS5lbG07CgogICAgICBpZiAoaXNUcnVlKG9sZFZub2RlLmlzQXN5bmNQbGFjZWhvbGRlcikpIHsKICAgICAgICBpZiAoaXNEZWYodm5vZGUuYXN5bmNGYWN0b3J5LnJlc29sdmVkKSkgewogICAgICAgICAgaHlkcmF0ZShvbGRWbm9kZS5lbG0sIHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bm9kZS5pc0FzeW5jUGxhY2Vob2xkZXIgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gcmV1c2UgZWxlbWVudCBmb3Igc3RhdGljIHRyZWVzLgogICAgICAvLyBub3RlIHdlIG9ubHkgZG8gdGhpcyBpZiB0aGUgdm5vZGUgaXMgY2xvbmVkIC0KICAgICAgLy8gaWYgdGhlIG5ldyBub2RlIGlzIG5vdCBjbG9uZWQgaXQgbWVhbnMgdGhlIHJlbmRlciBmdW5jdGlvbnMgaGF2ZSBiZWVuCiAgICAgIC8vIHJlc2V0IGJ5IHRoZSBob3QtcmVsb2FkLWFwaSBhbmQgd2UgbmVlZCB0byBkbyBhIHByb3BlciByZS1yZW5kZXIuCiAgICAgIGlmIChpc1RydWUodm5vZGUuaXNTdGF0aWMpICYmCiAgICAgICAgaXNUcnVlKG9sZFZub2RlLmlzU3RhdGljKSAmJgogICAgICAgIHZub2RlLmtleSA9PT0gb2xkVm5vZGUua2V5ICYmCiAgICAgICAgKGlzVHJ1ZSh2bm9kZS5pc0Nsb25lZCkgfHwgaXNUcnVlKHZub2RlLmlzT25jZSkpCiAgICAgICkgewogICAgICAgIHZub2RlLmNvbXBvbmVudEluc3RhbmNlID0gb2xkVm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHZhciBpOwogICAgICB2YXIgZGF0YSA9IHZub2RlLmRhdGE7CiAgICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS5wcmVwYXRjaCkpIHsKICAgICAgICBpKG9sZFZub2RlLCB2bm9kZSk7CiAgICAgIH0KCiAgICAgIHZhciBvbGRDaCA9IG9sZFZub2RlLmNoaWxkcmVuOwogICAgICB2YXIgY2ggPSB2bm9kZS5jaGlsZHJlbjsKICAgICAgaWYgKGlzRGVmKGRhdGEpICYmIGlzUGF0Y2hhYmxlKHZub2RlKSkgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjYnMudXBkYXRlLmxlbmd0aDsgKytpKSB7IGNicy51cGRhdGVbaV0ob2xkVm5vZGUsIHZub2RlKTsgfQogICAgICAgIGlmIChpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS51cGRhdGUpKSB7IGkob2xkVm5vZGUsIHZub2RlKTsgfQogICAgICB9CiAgICAgIGlmIChpc1VuZGVmKHZub2RlLnRleHQpKSB7CiAgICAgICAgaWYgKGlzRGVmKG9sZENoKSAmJiBpc0RlZihjaCkpIHsKICAgICAgICAgIGlmIChvbGRDaCAhPT0gY2gpIHsgdXBkYXRlQ2hpbGRyZW4oZWxtLCBvbGRDaCwgY2gsIGluc2VydGVkVm5vZGVRdWV1ZSwgcmVtb3ZlT25seSk7IH0KICAgICAgICB9IGVsc2UgaWYgKGlzRGVmKGNoKSkgewogICAgICAgICAgewogICAgICAgICAgICBjaGVja0R1cGxpY2F0ZUtleXMoY2gpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzRGVmKG9sZFZub2RlLnRleHQpKSB7IG5vZGVPcHMuc2V0VGV4dENvbnRlbnQoZWxtLCAnJyk7IH0KICAgICAgICAgIGFkZFZub2RlcyhlbG0sIG51bGwsIGNoLCAwLCBjaC5sZW5ndGggLSAxLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgIH0gZWxzZSBpZiAoaXNEZWYob2xkQ2gpKSB7CiAgICAgICAgICByZW1vdmVWbm9kZXMob2xkQ2gsIDAsIG9sZENoLmxlbmd0aCAtIDEpOwogICAgICAgIH0gZWxzZSBpZiAoaXNEZWYob2xkVm5vZGUudGV4dCkpIHsKICAgICAgICAgIG5vZGVPcHMuc2V0VGV4dENvbnRlbnQoZWxtLCAnJyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKG9sZFZub2RlLnRleHQgIT09IHZub2RlLnRleHQpIHsKICAgICAgICBub2RlT3BzLnNldFRleHRDb250ZW50KGVsbSwgdm5vZGUudGV4dCk7CiAgICAgIH0KICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgaWYgKGlzRGVmKGkgPSBkYXRhLmhvb2spICYmIGlzRGVmKGkgPSBpLnBvc3RwYXRjaCkpIHsgaShvbGRWbm9kZSwgdm5vZGUpOyB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbnZva2VJbnNlcnRIb29rICh2bm9kZSwgcXVldWUsIGluaXRpYWwpIHsKICAgICAgLy8gZGVsYXkgaW5zZXJ0IGhvb2tzIGZvciBjb21wb25lbnQgcm9vdCBub2RlcywgaW52b2tlIHRoZW0gYWZ0ZXIgdGhlCiAgICAgIC8vIGVsZW1lbnQgaXMgcmVhbGx5IGluc2VydGVkCiAgICAgIGlmIChpc1RydWUoaW5pdGlhbCkgJiYgaXNEZWYodm5vZGUucGFyZW50KSkgewogICAgICAgIHZub2RlLnBhcmVudC5kYXRhLnBlbmRpbmdJbnNlcnQgPSBxdWV1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBxdWV1ZVtpXS5kYXRhLmhvb2suaW5zZXJ0KHF1ZXVlW2ldKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICB2YXIgaHlkcmF0aW9uQmFpbGVkID0gZmFsc2U7CiAgICAvLyBsaXN0IG9mIG1vZHVsZXMgdGhhdCBjYW4gc2tpcCBjcmVhdGUgaG9vayBkdXJpbmcgaHlkcmF0aW9uIGJlY2F1c2UgdGhleQogICAgLy8gYXJlIGFscmVhZHkgcmVuZGVyZWQgb24gdGhlIGNsaWVudCBvciBoYXMgbm8gbmVlZCBmb3IgaW5pdGlhbGl6YXRpb24KICAgIC8vIE5vdGU6IHN0eWxlIGlzIGV4Y2x1ZGVkIGJlY2F1c2UgaXQgcmVsaWVzIG9uIGluaXRpYWwgY2xvbmUgZm9yIGZ1dHVyZQogICAgLy8gZGVlcCB1cGRhdGVzICgjNzA2MykuCiAgICB2YXIgaXNSZW5kZXJlZE1vZHVsZSA9IG1ha2VNYXAoJ2F0dHJzLGNsYXNzLHN0YXRpY0NsYXNzLHN0YXRpY1N0eWxlLGtleScpOwoKICAgIC8vIE5vdGU6IHRoaXMgaXMgYSBicm93c2VyLW9ubHkgZnVuY3Rpb24gc28gd2UgY2FuIGFzc3VtZSBlbG1zIGFyZSBET00gbm9kZXMuCiAgICBmdW5jdGlvbiBoeWRyYXRlIChlbG0sIHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIGluVlByZSkgewogICAgICB2YXIgaTsKICAgICAgdmFyIHRhZyA9IHZub2RlLnRhZzsKICAgICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwogICAgICB2YXIgY2hpbGRyZW4gPSB2bm9kZS5jaGlsZHJlbjsKICAgICAgaW5WUHJlID0gaW5WUHJlIHx8IChkYXRhICYmIGRhdGEucHJlKTsKICAgICAgdm5vZGUuZWxtID0gZWxtOwoKICAgICAgaWYgKGlzVHJ1ZSh2bm9kZS5pc0NvbW1lbnQpICYmIGlzRGVmKHZub2RlLmFzeW5jRmFjdG9yeSkpIHsKICAgICAgICB2bm9kZS5pc0FzeW5jUGxhY2Vob2xkZXIgPSB0cnVlOwogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgICAgLy8gYXNzZXJ0IG5vZGUgbWF0Y2gKICAgICAgewogICAgICAgIGlmICghYXNzZXJ0Tm9kZU1hdGNoKGVsbSwgdm5vZGUsIGluVlByZSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaXNEZWYoZGF0YSkpIHsKICAgICAgICBpZiAoaXNEZWYoaSA9IGRhdGEuaG9vaykgJiYgaXNEZWYoaSA9IGkuaW5pdCkpIHsgaSh2bm9kZSwgdHJ1ZSAvKiBoeWRyYXRpbmcgKi8pOyB9CiAgICAgICAgaWYgKGlzRGVmKGkgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSkpIHsKICAgICAgICAgIC8vIGNoaWxkIGNvbXBvbmVudC4gaXQgc2hvdWxkIGhhdmUgaHlkcmF0ZWQgaXRzIG93biB0cmVlLgogICAgICAgICAgaW5pdENvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChpc0RlZih0YWcpKSB7CiAgICAgICAgaWYgKGlzRGVmKGNoaWxkcmVuKSkgewogICAgICAgICAgLy8gZW1wdHkgZWxlbWVudCwgYWxsb3cgY2xpZW50IHRvIHBpY2sgdXAgYW5kIHBvcHVsYXRlIGNoaWxkcmVuCiAgICAgICAgICBpZiAoIWVsbS5oYXNDaGlsZE5vZGVzKCkpIHsKICAgICAgICAgICAgY3JlYXRlQ2hpbGRyZW4odm5vZGUsIGNoaWxkcmVuLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gdi1odG1sIGFuZCBkb21Qcm9wczogaW5uZXJIVE1MCiAgICAgICAgICAgIGlmIChpc0RlZihpID0gZGF0YSkgJiYgaXNEZWYoaSA9IGkuZG9tUHJvcHMpICYmIGlzRGVmKGkgPSBpLmlubmVySFRNTCkpIHsKICAgICAgICAgICAgICBpZiAoaSAhPT0gZWxtLmlubmVySFRNTCkgewogICAgICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmCiAgICAgICAgICAgICAgICAgICFoeWRyYXRpb25CYWlsZWQKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICBoeWRyYXRpb25CYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1BhcmVudDogJywgZWxtKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdzZXJ2ZXIgaW5uZXJIVE1MOiAnLCBpKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdjbGllbnQgaW5uZXJIVE1MOiAnLCBlbG0uaW5uZXJIVE1MKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBpdGVyYXRlIGFuZCBjb21wYXJlIGNoaWxkcmVuIGxpc3RzCiAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuTWF0Y2ggPSB0cnVlOwogICAgICAgICAgICAgIHZhciBjaGlsZE5vZGUgPSBlbG0uZmlyc3RDaGlsZDsKICAgICAgICAgICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBjaGlsZHJlbi5sZW5ndGg7IGkkMSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoIWNoaWxkTm9kZSB8fCAhaHlkcmF0ZShjaGlsZE5vZGUsIGNoaWxkcmVuW2kkMV0sIGluc2VydGVkVm5vZGVRdWV1ZSwgaW5WUHJlKSkgewogICAgICAgICAgICAgICAgICBjaGlsZHJlbk1hdGNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjaGlsZE5vZGUgPSBjaGlsZE5vZGUubmV4dFNpYmxpbmc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vIGlmIGNoaWxkTm9kZSBpcyBub3QgbnVsbCwgaXQgbWVhbnMgdGhlIGFjdHVhbCBjaGlsZE5vZGVzIGxpc3QgaXMKICAgICAgICAgICAgICAvLyBsb25nZXIgdGhhbiB0aGUgdmlydHVhbCBjaGlsZHJlbiBsaXN0LgogICAgICAgICAgICAgIGlmICghY2hpbGRyZW5NYXRjaCB8fCBjaGlsZE5vZGUpIHsKICAgICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJgogICAgICAgICAgICAgICAgICAhaHlkcmF0aW9uQmFpbGVkCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgaHlkcmF0aW9uQmFpbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdQYXJlbnQ6ICcsIGVsbSk7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignTWlzbWF0Y2hpbmcgY2hpbGROb2RlcyB2cy4gVk5vZGVzOiAnLCBlbG0uY2hpbGROb2RlcywgY2hpbGRyZW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChpc0RlZihkYXRhKSkgewogICAgICAgICAgdmFyIGZ1bGxJbnZva2UgPSBmYWxzZTsKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7CiAgICAgICAgICAgIGlmICghaXNSZW5kZXJlZE1vZHVsZShrZXkpKSB7CiAgICAgICAgICAgICAgZnVsbEludm9rZSA9IHRydWU7CiAgICAgICAgICAgICAgaW52b2tlQ3JlYXRlSG9va3Modm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFmdWxsSW52b2tlICYmIGRhdGFbJ2NsYXNzJ10pIHsKICAgICAgICAgICAgLy8gZW5zdXJlIGNvbGxlY3RpbmcgZGVwcyBmb3IgZGVlcCBjbGFzcyBiaW5kaW5ncyBmb3IgZnV0dXJlIHVwZGF0ZXMKICAgICAgICAgICAgdHJhdmVyc2UoZGF0YVsnY2xhc3MnXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGVsbS5kYXRhICE9PSB2bm9kZS50ZXh0KSB7CiAgICAgICAgZWxtLmRhdGEgPSB2bm9kZS50ZXh0OwogICAgICB9CiAgICAgIHJldHVybiB0cnVlCiAgICB9CgogICAgZnVuY3Rpb24gYXNzZXJ0Tm9kZU1hdGNoIChub2RlLCB2bm9kZSwgaW5WUHJlKSB7CiAgICAgIGlmIChpc0RlZih2bm9kZS50YWcpKSB7CiAgICAgICAgcmV0dXJuIHZub2RlLnRhZy5pbmRleE9mKCd2dWUtY29tcG9uZW50JykgPT09IDAgfHwgKAogICAgICAgICAgIWlzVW5rbm93bkVsZW1lbnQkJDEodm5vZGUsIGluVlByZSkgJiYKICAgICAgICAgIHZub2RlLnRhZy50b0xvd2VyQ2FzZSgpID09PSAobm9kZS50YWdOYW1lICYmIG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpKQogICAgICAgICkKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gKHZub2RlLmlzQ29tbWVudCA/IDggOiAzKQogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZ1bmN0aW9uIHBhdGNoIChvbGRWbm9kZSwgdm5vZGUsIGh5ZHJhdGluZywgcmVtb3ZlT25seSkgewogICAgICBpZiAoaXNVbmRlZih2bm9kZSkpIHsKICAgICAgICBpZiAoaXNEZWYob2xkVm5vZGUpKSB7IGludm9rZURlc3Ryb3lIb29rKG9sZFZub2RlKTsgfQogICAgICAgIHJldHVybgogICAgICB9CgogICAgICB2YXIgaXNJbml0aWFsUGF0Y2ggPSBmYWxzZTsKICAgICAgdmFyIGluc2VydGVkVm5vZGVRdWV1ZSA9IFtdOwoKICAgICAgaWYgKGlzVW5kZWYob2xkVm5vZGUpKSB7CiAgICAgICAgLy8gZW1wdHkgbW91bnQgKGxpa2VseSBhcyBjb21wb25lbnQpLCBjcmVhdGUgbmV3IHJvb3QgZWxlbWVudAogICAgICAgIGlzSW5pdGlhbFBhdGNoID0gdHJ1ZTsKICAgICAgICBjcmVhdGVFbG0odm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGlzUmVhbEVsZW1lbnQgPSBpc0RlZihvbGRWbm9kZS5ub2RlVHlwZSk7CiAgICAgICAgaWYgKCFpc1JlYWxFbGVtZW50ICYmIHNhbWVWbm9kZShvbGRWbm9kZSwgdm5vZGUpKSB7CiAgICAgICAgICAvLyBwYXRjaCBleGlzdGluZyByb290IG5vZGUKICAgICAgICAgIHBhdGNoVm5vZGUob2xkVm5vZGUsIHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG51bGwsIG51bGwsIHJlbW92ZU9ubHkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoaXNSZWFsRWxlbWVudCkgewogICAgICAgICAgICAvLyBtb3VudGluZyB0byBhIHJlYWwgZWxlbWVudAogICAgICAgICAgICAvLyBjaGVjayBpZiB0aGlzIGlzIHNlcnZlci1yZW5kZXJlZCBjb250ZW50IGFuZCBpZiB3ZSBjYW4gcGVyZm9ybQogICAgICAgICAgICAvLyBhIHN1Y2Nlc3NmdWwgaHlkcmF0aW9uLgogICAgICAgICAgICBpZiAob2xkVm5vZGUubm9kZVR5cGUgPT09IDEgJiYgb2xkVm5vZGUuaGFzQXR0cmlidXRlKFNTUl9BVFRSKSkgewogICAgICAgICAgICAgIG9sZFZub2RlLnJlbW92ZUF0dHJpYnV0ZShTU1JfQVRUUik7CiAgICAgICAgICAgICAgaHlkcmF0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaXNUcnVlKGh5ZHJhdGluZykpIHsKICAgICAgICAgICAgICBpZiAoaHlkcmF0ZShvbGRWbm9kZSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSkpIHsKICAgICAgICAgICAgICAgIGludm9rZUluc2VydEhvb2sodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gb2xkVm5vZGUKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgd2FybigKICAgICAgICAgICAgICAgICAgJ1RoZSBjbGllbnQtc2lkZSByZW5kZXJlZCB2aXJ0dWFsIERPTSB0cmVlIGlzIG5vdCBtYXRjaGluZyAnICsKICAgICAgICAgICAgICAgICAgJ3NlcnZlci1yZW5kZXJlZCBjb250ZW50LiBUaGlzIGlzIGxpa2VseSBjYXVzZWQgYnkgaW5jb3JyZWN0ICcgKwogICAgICAgICAgICAgICAgICAnSFRNTCBtYXJrdXAsIGZvciBleGFtcGxlIG5lc3RpbmcgYmxvY2stbGV2ZWwgZWxlbWVudHMgaW5zaWRlICcgKwogICAgICAgICAgICAgICAgICAnPHA+LCBvciBtaXNzaW5nIDx0Ym9keT4uIEJhaWxpbmcgaHlkcmF0aW9uIGFuZCBwZXJmb3JtaW5nICcgKwogICAgICAgICAgICAgICAgICAnZnVsbCBjbGllbnQtc2lkZSByZW5kZXIuJwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZWl0aGVyIG5vdCBzZXJ2ZXItcmVuZGVyZWQsIG9yIGh5ZHJhdGlvbiBmYWlsZWQuCiAgICAgICAgICAgIC8vIGNyZWF0ZSBhbiBlbXB0eSBub2RlIGFuZCByZXBsYWNlIGl0CiAgICAgICAgICAgIG9sZFZub2RlID0gZW1wdHlOb2RlQXQob2xkVm5vZGUpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHJlcGxhY2luZyBleGlzdGluZyBlbGVtZW50CiAgICAgICAgICB2YXIgb2xkRWxtID0gb2xkVm5vZGUuZWxtOwogICAgICAgICAgdmFyIHBhcmVudEVsbSA9IG5vZGVPcHMucGFyZW50Tm9kZShvbGRFbG0pOwoKICAgICAgICAgIC8vIGNyZWF0ZSBuZXcgbm9kZQogICAgICAgICAgY3JlYXRlRWxtKAogICAgICAgICAgICB2bm9kZSwKICAgICAgICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLAogICAgICAgICAgICAvLyBleHRyZW1lbHkgcmFyZSBlZGdlIGNhc2U6IGRvIG5vdCBpbnNlcnQgaWYgb2xkIGVsZW1lbnQgaXMgaW4gYQogICAgICAgICAgICAvLyBsZWF2aW5nIHRyYW5zaXRpb24uIE9ubHkgaGFwcGVucyB3aGVuIGNvbWJpbmluZyB0cmFuc2l0aW9uICsKICAgICAgICAgICAgLy8ga2VlcC1hbGl2ZSArIEhPQ3MuICgjNDU5MCkKICAgICAgICAgICAgb2xkRWxtLl9sZWF2ZUNiID8gbnVsbCA6IHBhcmVudEVsbSwKICAgICAgICAgICAgbm9kZU9wcy5uZXh0U2libGluZyhvbGRFbG0pCiAgICAgICAgICApOwoKICAgICAgICAgIC8vIHVwZGF0ZSBwYXJlbnQgcGxhY2Vob2xkZXIgbm9kZSBlbGVtZW50LCByZWN1cnNpdmVseQogICAgICAgICAgaWYgKGlzRGVmKHZub2RlLnBhcmVudCkpIHsKICAgICAgICAgICAgdmFyIGFuY2VzdG9yID0gdm5vZGUucGFyZW50OwogICAgICAgICAgICB2YXIgcGF0Y2hhYmxlID0gaXNQYXRjaGFibGUodm5vZGUpOwogICAgICAgICAgICB3aGlsZSAoYW5jZXN0b3IpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNicy5kZXN0cm95Lmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICBjYnMuZGVzdHJveVtpXShhbmNlc3Rvcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFuY2VzdG9yLmVsbSA9IHZub2RlLmVsbTsKICAgICAgICAgICAgICBpZiAocGF0Y2hhYmxlKSB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBjYnMuY3JlYXRlLmxlbmd0aDsgKytpJDEpIHsKICAgICAgICAgICAgICAgICAgY2JzLmNyZWF0ZVtpJDFdKGVtcHR5Tm9kZSwgYW5jZXN0b3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gIzY1MTMKICAgICAgICAgICAgICAgIC8vIGludm9rZSBpbnNlcnQgaG9va3MgdGhhdCBtYXkgaGF2ZSBiZWVuIG1lcmdlZCBieSBjcmVhdGUgaG9va3MuCiAgICAgICAgICAgICAgICAvLyBlLmcuIGZvciBkaXJlY3RpdmVzIHRoYXQgdXNlcyB0aGUgImluc2VydGVkIiBob29rLgogICAgICAgICAgICAgICAgdmFyIGluc2VydCA9IGFuY2VzdG9yLmRhdGEuaG9vay5pbnNlcnQ7CiAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0Lm1lcmdlZCkgewogICAgICAgICAgICAgICAgICAvLyBzdGFydCBhdCBpbmRleCAxIHRvIGF2b2lkIHJlLWludm9raW5nIGNvbXBvbmVudCBtb3VudGVkIGhvb2sKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSQyID0gMTsgaSQyIDwgaW5zZXJ0LmZucy5sZW5ndGg7IGkkMisrKSB7CiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0LmZuc1tpJDJdKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVnaXN0ZXJSZWYoYW5jZXN0b3IpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhbmNlc3RvciA9IGFuY2VzdG9yLnBhcmVudDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIGRlc3Ryb3kgb2xkIG5vZGUKICAgICAgICAgIGlmIChpc0RlZihwYXJlbnRFbG0pKSB7CiAgICAgICAgICAgIHJlbW92ZVZub2Rlcyhbb2xkVm5vZGVdLCAwLCAwKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaXNEZWYob2xkVm5vZGUudGFnKSkgewogICAgICAgICAgICBpbnZva2VEZXN0cm95SG9vayhvbGRWbm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpbnZva2VJbnNlcnRIb29rKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIGlzSW5pdGlhbFBhdGNoKTsKICAgICAgcmV0dXJuIHZub2RlLmVsbQogICAgfQogIH0KCiAgLyogICovCgogIHZhciBkaXJlY3RpdmVzID0gewogICAgY3JlYXRlOiB1cGRhdGVEaXJlY3RpdmVzLAogICAgdXBkYXRlOiB1cGRhdGVEaXJlY3RpdmVzLAogICAgZGVzdHJveTogZnVuY3Rpb24gdW5iaW5kRGlyZWN0aXZlcyAodm5vZGUpIHsKICAgICAgdXBkYXRlRGlyZWN0aXZlcyh2bm9kZSwgZW1wdHlOb2RlKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiB1cGRhdGVEaXJlY3RpdmVzIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgIGlmIChvbGRWbm9kZS5kYXRhLmRpcmVjdGl2ZXMgfHwgdm5vZGUuZGF0YS5kaXJlY3RpdmVzKSB7CiAgICAgIF91cGRhdGUob2xkVm5vZGUsIHZub2RlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIF91cGRhdGUgKG9sZFZub2RlLCB2bm9kZSkgewogICAgdmFyIGlzQ3JlYXRlID0gb2xkVm5vZGUgPT09IGVtcHR5Tm9kZTsKICAgIHZhciBpc0Rlc3Ryb3kgPSB2bm9kZSA9PT0gZW1wdHlOb2RlOwogICAgdmFyIG9sZERpcnMgPSBub3JtYWxpemVEaXJlY3RpdmVzJDEob2xkVm5vZGUuZGF0YS5kaXJlY3RpdmVzLCBvbGRWbm9kZS5jb250ZXh0KTsKICAgIHZhciBuZXdEaXJzID0gbm9ybWFsaXplRGlyZWN0aXZlcyQxKHZub2RlLmRhdGEuZGlyZWN0aXZlcywgdm5vZGUuY29udGV4dCk7CgogICAgdmFyIGRpcnNXaXRoSW5zZXJ0ID0gW107CiAgICB2YXIgZGlyc1dpdGhQb3N0cGF0Y2ggPSBbXTsKCiAgICB2YXIga2V5LCBvbGREaXIsIGRpcjsKICAgIGZvciAoa2V5IGluIG5ld0RpcnMpIHsKICAgICAgb2xkRGlyID0gb2xkRGlyc1trZXldOwogICAgICBkaXIgPSBuZXdEaXJzW2tleV07CiAgICAgIGlmICghb2xkRGlyKSB7CiAgICAgICAgLy8gbmV3IGRpcmVjdGl2ZSwgYmluZAogICAgICAgIGNhbGxIb29rJDEoZGlyLCAnYmluZCcsIHZub2RlLCBvbGRWbm9kZSk7CiAgICAgICAgaWYgKGRpci5kZWYgJiYgZGlyLmRlZi5pbnNlcnRlZCkgewogICAgICAgICAgZGlyc1dpdGhJbnNlcnQucHVzaChkaXIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBleGlzdGluZyBkaXJlY3RpdmUsIHVwZGF0ZQogICAgICAgIGRpci5vbGRWYWx1ZSA9IG9sZERpci52YWx1ZTsKICAgICAgICBkaXIub2xkQXJnID0gb2xkRGlyLmFyZzsKICAgICAgICBjYWxsSG9vayQxKGRpciwgJ3VwZGF0ZScsIHZub2RlLCBvbGRWbm9kZSk7CiAgICAgICAgaWYgKGRpci5kZWYgJiYgZGlyLmRlZi5jb21wb25lbnRVcGRhdGVkKSB7CiAgICAgICAgICBkaXJzV2l0aFBvc3RwYXRjaC5wdXNoKGRpcik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGRpcnNXaXRoSW5zZXJ0Lmxlbmd0aCkgewogICAgICB2YXIgY2FsbEluc2VydCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRpcnNXaXRoSW5zZXJ0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjYWxsSG9vayQxKGRpcnNXaXRoSW5zZXJ0W2ldLCAnaW5zZXJ0ZWQnLCB2bm9kZSwgb2xkVm5vZGUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgaWYgKGlzQ3JlYXRlKSB7CiAgICAgICAgbWVyZ2VWTm9kZUhvb2sodm5vZGUsICdpbnNlcnQnLCBjYWxsSW5zZXJ0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsSW5zZXJ0KCk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZGlyc1dpdGhQb3N0cGF0Y2gubGVuZ3RoKSB7CiAgICAgIG1lcmdlVk5vZGVIb29rKHZub2RlLCAncG9zdHBhdGNoJywgZnVuY3Rpb24gKCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGlyc1dpdGhQb3N0cGF0Y2gubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNhbGxIb29rJDEoZGlyc1dpdGhQb3N0cGF0Y2hbaV0sICdjb21wb25lbnRVcGRhdGVkJywgdm5vZGUsIG9sZFZub2RlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGlmICghaXNDcmVhdGUpIHsKICAgICAgZm9yIChrZXkgaW4gb2xkRGlycykgewogICAgICAgIGlmICghbmV3RGlyc1trZXldKSB7CiAgICAgICAgICAvLyBubyBsb25nZXIgcHJlc2VudCwgdW5iaW5kCiAgICAgICAgICBjYWxsSG9vayQxKG9sZERpcnNba2V5XSwgJ3VuYmluZCcsIG9sZFZub2RlLCBvbGRWbm9kZSwgaXNEZXN0cm95KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBlbXB0eU1vZGlmaWVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZURpcmVjdGl2ZXMkMSAoCiAgICBkaXJzLAogICAgdm0KICApIHsKICAgIHZhciByZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKCFkaXJzKSB7CiAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICByZXR1cm4gcmVzCiAgICB9CiAgICB2YXIgaSwgZGlyOwogICAgZm9yIChpID0gMDsgaSA8IGRpcnMubGVuZ3RoOyBpKyspIHsKICAgICAgZGlyID0gZGlyc1tpXTsKICAgICAgaWYgKCFkaXIubW9kaWZpZXJzKSB7CiAgICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgICAgZGlyLm1vZGlmaWVycyA9IGVtcHR5TW9kaWZpZXJzOwogICAgICB9CiAgICAgIHJlc1tnZXRSYXdEaXJOYW1lKGRpcildID0gZGlyOwogICAgICBkaXIuZGVmID0gcmVzb2x2ZUFzc2V0KHZtLiRvcHRpb25zLCAnZGlyZWN0aXZlcycsIGRpci5uYW1lLCB0cnVlKTsKICAgIH0KICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gZ2V0UmF3RGlyTmFtZSAoZGlyKSB7CiAgICByZXR1cm4gZGlyLnJhd05hbWUgfHwgKChkaXIubmFtZSkgKyAiLiIgKyAoT2JqZWN0LmtleXMoZGlyLm1vZGlmaWVycyB8fCB7fSkuam9pbignLicpKSkKICB9CgogIGZ1bmN0aW9uIGNhbGxIb29rJDEgKGRpciwgaG9vaywgdm5vZGUsIG9sZFZub2RlLCBpc0Rlc3Ryb3kpIHsKICAgIHZhciBmbiA9IGRpci5kZWYgJiYgZGlyLmRlZltob29rXTsKICAgIGlmIChmbikgewogICAgICB0cnkgewogICAgICAgIGZuKHZub2RlLmVsbSwgZGlyLCB2bm9kZSwgb2xkVm5vZGUsIGlzRGVzdHJveSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBoYW5kbGVFcnJvcihlLCB2bm9kZS5jb250ZXh0LCAoImRpcmVjdGl2ZSAiICsgKGRpci5uYW1lKSArICIgIiArIGhvb2sgKyAiIGhvb2siKSk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBiYXNlTW9kdWxlcyA9IFsKICAgIHJlZiwKICAgIGRpcmVjdGl2ZXMKICBdOwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gdXBkYXRlQXR0cnMgKG9sZFZub2RlLCB2bm9kZSkgewogICAgdmFyIG9wdHMgPSB2bm9kZS5jb21wb25lbnRPcHRpb25zOwogICAgaWYgKGlzRGVmKG9wdHMpICYmIG9wdHMuQ3Rvci5vcHRpb25zLmluaGVyaXRBdHRycyA9PT0gZmFsc2UpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAoaXNVbmRlZihvbGRWbm9kZS5kYXRhLmF0dHJzKSAmJiBpc1VuZGVmKHZub2RlLmRhdGEuYXR0cnMpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIGtleSwgY3VyLCBvbGQ7CiAgICB2YXIgZWxtID0gdm5vZGUuZWxtOwogICAgdmFyIG9sZEF0dHJzID0gb2xkVm5vZGUuZGF0YS5hdHRycyB8fCB7fTsKICAgIHZhciBhdHRycyA9IHZub2RlLmRhdGEuYXR0cnMgfHwge307CiAgICAvLyBjbG9uZSBvYnNlcnZlZCBvYmplY3RzLCBhcyB0aGUgdXNlciBwcm9iYWJseSB3YW50cyB0byBtdXRhdGUgaXQKICAgIGlmIChpc0RlZihhdHRycy5fX29iX18pKSB7CiAgICAgIGF0dHJzID0gdm5vZGUuZGF0YS5hdHRycyA9IGV4dGVuZCh7fSwgYXR0cnMpOwogICAgfQoKICAgIGZvciAoa2V5IGluIGF0dHJzKSB7CiAgICAgIGN1ciA9IGF0dHJzW2tleV07CiAgICAgIG9sZCA9IG9sZEF0dHJzW2tleV07CiAgICAgIGlmIChvbGQgIT09IGN1cikgewogICAgICAgIHNldEF0dHIoZWxtLCBrZXksIGN1cik7CiAgICAgIH0KICAgIH0KICAgIC8vICM0MzkxOiBpbiBJRTksIHNldHRpbmcgdHlwZSBjYW4gcmVzZXQgdmFsdWUgZm9yIGlucHV0W3R5cGU9cmFkaW9dCiAgICAvLyAjNjY2NjogSUUvRWRnZSBmb3JjZXMgcHJvZ3Jlc3MgdmFsdWUgZG93biB0byAxIGJlZm9yZSBzZXR0aW5nIGEgbWF4CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICgoaXNJRSB8fCBpc0VkZ2UpICYmIGF0dHJzLnZhbHVlICE9PSBvbGRBdHRycy52YWx1ZSkgewogICAgICBzZXRBdHRyKGVsbSwgJ3ZhbHVlJywgYXR0cnMudmFsdWUpOwogICAgfQogICAgZm9yIChrZXkgaW4gb2xkQXR0cnMpIHsKICAgICAgaWYgKGlzVW5kZWYoYXR0cnNba2V5XSkpIHsKICAgICAgICBpZiAoaXNYbGluayhrZXkpKSB7CiAgICAgICAgICBlbG0ucmVtb3ZlQXR0cmlidXRlTlMoeGxpbmtOUywgZ2V0WGxpbmtQcm9wKGtleSkpOwogICAgICAgIH0gZWxzZSBpZiAoIWlzRW51bWVyYXRlZEF0dHIoa2V5KSkgewogICAgICAgICAgZWxtLnJlbW92ZUF0dHJpYnV0ZShrZXkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0QXR0ciAoZWwsIGtleSwgdmFsdWUpIHsKICAgIGlmIChlbC50YWdOYW1lLmluZGV4T2YoJy0nKSA+IC0xKSB7CiAgICAgIGJhc2VTZXRBdHRyKGVsLCBrZXksIHZhbHVlKTsKICAgIH0gZWxzZSBpZiAoaXNCb29sZWFuQXR0cihrZXkpKSB7CiAgICAgIC8vIHNldCBhdHRyaWJ1dGUgZm9yIGJsYW5rIHZhbHVlCiAgICAgIC8vIGUuZy4gPG9wdGlvbiBkaXNhYmxlZD5TZWxlY3Qgb25lPC9vcHRpb24+CiAgICAgIGlmIChpc0ZhbHN5QXR0clZhbHVlKHZhbHVlKSkgewogICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZShrZXkpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHRlY2huaWNhbGx5IGFsbG93ZnVsbHNjcmVlbiBpcyBhIGJvb2xlYW4gYXR0cmlidXRlIGZvciA8aWZyYW1lPiwKICAgICAgICAvLyBidXQgRmxhc2ggZXhwZWN0cyBhIHZhbHVlIG9mICJ0cnVlIiB3aGVuIHVzZWQgb24gPGVtYmVkPiB0YWcKICAgICAgICB2YWx1ZSA9IGtleSA9PT0gJ2FsbG93ZnVsbHNjcmVlbicgJiYgZWwudGFnTmFtZSA9PT0gJ0VNQkVEJwogICAgICAgICAgPyAndHJ1ZScKICAgICAgICAgIDoga2V5OwogICAgICAgIGVsLnNldEF0dHJpYnV0ZShrZXksIHZhbHVlKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChpc0VudW1lcmF0ZWRBdHRyKGtleSkpIHsKICAgICAgZWwuc2V0QXR0cmlidXRlKGtleSwgY29udmVydEVudW1lcmF0ZWRWYWx1ZShrZXksIHZhbHVlKSk7CiAgICB9IGVsc2UgaWYgKGlzWGxpbmsoa2V5KSkgewogICAgICBpZiAoaXNGYWxzeUF0dHJWYWx1ZSh2YWx1ZSkpIHsKICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGVOUyh4bGlua05TLCBnZXRYbGlua1Byb3Aoa2V5KSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlTlMoeGxpbmtOUywga2V5LCB2YWx1ZSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGJhc2VTZXRBdHRyKGVsLCBrZXksIHZhbHVlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGJhc2VTZXRBdHRyIChlbCwga2V5LCB2YWx1ZSkgewogICAgaWYgKGlzRmFsc3lBdHRyVmFsdWUodmFsdWUpKSB7CiAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZShrZXkpOwogICAgfSBlbHNlIHsKICAgICAgLy8gIzcxMzg6IElFMTAgJiAxMSBmaXJlcyBpbnB1dCBldmVudCB3aGVuIHNldHRpbmcgcGxhY2Vob2xkZXIgb24KICAgICAgLy8gPHRleHRhcmVhPi4uLiBibG9jayB0aGUgZmlyc3QgaW5wdXQgZXZlbnQgYW5kIHJlbW92ZSB0aGUgYmxvY2tlcgogICAgICAvLyBpbW1lZGlhdGVseS4KICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmICgKICAgICAgICBpc0lFICYmICFpc0lFOSAmJgogICAgICAgIGVsLnRhZ05hbWUgPT09ICdURVhUQVJFQScgJiYKICAgICAgICBrZXkgPT09ICdwbGFjZWhvbGRlcicgJiYgdmFsdWUgIT09ICcnICYmICFlbC5fX2llcGgKICAgICAgKSB7CiAgICAgICAgdmFyIGJsb2NrZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2lucHV0JywgYmxvY2tlcik7CiAgICAgICAgfTsKICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGJsb2NrZXIpOwogICAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICAgIGVsLl9faWVwaCA9IHRydWU7IC8qIElFIHBsYWNlaG9sZGVyIHBhdGNoZWQgKi8KICAgICAgfQogICAgICBlbC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7CiAgICB9CiAgfQoKICB2YXIgYXR0cnMgPSB7CiAgICBjcmVhdGU6IHVwZGF0ZUF0dHJzLAogICAgdXBkYXRlOiB1cGRhdGVBdHRycwogIH07CgogIC8qICAqLwoKICBmdW5jdGlvbiB1cGRhdGVDbGFzcyAob2xkVm5vZGUsIHZub2RlKSB7CiAgICB2YXIgZWwgPSB2bm9kZS5lbG07CiAgICB2YXIgZGF0YSA9IHZub2RlLmRhdGE7CiAgICB2YXIgb2xkRGF0YSA9IG9sZFZub2RlLmRhdGE7CiAgICBpZiAoCiAgICAgIGlzVW5kZWYoZGF0YS5zdGF0aWNDbGFzcykgJiYKICAgICAgaXNVbmRlZihkYXRhLmNsYXNzKSAmJiAoCiAgICAgICAgaXNVbmRlZihvbGREYXRhKSB8fCAoCiAgICAgICAgICBpc1VuZGVmKG9sZERhdGEuc3RhdGljQ2xhc3MpICYmCiAgICAgICAgICBpc1VuZGVmKG9sZERhdGEuY2xhc3MpCiAgICAgICAgKQogICAgICApCiAgICApIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgdmFyIGNscyA9IGdlbkNsYXNzRm9yVm5vZGUodm5vZGUpOwoKICAgIC8vIGhhbmRsZSB0cmFuc2l0aW9uIGNsYXNzZXMKICAgIHZhciB0cmFuc2l0aW9uQ2xhc3MgPSBlbC5fdHJhbnNpdGlvbkNsYXNzZXM7CiAgICBpZiAoaXNEZWYodHJhbnNpdGlvbkNsYXNzKSkgewogICAgICBjbHMgPSBjb25jYXQoY2xzLCBzdHJpbmdpZnlDbGFzcyh0cmFuc2l0aW9uQ2xhc3MpKTsKICAgIH0KCiAgICAvLyBzZXQgdGhlIGNsYXNzCiAgICBpZiAoY2xzICE9PSBlbC5fcHJldkNsYXNzKSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBjbHMpOwogICAgICBlbC5fcHJldkNsYXNzID0gY2xzOwogICAgfQogIH0KCiAgdmFyIGtsYXNzID0gewogICAgY3JlYXRlOiB1cGRhdGVDbGFzcywKICAgIHVwZGF0ZTogdXBkYXRlQ2xhc3MKICB9OwoKICAvKiAgKi8KCiAgdmFyIHZhbGlkRGl2aXNpb25DaGFyUkUgPSAvW1x3KS4rXC1fJFxdXS87CgogIGZ1bmN0aW9uIHBhcnNlRmlsdGVycyAoZXhwKSB7CiAgICB2YXIgaW5TaW5nbGUgPSBmYWxzZTsKICAgIHZhciBpbkRvdWJsZSA9IGZhbHNlOwogICAgdmFyIGluVGVtcGxhdGVTdHJpbmcgPSBmYWxzZTsKICAgIHZhciBpblJlZ2V4ID0gZmFsc2U7CiAgICB2YXIgY3VybHkgPSAwOwogICAgdmFyIHNxdWFyZSA9IDA7CiAgICB2YXIgcGFyZW4gPSAwOwogICAgdmFyIGxhc3RGaWx0ZXJJbmRleCA9IDA7CiAgICB2YXIgYywgcHJldiwgaSwgZXhwcmVzc2lvbiwgZmlsdGVyczsKCiAgICBmb3IgKGkgPSAwOyBpIDwgZXhwLmxlbmd0aDsgaSsrKSB7CiAgICAgIHByZXYgPSBjOwogICAgICBjID0gZXhwLmNoYXJDb2RlQXQoaSk7CiAgICAgIGlmIChpblNpbmdsZSkgewogICAgICAgIGlmIChjID09PSAweDI3ICYmIHByZXYgIT09IDB4NUMpIHsgaW5TaW5nbGUgPSBmYWxzZTsgfQogICAgICB9IGVsc2UgaWYgKGluRG91YmxlKSB7CiAgICAgICAgaWYgKGMgPT09IDB4MjIgJiYgcHJldiAhPT0gMHg1QykgeyBpbkRvdWJsZSA9IGZhbHNlOyB9CiAgICAgIH0gZWxzZSBpZiAoaW5UZW1wbGF0ZVN0cmluZykgewogICAgICAgIGlmIChjID09PSAweDYwICYmIHByZXYgIT09IDB4NUMpIHsgaW5UZW1wbGF0ZVN0cmluZyA9IGZhbHNlOyB9CiAgICAgIH0gZWxzZSBpZiAoaW5SZWdleCkgewogICAgICAgIGlmIChjID09PSAweDJmICYmIHByZXYgIT09IDB4NUMpIHsgaW5SZWdleCA9IGZhbHNlOyB9CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgYyA9PT0gMHg3QyAmJiAvLyBwaXBlCiAgICAgICAgZXhwLmNoYXJDb2RlQXQoaSArIDEpICE9PSAweDdDICYmCiAgICAgICAgZXhwLmNoYXJDb2RlQXQoaSAtIDEpICE9PSAweDdDICYmCiAgICAgICAgIWN1cmx5ICYmICFzcXVhcmUgJiYgIXBhcmVuCiAgICAgICkgewogICAgICAgIGlmIChleHByZXNzaW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIGZpcnN0IGZpbHRlciwgZW5kIG9mIGV4cHJlc3Npb24KICAgICAgICAgIGxhc3RGaWx0ZXJJbmRleCA9IGkgKyAxOwogICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cC5zbGljZSgwLCBpKS50cmltKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHB1c2hGaWx0ZXIoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICBjYXNlIDB4MjI6IGluRG91YmxlID0gdHJ1ZTsgYnJlYWsgICAgICAgICAvLyAiCiAgICAgICAgICBjYXNlIDB4Mjc6IGluU2luZ2xlID0gdHJ1ZTsgYnJlYWsgICAgICAgICAvLyAnCiAgICAgICAgICBjYXNlIDB4NjA6IGluVGVtcGxhdGVTdHJpbmcgPSB0cnVlOyBicmVhayAvLyBgCiAgICAgICAgICBjYXNlIDB4Mjg6IHBhcmVuKys7IGJyZWFrICAgICAgICAgICAgICAgICAvLyAoCiAgICAgICAgICBjYXNlIDB4Mjk6IHBhcmVuLS07IGJyZWFrICAgICAgICAgICAgICAgICAvLyApCiAgICAgICAgICBjYXNlIDB4NUI6IHNxdWFyZSsrOyBicmVhayAgICAgICAgICAgICAgICAvLyBbCiAgICAgICAgICBjYXNlIDB4NUQ6IHNxdWFyZS0tOyBicmVhayAgICAgICAgICAgICAgICAvLyBdCiAgICAgICAgICBjYXNlIDB4N0I6IGN1cmx5Kys7IGJyZWFrICAgICAgICAgICAgICAgICAvLyB7CiAgICAgICAgICBjYXNlIDB4N0Q6IGN1cmx5LS07IGJyZWFrICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgfQogICAgICAgIGlmIChjID09PSAweDJmKSB7IC8vIC8KICAgICAgICAgIHZhciBqID0gaSAtIDE7CiAgICAgICAgICB2YXIgcCA9ICh2b2lkIDApOwogICAgICAgICAgLy8gZmluZCBmaXJzdCBub24td2hpdGVzcGFjZSBwcmV2IGNoYXIKICAgICAgICAgIGZvciAoOyBqID49IDA7IGotLSkgewogICAgICAgICAgICBwID0gZXhwLmNoYXJBdChqKTsKICAgICAgICAgICAgaWYgKHAgIT09ICcgJykgeyBicmVhayB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXAgfHwgIXZhbGlkRGl2aXNpb25DaGFyUkUudGVzdChwKSkgewogICAgICAgICAgICBpblJlZ2V4ID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZXhwcmVzc2lvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGV4cHJlc3Npb24gPSBleHAuc2xpY2UoMCwgaSkudHJpbSgpOwogICAgfSBlbHNlIGlmIChsYXN0RmlsdGVySW5kZXggIT09IDApIHsKICAgICAgcHVzaEZpbHRlcigpOwogICAgfQoKICAgIGZ1bmN0aW9uIHB1c2hGaWx0ZXIgKCkgewogICAgICAoZmlsdGVycyB8fCAoZmlsdGVycyA9IFtdKSkucHVzaChleHAuc2xpY2UobGFzdEZpbHRlckluZGV4LCBpKS50cmltKCkpOwogICAgICBsYXN0RmlsdGVySW5kZXggPSBpICsgMTsKICAgIH0KCiAgICBpZiAoZmlsdGVycykgewogICAgICBmb3IgKGkgPSAwOyBpIDwgZmlsdGVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGV4cHJlc3Npb24gPSB3cmFwRmlsdGVyKGV4cHJlc3Npb24sIGZpbHRlcnNbaV0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGV4cHJlc3Npb24KICB9CgogIGZ1bmN0aW9uIHdyYXBGaWx0ZXIgKGV4cCwgZmlsdGVyKSB7CiAgICB2YXIgaSA9IGZpbHRlci5pbmRleE9mKCcoJyk7CiAgICBpZiAoaSA8IDApIHsKICAgICAgLy8gX2Y6IHJlc29sdmVGaWx0ZXIKICAgICAgcmV0dXJuICgiX2YoXCIiICsgZmlsdGVyICsgIlwiKSgiICsgZXhwICsgIikiKQogICAgfSBlbHNlIHsKICAgICAgdmFyIG5hbWUgPSBmaWx0ZXIuc2xpY2UoMCwgaSk7CiAgICAgIHZhciBhcmdzID0gZmlsdGVyLnNsaWNlKGkgKyAxKTsKICAgICAgcmV0dXJuICgiX2YoXCIiICsgbmFtZSArICJcIikoIiArIGV4cCArIChhcmdzICE9PSAnKScgPyAnLCcgKyBhcmdzIDogYXJncykpCiAgICB9CiAgfQoKICAvKiAgKi8KCgoKICAvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtdmFycyAqLwogIGZ1bmN0aW9uIGJhc2VXYXJuIChtc2csIHJhbmdlKSB7CiAgICBjb25zb2xlLmVycm9yKCgiW1Z1ZSBjb21waWxlcl06ICIgKyBtc2cpKTsKICB9CiAgLyogZXNsaW50LWVuYWJsZSBuby11bnVzZWQtdmFycyAqLwoKICBmdW5jdGlvbiBwbHVja01vZHVsZUZ1bmN0aW9uICgKICAgIG1vZHVsZXMsCiAgICBrZXkKICApIHsKICAgIHJldHVybiBtb2R1bGVzCiAgICAgID8gbW9kdWxlcy5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG1ba2V5XTsgfSkuZmlsdGVyKGZ1bmN0aW9uIChfKSB7IHJldHVybiBfOyB9KQogICAgICA6IFtdCiAgfQoKICBmdW5jdGlvbiBhZGRQcm9wIChlbCwgbmFtZSwgdmFsdWUsIHJhbmdlLCBkeW5hbWljKSB7CiAgICAoZWwucHJvcHMgfHwgKGVsLnByb3BzID0gW10pKS5wdXNoKHJhbmdlU2V0SXRlbSh7IG5hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZSwgZHluYW1pYzogZHluYW1pYyB9LCByYW5nZSkpOwogICAgZWwucGxhaW4gPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIGFkZEF0dHIgKGVsLCBuYW1lLCB2YWx1ZSwgcmFuZ2UsIGR5bmFtaWMpIHsKICAgIHZhciBhdHRycyA9IGR5bmFtaWMKICAgICAgPyAoZWwuZHluYW1pY0F0dHJzIHx8IChlbC5keW5hbWljQXR0cnMgPSBbXSkpCiAgICAgIDogKGVsLmF0dHJzIHx8IChlbC5hdHRycyA9IFtdKSk7CiAgICBhdHRycy5wdXNoKHJhbmdlU2V0SXRlbSh7IG5hbWU6IG5hbWUsIHZhbHVlOiB2YWx1ZSwgZHluYW1pYzogZHluYW1pYyB9LCByYW5nZSkpOwogICAgZWwucGxhaW4gPSBmYWxzZTsKICB9CgogIC8vIGFkZCBhIHJhdyBhdHRyICh1c2UgdGhpcyBpbiBwcmVUcmFuc2Zvcm1zKQogIGZ1bmN0aW9uIGFkZFJhd0F0dHIgKGVsLCBuYW1lLCB2YWx1ZSwgcmFuZ2UpIHsKICAgIGVsLmF0dHJzTWFwW25hbWVdID0gdmFsdWU7CiAgICBlbC5hdHRyc0xpc3QucHVzaChyYW5nZVNldEl0ZW0oeyBuYW1lOiBuYW1lLCB2YWx1ZTogdmFsdWUgfSwgcmFuZ2UpKTsKICB9CgogIGZ1bmN0aW9uIGFkZERpcmVjdGl2ZSAoCiAgICBlbCwKICAgIG5hbWUsCiAgICByYXdOYW1lLAogICAgdmFsdWUsCiAgICBhcmcsCiAgICBpc0R5bmFtaWNBcmcsCiAgICBtb2RpZmllcnMsCiAgICByYW5nZQogICkgewogICAgKGVsLmRpcmVjdGl2ZXMgfHwgKGVsLmRpcmVjdGl2ZXMgPSBbXSkpLnB1c2gocmFuZ2VTZXRJdGVtKHsKICAgICAgbmFtZTogbmFtZSwKICAgICAgcmF3TmFtZTogcmF3TmFtZSwKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBhcmc6IGFyZywKICAgICAgaXNEeW5hbWljQXJnOiBpc0R5bmFtaWNBcmcsCiAgICAgIG1vZGlmaWVyczogbW9kaWZpZXJzCiAgICB9LCByYW5nZSkpOwogICAgZWwucGxhaW4gPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHByZXBlbmRNb2RpZmllck1hcmtlciAoc3ltYm9sLCBuYW1lLCBkeW5hbWljKSB7CiAgICByZXR1cm4gZHluYW1pYwogICAgICA/ICgiX3AoIiArIG5hbWUgKyAiLFwiIiArIHN5bWJvbCArICJcIikiKQogICAgICA6IHN5bWJvbCArIG5hbWUgLy8gbWFyayB0aGUgZXZlbnQgYXMgY2FwdHVyZWQKICB9CgogIGZ1bmN0aW9uIGFkZEhhbmRsZXIgKAogICAgZWwsCiAgICBuYW1lLAogICAgdmFsdWUsCiAgICBtb2RpZmllcnMsCiAgICBpbXBvcnRhbnQsCiAgICB3YXJuLAogICAgcmFuZ2UsCiAgICBkeW5hbWljCiAgKSB7CiAgICBtb2RpZmllcnMgPSBtb2RpZmllcnMgfHwgZW1wdHlPYmplY3Q7CiAgICAvLyB3YXJuIHByZXZlbnQgYW5kIHBhc3NpdmUgbW9kaWZpZXIKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKAogICAgICB3YXJuICYmCiAgICAgIG1vZGlmaWVycy5wcmV2ZW50ICYmIG1vZGlmaWVycy5wYXNzaXZlCiAgICApIHsKICAgICAgd2FybigKICAgICAgICAncGFzc2l2ZSBhbmQgcHJldmVudCBjYW5cJ3QgYmUgdXNlZCB0b2dldGhlci4gJyArCiAgICAgICAgJ1Bhc3NpdmUgaGFuZGxlciBjYW5cJ3QgcHJldmVudCBkZWZhdWx0IGV2ZW50LicsCiAgICAgICAgcmFuZ2UKICAgICAgKTsKICAgIH0KCiAgICAvLyBub3JtYWxpemUgY2xpY2sucmlnaHQgYW5kIGNsaWNrLm1pZGRsZSBzaW5jZSB0aGV5IGRvbid0IGFjdHVhbGx5IGZpcmUKICAgIC8vIHRoaXMgaXMgdGVjaG5pY2FsbHkgYnJvd3Nlci1zcGVjaWZpYywgYnV0IGF0IGxlYXN0IGZvciBub3cgYnJvd3NlcnMgYXJlCiAgICAvLyB0aGUgb25seSB0YXJnZXQgZW52cyB0aGF0IGhhdmUgcmlnaHQvbWlkZGxlIGNsaWNrcy4KICAgIGlmIChtb2RpZmllcnMucmlnaHQpIHsKICAgICAgaWYgKGR5bmFtaWMpIHsKICAgICAgICBuYW1lID0gIigiICsgbmFtZSArICIpPT09J2NsaWNrJz8nY29udGV4dG1lbnUnOigiICsgbmFtZSArICIpIjsKICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAnY2xpY2snKSB7CiAgICAgICAgbmFtZSA9ICdjb250ZXh0bWVudSc7CiAgICAgICAgZGVsZXRlIG1vZGlmaWVycy5yaWdodDsKICAgICAgfQogICAgfSBlbHNlIGlmIChtb2RpZmllcnMubWlkZGxlKSB7CiAgICAgIGlmIChkeW5hbWljKSB7CiAgICAgICAgbmFtZSA9ICIoIiArIG5hbWUgKyAiKT09PSdjbGljayc/J21vdXNldXAnOigiICsgbmFtZSArICIpIjsKICAgICAgfSBlbHNlIGlmIChuYW1lID09PSAnY2xpY2snKSB7CiAgICAgICAgbmFtZSA9ICdtb3VzZXVwJzsKICAgICAgfQogICAgfQoKICAgIC8vIGNoZWNrIGNhcHR1cmUgbW9kaWZpZXIKICAgIGlmIChtb2RpZmllcnMuY2FwdHVyZSkgewogICAgICBkZWxldGUgbW9kaWZpZXJzLmNhcHR1cmU7CiAgICAgIG5hbWUgPSBwcmVwZW5kTW9kaWZpZXJNYXJrZXIoJyEnLCBuYW1lLCBkeW5hbWljKTsKICAgIH0KICAgIGlmIChtb2RpZmllcnMub25jZSkgewogICAgICBkZWxldGUgbW9kaWZpZXJzLm9uY2U7CiAgICAgIG5hbWUgPSBwcmVwZW5kTW9kaWZpZXJNYXJrZXIoJ34nLCBuYW1lLCBkeW5hbWljKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKG1vZGlmaWVycy5wYXNzaXZlKSB7CiAgICAgIGRlbGV0ZSBtb2RpZmllcnMucGFzc2l2ZTsKICAgICAgbmFtZSA9IHByZXBlbmRNb2RpZmllck1hcmtlcignJicsIG5hbWUsIGR5bmFtaWMpOwogICAgfQoKICAgIHZhciBldmVudHM7CiAgICBpZiAobW9kaWZpZXJzLm5hdGl2ZSkgewogICAgICBkZWxldGUgbW9kaWZpZXJzLm5hdGl2ZTsKICAgICAgZXZlbnRzID0gZWwubmF0aXZlRXZlbnRzIHx8IChlbC5uYXRpdmVFdmVudHMgPSB7fSk7CiAgICB9IGVsc2UgewogICAgICBldmVudHMgPSBlbC5ldmVudHMgfHwgKGVsLmV2ZW50cyA9IHt9KTsKICAgIH0KCiAgICB2YXIgbmV3SGFuZGxlciA9IHJhbmdlU2V0SXRlbSh7IHZhbHVlOiB2YWx1ZS50cmltKCksIGR5bmFtaWM6IGR5bmFtaWMgfSwgcmFuZ2UpOwogICAgaWYgKG1vZGlmaWVycyAhPT0gZW1wdHlPYmplY3QpIHsKICAgICAgbmV3SGFuZGxlci5tb2RpZmllcnMgPSBtb2RpZmllcnM7CiAgICB9CgogICAgdmFyIGhhbmRsZXJzID0gZXZlbnRzW25hbWVdOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoQXJyYXkuaXNBcnJheShoYW5kbGVycykpIHsKICAgICAgaW1wb3J0YW50ID8gaGFuZGxlcnMudW5zaGlmdChuZXdIYW5kbGVyKSA6IGhhbmRsZXJzLnB1c2gobmV3SGFuZGxlcik7CiAgICB9IGVsc2UgaWYgKGhhbmRsZXJzKSB7CiAgICAgIGV2ZW50c1tuYW1lXSA9IGltcG9ydGFudCA/IFtuZXdIYW5kbGVyLCBoYW5kbGVyc10gOiBbaGFuZGxlcnMsIG5ld0hhbmRsZXJdOwogICAgfSBlbHNlIHsKICAgICAgZXZlbnRzW25hbWVdID0gbmV3SGFuZGxlcjsKICAgIH0KCiAgICBlbC5wbGFpbiA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gZ2V0UmF3QmluZGluZ0F0dHIgKAogICAgZWwsCiAgICBuYW1lCiAgKSB7CiAgICByZXR1cm4gZWwucmF3QXR0cnNNYXBbJzonICsgbmFtZV0gfHwKICAgICAgZWwucmF3QXR0cnNNYXBbJ3YtYmluZDonICsgbmFtZV0gfHwKICAgICAgZWwucmF3QXR0cnNNYXBbbmFtZV0KICB9CgogIGZ1bmN0aW9uIGdldEJpbmRpbmdBdHRyICgKICAgIGVsLAogICAgbmFtZSwKICAgIGdldFN0YXRpYwogICkgewogICAgdmFyIGR5bmFtaWNWYWx1ZSA9CiAgICAgIGdldEFuZFJlbW92ZUF0dHIoZWwsICc6JyArIG5hbWUpIHx8CiAgICAgIGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LWJpbmQ6JyArIG5hbWUpOwogICAgaWYgKGR5bmFtaWNWYWx1ZSAhPSBudWxsKSB7CiAgICAgIHJldHVybiBwYXJzZUZpbHRlcnMoZHluYW1pY1ZhbHVlKQogICAgfSBlbHNlIGlmIChnZXRTdGF0aWMgIT09IGZhbHNlKSB7CiAgICAgIHZhciBzdGF0aWNWYWx1ZSA9IGdldEFuZFJlbW92ZUF0dHIoZWwsIG5hbWUpOwogICAgICBpZiAoc3RhdGljVmFsdWUgIT0gbnVsbCkgewogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShzdGF0aWNWYWx1ZSkKICAgICAgfQogICAgfQogIH0KCiAgLy8gbm90ZTogdGhpcyBvbmx5IHJlbW92ZXMgdGhlIGF0dHIgZnJvbSB0aGUgQXJyYXkgKGF0dHJzTGlzdCkgc28gdGhhdCBpdAogIC8vIGRvZXNuJ3QgZ2V0IHByb2Nlc3NlZCBieSBwcm9jZXNzQXR0cnMuCiAgLy8gQnkgZGVmYXVsdCBpdCBkb2VzIE5PVCByZW1vdmUgaXQgZnJvbSB0aGUgbWFwIChhdHRyc01hcCkgYmVjYXVzZSB0aGUgbWFwIGlzCiAgLy8gbmVlZGVkIGR1cmluZyBjb2RlZ2VuLgogIGZ1bmN0aW9uIGdldEFuZFJlbW92ZUF0dHIgKAogICAgZWwsCiAgICBuYW1lLAogICAgcmVtb3ZlRnJvbU1hcAogICkgewogICAgdmFyIHZhbDsKICAgIGlmICgodmFsID0gZWwuYXR0cnNNYXBbbmFtZV0pICE9IG51bGwpIHsKICAgICAgdmFyIGxpc3QgPSBlbC5hdHRyc0xpc3Q7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBpZiAobGlzdFtpXS5uYW1lID09PSBuYW1lKSB7CiAgICAgICAgICBsaXN0LnNwbGljZShpLCAxKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAocmVtb3ZlRnJvbU1hcCkgewogICAgICBkZWxldGUgZWwuYXR0cnNNYXBbbmFtZV07CiAgICB9CiAgICByZXR1cm4gdmFsCiAgfQoKICBmdW5jdGlvbiBnZXRBbmRSZW1vdmVBdHRyQnlSZWdleCAoCiAgICBlbCwKICAgIG5hbWUKICApIHsKICAgIHZhciBsaXN0ID0gZWwuYXR0cnNMaXN0OwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBsaXN0Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIgYXR0ciA9IGxpc3RbaV07CiAgICAgIGlmIChuYW1lLnRlc3QoYXR0ci5uYW1lKSkgewogICAgICAgIGxpc3Quc3BsaWNlKGksIDEpOwogICAgICAgIHJldHVybiBhdHRyCiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHJhbmdlU2V0SXRlbSAoCiAgICBpdGVtLAogICAgcmFuZ2UKICApIHsKICAgIGlmIChyYW5nZSkgewogICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gbnVsbCkgewogICAgICAgIGl0ZW0uc3RhcnQgPSByYW5nZS5zdGFydDsKICAgICAgfQogICAgICBpZiAocmFuZ2UuZW5kICE9IG51bGwpIHsKICAgICAgICBpdGVtLmVuZCA9IHJhbmdlLmVuZDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGl0ZW0KICB9CgogIC8qICAqLwoKICAvKioKICAgKiBDcm9zcy1wbGF0Zm9ybSBjb2RlIGdlbmVyYXRpb24gZm9yIGNvbXBvbmVudCB2LW1vZGVsCiAgICovCiAgZnVuY3Rpb24gZ2VuQ29tcG9uZW50TW9kZWwgKAogICAgZWwsCiAgICB2YWx1ZSwKICAgIG1vZGlmaWVycwogICkgewogICAgdmFyIHJlZiA9IG1vZGlmaWVycyB8fCB7fTsKICAgIHZhciBudW1iZXIgPSByZWYubnVtYmVyOwogICAgdmFyIHRyaW0gPSByZWYudHJpbTsKCiAgICB2YXIgYmFzZVZhbHVlRXhwcmVzc2lvbiA9ICckJHYnOwogICAgdmFyIHZhbHVlRXhwcmVzc2lvbiA9IGJhc2VWYWx1ZUV4cHJlc3Npb247CiAgICBpZiAodHJpbSkgewogICAgICB2YWx1ZUV4cHJlc3Npb24gPQogICAgICAgICIodHlwZW9mICIgKyBiYXNlVmFsdWVFeHByZXNzaW9uICsgIiA9PT0gJ3N0cmluZyciICsKICAgICAgICAiPyAiICsgYmFzZVZhbHVlRXhwcmVzc2lvbiArICIudHJpbSgpIiArCiAgICAgICAgIjogIiArIGJhc2VWYWx1ZUV4cHJlc3Npb24gKyAiKSI7CiAgICB9CiAgICBpZiAobnVtYmVyKSB7CiAgICAgIHZhbHVlRXhwcmVzc2lvbiA9ICJfbigiICsgdmFsdWVFeHByZXNzaW9uICsgIikiOwogICAgfQogICAgdmFyIGFzc2lnbm1lbnQgPSBnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgdmFsdWVFeHByZXNzaW9uKTsKCiAgICBlbC5tb2RlbCA9IHsKICAgICAgdmFsdWU6ICgiKCIgKyB2YWx1ZSArICIpIiksCiAgICAgIGV4cHJlc3Npb246IEpTT04uc3RyaW5naWZ5KHZhbHVlKSwKICAgICAgY2FsbGJhY2s6ICgiZnVuY3Rpb24gKCIgKyBiYXNlVmFsdWVFeHByZXNzaW9uICsgIikgeyIgKyBhc3NpZ25tZW50ICsgIn0iKQogICAgfTsKICB9CgogIC8qKgogICAqIENyb3NzLXBsYXRmb3JtIGNvZGVnZW4gaGVscGVyIGZvciBnZW5lcmF0aW5nIHYtbW9kZWwgdmFsdWUgYXNzaWdubWVudCBjb2RlLgogICAqLwogIGZ1bmN0aW9uIGdlbkFzc2lnbm1lbnRDb2RlICgKICAgIHZhbHVlLAogICAgYXNzaWdubWVudAogICkgewogICAgdmFyIHJlcyA9IHBhcnNlTW9kZWwodmFsdWUpOwogICAgaWYgKHJlcy5rZXkgPT09IG51bGwpIHsKICAgICAgcmV0dXJuICh2YWx1ZSArICI9IiArIGFzc2lnbm1lbnQpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gKCIkc2V0KCIgKyAocmVzLmV4cCkgKyAiLCAiICsgKHJlcy5rZXkpICsgIiwgIiArIGFzc2lnbm1lbnQgKyAiKSIpCiAgICB9CiAgfQoKICAvKioKICAgKiBQYXJzZSBhIHYtbW9kZWwgZXhwcmVzc2lvbiBpbnRvIGEgYmFzZSBwYXRoIGFuZCBhIGZpbmFsIGtleSBzZWdtZW50LgogICAqIEhhbmRsZXMgYm90aCBkb3QtcGF0aCBhbmQgcG9zc2libGUgc3F1YXJlIGJyYWNrZXRzLgogICAqCiAgICogUG9zc2libGUgY2FzZXM6CiAgICoKICAgKiAtIHRlc3QKICAgKiAtIHRlc3Rba2V5XQogICAqIC0gdGVzdFt0ZXN0MVtrZXldXQogICAqIC0gdGVzdFsiYSJdW2tleV0KICAgKiAtIHh4eC50ZXN0W2FbYV0udGVzdDFba2V5XV0KICAgKiAtIHRlc3QueHh4LmFbImFzYSJdW3Rlc3QxW2tleV1dCiAgICoKICAgKi8KCiAgdmFyIGxlbiwgc3RyLCBjaHIsIGluZGV4JDEsIGV4cHJlc3Npb25Qb3MsIGV4cHJlc3Npb25FbmRQb3M7CgoKCiAgZnVuY3Rpb24gcGFyc2VNb2RlbCAodmFsKSB7CiAgICAvLyBGaXggaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS9wdWxsLzc3MzAKICAgIC8vIGFsbG93IHYtbW9kZWw9Im9iai52YWwgIiAodHJhaWxpbmcgd2hpdGVzcGFjZSkKICAgIHZhbCA9IHZhbC50cmltKCk7CiAgICBsZW4gPSB2YWwubGVuZ3RoOwoKICAgIGlmICh2YWwuaW5kZXhPZignWycpIDwgMCB8fCB2YWwubGFzdEluZGV4T2YoJ10nKSA8IGxlbiAtIDEpIHsKICAgICAgaW5kZXgkMSA9IHZhbC5sYXN0SW5kZXhPZignLicpOwogICAgICBpZiAoaW5kZXgkMSA+IC0xKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGV4cDogdmFsLnNsaWNlKDAsIGluZGV4JDEpLAogICAgICAgICAga2V5OiAnIicgKyB2YWwuc2xpY2UoaW5kZXgkMSArIDEpICsgJyInCiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBleHA6IHZhbCwKICAgICAgICAgIGtleTogbnVsbAogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHN0ciA9IHZhbDsKICAgIGluZGV4JDEgPSBleHByZXNzaW9uUG9zID0gZXhwcmVzc2lvbkVuZFBvcyA9IDA7CgogICAgd2hpbGUgKCFlb2YoKSkgewogICAgICBjaHIgPSBuZXh0KCk7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoaXNTdHJpbmdTdGFydChjaHIpKSB7CiAgICAgICAgcGFyc2VTdHJpbmcoY2hyKTsKICAgICAgfSBlbHNlIGlmIChjaHIgPT09IDB4NUIpIHsKICAgICAgICBwYXJzZUJyYWNrZXQoY2hyKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB7CiAgICAgIGV4cDogdmFsLnNsaWNlKDAsIGV4cHJlc3Npb25Qb3MpLAogICAgICBrZXk6IHZhbC5zbGljZShleHByZXNzaW9uUG9zICsgMSwgZXhwcmVzc2lvbkVuZFBvcykKICAgIH0KICB9CgogIGZ1bmN0aW9uIG5leHQgKCkgewogICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KCsraW5kZXgkMSkKICB9CgogIGZ1bmN0aW9uIGVvZiAoKSB7CiAgICByZXR1cm4gaW5kZXgkMSA+PSBsZW4KICB9CgogIGZ1bmN0aW9uIGlzU3RyaW5nU3RhcnQgKGNocikgewogICAgcmV0dXJuIGNociA9PT0gMHgyMiB8fCBjaHIgPT09IDB4MjcKICB9CgogIGZ1bmN0aW9uIHBhcnNlQnJhY2tldCAoY2hyKSB7CiAgICB2YXIgaW5CcmFja2V0ID0gMTsKICAgIGV4cHJlc3Npb25Qb3MgPSBpbmRleCQxOwogICAgd2hpbGUgKCFlb2YoKSkgewogICAgICBjaHIgPSBuZXh0KCk7CiAgICAgIGlmIChpc1N0cmluZ1N0YXJ0KGNocikpIHsKICAgICAgICBwYXJzZVN0cmluZyhjaHIpOwogICAgICAgIGNvbnRpbnVlCiAgICAgIH0KICAgICAgaWYgKGNociA9PT0gMHg1QikgeyBpbkJyYWNrZXQrKzsgfQogICAgICBpZiAoY2hyID09PSAweDVEKSB7IGluQnJhY2tldC0tOyB9CiAgICAgIGlmIChpbkJyYWNrZXQgPT09IDApIHsKICAgICAgICBleHByZXNzaW9uRW5kUG9zID0gaW5kZXgkMTsKICAgICAgICBicmVhawogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwYXJzZVN0cmluZyAoY2hyKSB7CiAgICB2YXIgc3RyaW5nUXVvdGUgPSBjaHI7CiAgICB3aGlsZSAoIWVvZigpKSB7CiAgICAgIGNociA9IG5leHQoKTsKICAgICAgaWYgKGNociA9PT0gc3RyaW5nUXVvdGUpIHsKICAgICAgICBicmVhawogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIHdhcm4kMTsKCiAgLy8gaW4gc29tZSBjYXNlcywgdGhlIGV2ZW50IHVzZWQgaGFzIHRvIGJlIGRldGVybWluZWQgYXQgcnVudGltZQogIC8vIHNvIHdlIHVzZWQgc29tZSByZXNlcnZlZCB0b2tlbnMgZHVyaW5nIGNvbXBpbGUuCiAgdmFyIFJBTkdFX1RPS0VOID0gJ19fcic7CiAgdmFyIENIRUNLQk9YX1JBRElPX1RPS0VOID0gJ19fYyc7CgogIGZ1bmN0aW9uIG1vZGVsICgKICAgIGVsLAogICAgZGlyLAogICAgX3dhcm4KICApIHsKICAgIHdhcm4kMSA9IF93YXJuOwogICAgdmFyIHZhbHVlID0gZGlyLnZhbHVlOwogICAgdmFyIG1vZGlmaWVycyA9IGRpci5tb2RpZmllcnM7CiAgICB2YXIgdGFnID0gZWwudGFnOwogICAgdmFyIHR5cGUgPSBlbC5hdHRyc01hcC50eXBlOwoKICAgIHsKICAgICAgLy8gaW5wdXRzIHdpdGggdHlwZT0iZmlsZSIgYXJlIHJlYWQgb25seSBhbmQgc2V0dGluZyB0aGUgaW5wdXQncwogICAgICAvLyB2YWx1ZSB3aWxsIHRocm93IGFuIGVycm9yLgogICAgICBpZiAodGFnID09PSAnaW5wdXQnICYmIHR5cGUgPT09ICdmaWxlJykgewogICAgICAgIHdhcm4kMSgKICAgICAgICAgICI8IiArIChlbC50YWcpICsgIiB2LW1vZGVsPVwiIiArIHZhbHVlICsgIlwiIHR5cGU9XCJmaWxlXCI+OlxuIiArCiAgICAgICAgICAiRmlsZSBpbnB1dHMgYXJlIHJlYWQgb25seS4gVXNlIGEgdi1vbjpjaGFuZ2UgbGlzdGVuZXIgaW5zdGVhZC4iLAogICAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3YtbW9kZWwnXQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZWwuY29tcG9uZW50KSB7CiAgICAgIGdlbkNvbXBvbmVudE1vZGVsKGVsLCB2YWx1ZSwgbW9kaWZpZXJzKTsKICAgICAgLy8gY29tcG9uZW50IHYtbW9kZWwgZG9lc24ndCBuZWVkIGV4dHJhIHJ1bnRpbWUKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9IGVsc2UgaWYgKHRhZyA9PT0gJ3NlbGVjdCcpIHsKICAgICAgZ2VuU2VsZWN0KGVsLCB2YWx1ZSwgbW9kaWZpZXJzKTsKICAgIH0gZWxzZSBpZiAodGFnID09PSAnaW5wdXQnICYmIHR5cGUgPT09ICdjaGVja2JveCcpIHsKICAgICAgZ2VuQ2hlY2tib3hNb2RlbChlbCwgdmFsdWUsIG1vZGlmaWVycyk7CiAgICB9IGVsc2UgaWYgKHRhZyA9PT0gJ2lucHV0JyAmJiB0eXBlID09PSAncmFkaW8nKSB7CiAgICAgIGdlblJhZGlvTW9kZWwoZWwsIHZhbHVlLCBtb2RpZmllcnMpOwogICAgfSBlbHNlIGlmICh0YWcgPT09ICdpbnB1dCcgfHwgdGFnID09PSAndGV4dGFyZWEnKSB7CiAgICAgIGdlbkRlZmF1bHRNb2RlbChlbCwgdmFsdWUsIG1vZGlmaWVycyk7CiAgICB9IGVsc2UgaWYgKCFjb25maWcuaXNSZXNlcnZlZFRhZyh0YWcpKSB7CiAgICAgIGdlbkNvbXBvbmVudE1vZGVsKGVsLCB2YWx1ZSwgbW9kaWZpZXJzKTsKICAgICAgLy8gY29tcG9uZW50IHYtbW9kZWwgZG9lc24ndCBuZWVkIGV4dHJhIHJ1bnRpbWUKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9IGVsc2UgewogICAgICB3YXJuJDEoCiAgICAgICAgIjwiICsgKGVsLnRhZykgKyAiIHYtbW9kZWw9XCIiICsgdmFsdWUgKyAiXCI+OiAiICsKICAgICAgICAidi1tb2RlbCBpcyBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgZWxlbWVudCB0eXBlLiAiICsKICAgICAgICAnSWYgeW91IGFyZSB3b3JraW5nIHdpdGggY29udGVudGVkaXRhYmxlLCBpdFwncyByZWNvbW1lbmRlZCB0byAnICsKICAgICAgICAnd3JhcCBhIGxpYnJhcnkgZGVkaWNhdGVkIGZvciB0aGF0IHB1cnBvc2UgaW5zaWRlIGEgY3VzdG9tIGNvbXBvbmVudC4nLAogICAgICAgIGVsLnJhd0F0dHJzTWFwWyd2LW1vZGVsJ10KICAgICAgKTsKICAgIH0KCiAgICAvLyBlbnN1cmUgcnVudGltZSBkaXJlY3RpdmUgbWV0YWRhdGEKICAgIHJldHVybiB0cnVlCiAgfQoKICBmdW5jdGlvbiBnZW5DaGVja2JveE1vZGVsICgKICAgIGVsLAogICAgdmFsdWUsCiAgICBtb2RpZmllcnMKICApIHsKICAgIHZhciBudW1iZXIgPSBtb2RpZmllcnMgJiYgbW9kaWZpZXJzLm51bWJlcjsKICAgIHZhciB2YWx1ZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3ZhbHVlJykgfHwgJ251bGwnOwogICAgdmFyIHRydWVWYWx1ZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3RydWUtdmFsdWUnKSB8fCAndHJ1ZSc7CiAgICB2YXIgZmFsc2VWYWx1ZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ2ZhbHNlLXZhbHVlJykgfHwgJ2ZhbHNlJzsKICAgIGFkZFByb3AoZWwsICdjaGVja2VkJywKICAgICAgIkFycmF5LmlzQXJyYXkoIiArIHZhbHVlICsgIikiICsKICAgICAgIj9faSgiICsgdmFsdWUgKyAiLCIgKyB2YWx1ZUJpbmRpbmcgKyAiKT4tMSIgKyAoCiAgICAgICAgdHJ1ZVZhbHVlQmluZGluZyA9PT0gJ3RydWUnCiAgICAgICAgICA/ICgiOigiICsgdmFsdWUgKyAiKSIpCiAgICAgICAgICA6ICgiOl9xKCIgKyB2YWx1ZSArICIsIiArIHRydWVWYWx1ZUJpbmRpbmcgKyAiKSIpCiAgICAgICkKICAgICk7CiAgICBhZGRIYW5kbGVyKGVsLCAnY2hhbmdlJywKICAgICAgInZhciAkJGE9IiArIHZhbHVlICsgIiwiICsKICAgICAgICAgICckJGVsPSRldmVudC50YXJnZXQsJyArCiAgICAgICAgICAiJCRjPSQkZWwuY2hlY2tlZD8oIiArIHRydWVWYWx1ZUJpbmRpbmcgKyAiKTooIiArIGZhbHNlVmFsdWVCaW5kaW5nICsgIik7IiArCiAgICAgICdpZihBcnJheS5pc0FycmF5KCQkYSkpeycgKwogICAgICAgICJ2YXIgJCR2PSIgKyAobnVtYmVyID8gJ19uKCcgKyB2YWx1ZUJpbmRpbmcgKyAnKScgOiB2YWx1ZUJpbmRpbmcpICsgIiwiICsKICAgICAgICAgICAgJyQkaT1faSgkJGEsJCR2KTsnICsKICAgICAgICAiaWYoJCRlbC5jaGVja2VkKXskJGk8MCYmKCIgKyAoZ2VuQXNzaWdubWVudENvZGUodmFsdWUsICckJGEuY29uY2F0KFskJHZdKScpKSArICIpfSIgKwogICAgICAgICJlbHNleyQkaT4tMSYmKCIgKyAoZ2VuQXNzaWdubWVudENvZGUodmFsdWUsICckJGEuc2xpY2UoMCwkJGkpLmNvbmNhdCgkJGEuc2xpY2UoJCRpKzEpKScpKSArICIpfSIgKwogICAgICAifWVsc2V7IiArIChnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgJyQkYycpKSArICJ9IiwKICAgICAgbnVsbCwgdHJ1ZQogICAgKTsKICB9CgogIGZ1bmN0aW9uIGdlblJhZGlvTW9kZWwgKAogICAgZWwsCiAgICB2YWx1ZSwKICAgIG1vZGlmaWVycwogICkgewogICAgdmFyIG51bWJlciA9IG1vZGlmaWVycyAmJiBtb2RpZmllcnMubnVtYmVyOwogICAgdmFyIHZhbHVlQmluZGluZyA9IGdldEJpbmRpbmdBdHRyKGVsLCAndmFsdWUnKSB8fCAnbnVsbCc7CiAgICB2YWx1ZUJpbmRpbmcgPSBudW1iZXIgPyAoIl9uKCIgKyB2YWx1ZUJpbmRpbmcgKyAiKSIpIDogdmFsdWVCaW5kaW5nOwogICAgYWRkUHJvcChlbCwgJ2NoZWNrZWQnLCAoIl9xKCIgKyB2YWx1ZSArICIsIiArIHZhbHVlQmluZGluZyArICIpIikpOwogICAgYWRkSGFuZGxlcihlbCwgJ2NoYW5nZScsIGdlbkFzc2lnbm1lbnRDb2RlKHZhbHVlLCB2YWx1ZUJpbmRpbmcpLCBudWxsLCB0cnVlKTsKICB9CgogIGZ1bmN0aW9uIGdlblNlbGVjdCAoCiAgICBlbCwKICAgIHZhbHVlLAogICAgbW9kaWZpZXJzCiAgKSB7CiAgICB2YXIgbnVtYmVyID0gbW9kaWZpZXJzICYmIG1vZGlmaWVycy5udW1iZXI7CiAgICB2YXIgc2VsZWN0ZWRWYWwgPSAiQXJyYXkucHJvdG90eXBlLmZpbHRlciIgKwogICAgICAiLmNhbGwoJGV2ZW50LnRhcmdldC5vcHRpb25zLGZ1bmN0aW9uKG8pe3JldHVybiBvLnNlbGVjdGVkfSkiICsKICAgICAgIi5tYXAoZnVuY3Rpb24obyl7dmFyIHZhbCA9IFwiX3ZhbHVlXCIgaW4gbyA/IG8uX3ZhbHVlIDogby52YWx1ZTsiICsKICAgICAgInJldHVybiAiICsgKG51bWJlciA/ICdfbih2YWwpJyA6ICd2YWwnKSArICJ9KSI7CgogICAgdmFyIGFzc2lnbm1lbnQgPSAnJGV2ZW50LnRhcmdldC5tdWx0aXBsZSA/ICQkc2VsZWN0ZWRWYWwgOiAkJHNlbGVjdGVkVmFsWzBdJzsKICAgIHZhciBjb2RlID0gInZhciAkJHNlbGVjdGVkVmFsID0gIiArIHNlbGVjdGVkVmFsICsgIjsiOwogICAgY29kZSA9IGNvZGUgKyAiICIgKyAoZ2VuQXNzaWdubWVudENvZGUodmFsdWUsIGFzc2lnbm1lbnQpKTsKICAgIGFkZEhhbmRsZXIoZWwsICdjaGFuZ2UnLCBjb2RlLCBudWxsLCB0cnVlKTsKICB9CgogIGZ1bmN0aW9uIGdlbkRlZmF1bHRNb2RlbCAoCiAgICBlbCwKICAgIHZhbHVlLAogICAgbW9kaWZpZXJzCiAgKSB7CiAgICB2YXIgdHlwZSA9IGVsLmF0dHJzTWFwLnR5cGU7CgogICAgLy8gd2FybiBpZiB2LWJpbmQ6dmFsdWUgY29uZmxpY3RzIHdpdGggdi1tb2RlbAogICAgLy8gZXhjZXB0IGZvciBpbnB1dHMgd2l0aCB2LWJpbmQ6dHlwZQogICAgewogICAgICB2YXIgdmFsdWUkMSA9IGVsLmF0dHJzTWFwWyd2LWJpbmQ6dmFsdWUnXSB8fCBlbC5hdHRyc01hcFsnOnZhbHVlJ107CiAgICAgIHZhciB0eXBlQmluZGluZyA9IGVsLmF0dHJzTWFwWyd2LWJpbmQ6dHlwZSddIHx8IGVsLmF0dHJzTWFwWyc6dHlwZSddOwogICAgICBpZiAodmFsdWUkMSAmJiAhdHlwZUJpbmRpbmcpIHsKICAgICAgICB2YXIgYmluZGluZyA9IGVsLmF0dHJzTWFwWyd2LWJpbmQ6dmFsdWUnXSA/ICd2LWJpbmQ6dmFsdWUnIDogJzp2YWx1ZSc7CiAgICAgICAgd2FybiQxKAogICAgICAgICAgYmluZGluZyArICI9XCIiICsgdmFsdWUkMSArICJcIiBjb25mbGljdHMgd2l0aCB2LW1vZGVsIG9uIHRoZSBzYW1lIGVsZW1lbnQgIiArCiAgICAgICAgICAnYmVjYXVzZSB0aGUgbGF0dGVyIGFscmVhZHkgZXhwYW5kcyB0byBhIHZhbHVlIGJpbmRpbmcgaW50ZXJuYWxseScsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFtiaW5kaW5nXQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgcmVmID0gbW9kaWZpZXJzIHx8IHt9OwogICAgdmFyIGxhenkgPSByZWYubGF6eTsKICAgIHZhciBudW1iZXIgPSByZWYubnVtYmVyOwogICAgdmFyIHRyaW0gPSByZWYudHJpbTsKICAgIHZhciBuZWVkQ29tcG9zaXRpb25HdWFyZCA9ICFsYXp5ICYmIHR5cGUgIT09ICdyYW5nZSc7CiAgICB2YXIgZXZlbnQgPSBsYXp5CiAgICAgID8gJ2NoYW5nZScKICAgICAgOiB0eXBlID09PSAncmFuZ2UnCiAgICAgICAgPyBSQU5HRV9UT0tFTgogICAgICAgIDogJ2lucHV0JzsKCiAgICB2YXIgdmFsdWVFeHByZXNzaW9uID0gJyRldmVudC50YXJnZXQudmFsdWUnOwogICAgaWYgKHRyaW0pIHsKICAgICAgdmFsdWVFeHByZXNzaW9uID0gIiRldmVudC50YXJnZXQudmFsdWUudHJpbSgpIjsKICAgIH0KICAgIGlmIChudW1iZXIpIHsKICAgICAgdmFsdWVFeHByZXNzaW9uID0gIl9uKCIgKyB2YWx1ZUV4cHJlc3Npb24gKyAiKSI7CiAgICB9CgogICAgdmFyIGNvZGUgPSBnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgdmFsdWVFeHByZXNzaW9uKTsKICAgIGlmIChuZWVkQ29tcG9zaXRpb25HdWFyZCkgewogICAgICBjb2RlID0gImlmKCRldmVudC50YXJnZXQuY29tcG9zaW5nKXJldHVybjsiICsgY29kZTsKICAgIH0KCiAgICBhZGRQcm9wKGVsLCAndmFsdWUnLCAoIigiICsgdmFsdWUgKyAiKSIpKTsKICAgIGFkZEhhbmRsZXIoZWwsIGV2ZW50LCBjb2RlLCBudWxsLCB0cnVlKTsKICAgIGlmICh0cmltIHx8IG51bWJlcikgewogICAgICBhZGRIYW5kbGVyKGVsLCAnYmx1cicsICckZm9yY2VVcGRhdGUoKScpOwogICAgfQogIH0KCiAgLyogICovCgogIC8vIG5vcm1hbGl6ZSB2LW1vZGVsIGV2ZW50IHRva2VucyB0aGF0IGNhbiBvbmx5IGJlIGRldGVybWluZWQgYXQgcnVudGltZS4KICAvLyBpdCdzIGltcG9ydGFudCB0byBwbGFjZSB0aGUgZXZlbnQgYXMgdGhlIGZpcnN0IGluIHRoZSBhcnJheSBiZWNhdXNlCiAgLy8gdGhlIHdob2xlIHBvaW50IGlzIGVuc3VyaW5nIHRoZSB2LW1vZGVsIGNhbGxiYWNrIGdldHMgY2FsbGVkIGJlZm9yZQogIC8vIHVzZXItYXR0YWNoZWQgaGFuZGxlcnMuCiAgZnVuY3Rpb24gbm9ybWFsaXplRXZlbnRzIChvbikgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNEZWYob25bUkFOR0VfVE9LRU5dKSkgewogICAgICAvLyBJRSBpbnB1dFt0eXBlPXJhbmdlXSBvbmx5IHN1cHBvcnRzIGBjaGFuZ2VgIGV2ZW50CiAgICAgIHZhciBldmVudCA9IGlzSUUgPyAnY2hhbmdlJyA6ICdpbnB1dCc7CiAgICAgIG9uW2V2ZW50XSA9IFtdLmNvbmNhdChvbltSQU5HRV9UT0tFTl0sIG9uW2V2ZW50XSB8fCBbXSk7CiAgICAgIGRlbGV0ZSBvbltSQU5HRV9UT0tFTl07CiAgICB9CiAgICAvLyBUaGlzIHdhcyBvcmlnaW5hbGx5IGludGVuZGVkIHRvIGZpeCAjNDUyMSBidXQgbm8gbG9uZ2VyIG5lY2Vzc2FyeQogICAgLy8gYWZ0ZXIgMi41LiBLZWVwaW5nIGl0IGZvciBiYWNrd2FyZHMgY29tcGF0IHdpdGggZ2VuZXJhdGVkIGNvZGUgZnJvbSA8IDIuNAogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNEZWYob25bQ0hFQ0tCT1hfUkFESU9fVE9LRU5dKSkgewogICAgICBvbi5jaGFuZ2UgPSBbXS5jb25jYXQob25bQ0hFQ0tCT1hfUkFESU9fVE9LRU5dLCBvbi5jaGFuZ2UgfHwgW10pOwogICAgICBkZWxldGUgb25bQ0hFQ0tCT1hfUkFESU9fVE9LRU5dOwogICAgfQogIH0KCiAgdmFyIHRhcmdldCQxOwoKICBmdW5jdGlvbiBjcmVhdGVPbmNlSGFuZGxlciQxIChldmVudCwgaGFuZGxlciwgY2FwdHVyZSkgewogICAgdmFyIF90YXJnZXQgPSB0YXJnZXQkMTsgLy8gc2F2ZSBjdXJyZW50IHRhcmdldCBlbGVtZW50IGluIGNsb3N1cmUKICAgIHJldHVybiBmdW5jdGlvbiBvbmNlSGFuZGxlciAoKSB7CiAgICAgIHZhciByZXMgPSBoYW5kbGVyLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICAgIGlmIChyZXMgIT09IG51bGwpIHsKICAgICAgICByZW1vdmUkMihldmVudCwgb25jZUhhbmRsZXIsIGNhcHR1cmUsIF90YXJnZXQpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyAjOTQ0NjogRmlyZWZveCA8PSA1MyAoaW4gcGFydGljdWxhciwgRVNSIDUyKSBoYXMgaW5jb3JyZWN0IEV2ZW50LnRpbWVTdGFtcAogIC8vIGltcGxlbWVudGF0aW9uIGFuZCBkb2VzIG5vdCBmaXJlIG1pY3JvdGFza3MgaW4gYmV0d2VlbiBldmVudCBwcm9wYWdhdGlvbiwgc28KICAvLyBzYWZlIHRvIGV4Y2x1ZGUuCiAgdmFyIHVzZU1pY3JvdGFza0ZpeCA9IGlzVXNpbmdNaWNyb1Rhc2sgJiYgIShpc0ZGICYmIE51bWJlcihpc0ZGWzFdKSA8PSA1Myk7CgogIGZ1bmN0aW9uIGFkZCQxICgKICAgIG5hbWUsCiAgICBoYW5kbGVyLAogICAgY2FwdHVyZSwKICAgIHBhc3NpdmUKICApIHsKICAgIC8vIGFzeW5jIGVkZ2UgY2FzZSAjNjU2NjogaW5uZXIgY2xpY2sgZXZlbnQgdHJpZ2dlcnMgcGF0Y2gsIGV2ZW50IGhhbmRsZXIKICAgIC8vIGF0dGFjaGVkIHRvIG91dGVyIGVsZW1lbnQgZHVyaW5nIHBhdGNoLCBhbmQgdHJpZ2dlcmVkIGFnYWluLiBUaGlzCiAgICAvLyBoYXBwZW5zIGJlY2F1c2UgYnJvd3NlcnMgZmlyZSBtaWNyb3Rhc2sgdGlja3MgYmV0d2VlbiBldmVudCBwcm9wYWdhdGlvbi4KICAgIC8vIHRoZSBzb2x1dGlvbiBpcyBzaW1wbGU6IHdlIHNhdmUgdGhlIHRpbWVzdGFtcCB3aGVuIGEgaGFuZGxlciBpcyBhdHRhY2hlZCwKICAgIC8vIGFuZCB0aGUgaGFuZGxlciB3b3VsZCBvbmx5IGZpcmUgaWYgdGhlIGV2ZW50IHBhc3NlZCB0byBpdCB3YXMgZmlyZWQKICAgIC8vIEFGVEVSIGl0IHdhcyBhdHRhY2hlZC4KICAgIGlmICh1c2VNaWNyb3Rhc2tGaXgpIHsKICAgICAgdmFyIGF0dGFjaGVkVGltZXN0YW1wID0gY3VycmVudEZsdXNoVGltZXN0YW1wOwogICAgICB2YXIgb3JpZ2luYWwgPSBoYW5kbGVyOwogICAgICBoYW5kbGVyID0gb3JpZ2luYWwuX3dyYXBwZXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmICgKICAgICAgICAgIC8vIG5vIGJ1YmJsaW5nLCBzaG91bGQgYWx3YXlzIGZpcmUuCiAgICAgICAgICAvLyB0aGlzIGlzIGp1c3QgYSBzYWZldHkgbmV0IGluIGNhc2UgZXZlbnQudGltZVN0YW1wIGlzIHVucmVsaWFibGUgaW4KICAgICAgICAgIC8vIGNlcnRhaW4gd2VpcmQgZW52aXJvbm1lbnRzLi4uCiAgICAgICAgICBlLnRhcmdldCA9PT0gZS5jdXJyZW50VGFyZ2V0IHx8CiAgICAgICAgICAvLyBldmVudCBpcyBmaXJlZCBhZnRlciBoYW5kbGVyIGF0dGFjaG1lbnQKICAgICAgICAgIGUudGltZVN0YW1wID49IGF0dGFjaGVkVGltZXN0YW1wIHx8CiAgICAgICAgICAvLyBiYWlsIGZvciBlbnZpcm9ubWVudHMgdGhhdCBoYXZlIGJ1Z2d5IGV2ZW50LnRpbWVTdGFtcCBpbXBsZW1lbnRhdGlvbnMKICAgICAgICAgIC8vICM5NDYyIGlPUyA5IGJ1ZzogZXZlbnQudGltZVN0YW1wIGlzIDAgYWZ0ZXIgaGlzdG9yeS5wdXNoU3RhdGUKICAgICAgICAgIC8vICM5NjgxIFF0V2ViRW5naW5lIGV2ZW50LnRpbWVTdGFtcCBpcyBuZWdhdGl2ZSB2YWx1ZQogICAgICAgICAgZS50aW1lU3RhbXAgPD0gMCB8fAogICAgICAgICAgLy8gIzk0NDggYmFpbCBpZiBldmVudCBpcyBmaXJlZCBpbiBhbm90aGVyIGRvY3VtZW50IGluIGEgbXVsdGktcGFnZQogICAgICAgICAgLy8gZWxlY3Ryb24vbncuanMgYXBwLCBzaW5jZSBldmVudC50aW1lU3RhbXAgd2lsbCBiZSB1c2luZyBhIGRpZmZlcmVudAogICAgICAgICAgLy8gc3RhcnRpbmcgcmVmZXJlbmNlCiAgICAgICAgICBlLnRhcmdldC5vd25lckRvY3VtZW50ICE9PSBkb2N1bWVudAogICAgICAgICkgewogICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICB0YXJnZXQkMS5hZGRFdmVudExpc3RlbmVyKAogICAgICBuYW1lLAogICAgICBoYW5kbGVyLAogICAgICBzdXBwb3J0c1Bhc3NpdmUKICAgICAgICA/IHsgY2FwdHVyZTogY2FwdHVyZSwgcGFzc2l2ZTogcGFzc2l2ZSB9CiAgICAgICAgOiBjYXB0dXJlCiAgICApOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlJDIgKAogICAgbmFtZSwKICAgIGhhbmRsZXIsCiAgICBjYXB0dXJlLAogICAgX3RhcmdldAogICkgewogICAgKF90YXJnZXQgfHwgdGFyZ2V0JDEpLnJlbW92ZUV2ZW50TGlzdGVuZXIoCiAgICAgIG5hbWUsCiAgICAgIGhhbmRsZXIuX3dyYXBwZXIgfHwgaGFuZGxlciwKICAgICAgY2FwdHVyZQogICAgKTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZURPTUxpc3RlbmVycyAob2xkVm5vZGUsIHZub2RlKSB7CiAgICBpZiAoaXNVbmRlZihvbGRWbm9kZS5kYXRhLm9uKSAmJiBpc1VuZGVmKHZub2RlLmRhdGEub24pKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIG9uID0gdm5vZGUuZGF0YS5vbiB8fCB7fTsKICAgIHZhciBvbGRPbiA9IG9sZFZub2RlLmRhdGEub24gfHwge307CiAgICB0YXJnZXQkMSA9IHZub2RlLmVsbTsKICAgIG5vcm1hbGl6ZUV2ZW50cyhvbik7CiAgICB1cGRhdGVMaXN0ZW5lcnMob24sIG9sZE9uLCBhZGQkMSwgcmVtb3ZlJDIsIGNyZWF0ZU9uY2VIYW5kbGVyJDEsIHZub2RlLmNvbnRleHQpOwogICAgdGFyZ2V0JDEgPSB1bmRlZmluZWQ7CiAgfQoKICB2YXIgZXZlbnRzID0gewogICAgY3JlYXRlOiB1cGRhdGVET01MaXN0ZW5lcnMsCiAgICB1cGRhdGU6IHVwZGF0ZURPTUxpc3RlbmVycwogIH07CgogIC8qICAqLwoKICB2YXIgc3ZnQ29udGFpbmVyOwoKICBmdW5jdGlvbiB1cGRhdGVET01Qcm9wcyAob2xkVm5vZGUsIHZub2RlKSB7CiAgICBpZiAoaXNVbmRlZihvbGRWbm9kZS5kYXRhLmRvbVByb3BzKSAmJiBpc1VuZGVmKHZub2RlLmRhdGEuZG9tUHJvcHMpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIGtleSwgY3VyOwogICAgdmFyIGVsbSA9IHZub2RlLmVsbTsKICAgIHZhciBvbGRQcm9wcyA9IG9sZFZub2RlLmRhdGEuZG9tUHJvcHMgfHwge307CiAgICB2YXIgcHJvcHMgPSB2bm9kZS5kYXRhLmRvbVByb3BzIHx8IHt9OwogICAgLy8gY2xvbmUgb2JzZXJ2ZWQgb2JqZWN0cywgYXMgdGhlIHVzZXIgcHJvYmFibHkgd2FudHMgdG8gbXV0YXRlIGl0CiAgICBpZiAoaXNEZWYocHJvcHMuX19vYl9fKSkgewogICAgICBwcm9wcyA9IHZub2RlLmRhdGEuZG9tUHJvcHMgPSBleHRlbmQoe30sIHByb3BzKTsKICAgIH0KCiAgICBmb3IgKGtleSBpbiBvbGRQcm9wcykgewogICAgICBpZiAoIShrZXkgaW4gcHJvcHMpKSB7CiAgICAgICAgZWxtW2tleV0gPSAnJzsKICAgICAgfQogICAgfQoKICAgIGZvciAoa2V5IGluIHByb3BzKSB7CiAgICAgIGN1ciA9IHByb3BzW2tleV07CiAgICAgIC8vIGlnbm9yZSBjaGlsZHJlbiBpZiB0aGUgbm9kZSBoYXMgdGV4dENvbnRlbnQgb3IgaW5uZXJIVE1MLAogICAgICAvLyBhcyB0aGVzZSB3aWxsIHRocm93IGF3YXkgZXhpc3RpbmcgRE9NIG5vZGVzIGFuZCBjYXVzZSByZW1vdmFsIGVycm9ycwogICAgICAvLyBvbiBzdWJzZXF1ZW50IHBhdGNoZXMgKCMzMzYwKQogICAgICBpZiAoa2V5ID09PSAndGV4dENvbnRlbnQnIHx8IGtleSA9PT0gJ2lubmVySFRNTCcpIHsKICAgICAgICBpZiAodm5vZGUuY2hpbGRyZW4pIHsgdm5vZGUuY2hpbGRyZW4ubGVuZ3RoID0gMDsgfQogICAgICAgIGlmIChjdXIgPT09IG9sZFByb3BzW2tleV0pIHsgY29udGludWUgfQogICAgICAgIC8vICM2NjAxIHdvcmsgYXJvdW5kIENocm9tZSB2ZXJzaW9uIDw9IDU1IGJ1ZyB3aGVyZSBzaW5nbGUgdGV4dE5vZGUKICAgICAgICAvLyByZXBsYWNlZCBieSBpbm5lckhUTUwvdGV4dENvbnRlbnQgcmV0YWlucyBpdHMgcGFyZW50Tm9kZSBwcm9wZXJ0eQogICAgICAgIGlmIChlbG0uY2hpbGROb2Rlcy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgIGVsbS5yZW1vdmVDaGlsZChlbG0uY2hpbGROb2Rlc1swXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoa2V5ID09PSAndmFsdWUnICYmIGVsbS50YWdOYW1lICE9PSAnUFJPR1JFU1MnKSB7CiAgICAgICAgLy8gc3RvcmUgdmFsdWUgYXMgX3ZhbHVlIGFzIHdlbGwgc2luY2UKICAgICAgICAvLyBub24tc3RyaW5nIHZhbHVlcyB3aWxsIGJlIHN0cmluZ2lmaWVkCiAgICAgICAgZWxtLl92YWx1ZSA9IGN1cjsKICAgICAgICAvLyBhdm9pZCByZXNldHRpbmcgY3Vyc29yIHBvc2l0aW9uIHdoZW4gdmFsdWUgaXMgdGhlIHNhbWUKICAgICAgICB2YXIgc3RyQ3VyID0gaXNVbmRlZihjdXIpID8gJycgOiBTdHJpbmcoY3VyKTsKICAgICAgICBpZiAoc2hvdWxkVXBkYXRlVmFsdWUoZWxtLCBzdHJDdXIpKSB7CiAgICAgICAgICBlbG0udmFsdWUgPSBzdHJDdXI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2lubmVySFRNTCcgJiYgaXNTVkcoZWxtLnRhZ05hbWUpICYmIGlzVW5kZWYoZWxtLmlubmVySFRNTCkpIHsKICAgICAgICAvLyBJRSBkb2Vzbid0IHN1cHBvcnQgaW5uZXJIVE1MIGZvciBTVkcgZWxlbWVudHMKICAgICAgICBzdmdDb250YWluZXIgPSBzdmdDb250YWluZXIgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgc3ZnQ29udGFpbmVyLmlubmVySFRNTCA9ICI8c3ZnPiIgKyBjdXIgKyAiPC9zdmc+IjsKICAgICAgICB2YXIgc3ZnID0gc3ZnQ29udGFpbmVyLmZpcnN0Q2hpbGQ7CiAgICAgICAgd2hpbGUgKGVsbS5maXJzdENoaWxkKSB7CiAgICAgICAgICBlbG0ucmVtb3ZlQ2hpbGQoZWxtLmZpcnN0Q2hpbGQpOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoc3ZnLmZpcnN0Q2hpbGQpIHsKICAgICAgICAgIGVsbS5hcHBlbmRDaGlsZChzdmcuZmlyc3RDaGlsZCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKAogICAgICAgIC8vIHNraXAgdGhlIHVwZGF0ZSBpZiBvbGQgYW5kIG5ldyBWRE9NIHN0YXRlIGlzIHRoZSBzYW1lLgogICAgICAgIC8vIGB2YWx1ZWAgaXMgaGFuZGxlZCBzZXBhcmF0ZWx5IGJlY2F1c2UgdGhlIERPTSB2YWx1ZSBtYXkgYmUgdGVtcG9yYXJpbHkKICAgICAgICAvLyBvdXQgb2Ygc3luYyB3aXRoIFZET00gc3RhdGUgZHVlIHRvIGZvY3VzLCBjb21wb3NpdGlvbiBhbmQgbW9kaWZpZXJzLgogICAgICAgIC8vIFRoaXMgICM0NTIxIGJ5IHNraXBwaW5nIHRoZSB1bm5lY2Vzc2FyeSBgY2hlY2tlZGAgdXBkYXRlLgogICAgICAgIGN1ciAhPT0gb2xkUHJvcHNba2V5XQogICAgICApIHsKICAgICAgICAvLyBzb21lIHByb3BlcnR5IHVwZGF0ZXMgY2FuIHRocm93CiAgICAgICAgLy8gZS5nLiBgdmFsdWVgIG9uIDxwcm9ncmVzcz4gdy8gbm9uLWZpbml0ZSB2YWx1ZQogICAgICAgIHRyeSB7CiAgICAgICAgICBlbG1ba2V5XSA9IGN1cjsKICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICB9CiAgICB9CiAgfQoKICAvLyBjaGVjayBwbGF0Zm9ybXMvd2ViL3V0aWwvYXR0cnMuanMgYWNjZXB0VmFsdWUKCgogIGZ1bmN0aW9uIHNob3VsZFVwZGF0ZVZhbHVlIChlbG0sIGNoZWNrVmFsKSB7CiAgICByZXR1cm4gKCFlbG0uY29tcG9zaW5nICYmICgKICAgICAgZWxtLnRhZ05hbWUgPT09ICdPUFRJT04nIHx8CiAgICAgIGlzTm90SW5Gb2N1c0FuZERpcnR5KGVsbSwgY2hlY2tWYWwpIHx8CiAgICAgIGlzRGlydHlXaXRoTW9kaWZpZXJzKGVsbSwgY2hlY2tWYWwpCiAgICApKQogIH0KCiAgZnVuY3Rpb24gaXNOb3RJbkZvY3VzQW5kRGlydHkgKGVsbSwgY2hlY2tWYWwpIHsKICAgIC8vIHJldHVybiB0cnVlIHdoZW4gdGV4dGJveCAoLm51bWJlciBhbmQgLnRyaW0pIGxvc2VzIGZvY3VzIGFuZCBpdHMgdmFsdWUgaXMKICAgIC8vIG5vdCBlcXVhbCB0byB0aGUgdXBkYXRlZCB2YWx1ZQogICAgdmFyIG5vdEluRm9jdXMgPSB0cnVlOwogICAgLy8gIzYxNTcKICAgIC8vIHdvcmsgYXJvdW5kIElFIGJ1ZyB3aGVuIGFjY2Vzc2luZyBkb2N1bWVudC5hY3RpdmVFbGVtZW50IGluIGFuIGlmcmFtZQogICAgdHJ5IHsgbm90SW5Gb2N1cyA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IGVsbTsgfSBjYXRjaCAoZSkge30KICAgIHJldHVybiBub3RJbkZvY3VzICYmIGVsbS52YWx1ZSAhPT0gY2hlY2tWYWwKICB9CgogIGZ1bmN0aW9uIGlzRGlydHlXaXRoTW9kaWZpZXJzIChlbG0sIG5ld1ZhbCkgewogICAgdmFyIHZhbHVlID0gZWxtLnZhbHVlOwogICAgdmFyIG1vZGlmaWVycyA9IGVsbS5fdk1vZGlmaWVyczsgLy8gaW5qZWN0ZWQgYnkgdi1tb2RlbCBydW50aW1lCiAgICBpZiAoaXNEZWYobW9kaWZpZXJzKSkgewogICAgICBpZiAobW9kaWZpZXJzLm51bWJlcikgewogICAgICAgIHJldHVybiB0b051bWJlcih2YWx1ZSkgIT09IHRvTnVtYmVyKG5ld1ZhbCkKICAgICAgfQogICAgICBpZiAobW9kaWZpZXJzLnRyaW0pIHsKICAgICAgICByZXR1cm4gdmFsdWUudHJpbSgpICE9PSBuZXdWYWwudHJpbSgpCiAgICAgIH0KICAgIH0KICAgIHJldHVybiB2YWx1ZSAhPT0gbmV3VmFsCiAgfQoKICB2YXIgZG9tUHJvcHMgPSB7CiAgICBjcmVhdGU6IHVwZGF0ZURPTVByb3BzLAogICAgdXBkYXRlOiB1cGRhdGVET01Qcm9wcwogIH07CgogIC8qICAqLwoKICB2YXIgcGFyc2VTdHlsZVRleHQgPSBjYWNoZWQoZnVuY3Rpb24gKGNzc1RleHQpIHsKICAgIHZhciByZXMgPSB7fTsKICAgIHZhciBsaXN0RGVsaW1pdGVyID0gLzsoPyFbXihdKlwpKS9nOwogICAgdmFyIHByb3BlcnR5RGVsaW1pdGVyID0gLzooLispLzsKICAgIGNzc1RleHQuc3BsaXQobGlzdERlbGltaXRlcikuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICBpZiAoaXRlbSkgewogICAgICAgIHZhciB0bXAgPSBpdGVtLnNwbGl0KHByb3BlcnR5RGVsaW1pdGVyKTsKICAgICAgICB0bXAubGVuZ3RoID4gMSAmJiAocmVzW3RtcFswXS50cmltKCldID0gdG1wWzFdLnRyaW0oKSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlcwogIH0pOwoKICAvLyBtZXJnZSBzdGF0aWMgYW5kIGR5bmFtaWMgc3R5bGUgZGF0YSBvbiB0aGUgc2FtZSB2bm9kZQogIGZ1bmN0aW9uIG5vcm1hbGl6ZVN0eWxlRGF0YSAoZGF0YSkgewogICAgdmFyIHN0eWxlID0gbm9ybWFsaXplU3R5bGVCaW5kaW5nKGRhdGEuc3R5bGUpOwogICAgLy8gc3RhdGljIHN0eWxlIGlzIHByZS1wcm9jZXNzZWQgaW50byBhbiBvYmplY3QgZHVyaW5nIGNvbXBpbGF0aW9uCiAgICAvLyBhbmQgaXMgYWx3YXlzIGEgZnJlc2ggb2JqZWN0LCBzbyBpdCdzIHNhZmUgdG8gbWVyZ2UgaW50byBpdAogICAgcmV0dXJuIGRhdGEuc3RhdGljU3R5bGUKICAgICAgPyBleHRlbmQoZGF0YS5zdGF0aWNTdHlsZSwgc3R5bGUpCiAgICAgIDogc3R5bGUKICB9CgogIC8vIG5vcm1hbGl6ZSBwb3NzaWJsZSBhcnJheSAvIHN0cmluZyB2YWx1ZXMgaW50byBPYmplY3QKICBmdW5jdGlvbiBub3JtYWxpemVTdHlsZUJpbmRpbmcgKGJpbmRpbmdTdHlsZSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoYmluZGluZ1N0eWxlKSkgewogICAgICByZXR1cm4gdG9PYmplY3QoYmluZGluZ1N0eWxlKQogICAgfQogICAgaWYgKHR5cGVvZiBiaW5kaW5nU3R5bGUgPT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiBwYXJzZVN0eWxlVGV4dChiaW5kaW5nU3R5bGUpCiAgICB9CiAgICByZXR1cm4gYmluZGluZ1N0eWxlCiAgfQoKICAvKioKICAgKiBwYXJlbnQgY29tcG9uZW50IHN0eWxlIHNob3VsZCBiZSBhZnRlciBjaGlsZCdzCiAgICogc28gdGhhdCBwYXJlbnQgY29tcG9uZW50J3Mgc3R5bGUgY291bGQgb3ZlcnJpZGUgaXQKICAgKi8KICBmdW5jdGlvbiBnZXRTdHlsZSAodm5vZGUsIGNoZWNrQ2hpbGQpIHsKICAgIHZhciByZXMgPSB7fTsKICAgIHZhciBzdHlsZURhdGE7CgogICAgaWYgKGNoZWNrQ2hpbGQpIHsKICAgICAgdmFyIGNoaWxkTm9kZSA9IHZub2RlOwogICAgICB3aGlsZSAoY2hpbGROb2RlLmNvbXBvbmVudEluc3RhbmNlKSB7CiAgICAgICAgY2hpbGROb2RlID0gY2hpbGROb2RlLmNvbXBvbmVudEluc3RhbmNlLl92bm9kZTsKICAgICAgICBpZiAoCiAgICAgICAgICBjaGlsZE5vZGUgJiYgY2hpbGROb2RlLmRhdGEgJiYKICAgICAgICAgIChzdHlsZURhdGEgPSBub3JtYWxpemVTdHlsZURhdGEoY2hpbGROb2RlLmRhdGEpKQogICAgICAgICkgewogICAgICAgICAgZXh0ZW5kKHJlcywgc3R5bGVEYXRhKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAoKHN0eWxlRGF0YSA9IG5vcm1hbGl6ZVN0eWxlRGF0YSh2bm9kZS5kYXRhKSkpIHsKICAgICAgZXh0ZW5kKHJlcywgc3R5bGVEYXRhKTsKICAgIH0KCiAgICB2YXIgcGFyZW50Tm9kZSA9IHZub2RlOwogICAgd2hpbGUgKChwYXJlbnROb2RlID0gcGFyZW50Tm9kZS5wYXJlbnQpKSB7CiAgICAgIGlmIChwYXJlbnROb2RlLmRhdGEgJiYgKHN0eWxlRGF0YSA9IG5vcm1hbGl6ZVN0eWxlRGF0YShwYXJlbnROb2RlLmRhdGEpKSkgewogICAgICAgIGV4dGVuZChyZXMsIHN0eWxlRGF0YSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIC8qICAqLwoKICB2YXIgY3NzVmFyUkUgPSAvXi0tLzsKICB2YXIgaW1wb3J0YW50UkUgPSAvXHMqIWltcG9ydGFudCQvOwogIHZhciBzZXRQcm9wID0gZnVuY3Rpb24gKGVsLCBuYW1lLCB2YWwpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGNzc1ZhclJFLnRlc3QobmFtZSkpIHsKICAgICAgZWwuc3R5bGUuc2V0UHJvcGVydHkobmFtZSwgdmFsKTsKICAgIH0gZWxzZSBpZiAoaW1wb3J0YW50UkUudGVzdCh2YWwpKSB7CiAgICAgIGVsLnN0eWxlLnNldFByb3BlcnR5KGh5cGhlbmF0ZShuYW1lKSwgdmFsLnJlcGxhY2UoaW1wb3J0YW50UkUsICcnKSwgJ2ltcG9ydGFudCcpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIG5vcm1hbGl6ZWROYW1lID0gbm9ybWFsaXplKG5hbWUpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7CiAgICAgICAgLy8gU3VwcG9ydCB2YWx1ZXMgYXJyYXkgY3JlYXRlZCBieSBhdXRvcHJlZml4ZXIsIGUuZy4KICAgICAgICAvLyB7ZGlzcGxheTogWyItd2Via2l0LWJveCIsICItbXMtZmxleGJveCIsICJmbGV4Il19CiAgICAgICAgLy8gU2V0IHRoZW0gb25lIGJ5IG9uZSwgYW5kIHRoZSBicm93c2VyIHdpbGwgb25seSBzZXQgdGhvc2UgaXQgY2FuIHJlY29nbml6ZQogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB2YWwubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGVsLnN0eWxlW25vcm1hbGl6ZWROYW1lXSA9IHZhbFtpXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwuc3R5bGVbbm9ybWFsaXplZE5hbWVdID0gdmFsOwogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIHZlbmRvck5hbWVzID0gWydXZWJraXQnLCAnTW96JywgJ21zJ107CgogIHZhciBlbXB0eVN0eWxlOwogIHZhciBub3JtYWxpemUgPSBjYWNoZWQoZnVuY3Rpb24gKHByb3ApIHsKICAgIGVtcHR5U3R5bGUgPSBlbXB0eVN0eWxlIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLnN0eWxlOwogICAgcHJvcCA9IGNhbWVsaXplKHByb3ApOwogICAgaWYgKHByb3AgIT09ICdmaWx0ZXInICYmIChwcm9wIGluIGVtcHR5U3R5bGUpKSB7CiAgICAgIHJldHVybiBwcm9wCiAgICB9CiAgICB2YXIgY2FwTmFtZSA9IHByb3AuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm9wLnNsaWNlKDEpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2ZW5kb3JOYW1lcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgbmFtZSA9IHZlbmRvck5hbWVzW2ldICsgY2FwTmFtZTsKICAgICAgaWYgKG5hbWUgaW4gZW1wdHlTdHlsZSkgewogICAgICAgIHJldHVybiBuYW1lCiAgICAgIH0KICAgIH0KICB9KTsKCiAgZnVuY3Rpb24gdXBkYXRlU3R5bGUgKG9sZFZub2RlLCB2bm9kZSkgewogICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwogICAgdmFyIG9sZERhdGEgPSBvbGRWbm9kZS5kYXRhOwoKICAgIGlmIChpc1VuZGVmKGRhdGEuc3RhdGljU3R5bGUpICYmIGlzVW5kZWYoZGF0YS5zdHlsZSkgJiYKICAgICAgaXNVbmRlZihvbGREYXRhLnN0YXRpY1N0eWxlKSAmJiBpc1VuZGVmKG9sZERhdGEuc3R5bGUpCiAgICApIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgdmFyIGN1ciwgbmFtZTsKICAgIHZhciBlbCA9IHZub2RlLmVsbTsKICAgIHZhciBvbGRTdGF0aWNTdHlsZSA9IG9sZERhdGEuc3RhdGljU3R5bGU7CiAgICB2YXIgb2xkU3R5bGVCaW5kaW5nID0gb2xkRGF0YS5ub3JtYWxpemVkU3R5bGUgfHwgb2xkRGF0YS5zdHlsZSB8fCB7fTsKCiAgICAvLyBpZiBzdGF0aWMgc3R5bGUgZXhpc3RzLCBzdHlsZWJpbmRpbmcgYWxyZWFkeSBtZXJnZWQgaW50byBpdCB3aGVuIGRvaW5nIG5vcm1hbGl6ZVN0eWxlRGF0YQogICAgdmFyIG9sZFN0eWxlID0gb2xkU3RhdGljU3R5bGUgfHwgb2xkU3R5bGVCaW5kaW5nOwoKICAgIHZhciBzdHlsZSA9IG5vcm1hbGl6ZVN0eWxlQmluZGluZyh2bm9kZS5kYXRhLnN0eWxlKSB8fCB7fTsKCiAgICAvLyBzdG9yZSBub3JtYWxpemVkIHN0eWxlIHVuZGVyIGEgZGlmZmVyZW50IGtleSBmb3IgbmV4dCBkaWZmCiAgICAvLyBtYWtlIHN1cmUgdG8gY2xvbmUgaXQgaWYgaXQncyByZWFjdGl2ZSwgc2luY2UgdGhlIHVzZXIgbGlrZWx5IHdhbnRzCiAgICAvLyB0byBtdXRhdGUgaXQuCiAgICB2bm9kZS5kYXRhLm5vcm1hbGl6ZWRTdHlsZSA9IGlzRGVmKHN0eWxlLl9fb2JfXykKICAgICAgPyBleHRlbmQoe30sIHN0eWxlKQogICAgICA6IHN0eWxlOwoKICAgIHZhciBuZXdTdHlsZSA9IGdldFN0eWxlKHZub2RlLCB0cnVlKTsKCiAgICBmb3IgKG5hbWUgaW4gb2xkU3R5bGUpIHsKICAgICAgaWYgKGlzVW5kZWYobmV3U3R5bGVbbmFtZV0pKSB7CiAgICAgICAgc2V0UHJvcChlbCwgbmFtZSwgJycpOwogICAgICB9CiAgICB9CiAgICBmb3IgKG5hbWUgaW4gbmV3U3R5bGUpIHsKICAgICAgY3VyID0gbmV3U3R5bGVbbmFtZV07CiAgICAgIGlmIChjdXIgIT09IG9sZFN0eWxlW25hbWVdKSB7CiAgICAgICAgLy8gaWU5IHNldHRpbmcgdG8gbnVsbCBoYXMgbm8gZWZmZWN0LCBtdXN0IHVzZSBlbXB0eSBzdHJpbmcKICAgICAgICBzZXRQcm9wKGVsLCBuYW1lLCBjdXIgPT0gbnVsbCA/ICcnIDogY3VyKTsKICAgICAgfQogICAgfQogIH0KCiAgdmFyIHN0eWxlID0gewogICAgY3JlYXRlOiB1cGRhdGVTdHlsZSwKICAgIHVwZGF0ZTogdXBkYXRlU3R5bGUKICB9OwoKICAvKiAgKi8KCiAgdmFyIHdoaXRlc3BhY2VSRSA9IC9ccysvOwoKICAvKioKICAgKiBBZGQgY2xhc3Mgd2l0aCBjb21wYXRpYmlsaXR5IGZvciBTVkcgc2luY2UgY2xhc3NMaXN0IGlzIG5vdCBzdXBwb3J0ZWQgb24KICAgKiBTVkcgZWxlbWVudHMgaW4gSUUKICAgKi8KICBmdW5jdGlvbiBhZGRDbGFzcyAoZWwsIGNscykgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoIWNscyB8fCAhKGNscyA9IGNscy50cmltKCkpKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAoZWwuY2xhc3NMaXN0KSB7CiAgICAgIGlmIChjbHMuaW5kZXhPZignICcpID4gLTEpIHsKICAgICAgICBjbHMuc3BsaXQod2hpdGVzcGFjZVJFKS5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7IHJldHVybiBlbC5jbGFzc0xpc3QuYWRkKGMpOyB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKGNscyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBjdXIgPSAiICIgKyAoZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnKSArICIgIjsKICAgICAgaWYgKGN1ci5pbmRleE9mKCcgJyArIGNscyArICcgJykgPCAwKSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdjbGFzcycsIChjdXIgKyBjbHMpLnRyaW0oKSk7CiAgICAgIH0KICAgIH0KICB9CgogIC8qKgogICAqIFJlbW92ZSBjbGFzcyB3aXRoIGNvbXBhdGliaWxpdHkgZm9yIFNWRyBzaW5jZSBjbGFzc0xpc3QgaXMgbm90IHN1cHBvcnRlZCBvbgogICAqIFNWRyBlbGVtZW50cyBpbiBJRQogICAqLwogIGZ1bmN0aW9uIHJlbW92ZUNsYXNzIChlbCwgY2xzKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICghY2xzIHx8ICEoY2xzID0gY2xzLnRyaW0oKSkpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIGlmIChlbC5jbGFzc0xpc3QpIHsKICAgICAgaWYgKGNscy5pbmRleE9mKCcgJykgPiAtMSkgewogICAgICAgIGNscy5zcGxpdCh3aGl0ZXNwYWNlUkUpLmZvckVhY2goZnVuY3Rpb24gKGMpIHsgcmV0dXJuIGVsLmNsYXNzTGlzdC5yZW1vdmUoYyk7IH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xzKTsKICAgICAgfQogICAgICBpZiAoIWVsLmNsYXNzTGlzdC5sZW5ndGgpIHsKICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoJ2NsYXNzJyk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBjdXIgPSAiICIgKyAoZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpIHx8ICcnKSArICIgIjsKICAgICAgdmFyIHRhciA9ICcgJyArIGNscyArICcgJzsKICAgICAgd2hpbGUgKGN1ci5pbmRleE9mKHRhcikgPj0gMCkgewogICAgICAgIGN1ciA9IGN1ci5yZXBsYWNlKHRhciwgJyAnKTsKICAgICAgfQogICAgICBjdXIgPSBjdXIudHJpbSgpOwogICAgICBpZiAoY3VyKSB7CiAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdjbGFzcycsIGN1cik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwucmVtb3ZlQXR0cmlidXRlKCdjbGFzcycpOwogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gcmVzb2x2ZVRyYW5zaXRpb24gKGRlZiQkMSkgewogICAgaWYgKCFkZWYkJDEpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgaWYgKHR5cGVvZiBkZWYkJDEgPT09ICdvYmplY3QnKSB7CiAgICAgIHZhciByZXMgPSB7fTsKICAgICAgaWYgKGRlZiQkMS5jc3MgIT09IGZhbHNlKSB7CiAgICAgICAgZXh0ZW5kKHJlcywgYXV0b0Nzc1RyYW5zaXRpb24oZGVmJCQxLm5hbWUgfHwgJ3YnKSk7CiAgICAgIH0KICAgICAgZXh0ZW5kKHJlcywgZGVmJCQxKTsKICAgICAgcmV0dXJuIHJlcwogICAgfSBlbHNlIGlmICh0eXBlb2YgZGVmJCQxID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gYXV0b0Nzc1RyYW5zaXRpb24oZGVmJCQxKQogICAgfQogIH0KCiAgdmFyIGF1dG9Dc3NUcmFuc2l0aW9uID0gY2FjaGVkKGZ1bmN0aW9uIChuYW1lKSB7CiAgICByZXR1cm4gewogICAgICBlbnRlckNsYXNzOiAobmFtZSArICItZW50ZXIiKSwKICAgICAgZW50ZXJUb0NsYXNzOiAobmFtZSArICItZW50ZXItdG8iKSwKICAgICAgZW50ZXJBY3RpdmVDbGFzczogKG5hbWUgKyAiLWVudGVyLWFjdGl2ZSIpLAogICAgICBsZWF2ZUNsYXNzOiAobmFtZSArICItbGVhdmUiKSwKICAgICAgbGVhdmVUb0NsYXNzOiAobmFtZSArICItbGVhdmUtdG8iKSwKICAgICAgbGVhdmVBY3RpdmVDbGFzczogKG5hbWUgKyAiLWxlYXZlLWFjdGl2ZSIpCiAgICB9CiAgfSk7CgogIHZhciBoYXNUcmFuc2l0aW9uID0gaW5Ccm93c2VyICYmICFpc0lFOTsKICB2YXIgVFJBTlNJVElPTiA9ICd0cmFuc2l0aW9uJzsKICB2YXIgQU5JTUFUSU9OID0gJ2FuaW1hdGlvbic7CgogIC8vIFRyYW5zaXRpb24gcHJvcGVydHkvZXZlbnQgc25pZmZpbmcKICB2YXIgdHJhbnNpdGlvblByb3AgPSAndHJhbnNpdGlvbic7CiAgdmFyIHRyYW5zaXRpb25FbmRFdmVudCA9ICd0cmFuc2l0aW9uZW5kJzsKICB2YXIgYW5pbWF0aW9uUHJvcCA9ICdhbmltYXRpb24nOwogIHZhciBhbmltYXRpb25FbmRFdmVudCA9ICdhbmltYXRpb25lbmQnOwogIGlmIChoYXNUcmFuc2l0aW9uKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICh3aW5kb3cub250cmFuc2l0aW9uZW5kID09PSB1bmRlZmluZWQgJiYKICAgICAgd2luZG93Lm9ud2Via2l0dHJhbnNpdGlvbmVuZCAhPT0gdW5kZWZpbmVkCiAgICApIHsKICAgICAgdHJhbnNpdGlvblByb3AgPSAnV2Via2l0VHJhbnNpdGlvbic7CiAgICAgIHRyYW5zaXRpb25FbmRFdmVudCA9ICd3ZWJraXRUcmFuc2l0aW9uRW5kJzsKICAgIH0KICAgIGlmICh3aW5kb3cub25hbmltYXRpb25lbmQgPT09IHVuZGVmaW5lZCAmJgogICAgICB3aW5kb3cub253ZWJraXRhbmltYXRpb25lbmQgIT09IHVuZGVmaW5lZAogICAgKSB7CiAgICAgIGFuaW1hdGlvblByb3AgPSAnV2Via2l0QW5pbWF0aW9uJzsKICAgICAgYW5pbWF0aW9uRW5kRXZlbnQgPSAnd2Via2l0QW5pbWF0aW9uRW5kJzsKICAgIH0KICB9CgogIC8vIGJpbmRpbmcgdG8gd2luZG93IGlzIG5lY2Vzc2FyeSB0byBtYWtlIGhvdCByZWxvYWQgd29yayBpbiBJRSBpbiBzdHJpY3QgbW9kZQogIHZhciByYWYgPSBpbkJyb3dzZXIKICAgID8gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZQogICAgICA/IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuYmluZCh3aW5kb3cpCiAgICAgIDogc2V0VGltZW91dAogICAgOiAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyBmdW5jdGlvbiAoZm4pIHsgcmV0dXJuIGZuKCk7IH07CgogIGZ1bmN0aW9uIG5leHRGcmFtZSAoZm4pIHsKICAgIHJhZihmdW5jdGlvbiAoKSB7CiAgICAgIHJhZihmbik7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGFkZFRyYW5zaXRpb25DbGFzcyAoZWwsIGNscykgewogICAgdmFyIHRyYW5zaXRpb25DbGFzc2VzID0gZWwuX3RyYW5zaXRpb25DbGFzc2VzIHx8IChlbC5fdHJhbnNpdGlvbkNsYXNzZXMgPSBbXSk7CiAgICBpZiAodHJhbnNpdGlvbkNsYXNzZXMuaW5kZXhPZihjbHMpIDwgMCkgewogICAgICB0cmFuc2l0aW9uQ2xhc3Nlcy5wdXNoKGNscyk7CiAgICAgIGFkZENsYXNzKGVsLCBjbHMpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlVHJhbnNpdGlvbkNsYXNzIChlbCwgY2xzKSB7CiAgICBpZiAoZWwuX3RyYW5zaXRpb25DbGFzc2VzKSB7CiAgICAgIHJlbW92ZShlbC5fdHJhbnNpdGlvbkNsYXNzZXMsIGNscyk7CiAgICB9CiAgICByZW1vdmVDbGFzcyhlbCwgY2xzKTsKICB9CgogIGZ1bmN0aW9uIHdoZW5UcmFuc2l0aW9uRW5kcyAoCiAgICBlbCwKICAgIGV4cGVjdGVkVHlwZSwKICAgIGNiCiAgKSB7CiAgICB2YXIgcmVmID0gZ2V0VHJhbnNpdGlvbkluZm8oZWwsIGV4cGVjdGVkVHlwZSk7CiAgICB2YXIgdHlwZSA9IHJlZi50eXBlOwogICAgdmFyIHRpbWVvdXQgPSByZWYudGltZW91dDsKICAgIHZhciBwcm9wQ291bnQgPSByZWYucHJvcENvdW50OwogICAgaWYgKCF0eXBlKSB7IHJldHVybiBjYigpIH0KICAgIHZhciBldmVudCA9IHR5cGUgPT09IFRSQU5TSVRJT04gPyB0cmFuc2l0aW9uRW5kRXZlbnQgOiBhbmltYXRpb25FbmRFdmVudDsKICAgIHZhciBlbmRlZCA9IDA7CiAgICB2YXIgZW5kID0gZnVuY3Rpb24gKCkgewogICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBvbkVuZCk7CiAgICAgIGNiKCk7CiAgICB9OwogICAgdmFyIG9uRW5kID0gZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGUudGFyZ2V0ID09PSBlbCkgewogICAgICAgIGlmICgrK2VuZGVkID49IHByb3BDb3VudCkgewogICAgICAgICAgZW5kKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChlbmRlZCA8IHByb3BDb3VudCkgewogICAgICAgIGVuZCgpOwogICAgICB9CiAgICB9LCB0aW1lb3V0ICsgMSk7CiAgICBlbC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBvbkVuZCk7CiAgfQoKICB2YXIgdHJhbnNmb3JtUkUgPSAvXGIodHJhbnNmb3JtfGFsbCkoLHwkKS87CgogIGZ1bmN0aW9uIGdldFRyYW5zaXRpb25JbmZvIChlbCwgZXhwZWN0ZWRUeXBlKSB7CiAgICB2YXIgc3R5bGVzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwpOwogICAgLy8gSlNET00gbWF5IHJldHVybiB1bmRlZmluZWQgZm9yIHRyYW5zaXRpb24gcHJvcGVydGllcwogICAgdmFyIHRyYW5zaXRpb25EZWxheXMgPSAoc3R5bGVzW3RyYW5zaXRpb25Qcm9wICsgJ0RlbGF5J10gfHwgJycpLnNwbGl0KCcsICcpOwogICAgdmFyIHRyYW5zaXRpb25EdXJhdGlvbnMgPSAoc3R5bGVzW3RyYW5zaXRpb25Qcm9wICsgJ0R1cmF0aW9uJ10gfHwgJycpLnNwbGl0KCcsICcpOwogICAgdmFyIHRyYW5zaXRpb25UaW1lb3V0ID0gZ2V0VGltZW91dCh0cmFuc2l0aW9uRGVsYXlzLCB0cmFuc2l0aW9uRHVyYXRpb25zKTsKICAgIHZhciBhbmltYXRpb25EZWxheXMgPSAoc3R5bGVzW2FuaW1hdGlvblByb3AgKyAnRGVsYXknXSB8fCAnJykuc3BsaXQoJywgJyk7CiAgICB2YXIgYW5pbWF0aW9uRHVyYXRpb25zID0gKHN0eWxlc1thbmltYXRpb25Qcm9wICsgJ0R1cmF0aW9uJ10gfHwgJycpLnNwbGl0KCcsICcpOwogICAgdmFyIGFuaW1hdGlvblRpbWVvdXQgPSBnZXRUaW1lb3V0KGFuaW1hdGlvbkRlbGF5cywgYW5pbWF0aW9uRHVyYXRpb25zKTsKCiAgICB2YXIgdHlwZTsKICAgIHZhciB0aW1lb3V0ID0gMDsKICAgIHZhciBwcm9wQ291bnQgPSAwOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoZXhwZWN0ZWRUeXBlID09PSBUUkFOU0lUSU9OKSB7CiAgICAgIGlmICh0cmFuc2l0aW9uVGltZW91dCA+IDApIHsKICAgICAgICB0eXBlID0gVFJBTlNJVElPTjsKICAgICAgICB0aW1lb3V0ID0gdHJhbnNpdGlvblRpbWVvdXQ7CiAgICAgICAgcHJvcENvdW50ID0gdHJhbnNpdGlvbkR1cmF0aW9ucy5sZW5ndGg7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXhwZWN0ZWRUeXBlID09PSBBTklNQVRJT04pIHsKICAgICAgaWYgKGFuaW1hdGlvblRpbWVvdXQgPiAwKSB7CiAgICAgICAgdHlwZSA9IEFOSU1BVElPTjsKICAgICAgICB0aW1lb3V0ID0gYW5pbWF0aW9uVGltZW91dDsKICAgICAgICBwcm9wQ291bnQgPSBhbmltYXRpb25EdXJhdGlvbnMubGVuZ3RoOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aW1lb3V0ID0gTWF0aC5tYXgodHJhbnNpdGlvblRpbWVvdXQsIGFuaW1hdGlvblRpbWVvdXQpOwogICAgICB0eXBlID0gdGltZW91dCA+IDAKICAgICAgICA/IHRyYW5zaXRpb25UaW1lb3V0ID4gYW5pbWF0aW9uVGltZW91dAogICAgICAgICAgPyBUUkFOU0lUSU9OCiAgICAgICAgICA6IEFOSU1BVElPTgogICAgICAgIDogbnVsbDsKICAgICAgcHJvcENvdW50ID0gdHlwZQogICAgICAgID8gdHlwZSA9PT0gVFJBTlNJVElPTgogICAgICAgICAgPyB0cmFuc2l0aW9uRHVyYXRpb25zLmxlbmd0aAogICAgICAgICAgOiBhbmltYXRpb25EdXJhdGlvbnMubGVuZ3RoCiAgICAgICAgOiAwOwogICAgfQogICAgdmFyIGhhc1RyYW5zZm9ybSA9CiAgICAgIHR5cGUgPT09IFRSQU5TSVRJT04gJiYKICAgICAgdHJhbnNmb3JtUkUudGVzdChzdHlsZXNbdHJhbnNpdGlvblByb3AgKyAnUHJvcGVydHknXSk7CiAgICByZXR1cm4gewogICAgICB0eXBlOiB0eXBlLAogICAgICB0aW1lb3V0OiB0aW1lb3V0LAogICAgICBwcm9wQ291bnQ6IHByb3BDb3VudCwKICAgICAgaGFzVHJhbnNmb3JtOiBoYXNUcmFuc2Zvcm0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldFRpbWVvdXQgKGRlbGF5cywgZHVyYXRpb25zKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgd2hpbGUgKGRlbGF5cy5sZW5ndGggPCBkdXJhdGlvbnMubGVuZ3RoKSB7CiAgICAgIGRlbGF5cyA9IGRlbGF5cy5jb25jYXQoZGVsYXlzKTsKICAgIH0KCiAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkobnVsbCwgZHVyYXRpb25zLm1hcChmdW5jdGlvbiAoZCwgaSkgewogICAgICByZXR1cm4gdG9NcyhkKSArIHRvTXMoZGVsYXlzW2ldKQogICAgfSkpCiAgfQoKICAvLyBPbGQgdmVyc2lvbnMgb2YgQ2hyb21pdW0gKGJlbG93IDYxLjAuMzE2My4xMDApIGZvcm1hdHMgZmxvYXRpbmcgcG9pbnRlciBudW1iZXJzCiAgLy8gaW4gYSBsb2NhbGUtZGVwZW5kZW50IHdheSwgdXNpbmcgYSBjb21tYSBpbnN0ZWFkIG9mIGEgZG90LgogIC8vIElmIGNvbW1hIGlzIG5vdCByZXBsYWNlZCB3aXRoIGEgZG90LCB0aGUgaW5wdXQgd2lsbCBiZSByb3VuZGVkIGRvd24gKGkuZS4gYWN0aW5nCiAgLy8gYXMgYSBmbG9vciBmdW5jdGlvbikgY2F1c2luZyB1bmV4cGVjdGVkIGJlaGF2aW9ycwogIGZ1bmN0aW9uIHRvTXMgKHMpIHsKICAgIHJldHVybiBOdW1iZXIocy5zbGljZSgwLCAtMSkucmVwbGFjZSgnLCcsICcuJykpICogMTAwMAogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGVudGVyICh2bm9kZSwgdG9nZ2xlRGlzcGxheSkgewogICAgdmFyIGVsID0gdm5vZGUuZWxtOwoKICAgIC8vIGNhbGwgbGVhdmUgY2FsbGJhY2sgbm93CiAgICBpZiAoaXNEZWYoZWwuX2xlYXZlQ2IpKSB7CiAgICAgIGVsLl9sZWF2ZUNiLmNhbmNlbGxlZCA9IHRydWU7CiAgICAgIGVsLl9sZWF2ZUNiKCk7CiAgICB9CgogICAgdmFyIGRhdGEgPSByZXNvbHZlVHJhbnNpdGlvbih2bm9kZS5kYXRhLnRyYW5zaXRpb24pOwogICAgaWYgKGlzVW5kZWYoZGF0YSkpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNEZWYoZWwuX2VudGVyQ2IpIHx8IGVsLm5vZGVUeXBlICE9PSAxKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBjc3MgPSBkYXRhLmNzczsKICAgIHZhciB0eXBlID0gZGF0YS50eXBlOwogICAgdmFyIGVudGVyQ2xhc3MgPSBkYXRhLmVudGVyQ2xhc3M7CiAgICB2YXIgZW50ZXJUb0NsYXNzID0gZGF0YS5lbnRlclRvQ2xhc3M7CiAgICB2YXIgZW50ZXJBY3RpdmVDbGFzcyA9IGRhdGEuZW50ZXJBY3RpdmVDbGFzczsKICAgIHZhciBhcHBlYXJDbGFzcyA9IGRhdGEuYXBwZWFyQ2xhc3M7CiAgICB2YXIgYXBwZWFyVG9DbGFzcyA9IGRhdGEuYXBwZWFyVG9DbGFzczsKICAgIHZhciBhcHBlYXJBY3RpdmVDbGFzcyA9IGRhdGEuYXBwZWFyQWN0aXZlQ2xhc3M7CiAgICB2YXIgYmVmb3JlRW50ZXIgPSBkYXRhLmJlZm9yZUVudGVyOwogICAgdmFyIGVudGVyID0gZGF0YS5lbnRlcjsKICAgIHZhciBhZnRlckVudGVyID0gZGF0YS5hZnRlckVudGVyOwogICAgdmFyIGVudGVyQ2FuY2VsbGVkID0gZGF0YS5lbnRlckNhbmNlbGxlZDsKICAgIHZhciBiZWZvcmVBcHBlYXIgPSBkYXRhLmJlZm9yZUFwcGVhcjsKICAgIHZhciBhcHBlYXIgPSBkYXRhLmFwcGVhcjsKICAgIHZhciBhZnRlckFwcGVhciA9IGRhdGEuYWZ0ZXJBcHBlYXI7CiAgICB2YXIgYXBwZWFyQ2FuY2VsbGVkID0gZGF0YS5hcHBlYXJDYW5jZWxsZWQ7CiAgICB2YXIgZHVyYXRpb24gPSBkYXRhLmR1cmF0aW9uOwoKICAgIC8vIGFjdGl2ZUluc3RhbmNlIHdpbGwgYWx3YXlzIGJlIHRoZSA8dHJhbnNpdGlvbj4gY29tcG9uZW50IG1hbmFnaW5nIHRoaXMKICAgIC8vIHRyYW5zaXRpb24uIE9uZSBlZGdlIGNhc2UgdG8gY2hlY2sgaXMgd2hlbiB0aGUgPHRyYW5zaXRpb24+IGlzIHBsYWNlZAogICAgLy8gYXMgdGhlIHJvb3Qgbm9kZSBvZiBhIGNoaWxkIGNvbXBvbmVudC4gSW4gdGhhdCBjYXNlIHdlIG5lZWQgdG8gY2hlY2sKICAgIC8vIDx0cmFuc2l0aW9uPidzIHBhcmVudCBmb3IgYXBwZWFyIGNoZWNrLgogICAgdmFyIGNvbnRleHQgPSBhY3RpdmVJbnN0YW5jZTsKICAgIHZhciB0cmFuc2l0aW9uTm9kZSA9IGFjdGl2ZUluc3RhbmNlLiR2bm9kZTsKICAgIHdoaWxlICh0cmFuc2l0aW9uTm9kZSAmJiB0cmFuc2l0aW9uTm9kZS5wYXJlbnQpIHsKICAgICAgY29udGV4dCA9IHRyYW5zaXRpb25Ob2RlLmNvbnRleHQ7CiAgICAgIHRyYW5zaXRpb25Ob2RlID0gdHJhbnNpdGlvbk5vZGUucGFyZW50OwogICAgfQoKICAgIHZhciBpc0FwcGVhciA9ICFjb250ZXh0Ll9pc01vdW50ZWQgfHwgIXZub2RlLmlzUm9vdEluc2VydDsKCiAgICBpZiAoaXNBcHBlYXIgJiYgIWFwcGVhciAmJiBhcHBlYXIgIT09ICcnKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBzdGFydENsYXNzID0gaXNBcHBlYXIgJiYgYXBwZWFyQ2xhc3MKICAgICAgPyBhcHBlYXJDbGFzcwogICAgICA6IGVudGVyQ2xhc3M7CiAgICB2YXIgYWN0aXZlQ2xhc3MgPSBpc0FwcGVhciAmJiBhcHBlYXJBY3RpdmVDbGFzcwogICAgICA/IGFwcGVhckFjdGl2ZUNsYXNzCiAgICAgIDogZW50ZXJBY3RpdmVDbGFzczsKICAgIHZhciB0b0NsYXNzID0gaXNBcHBlYXIgJiYgYXBwZWFyVG9DbGFzcwogICAgICA/IGFwcGVhclRvQ2xhc3MKICAgICAgOiBlbnRlclRvQ2xhc3M7CgogICAgdmFyIGJlZm9yZUVudGVySG9vayA9IGlzQXBwZWFyCiAgICAgID8gKGJlZm9yZUFwcGVhciB8fCBiZWZvcmVFbnRlcikKICAgICAgOiBiZWZvcmVFbnRlcjsKICAgIHZhciBlbnRlckhvb2sgPSBpc0FwcGVhcgogICAgICA/ICh0eXBlb2YgYXBwZWFyID09PSAnZnVuY3Rpb24nID8gYXBwZWFyIDogZW50ZXIpCiAgICAgIDogZW50ZXI7CiAgICB2YXIgYWZ0ZXJFbnRlckhvb2sgPSBpc0FwcGVhcgogICAgICA/IChhZnRlckFwcGVhciB8fCBhZnRlckVudGVyKQogICAgICA6IGFmdGVyRW50ZXI7CiAgICB2YXIgZW50ZXJDYW5jZWxsZWRIb29rID0gaXNBcHBlYXIKICAgICAgPyAoYXBwZWFyQ2FuY2VsbGVkIHx8IGVudGVyQ2FuY2VsbGVkKQogICAgICA6IGVudGVyQ2FuY2VsbGVkOwoKICAgIHZhciBleHBsaWNpdEVudGVyRHVyYXRpb24gPSB0b051bWJlcigKICAgICAgaXNPYmplY3QoZHVyYXRpb24pCiAgICAgICAgPyBkdXJhdGlvbi5lbnRlcgogICAgICAgIDogZHVyYXRpb24KICAgICk7CgogICAgaWYgKGV4cGxpY2l0RW50ZXJEdXJhdGlvbiAhPSBudWxsKSB7CiAgICAgIGNoZWNrRHVyYXRpb24oZXhwbGljaXRFbnRlckR1cmF0aW9uLCAnZW50ZXInLCB2bm9kZSk7CiAgICB9CgogICAgdmFyIGV4cGVjdHNDU1MgPSBjc3MgIT09IGZhbHNlICYmICFpc0lFOTsKICAgIHZhciB1c2VyV2FudHNDb250cm9sID0gZ2V0SG9va0FyZ3VtZW50c0xlbmd0aChlbnRlckhvb2spOwoKICAgIHZhciBjYiA9IGVsLl9lbnRlckNiID0gb25jZShmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChleHBlY3RzQ1NTKSB7CiAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCB0b0NsYXNzKTsKICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIGFjdGl2ZUNsYXNzKTsKICAgICAgfQogICAgICBpZiAoY2IuY2FuY2VsbGVkKSB7CiAgICAgICAgaWYgKGV4cGVjdHNDU1MpIHsKICAgICAgICAgIHJlbW92ZVRyYW5zaXRpb25DbGFzcyhlbCwgc3RhcnRDbGFzcyk7CiAgICAgICAgfQogICAgICAgIGVudGVyQ2FuY2VsbGVkSG9vayAmJiBlbnRlckNhbmNlbGxlZEhvb2soZWwpOwogICAgICB9IGVsc2UgewogICAgICAgIGFmdGVyRW50ZXJIb29rICYmIGFmdGVyRW50ZXJIb29rKGVsKTsKICAgICAgfQogICAgICBlbC5fZW50ZXJDYiA9IG51bGw7CiAgICB9KTsKCiAgICBpZiAoIXZub2RlLmRhdGEuc2hvdykgewogICAgICAvLyByZW1vdmUgcGVuZGluZyBsZWF2ZSBlbGVtZW50IG9uIGVudGVyIGJ5IGluamVjdGluZyBhbiBpbnNlcnQgaG9vawogICAgICBtZXJnZVZOb2RlSG9vayh2bm9kZSwgJ2luc2VydCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcGFyZW50ID0gZWwucGFyZW50Tm9kZTsKICAgICAgICB2YXIgcGVuZGluZ05vZGUgPSBwYXJlbnQgJiYgcGFyZW50Ll9wZW5kaW5nICYmIHBhcmVudC5fcGVuZGluZ1t2bm9kZS5rZXldOwogICAgICAgIGlmIChwZW5kaW5nTm9kZSAmJgogICAgICAgICAgcGVuZGluZ05vZGUudGFnID09PSB2bm9kZS50YWcgJiYKICAgICAgICAgIHBlbmRpbmdOb2RlLmVsbS5fbGVhdmVDYgogICAgICAgICkgewogICAgICAgICAgcGVuZGluZ05vZGUuZWxtLl9sZWF2ZUNiKCk7CiAgICAgICAgfQogICAgICAgIGVudGVySG9vayAmJiBlbnRlckhvb2soZWwsIGNiKTsKICAgICAgfSk7CiAgICB9CgogICAgLy8gc3RhcnQgZW50ZXIgdHJhbnNpdGlvbgogICAgYmVmb3JlRW50ZXJIb29rICYmIGJlZm9yZUVudGVySG9vayhlbCk7CiAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIHN0YXJ0Q2xhc3MpOwogICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIGFjdGl2ZUNsYXNzKTsKICAgICAgbmV4dEZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIHN0YXJ0Q2xhc3MpOwogICAgICAgIGlmICghY2IuY2FuY2VsbGVkKSB7CiAgICAgICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIHRvQ2xhc3MpOwogICAgICAgICAgaWYgKCF1c2VyV2FudHNDb250cm9sKSB7CiAgICAgICAgICAgIGlmIChpc1ZhbGlkRHVyYXRpb24oZXhwbGljaXRFbnRlckR1cmF0aW9uKSkgewogICAgICAgICAgICAgIHNldFRpbWVvdXQoY2IsIGV4cGxpY2l0RW50ZXJEdXJhdGlvbik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgd2hlblRyYW5zaXRpb25FbmRzKGVsLCB0eXBlLCBjYik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIGlmICh2bm9kZS5kYXRhLnNob3cpIHsKICAgICAgdG9nZ2xlRGlzcGxheSAmJiB0b2dnbGVEaXNwbGF5KCk7CiAgICAgIGVudGVySG9vayAmJiBlbnRlckhvb2soZWwsIGNiKTsKICAgIH0KCiAgICBpZiAoIWV4cGVjdHNDU1MgJiYgIXVzZXJXYW50c0NvbnRyb2wpIHsKICAgICAgY2IoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGxlYXZlICh2bm9kZSwgcm0pIHsKICAgIHZhciBlbCA9IHZub2RlLmVsbTsKCiAgICAvLyBjYWxsIGVudGVyIGNhbGxiYWNrIG5vdwogICAgaWYgKGlzRGVmKGVsLl9lbnRlckNiKSkgewogICAgICBlbC5fZW50ZXJDYi5jYW5jZWxsZWQgPSB0cnVlOwogICAgICBlbC5fZW50ZXJDYigpOwogICAgfQoKICAgIHZhciBkYXRhID0gcmVzb2x2ZVRyYW5zaXRpb24odm5vZGUuZGF0YS50cmFuc2l0aW9uKTsKICAgIGlmIChpc1VuZGVmKGRhdGEpIHx8IGVsLm5vZGVUeXBlICE9PSAxKSB7CiAgICAgIHJldHVybiBybSgpCiAgICB9CgogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNEZWYoZWwuX2xlYXZlQ2IpKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBjc3MgPSBkYXRhLmNzczsKICAgIHZhciB0eXBlID0gZGF0YS50eXBlOwogICAgdmFyIGxlYXZlQ2xhc3MgPSBkYXRhLmxlYXZlQ2xhc3M7CiAgICB2YXIgbGVhdmVUb0NsYXNzID0gZGF0YS5sZWF2ZVRvQ2xhc3M7CiAgICB2YXIgbGVhdmVBY3RpdmVDbGFzcyA9IGRhdGEubGVhdmVBY3RpdmVDbGFzczsKICAgIHZhciBiZWZvcmVMZWF2ZSA9IGRhdGEuYmVmb3JlTGVhdmU7CiAgICB2YXIgbGVhdmUgPSBkYXRhLmxlYXZlOwogICAgdmFyIGFmdGVyTGVhdmUgPSBkYXRhLmFmdGVyTGVhdmU7CiAgICB2YXIgbGVhdmVDYW5jZWxsZWQgPSBkYXRhLmxlYXZlQ2FuY2VsbGVkOwogICAgdmFyIGRlbGF5TGVhdmUgPSBkYXRhLmRlbGF5TGVhdmU7CiAgICB2YXIgZHVyYXRpb24gPSBkYXRhLmR1cmF0aW9uOwoKICAgIHZhciBleHBlY3RzQ1NTID0gY3NzICE9PSBmYWxzZSAmJiAhaXNJRTk7CiAgICB2YXIgdXNlcldhbnRzQ29udHJvbCA9IGdldEhvb2tBcmd1bWVudHNMZW5ndGgobGVhdmUpOwoKICAgIHZhciBleHBsaWNpdExlYXZlRHVyYXRpb24gPSB0b051bWJlcigKICAgICAgaXNPYmplY3QoZHVyYXRpb24pCiAgICAgICAgPyBkdXJhdGlvbi5sZWF2ZQogICAgICAgIDogZHVyYXRpb24KICAgICk7CgogICAgaWYgKGlzRGVmKGV4cGxpY2l0TGVhdmVEdXJhdGlvbikpIHsKICAgICAgY2hlY2tEdXJhdGlvbihleHBsaWNpdExlYXZlRHVyYXRpb24sICdsZWF2ZScsIHZub2RlKTsKICAgIH0KCiAgICB2YXIgY2IgPSBlbC5fbGVhdmVDYiA9IG9uY2UoZnVuY3Rpb24gKCkgewogICAgICBpZiAoZWwucGFyZW50Tm9kZSAmJiBlbC5wYXJlbnROb2RlLl9wZW5kaW5nKSB7CiAgICAgICAgZWwucGFyZW50Tm9kZS5fcGVuZGluZ1t2bm9kZS5rZXldID0gbnVsbDsKICAgICAgfQogICAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICAgIHJlbW92ZVRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVUb0NsYXNzKTsKICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIGxlYXZlQWN0aXZlQ2xhc3MpOwogICAgICB9CiAgICAgIGlmIChjYi5jYW5jZWxsZWQpIHsKICAgICAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCBsZWF2ZUNsYXNzKTsKICAgICAgICB9CiAgICAgICAgbGVhdmVDYW5jZWxsZWQgJiYgbGVhdmVDYW5jZWxsZWQoZWwpOwogICAgICB9IGVsc2UgewogICAgICAgIHJtKCk7CiAgICAgICAgYWZ0ZXJMZWF2ZSAmJiBhZnRlckxlYXZlKGVsKTsKICAgICAgfQogICAgICBlbC5fbGVhdmVDYiA9IG51bGw7CiAgICB9KTsKCiAgICBpZiAoZGVsYXlMZWF2ZSkgewogICAgICBkZWxheUxlYXZlKHBlcmZvcm1MZWF2ZSk7CiAgICB9IGVsc2UgewogICAgICBwZXJmb3JtTGVhdmUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwZXJmb3JtTGVhdmUgKCkgewogICAgICAvLyB0aGUgZGVsYXllZCBsZWF2ZSBtYXkgaGF2ZSBhbHJlYWR5IGJlZW4gY2FuY2VsbGVkCiAgICAgIGlmIChjYi5jYW5jZWxsZWQpIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICAvLyByZWNvcmQgbGVhdmluZyBlbGVtZW50CiAgICAgIGlmICghdm5vZGUuZGF0YS5zaG93ICYmIGVsLnBhcmVudE5vZGUpIHsKICAgICAgICAoZWwucGFyZW50Tm9kZS5fcGVuZGluZyB8fCAoZWwucGFyZW50Tm9kZS5fcGVuZGluZyA9IHt9KSlbKHZub2RlLmtleSldID0gdm5vZGU7CiAgICAgIH0KICAgICAgYmVmb3JlTGVhdmUgJiYgYmVmb3JlTGVhdmUoZWwpOwogICAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICAgIGFkZFRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVDbGFzcyk7CiAgICAgICAgYWRkVHJhbnNpdGlvbkNsYXNzKGVsLCBsZWF2ZUFjdGl2ZUNsYXNzKTsKICAgICAgICBuZXh0RnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCBsZWF2ZUNsYXNzKTsKICAgICAgICAgIGlmICghY2IuY2FuY2VsbGVkKSB7CiAgICAgICAgICAgIGFkZFRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVUb0NsYXNzKTsKICAgICAgICAgICAgaWYgKCF1c2VyV2FudHNDb250cm9sKSB7CiAgICAgICAgICAgICAgaWYgKGlzVmFsaWREdXJhdGlvbihleHBsaWNpdExlYXZlRHVyYXRpb24pKSB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNiLCBleHBsaWNpdExlYXZlRHVyYXRpb24pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3aGVuVHJhbnNpdGlvbkVuZHMoZWwsIHR5cGUsIGNiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICBsZWF2ZSAmJiBsZWF2ZShlbCwgY2IpOwogICAgICBpZiAoIWV4cGVjdHNDU1MgJiYgIXVzZXJXYW50c0NvbnRyb2wpIHsKICAgICAgICBjYigpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBvbmx5IHVzZWQgaW4gZGV2IG1vZGUKICBmdW5jdGlvbiBjaGVja0R1cmF0aW9uICh2YWwsIG5hbWUsIHZub2RlKSB7CiAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ251bWJlcicpIHsKICAgICAgd2FybigKICAgICAgICAiPHRyYW5zaXRpb24+IGV4cGxpY2l0ICIgKyBuYW1lICsgIiBkdXJhdGlvbiBpcyBub3QgYSB2YWxpZCBudW1iZXIgLSAiICsKICAgICAgICAiZ290ICIgKyAoSlNPTi5zdHJpbmdpZnkodmFsKSkgKyAiLiIsCiAgICAgICAgdm5vZGUuY29udGV4dAogICAgICApOwogICAgfSBlbHNlIGlmIChpc05hTih2YWwpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgIjx0cmFuc2l0aW9uPiBleHBsaWNpdCAiICsgbmFtZSArICIgZHVyYXRpb24gaXMgTmFOIC0gIiArCiAgICAgICAgJ3RoZSBkdXJhdGlvbiBleHByZXNzaW9uIG1pZ2h0IGJlIGluY29ycmVjdC4nLAogICAgICAgIHZub2RlLmNvbnRleHQKICAgICAgKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzVmFsaWREdXJhdGlvbiAodmFsKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ251bWJlcicgJiYgIWlzTmFOKHZhbCkKICB9CgogIC8qKgogICAqIE5vcm1hbGl6ZSBhIHRyYW5zaXRpb24gaG9vaydzIGFyZ3VtZW50IGxlbmd0aC4gVGhlIGhvb2sgbWF5IGJlOgogICAqIC0gYSBtZXJnZWQgaG9vayAoaW52b2tlcikgd2l0aCB0aGUgb3JpZ2luYWwgaW4gLmZucwogICAqIC0gYSB3cmFwcGVkIGNvbXBvbmVudCBtZXRob2QgKGNoZWNrIC5fbGVuZ3RoKQogICAqIC0gYSBwbGFpbiBmdW5jdGlvbiAoLmxlbmd0aCkKICAgKi8KICBmdW5jdGlvbiBnZXRIb29rQXJndW1lbnRzTGVuZ3RoIChmbikgewogICAgaWYgKGlzVW5kZWYoZm4pKSB7CiAgICAgIHJldHVybiBmYWxzZQogICAgfQogICAgdmFyIGludm9rZXJGbnMgPSBmbi5mbnM7CiAgICBpZiAoaXNEZWYoaW52b2tlckZucykpIHsKICAgICAgLy8gaW52b2tlcgogICAgICByZXR1cm4gZ2V0SG9va0FyZ3VtZW50c0xlbmd0aCgKICAgICAgICBBcnJheS5pc0FycmF5KGludm9rZXJGbnMpCiAgICAgICAgICA/IGludm9rZXJGbnNbMF0KICAgICAgICAgIDogaW52b2tlckZucwogICAgICApCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gKGZuLl9sZW5ndGggfHwgZm4ubGVuZ3RoKSA+IDEKICAgIH0KICB9CgogIGZ1bmN0aW9uIF9lbnRlciAoXywgdm5vZGUpIHsKICAgIGlmICh2bm9kZS5kYXRhLnNob3cgIT09IHRydWUpIHsKICAgICAgZW50ZXIodm5vZGUpOwogICAgfQogIH0KCiAgdmFyIHRyYW5zaXRpb24gPSBpbkJyb3dzZXIgPyB7CiAgICBjcmVhdGU6IF9lbnRlciwKICAgIGFjdGl2YXRlOiBfZW50ZXIsCiAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZSQkMSAodm5vZGUsIHJtKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgIGlmICh2bm9kZS5kYXRhLnNob3cgIT09IHRydWUpIHsKICAgICAgICBsZWF2ZSh2bm9kZSwgcm0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJtKCk7CiAgICAgIH0KICAgIH0KICB9IDoge307CgogIHZhciBwbGF0Zm9ybU1vZHVsZXMgPSBbCiAgICBhdHRycywKICAgIGtsYXNzLAogICAgZXZlbnRzLAogICAgZG9tUHJvcHMsCiAgICBzdHlsZSwKICAgIHRyYW5zaXRpb24KICBdOwoKICAvKiAgKi8KCiAgLy8gdGhlIGRpcmVjdGl2ZSBtb2R1bGUgc2hvdWxkIGJlIGFwcGxpZWQgbGFzdCwgYWZ0ZXIgYWxsCiAgLy8gYnVpbHQtaW4gbW9kdWxlcyBoYXZlIGJlZW4gYXBwbGllZC4KICB2YXIgbW9kdWxlcyA9IHBsYXRmb3JtTW9kdWxlcy5jb25jYXQoYmFzZU1vZHVsZXMpOwoKICB2YXIgcGF0Y2ggPSBjcmVhdGVQYXRjaEZ1bmN0aW9uKHsgbm9kZU9wczogbm9kZU9wcywgbW9kdWxlczogbW9kdWxlcyB9KTsKCiAgLyoqCiAgICogTm90IHR5cGUgY2hlY2tpbmcgdGhpcyBmaWxlIGJlY2F1c2UgZmxvdyBkb2Vzbid0IGxpa2UgYXR0YWNoaW5nCiAgICogcHJvcGVydGllcyB0byBFbGVtZW50cy4KICAgKi8KCiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKGlzSUU5KSB7CiAgICAvLyBodHRwOi8vd3d3Lm1hdHRzNDExLmNvbS9wb3N0L2ludGVybmV0LWV4cGxvcmVyLTktb25pbnB1dC8KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3NlbGVjdGlvbmNoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKICAgICAgaWYgKGVsICYmIGVsLnZtb2RlbCkgewogICAgICAgIHRyaWdnZXIoZWwsICdpbnB1dCcpOwogICAgICB9CiAgICB9KTsKICB9CgogIHZhciBkaXJlY3RpdmUgPSB7CiAgICBpbnNlcnRlZDogZnVuY3Rpb24gaW5zZXJ0ZWQgKGVsLCBiaW5kaW5nLCB2bm9kZSwgb2xkVm5vZGUpIHsKICAgICAgaWYgKHZub2RlLnRhZyA9PT0gJ3NlbGVjdCcpIHsKICAgICAgICAvLyAjNjkwMwogICAgICAgIGlmIChvbGRWbm9kZS5lbG0gJiYgIW9sZFZub2RlLmVsbS5fdk9wdGlvbnMpIHsKICAgICAgICAgIG1lcmdlVk5vZGVIb29rKHZub2RlLCAncG9zdHBhdGNoJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkaXJlY3RpdmUuY29tcG9uZW50VXBkYXRlZChlbCwgYmluZGluZywgdm5vZGUpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldFNlbGVjdGVkKGVsLCBiaW5kaW5nLCB2bm9kZS5jb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgZWwuX3ZPcHRpb25zID0gW10ubWFwLmNhbGwoZWwub3B0aW9ucywgZ2V0VmFsdWUpOwogICAgICB9IGVsc2UgaWYgKHZub2RlLnRhZyA9PT0gJ3RleHRhcmVhJyB8fCBpc1RleHRJbnB1dFR5cGUoZWwudHlwZSkpIHsKICAgICAgICBlbC5fdk1vZGlmaWVycyA9IGJpbmRpbmcubW9kaWZpZXJzOwogICAgICAgIGlmICghYmluZGluZy5tb2RpZmllcnMubGF6eSkgewogICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY29tcG9zaXRpb25zdGFydCcsIG9uQ29tcG9zaXRpb25TdGFydCk7CiAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjb21wb3NpdGlvbmVuZCcsIG9uQ29tcG9zaXRpb25FbmQpOwogICAgICAgICAgLy8gU2FmYXJpIDwgMTAuMiAmIFVJV2ViVmlldyBkb2Vzbid0IGZpcmUgY29tcG9zaXRpb25lbmQgd2hlbgogICAgICAgICAgLy8gc3dpdGNoaW5nIGZvY3VzIGJlZm9yZSBjb25maXJtaW5nIGNvbXBvc2l0aW9uIGNob2ljZQogICAgICAgICAgLy8gdGhpcyBhbHNvIGZpeGVzIHRoZSBpc3N1ZSB3aGVyZSBzb21lIGJyb3dzZXJzIGUuZy4gaU9TIENocm9tZQogICAgICAgICAgLy8gZmlyZXMgImNoYW5nZSIgaW5zdGVhZCBvZiAiaW5wdXQiIG9uIGF1dG9jb21wbGV0ZS4KICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQ29tcG9zaXRpb25FbmQpOwogICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgICBpZiAoaXNJRTkpIHsKICAgICAgICAgICAgZWwudm1vZGVsID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgY29tcG9uZW50VXBkYXRlZDogZnVuY3Rpb24gY29tcG9uZW50VXBkYXRlZCAoZWwsIGJpbmRpbmcsIHZub2RlKSB7CiAgICAgIGlmICh2bm9kZS50YWcgPT09ICdzZWxlY3QnKSB7CiAgICAgICAgc2V0U2VsZWN0ZWQoZWwsIGJpbmRpbmcsIHZub2RlLmNvbnRleHQpOwogICAgICAgIC8vIGluIGNhc2UgdGhlIG9wdGlvbnMgcmVuZGVyZWQgYnkgdi1mb3IgaGF2ZSBjaGFuZ2VkLAogICAgICAgIC8vIGl0J3MgcG9zc2libGUgdGhhdCB0aGUgdmFsdWUgaXMgb3V0LW9mLXN5bmMgd2l0aCB0aGUgcmVuZGVyZWQgb3B0aW9ucy4KICAgICAgICAvLyBkZXRlY3Qgc3VjaCBjYXNlcyBhbmQgZmlsdGVyIG91dCB2YWx1ZXMgdGhhdCBubyBsb25nZXIgaGFzIGEgbWF0Y2hpbmcKICAgICAgICAvLyBvcHRpb24gaW4gdGhlIERPTS4KICAgICAgICB2YXIgcHJldk9wdGlvbnMgPSBlbC5fdk9wdGlvbnM7CiAgICAgICAgdmFyIGN1ck9wdGlvbnMgPSBlbC5fdk9wdGlvbnMgPSBbXS5tYXAuY2FsbChlbC5vcHRpb25zLCBnZXRWYWx1ZSk7CiAgICAgICAgaWYgKGN1ck9wdGlvbnMuc29tZShmdW5jdGlvbiAobywgaSkgeyByZXR1cm4gIWxvb3NlRXF1YWwobywgcHJldk9wdGlvbnNbaV0pOyB9KSkgewogICAgICAgICAgLy8gdHJpZ2dlciBjaGFuZ2UgZXZlbnQgaWYKICAgICAgICAgIC8vIG5vIG1hdGNoaW5nIG9wdGlvbiBmb3VuZCBmb3IgYXQgbGVhc3Qgb25lIHZhbHVlCiAgICAgICAgICB2YXIgbmVlZFJlc2V0ID0gZWwubXVsdGlwbGUKICAgICAgICAgICAgPyBiaW5kaW5nLnZhbHVlLnNvbWUoZnVuY3Rpb24gKHYpIHsgcmV0dXJuIGhhc05vTWF0Y2hpbmdPcHRpb24odiwgY3VyT3B0aW9ucyk7IH0pCiAgICAgICAgICAgIDogYmluZGluZy52YWx1ZSAhPT0gYmluZGluZy5vbGRWYWx1ZSAmJiBoYXNOb01hdGNoaW5nT3B0aW9uKGJpbmRpbmcudmFsdWUsIGN1ck9wdGlvbnMpOwogICAgICAgICAgaWYgKG5lZWRSZXNldCkgewogICAgICAgICAgICB0cmlnZ2VyKGVsLCAnY2hhbmdlJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gc2V0U2VsZWN0ZWQgKGVsLCBiaW5kaW5nLCB2bSkgewogICAgYWN0dWFsbHlTZXRTZWxlY3RlZChlbCwgYmluZGluZywgdm0pOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoaXNJRSB8fCBpc0VkZ2UpIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgYWN0dWFsbHlTZXRTZWxlY3RlZChlbCwgYmluZGluZywgdm0pOwogICAgICB9LCAwKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGFjdHVhbGx5U2V0U2VsZWN0ZWQgKGVsLCBiaW5kaW5nLCB2bSkgewogICAgdmFyIHZhbHVlID0gYmluZGluZy52YWx1ZTsKICAgIHZhciBpc011bHRpcGxlID0gZWwubXVsdGlwbGU7CiAgICBpZiAoaXNNdWx0aXBsZSAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgd2FybigKICAgICAgICAiPHNlbGVjdCBtdWx0aXBsZSB2LW1vZGVsPVwiIiArIChiaW5kaW5nLmV4cHJlc3Npb24pICsgIlwiPiAiICsKICAgICAgICAiZXhwZWN0cyBhbiBBcnJheSB2YWx1ZSBmb3IgaXRzIGJpbmRpbmcsIGJ1dCBnb3QgIiArIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpLnNsaWNlKDgsIC0xKSksCiAgICAgICAgdm0KICAgICAgKTsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgc2VsZWN0ZWQsIG9wdGlvbjsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gZWwub3B0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgb3B0aW9uID0gZWwub3B0aW9uc1tpXTsKICAgICAgaWYgKGlzTXVsdGlwbGUpIHsKICAgICAgICBzZWxlY3RlZCA9IGxvb3NlSW5kZXhPZih2YWx1ZSwgZ2V0VmFsdWUob3B0aW9uKSkgPiAtMTsKICAgICAgICBpZiAob3B0aW9uLnNlbGVjdGVkICE9PSBzZWxlY3RlZCkgewogICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gc2VsZWN0ZWQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChsb29zZUVxdWFsKGdldFZhbHVlKG9wdGlvbiksIHZhbHVlKSkgewogICAgICAgICAgaWYgKGVsLnNlbGVjdGVkSW5kZXggIT09IGkpIHsKICAgICAgICAgICAgZWwuc2VsZWN0ZWRJbmRleCA9IGk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICghaXNNdWx0aXBsZSkgewogICAgICBlbC5zZWxlY3RlZEluZGV4ID0gLTE7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYXNOb01hdGNoaW5nT3B0aW9uICh2YWx1ZSwgb3B0aW9ucykgewogICAgcmV0dXJuIG9wdGlvbnMuZXZlcnkoZnVuY3Rpb24gKG8pIHsgcmV0dXJuICFsb29zZUVxdWFsKG8sIHZhbHVlKTsgfSkKICB9CgogIGZ1bmN0aW9uIGdldFZhbHVlIChvcHRpb24pIHsKICAgIHJldHVybiAnX3ZhbHVlJyBpbiBvcHRpb24KICAgICAgPyBvcHRpb24uX3ZhbHVlCiAgICAgIDogb3B0aW9uLnZhbHVlCiAgfQoKICBmdW5jdGlvbiBvbkNvbXBvc2l0aW9uU3RhcnQgKGUpIHsKICAgIGUudGFyZ2V0LmNvbXBvc2luZyA9IHRydWU7CiAgfQoKICBmdW5jdGlvbiBvbkNvbXBvc2l0aW9uRW5kIChlKSB7CiAgICAvLyBwcmV2ZW50IHRyaWdnZXJpbmcgYW4gaW5wdXQgZXZlbnQgZm9yIG5vIHJlYXNvbgogICAgaWYgKCFlLnRhcmdldC5jb21wb3NpbmcpIHsgcmV0dXJuIH0KICAgIGUudGFyZ2V0LmNvbXBvc2luZyA9IGZhbHNlOwogICAgdHJpZ2dlcihlLnRhcmdldCwgJ2lucHV0Jyk7CiAgfQoKICBmdW5jdGlvbiB0cmlnZ2VyIChlbCwgdHlwZSkgewogICAgdmFyIGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpOwogICAgZS5pbml0RXZlbnQodHlwZSwgdHJ1ZSwgdHJ1ZSk7CiAgICBlbC5kaXNwYXRjaEV2ZW50KGUpOwogIH0KCiAgLyogICovCgogIC8vIHJlY3Vyc2l2ZWx5IHNlYXJjaCBmb3IgcG9zc2libGUgdHJhbnNpdGlvbiBkZWZpbmVkIGluc2lkZSB0aGUgY29tcG9uZW50IHJvb3QKICBmdW5jdGlvbiBsb2NhdGVOb2RlICh2bm9kZSkgewogICAgcmV0dXJuIHZub2RlLmNvbXBvbmVudEluc3RhbmNlICYmICghdm5vZGUuZGF0YSB8fCAhdm5vZGUuZGF0YS50cmFuc2l0aW9uKQogICAgICA/IGxvY2F0ZU5vZGUodm5vZGUuY29tcG9uZW50SW5zdGFuY2UuX3Zub2RlKQogICAgICA6IHZub2RlCiAgfQoKICB2YXIgc2hvdyA9IHsKICAgIGJpbmQ6IGZ1bmN0aW9uIGJpbmQgKGVsLCByZWYsIHZub2RlKSB7CiAgICAgIHZhciB2YWx1ZSA9IHJlZi52YWx1ZTsKCiAgICAgIHZub2RlID0gbG9jYXRlTm9kZSh2bm9kZSk7CiAgICAgIHZhciB0cmFuc2l0aW9uJCQxID0gdm5vZGUuZGF0YSAmJiB2bm9kZS5kYXRhLnRyYW5zaXRpb247CiAgICAgIHZhciBvcmlnaW5hbERpc3BsYXkgPSBlbC5fX3ZPcmlnaW5hbERpc3BsYXkgPQogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPT09ICdub25lJyA/ICcnIDogZWwuc3R5bGUuZGlzcGxheTsKICAgICAgaWYgKHZhbHVlICYmIHRyYW5zaXRpb24kJDEpIHsKICAgICAgICB2bm9kZS5kYXRhLnNob3cgPSB0cnVlOwogICAgICAgIGVudGVyKHZub2RlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gb3JpZ2luYWxEaXNwbGF5OwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSB2YWx1ZSA/IG9yaWdpbmFsRGlzcGxheSA6ICdub25lJzsKICAgICAgfQogICAgfSwKCiAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZSAoZWwsIHJlZiwgdm5vZGUpIHsKICAgICAgdmFyIHZhbHVlID0gcmVmLnZhbHVlOwogICAgICB2YXIgb2xkVmFsdWUgPSByZWYub2xkVmFsdWU7CgogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCF2YWx1ZSA9PT0gIW9sZFZhbHVlKSB7IHJldHVybiB9CiAgICAgIHZub2RlID0gbG9jYXRlTm9kZSh2bm9kZSk7CiAgICAgIHZhciB0cmFuc2l0aW9uJCQxID0gdm5vZGUuZGF0YSAmJiB2bm9kZS5kYXRhLnRyYW5zaXRpb247CiAgICAgIGlmICh0cmFuc2l0aW9uJCQxKSB7CiAgICAgICAgdm5vZGUuZGF0YS5zaG93ID0gdHJ1ZTsKICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgIGVudGVyKHZub2RlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSBlbC5fX3ZPcmlnaW5hbERpc3BsYXk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGVhdmUodm5vZGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gdmFsdWUgPyBlbC5fX3ZPcmlnaW5hbERpc3BsYXkgOiAnbm9uZSc7CiAgICAgIH0KICAgIH0sCgogICAgdW5iaW5kOiBmdW5jdGlvbiB1bmJpbmQgKAogICAgICBlbCwKICAgICAgYmluZGluZywKICAgICAgdm5vZGUsCiAgICAgIG9sZFZub2RlLAogICAgICBpc0Rlc3Ryb3kKICAgICkgewogICAgICBpZiAoIWlzRGVzdHJveSkgewogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSBlbC5fX3ZPcmlnaW5hbERpc3BsYXk7CiAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgcGxhdGZvcm1EaXJlY3RpdmVzID0gewogICAgbW9kZWw6IGRpcmVjdGl2ZSwKICAgIHNob3c6IHNob3cKICB9OwoKICAvKiAgKi8KCiAgdmFyIHRyYW5zaXRpb25Qcm9wcyA9IHsKICAgIG5hbWU6IFN0cmluZywKICAgIGFwcGVhcjogQm9vbGVhbiwKICAgIGNzczogQm9vbGVhbiwKICAgIG1vZGU6IFN0cmluZywKICAgIHR5cGU6IFN0cmluZywKICAgIGVudGVyQ2xhc3M6IFN0cmluZywKICAgIGxlYXZlQ2xhc3M6IFN0cmluZywKICAgIGVudGVyVG9DbGFzczogU3RyaW5nLAogICAgbGVhdmVUb0NsYXNzOiBTdHJpbmcsCiAgICBlbnRlckFjdGl2ZUNsYXNzOiBTdHJpbmcsCiAgICBsZWF2ZUFjdGl2ZUNsYXNzOiBTdHJpbmcsCiAgICBhcHBlYXJDbGFzczogU3RyaW5nLAogICAgYXBwZWFyQWN0aXZlQ2xhc3M6IFN0cmluZywKICAgIGFwcGVhclRvQ2xhc3M6IFN0cmluZywKICAgIGR1cmF0aW9uOiBbTnVtYmVyLCBTdHJpbmcsIE9iamVjdF0KICB9OwoKICAvLyBpbiBjYXNlIHRoZSBjaGlsZCBpcyBhbHNvIGFuIGFic3RyYWN0IGNvbXBvbmVudCwgZS5nLiA8a2VlcC1hbGl2ZT4KICAvLyB3ZSB3YW50IHRvIHJlY3Vyc2l2ZWx5IHJldHJpZXZlIHRoZSByZWFsIGNvbXBvbmVudCB0byBiZSByZW5kZXJlZAogIGZ1bmN0aW9uIGdldFJlYWxDaGlsZCAodm5vZGUpIHsKICAgIHZhciBjb21wT3B0aW9ucyA9IHZub2RlICYmIHZub2RlLmNvbXBvbmVudE9wdGlvbnM7CiAgICBpZiAoY29tcE9wdGlvbnMgJiYgY29tcE9wdGlvbnMuQ3Rvci5vcHRpb25zLmFic3RyYWN0KSB7CiAgICAgIHJldHVybiBnZXRSZWFsQ2hpbGQoZ2V0Rmlyc3RDb21wb25lbnRDaGlsZChjb21wT3B0aW9ucy5jaGlsZHJlbikpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gdm5vZGUKICAgIH0KICB9CgogIGZ1bmN0aW9uIGV4dHJhY3RUcmFuc2l0aW9uRGF0YSAoY29tcCkgewogICAgdmFyIGRhdGEgPSB7fTsKICAgIHZhciBvcHRpb25zID0gY29tcC4kb3B0aW9uczsKICAgIC8vIHByb3BzCiAgICBmb3IgKHZhciBrZXkgaW4gb3B0aW9ucy5wcm9wc0RhdGEpIHsKICAgICAgZGF0YVtrZXldID0gY29tcFtrZXldOwogICAgfQogICAgLy8gZXZlbnRzLgogICAgLy8gZXh0cmFjdCBsaXN0ZW5lcnMgYW5kIHBhc3MgdGhlbSBkaXJlY3RseSB0byB0aGUgdHJhbnNpdGlvbiBtZXRob2RzCiAgICB2YXIgbGlzdGVuZXJzID0gb3B0aW9ucy5fcGFyZW50TGlzdGVuZXJzOwogICAgZm9yICh2YXIga2V5JDEgaW4gbGlzdGVuZXJzKSB7CiAgICAgIGRhdGFbY2FtZWxpemUoa2V5JDEpXSA9IGxpc3RlbmVyc1trZXkkMV07CiAgICB9CiAgICByZXR1cm4gZGF0YQogIH0KCiAgZnVuY3Rpb24gcGxhY2Vob2xkZXIgKGgsIHJhd0NoaWxkKSB7CiAgICBpZiAoL1xkLWtlZXAtYWxpdmUkLy50ZXN0KHJhd0NoaWxkLnRhZykpIHsKICAgICAgcmV0dXJuIGgoJ2tlZXAtYWxpdmUnLCB7CiAgICAgICAgcHJvcHM6IHJhd0NoaWxkLmNvbXBvbmVudE9wdGlvbnMucHJvcHNEYXRhCiAgICAgIH0pCiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYXNQYXJlbnRUcmFuc2l0aW9uICh2bm9kZSkgewogICAgd2hpbGUgKCh2bm9kZSA9IHZub2RlLnBhcmVudCkpIHsKICAgICAgaWYgKHZub2RlLmRhdGEudHJhbnNpdGlvbikgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzU2FtZUNoaWxkIChjaGlsZCwgb2xkQ2hpbGQpIHsKICAgIHJldHVybiBvbGRDaGlsZC5rZXkgPT09IGNoaWxkLmtleSAmJiBvbGRDaGlsZC50YWcgPT09IGNoaWxkLnRhZwogIH0KCiAgdmFyIGlzTm90VGV4dE5vZGUgPSBmdW5jdGlvbiAoYykgeyByZXR1cm4gYy50YWcgfHwgaXNBc3luY1BsYWNlaG9sZGVyKGMpOyB9OwoKICB2YXIgaXNWU2hvd0RpcmVjdGl2ZSA9IGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLm5hbWUgPT09ICdzaG93JzsgfTsKCiAgdmFyIFRyYW5zaXRpb24gPSB7CiAgICBuYW1lOiAndHJhbnNpdGlvbicsCiAgICBwcm9wczogdHJhbnNpdGlvblByb3BzLAogICAgYWJzdHJhY3Q6IHRydWUsCgogICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIgKGgpIHsKICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7CgogICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLiRzbG90cy5kZWZhdWx0OwogICAgICBpZiAoIWNoaWxkcmVuKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIC8vIGZpbHRlciBvdXQgdGV4dCBub2RlcyAocG9zc2libGUgd2hpdGVzcGFjZXMpCiAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uZmlsdGVyKGlzTm90VGV4dE5vZGUpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gd2FybiBtdWx0aXBsZSBlbGVtZW50cwogICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAnPHRyYW5zaXRpb24+IGNhbiBvbmx5IGJlIHVzZWQgb24gYSBzaW5nbGUgZWxlbWVudC4gVXNlICcgKwogICAgICAgICAgJzx0cmFuc2l0aW9uLWdyb3VwPiBmb3IgbGlzdHMuJywKICAgICAgICAgIHRoaXMuJHBhcmVudAogICAgICAgICk7CiAgICAgIH0KCiAgICAgIHZhciBtb2RlID0gdGhpcy5tb2RlOwoKICAgICAgLy8gd2FybiBpbnZhbGlkIG1vZGUKICAgICAgaWYgKG1vZGUgJiYgbW9kZSAhPT0gJ2luLW91dCcgJiYgbW9kZSAhPT0gJ291dC1pbicKICAgICAgKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdpbnZhbGlkIDx0cmFuc2l0aW9uPiBtb2RlOiAnICsgbW9kZSwKICAgICAgICAgIHRoaXMuJHBhcmVudAogICAgICAgICk7CiAgICAgIH0KCiAgICAgIHZhciByYXdDaGlsZCA9IGNoaWxkcmVuWzBdOwoKICAgICAgLy8gaWYgdGhpcyBpcyBhIGNvbXBvbmVudCByb290IG5vZGUgYW5kIHRoZSBjb21wb25lbnQncwogICAgICAvLyBwYXJlbnQgY29udGFpbmVyIG5vZGUgYWxzbyBoYXMgdHJhbnNpdGlvbiwgc2tpcC4KICAgICAgaWYgKGhhc1BhcmVudFRyYW5zaXRpb24odGhpcy4kdm5vZGUpKSB7CiAgICAgICAgcmV0dXJuIHJhd0NoaWxkCiAgICAgIH0KCiAgICAgIC8vIGFwcGx5IHRyYW5zaXRpb24gZGF0YSB0byBjaGlsZAogICAgICAvLyB1c2UgZ2V0UmVhbENoaWxkKCkgdG8gaWdub3JlIGFic3RyYWN0IGNvbXBvbmVudHMgZS5nLiBrZWVwLWFsaXZlCiAgICAgIHZhciBjaGlsZCA9IGdldFJlYWxDaGlsZChyYXdDaGlsZCk7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoIWNoaWxkKSB7CiAgICAgICAgcmV0dXJuIHJhd0NoaWxkCiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9sZWF2aW5nKSB7CiAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyKGgsIHJhd0NoaWxkKQogICAgICB9CgogICAgICAvLyBlbnN1cmUgYSBrZXkgdGhhdCBpcyB1bmlxdWUgdG8gdGhlIHZub2RlIHR5cGUgYW5kIHRvIHRoaXMgdHJhbnNpdGlvbgogICAgICAvLyBjb21wb25lbnQgaW5zdGFuY2UuIFRoaXMga2V5IHdpbGwgYmUgdXNlZCB0byByZW1vdmUgcGVuZGluZyBsZWF2aW5nIG5vZGVzCiAgICAgIC8vIGR1cmluZyBlbnRlcmluZy4KICAgICAgdmFyIGlkID0gIl9fdHJhbnNpdGlvbi0iICsgKHRoaXMuX3VpZCkgKyAiLSI7CiAgICAgIGNoaWxkLmtleSA9IGNoaWxkLmtleSA9PSBudWxsCiAgICAgICAgPyBjaGlsZC5pc0NvbW1lbnQKICAgICAgICAgID8gaWQgKyAnY29tbWVudCcKICAgICAgICAgIDogaWQgKyBjaGlsZC50YWcKICAgICAgICA6IGlzUHJpbWl0aXZlKGNoaWxkLmtleSkKICAgICAgICAgID8gKFN0cmluZyhjaGlsZC5rZXkpLmluZGV4T2YoaWQpID09PSAwID8gY2hpbGQua2V5IDogaWQgKyBjaGlsZC5rZXkpCiAgICAgICAgICA6IGNoaWxkLmtleTsKCiAgICAgIHZhciBkYXRhID0gKGNoaWxkLmRhdGEgfHwgKGNoaWxkLmRhdGEgPSB7fSkpLnRyYW5zaXRpb24gPSBleHRyYWN0VHJhbnNpdGlvbkRhdGEodGhpcyk7CiAgICAgIHZhciBvbGRSYXdDaGlsZCA9IHRoaXMuX3Zub2RlOwogICAgICB2YXIgb2xkQ2hpbGQgPSBnZXRSZWFsQ2hpbGQob2xkUmF3Q2hpbGQpOwoKICAgICAgLy8gbWFyayB2LXNob3cKICAgICAgLy8gc28gdGhhdCB0aGUgdHJhbnNpdGlvbiBtb2R1bGUgY2FuIGhhbmQgb3ZlciB0aGUgY29udHJvbCB0byB0aGUgZGlyZWN0aXZlCiAgICAgIGlmIChjaGlsZC5kYXRhLmRpcmVjdGl2ZXMgJiYgY2hpbGQuZGF0YS5kaXJlY3RpdmVzLnNvbWUoaXNWU2hvd0RpcmVjdGl2ZSkpIHsKICAgICAgICBjaGlsZC5kYXRhLnNob3cgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAoCiAgICAgICAgb2xkQ2hpbGQgJiYKICAgICAgICBvbGRDaGlsZC5kYXRhICYmCiAgICAgICAgIWlzU2FtZUNoaWxkKGNoaWxkLCBvbGRDaGlsZCkgJiYKICAgICAgICAhaXNBc3luY1BsYWNlaG9sZGVyKG9sZENoaWxkKSAmJgogICAgICAgIC8vICM2Njg3IGNvbXBvbmVudCByb290IGlzIGEgY29tbWVudCBub2RlCiAgICAgICAgIShvbGRDaGlsZC5jb21wb25lbnRJbnN0YW5jZSAmJiBvbGRDaGlsZC5jb21wb25lbnRJbnN0YW5jZS5fdm5vZGUuaXNDb21tZW50KQogICAgICApIHsKICAgICAgICAvLyByZXBsYWNlIG9sZCBjaGlsZCB0cmFuc2l0aW9uIGRhdGEgd2l0aCBmcmVzaCBvbmUKICAgICAgICAvLyBpbXBvcnRhbnQgZm9yIGR5bmFtaWMgdHJhbnNpdGlvbnMhCiAgICAgICAgdmFyIG9sZERhdGEgPSBvbGRDaGlsZC5kYXRhLnRyYW5zaXRpb24gPSBleHRlbmQoe30sIGRhdGEpOwogICAgICAgIC8vIGhhbmRsZSB0cmFuc2l0aW9uIG1vZGUKICAgICAgICBpZiAobW9kZSA9PT0gJ291dC1pbicpIHsKICAgICAgICAgIC8vIHJldHVybiBwbGFjZWhvbGRlciBub2RlIGFuZCBxdWV1ZSB1cGRhdGUgd2hlbiBsZWF2ZSBmaW5pc2hlcwogICAgICAgICAgdGhpcy5fbGVhdmluZyA9IHRydWU7CiAgICAgICAgICBtZXJnZVZOb2RlSG9vayhvbGREYXRhLCAnYWZ0ZXJMZWF2ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcyQxLl9sZWF2aW5nID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMkMS4kZm9yY2VVcGRhdGUoKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyKGgsIHJhd0NoaWxkKQogICAgICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ2luLW91dCcpIHsKICAgICAgICAgIGlmIChpc0FzeW5jUGxhY2Vob2xkZXIoY2hpbGQpKSB7CiAgICAgICAgICAgIHJldHVybiBvbGRSYXdDaGlsZAogICAgICAgICAgfQogICAgICAgICAgdmFyIGRlbGF5ZWRMZWF2ZTsKICAgICAgICAgIHZhciBwZXJmb3JtTGVhdmUgPSBmdW5jdGlvbiAoKSB7IGRlbGF5ZWRMZWF2ZSgpOyB9OwogICAgICAgICAgbWVyZ2VWTm9kZUhvb2soZGF0YSwgJ2FmdGVyRW50ZXInLCBwZXJmb3JtTGVhdmUpOwogICAgICAgICAgbWVyZ2VWTm9kZUhvb2soZGF0YSwgJ2VudGVyQ2FuY2VsbGVkJywgcGVyZm9ybUxlYXZlKTsKICAgICAgICAgIG1lcmdlVk5vZGVIb29rKG9sZERhdGEsICdkZWxheUxlYXZlJywgZnVuY3Rpb24gKGxlYXZlKSB7IGRlbGF5ZWRMZWF2ZSA9IGxlYXZlOyB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByYXdDaGlsZAogICAgfQogIH07CgogIC8qICAqLwoKICB2YXIgcHJvcHMgPSBleHRlbmQoewogICAgdGFnOiBTdHJpbmcsCiAgICBtb3ZlQ2xhc3M6IFN0cmluZwogIH0sIHRyYW5zaXRpb25Qcm9wcyk7CgogIGRlbGV0ZSBwcm9wcy5tb2RlOwoKICB2YXIgVHJhbnNpdGlvbkdyb3VwID0gewogICAgcHJvcHM6IHByb3BzLAoKICAgIGJlZm9yZU1vdW50OiBmdW5jdGlvbiBiZWZvcmVNb3VudCAoKSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwoKICAgICAgdmFyIHVwZGF0ZSA9IHRoaXMuX3VwZGF0ZTsKICAgICAgdGhpcy5fdXBkYXRlID0gZnVuY3Rpb24gKHZub2RlLCBoeWRyYXRpbmcpIHsKICAgICAgICB2YXIgcmVzdG9yZUFjdGl2ZUluc3RhbmNlID0gc2V0QWN0aXZlSW5zdGFuY2UodGhpcyQxKTsKICAgICAgICAvLyBmb3JjZSByZW1vdmluZyBwYXNzCiAgICAgICAgdGhpcyQxLl9fcGF0Y2hfXygKICAgICAgICAgIHRoaXMkMS5fdm5vZGUsCiAgICAgICAgICB0aGlzJDEua2VwdCwKICAgICAgICAgIGZhbHNlLCAvLyBoeWRyYXRpbmcKICAgICAgICAgIHRydWUgLy8gcmVtb3ZlT25seSAoIWltcG9ydGFudCwgYXZvaWRzIHVubmVjZXNzYXJ5IG1vdmVzKQogICAgICAgICk7CiAgICAgICAgdGhpcyQxLl92bm9kZSA9IHRoaXMkMS5rZXB0OwogICAgICAgIHJlc3RvcmVBY3RpdmVJbnN0YW5jZSgpOwogICAgICAgIHVwZGF0ZS5jYWxsKHRoaXMkMSwgdm5vZGUsIGh5ZHJhdGluZyk7CiAgICAgIH07CiAgICB9LAoKICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyIChoKSB7CiAgICAgIHZhciB0YWcgPSB0aGlzLnRhZyB8fCB0aGlzLiR2bm9kZS5kYXRhLnRhZyB8fCAnc3Bhbic7CiAgICAgIHZhciBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB2YXIgcHJldkNoaWxkcmVuID0gdGhpcy5wcmV2Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICB2YXIgcmF3Q2hpbGRyZW4gPSB0aGlzLiRzbG90cy5kZWZhdWx0IHx8IFtdOwogICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuID0gW107CiAgICAgIHZhciB0cmFuc2l0aW9uRGF0YSA9IGV4dHJhY3RUcmFuc2l0aW9uRGF0YSh0aGlzKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmF3Q2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgYyA9IHJhd0NoaWxkcmVuW2ldOwogICAgICAgIGlmIChjLnRhZykgewogICAgICAgICAgaWYgKGMua2V5ICE9IG51bGwgJiYgU3RyaW5nKGMua2V5KS5pbmRleE9mKCdfX3ZsaXN0JykgIT09IDApIHsKICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChjKTsKICAgICAgICAgICAgbWFwW2Mua2V5XSA9IGMKICAgICAgICAgICAgOyhjLmRhdGEgfHwgKGMuZGF0YSA9IHt9KSkudHJhbnNpdGlvbiA9IHRyYW5zaXRpb25EYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG9wdHMgPSBjLmNvbXBvbmVudE9wdGlvbnM7CiAgICAgICAgICAgIHZhciBuYW1lID0gb3B0cyA/IChvcHRzLkN0b3Iub3B0aW9ucy5uYW1lIHx8IG9wdHMudGFnIHx8ICcnKSA6IGMudGFnOwogICAgICAgICAgICB3YXJuKCgiPHRyYW5zaXRpb24tZ3JvdXA+IGNoaWxkcmVuIG11c3QgYmUga2V5ZWQ6IDwiICsgbmFtZSArICI+IikpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHByZXZDaGlsZHJlbikgewogICAgICAgIHZhciBrZXB0ID0gW107CiAgICAgICAgdmFyIHJlbW92ZWQgPSBbXTsKICAgICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBwcmV2Q2hpbGRyZW4ubGVuZ3RoOyBpJDErKykgewogICAgICAgICAgdmFyIGMkMSA9IHByZXZDaGlsZHJlbltpJDFdOwogICAgICAgICAgYyQxLmRhdGEudHJhbnNpdGlvbiA9IHRyYW5zaXRpb25EYXRhOwogICAgICAgICAgYyQxLmRhdGEucG9zID0gYyQxLmVsbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgIGlmIChtYXBbYyQxLmtleV0pIHsKICAgICAgICAgICAga2VwdC5wdXNoKGMkMSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZW1vdmVkLnB1c2goYyQxKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5rZXB0ID0gaCh0YWcsIG51bGwsIGtlcHQpOwogICAgICAgIHRoaXMucmVtb3ZlZCA9IHJlbW92ZWQ7CiAgICAgIH0KCiAgICAgIHJldHVybiBoKHRhZywgbnVsbCwgY2hpbGRyZW4pCiAgICB9LAoKICAgIHVwZGF0ZWQ6IGZ1bmN0aW9uIHVwZGF0ZWQgKCkgewogICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLnByZXZDaGlsZHJlbjsKICAgICAgdmFyIG1vdmVDbGFzcyA9IHRoaXMubW92ZUNsYXNzIHx8ICgodGhpcy5uYW1lIHx8ICd2JykgKyAnLW1vdmUnKTsKICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGggfHwgIXRoaXMuaGFzTW92ZShjaGlsZHJlblswXS5lbG0sIG1vdmVDbGFzcykpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gd2UgZGl2aWRlIHRoZSB3b3JrIGludG8gdGhyZWUgbG9vcHMgdG8gYXZvaWQgbWl4aW5nIERPTSByZWFkcyBhbmQgd3JpdGVzCiAgICAgIC8vIGluIGVhY2ggaXRlcmF0aW9uIC0gd2hpY2ggaGVscHMgcHJldmVudCBsYXlvdXQgdGhyYXNoaW5nLgogICAgICBjaGlsZHJlbi5mb3JFYWNoKGNhbGxQZW5kaW5nQ2JzKTsKICAgICAgY2hpbGRyZW4uZm9yRWFjaChyZWNvcmRQb3NpdGlvbik7CiAgICAgIGNoaWxkcmVuLmZvckVhY2goYXBwbHlUcmFuc2xhdGlvbik7CgogICAgICAvLyBmb3JjZSByZWZsb3cgdG8gcHV0IGV2ZXJ5dGhpbmcgaW4gcG9zaXRpb24KICAgICAgLy8gYXNzaWduIHRvIHRoaXMgdG8gYXZvaWQgYmVpbmcgcmVtb3ZlZCBpbiB0cmVlLXNoYWtpbmcKICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgIHRoaXMuX3JlZmxvdyA9IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0OwoKICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoYykgewogICAgICAgIGlmIChjLmRhdGEubW92ZWQpIHsKICAgICAgICAgIHZhciBlbCA9IGMuZWxtOwogICAgICAgICAgdmFyIHMgPSBlbC5zdHlsZTsKICAgICAgICAgIGFkZFRyYW5zaXRpb25DbGFzcyhlbCwgbW92ZUNsYXNzKTsKICAgICAgICAgIHMudHJhbnNmb3JtID0gcy5XZWJraXRUcmFuc2Zvcm0gPSBzLnRyYW5zaXRpb25EdXJhdGlvbiA9ICcnOwogICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcih0cmFuc2l0aW9uRW5kRXZlbnQsIGVsLl9tb3ZlQ2IgPSBmdW5jdGlvbiBjYiAoZSkgewogICAgICAgICAgICBpZiAoZSAmJiBlLnRhcmdldCAhPT0gZWwpIHsKICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWUgfHwgL3RyYW5zZm9ybSQvLnRlc3QoZS5wcm9wZXJ0eU5hbWUpKSB7CiAgICAgICAgICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcih0cmFuc2l0aW9uRW5kRXZlbnQsIGNiKTsKICAgICAgICAgICAgICBlbC5fbW92ZUNiID0gbnVsbDsKICAgICAgICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIG1vdmVDbGFzcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIG1ldGhvZHM6IHsKICAgICAgaGFzTW92ZTogZnVuY3Rpb24gaGFzTW92ZSAoZWwsIG1vdmVDbGFzcykgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmICghaGFzVHJhbnNpdGlvbikgewogICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmICh0aGlzLl9oYXNNb3ZlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5faGFzTW92ZQogICAgICAgIH0KICAgICAgICAvLyBEZXRlY3Qgd2hldGhlciBhbiBlbGVtZW50IHdpdGggdGhlIG1vdmUgY2xhc3MgYXBwbGllZCBoYXMKICAgICAgICAvLyBDU1MgdHJhbnNpdGlvbnMuIFNpbmNlIHRoZSBlbGVtZW50IG1heSBiZSBpbnNpZGUgYW4gZW50ZXJpbmcKICAgICAgICAvLyB0cmFuc2l0aW9uIGF0IHRoaXMgdmVyeSBtb21lbnQsIHdlIG1ha2UgYSBjbG9uZSBvZiBpdCBhbmQgcmVtb3ZlCiAgICAgICAgLy8gYWxsIG90aGVyIHRyYW5zaXRpb24gY2xhc3NlcyBhcHBsaWVkIHRvIGVuc3VyZSBvbmx5IHRoZSBtb3ZlIGNsYXNzCiAgICAgICAgLy8gaXMgYXBwbGllZC4KICAgICAgICB2YXIgY2xvbmUgPSBlbC5jbG9uZU5vZGUoKTsKICAgICAgICBpZiAoZWwuX3RyYW5zaXRpb25DbGFzc2VzKSB7CiAgICAgICAgICBlbC5fdHJhbnNpdGlvbkNsYXNzZXMuZm9yRWFjaChmdW5jdGlvbiAoY2xzKSB7IHJlbW92ZUNsYXNzKGNsb25lLCBjbHMpOyB9KTsKICAgICAgICB9CiAgICAgICAgYWRkQ2xhc3MoY2xvbmUsIG1vdmVDbGFzcyk7CiAgICAgICAgY2xvbmUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB0aGlzLiRlbC5hcHBlbmRDaGlsZChjbG9uZSk7CiAgICAgICAgdmFyIGluZm8gPSBnZXRUcmFuc2l0aW9uSW5mbyhjbG9uZSk7CiAgICAgICAgdGhpcy4kZWwucmVtb3ZlQ2hpbGQoY2xvbmUpOwogICAgICAgIHJldHVybiAodGhpcy5faGFzTW92ZSA9IGluZm8uaGFzVHJhbnNmb3JtKQogICAgICB9CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gY2FsbFBlbmRpbmdDYnMgKGMpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGMuZWxtLl9tb3ZlQ2IpIHsKICAgICAgYy5lbG0uX21vdmVDYigpOwogICAgfQogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoYy5lbG0uX2VudGVyQ2IpIHsKICAgICAgYy5lbG0uX2VudGVyQ2IoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlY29yZFBvc2l0aW9uIChjKSB7CiAgICBjLmRhdGEubmV3UG9zID0gYy5lbG0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgfQoKICBmdW5jdGlvbiBhcHBseVRyYW5zbGF0aW9uIChjKSB7CiAgICB2YXIgb2xkUG9zID0gYy5kYXRhLnBvczsKICAgIHZhciBuZXdQb3MgPSBjLmRhdGEubmV3UG9zOwogICAgdmFyIGR4ID0gb2xkUG9zLmxlZnQgLSBuZXdQb3MubGVmdDsKICAgIHZhciBkeSA9IG9sZFBvcy50b3AgLSBuZXdQb3MudG9wOwogICAgaWYgKGR4IHx8IGR5KSB7CiAgICAgIGMuZGF0YS5tb3ZlZCA9IHRydWU7CiAgICAgIHZhciBzID0gYy5lbG0uc3R5bGU7CiAgICAgIHMudHJhbnNmb3JtID0gcy5XZWJraXRUcmFuc2Zvcm0gPSAidHJhbnNsYXRlKCIgKyBkeCArICJweCwiICsgZHkgKyAicHgpIjsKICAgICAgcy50cmFuc2l0aW9uRHVyYXRpb24gPSAnMHMnOwogICAgfQogIH0KCiAgdmFyIHBsYXRmb3JtQ29tcG9uZW50cyA9IHsKICAgIFRyYW5zaXRpb246IFRyYW5zaXRpb24sCiAgICBUcmFuc2l0aW9uR3JvdXA6IFRyYW5zaXRpb25Hcm91cAogIH07CgogIC8qICAqLwoKICAvLyBpbnN0YWxsIHBsYXRmb3JtIHNwZWNpZmljIHV0aWxzCiAgVnVlLmNvbmZpZy5tdXN0VXNlUHJvcCA9IG11c3RVc2VQcm9wOwogIFZ1ZS5jb25maWcuaXNSZXNlcnZlZFRhZyA9IGlzUmVzZXJ2ZWRUYWc7CiAgVnVlLmNvbmZpZy5pc1Jlc2VydmVkQXR0ciA9IGlzUmVzZXJ2ZWRBdHRyOwogIFZ1ZS5jb25maWcuZ2V0VGFnTmFtZXNwYWNlID0gZ2V0VGFnTmFtZXNwYWNlOwogIFZ1ZS5jb25maWcuaXNVbmtub3duRWxlbWVudCA9IGlzVW5rbm93bkVsZW1lbnQ7CgogIC8vIGluc3RhbGwgcGxhdGZvcm0gcnVudGltZSBkaXJlY3RpdmVzICYgY29tcG9uZW50cwogIGV4dGVuZChWdWUub3B0aW9ucy5kaXJlY3RpdmVzLCBwbGF0Zm9ybURpcmVjdGl2ZXMpOwogIGV4dGVuZChWdWUub3B0aW9ucy5jb21wb25lbnRzLCBwbGF0Zm9ybUNvbXBvbmVudHMpOwoKICAvLyBpbnN0YWxsIHBsYXRmb3JtIHBhdGNoIGZ1bmN0aW9uCiAgVnVlLnByb3RvdHlwZS5fX3BhdGNoX18gPSBpbkJyb3dzZXIgPyBwYXRjaCA6IG5vb3A7CgogIC8vIHB1YmxpYyBtb3VudCBtZXRob2QKICBWdWUucHJvdG90eXBlLiRtb3VudCA9IGZ1bmN0aW9uICgKICAgIGVsLAogICAgaHlkcmF0aW5nCiAgKSB7CiAgICBlbCA9IGVsICYmIGluQnJvd3NlciA/IHF1ZXJ5KGVsKSA6IHVuZGVmaW5lZDsKICAgIHJldHVybiBtb3VudENvbXBvbmVudCh0aGlzLCBlbCwgaHlkcmF0aW5nKQogIH07CgogIC8vIGRldnRvb2xzIGdsb2JhbCBob29rCiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICBpZiAoaW5Ccm93c2VyKSB7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKGNvbmZpZy5kZXZ0b29scykgewogICAgICAgIGlmIChkZXZ0b29scykgewogICAgICAgICAgZGV2dG9vbHMuZW1pdCgnaW5pdCcsIFZ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGVbY29uc29sZS5pbmZvID8gJ2luZm8nIDogJ2xvZyddKAogICAgICAgICAgICAnRG93bmxvYWQgdGhlIFZ1ZSBEZXZ0b29scyBleHRlbnNpb24gZm9yIGEgYmV0dGVyIGRldmVsb3BtZW50IGV4cGVyaWVuY2U6XG4nICsKICAgICAgICAgICAgJ2h0dHBzOi8vZ2l0aHViLmNvbS92dWVqcy92dWUtZGV2dG9vbHMnCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY29uZmlnLnByb2R1Y3Rpb25UaXAgIT09IGZhbHNlICYmCiAgICAgICAgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnCiAgICAgICkgewogICAgICAgIGNvbnNvbGVbY29uc29sZS5pbmZvID8gJ2luZm8nIDogJ2xvZyddKAogICAgICAgICAgIllvdSBhcmUgcnVubmluZyBWdWUgaW4gZGV2ZWxvcG1lbnQgbW9kZS5cbiIgKwogICAgICAgICAgIk1ha2Ugc3VyZSB0byB0dXJuIG9uIHByb2R1Y3Rpb24gbW9kZSB3aGVuIGRlcGxveWluZyBmb3IgcHJvZHVjdGlvbi5cbiIgKwogICAgICAgICAgIlNlZSBtb3JlIHRpcHMgYXQgaHR0cHM6Ly92dWVqcy5vcmcvZ3VpZGUvZGVwbG95bWVudC5odG1sIgogICAgICAgICk7CiAgICAgIH0KICAgIH0sIDApOwogIH0KCiAgLyogICovCgogIHZhciBkZWZhdWx0VGFnUkUgPSAvXHtceygoPzoufFxyP1xuKSs/KVx9XH0vZzsKICB2YXIgcmVnZXhFc2NhcGVSRSA9IC9bLS4qKz9eJHt9KCl8W1xdXC9cXF0vZzsKCiAgdmFyIGJ1aWxkUmVnZXggPSBjYWNoZWQoZnVuY3Rpb24gKGRlbGltaXRlcnMpIHsKICAgIHZhciBvcGVuID0gZGVsaW1pdGVyc1swXS5yZXBsYWNlKHJlZ2V4RXNjYXBlUkUsICdcXCQmJyk7CiAgICB2YXIgY2xvc2UgPSBkZWxpbWl0ZXJzWzFdLnJlcGxhY2UocmVnZXhFc2NhcGVSRSwgJ1xcJCYnKTsKICAgIHJldHVybiBuZXcgUmVnRXhwKG9wZW4gKyAnKCg/Oi58XFxuKSs/KScgKyBjbG9zZSwgJ2cnKQogIH0pOwoKCgogIGZ1bmN0aW9uIHBhcnNlVGV4dCAoCiAgICB0ZXh0LAogICAgZGVsaW1pdGVycwogICkgewogICAgdmFyIHRhZ1JFID0gZGVsaW1pdGVycyA/IGJ1aWxkUmVnZXgoZGVsaW1pdGVycykgOiBkZWZhdWx0VGFnUkU7CiAgICBpZiAoIXRhZ1JFLnRlc3QodGV4dCkpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgdG9rZW5zID0gW107CiAgICB2YXIgcmF3VG9rZW5zID0gW107CiAgICB2YXIgbGFzdEluZGV4ID0gdGFnUkUubGFzdEluZGV4ID0gMDsKICAgIHZhciBtYXRjaCwgaW5kZXgsIHRva2VuVmFsdWU7CiAgICB3aGlsZSAoKG1hdGNoID0gdGFnUkUuZXhlYyh0ZXh0KSkpIHsKICAgICAgaW5kZXggPSBtYXRjaC5pbmRleDsKICAgICAgLy8gcHVzaCB0ZXh0IHRva2VuCiAgICAgIGlmIChpbmRleCA+IGxhc3RJbmRleCkgewogICAgICAgIHJhd1Rva2Vucy5wdXNoKHRva2VuVmFsdWUgPSB0ZXh0LnNsaWNlKGxhc3RJbmRleCwgaW5kZXgpKTsKICAgICAgICB0b2tlbnMucHVzaChKU09OLnN0cmluZ2lmeSh0b2tlblZhbHVlKSk7CiAgICAgIH0KICAgICAgLy8gdGFnIHRva2VuCiAgICAgIHZhciBleHAgPSBwYXJzZUZpbHRlcnMobWF0Y2hbMV0udHJpbSgpKTsKICAgICAgdG9rZW5zLnB1c2goKCJfcygiICsgZXhwICsgIikiKSk7CiAgICAgIHJhd1Rva2Vucy5wdXNoKHsgJ0BiaW5kaW5nJzogZXhwIH0pOwogICAgICBsYXN0SW5kZXggPSBpbmRleCArIG1hdGNoWzBdLmxlbmd0aDsKICAgIH0KICAgIGlmIChsYXN0SW5kZXggPCB0ZXh0Lmxlbmd0aCkgewogICAgICByYXdUb2tlbnMucHVzaCh0b2tlblZhbHVlID0gdGV4dC5zbGljZShsYXN0SW5kZXgpKTsKICAgICAgdG9rZW5zLnB1c2goSlNPTi5zdHJpbmdpZnkodG9rZW5WYWx1ZSkpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgZXhwcmVzc2lvbjogdG9rZW5zLmpvaW4oJysnKSwKICAgICAgdG9rZW5zOiByYXdUb2tlbnMKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiB0cmFuc2Zvcm1Ob2RlIChlbCwgb3B0aW9ucykgewogICAgdmFyIHdhcm4gPSBvcHRpb25zLndhcm4gfHwgYmFzZVdhcm47CiAgICB2YXIgc3RhdGljQ2xhc3MgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAnY2xhc3MnKTsKICAgIGlmIChzdGF0aWNDbGFzcykgewogICAgICB2YXIgcmVzID0gcGFyc2VUZXh0KHN0YXRpY0NsYXNzLCBvcHRpb25zLmRlbGltaXRlcnMpOwogICAgICBpZiAocmVzKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICJjbGFzcz1cIiIgKyBzdGF0aWNDbGFzcyArICJcIjogIiArCiAgICAgICAgICAnSW50ZXJwb2xhdGlvbiBpbnNpZGUgYXR0cmlidXRlcyBoYXMgYmVlbiByZW1vdmVkLiAnICsKICAgICAgICAgICdVc2Ugdi1iaW5kIG9yIHRoZSBjb2xvbiBzaG9ydGhhbmQgaW5zdGVhZC4gRm9yIGV4YW1wbGUsICcgKwogICAgICAgICAgJ2luc3RlYWQgb2YgPGRpdiBjbGFzcz0ie3sgdmFsIH19Ij4sIHVzZSA8ZGl2IDpjbGFzcz0idmFsIj4uJywKICAgICAgICAgIGVsLnJhd0F0dHJzTWFwWydjbGFzcyddCiAgICAgICAgKTsKICAgICAgfQogICAgfQogICAgaWYgKHN0YXRpY0NsYXNzKSB7CiAgICAgIGVsLnN0YXRpY0NsYXNzID0gSlNPTi5zdHJpbmdpZnkoc3RhdGljQ2xhc3MpOwogICAgfQogICAgdmFyIGNsYXNzQmluZGluZyA9IGdldEJpbmRpbmdBdHRyKGVsLCAnY2xhc3MnLCBmYWxzZSAvKiBnZXRTdGF0aWMgKi8pOwogICAgaWYgKGNsYXNzQmluZGluZykgewogICAgICBlbC5jbGFzc0JpbmRpbmcgPSBjbGFzc0JpbmRpbmc7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5EYXRhIChlbCkgewogICAgdmFyIGRhdGEgPSAnJzsKICAgIGlmIChlbC5zdGF0aWNDbGFzcykgewogICAgICBkYXRhICs9ICJzdGF0aWNDbGFzczoiICsgKGVsLnN0YXRpY0NsYXNzKSArICIsIjsKICAgIH0KICAgIGlmIChlbC5jbGFzc0JpbmRpbmcpIHsKICAgICAgZGF0YSArPSAiY2xhc3M6IiArIChlbC5jbGFzc0JpbmRpbmcpICsgIiwiOwogICAgfQogICAgcmV0dXJuIGRhdGEKICB9CgogIHZhciBrbGFzcyQxID0gewogICAgc3RhdGljS2V5czogWydzdGF0aWNDbGFzcyddLAogICAgdHJhbnNmb3JtTm9kZTogdHJhbnNmb3JtTm9kZSwKICAgIGdlbkRhdGE6IGdlbkRhdGEKICB9OwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gdHJhbnNmb3JtTm9kZSQxIChlbCwgb3B0aW9ucykgewogICAgdmFyIHdhcm4gPSBvcHRpb25zLndhcm4gfHwgYmFzZVdhcm47CiAgICB2YXIgc3RhdGljU3R5bGUgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAnc3R5bGUnKTsKICAgIGlmIChzdGF0aWNTdHlsZSkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgewogICAgICAgIHZhciByZXMgPSBwYXJzZVRleHQoc3RhdGljU3R5bGUsIG9wdGlvbnMuZGVsaW1pdGVycyk7CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgInN0eWxlPVwiIiArIHN0YXRpY1N0eWxlICsgIlwiOiAiICsKICAgICAgICAgICAgJ0ludGVycG9sYXRpb24gaW5zaWRlIGF0dHJpYnV0ZXMgaGFzIGJlZW4gcmVtb3ZlZC4gJyArCiAgICAgICAgICAgICdVc2Ugdi1iaW5kIG9yIHRoZSBjb2xvbiBzaG9ydGhhbmQgaW5zdGVhZC4gRm9yIGV4YW1wbGUsICcgKwogICAgICAgICAgICAnaW5zdGVhZCBvZiA8ZGl2IHN0eWxlPSJ7eyB2YWwgfX0iPiwgdXNlIDxkaXYgOnN0eWxlPSJ2YWwiPi4nLAogICAgICAgICAgICBlbC5yYXdBdHRyc01hcFsnc3R5bGUnXQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWwuc3RhdGljU3R5bGUgPSBKU09OLnN0cmluZ2lmeShwYXJzZVN0eWxlVGV4dChzdGF0aWNTdHlsZSkpOwogICAgfQoKICAgIHZhciBzdHlsZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3N0eWxlJywgZmFsc2UgLyogZ2V0U3RhdGljICovKTsKICAgIGlmIChzdHlsZUJpbmRpbmcpIHsKICAgICAgZWwuc3R5bGVCaW5kaW5nID0gc3R5bGVCaW5kaW5nOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2VuRGF0YSQxIChlbCkgewogICAgdmFyIGRhdGEgPSAnJzsKICAgIGlmIChlbC5zdGF0aWNTdHlsZSkgewogICAgICBkYXRhICs9ICJzdGF0aWNTdHlsZToiICsgKGVsLnN0YXRpY1N0eWxlKSArICIsIjsKICAgIH0KICAgIGlmIChlbC5zdHlsZUJpbmRpbmcpIHsKICAgICAgZGF0YSArPSAic3R5bGU6KCIgKyAoZWwuc3R5bGVCaW5kaW5nKSArICIpLCI7CiAgICB9CiAgICByZXR1cm4gZGF0YQogIH0KCiAgdmFyIHN0eWxlJDEgPSB7CiAgICBzdGF0aWNLZXlzOiBbJ3N0YXRpY1N0eWxlJ10sCiAgICB0cmFuc2Zvcm1Ob2RlOiB0cmFuc2Zvcm1Ob2RlJDEsCiAgICBnZW5EYXRhOiBnZW5EYXRhJDEKICB9OwoKICAvKiAgKi8KCiAgdmFyIGRlY29kZXI7CgogIHZhciBoZSA9IHsKICAgIGRlY29kZTogZnVuY3Rpb24gZGVjb2RlIChodG1sKSB7CiAgICAgIGRlY29kZXIgPSBkZWNvZGVyIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBkZWNvZGVyLmlubmVySFRNTCA9IGh0bWw7CiAgICAgIHJldHVybiBkZWNvZGVyLnRleHRDb250ZW50CiAgICB9CiAgfTsKCiAgLyogICovCgogIHZhciBpc1VuYXJ5VGFnID0gbWFrZU1hcCgKICAgICdhcmVhLGJhc2UsYnIsY29sLGVtYmVkLGZyYW1lLGhyLGltZyxpbnB1dCxpc2luZGV4LGtleWdlbiwnICsKICAgICdsaW5rLG1ldGEscGFyYW0sc291cmNlLHRyYWNrLHdicicKICApOwoKICAvLyBFbGVtZW50cyB0aGF0IHlvdSBjYW4sIGludGVudGlvbmFsbHksIGxlYXZlIG9wZW4KICAvLyAoYW5kIHdoaWNoIGNsb3NlIHRoZW1zZWx2ZXMpCiAgdmFyIGNhbkJlTGVmdE9wZW5UYWcgPSBtYWtlTWFwKAogICAgJ2NvbGdyb3VwLGRkLGR0LGxpLG9wdGlvbnMscCx0ZCx0Zm9vdCx0aCx0aGVhZCx0cixzb3VyY2UnCiAgKTsKCiAgLy8gSFRNTDUgdGFncyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9pbmRpY2VzLmh0bWwjZWxlbWVudHMtMwogIC8vIFBocmFzaW5nIENvbnRlbnQgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvZG9tLmh0bWwjcGhyYXNpbmctY29udGVudAogIHZhciBpc05vblBocmFzaW5nVGFnID0gbWFrZU1hcCgKICAgICdhZGRyZXNzLGFydGljbGUsYXNpZGUsYmFzZSxibG9ja3F1b3RlLGJvZHksY2FwdGlvbixjb2wsY29sZ3JvdXAsZGQsJyArCiAgICAnZGV0YWlscyxkaWFsb2csZGl2LGRsLGR0LGZpZWxkc2V0LGZpZ2NhcHRpb24sZmlndXJlLGZvb3Rlcixmb3JtLCcgKwogICAgJ2gxLGgyLGgzLGg0LGg1LGg2LGhlYWQsaGVhZGVyLGhncm91cCxocixodG1sLGxlZ2VuZCxsaSxtZW51aXRlbSxtZXRhLCcgKwogICAgJ29wdGdyb3VwLG9wdGlvbixwYXJhbSxycCxydCxzb3VyY2Usc3R5bGUsc3VtbWFyeSx0Ym9keSx0ZCx0Zm9vdCx0aCx0aGVhZCwnICsKICAgICd0aXRsZSx0cix0cmFjaycKICApOwoKICAvKioKICAgKiBOb3QgdHlwZS1jaGVja2luZyB0aGlzIGZpbGUgYmVjYXVzZSBpdCdzIG1vc3RseSB2ZW5kb3IgY29kZS4KICAgKi8KCiAgLy8gUmVndWxhciBFeHByZXNzaW9ucyBmb3IgcGFyc2luZyB0YWdzIGFuZCBhdHRyaWJ1dGVzCiAgdmFyIGF0dHJpYnV0ZSA9IC9eXHMqKFteXHMiJzw+XC89XSspKD86XHMqKD0pXHMqKD86IihbXiJdKikiK3wnKFteJ10qKScrfChbXlxzIic9PD5gXSspKSk/LzsKICB2YXIgZHluYW1pY0FyZ0F0dHJpYnV0ZSA9IC9eXHMqKCg/OnYtW1x3LV0rOnxAfDp8IylcW1tePV0rXF1bXlxzIic8PlwvPV0qKSg/OlxzKig9KVxzKig/OiIoW14iXSopIit8JyhbXiddKiknK3woW15ccyInPTw+YF0rKSkpPy87CiAgdmFyIG5jbmFtZSA9ICJbYS16QS1aX11bXFwtXFwuMC05X2EtekEtWiIgKyAodW5pY29kZVJlZ0V4cC5zb3VyY2UpICsgIl0qIjsKICB2YXIgcW5hbWVDYXB0dXJlID0gIigoPzoiICsgbmNuYW1lICsgIlxcOik/IiArIG5jbmFtZSArICIpIjsKICB2YXIgc3RhcnRUYWdPcGVuID0gbmV3IFJlZ0V4cCgoIl48IiArIHFuYW1lQ2FwdHVyZSkpOwogIHZhciBzdGFydFRhZ0Nsb3NlID0gL15ccyooXC8/KT4vOwogIHZhciBlbmRUYWcgPSBuZXcgUmVnRXhwKCgiXjxcXC8iICsgcW5hbWVDYXB0dXJlICsgIltePl0qPiIpKTsKICB2YXIgZG9jdHlwZSA9IC9ePCFET0NUWVBFIFtePl0rPi9pOwogIC8vICM3Mjk4OiBlc2NhcGUgLSB0byBhdm9pZCBiZWluZyBwYXNzZWQgYXMgSFRNTCBjb21tZW50IHdoZW4gaW5saW5lZCBpbiBwYWdlCiAgdmFyIGNvbW1lbnQgPSAvXjwhXC0tLzsKICB2YXIgY29uZGl0aW9uYWxDb21tZW50ID0gL148IVxbLzsKCiAgLy8gU3BlY2lhbCBFbGVtZW50cyAoY2FuIGNvbnRhaW4gYW55dGhpbmcpCiAgdmFyIGlzUGxhaW5UZXh0RWxlbWVudCA9IG1ha2VNYXAoJ3NjcmlwdCxzdHlsZSx0ZXh0YXJlYScsIHRydWUpOwogIHZhciByZUNhY2hlID0ge307CgogIHZhciBkZWNvZGluZ01hcCA9IHsKICAgICcmbHQ7JzogJzwnLAogICAgJyZndDsnOiAnPicsCiAgICAnJnF1b3Q7JzogJyInLAogICAgJyZhbXA7JzogJyYnLAogICAgJyYjMTA7JzogJ1xuJywKICAgICcmIzk7JzogJ1x0JywKICAgICcmIzM5Oyc6ICInIgogIH07CiAgdmFyIGVuY29kZWRBdHRyID0gLyYoPzpsdHxndHxxdW90fGFtcHwjMzkpOy9nOwogIHZhciBlbmNvZGVkQXR0cldpdGhOZXdMaW5lcyA9IC8mKD86bHR8Z3R8cXVvdHxhbXB8IzM5fCMxMHwjOSk7L2c7CgogIC8vICM1OTkyCiAgdmFyIGlzSWdub3JlTmV3bGluZVRhZyA9IG1ha2VNYXAoJ3ByZSx0ZXh0YXJlYScsIHRydWUpOwogIHZhciBzaG91bGRJZ25vcmVGaXJzdE5ld2xpbmUgPSBmdW5jdGlvbiAodGFnLCBodG1sKSB7IHJldHVybiB0YWcgJiYgaXNJZ25vcmVOZXdsaW5lVGFnKHRhZykgJiYgaHRtbFswXSA9PT0gJ1xuJzsgfTsKCiAgZnVuY3Rpb24gZGVjb2RlQXR0ciAodmFsdWUsIHNob3VsZERlY29kZU5ld2xpbmVzKSB7CiAgICB2YXIgcmUgPSBzaG91bGREZWNvZGVOZXdsaW5lcyA/IGVuY29kZWRBdHRyV2l0aE5ld0xpbmVzIDogZW5jb2RlZEF0dHI7CiAgICByZXR1cm4gdmFsdWUucmVwbGFjZShyZSwgZnVuY3Rpb24gKG1hdGNoKSB7IHJldHVybiBkZWNvZGluZ01hcFttYXRjaF07IH0pCiAgfQoKICBmdW5jdGlvbiBwYXJzZUhUTUwgKGh0bWwsIG9wdGlvbnMpIHsKICAgIHZhciBzdGFjayA9IFtdOwogICAgdmFyIGV4cGVjdEhUTUwgPSBvcHRpb25zLmV4cGVjdEhUTUw7CiAgICB2YXIgaXNVbmFyeVRhZyQkMSA9IG9wdGlvbnMuaXNVbmFyeVRhZyB8fCBubzsKICAgIHZhciBjYW5CZUxlZnRPcGVuVGFnJCQxID0gb3B0aW9ucy5jYW5CZUxlZnRPcGVuVGFnIHx8IG5vOwogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBsYXN0LCBsYXN0VGFnOwogICAgd2hpbGUgKGh0bWwpIHsKICAgICAgbGFzdCA9IGh0bWw7CiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSdyZSBub3QgaW4gYSBwbGFpbnRleHQgY29udGVudCBlbGVtZW50IGxpa2Ugc2NyaXB0L3N0eWxlCiAgICAgIGlmICghbGFzdFRhZyB8fCAhaXNQbGFpblRleHRFbGVtZW50KGxhc3RUYWcpKSB7CiAgICAgICAgdmFyIHRleHRFbmQgPSBodG1sLmluZGV4T2YoJzwnKTsKICAgICAgICBpZiAodGV4dEVuZCA9PT0gMCkgewogICAgICAgICAgLy8gQ29tbWVudDoKICAgICAgICAgIGlmIChjb21tZW50LnRlc3QoaHRtbCkpIHsKICAgICAgICAgICAgdmFyIGNvbW1lbnRFbmQgPSBodG1sLmluZGV4T2YoJy0tPicpOwoKICAgICAgICAgICAgaWYgKGNvbW1lbnRFbmQgPj0gMCkgewogICAgICAgICAgICAgIGlmIChvcHRpb25zLnNob3VsZEtlZXBDb21tZW50KSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLmNvbW1lbnQoaHRtbC5zdWJzdHJpbmcoNCwgY29tbWVudEVuZCksIGluZGV4LCBpbmRleCArIGNvbW1lbnRFbmQgKyAzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYWR2YW5jZShjb21tZW50RW5kICsgMyk7CiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29uZGl0aW9uYWxfY29tbWVudCNEb3dubGV2ZWwtcmV2ZWFsZWRfY29uZGl0aW9uYWxfY29tbWVudAogICAgICAgICAgaWYgKGNvbmRpdGlvbmFsQ29tbWVudC50ZXN0KGh0bWwpKSB7CiAgICAgICAgICAgIHZhciBjb25kaXRpb25hbEVuZCA9IGh0bWwuaW5kZXhPZignXT4nKTsKCiAgICAgICAgICAgIGlmIChjb25kaXRpb25hbEVuZCA+PSAwKSB7CiAgICAgICAgICAgICAgYWR2YW5jZShjb25kaXRpb25hbEVuZCArIDIpOwogICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBEb2N0eXBlOgogICAgICAgICAgdmFyIGRvY3R5cGVNYXRjaCA9IGh0bWwubWF0Y2goZG9jdHlwZSk7CiAgICAgICAgICBpZiAoZG9jdHlwZU1hdGNoKSB7CiAgICAgICAgICAgIGFkdmFuY2UoZG9jdHlwZU1hdGNoWzBdLmxlbmd0aCk7CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CgogICAgICAgICAgLy8gRW5kIHRhZzoKICAgICAgICAgIHZhciBlbmRUYWdNYXRjaCA9IGh0bWwubWF0Y2goZW5kVGFnKTsKICAgICAgICAgIGlmIChlbmRUYWdNYXRjaCkgewogICAgICAgICAgICB2YXIgY3VySW5kZXggPSBpbmRleDsKICAgICAgICAgICAgYWR2YW5jZShlbmRUYWdNYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICBwYXJzZUVuZFRhZyhlbmRUYWdNYXRjaFsxXSwgY3VySW5kZXgsIGluZGV4KTsKICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBTdGFydCB0YWc6CiAgICAgICAgICB2YXIgc3RhcnRUYWdNYXRjaCA9IHBhcnNlU3RhcnRUYWcoKTsKICAgICAgICAgIGlmIChzdGFydFRhZ01hdGNoKSB7CiAgICAgICAgICAgIGhhbmRsZVN0YXJ0VGFnKHN0YXJ0VGFnTWF0Y2gpOwogICAgICAgICAgICBpZiAoc2hvdWxkSWdub3JlRmlyc3ROZXdsaW5lKHN0YXJ0VGFnTWF0Y2gudGFnTmFtZSwgaHRtbCkpIHsKICAgICAgICAgICAgICBhZHZhbmNlKDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgdGV4dCA9ICh2b2lkIDApLCByZXN0ID0gKHZvaWQgMCksIG5leHQgPSAodm9pZCAwKTsKICAgICAgICBpZiAodGV4dEVuZCA+PSAwKSB7CiAgICAgICAgICByZXN0ID0gaHRtbC5zbGljZSh0ZXh0RW5kKTsKICAgICAgICAgIHdoaWxlICgKICAgICAgICAgICAgIWVuZFRhZy50ZXN0KHJlc3QpICYmCiAgICAgICAgICAgICFzdGFydFRhZ09wZW4udGVzdChyZXN0KSAmJgogICAgICAgICAgICAhY29tbWVudC50ZXN0KHJlc3QpICYmCiAgICAgICAgICAgICFjb25kaXRpb25hbENvbW1lbnQudGVzdChyZXN0KQogICAgICAgICAgKSB7CiAgICAgICAgICAgIC8vIDwgaW4gcGxhaW4gdGV4dCwgYmUgZm9yZ2l2aW5nIGFuZCB0cmVhdCBpdCBhcyB0ZXh0CiAgICAgICAgICAgIG5leHQgPSByZXN0LmluZGV4T2YoJzwnLCAxKTsKICAgICAgICAgICAgaWYgKG5leHQgPCAwKSB7IGJyZWFrIH0KICAgICAgICAgICAgdGV4dEVuZCArPSBuZXh0OwogICAgICAgICAgICByZXN0ID0gaHRtbC5zbGljZSh0ZXh0RW5kKTsKICAgICAgICAgIH0KICAgICAgICAgIHRleHQgPSBodG1sLnN1YnN0cmluZygwLCB0ZXh0RW5kKTsKICAgICAgICB9CgogICAgICAgIGlmICh0ZXh0RW5kIDwgMCkgewogICAgICAgICAgdGV4dCA9IGh0bWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodGV4dCkgewogICAgICAgICAgYWR2YW5jZSh0ZXh0Lmxlbmd0aCk7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5jaGFycyAmJiB0ZXh0KSB7CiAgICAgICAgICBvcHRpb25zLmNoYXJzKHRleHQsIGluZGV4IC0gdGV4dC5sZW5ndGgsIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGVuZFRhZ0xlbmd0aCA9IDA7CiAgICAgICAgdmFyIHN0YWNrZWRUYWcgPSBsYXN0VGFnLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdmFyIHJlU3RhY2tlZFRhZyA9IHJlQ2FjaGVbc3RhY2tlZFRhZ10gfHwgKHJlQ2FjaGVbc3RhY2tlZFRhZ10gPSBuZXcgUmVnRXhwKCcoW1xcc1xcU10qPykoPC8nICsgc3RhY2tlZFRhZyArICdbXj5dKj4pJywgJ2knKSk7CiAgICAgICAgdmFyIHJlc3QkMSA9IGh0bWwucmVwbGFjZShyZVN0YWNrZWRUYWcsIGZ1bmN0aW9uIChhbGwsIHRleHQsIGVuZFRhZykgewogICAgICAgICAgZW5kVGFnTGVuZ3RoID0gZW5kVGFnLmxlbmd0aDsKICAgICAgICAgIGlmICghaXNQbGFpblRleHRFbGVtZW50KHN0YWNrZWRUYWcpICYmIHN0YWNrZWRUYWcgIT09ICdub3NjcmlwdCcpIHsKICAgICAgICAgICAgdGV4dCA9IHRleHQKICAgICAgICAgICAgICAucmVwbGFjZSgvPCFcLS0oW1xzXFNdKj8pLS0+L2csICckMScpIC8vICM3Mjk4CiAgICAgICAgICAgICAgLnJlcGxhY2UoLzwhXFtDREFUQVxbKFtcc1xTXSo/KV1dPi9nLCAnJDEnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzaG91bGRJZ25vcmVGaXJzdE5ld2xpbmUoc3RhY2tlZFRhZywgdGV4dCkpIHsKICAgICAgICAgICAgdGV4dCA9IHRleHQuc2xpY2UoMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0aW9ucy5jaGFycykgewogICAgICAgICAgICBvcHRpb25zLmNoYXJzKHRleHQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgfSk7CiAgICAgICAgaW5kZXggKz0gaHRtbC5sZW5ndGggLSByZXN0JDEubGVuZ3RoOwogICAgICAgIGh0bWwgPSByZXN0JDE7CiAgICAgICAgcGFyc2VFbmRUYWcoc3RhY2tlZFRhZywgaW5kZXggLSBlbmRUYWdMZW5ndGgsIGluZGV4KTsKICAgICAgfQoKICAgICAgaWYgKGh0bWwgPT09IGxhc3QpIHsKICAgICAgICBvcHRpb25zLmNoYXJzICYmIG9wdGlvbnMuY2hhcnMoaHRtbCk7CiAgICAgICAgaWYgKCFzdGFjay5sZW5ndGggJiYgb3B0aW9ucy53YXJuKSB7CiAgICAgICAgICBvcHRpb25zLndhcm4oKCJNYWwtZm9ybWF0dGVkIHRhZyBhdCBlbmQgb2YgdGVtcGxhdGU6IFwiIiArIGh0bWwgKyAiXCIiKSwgeyBzdGFydDogaW5kZXggKyBodG1sLmxlbmd0aCB9KTsKICAgICAgICB9CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQoKICAgIC8vIENsZWFuIHVwIGFueSByZW1haW5pbmcgdGFncwogICAgcGFyc2VFbmRUYWcoKTsKCiAgICBmdW5jdGlvbiBhZHZhbmNlIChuKSB7CiAgICAgIGluZGV4ICs9IG47CiAgICAgIGh0bWwgPSBodG1sLnN1YnN0cmluZyhuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZVN0YXJ0VGFnICgpIHsKICAgICAgdmFyIHN0YXJ0ID0gaHRtbC5tYXRjaChzdGFydFRhZ09wZW4pOwogICAgICBpZiAoc3RhcnQpIHsKICAgICAgICB2YXIgbWF0Y2ggPSB7CiAgICAgICAgICB0YWdOYW1lOiBzdGFydFsxXSwKICAgICAgICAgIGF0dHJzOiBbXSwKICAgICAgICAgIHN0YXJ0OiBpbmRleAogICAgICAgIH07CiAgICAgICAgYWR2YW5jZShzdGFydFswXS5sZW5ndGgpOwogICAgICAgIHZhciBlbmQsIGF0dHI7CiAgICAgICAgd2hpbGUgKCEoZW5kID0gaHRtbC5tYXRjaChzdGFydFRhZ0Nsb3NlKSkgJiYgKGF0dHIgPSBodG1sLm1hdGNoKGR5bmFtaWNBcmdBdHRyaWJ1dGUpIHx8IGh0bWwubWF0Y2goYXR0cmlidXRlKSkpIHsKICAgICAgICAgIGF0dHIuc3RhcnQgPSBpbmRleDsKICAgICAgICAgIGFkdmFuY2UoYXR0clswXS5sZW5ndGgpOwogICAgICAgICAgYXR0ci5lbmQgPSBpbmRleDsKICAgICAgICAgIG1hdGNoLmF0dHJzLnB1c2goYXR0cik7CiAgICAgICAgfQogICAgICAgIGlmIChlbmQpIHsKICAgICAgICAgIG1hdGNoLnVuYXJ5U2xhc2ggPSBlbmRbMV07CiAgICAgICAgICBhZHZhbmNlKGVuZFswXS5sZW5ndGgpOwogICAgICAgICAgbWF0Y2guZW5kID0gaW5kZXg7CiAgICAgICAgICByZXR1cm4gbWF0Y2gKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVTdGFydFRhZyAobWF0Y2gpIHsKICAgICAgdmFyIHRhZ05hbWUgPSBtYXRjaC50YWdOYW1lOwogICAgICB2YXIgdW5hcnlTbGFzaCA9IG1hdGNoLnVuYXJ5U2xhc2g7CgogICAgICBpZiAoZXhwZWN0SFRNTCkgewogICAgICAgIGlmIChsYXN0VGFnID09PSAncCcgJiYgaXNOb25QaHJhc2luZ1RhZyh0YWdOYW1lKSkgewogICAgICAgICAgcGFyc2VFbmRUYWcobGFzdFRhZyk7CiAgICAgICAgfQogICAgICAgIGlmIChjYW5CZUxlZnRPcGVuVGFnJCQxKHRhZ05hbWUpICYmIGxhc3RUYWcgPT09IHRhZ05hbWUpIHsKICAgICAgICAgIHBhcnNlRW5kVGFnKHRhZ05hbWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHVuYXJ5ID0gaXNVbmFyeVRhZyQkMSh0YWdOYW1lKSB8fCAhIXVuYXJ5U2xhc2g7CgogICAgICB2YXIgbCA9IG1hdGNoLmF0dHJzLmxlbmd0aDsKICAgICAgdmFyIGF0dHJzID0gbmV3IEFycmF5KGwpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykgewogICAgICAgIHZhciBhcmdzID0gbWF0Y2guYXR0cnNbaV07CiAgICAgICAgdmFyIHZhbHVlID0gYXJnc1szXSB8fCBhcmdzWzRdIHx8IGFyZ3NbNV0gfHwgJyc7CiAgICAgICAgdmFyIHNob3VsZERlY29kZU5ld2xpbmVzID0gdGFnTmFtZSA9PT0gJ2EnICYmIGFyZ3NbMV0gPT09ICdocmVmJwogICAgICAgICAgPyBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZgogICAgICAgICAgOiBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzOwogICAgICAgIGF0dHJzW2ldID0gewogICAgICAgICAgbmFtZTogYXJnc1sxXSwKICAgICAgICAgIHZhbHVlOiBkZWNvZGVBdHRyKHZhbHVlLCBzaG91bGREZWNvZGVOZXdsaW5lcykKICAgICAgICB9OwogICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICBhdHRyc1tpXS5zdGFydCA9IGFyZ3Muc3RhcnQgKyBhcmdzWzBdLm1hdGNoKC9eXHMqLykubGVuZ3RoOwogICAgICAgICAgYXR0cnNbaV0uZW5kID0gYXJncy5lbmQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIXVuYXJ5KSB7CiAgICAgICAgc3RhY2sucHVzaCh7IHRhZzogdGFnTmFtZSwgbG93ZXJDYXNlZFRhZzogdGFnTmFtZS50b0xvd2VyQ2FzZSgpLCBhdHRyczogYXR0cnMsIHN0YXJ0OiBtYXRjaC5zdGFydCwgZW5kOiBtYXRjaC5lbmQgfSk7CiAgICAgICAgbGFzdFRhZyA9IHRhZ05hbWU7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnN0YXJ0KSB7CiAgICAgICAgb3B0aW9ucy5zdGFydCh0YWdOYW1lLCBhdHRycywgdW5hcnksIG1hdGNoLnN0YXJ0LCBtYXRjaC5lbmQpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VFbmRUYWcgKHRhZ05hbWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgdmFyIHBvcywgbG93ZXJDYXNlZFRhZ05hbWU7CiAgICAgIGlmIChzdGFydCA9PSBudWxsKSB7IHN0YXJ0ID0gaW5kZXg7IH0KICAgICAgaWYgKGVuZCA9PSBudWxsKSB7IGVuZCA9IGluZGV4OyB9CgogICAgICAvLyBGaW5kIHRoZSBjbG9zZXN0IG9wZW5lZCB0YWcgb2YgdGhlIHNhbWUgdHlwZQogICAgICBpZiAodGFnTmFtZSkgewogICAgICAgIGxvd2VyQ2FzZWRUYWdOYW1lID0gdGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGZvciAocG9zID0gc3RhY2subGVuZ3RoIC0gMTsgcG9zID49IDA7IHBvcy0tKSB7CiAgICAgICAgICBpZiAoc3RhY2tbcG9zXS5sb3dlckNhc2VkVGFnID09PSBsb3dlckNhc2VkVGFnTmFtZSkgewogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBJZiBubyB0YWcgbmFtZSBpcyBwcm92aWRlZCwgY2xlYW4gc2hvcAogICAgICAgIHBvcyA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChwb3MgPj0gMCkgewogICAgICAgIC8vIENsb3NlIGFsbCB0aGUgb3BlbiBlbGVtZW50cywgdXAgdGhlIHN0YWNrCiAgICAgICAgZm9yICh2YXIgaSA9IHN0YWNrLmxlbmd0aCAtIDE7IGkgPj0gcG9zOyBpLS0pIHsKICAgICAgICAgIGlmIChpID4gcG9zIHx8ICF0YWdOYW1lICYmCiAgICAgICAgICAgIG9wdGlvbnMud2FybgogICAgICAgICAgKSB7CiAgICAgICAgICAgIG9wdGlvbnMud2FybigKICAgICAgICAgICAgICAoInRhZyA8IiArIChzdGFja1tpXS50YWcpICsgIj4gaGFzIG5vIG1hdGNoaW5nIGVuZCB0YWcuIiksCiAgICAgICAgICAgICAgeyBzdGFydDogc3RhY2tbaV0uc3RhcnQsIGVuZDogc3RhY2tbaV0uZW5kIH0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvcHRpb25zLmVuZCkgewogICAgICAgICAgICBvcHRpb25zLmVuZChzdGFja1tpXS50YWcsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBvcGVuIGVsZW1lbnRzIGZyb20gdGhlIHN0YWNrCiAgICAgICAgc3RhY2subGVuZ3RoID0gcG9zOwogICAgICAgIGxhc3RUYWcgPSBwb3MgJiYgc3RhY2tbcG9zIC0gMV0udGFnOwogICAgICB9IGVsc2UgaWYgKGxvd2VyQ2FzZWRUYWdOYW1lID09PSAnYnInKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQpIHsKICAgICAgICAgIG9wdGlvbnMuc3RhcnQodGFnTmFtZSwgW10sIHRydWUsIHN0YXJ0LCBlbmQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChsb3dlckNhc2VkVGFnTmFtZSA9PT0gJ3AnKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQpIHsKICAgICAgICAgIG9wdGlvbnMuc3RhcnQodGFnTmFtZSwgW10sIGZhbHNlLCBzdGFydCwgZW5kKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuZW5kKSB7CiAgICAgICAgICBvcHRpb25zLmVuZCh0YWdOYW1lLCBzdGFydCwgZW5kKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8qICAqLwoKICB2YXIgb25SRSA9IC9eQHxedi1vbjovOwogIHZhciBkaXJSRSA9IC9edi18XkB8Xjp8XiMvOwogIHZhciBmb3JBbGlhc1JFID0gLyhbXHNcU10qPylccysoPzppbnxvZilccysoW1xzXFNdKikvOwogIHZhciBmb3JJdGVyYXRvclJFID0gLywoW14sXH1cXV0qKSg/OiwoW14sXH1cXV0qKSk/JC87CiAgdmFyIHN0cmlwUGFyZW5zUkUgPSAvXlwofFwpJC9nOwogIHZhciBkeW5hbWljQXJnUkUgPSAvXlxbLipcXSQvOwoKICB2YXIgYXJnUkUgPSAvOiguKikkLzsKICB2YXIgYmluZFJFID0gL146fF5cLnxedi1iaW5kOi87CiAgdmFyIG1vZGlmaWVyUkUgPSAvXC5bXi5cXV0rKD89W15cXV0qJCkvZzsKCiAgdmFyIHNsb3RSRSA9IC9edi1zbG90KDp8JCl8XiMvOwoKICB2YXIgbGluZUJyZWFrUkUgPSAvW1xyXG5dLzsKICB2YXIgd2hpdGVzcGFjZVJFJDEgPSAvXHMrL2c7CgogIHZhciBpbnZhbGlkQXR0cmlidXRlUkUgPSAvW1xzIic8PlwvPV0vOwoKICB2YXIgZGVjb2RlSFRNTENhY2hlZCA9IGNhY2hlZChoZS5kZWNvZGUpOwoKICB2YXIgZW1wdHlTbG90U2NvcGVUb2tlbiA9ICJfZW1wdHlfIjsKCiAgLy8gY29uZmlndXJhYmxlIHN0YXRlCiAgdmFyIHdhcm4kMjsKICB2YXIgZGVsaW1pdGVyczsKICB2YXIgdHJhbnNmb3JtczsKICB2YXIgcHJlVHJhbnNmb3JtczsKICB2YXIgcG9zdFRyYW5zZm9ybXM7CiAgdmFyIHBsYXRmb3JtSXNQcmVUYWc7CiAgdmFyIHBsYXRmb3JtTXVzdFVzZVByb3A7CiAgdmFyIHBsYXRmb3JtR2V0VGFnTmFtZXNwYWNlOwogIHZhciBtYXliZUNvbXBvbmVudDsKCiAgZnVuY3Rpb24gY3JlYXRlQVNURWxlbWVudCAoCiAgICB0YWcsCiAgICBhdHRycywKICAgIHBhcmVudAogICkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogMSwKICAgICAgdGFnOiB0YWcsCiAgICAgIGF0dHJzTGlzdDogYXR0cnMsCiAgICAgIGF0dHJzTWFwOiBtYWtlQXR0cnNNYXAoYXR0cnMpLAogICAgICByYXdBdHRyc01hcDoge30sCiAgICAgIHBhcmVudDogcGFyZW50LAogICAgICBjaGlsZHJlbjogW10KICAgIH0KICB9CgogIC8qKgogICAqIENvbnZlcnQgSFRNTCBzdHJpbmcgdG8gQVNULgogICAqLwogIGZ1bmN0aW9uIHBhcnNlICgKICAgIHRlbXBsYXRlLAogICAgb3B0aW9ucwogICkgewogICAgd2FybiQyID0gb3B0aW9ucy53YXJuIHx8IGJhc2VXYXJuOwoKICAgIHBsYXRmb3JtSXNQcmVUYWcgPSBvcHRpb25zLmlzUHJlVGFnIHx8IG5vOwogICAgcGxhdGZvcm1NdXN0VXNlUHJvcCA9IG9wdGlvbnMubXVzdFVzZVByb3AgfHwgbm87CiAgICBwbGF0Zm9ybUdldFRhZ05hbWVzcGFjZSA9IG9wdGlvbnMuZ2V0VGFnTmFtZXNwYWNlIHx8IG5vOwogICAgdmFyIGlzUmVzZXJ2ZWRUYWcgPSBvcHRpb25zLmlzUmVzZXJ2ZWRUYWcgfHwgbm87CiAgICBtYXliZUNvbXBvbmVudCA9IGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gISFlbC5jb21wb25lbnQgfHwgIWlzUmVzZXJ2ZWRUYWcoZWwudGFnKTsgfTsKCiAgICB0cmFuc2Zvcm1zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICd0cmFuc2Zvcm1Ob2RlJyk7CiAgICBwcmVUcmFuc2Zvcm1zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICdwcmVUcmFuc2Zvcm1Ob2RlJyk7CiAgICBwb3N0VHJhbnNmb3JtcyA9IHBsdWNrTW9kdWxlRnVuY3Rpb24ob3B0aW9ucy5tb2R1bGVzLCAncG9zdFRyYW5zZm9ybU5vZGUnKTsKCiAgICBkZWxpbWl0ZXJzID0gb3B0aW9ucy5kZWxpbWl0ZXJzOwoKICAgIHZhciBzdGFjayA9IFtdOwogICAgdmFyIHByZXNlcnZlV2hpdGVzcGFjZSA9IG9wdGlvbnMucHJlc2VydmVXaGl0ZXNwYWNlICE9PSBmYWxzZTsKICAgIHZhciB3aGl0ZXNwYWNlT3B0aW9uID0gb3B0aW9ucy53aGl0ZXNwYWNlOwogICAgdmFyIHJvb3Q7CiAgICB2YXIgY3VycmVudFBhcmVudDsKICAgIHZhciBpblZQcmUgPSBmYWxzZTsKICAgIHZhciBpblByZSA9IGZhbHNlOwogICAgdmFyIHdhcm5lZCA9IGZhbHNlOwoKICAgIGZ1bmN0aW9uIHdhcm5PbmNlIChtc2csIHJhbmdlKSB7CiAgICAgIGlmICghd2FybmVkKSB7CiAgICAgICAgd2FybmVkID0gdHJ1ZTsKICAgICAgICB3YXJuJDIobXNnLCByYW5nZSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZUVsZW1lbnQgKGVsZW1lbnQpIHsKICAgICAgdHJpbUVuZGluZ1doaXRlc3BhY2UoZWxlbWVudCk7CiAgICAgIGlmICghaW5WUHJlICYmICFlbGVtZW50LnByb2Nlc3NlZCkgewogICAgICAgIGVsZW1lbnQgPSBwcm9jZXNzRWxlbWVudChlbGVtZW50LCBvcHRpb25zKTsKICAgICAgfQogICAgICAvLyB0cmVlIG1hbmFnZW1lbnQKICAgICAgaWYgKCFzdGFjay5sZW5ndGggJiYgZWxlbWVudCAhPT0gcm9vdCkgewogICAgICAgIC8vIGFsbG93IHJvb3QgZWxlbWVudHMgd2l0aCB2LWlmLCB2LWVsc2UtaWYgYW5kIHYtZWxzZQogICAgICAgIGlmIChyb290LmlmICYmIChlbGVtZW50LmVsc2VpZiB8fCBlbGVtZW50LmVsc2UpKSB7CiAgICAgICAgICB7CiAgICAgICAgICAgIGNoZWNrUm9vdENvbnN0cmFpbnRzKGVsZW1lbnQpOwogICAgICAgICAgfQogICAgICAgICAgYWRkSWZDb25kaXRpb24ocm9vdCwgewogICAgICAgICAgICBleHA6IGVsZW1lbnQuZWxzZWlmLAogICAgICAgICAgICBibG9jazogZWxlbWVudAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdhcm5PbmNlKAogICAgICAgICAgICAiQ29tcG9uZW50IHRlbXBsYXRlIHNob3VsZCBjb250YWluIGV4YWN0bHkgb25lIHJvb3QgZWxlbWVudC4gIiArCiAgICAgICAgICAgICJJZiB5b3UgYXJlIHVzaW5nIHYtaWYgb24gbXVsdGlwbGUgZWxlbWVudHMsICIgKwogICAgICAgICAgICAidXNlIHYtZWxzZS1pZiB0byBjaGFpbiB0aGVtIGluc3RlYWQuIiwKICAgICAgICAgICAgeyBzdGFydDogZWxlbWVudC5zdGFydCB9CiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY3VycmVudFBhcmVudCAmJiAhZWxlbWVudC5mb3JiaWRkZW4pIHsKICAgICAgICBpZiAoZWxlbWVudC5lbHNlaWYgfHwgZWxlbWVudC5lbHNlKSB7CiAgICAgICAgICBwcm9jZXNzSWZDb25kaXRpb25zKGVsZW1lbnQsIGN1cnJlbnRQYXJlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoZWxlbWVudC5zbG90U2NvcGUpIHsKICAgICAgICAgICAgLy8gc2NvcGVkIHNsb3QKICAgICAgICAgICAgLy8ga2VlcCBpdCBpbiB0aGUgY2hpbGRyZW4gbGlzdCBzbyB0aGF0IHYtZWxzZSgtaWYpIGNvbmRpdGlvbnMgY2FuCiAgICAgICAgICAgIC8vIGZpbmQgaXQgYXMgdGhlIHByZXYgbm9kZS4KICAgICAgICAgICAgdmFyIG5hbWUgPSBlbGVtZW50LnNsb3RUYXJnZXQgfHwgJyJkZWZhdWx0IicKICAgICAgICAgICAgOyhjdXJyZW50UGFyZW50LnNjb3BlZFNsb3RzIHx8IChjdXJyZW50UGFyZW50LnNjb3BlZFNsb3RzID0ge30pKVtuYW1lXSA9IGVsZW1lbnQ7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50UGFyZW50LmNoaWxkcmVuLnB1c2goZWxlbWVudCk7CiAgICAgICAgICBlbGVtZW50LnBhcmVudCA9IGN1cnJlbnRQYXJlbnQ7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBmaW5hbCBjaGlsZHJlbiBjbGVhbnVwCiAgICAgIC8vIGZpbHRlciBvdXQgc2NvcGVkIHNsb3RzCiAgICAgIGVsZW1lbnQuY2hpbGRyZW4gPSBlbGVtZW50LmNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoYykgeyByZXR1cm4gIShjKS5zbG90U2NvcGU7IH0pOwogICAgICAvLyByZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZSBub2RlIGFnYWluCiAgICAgIHRyaW1FbmRpbmdXaGl0ZXNwYWNlKGVsZW1lbnQpOwoKICAgICAgLy8gY2hlY2sgcHJlIHN0YXRlCiAgICAgIGlmIChlbGVtZW50LnByZSkgewogICAgICAgIGluVlByZSA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChwbGF0Zm9ybUlzUHJlVGFnKGVsZW1lbnQudGFnKSkgewogICAgICAgIGluUHJlID0gZmFsc2U7CiAgICAgIH0KICAgICAgLy8gYXBwbHkgcG9zdC10cmFuc2Zvcm1zCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zdFRyYW5zZm9ybXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBwb3N0VHJhbnNmb3Jtc1tpXShlbGVtZW50LCBvcHRpb25zKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyaW1FbmRpbmdXaGl0ZXNwYWNlIChlbCkgewogICAgICAvLyByZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZSBub2RlCiAgICAgIGlmICghaW5QcmUpIHsKICAgICAgICB2YXIgbGFzdE5vZGU7CiAgICAgICAgd2hpbGUgKAogICAgICAgICAgKGxhc3ROb2RlID0gZWwuY2hpbGRyZW5bZWwuY2hpbGRyZW4ubGVuZ3RoIC0gMV0pICYmCiAgICAgICAgICBsYXN0Tm9kZS50eXBlID09PSAzICYmCiAgICAgICAgICBsYXN0Tm9kZS50ZXh0ID09PSAnICcKICAgICAgICApIHsKICAgICAgICAgIGVsLmNoaWxkcmVuLnBvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrUm9vdENvbnN0cmFpbnRzIChlbCkgewogICAgICBpZiAoZWwudGFnID09PSAnc2xvdCcgfHwgZWwudGFnID09PSAndGVtcGxhdGUnKSB7CiAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAiQ2Fubm90IHVzZSA8IiArIChlbC50YWcpICsgIj4gYXMgY29tcG9uZW50IHJvb3QgZWxlbWVudCBiZWNhdXNlIGl0IG1heSAiICsKICAgICAgICAgICdjb250YWluIG11bHRpcGxlIG5vZGVzLicsCiAgICAgICAgICB7IHN0YXJ0OiBlbC5zdGFydCB9CiAgICAgICAgKTsKICAgICAgfQogICAgICBpZiAoZWwuYXR0cnNNYXAuaGFzT3duUHJvcGVydHkoJ3YtZm9yJykpIHsKICAgICAgICB3YXJuT25jZSgKICAgICAgICAgICdDYW5ub3QgdXNlIHYtZm9yIG9uIHN0YXRlZnVsIGNvbXBvbmVudCByb290IGVsZW1lbnQgYmVjYXVzZSAnICsKICAgICAgICAgICdpdCByZW5kZXJzIG11bHRpcGxlIGVsZW1lbnRzLicsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsndi1mb3InXQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBwYXJzZUhUTUwodGVtcGxhdGUsIHsKICAgICAgd2Fybjogd2FybiQyLAogICAgICBleHBlY3RIVE1MOiBvcHRpb25zLmV4cGVjdEhUTUwsCiAgICAgIGlzVW5hcnlUYWc6IG9wdGlvbnMuaXNVbmFyeVRhZywKICAgICAgY2FuQmVMZWZ0T3BlblRhZzogb3B0aW9ucy5jYW5CZUxlZnRPcGVuVGFnLAogICAgICBzaG91bGREZWNvZGVOZXdsaW5lczogb3B0aW9ucy5zaG91bGREZWNvZGVOZXdsaW5lcywKICAgICAgc2hvdWxkRGVjb2RlTmV3bGluZXNGb3JIcmVmOiBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZiwKICAgICAgc2hvdWxkS2VlcENvbW1lbnQ6IG9wdGlvbnMuY29tbWVudHMsCiAgICAgIG91dHB1dFNvdXJjZVJhbmdlOiBvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlLAogICAgICBzdGFydDogZnVuY3Rpb24gc3RhcnQgKHRhZywgYXR0cnMsIHVuYXJ5LCBzdGFydCQxLCBlbmQpIHsKICAgICAgICAvLyBjaGVjayBuYW1lc3BhY2UuCiAgICAgICAgLy8gaW5oZXJpdCBwYXJlbnQgbnMgaWYgdGhlcmUgaXMgb25lCiAgICAgICAgdmFyIG5zID0gKGN1cnJlbnRQYXJlbnQgJiYgY3VycmVudFBhcmVudC5ucykgfHwgcGxhdGZvcm1HZXRUYWdOYW1lc3BhY2UodGFnKTsKCiAgICAgICAgLy8gaGFuZGxlIElFIHN2ZyBidWcKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoaXNJRSAmJiBucyA9PT0gJ3N2ZycpIHsKICAgICAgICAgIGF0dHJzID0gZ3VhcmRJRVNWR0J1ZyhhdHRycyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZWxlbWVudCA9IGNyZWF0ZUFTVEVsZW1lbnQodGFnLCBhdHRycywgY3VycmVudFBhcmVudCk7CiAgICAgICAgaWYgKG5zKSB7CiAgICAgICAgICBlbGVtZW50Lm5zID0gbnM7CiAgICAgICAgfQoKICAgICAgICB7CiAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICBlbGVtZW50LnN0YXJ0ID0gc3RhcnQkMTsKICAgICAgICAgICAgZWxlbWVudC5lbmQgPSBlbmQ7CiAgICAgICAgICAgIGVsZW1lbnQucmF3QXR0cnNNYXAgPSBlbGVtZW50LmF0dHJzTGlzdC5yZWR1Y2UoZnVuY3Rpb24gKGN1bXVsYXRlZCwgYXR0cikgewogICAgICAgICAgICAgIGN1bXVsYXRlZFthdHRyLm5hbWVdID0gYXR0cjsKICAgICAgICAgICAgICByZXR1cm4gY3VtdWxhdGVkCiAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgIH0KICAgICAgICAgIGF0dHJzLmZvckVhY2goZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgICAgICAgaWYgKGludmFsaWRBdHRyaWJ1dGVSRS50ZXN0KGF0dHIubmFtZSkpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiSW52YWxpZCBkeW5hbWljIGFyZ3VtZW50IGV4cHJlc3Npb246IGF0dHJpYnV0ZSBuYW1lcyBjYW5ub3QgY29udGFpbiAiICsKICAgICAgICAgICAgICAgICJzcGFjZXMsIHF1b3RlcywgPCwgPiwgLyBvciA9LiIsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0OiBhdHRyLnN0YXJ0ICsgYXR0ci5uYW1lLmluZGV4T2YoIlsiKSwKICAgICAgICAgICAgICAgICAgZW5kOiBhdHRyLnN0YXJ0ICsgYXR0ci5uYW1lLmxlbmd0aAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzRm9yYmlkZGVuVGFnKGVsZW1lbnQpICYmICFpc1NlcnZlclJlbmRlcmluZygpKSB7CiAgICAgICAgICBlbGVtZW50LmZvcmJpZGRlbiA9IHRydWU7CiAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICdUZW1wbGF0ZXMgc2hvdWxkIG9ubHkgYmUgcmVzcG9uc2libGUgZm9yIG1hcHBpbmcgdGhlIHN0YXRlIHRvIHRoZSAnICsKICAgICAgICAgICAgJ1VJLiBBdm9pZCBwbGFjaW5nIHRhZ3Mgd2l0aCBzaWRlLWVmZmVjdHMgaW4geW91ciB0ZW1wbGF0ZXMsIHN1Y2ggYXMgJyArCiAgICAgICAgICAgICI8IiArIHRhZyArICI+IiArICcsIGFzIHRoZXkgd2lsbCBub3QgYmUgcGFyc2VkLicsCiAgICAgICAgICAgIHsgc3RhcnQ6IGVsZW1lbnQuc3RhcnQgfQogICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIC8vIGFwcGx5IHByZS10cmFuc2Zvcm1zCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmVUcmFuc2Zvcm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBlbGVtZW50ID0gcHJlVHJhbnNmb3Jtc1tpXShlbGVtZW50LCBvcHRpb25zKSB8fCBlbGVtZW50OwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpblZQcmUpIHsKICAgICAgICAgIHByb2Nlc3NQcmUoZWxlbWVudCk7CiAgICAgICAgICBpZiAoZWxlbWVudC5wcmUpIHsKICAgICAgICAgICAgaW5WUHJlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHBsYXRmb3JtSXNQcmVUYWcoZWxlbWVudC50YWcpKSB7CiAgICAgICAgICBpblByZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpblZQcmUpIHsKICAgICAgICAgIHByb2Nlc3NSYXdBdHRycyhlbGVtZW50KTsKICAgICAgICB9IGVsc2UgaWYgKCFlbGVtZW50LnByb2Nlc3NlZCkgewogICAgICAgICAgLy8gc3RydWN0dXJhbCBkaXJlY3RpdmVzCiAgICAgICAgICBwcm9jZXNzRm9yKGVsZW1lbnQpOwogICAgICAgICAgcHJvY2Vzc0lmKGVsZW1lbnQpOwogICAgICAgICAgcHJvY2Vzc09uY2UoZWxlbWVudCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJvb3QpIHsKICAgICAgICAgIHJvb3QgPSBlbGVtZW50OwogICAgICAgICAgewogICAgICAgICAgICBjaGVja1Jvb3RDb25zdHJhaW50cyhyb290KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghdW5hcnkpIHsKICAgICAgICAgIGN1cnJlbnRQYXJlbnQgPSBlbGVtZW50OwogICAgICAgICAgc3RhY2sucHVzaChlbGVtZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2xvc2VFbGVtZW50KGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGVuZDogZnVuY3Rpb24gZW5kICh0YWcsIHN0YXJ0LCBlbmQkMSkgewogICAgICAgIHZhciBlbGVtZW50ID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgLy8gcG9wIHN0YWNrCiAgICAgICAgc3RhY2subGVuZ3RoIC09IDE7CiAgICAgICAgY3VycmVudFBhcmVudCA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICBlbGVtZW50LmVuZCA9IGVuZCQxOwogICAgICAgIH0KICAgICAgICBjbG9zZUVsZW1lbnQoZWxlbWVudCk7CiAgICAgIH0sCgogICAgICBjaGFyczogZnVuY3Rpb24gY2hhcnMgKHRleHQsIHN0YXJ0LCBlbmQpIHsKICAgICAgICBpZiAoIWN1cnJlbnRQYXJlbnQpIHsKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKHRleHQgPT09IHRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAgICAgICAnQ29tcG9uZW50IHRlbXBsYXRlIHJlcXVpcmVzIGEgcm9vdCBlbGVtZW50LCByYXRoZXIgdGhhbiBqdXN0IHRleHQuJywKICAgICAgICAgICAgICAgIHsgc3RhcnQ6IHN0YXJ0IH0KICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgaWYgKCh0ZXh0ID0gdGV4dC50cmltKCkpKSB7CiAgICAgICAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAgICAgICAoInRleHQgXCIiICsgdGV4dCArICJcIiBvdXRzaWRlIHJvb3QgZWxlbWVudCB3aWxsIGJlIGlnbm9yZWQuIiksCiAgICAgICAgICAgICAgICB7IHN0YXJ0OiBzdGFydCB9CiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIC8vIElFIHRleHRhcmVhIHBsYWNlaG9sZGVyIGJ1ZwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmIChpc0lFICYmCiAgICAgICAgICBjdXJyZW50UGFyZW50LnRhZyA9PT0gJ3RleHRhcmVhJyAmJgogICAgICAgICAgY3VycmVudFBhcmVudC5hdHRyc01hcC5wbGFjZWhvbGRlciA9PT0gdGV4dAogICAgICAgICkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHZhciBjaGlsZHJlbiA9IGN1cnJlbnRQYXJlbnQuY2hpbGRyZW47CiAgICAgICAgaWYgKGluUHJlIHx8IHRleHQudHJpbSgpKSB7CiAgICAgICAgICB0ZXh0ID0gaXNUZXh0VGFnKGN1cnJlbnRQYXJlbnQpID8gdGV4dCA6IGRlY29kZUhUTUxDYWNoZWQodGV4dCk7CiAgICAgICAgfSBlbHNlIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICAvLyByZW1vdmUgdGhlIHdoaXRlc3BhY2Utb25seSBub2RlIHJpZ2h0IGFmdGVyIGFuIG9wZW5pbmcgdGFnCiAgICAgICAgICB0ZXh0ID0gJyc7CiAgICAgICAgfSBlbHNlIGlmICh3aGl0ZXNwYWNlT3B0aW9uKSB7CiAgICAgICAgICBpZiAod2hpdGVzcGFjZU9wdGlvbiA9PT0gJ2NvbmRlbnNlJykgewogICAgICAgICAgICAvLyBpbiBjb25kZW5zZSBtb2RlLCByZW1vdmUgdGhlIHdoaXRlc3BhY2Ugbm9kZSBpZiBpdCBjb250YWlucwogICAgICAgICAgICAvLyBsaW5lIGJyZWFrLCBvdGhlcndpc2UgY29uZGVuc2UgdG8gYSBzaW5nbGUgc3BhY2UKICAgICAgICAgICAgdGV4dCA9IGxpbmVCcmVha1JFLnRlc3QodGV4dCkgPyAnJyA6ICcgJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHQgPSAnICc7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRleHQgPSBwcmVzZXJ2ZVdoaXRlc3BhY2UgPyAnICcgOiAnJzsKICAgICAgICB9CiAgICAgICAgaWYgKHRleHQpIHsKICAgICAgICAgIGlmICghaW5QcmUgJiYgd2hpdGVzcGFjZU9wdGlvbiA9PT0gJ2NvbmRlbnNlJykgewogICAgICAgICAgICAvLyBjb25kZW5zZSBjb25zZWN1dGl2ZSB3aGl0ZXNwYWNlcyBpbnRvIHNpbmdsZSBzcGFjZQogICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHdoaXRlc3BhY2VSRSQxLCAnICcpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHJlczsKICAgICAgICAgIHZhciBjaGlsZDsKICAgICAgICAgIGlmICghaW5WUHJlICYmIHRleHQgIT09ICcgJyAmJiAocmVzID0gcGFyc2VUZXh0KHRleHQsIGRlbGltaXRlcnMpKSkgewogICAgICAgICAgICBjaGlsZCA9IHsKICAgICAgICAgICAgICB0eXBlOiAyLAogICAgICAgICAgICAgIGV4cHJlc3Npb246IHJlcy5leHByZXNzaW9uLAogICAgICAgICAgICAgIHRva2VuczogcmVzLnRva2VucywKICAgICAgICAgICAgICB0ZXh0OiB0ZXh0CiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgaWYgKHRleHQgIT09ICcgJyB8fCAhY2hpbGRyZW4ubGVuZ3RoIHx8IGNoaWxkcmVuW2NoaWxkcmVuLmxlbmd0aCAtIDFdLnRleHQgIT09ICcgJykgewogICAgICAgICAgICBjaGlsZCA9IHsKICAgICAgICAgICAgICB0eXBlOiAzLAogICAgICAgICAgICAgIHRleHQ6IHRleHQKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjaGlsZCkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICAgIGNoaWxkLnN0YXJ0ID0gc3RhcnQ7CiAgICAgICAgICAgICAgY2hpbGQuZW5kID0gZW5kOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgY29tbWVudDogZnVuY3Rpb24gY29tbWVudCAodGV4dCwgc3RhcnQsIGVuZCkgewogICAgICAgIC8vIGFkZGluZyBhbnl0aGluZyBhcyBhIHNpYmxpbmcgdG8gdGhlIHJvb3Qgbm9kZSBpcyBmb3JiaWRkZW4KICAgICAgICAvLyBjb21tZW50cyBzaG91bGQgc3RpbGwgYmUgYWxsb3dlZCwgYnV0IGlnbm9yZWQKICAgICAgICBpZiAoY3VycmVudFBhcmVudCkgewogICAgICAgICAgdmFyIGNoaWxkID0gewogICAgICAgICAgICB0eXBlOiAzLAogICAgICAgICAgICB0ZXh0OiB0ZXh0LAogICAgICAgICAgICBpc0NvbW1lbnQ6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICBjaGlsZC5zdGFydCA9IHN0YXJ0OwogICAgICAgICAgICBjaGlsZC5lbmQgPSBlbmQ7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50UGFyZW50LmNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcm9vdAogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc1ByZSAoZWwpIHsKICAgIGlmIChnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1wcmUnKSAhPSBudWxsKSB7CiAgICAgIGVsLnByZSA9IHRydWU7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzUmF3QXR0cnMgKGVsKSB7CiAgICB2YXIgbGlzdCA9IGVsLmF0dHJzTGlzdDsKICAgIHZhciBsZW4gPSBsaXN0Lmxlbmd0aDsKICAgIGlmIChsZW4pIHsKICAgICAgdmFyIGF0dHJzID0gZWwuYXR0cnMgPSBuZXcgQXJyYXkobGVuKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgIGF0dHJzW2ldID0gewogICAgICAgICAgbmFtZTogbGlzdFtpXS5uYW1lLAogICAgICAgICAgdmFsdWU6IEpTT04uc3RyaW5naWZ5KGxpc3RbaV0udmFsdWUpCiAgICAgICAgfTsKICAgICAgICBpZiAobGlzdFtpXS5zdGFydCAhPSBudWxsKSB7CiAgICAgICAgICBhdHRyc1tpXS5zdGFydCA9IGxpc3RbaV0uc3RhcnQ7CiAgICAgICAgICBhdHRyc1tpXS5lbmQgPSBsaXN0W2ldLmVuZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIWVsLnByZSkgewogICAgICAvLyBub24gcm9vdCBub2RlIGluIHByZSBibG9ja3Mgd2l0aCBubyBhdHRyaWJ1dGVzCiAgICAgIGVsLnBsYWluID0gdHJ1ZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NFbGVtZW50ICgKICAgIGVsZW1lbnQsCiAgICBvcHRpb25zCiAgKSB7CiAgICBwcm9jZXNzS2V5KGVsZW1lbnQpOwoKICAgIC8vIGRldGVybWluZSB3aGV0aGVyIHRoaXMgaXMgYSBwbGFpbiBlbGVtZW50IGFmdGVyCiAgICAvLyByZW1vdmluZyBzdHJ1Y3R1cmFsIGF0dHJpYnV0ZXMKICAgIGVsZW1lbnQucGxhaW4gPSAoCiAgICAgICFlbGVtZW50LmtleSAmJgogICAgICAhZWxlbWVudC5zY29wZWRTbG90cyAmJgogICAgICAhZWxlbWVudC5hdHRyc0xpc3QubGVuZ3RoCiAgICApOwoKICAgIHByb2Nlc3NSZWYoZWxlbWVudCk7CiAgICBwcm9jZXNzU2xvdENvbnRlbnQoZWxlbWVudCk7CiAgICBwcm9jZXNzU2xvdE91dGxldChlbGVtZW50KTsKICAgIHByb2Nlc3NDb21wb25lbnQoZWxlbWVudCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyYW5zZm9ybXMubGVuZ3RoOyBpKyspIHsKICAgICAgZWxlbWVudCA9IHRyYW5zZm9ybXNbaV0oZWxlbWVudCwgb3B0aW9ucykgfHwgZWxlbWVudDsKICAgIH0KICAgIHByb2Nlc3NBdHRycyhlbGVtZW50KTsKICAgIHJldHVybiBlbGVtZW50CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzS2V5IChlbCkgewogICAgdmFyIGV4cCA9IGdldEJpbmRpbmdBdHRyKGVsLCAna2V5Jyk7CiAgICBpZiAoZXhwKSB7CiAgICAgIHsKICAgICAgICBpZiAoZWwudGFnID09PSAndGVtcGxhdGUnKSB7CiAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICI8dGVtcGxhdGU+IGNhbm5vdCBiZSBrZXllZC4gUGxhY2UgdGhlIGtleSBvbiByZWFsIGVsZW1lbnRzIGluc3RlYWQuIiwKICAgICAgICAgICAgZ2V0UmF3QmluZGluZ0F0dHIoZWwsICdrZXknKQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGVsLmZvcikgewogICAgICAgICAgdmFyIGl0ZXJhdG9yID0gZWwuaXRlcmF0b3IyIHx8IGVsLml0ZXJhdG9yMTsKICAgICAgICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQ7CiAgICAgICAgICBpZiAoaXRlcmF0b3IgJiYgaXRlcmF0b3IgPT09IGV4cCAmJiBwYXJlbnQgJiYgcGFyZW50LnRhZyA9PT0gJ3RyYW5zaXRpb24tZ3JvdXAnKSB7CiAgICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgICAiRG8gbm90IHVzZSB2LWZvciBpbmRleCBhcyBrZXkgb24gPHRyYW5zaXRpb24tZ3JvdXA+IGNoaWxkcmVuLCAiICsKICAgICAgICAgICAgICAidGhpcyBpcyB0aGUgc2FtZSBhcyBub3QgdXNpbmcga2V5cy4iLAogICAgICAgICAgICAgIGdldFJhd0JpbmRpbmdBdHRyKGVsLCAna2V5JyksCiAgICAgICAgICAgICAgdHJ1ZSAvKiB0aXAgKi8KICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZWwua2V5ID0gZXhwOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc1JlZiAoZWwpIHsKICAgIHZhciByZWYgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3JlZicpOwogICAgaWYgKHJlZikgewogICAgICBlbC5yZWYgPSByZWY7CiAgICAgIGVsLnJlZkluRm9yID0gY2hlY2tJbkZvcihlbCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzRm9yIChlbCkgewogICAgdmFyIGV4cDsKICAgIGlmICgoZXhwID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3YtZm9yJykpKSB7CiAgICAgIHZhciByZXMgPSBwYXJzZUZvcihleHApOwogICAgICBpZiAocmVzKSB7CiAgICAgICAgZXh0ZW5kKGVsLCByZXMpOwogICAgICB9IGVsc2UgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICgiSW52YWxpZCB2LWZvciBleHByZXNzaW9uOiAiICsgZXhwKSwKICAgICAgICAgIGVsLnJhd0F0dHJzTWFwWyd2LWZvciddCiAgICAgICAgKTsKICAgICAgfQogICAgfQogIH0KCgoKICBmdW5jdGlvbiBwYXJzZUZvciAoZXhwKSB7CiAgICB2YXIgaW5NYXRjaCA9IGV4cC5tYXRjaChmb3JBbGlhc1JFKTsKICAgIGlmICghaW5NYXRjaCkgeyByZXR1cm4gfQogICAgdmFyIHJlcyA9IHt9OwogICAgcmVzLmZvciA9IGluTWF0Y2hbMl0udHJpbSgpOwogICAgdmFyIGFsaWFzID0gaW5NYXRjaFsxXS50cmltKCkucmVwbGFjZShzdHJpcFBhcmVuc1JFLCAnJyk7CiAgICB2YXIgaXRlcmF0b3JNYXRjaCA9IGFsaWFzLm1hdGNoKGZvckl0ZXJhdG9yUkUpOwogICAgaWYgKGl0ZXJhdG9yTWF0Y2gpIHsKICAgICAgcmVzLmFsaWFzID0gYWxpYXMucmVwbGFjZShmb3JJdGVyYXRvclJFLCAnJykudHJpbSgpOwogICAgICByZXMuaXRlcmF0b3IxID0gaXRlcmF0b3JNYXRjaFsxXS50cmltKCk7CiAgICAgIGlmIChpdGVyYXRvck1hdGNoWzJdKSB7CiAgICAgICAgcmVzLml0ZXJhdG9yMiA9IGl0ZXJhdG9yTWF0Y2hbMl0udHJpbSgpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICByZXMuYWxpYXMgPSBhbGlhczsKICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NJZiAoZWwpIHsKICAgIHZhciBleHAgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1pZicpOwogICAgaWYgKGV4cCkgewogICAgICBlbC5pZiA9IGV4cDsKICAgICAgYWRkSWZDb25kaXRpb24oZWwsIHsKICAgICAgICBleHA6IGV4cCwKICAgICAgICBibG9jazogZWwKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBpZiAoZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3YtZWxzZScpICE9IG51bGwpIHsKICAgICAgICBlbC5lbHNlID0gdHJ1ZTsKICAgICAgfQogICAgICB2YXIgZWxzZWlmID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3YtZWxzZS1pZicpOwogICAgICBpZiAoZWxzZWlmKSB7CiAgICAgICAgZWwuZWxzZWlmID0gZWxzZWlmOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzSWZDb25kaXRpb25zIChlbCwgcGFyZW50KSB7CiAgICB2YXIgcHJldiA9IGZpbmRQcmV2RWxlbWVudChwYXJlbnQuY2hpbGRyZW4pOwogICAgaWYgKHByZXYgJiYgcHJldi5pZikgewogICAgICBhZGRJZkNvbmRpdGlvbihwcmV2LCB7CiAgICAgICAgZXhwOiBlbC5lbHNlaWYsCiAgICAgICAgYmxvY2s6IGVsCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgd2FybiQyKAogICAgICAgICJ2LSIgKyAoZWwuZWxzZWlmID8gKCdlbHNlLWlmPSInICsgZWwuZWxzZWlmICsgJyInKSA6ICdlbHNlJykgKyAiICIgKwogICAgICAgICJ1c2VkIG9uIGVsZW1lbnQgPCIgKyAoZWwudGFnKSArICI+IHdpdGhvdXQgY29ycmVzcG9uZGluZyB2LWlmLiIsCiAgICAgICAgZWwucmF3QXR0cnNNYXBbZWwuZWxzZWlmID8gJ3YtZWxzZS1pZicgOiAndi1lbHNlJ10KICAgICAgKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGZpbmRQcmV2RWxlbWVudCAoY2hpbGRyZW4pIHsKICAgIHZhciBpID0gY2hpbGRyZW4ubGVuZ3RoOwogICAgd2hpbGUgKGktLSkgewogICAgICBpZiAoY2hpbGRyZW5baV0udHlwZSA9PT0gMSkgewogICAgICAgIHJldHVybiBjaGlsZHJlbltpXQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChjaGlsZHJlbltpXS50ZXh0ICE9PSAnICcpIHsKICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgInRleHQgXCIiICsgKGNoaWxkcmVuW2ldLnRleHQudHJpbSgpKSArICJcIiBiZXR3ZWVuIHYtaWYgYW5kIHYtZWxzZSgtaWYpICIgKwogICAgICAgICAgICAid2lsbCBiZSBpZ25vcmVkLiIsCiAgICAgICAgICAgIGNoaWxkcmVuW2ldCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBjaGlsZHJlbi5wb3AoKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gYWRkSWZDb25kaXRpb24gKGVsLCBjb25kaXRpb24pIHsKICAgIGlmICghZWwuaWZDb25kaXRpb25zKSB7CiAgICAgIGVsLmlmQ29uZGl0aW9ucyA9IFtdOwogICAgfQogICAgZWwuaWZDb25kaXRpb25zLnB1c2goY29uZGl0aW9uKTsKICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NPbmNlIChlbCkgewogICAgdmFyIG9uY2UkJDEgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1vbmNlJyk7CiAgICBpZiAob25jZSQkMSAhPSBudWxsKSB7CiAgICAgIGVsLm9uY2UgPSB0cnVlOwogICAgfQogIH0KCiAgLy8gaGFuZGxlIGNvbnRlbnQgYmVpbmcgcGFzc2VkIHRvIGEgY29tcG9uZW50IGFzIHNsb3QsCiAgLy8gZS5nLiA8dGVtcGxhdGUgc2xvdD0ieHh4Ij4sIDxkaXYgc2xvdC1zY29wZT0ieHh4Ij4KICBmdW5jdGlvbiBwcm9jZXNzU2xvdENvbnRlbnQgKGVsKSB7CiAgICB2YXIgc2xvdFNjb3BlOwogICAgaWYgKGVsLnRhZyA9PT0gJ3RlbXBsYXRlJykgewogICAgICBzbG90U2NvcGUgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAnc2NvcGUnKTsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmIChzbG90U2NvcGUpIHsKICAgICAgICB3YXJuJDIoCiAgICAgICAgICAidGhlIFwic2NvcGVcIiBhdHRyaWJ1dGUgZm9yIHNjb3BlZCBzbG90cyBoYXZlIGJlZW4gZGVwcmVjYXRlZCBhbmQgIiArCiAgICAgICAgICAicmVwbGFjZWQgYnkgXCJzbG90LXNjb3BlXCIgc2luY2UgMi41LiBUaGUgbmV3IFwic2xvdC1zY29wZVwiIGF0dHJpYnV0ZSAiICsKICAgICAgICAgICJjYW4gYWxzbyBiZSB1c2VkIG9uIHBsYWluIGVsZW1lbnRzIGluIGFkZGl0aW9uIHRvIDx0ZW1wbGF0ZT4gdG8gIiArCiAgICAgICAgICAiZGVub3RlIHNjb3BlZCBzbG90cy4iLAogICAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3Njb3BlJ10sCiAgICAgICAgICB0cnVlCiAgICAgICAgKTsKICAgICAgfQogICAgICBlbC5zbG90U2NvcGUgPSBzbG90U2NvcGUgfHwgZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3Nsb3Qtc2NvcGUnKTsKICAgIH0gZWxzZSBpZiAoKHNsb3RTY29wZSA9IGdldEFuZFJlbW92ZUF0dHIoZWwsICdzbG90LXNjb3BlJykpKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoZWwuYXR0cnNNYXBbJ3YtZm9yJ10pIHsKICAgICAgICB3YXJuJDIoCiAgICAgICAgICAiQW1iaWd1b3VzIGNvbWJpbmVkIHVzYWdlIG9mIHNsb3Qtc2NvcGUgYW5kIHYtZm9yIG9uIDwiICsgKGVsLnRhZykgKyAiPiAiICsKICAgICAgICAgICIodi1mb3IgdGFrZXMgaGlnaGVyIHByaW9yaXR5KS4gVXNlIGEgd3JhcHBlciA8dGVtcGxhdGU+IGZvciB0aGUgIiArCiAgICAgICAgICAic2NvcGVkIHNsb3QgdG8gbWFrZSBpdCBjbGVhcmVyLiIsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsnc2xvdC1zY29wZSddLAogICAgICAgICAgdHJ1ZQogICAgICAgICk7CiAgICAgIH0KICAgICAgZWwuc2xvdFNjb3BlID0gc2xvdFNjb3BlOwogICAgfQoKICAgIC8vIHNsb3Q9Inh4eCIKICAgIHZhciBzbG90VGFyZ2V0ID0gZ2V0QmluZGluZ0F0dHIoZWwsICdzbG90Jyk7CiAgICBpZiAoc2xvdFRhcmdldCkgewogICAgICBlbC5zbG90VGFyZ2V0ID0gc2xvdFRhcmdldCA9PT0gJyIiJyA/ICciZGVmYXVsdCInIDogc2xvdFRhcmdldDsKICAgICAgZWwuc2xvdFRhcmdldER5bmFtaWMgPSAhIShlbC5hdHRyc01hcFsnOnNsb3QnXSB8fCBlbC5hdHRyc01hcFsndi1iaW5kOnNsb3QnXSk7CiAgICAgIC8vIHByZXNlcnZlIHNsb3QgYXMgYW4gYXR0cmlidXRlIGZvciBuYXRpdmUgc2hhZG93IERPTSBjb21wYXQKICAgICAgLy8gb25seSBmb3Igbm9uLXNjb3BlZCBzbG90cy4KICAgICAgaWYgKGVsLnRhZyAhPT0gJ3RlbXBsYXRlJyAmJiAhZWwuc2xvdFNjb3BlKSB7CiAgICAgICAgYWRkQXR0cihlbCwgJ3Nsb3QnLCBzbG90VGFyZ2V0LCBnZXRSYXdCaW5kaW5nQXR0cihlbCwgJ3Nsb3QnKSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyAyLjYgdi1zbG90IHN5bnRheAogICAgewogICAgICBpZiAoZWwudGFnID09PSAndGVtcGxhdGUnKSB7CiAgICAgICAgLy8gdi1zbG90IG9uIDx0ZW1wbGF0ZT4KICAgICAgICB2YXIgc2xvdEJpbmRpbmcgPSBnZXRBbmRSZW1vdmVBdHRyQnlSZWdleChlbCwgc2xvdFJFKTsKICAgICAgICBpZiAoc2xvdEJpbmRpbmcpIHsKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKGVsLnNsb3RUYXJnZXQgfHwgZWwuc2xvdFNjb3BlKSB7CiAgICAgICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAgICAgIlVuZXhwZWN0ZWQgbWl4ZWQgdXNhZ2Ugb2YgZGlmZmVyZW50IHNsb3Qgc3ludGF4ZXMuIiwKICAgICAgICAgICAgICAgIGVsCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZWwucGFyZW50ICYmICFtYXliZUNvbXBvbmVudChlbC5wYXJlbnQpKSB7CiAgICAgICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAgICAgIjx0ZW1wbGF0ZSB2LXNsb3Q+IGNhbiBvbmx5IGFwcGVhciBhdCB0aGUgcm9vdCBsZXZlbCBpbnNpZGUgIiArCiAgICAgICAgICAgICAgICAidGhlIHJlY2VpdmluZyBjb21wb25lbnQiLAogICAgICAgICAgICAgICAgZWwKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVmID0gZ2V0U2xvdE5hbWUoc2xvdEJpbmRpbmcpOwogICAgICAgICAgdmFyIG5hbWUgPSByZWYubmFtZTsKICAgICAgICAgIHZhciBkeW5hbWljID0gcmVmLmR5bmFtaWM7CiAgICAgICAgICBlbC5zbG90VGFyZ2V0ID0gbmFtZTsKICAgICAgICAgIGVsLnNsb3RUYXJnZXREeW5hbWljID0gZHluYW1pYzsKICAgICAgICAgIGVsLnNsb3RTY29wZSA9IHNsb3RCaW5kaW5nLnZhbHVlIHx8IGVtcHR5U2xvdFNjb3BlVG9rZW47IC8vIGZvcmNlIGl0IGludG8gYSBzY29wZWQgc2xvdCBmb3IgcGVyZgogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB2LXNsb3Qgb24gY29tcG9uZW50LCBkZW5vdGVzIGRlZmF1bHQgc2xvdAogICAgICAgIHZhciBzbG90QmluZGluZyQxID0gZ2V0QW5kUmVtb3ZlQXR0ckJ5UmVnZXgoZWwsIHNsb3RSRSk7CiAgICAgICAgaWYgKHNsb3RCaW5kaW5nJDEpIHsKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKCFtYXliZUNvbXBvbmVudChlbCkpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAidi1zbG90IGNhbiBvbmx5IGJlIHVzZWQgb24gY29tcG9uZW50cyBvciA8dGVtcGxhdGU+LiIsCiAgICAgICAgICAgICAgICBzbG90QmluZGluZyQxCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZWwuc2xvdFNjb3BlIHx8IGVsLnNsb3RUYXJnZXQpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiVW5leHBlY3RlZCBtaXhlZCB1c2FnZSBvZiBkaWZmZXJlbnQgc2xvdCBzeW50YXhlcy4iLAogICAgICAgICAgICAgICAgZWwKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbC5zY29wZWRTbG90cykgewogICAgICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgICAgICJUbyBhdm9pZCBzY29wZSBhbWJpZ3VpdHksIHRoZSBkZWZhdWx0IHNsb3Qgc2hvdWxkIGFsc28gdXNlICIgKwogICAgICAgICAgICAgICAgIjx0ZW1wbGF0ZT4gc3ludGF4IHdoZW4gdGhlcmUgYXJlIG90aGVyIG5hbWVkIHNsb3RzLiIsCiAgICAgICAgICAgICAgICBzbG90QmluZGluZyQxCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gYWRkIHRoZSBjb21wb25lbnQncyBjaGlsZHJlbiB0byBpdHMgZGVmYXVsdCBzbG90CiAgICAgICAgICB2YXIgc2xvdHMgPSBlbC5zY29wZWRTbG90cyB8fCAoZWwuc2NvcGVkU2xvdHMgPSB7fSk7CiAgICAgICAgICB2YXIgcmVmJDEgPSBnZXRTbG90TmFtZShzbG90QmluZGluZyQxKTsKICAgICAgICAgIHZhciBuYW1lJDEgPSByZWYkMS5uYW1lOwogICAgICAgICAgdmFyIGR5bmFtaWMkMSA9IHJlZiQxLmR5bmFtaWM7CiAgICAgICAgICB2YXIgc2xvdENvbnRhaW5lciA9IHNsb3RzW25hbWUkMV0gPSBjcmVhdGVBU1RFbGVtZW50KCd0ZW1wbGF0ZScsIFtdLCBlbCk7CiAgICAgICAgICBzbG90Q29udGFpbmVyLnNsb3RUYXJnZXQgPSBuYW1lJDE7CiAgICAgICAgICBzbG90Q29udGFpbmVyLnNsb3RUYXJnZXREeW5hbWljID0gZHluYW1pYyQxOwogICAgICAgICAgc2xvdENvbnRhaW5lci5jaGlsZHJlbiA9IGVsLmNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoYykgewogICAgICAgICAgICBpZiAoIWMuc2xvdFNjb3BlKSB7CiAgICAgICAgICAgICAgYy5wYXJlbnQgPSBzbG90Q29udGFpbmVyOwogICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgc2xvdENvbnRhaW5lci5zbG90U2NvcGUgPSBzbG90QmluZGluZyQxLnZhbHVlIHx8IGVtcHR5U2xvdFNjb3BlVG9rZW47CiAgICAgICAgICAvLyByZW1vdmUgY2hpbGRyZW4gYXMgdGhleSBhcmUgcmV0dXJuZWQgZnJvbSBzY29wZWRTbG90cyBub3cKICAgICAgICAgIGVsLmNoaWxkcmVuID0gW107CiAgICAgICAgICAvLyBtYXJrIGVsIG5vbi1wbGFpbiBzbyBkYXRhIGdldHMgZ2VuZXJhdGVkCiAgICAgICAgICBlbC5wbGFpbiA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0U2xvdE5hbWUgKGJpbmRpbmcpIHsKICAgIHZhciBuYW1lID0gYmluZGluZy5uYW1lLnJlcGxhY2Uoc2xvdFJFLCAnJyk7CiAgICBpZiAoIW5hbWUpIHsKICAgICAgaWYgKGJpbmRpbmcubmFtZVswXSAhPT0gJyMnKSB7CiAgICAgICAgbmFtZSA9ICdkZWZhdWx0JzsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuJDIoCiAgICAgICAgICAidi1zbG90IHNob3J0aGFuZCBzeW50YXggcmVxdWlyZXMgYSBzbG90IG5hbWUuIiwKICAgICAgICAgIGJpbmRpbmcKICAgICAgICApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZHluYW1pY0FyZ1JFLnRlc3QobmFtZSkKICAgICAgLy8gZHluYW1pYyBbbmFtZV0KICAgICAgPyB7IG5hbWU6IG5hbWUuc2xpY2UoMSwgLTEpLCBkeW5hbWljOiB0cnVlIH0KICAgICAgLy8gc3RhdGljIG5hbWUKICAgICAgOiB7IG5hbWU6ICgiXCIiICsgbmFtZSArICJcIiIpLCBkeW5hbWljOiBmYWxzZSB9CiAgfQoKICAvLyBoYW5kbGUgPHNsb3QvPiBvdXRsZXRzCiAgZnVuY3Rpb24gcHJvY2Vzc1Nsb3RPdXRsZXQgKGVsKSB7CiAgICBpZiAoZWwudGFnID09PSAnc2xvdCcpIHsKICAgICAgZWwuc2xvdE5hbWUgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ25hbWUnKTsKICAgICAgaWYgKGVsLmtleSkgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICJga2V5YCBkb2VzIG5vdCB3b3JrIG9uIDxzbG90PiBiZWNhdXNlIHNsb3RzIGFyZSBhYnN0cmFjdCBvdXRsZXRzICIgKwogICAgICAgICAgImFuZCBjYW4gcG9zc2libHkgZXhwYW5kIGludG8gbXVsdGlwbGUgZWxlbWVudHMuICIgKwogICAgICAgICAgIlVzZSB0aGUga2V5IG9uIGEgd3JhcHBpbmcgZWxlbWVudCBpbnN0ZWFkLiIsCiAgICAgICAgICBnZXRSYXdCaW5kaW5nQXR0cihlbCwgJ2tleScpCiAgICAgICAgKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc0NvbXBvbmVudCAoZWwpIHsKICAgIHZhciBiaW5kaW5nOwogICAgaWYgKChiaW5kaW5nID0gZ2V0QmluZGluZ0F0dHIoZWwsICdpcycpKSkgewogICAgICBlbC5jb21wb25lbnQgPSBiaW5kaW5nOwogICAgfQogICAgaWYgKGdldEFuZFJlbW92ZUF0dHIoZWwsICdpbmxpbmUtdGVtcGxhdGUnKSAhPSBudWxsKSB7CiAgICAgIGVsLmlubGluZVRlbXBsYXRlID0gdHJ1ZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NBdHRycyAoZWwpIHsKICAgIHZhciBsaXN0ID0gZWwuYXR0cnNMaXN0OwogICAgdmFyIGksIGwsIG5hbWUsIHJhd05hbWUsIHZhbHVlLCBtb2RpZmllcnMsIHN5bmNHZW4sIGlzRHluYW1pYzsKICAgIGZvciAoaSA9IDAsIGwgPSBsaXN0Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBuYW1lID0gcmF3TmFtZSA9IGxpc3RbaV0ubmFtZTsKICAgICAgdmFsdWUgPSBsaXN0W2ldLnZhbHVlOwogICAgICBpZiAoZGlyUkUudGVzdChuYW1lKSkgewogICAgICAgIC8vIG1hcmsgZWxlbWVudCBhcyBkeW5hbWljCiAgICAgICAgZWwuaGFzQmluZGluZ3MgPSB0cnVlOwogICAgICAgIC8vIG1vZGlmaWVycwogICAgICAgIG1vZGlmaWVycyA9IHBhcnNlTW9kaWZpZXJzKG5hbWUucmVwbGFjZShkaXJSRSwgJycpKTsKICAgICAgICAvLyBzdXBwb3J0IC5mb28gc2hvcnRoYW5kIHN5bnRheCBmb3IgdGhlIC5wcm9wIG1vZGlmaWVyCiAgICAgICAgaWYgKG1vZGlmaWVycykgewogICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZShtb2RpZmllclJFLCAnJyk7CiAgICAgICAgfQogICAgICAgIGlmIChiaW5kUkUudGVzdChuYW1lKSkgeyAvLyB2LWJpbmQKICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoYmluZFJFLCAnJyk7CiAgICAgICAgICB2YWx1ZSA9IHBhcnNlRmlsdGVycyh2YWx1ZSk7CiAgICAgICAgICBpc0R5bmFtaWMgPSBkeW5hbWljQXJnUkUudGVzdChuYW1lKTsKICAgICAgICAgIGlmIChpc0R5bmFtaWMpIHsKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc2xpY2UoMSwgLTEpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKAogICAgICAgICAgICB2YWx1ZS50cmltKCkubGVuZ3RoID09PSAwCiAgICAgICAgICApIHsKICAgICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAgICgiVGhlIHZhbHVlIGZvciBhIHYtYmluZCBleHByZXNzaW9uIGNhbm5vdCBiZSBlbXB0eS4gRm91bmQgaW4gXCJ2LWJpbmQ6IiArIG5hbWUgKyAiXCIiKQogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG1vZGlmaWVycykgewogICAgICAgICAgICBpZiAobW9kaWZpZXJzLnByb3AgJiYgIWlzRHluYW1pYykgewogICAgICAgICAgICAgIG5hbWUgPSBjYW1lbGl6ZShuYW1lKTsKICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gJ2lubmVySHRtbCcpIHsgbmFtZSA9ICdpbm5lckhUTUwnOyB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1vZGlmaWVycy5jYW1lbCAmJiAhaXNEeW5hbWljKSB7CiAgICAgICAgICAgICAgbmFtZSA9IGNhbWVsaXplKG5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtb2RpZmllcnMuc3luYykgewogICAgICAgICAgICAgIHN5bmNHZW4gPSBnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgIiRldmVudCIpOwogICAgICAgICAgICAgIGlmICghaXNEeW5hbWljKSB7CiAgICAgICAgICAgICAgICBhZGRIYW5kbGVyKAogICAgICAgICAgICAgICAgICBlbCwKICAgICAgICAgICAgICAgICAgKCJ1cGRhdGU6IiArIChjYW1lbGl6ZShuYW1lKSkpLAogICAgICAgICAgICAgICAgICBzeW5jR2VuLAogICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAgd2FybiQyLAogICAgICAgICAgICAgICAgICBsaXN0W2ldCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKGh5cGhlbmF0ZShuYW1lKSAhPT0gY2FtZWxpemUobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgYWRkSGFuZGxlcigKICAgICAgICAgICAgICAgICAgICBlbCwKICAgICAgICAgICAgICAgICAgICAoInVwZGF0ZToiICsgKGh5cGhlbmF0ZShuYW1lKSkpLAogICAgICAgICAgICAgICAgICAgIHN5bmNHZW4sCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB3YXJuJDIsCiAgICAgICAgICAgICAgICAgICAgbGlzdFtpXQogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBoYW5kbGVyIHcvIGR5bmFtaWMgZXZlbnQgbmFtZQogICAgICAgICAgICAgICAgYWRkSGFuZGxlcigKICAgICAgICAgICAgICAgICAgZWwsCiAgICAgICAgICAgICAgICAgICgiXCJ1cGRhdGU6XCIrKCIgKyBuYW1lICsgIikiKSwKICAgICAgICAgICAgICAgICAgc3luY0dlbiwKICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAgIHdhcm4kMiwKICAgICAgICAgICAgICAgICAgbGlzdFtpXSwKICAgICAgICAgICAgICAgICAgdHJ1ZSAvLyBkeW5hbWljCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKChtb2RpZmllcnMgJiYgbW9kaWZpZXJzLnByb3ApIHx8ICgKICAgICAgICAgICAgIWVsLmNvbXBvbmVudCAmJiBwbGF0Zm9ybU11c3RVc2VQcm9wKGVsLnRhZywgZWwuYXR0cnNNYXAudHlwZSwgbmFtZSkKICAgICAgICAgICkpIHsKICAgICAgICAgICAgYWRkUHJvcChlbCwgbmFtZSwgdmFsdWUsIGxpc3RbaV0sIGlzRHluYW1pYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhZGRBdHRyKGVsLCBuYW1lLCB2YWx1ZSwgbGlzdFtpXSwgaXNEeW5hbWljKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG9uUkUudGVzdChuYW1lKSkgeyAvLyB2LW9uCiAgICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKG9uUkUsICcnKTsKICAgICAgICAgIGlzRHluYW1pYyA9IGR5bmFtaWNBcmdSRS50ZXN0KG5hbWUpOwogICAgICAgICAgaWYgKGlzRHluYW1pYykgewogICAgICAgICAgICBuYW1lID0gbmFtZS5zbGljZSgxLCAtMSk7CiAgICAgICAgICB9CiAgICAgICAgICBhZGRIYW5kbGVyKGVsLCBuYW1lLCB2YWx1ZSwgbW9kaWZpZXJzLCBmYWxzZSwgd2FybiQyLCBsaXN0W2ldLCBpc0R5bmFtaWMpOwogICAgICAgIH0gZWxzZSB7IC8vIG5vcm1hbCBkaXJlY3RpdmVzCiAgICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKGRpclJFLCAnJyk7CiAgICAgICAgICAvLyBwYXJzZSBhcmcKICAgICAgICAgIHZhciBhcmdNYXRjaCA9IG5hbWUubWF0Y2goYXJnUkUpOwogICAgICAgICAgdmFyIGFyZyA9IGFyZ01hdGNoICYmIGFyZ01hdGNoWzFdOwogICAgICAgICAgaXNEeW5hbWljID0gZmFsc2U7CiAgICAgICAgICBpZiAoYXJnKSB7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnNsaWNlKDAsIC0oYXJnLmxlbmd0aCArIDEpKTsKICAgICAgICAgICAgaWYgKGR5bmFtaWNBcmdSRS50ZXN0KGFyZykpIHsKICAgICAgICAgICAgICBhcmcgPSBhcmcuc2xpY2UoMSwgLTEpOwogICAgICAgICAgICAgIGlzRHluYW1pYyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGFkZERpcmVjdGl2ZShlbCwgbmFtZSwgcmF3TmFtZSwgdmFsdWUsIGFyZywgaXNEeW5hbWljLCBtb2RpZmllcnMsIGxpc3RbaV0pOwogICAgICAgICAgaWYgKG5hbWUgPT09ICdtb2RlbCcpIHsKICAgICAgICAgICAgY2hlY2tGb3JBbGlhc01vZGVsKGVsLCB2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIGxpdGVyYWwgYXR0cmlidXRlCiAgICAgICAgewogICAgICAgICAgdmFyIHJlcyA9IHBhcnNlVGV4dCh2YWx1ZSwgZGVsaW1pdGVycyk7CiAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgICBuYW1lICsgIj1cIiIgKyB2YWx1ZSArICJcIjogIiArCiAgICAgICAgICAgICAgJ0ludGVycG9sYXRpb24gaW5zaWRlIGF0dHJpYnV0ZXMgaGFzIGJlZW4gcmVtb3ZlZC4gJyArCiAgICAgICAgICAgICAgJ1VzZSB2LWJpbmQgb3IgdGhlIGNvbG9uIHNob3J0aGFuZCBpbnN0ZWFkLiBGb3IgZXhhbXBsZSwgJyArCiAgICAgICAgICAgICAgJ2luc3RlYWQgb2YgPGRpdiBpZD0ie3sgdmFsIH19Ij4sIHVzZSA8ZGl2IDppZD0idmFsIj4uJywKICAgICAgICAgICAgICBsaXN0W2ldCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFkZEF0dHIoZWwsIG5hbWUsIEpTT04uc3RyaW5naWZ5KHZhbHVlKSwgbGlzdFtpXSk7CiAgICAgICAgLy8gIzY4ODcgZmlyZWZveCBkb2Vzbid0IHVwZGF0ZSBtdXRlZCBzdGF0ZSBpZiBzZXQgdmlhIGF0dHJpYnV0ZQogICAgICAgIC8vIGV2ZW4gaW1tZWRpYXRlbHkgYWZ0ZXIgZWxlbWVudCBjcmVhdGlvbgogICAgICAgIGlmICghZWwuY29tcG9uZW50ICYmCiAgICAgICAgICAgIG5hbWUgPT09ICdtdXRlZCcgJiYKICAgICAgICAgICAgcGxhdGZvcm1NdXN0VXNlUHJvcChlbC50YWcsIGVsLmF0dHJzTWFwLnR5cGUsIG5hbWUpKSB7CiAgICAgICAgICBhZGRQcm9wKGVsLCBuYW1lLCAndHJ1ZScsIGxpc3RbaV0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hlY2tJbkZvciAoZWwpIHsKICAgIHZhciBwYXJlbnQgPSBlbDsKICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgaWYgKHBhcmVudC5mb3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDsKICAgIH0KICAgIHJldHVybiBmYWxzZQogIH0KCiAgZnVuY3Rpb24gcGFyc2VNb2RpZmllcnMgKG5hbWUpIHsKICAgIHZhciBtYXRjaCA9IG5hbWUubWF0Y2gobW9kaWZpZXJSRSk7CiAgICBpZiAobWF0Y2gpIHsKICAgICAgdmFyIHJldCA9IHt9OwogICAgICBtYXRjaC5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7IHJldFttLnNsaWNlKDEpXSA9IHRydWU7IH0pOwogICAgICByZXR1cm4gcmV0CiAgICB9CiAgfQoKICBmdW5jdGlvbiBtYWtlQXR0cnNNYXAgKGF0dHJzKSB7CiAgICB2YXIgbWFwID0ge307CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGF0dHJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBpZiAoCiAgICAgICAgbWFwW2F0dHJzW2ldLm5hbWVdICYmICFpc0lFICYmICFpc0VkZ2UKICAgICAgKSB7CiAgICAgICAgd2FybiQyKCdkdXBsaWNhdGUgYXR0cmlidXRlOiAnICsgYXR0cnNbaV0ubmFtZSwgYXR0cnNbaV0pOwogICAgICB9CiAgICAgIG1hcFthdHRyc1tpXS5uYW1lXSA9IGF0dHJzW2ldLnZhbHVlOwogICAgfQogICAgcmV0dXJuIG1hcAogIH0KCiAgLy8gZm9yIHNjcmlwdCAoZS5nLiB0eXBlPSJ4L3RlbXBsYXRlIikgb3Igc3R5bGUsIGRvIG5vdCBkZWNvZGUgY29udGVudAogIGZ1bmN0aW9uIGlzVGV4dFRhZyAoZWwpIHsKICAgIHJldHVybiBlbC50YWcgPT09ICdzY3JpcHQnIHx8IGVsLnRhZyA9PT0gJ3N0eWxlJwogIH0KCiAgZnVuY3Rpb24gaXNGb3JiaWRkZW5UYWcgKGVsKSB7CiAgICByZXR1cm4gKAogICAgICBlbC50YWcgPT09ICdzdHlsZScgfHwKICAgICAgKGVsLnRhZyA9PT0gJ3NjcmlwdCcgJiYgKAogICAgICAgICFlbC5hdHRyc01hcC50eXBlIHx8CiAgICAgICAgZWwuYXR0cnNNYXAudHlwZSA9PT0gJ3RleHQvamF2YXNjcmlwdCcKICAgICAgKSkKICAgICkKICB9CgogIHZhciBpZU5TQnVnID0gL154bWxuczpOU1xkKy87CiAgdmFyIGllTlNQcmVmaXggPSAvXk5TXGQrOi87CgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gZ3VhcmRJRVNWR0J1ZyAoYXR0cnMpIHsKICAgIHZhciByZXMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0cnMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGF0dHIgPSBhdHRyc1tpXTsKICAgICAgaWYgKCFpZU5TQnVnLnRlc3QoYXR0ci5uYW1lKSkgewogICAgICAgIGF0dHIubmFtZSA9IGF0dHIubmFtZS5yZXBsYWNlKGllTlNQcmVmaXgsICcnKTsKICAgICAgICByZXMucHVzaChhdHRyKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gY2hlY2tGb3JBbGlhc01vZGVsIChlbCwgdmFsdWUpIHsKICAgIHZhciBfZWwgPSBlbDsKICAgIHdoaWxlIChfZWwpIHsKICAgICAgaWYgKF9lbC5mb3IgJiYgX2VsLmFsaWFzID09PSB2YWx1ZSkgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICI8IiArIChlbC50YWcpICsgIiB2LW1vZGVsPVwiIiArIHZhbHVlICsgIlwiPjogIiArCiAgICAgICAgICAiWW91IGFyZSBiaW5kaW5nIHYtbW9kZWwgZGlyZWN0bHkgdG8gYSB2LWZvciBpdGVyYXRpb24gYWxpYXMuICIgKwogICAgICAgICAgIlRoaXMgd2lsbCBub3QgYmUgYWJsZSB0byBtb2RpZnkgdGhlIHYtZm9yIHNvdXJjZSBhcnJheSBiZWNhdXNlICIgKwogICAgICAgICAgIndyaXRpbmcgdG8gdGhlIGFsaWFzIGlzIGxpa2UgbW9kaWZ5aW5nIGEgZnVuY3Rpb24gbG9jYWwgdmFyaWFibGUuICIgKwogICAgICAgICAgIkNvbnNpZGVyIHVzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYW5kIHVzZSB2LW1vZGVsIG9uIGFuIG9iamVjdCBwcm9wZXJ0eSBpbnN0ZWFkLiIsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsndi1tb2RlbCddCiAgICAgICAgKTsKICAgICAgfQogICAgICBfZWwgPSBfZWwucGFyZW50OwogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIHByZVRyYW5zZm9ybU5vZGUgKGVsLCBvcHRpb25zKSB7CiAgICBpZiAoZWwudGFnID09PSAnaW5wdXQnKSB7CiAgICAgIHZhciBtYXAgPSBlbC5hdHRyc01hcDsKICAgICAgaWYgKCFtYXBbJ3YtbW9kZWwnXSkgewogICAgICAgIHJldHVybgogICAgICB9CgogICAgICB2YXIgdHlwZUJpbmRpbmc7CiAgICAgIGlmIChtYXBbJzp0eXBlJ10gfHwgbWFwWyd2LWJpbmQ6dHlwZSddKSB7CiAgICAgICAgdHlwZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3R5cGUnKTsKICAgICAgfQogICAgICBpZiAoIW1hcC50eXBlICYmICF0eXBlQmluZGluZyAmJiBtYXBbJ3YtYmluZCddKSB7CiAgICAgICAgdHlwZUJpbmRpbmcgPSAiKCIgKyAobWFwWyd2LWJpbmQnXSkgKyAiKS50eXBlIjsKICAgICAgfQoKICAgICAgaWYgKHR5cGVCaW5kaW5nKSB7CiAgICAgICAgdmFyIGlmQ29uZGl0aW9uID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3YtaWYnLCB0cnVlKTsKICAgICAgICB2YXIgaWZDb25kaXRpb25FeHRyYSA9IGlmQ29uZGl0aW9uID8gKCImJigiICsgaWZDb25kaXRpb24gKyAiKSIpIDogIiI7CiAgICAgICAgdmFyIGhhc0Vsc2UgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1lbHNlJywgdHJ1ZSkgIT0gbnVsbDsKICAgICAgICB2YXIgZWxzZUlmQ29uZGl0aW9uID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3YtZWxzZS1pZicsIHRydWUpOwogICAgICAgIC8vIDEuIGNoZWNrYm94CiAgICAgICAgdmFyIGJyYW5jaDAgPSBjbG9uZUFTVEVsZW1lbnQoZWwpOwogICAgICAgIC8vIHByb2Nlc3MgZm9yIG9uIHRoZSBtYWluIG5vZGUKICAgICAgICBwcm9jZXNzRm9yKGJyYW5jaDApOwogICAgICAgIGFkZFJhd0F0dHIoYnJhbmNoMCwgJ3R5cGUnLCAnY2hlY2tib3gnKTsKICAgICAgICBwcm9jZXNzRWxlbWVudChicmFuY2gwLCBvcHRpb25zKTsKICAgICAgICBicmFuY2gwLnByb2Nlc3NlZCA9IHRydWU7IC8vIHByZXZlbnQgaXQgZnJvbSBkb3VibGUtcHJvY2Vzc2VkCiAgICAgICAgYnJhbmNoMC5pZiA9ICIoIiArIHR5cGVCaW5kaW5nICsgIik9PT0nY2hlY2tib3gnIiArIGlmQ29uZGl0aW9uRXh0cmE7CiAgICAgICAgYWRkSWZDb25kaXRpb24oYnJhbmNoMCwgewogICAgICAgICAgZXhwOiBicmFuY2gwLmlmLAogICAgICAgICAgYmxvY2s6IGJyYW5jaDAKICAgICAgICB9KTsKICAgICAgICAvLyAyLiBhZGQgcmFkaW8gZWxzZS1pZiBjb25kaXRpb24KICAgICAgICB2YXIgYnJhbmNoMSA9IGNsb25lQVNURWxlbWVudChlbCk7CiAgICAgICAgZ2V0QW5kUmVtb3ZlQXR0cihicmFuY2gxLCAndi1mb3InLCB0cnVlKTsKICAgICAgICBhZGRSYXdBdHRyKGJyYW5jaDEsICd0eXBlJywgJ3JhZGlvJyk7CiAgICAgICAgcHJvY2Vzc0VsZW1lbnQoYnJhbmNoMSwgb3B0aW9ucyk7CiAgICAgICAgYWRkSWZDb25kaXRpb24oYnJhbmNoMCwgewogICAgICAgICAgZXhwOiAiKCIgKyB0eXBlQmluZGluZyArICIpPT09J3JhZGlvJyIgKyBpZkNvbmRpdGlvbkV4dHJhLAogICAgICAgICAgYmxvY2s6IGJyYW5jaDEKICAgICAgICB9KTsKICAgICAgICAvLyAzLiBvdGhlcgogICAgICAgIHZhciBicmFuY2gyID0gY2xvbmVBU1RFbGVtZW50KGVsKTsKICAgICAgICBnZXRBbmRSZW1vdmVBdHRyKGJyYW5jaDIsICd2LWZvcicsIHRydWUpOwogICAgICAgIGFkZFJhd0F0dHIoYnJhbmNoMiwgJzp0eXBlJywgdHlwZUJpbmRpbmcpOwogICAgICAgIHByb2Nlc3NFbGVtZW50KGJyYW5jaDIsIG9wdGlvbnMpOwogICAgICAgIGFkZElmQ29uZGl0aW9uKGJyYW5jaDAsIHsKICAgICAgICAgIGV4cDogaWZDb25kaXRpb24sCiAgICAgICAgICBibG9jazogYnJhbmNoMgogICAgICAgIH0pOwoKICAgICAgICBpZiAoaGFzRWxzZSkgewogICAgICAgICAgYnJhbmNoMC5lbHNlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGVsc2VJZkNvbmRpdGlvbikgewogICAgICAgICAgYnJhbmNoMC5lbHNlaWYgPSBlbHNlSWZDb25kaXRpb247CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYnJhbmNoMAogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjbG9uZUFTVEVsZW1lbnQgKGVsKSB7CiAgICByZXR1cm4gY3JlYXRlQVNURWxlbWVudChlbC50YWcsIGVsLmF0dHJzTGlzdC5zbGljZSgpLCBlbC5wYXJlbnQpCiAgfQoKICB2YXIgbW9kZWwkMSA9IHsKICAgIHByZVRyYW5zZm9ybU5vZGU6IHByZVRyYW5zZm9ybU5vZGUKICB9OwoKICB2YXIgbW9kdWxlcyQxID0gWwogICAga2xhc3MkMSwKICAgIHN0eWxlJDEsCiAgICBtb2RlbCQxCiAgXTsKCiAgLyogICovCgogIGZ1bmN0aW9uIHRleHQgKGVsLCBkaXIpIHsKICAgIGlmIChkaXIudmFsdWUpIHsKICAgICAgYWRkUHJvcChlbCwgJ3RleHRDb250ZW50JywgKCJfcygiICsgKGRpci52YWx1ZSkgKyAiKSIpLCBkaXIpOwogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGh0bWwgKGVsLCBkaXIpIHsKICAgIGlmIChkaXIudmFsdWUpIHsKICAgICAgYWRkUHJvcChlbCwgJ2lubmVySFRNTCcsICgiX3MoIiArIChkaXIudmFsdWUpICsgIikiKSwgZGlyKTsKICAgIH0KICB9CgogIHZhciBkaXJlY3RpdmVzJDEgPSB7CiAgICBtb2RlbDogbW9kZWwsCiAgICB0ZXh0OiB0ZXh0LAogICAgaHRtbDogaHRtbAogIH07CgogIC8qICAqLwoKICB2YXIgYmFzZU9wdGlvbnMgPSB7CiAgICBleHBlY3RIVE1MOiB0cnVlLAogICAgbW9kdWxlczogbW9kdWxlcyQxLAogICAgZGlyZWN0aXZlczogZGlyZWN0aXZlcyQxLAogICAgaXNQcmVUYWc6IGlzUHJlVGFnLAogICAgaXNVbmFyeVRhZzogaXNVbmFyeVRhZywKICAgIG11c3RVc2VQcm9wOiBtdXN0VXNlUHJvcCwKICAgIGNhbkJlTGVmdE9wZW5UYWc6IGNhbkJlTGVmdE9wZW5UYWcsCiAgICBpc1Jlc2VydmVkVGFnOiBpc1Jlc2VydmVkVGFnLAogICAgZ2V0VGFnTmFtZXNwYWNlOiBnZXRUYWdOYW1lc3BhY2UsCiAgICBzdGF0aWNLZXlzOiBnZW5TdGF0aWNLZXlzKG1vZHVsZXMkMSkKICB9OwoKICAvKiAgKi8KCiAgdmFyIGlzU3RhdGljS2V5OwogIHZhciBpc1BsYXRmb3JtUmVzZXJ2ZWRUYWc7CgogIHZhciBnZW5TdGF0aWNLZXlzQ2FjaGVkID0gY2FjaGVkKGdlblN0YXRpY0tleXMkMSk7CgogIC8qKgogICAqIEdvYWwgb2YgdGhlIG9wdGltaXplcjogd2FsayB0aGUgZ2VuZXJhdGVkIHRlbXBsYXRlIEFTVCB0cmVlCiAgICogYW5kIGRldGVjdCBzdWItdHJlZXMgdGhhdCBhcmUgcHVyZWx5IHN0YXRpYywgaS5lLiBwYXJ0cyBvZgogICAqIHRoZSBET00gdGhhdCBuZXZlciBuZWVkcyB0byBjaGFuZ2UuCiAgICoKICAgKiBPbmNlIHdlIGRldGVjdCB0aGVzZSBzdWItdHJlZXMsIHdlIGNhbjoKICAgKgogICAqIDEuIEhvaXN0IHRoZW0gaW50byBjb25zdGFudHMsIHNvIHRoYXQgd2Ugbm8gbG9uZ2VyIG5lZWQgdG8KICAgKiAgICBjcmVhdGUgZnJlc2ggbm9kZXMgZm9yIHRoZW0gb24gZWFjaCByZS1yZW5kZXI7CiAgICogMi4gQ29tcGxldGVseSBza2lwIHRoZW0gaW4gdGhlIHBhdGNoaW5nIHByb2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gb3B0aW1pemUgKHJvb3QsIG9wdGlvbnMpIHsKICAgIGlmICghcm9vdCkgeyByZXR1cm4gfQogICAgaXNTdGF0aWNLZXkgPSBnZW5TdGF0aWNLZXlzQ2FjaGVkKG9wdGlvbnMuc3RhdGljS2V5cyB8fCAnJyk7CiAgICBpc1BsYXRmb3JtUmVzZXJ2ZWRUYWcgPSBvcHRpb25zLmlzUmVzZXJ2ZWRUYWcgfHwgbm87CiAgICAvLyBmaXJzdCBwYXNzOiBtYXJrIGFsbCBub24tc3RhdGljIG5vZGVzLgogICAgbWFya1N0YXRpYyQxKHJvb3QpOwogICAgLy8gc2Vjb25kIHBhc3M6IG1hcmsgc3RhdGljIHJvb3RzLgogICAgbWFya1N0YXRpY1Jvb3RzKHJvb3QsIGZhbHNlKTsKICB9CgogIGZ1bmN0aW9uIGdlblN0YXRpY0tleXMkMSAoa2V5cykgewogICAgcmV0dXJuIG1ha2VNYXAoCiAgICAgICd0eXBlLHRhZyxhdHRyc0xpc3QsYXR0cnNNYXAscGxhaW4scGFyZW50LGNoaWxkcmVuLGF0dHJzLHN0YXJ0LGVuZCxyYXdBdHRyc01hcCcgKwogICAgICAoa2V5cyA/ICcsJyArIGtleXMgOiAnJykKICAgICkKICB9CgogIGZ1bmN0aW9uIG1hcmtTdGF0aWMkMSAobm9kZSkgewogICAgbm9kZS5zdGF0aWMgPSBpc1N0YXRpYyhub2RlKTsKICAgIGlmIChub2RlLnR5cGUgPT09IDEpIHsKICAgICAgLy8gZG8gbm90IG1ha2UgY29tcG9uZW50IHNsb3QgY29udGVudCBzdGF0aWMuIHRoaXMgYXZvaWRzCiAgICAgIC8vIDEuIGNvbXBvbmVudHMgbm90IGFibGUgdG8gbXV0YXRlIHNsb3Qgbm9kZXMKICAgICAgLy8gMi4gc3RhdGljIHNsb3QgY29udGVudCBmYWlscyBmb3IgaG90LXJlbG9hZGluZwogICAgICBpZiAoCiAgICAgICAgIWlzUGxhdGZvcm1SZXNlcnZlZFRhZyhub2RlLnRhZykgJiYKICAgICAgICBub2RlLnRhZyAhPT0gJ3Nsb3QnICYmCiAgICAgICAgbm9kZS5hdHRyc01hcFsnaW5saW5lLXRlbXBsYXRlJ10gPT0gbnVsbAogICAgICApIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdmFyIGNoaWxkID0gbm9kZS5jaGlsZHJlbltpXTsKICAgICAgICBtYXJrU3RhdGljJDEoY2hpbGQpOwogICAgICAgIGlmICghY2hpbGQuc3RhdGljKSB7CiAgICAgICAgICBub2RlLnN0YXRpYyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobm9kZS5pZkNvbmRpdGlvbnMpIHsKICAgICAgICBmb3IgKHZhciBpJDEgPSAxLCBsJDEgPSBub2RlLmlmQ29uZGl0aW9ucy5sZW5ndGg7IGkkMSA8IGwkMTsgaSQxKyspIHsKICAgICAgICAgIHZhciBibG9jayA9IG5vZGUuaWZDb25kaXRpb25zW2kkMV0uYmxvY2s7CiAgICAgICAgICBtYXJrU3RhdGljJDEoYmxvY2spOwogICAgICAgICAgaWYgKCFibG9jay5zdGF0aWMpIHsKICAgICAgICAgICAgbm9kZS5zdGF0aWMgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIG1hcmtTdGF0aWNSb290cyAobm9kZSwgaXNJbkZvcikgewogICAgaWYgKG5vZGUudHlwZSA9PT0gMSkgewogICAgICBpZiAobm9kZS5zdGF0aWMgfHwgbm9kZS5vbmNlKSB7CiAgICAgICAgbm9kZS5zdGF0aWNJbkZvciA9IGlzSW5Gb3I7CiAgICAgIH0KICAgICAgLy8gRm9yIGEgbm9kZSB0byBxdWFsaWZ5IGFzIGEgc3RhdGljIHJvb3QsIGl0IHNob3VsZCBoYXZlIGNoaWxkcmVuIHRoYXQKICAgICAgLy8gYXJlIG5vdCBqdXN0IHN0YXRpYyB0ZXh0LiBPdGhlcndpc2UgdGhlIGNvc3Qgb2YgaG9pc3Rpbmcgb3V0IHdpbGwKICAgICAgLy8gb3V0d2VpZ2ggdGhlIGJlbmVmaXRzIGFuZCBpdCdzIGJldHRlciBvZmYgdG8ganVzdCBhbHdheXMgcmVuZGVyIGl0IGZyZXNoLgogICAgICBpZiAobm9kZS5zdGF0aWMgJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGggJiYgISgKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJgogICAgICAgIG5vZGUuY2hpbGRyZW5bMF0udHlwZSA9PT0gMwogICAgICApKSB7CiAgICAgICAgbm9kZS5zdGF0aWNSb290ID0gdHJ1ZTsKICAgICAgICByZXR1cm4KICAgICAgfSBlbHNlIHsKICAgICAgICBub2RlLnN0YXRpY1Jvb3QgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAobm9kZS5jaGlsZHJlbikgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIG1hcmtTdGF0aWNSb290cyhub2RlLmNoaWxkcmVuW2ldLCBpc0luRm9yIHx8ICEhbm9kZS5mb3IpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobm9kZS5pZkNvbmRpdGlvbnMpIHsKICAgICAgICBmb3IgKHZhciBpJDEgPSAxLCBsJDEgPSBub2RlLmlmQ29uZGl0aW9ucy5sZW5ndGg7IGkkMSA8IGwkMTsgaSQxKyspIHsKICAgICAgICAgIG1hcmtTdGF0aWNSb290cyhub2RlLmlmQ29uZGl0aW9uc1tpJDFdLmJsb2NrLCBpc0luRm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzU3RhdGljIChub2RlKSB7CiAgICBpZiAobm9kZS50eXBlID09PSAyKSB7IC8vIGV4cHJlc3Npb24KICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgICBpZiAobm9kZS50eXBlID09PSAzKSB7IC8vIHRleHQKICAgICAgcmV0dXJuIHRydWUKICAgIH0KICAgIHJldHVybiAhIShub2RlLnByZSB8fCAoCiAgICAgICFub2RlLmhhc0JpbmRpbmdzICYmIC8vIG5vIGR5bmFtaWMgYmluZGluZ3MKICAgICAgIW5vZGUuaWYgJiYgIW5vZGUuZm9yICYmIC8vIG5vdCB2LWlmIG9yIHYtZm9yIG9yIHYtZWxzZQogICAgICAhaXNCdWlsdEluVGFnKG5vZGUudGFnKSAmJiAvLyBub3QgYSBidWlsdC1pbgogICAgICBpc1BsYXRmb3JtUmVzZXJ2ZWRUYWcobm9kZS50YWcpICYmIC8vIG5vdCBhIGNvbXBvbmVudAogICAgICAhaXNEaXJlY3RDaGlsZE9mVGVtcGxhdGVGb3Iobm9kZSkgJiYKICAgICAgT2JqZWN0LmtleXMobm9kZSkuZXZlcnkoaXNTdGF0aWNLZXkpCiAgICApKQogIH0KCiAgZnVuY3Rpb24gaXNEaXJlY3RDaGlsZE9mVGVtcGxhdGVGb3IgKG5vZGUpIHsKICAgIHdoaWxlIChub2RlLnBhcmVudCkgewogICAgICBub2RlID0gbm9kZS5wYXJlbnQ7CiAgICAgIGlmIChub2RlLnRhZyAhPT0gJ3RlbXBsYXRlJykgewogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICAgIGlmIChub2RlLmZvcikgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZQogIH0KCiAgLyogICovCgogIHZhciBmbkV4cFJFID0gL14oW1x3JF9dK3xcKFteKV0qP1wpKVxzKj0+fF5mdW5jdGlvbig/OlxzK1tcdyRdKyk/XHMqXCgvOwogIHZhciBmbkludm9rZVJFID0gL1woW14pXSo/XCk7KiQvOwogIHZhciBzaW1wbGVQYXRoUkUgPSAvXltBLVphLXpfJF1bXHckXSooPzpcLltBLVphLXpfJF1bXHckXSp8XFsnW14nXSo/J118XFsiW14iXSo/Il18XFtcZCtdfFxbW0EtWmEtel8kXVtcdyRdKl0pKiQvOwoKICAvLyBLZXlib2FyZEV2ZW50LmtleUNvZGUgYWxpYXNlcwogIHZhciBrZXlDb2RlcyA9IHsKICAgIGVzYzogMjcsCiAgICB0YWI6IDksCiAgICBlbnRlcjogMTMsCiAgICBzcGFjZTogMzIsCiAgICB1cDogMzgsCiAgICBsZWZ0OiAzNywKICAgIHJpZ2h0OiAzOSwKICAgIGRvd246IDQwLAogICAgJ2RlbGV0ZSc6IFs4LCA0Nl0KICB9OwoKICAvLyBLZXlib2FyZEV2ZW50LmtleSBhbGlhc2VzCiAgdmFyIGtleU5hbWVzID0gewogICAgLy8gIzc4ODA6IElFMTEgYW5kIEVkZ2UgdXNlIGBFc2NgIGZvciBFc2NhcGUga2V5IG5hbWUuCiAgICBlc2M6IFsnRXNjJywgJ0VzY2FwZSddLAogICAgdGFiOiAnVGFiJywKICAgIGVudGVyOiAnRW50ZXInLAogICAgLy8gIzkxMTI6IElFMTEgdXNlcyBgU3BhY2ViYXJgIGZvciBTcGFjZSBrZXkgbmFtZS4KICAgIHNwYWNlOiBbJyAnLCAnU3BhY2ViYXInXSwKICAgIC8vICM3ODA2OiBJRTExIHVzZXMga2V5IG5hbWVzIHdpdGhvdXQgYEFycm93YCBwcmVmaXggZm9yIGFycm93IGtleXMuCiAgICB1cDogWydVcCcsICdBcnJvd1VwJ10sCiAgICBsZWZ0OiBbJ0xlZnQnLCAnQXJyb3dMZWZ0J10sCiAgICByaWdodDogWydSaWdodCcsICdBcnJvd1JpZ2h0J10sCiAgICBkb3duOiBbJ0Rvd24nLCAnQXJyb3dEb3duJ10sCiAgICAvLyAjOTExMjogSUUxMSB1c2VzIGBEZWxgIGZvciBEZWxldGUga2V5IG5hbWUuCiAgICAnZGVsZXRlJzogWydCYWNrc3BhY2UnLCAnRGVsZXRlJywgJ0RlbCddCiAgfTsKCiAgLy8gIzQ4Njg6IG1vZGlmaWVycyB0aGF0IHByZXZlbnQgdGhlIGV4ZWN1dGlvbiBvZiB0aGUgbGlzdGVuZXIKICAvLyBuZWVkIHRvIGV4cGxpY2l0bHkgcmV0dXJuIG51bGwgc28gdGhhdCB3ZSBjYW4gZGV0ZXJtaW5lIHdoZXRoZXIgdG8gcmVtb3ZlCiAgLy8gdGhlIGxpc3RlbmVyIGZvciAub25jZQogIHZhciBnZW5HdWFyZCA9IGZ1bmN0aW9uIChjb25kaXRpb24pIHsgcmV0dXJuICgiaWYoIiArIGNvbmRpdGlvbiArICIpcmV0dXJuIG51bGw7Iik7IH07CgogIHZhciBtb2RpZmllckNvZGUgPSB7CiAgICBzdG9wOiAnJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOycsCiAgICBwcmV2ZW50OiAnJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7JywKICAgIHNlbGY6IGdlbkd1YXJkKCIkZXZlbnQudGFyZ2V0ICE9PSAkZXZlbnQuY3VycmVudFRhcmdldCIpLAogICAgY3RybDogZ2VuR3VhcmQoIiEkZXZlbnQuY3RybEtleSIpLAogICAgc2hpZnQ6IGdlbkd1YXJkKCIhJGV2ZW50LnNoaWZ0S2V5IiksCiAgICBhbHQ6IGdlbkd1YXJkKCIhJGV2ZW50LmFsdEtleSIpLAogICAgbWV0YTogZ2VuR3VhcmQoIiEkZXZlbnQubWV0YUtleSIpLAogICAgbGVmdDogZ2VuR3VhcmQoIididXR0b24nIGluICRldmVudCAmJiAkZXZlbnQuYnV0dG9uICE9PSAwIiksCiAgICBtaWRkbGU6IGdlbkd1YXJkKCInYnV0dG9uJyBpbiAkZXZlbnQgJiYgJGV2ZW50LmJ1dHRvbiAhPT0gMSIpLAogICAgcmlnaHQ6IGdlbkd1YXJkKCInYnV0dG9uJyBpbiAkZXZlbnQgJiYgJGV2ZW50LmJ1dHRvbiAhPT0gMiIpCiAgfTsKCiAgZnVuY3Rpb24gZ2VuSGFuZGxlcnMgKAogICAgZXZlbnRzLAogICAgaXNOYXRpdmUKICApIHsKICAgIHZhciBwcmVmaXggPSBpc05hdGl2ZSA/ICduYXRpdmVPbjonIDogJ29uOic7CiAgICB2YXIgc3RhdGljSGFuZGxlcnMgPSAiIjsKICAgIHZhciBkeW5hbWljSGFuZGxlcnMgPSAiIjsKICAgIGZvciAodmFyIG5hbWUgaW4gZXZlbnRzKSB7CiAgICAgIHZhciBoYW5kbGVyQ29kZSA9IGdlbkhhbmRsZXIoZXZlbnRzW25hbWVdKTsKICAgICAgaWYgKGV2ZW50c1tuYW1lXSAmJiBldmVudHNbbmFtZV0uZHluYW1pYykgewogICAgICAgIGR5bmFtaWNIYW5kbGVycyArPSBuYW1lICsgIiwiICsgaGFuZGxlckNvZGUgKyAiLCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RhdGljSGFuZGxlcnMgKz0gIlwiIiArIG5hbWUgKyAiXCI6IiArIGhhbmRsZXJDb2RlICsgIiwiOwogICAgICB9CiAgICB9CiAgICBzdGF0aWNIYW5kbGVycyA9ICJ7IiArIChzdGF0aWNIYW5kbGVycy5zbGljZSgwLCAtMSkpICsgIn0iOwogICAgaWYgKGR5bmFtaWNIYW5kbGVycykgewogICAgICByZXR1cm4gcHJlZml4ICsgIl9kKCIgKyBzdGF0aWNIYW5kbGVycyArICIsWyIgKyAoZHluYW1pY0hhbmRsZXJzLnNsaWNlKDAsIC0xKSkgKyAiXSkiCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gcHJlZml4ICsgc3RhdGljSGFuZGxlcnMKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlbkhhbmRsZXIgKGhhbmRsZXIpIHsKICAgIGlmICghaGFuZGxlcikgewogICAgICByZXR1cm4gJ2Z1bmN0aW9uKCl7fScKICAgIH0KCiAgICBpZiAoQXJyYXkuaXNBcnJheShoYW5kbGVyKSkgewogICAgICByZXR1cm4gKCJbIiArIChoYW5kbGVyLm1hcChmdW5jdGlvbiAoaGFuZGxlcikgeyByZXR1cm4gZ2VuSGFuZGxlcihoYW5kbGVyKTsgfSkuam9pbignLCcpKSArICJdIikKICAgIH0KCiAgICB2YXIgaXNNZXRob2RQYXRoID0gc2ltcGxlUGF0aFJFLnRlc3QoaGFuZGxlci52YWx1ZSk7CiAgICB2YXIgaXNGdW5jdGlvbkV4cHJlc3Npb24gPSBmbkV4cFJFLnRlc3QoaGFuZGxlci52YWx1ZSk7CiAgICB2YXIgaXNGdW5jdGlvbkludm9jYXRpb24gPSBzaW1wbGVQYXRoUkUudGVzdChoYW5kbGVyLnZhbHVlLnJlcGxhY2UoZm5JbnZva2VSRSwgJycpKTsKCiAgICBpZiAoIWhhbmRsZXIubW9kaWZpZXJzKSB7CiAgICAgIGlmIChpc01ldGhvZFBhdGggfHwgaXNGdW5jdGlvbkV4cHJlc3Npb24pIHsKICAgICAgICByZXR1cm4gaGFuZGxlci52YWx1ZQogICAgICB9CiAgICAgIHJldHVybiAoImZ1bmN0aW9uKCRldmVudCl7IiArIChpc0Z1bmN0aW9uSW52b2NhdGlvbiA/ICgicmV0dXJuICIgKyAoaGFuZGxlci52YWx1ZSkpIDogaGFuZGxlci52YWx1ZSkgKyAifSIpIC8vIGlubGluZSBzdGF0ZW1lbnQKICAgIH0gZWxzZSB7CiAgICAgIHZhciBjb2RlID0gJyc7CiAgICAgIHZhciBnZW5Nb2RpZmllckNvZGUgPSAnJzsKICAgICAgdmFyIGtleXMgPSBbXTsKICAgICAgZm9yICh2YXIga2V5IGluIGhhbmRsZXIubW9kaWZpZXJzKSB7CiAgICAgICAgaWYgKG1vZGlmaWVyQ29kZVtrZXldKSB7CiAgICAgICAgICBnZW5Nb2RpZmllckNvZGUgKz0gbW9kaWZpZXJDb2RlW2tleV07CiAgICAgICAgICAvLyBsZWZ0L3JpZ2h0CiAgICAgICAgICBpZiAoa2V5Q29kZXNba2V5XSkgewogICAgICAgICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2V4YWN0JykgewogICAgICAgICAgdmFyIG1vZGlmaWVycyA9IChoYW5kbGVyLm1vZGlmaWVycyk7CiAgICAgICAgICBnZW5Nb2RpZmllckNvZGUgKz0gZ2VuR3VhcmQoCiAgICAgICAgICAgIFsnY3RybCcsICdzaGlmdCcsICdhbHQnLCAnbWV0YSddCiAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoa2V5TW9kaWZpZXIpIHsgcmV0dXJuICFtb2RpZmllcnNba2V5TW9kaWZpZXJdOyB9KQogICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGtleU1vZGlmaWVyKSB7IHJldHVybiAoIiRldmVudC4iICsga2V5TW9kaWZpZXIgKyAiS2V5Iik7IH0pCiAgICAgICAgICAgICAgLmpvaW4oJ3x8JykKICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoa2V5cy5sZW5ndGgpIHsKICAgICAgICBjb2RlICs9IGdlbktleUZpbHRlcihrZXlzKTsKICAgICAgfQogICAgICAvLyBNYWtlIHN1cmUgbW9kaWZpZXJzIGxpa2UgcHJldmVudCBhbmQgc3RvcCBnZXQgZXhlY3V0ZWQgYWZ0ZXIga2V5IGZpbHRlcmluZwogICAgICBpZiAoZ2VuTW9kaWZpZXJDb2RlKSB7CiAgICAgICAgY29kZSArPSBnZW5Nb2RpZmllckNvZGU7CiAgICAgIH0KICAgICAgdmFyIGhhbmRsZXJDb2RlID0gaXNNZXRob2RQYXRoCiAgICAgICAgPyAoInJldHVybiAiICsgKGhhbmRsZXIudmFsdWUpICsgIigkZXZlbnQpIikKICAgICAgICA6IGlzRnVuY3Rpb25FeHByZXNzaW9uCiAgICAgICAgICA/ICgicmV0dXJuICgiICsgKGhhbmRsZXIudmFsdWUpICsgIikoJGV2ZW50KSIpCiAgICAgICAgICA6IGlzRnVuY3Rpb25JbnZvY2F0aW9uCiAgICAgICAgICAgID8gKCJyZXR1cm4gIiArIChoYW5kbGVyLnZhbHVlKSkKICAgICAgICAgICAgOiBoYW5kbGVyLnZhbHVlOwogICAgICByZXR1cm4gKCJmdW5jdGlvbigkZXZlbnQpeyIgKyBjb2RlICsgaGFuZGxlckNvZGUgKyAifSIpCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5LZXlGaWx0ZXIgKGtleXMpIHsKICAgIHJldHVybiAoCiAgICAgIC8vIG1ha2Ugc3VyZSB0aGUga2V5IGZpbHRlcnMgb25seSBhcHBseSB0byBLZXlib2FyZEV2ZW50cwogICAgICAvLyAjOTQ0MTogY2FuJ3QgdXNlICdrZXlDb2RlJyBpbiAkZXZlbnQgYmVjYXVzZSBDaHJvbWUgYXV0b2ZpbGwgZmlyZXMgZmFrZQogICAgICAvLyBrZXkgZXZlbnRzIHRoYXQgZG8gbm90IGhhdmUga2V5Q29kZSBwcm9wZXJ0eS4uLgogICAgICAiaWYoISRldmVudC50eXBlLmluZGV4T2YoJ2tleScpJiYiICsKICAgICAgKGtleXMubWFwKGdlbkZpbHRlckNvZGUpLmpvaW4oJyYmJykpICsgIilyZXR1cm4gbnVsbDsiCiAgICApCiAgfQoKICBmdW5jdGlvbiBnZW5GaWx0ZXJDb2RlIChrZXkpIHsKICAgIHZhciBrZXlWYWwgPSBwYXJzZUludChrZXksIDEwKTsKICAgIGlmIChrZXlWYWwpIHsKICAgICAgcmV0dXJuICgiJGV2ZW50LmtleUNvZGUhPT0iICsga2V5VmFsKQogICAgfQogICAgdmFyIGtleUNvZGUgPSBrZXlDb2Rlc1trZXldOwogICAgdmFyIGtleU5hbWUgPSBrZXlOYW1lc1trZXldOwogICAgcmV0dXJuICgKICAgICAgIl9rKCRldmVudC5rZXlDb2RlLCIgKwogICAgICAoSlNPTi5zdHJpbmdpZnkoa2V5KSkgKyAiLCIgKwogICAgICAoSlNPTi5zdHJpbmdpZnkoa2V5Q29kZSkpICsgIiwiICsKICAgICAgIiRldmVudC5rZXksIiArCiAgICAgICIiICsgKEpTT04uc3RyaW5naWZ5KGtleU5hbWUpKSArCiAgICAgICIpIgogICAgKQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIG9uIChlbCwgZGlyKSB7CiAgICBpZiAoZGlyLm1vZGlmaWVycykgewogICAgICB3YXJuKCJ2LW9uIHdpdGhvdXQgYXJndW1lbnQgZG9lcyBub3Qgc3VwcG9ydCBtb2RpZmllcnMuIik7CiAgICB9CiAgICBlbC53cmFwTGlzdGVuZXJzID0gZnVuY3Rpb24gKGNvZGUpIHsgcmV0dXJuICgiX2coIiArIGNvZGUgKyAiLCIgKyAoZGlyLnZhbHVlKSArICIpIik7IH07CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gYmluZCQxIChlbCwgZGlyKSB7CiAgICBlbC53cmFwRGF0YSA9IGZ1bmN0aW9uIChjb2RlKSB7CiAgICAgIHJldHVybiAoIl9iKCIgKyBjb2RlICsgIiwnIiArIChlbC50YWcpICsgIicsIiArIChkaXIudmFsdWUpICsgIiwiICsgKGRpci5tb2RpZmllcnMgJiYgZGlyLm1vZGlmaWVycy5wcm9wID8gJ3RydWUnIDogJ2ZhbHNlJykgKyAoZGlyLm1vZGlmaWVycyAmJiBkaXIubW9kaWZpZXJzLnN5bmMgPyAnLHRydWUnIDogJycpICsgIikiKQogICAgfTsKICB9CgogIC8qICAqLwoKICB2YXIgYmFzZURpcmVjdGl2ZXMgPSB7CiAgICBvbjogb24sCiAgICBiaW5kOiBiaW5kJDEsCiAgICBjbG9hazogbm9vcAogIH07CgogIC8qICAqLwoKCgoKCiAgdmFyIENvZGVnZW5TdGF0ZSA9IGZ1bmN0aW9uIENvZGVnZW5TdGF0ZSAob3B0aW9ucykgewogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIHRoaXMud2FybiA9IG9wdGlvbnMud2FybiB8fCBiYXNlV2FybjsKICAgIHRoaXMudHJhbnNmb3JtcyA9IHBsdWNrTW9kdWxlRnVuY3Rpb24ob3B0aW9ucy5tb2R1bGVzLCAndHJhbnNmb3JtQ29kZScpOwogICAgdGhpcy5kYXRhR2VuRm5zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICdnZW5EYXRhJyk7CiAgICB0aGlzLmRpcmVjdGl2ZXMgPSBleHRlbmQoZXh0ZW5kKHt9LCBiYXNlRGlyZWN0aXZlcyksIG9wdGlvbnMuZGlyZWN0aXZlcyk7CiAgICB2YXIgaXNSZXNlcnZlZFRhZyA9IG9wdGlvbnMuaXNSZXNlcnZlZFRhZyB8fCBubzsKICAgIHRoaXMubWF5YmVDb21wb25lbnQgPSBmdW5jdGlvbiAoZWwpIHsgcmV0dXJuICEhZWwuY29tcG9uZW50IHx8ICFpc1Jlc2VydmVkVGFnKGVsLnRhZyk7IH07CiAgICB0aGlzLm9uY2VJZCA9IDA7CiAgICB0aGlzLnN0YXRpY1JlbmRlckZucyA9IFtdOwogICAgdGhpcy5wcmUgPSBmYWxzZTsKICB9OwoKCgogIGZ1bmN0aW9uIGdlbmVyYXRlICgKICAgIGFzdCwKICAgIG9wdGlvbnMKICApIHsKICAgIHZhciBzdGF0ZSA9IG5ldyBDb2RlZ2VuU3RhdGUob3B0aW9ucyk7CiAgICB2YXIgY29kZSA9IGFzdCA/IGdlbkVsZW1lbnQoYXN0LCBzdGF0ZSkgOiAnX2MoImRpdiIpJzsKICAgIHJldHVybiB7CiAgICAgIHJlbmRlcjogKCJ3aXRoKHRoaXMpe3JldHVybiAiICsgY29kZSArICJ9IiksCiAgICAgIHN0YXRpY1JlbmRlckZuczogc3RhdGUuc3RhdGljUmVuZGVyRm5zCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5FbGVtZW50IChlbCwgc3RhdGUpIHsKICAgIGlmIChlbC5wYXJlbnQpIHsKICAgICAgZWwucHJlID0gZWwucHJlIHx8IGVsLnBhcmVudC5wcmU7CiAgICB9CgogICAgaWYgKGVsLnN0YXRpY1Jvb3QgJiYgIWVsLnN0YXRpY1Byb2Nlc3NlZCkgewogICAgICByZXR1cm4gZ2VuU3RhdGljKGVsLCBzdGF0ZSkKICAgIH0gZWxzZSBpZiAoZWwub25jZSAmJiAhZWwub25jZVByb2Nlc3NlZCkgewogICAgICByZXR1cm4gZ2VuT25jZShlbCwgc3RhdGUpCiAgICB9IGVsc2UgaWYgKGVsLmZvciAmJiAhZWwuZm9yUHJvY2Vzc2VkKSB7CiAgICAgIHJldHVybiBnZW5Gb3IoZWwsIHN0YXRlKQogICAgfSBlbHNlIGlmIChlbC5pZiAmJiAhZWwuaWZQcm9jZXNzZWQpIHsKICAgICAgcmV0dXJuIGdlbklmKGVsLCBzdGF0ZSkKICAgIH0gZWxzZSBpZiAoZWwudGFnID09PSAndGVtcGxhdGUnICYmICFlbC5zbG90VGFyZ2V0ICYmICFzdGF0ZS5wcmUpIHsKICAgICAgcmV0dXJuIGdlbkNoaWxkcmVuKGVsLCBzdGF0ZSkgfHwgJ3ZvaWQgMCcKICAgIH0gZWxzZSBpZiAoZWwudGFnID09PSAnc2xvdCcpIHsKICAgICAgcmV0dXJuIGdlblNsb3QoZWwsIHN0YXRlKQogICAgfSBlbHNlIHsKICAgICAgLy8gY29tcG9uZW50IG9yIGVsZW1lbnQKICAgICAgdmFyIGNvZGU7CiAgICAgIGlmIChlbC5jb21wb25lbnQpIHsKICAgICAgICBjb2RlID0gZ2VuQ29tcG9uZW50KGVsLmNvbXBvbmVudCwgZWwsIHN0YXRlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZGF0YTsKICAgICAgICBpZiAoIWVsLnBsYWluIHx8IChlbC5wcmUgJiYgc3RhdGUubWF5YmVDb21wb25lbnQoZWwpKSkgewogICAgICAgICAgZGF0YSA9IGdlbkRhdGEkMihlbCwgc3RhdGUpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNoaWxkcmVuID0gZWwuaW5saW5lVGVtcGxhdGUgPyBudWxsIDogZ2VuQ2hpbGRyZW4oZWwsIHN0YXRlLCB0cnVlKTsKICAgICAgICBjb2RlID0gIl9jKCciICsgKGVsLnRhZykgKyAiJyIgKyAoZGF0YSA/ICgiLCIgKyBkYXRhKSA6ICcnKSArIChjaGlsZHJlbiA/ICgiLCIgKyBjaGlsZHJlbikgOiAnJykgKyAiKSI7CiAgICAgIH0KICAgICAgLy8gbW9kdWxlIHRyYW5zZm9ybXMKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGF0ZS50cmFuc2Zvcm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29kZSA9IHN0YXRlLnRyYW5zZm9ybXNbaV0oZWwsIGNvZGUpOwogICAgICB9CiAgICAgIHJldHVybiBjb2RlCiAgICB9CiAgfQoKICAvLyBob2lzdCBzdGF0aWMgc3ViLXRyZWVzIG91dAogIGZ1bmN0aW9uIGdlblN0YXRpYyAoZWwsIHN0YXRlKSB7CiAgICBlbC5zdGF0aWNQcm9jZXNzZWQgPSB0cnVlOwogICAgLy8gU29tZSBlbGVtZW50cyAodGVtcGxhdGVzKSBuZWVkIHRvIGJlaGF2ZSBkaWZmZXJlbnRseSBpbnNpZGUgb2YgYSB2LXByZQogICAgLy8gbm9kZS4gIEFsbCBwcmUgbm9kZXMgYXJlIHN0YXRpYyByb290cywgc28gd2UgY2FuIHVzZSB0aGlzIGFzIGEgbG9jYXRpb24gdG8KICAgIC8vIHdyYXAgYSBzdGF0ZSBjaGFuZ2UgYW5kIHJlc2V0IGl0IHVwb24gZXhpdGluZyB0aGUgcHJlIG5vZGUuCiAgICB2YXIgb3JpZ2luYWxQcmVTdGF0ZSA9IHN0YXRlLnByZTsKICAgIGlmIChlbC5wcmUpIHsKICAgICAgc3RhdGUucHJlID0gZWwucHJlOwogICAgfQogICAgc3RhdGUuc3RhdGljUmVuZGVyRm5zLnB1c2goKCJ3aXRoKHRoaXMpe3JldHVybiAiICsgKGdlbkVsZW1lbnQoZWwsIHN0YXRlKSkgKyAifSIpKTsKICAgIHN0YXRlLnByZSA9IG9yaWdpbmFsUHJlU3RhdGU7CiAgICByZXR1cm4gKCJfbSgiICsgKHN0YXRlLnN0YXRpY1JlbmRlckZucy5sZW5ndGggLSAxKSArIChlbC5zdGF0aWNJbkZvciA/ICcsdHJ1ZScgOiAnJykgKyAiKSIpCiAgfQoKICAvLyB2LW9uY2UKICBmdW5jdGlvbiBnZW5PbmNlIChlbCwgc3RhdGUpIHsKICAgIGVsLm9uY2VQcm9jZXNzZWQgPSB0cnVlOwogICAgaWYgKGVsLmlmICYmICFlbC5pZlByb2Nlc3NlZCkgewogICAgICByZXR1cm4gZ2VuSWYoZWwsIHN0YXRlKQogICAgfSBlbHNlIGlmIChlbC5zdGF0aWNJbkZvcikgewogICAgICB2YXIga2V5ID0gJyc7CiAgICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQ7CiAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICBpZiAocGFyZW50LmZvcikgewogICAgICAgICAga2V5ID0gcGFyZW50LmtleTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7CiAgICAgIH0KICAgICAgaWYgKCFrZXkpIHsKICAgICAgICBzdGF0ZS53YXJuKAogICAgICAgICAgInYtb25jZSBjYW4gb25seSBiZSB1c2VkIGluc2lkZSB2LWZvciB0aGF0IGlzIGtleWVkLiAiLAogICAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3Ytb25jZSddCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gZ2VuRWxlbWVudChlbCwgc3RhdGUpCiAgICAgIH0KICAgICAgcmV0dXJuICgiX28oIiArIChnZW5FbGVtZW50KGVsLCBzdGF0ZSkpICsgIiwiICsgKHN0YXRlLm9uY2VJZCsrKSArICIsIiArIGtleSArICIpIikKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBnZW5TdGF0aWMoZWwsIHN0YXRlKQogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2VuSWYgKAogICAgZWwsCiAgICBzdGF0ZSwKICAgIGFsdEdlbiwKICAgIGFsdEVtcHR5CiAgKSB7CiAgICBlbC5pZlByb2Nlc3NlZCA9IHRydWU7IC8vIGF2b2lkIHJlY3Vyc2lvbgogICAgcmV0dXJuIGdlbklmQ29uZGl0aW9ucyhlbC5pZkNvbmRpdGlvbnMuc2xpY2UoKSwgc3RhdGUsIGFsdEdlbiwgYWx0RW1wdHkpCiAgfQoKICBmdW5jdGlvbiBnZW5JZkNvbmRpdGlvbnMgKAogICAgY29uZGl0aW9ucywKICAgIHN0YXRlLAogICAgYWx0R2VuLAogICAgYWx0RW1wdHkKICApIHsKICAgIGlmICghY29uZGl0aW9ucy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIGFsdEVtcHR5IHx8ICdfZSgpJwogICAgfQoKICAgIHZhciBjb25kaXRpb24gPSBjb25kaXRpb25zLnNoaWZ0KCk7CiAgICBpZiAoY29uZGl0aW9uLmV4cCkgewogICAgICByZXR1cm4gKCIoIiArIChjb25kaXRpb24uZXhwKSArICIpPyIgKyAoZ2VuVGVybmFyeUV4cChjb25kaXRpb24uYmxvY2spKSArICI6IiArIChnZW5JZkNvbmRpdGlvbnMoY29uZGl0aW9ucywgc3RhdGUsIGFsdEdlbiwgYWx0RW1wdHkpKSkKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAoIiIgKyAoZ2VuVGVybmFyeUV4cChjb25kaXRpb24uYmxvY2spKSkKICAgIH0KCiAgICAvLyB2LWlmIHdpdGggdi1vbmNlIHNob3VsZCBnZW5lcmF0ZSBjb2RlIGxpa2UgKGEpP19tKDApOl9tKDEpCiAgICBmdW5jdGlvbiBnZW5UZXJuYXJ5RXhwIChlbCkgewogICAgICByZXR1cm4gYWx0R2VuCiAgICAgICAgPyBhbHRHZW4oZWwsIHN0YXRlKQogICAgICAgIDogZWwub25jZQogICAgICAgICAgPyBnZW5PbmNlKGVsLCBzdGF0ZSkKICAgICAgICAgIDogZ2VuRWxlbWVudChlbCwgc3RhdGUpCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5Gb3IgKAogICAgZWwsCiAgICBzdGF0ZSwKICAgIGFsdEdlbiwKICAgIGFsdEhlbHBlcgogICkgewogICAgdmFyIGV4cCA9IGVsLmZvcjsKICAgIHZhciBhbGlhcyA9IGVsLmFsaWFzOwogICAgdmFyIGl0ZXJhdG9yMSA9IGVsLml0ZXJhdG9yMSA/ICgiLCIgKyAoZWwuaXRlcmF0b3IxKSkgOiAnJzsKICAgIHZhciBpdGVyYXRvcjIgPSBlbC5pdGVyYXRvcjIgPyAoIiwiICsgKGVsLml0ZXJhdG9yMikpIDogJyc7CgogICAgaWYgKHN0YXRlLm1heWJlQ29tcG9uZW50KGVsKSAmJgogICAgICBlbC50YWcgIT09ICdzbG90JyAmJgogICAgICBlbC50YWcgIT09ICd0ZW1wbGF0ZScgJiYKICAgICAgIWVsLmtleQogICAgKSB7CiAgICAgIHN0YXRlLndhcm4oCiAgICAgICAgIjwiICsgKGVsLnRhZykgKyAiIHYtZm9yPVwiIiArIGFsaWFzICsgIiBpbiAiICsgZXhwICsgIlwiPjogY29tcG9uZW50IGxpc3RzIHJlbmRlcmVkIHdpdGggIiArCiAgICAgICAgInYtZm9yIHNob3VsZCBoYXZlIGV4cGxpY2l0IGtleXMuICIgKwogICAgICAgICJTZWUgaHR0cHM6Ly92dWVqcy5vcmcvZ3VpZGUvbGlzdC5odG1sI2tleSBmb3IgbW9yZSBpbmZvLiIsCiAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3YtZm9yJ10sCiAgICAgICAgdHJ1ZSAvKiB0aXAgKi8KICAgICAgKTsKICAgIH0KCiAgICBlbC5mb3JQcm9jZXNzZWQgPSB0cnVlOyAvLyBhdm9pZCByZWN1cnNpb24KICAgIHJldHVybiAoYWx0SGVscGVyIHx8ICdfbCcpICsgIigoIiArIGV4cCArICIpLCIgKwogICAgICAiZnVuY3Rpb24oIiArIGFsaWFzICsgaXRlcmF0b3IxICsgaXRlcmF0b3IyICsgIil7IiArCiAgICAgICAgInJldHVybiAiICsgKChhbHRHZW4gfHwgZ2VuRWxlbWVudCkoZWwsIHN0YXRlKSkgKwogICAgICAnfSknCiAgfQoKICBmdW5jdGlvbiBnZW5EYXRhJDIgKGVsLCBzdGF0ZSkgewogICAgdmFyIGRhdGEgPSAneyc7CgogICAgLy8gZGlyZWN0aXZlcyBmaXJzdC4KICAgIC8vIGRpcmVjdGl2ZXMgbWF5IG11dGF0ZSB0aGUgZWwncyBvdGhlciBwcm9wZXJ0aWVzIGJlZm9yZSB0aGV5IGFyZSBnZW5lcmF0ZWQuCiAgICB2YXIgZGlycyA9IGdlbkRpcmVjdGl2ZXMoZWwsIHN0YXRlKTsKICAgIGlmIChkaXJzKSB7IGRhdGEgKz0gZGlycyArICcsJzsgfQoKICAgIC8vIGtleQogICAgaWYgKGVsLmtleSkgewogICAgICBkYXRhICs9ICJrZXk6IiArIChlbC5rZXkpICsgIiwiOwogICAgfQogICAgLy8gcmVmCiAgICBpZiAoZWwucmVmKSB7CiAgICAgIGRhdGEgKz0gInJlZjoiICsgKGVsLnJlZikgKyAiLCI7CiAgICB9CiAgICBpZiAoZWwucmVmSW5Gb3IpIHsKICAgICAgZGF0YSArPSAicmVmSW5Gb3I6dHJ1ZSwiOwogICAgfQogICAgLy8gcHJlCiAgICBpZiAoZWwucHJlKSB7CiAgICAgIGRhdGEgKz0gInByZTp0cnVlLCI7CiAgICB9CiAgICAvLyByZWNvcmQgb3JpZ2luYWwgdGFnIG5hbWUgZm9yIGNvbXBvbmVudHMgdXNpbmcgImlzIiBhdHRyaWJ1dGUKICAgIGlmIChlbC5jb21wb25lbnQpIHsKICAgICAgZGF0YSArPSAidGFnOlwiIiArIChlbC50YWcpICsgIlwiLCI7CiAgICB9CiAgICAvLyBtb2R1bGUgZGF0YSBnZW5lcmF0aW9uIGZ1bmN0aW9ucwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGF0ZS5kYXRhR2VuRm5zLmxlbmd0aDsgaSsrKSB7CiAgICAgIGRhdGEgKz0gc3RhdGUuZGF0YUdlbkZuc1tpXShlbCk7CiAgICB9CiAgICAvLyBhdHRyaWJ1dGVzCiAgICBpZiAoZWwuYXR0cnMpIHsKICAgICAgZGF0YSArPSAiYXR0cnM6IiArIChnZW5Qcm9wcyhlbC5hdHRycykpICsgIiwiOwogICAgfQogICAgLy8gRE9NIHByb3BzCiAgICBpZiAoZWwucHJvcHMpIHsKICAgICAgZGF0YSArPSAiZG9tUHJvcHM6IiArIChnZW5Qcm9wcyhlbC5wcm9wcykpICsgIiwiOwogICAgfQogICAgLy8gZXZlbnQgaGFuZGxlcnMKICAgIGlmIChlbC5ldmVudHMpIHsKICAgICAgZGF0YSArPSAoZ2VuSGFuZGxlcnMoZWwuZXZlbnRzLCBmYWxzZSkpICsgIiwiOwogICAgfQogICAgaWYgKGVsLm5hdGl2ZUV2ZW50cykgewogICAgICBkYXRhICs9IChnZW5IYW5kbGVycyhlbC5uYXRpdmVFdmVudHMsIHRydWUpKSArICIsIjsKICAgIH0KICAgIC8vIHNsb3QgdGFyZ2V0CiAgICAvLyBvbmx5IGZvciBub24tc2NvcGVkIHNsb3RzCiAgICBpZiAoZWwuc2xvdFRhcmdldCAmJiAhZWwuc2xvdFNjb3BlKSB7CiAgICAgIGRhdGEgKz0gInNsb3Q6IiArIChlbC5zbG90VGFyZ2V0KSArICIsIjsKICAgIH0KICAgIC8vIHNjb3BlZCBzbG90cwogICAgaWYgKGVsLnNjb3BlZFNsb3RzKSB7CiAgICAgIGRhdGEgKz0gKGdlblNjb3BlZFNsb3RzKGVsLCBlbC5zY29wZWRTbG90cywgc3RhdGUpKSArICIsIjsKICAgIH0KICAgIC8vIGNvbXBvbmVudCB2LW1vZGVsCiAgICBpZiAoZWwubW9kZWwpIHsKICAgICAgZGF0YSArPSAibW9kZWw6e3ZhbHVlOiIgKyAoZWwubW9kZWwudmFsdWUpICsgIixjYWxsYmFjazoiICsgKGVsLm1vZGVsLmNhbGxiYWNrKSArICIsZXhwcmVzc2lvbjoiICsgKGVsLm1vZGVsLmV4cHJlc3Npb24pICsgIn0sIjsKICAgIH0KICAgIC8vIGlubGluZS10ZW1wbGF0ZQogICAgaWYgKGVsLmlubGluZVRlbXBsYXRlKSB7CiAgICAgIHZhciBpbmxpbmVUZW1wbGF0ZSA9IGdlbklubGluZVRlbXBsYXRlKGVsLCBzdGF0ZSk7CiAgICAgIGlmIChpbmxpbmVUZW1wbGF0ZSkgewogICAgICAgIGRhdGEgKz0gaW5saW5lVGVtcGxhdGUgKyAiLCI7CiAgICAgIH0KICAgIH0KICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoLywkLywgJycpICsgJ30nOwogICAgLy8gdi1iaW5kIGR5bmFtaWMgYXJndW1lbnQgd3JhcAogICAgLy8gdi1iaW5kIHdpdGggZHluYW1pYyBhcmd1bWVudHMgbXVzdCBiZSBhcHBsaWVkIHVzaW5nIHRoZSBzYW1lIHYtYmluZCBvYmplY3QKICAgIC8vIG1lcmdlIGhlbHBlciBzbyB0aGF0IGNsYXNzL3N0eWxlL211c3RVc2VQcm9wIGF0dHJzIGFyZSBoYW5kbGVkIGNvcnJlY3RseS4KICAgIGlmIChlbC5keW5hbWljQXR0cnMpIHsKICAgICAgZGF0YSA9ICJfYigiICsgZGF0YSArICIsXCIiICsgKGVsLnRhZykgKyAiXCIsIiArIChnZW5Qcm9wcyhlbC5keW5hbWljQXR0cnMpKSArICIpIjsKICAgIH0KICAgIC8vIHYtYmluZCBkYXRhIHdyYXAKICAgIGlmIChlbC53cmFwRGF0YSkgewogICAgICBkYXRhID0gZWwud3JhcERhdGEoZGF0YSk7CiAgICB9CiAgICAvLyB2LW9uIGRhdGEgd3JhcAogICAgaWYgKGVsLndyYXBMaXN0ZW5lcnMpIHsKICAgICAgZGF0YSA9IGVsLndyYXBMaXN0ZW5lcnMoZGF0YSk7CiAgICB9CiAgICByZXR1cm4gZGF0YQogIH0KCiAgZnVuY3Rpb24gZ2VuRGlyZWN0aXZlcyAoZWwsIHN0YXRlKSB7CiAgICB2YXIgZGlycyA9IGVsLmRpcmVjdGl2ZXM7CiAgICBpZiAoIWRpcnMpIHsgcmV0dXJuIH0KICAgIHZhciByZXMgPSAnZGlyZWN0aXZlczpbJzsKICAgIHZhciBoYXNSdW50aW1lID0gZmFsc2U7CiAgICB2YXIgaSwgbCwgZGlyLCBuZWVkUnVudGltZTsKICAgIGZvciAoaSA9IDAsIGwgPSBkaXJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBkaXIgPSBkaXJzW2ldOwogICAgICBuZWVkUnVudGltZSA9IHRydWU7CiAgICAgIHZhciBnZW4gPSBzdGF0ZS5kaXJlY3RpdmVzW2Rpci5uYW1lXTsKICAgICAgaWYgKGdlbikgewogICAgICAgIC8vIGNvbXBpbGUtdGltZSBkaXJlY3RpdmUgdGhhdCBtYW5pcHVsYXRlcyBBU1QuCiAgICAgICAgLy8gcmV0dXJucyB0cnVlIGlmIGl0IGFsc28gbmVlZHMgYSBydW50aW1lIGNvdW50ZXJwYXJ0LgogICAgICAgIG5lZWRSdW50aW1lID0gISFnZW4oZWwsIGRpciwgc3RhdGUud2Fybik7CiAgICAgIH0KICAgICAgaWYgKG5lZWRSdW50aW1lKSB7CiAgICAgICAgaGFzUnVudGltZSA9IHRydWU7CiAgICAgICAgcmVzICs9ICJ7bmFtZTpcIiIgKyAoZGlyLm5hbWUpICsgIlwiLHJhd05hbWU6XCIiICsgKGRpci5yYXdOYW1lKSArICJcIiIgKyAoZGlyLnZhbHVlID8gKCIsdmFsdWU6KCIgKyAoZGlyLnZhbHVlKSArICIpLGV4cHJlc3Npb246IiArIChKU09OLnN0cmluZ2lmeShkaXIudmFsdWUpKSkgOiAnJykgKyAoZGlyLmFyZyA/ICgiLGFyZzoiICsgKGRpci5pc0R5bmFtaWNBcmcgPyBkaXIuYXJnIDogKCJcIiIgKyAoZGlyLmFyZykgKyAiXCIiKSkpIDogJycpICsgKGRpci5tb2RpZmllcnMgPyAoIixtb2RpZmllcnM6IiArIChKU09OLnN0cmluZ2lmeShkaXIubW9kaWZpZXJzKSkpIDogJycpICsgIn0sIjsKICAgICAgfQogICAgfQogICAgaWYgKGhhc1J1bnRpbWUpIHsKICAgICAgcmV0dXJuIHJlcy5zbGljZSgwLCAtMSkgKyAnXScKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlbklubGluZVRlbXBsYXRlIChlbCwgc3RhdGUpIHsKICAgIHZhciBhc3QgPSBlbC5jaGlsZHJlblswXTsKICAgIGlmIChlbC5jaGlsZHJlbi5sZW5ndGggIT09IDEgfHwgYXN0LnR5cGUgIT09IDEpIHsKICAgICAgc3RhdGUud2FybigKICAgICAgICAnSW5saW5lLXRlbXBsYXRlIGNvbXBvbmVudHMgbXVzdCBoYXZlIGV4YWN0bHkgb25lIGNoaWxkIGVsZW1lbnQuJywKICAgICAgICB7IHN0YXJ0OiBlbC5zdGFydCB9CiAgICAgICk7CiAgICB9CiAgICBpZiAoYXN0ICYmIGFzdC50eXBlID09PSAxKSB7CiAgICAgIHZhciBpbmxpbmVSZW5kZXJGbnMgPSBnZW5lcmF0ZShhc3QsIHN0YXRlLm9wdGlvbnMpOwogICAgICByZXR1cm4gKCJpbmxpbmVUZW1wbGF0ZTp7cmVuZGVyOmZ1bmN0aW9uKCl7IiArIChpbmxpbmVSZW5kZXJGbnMucmVuZGVyKSArICJ9LHN0YXRpY1JlbmRlckZuczpbIiArIChpbmxpbmVSZW5kZXJGbnMuc3RhdGljUmVuZGVyRm5zLm1hcChmdW5jdGlvbiAoY29kZSkgeyByZXR1cm4gKCJmdW5jdGlvbigpeyIgKyBjb2RlICsgIn0iKTsgfSkuam9pbignLCcpKSArICJdfSIpCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5TY29wZWRTbG90cyAoCiAgICBlbCwKICAgIHNsb3RzLAogICAgc3RhdGUKICApIHsKICAgIC8vIGJ5IGRlZmF1bHQgc2NvcGVkIHNsb3RzIGFyZSBjb25zaWRlcmVkICJzdGFibGUiLCB0aGlzIGFsbG93cyBjaGlsZAogICAgLy8gY29tcG9uZW50cyB3aXRoIG9ubHkgc2NvcGVkIHNsb3RzIHRvIHNraXAgZm9yY2VkIHVwZGF0ZXMgZnJvbSBwYXJlbnQuCiAgICAvLyBidXQgaW4gc29tZSBjYXNlcyB3ZSBoYXZlIHRvIGJhaWwtb3V0IG9mIHRoaXMgb3B0aW1pemF0aW9uCiAgICAvLyBmb3IgZXhhbXBsZSBpZiB0aGUgc2xvdCBjb250YWlucyBkeW5hbWljIG5hbWVzLCBoYXMgdi1pZiBvciB2LWZvciBvbiB0aGVtLi4uCiAgICB2YXIgbmVlZHNGb3JjZVVwZGF0ZSA9IGVsLmZvciB8fCBPYmplY3Qua2V5cyhzbG90cykuc29tZShmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHZhciBzbG90ID0gc2xvdHNba2V5XTsKICAgICAgcmV0dXJuICgKICAgICAgICBzbG90LnNsb3RUYXJnZXREeW5hbWljIHx8CiAgICAgICAgc2xvdC5pZiB8fAogICAgICAgIHNsb3QuZm9yIHx8CiAgICAgICAgY29udGFpbnNTbG90Q2hpbGQoc2xvdCkgLy8gaXMgcGFzc2luZyBkb3duIHNsb3QgZnJvbSBwYXJlbnQgd2hpY2ggbWF5IGJlIGR5bmFtaWMKICAgICAgKQogICAgfSk7CgogICAgLy8gIzk1MzQ6IGlmIGEgY29tcG9uZW50IHdpdGggc2NvcGVkIHNsb3RzIGlzIGluc2lkZSBhIGNvbmRpdGlvbmFsIGJyYW5jaCwKICAgIC8vIGl0J3MgcG9zc2libGUgZm9yIHRoZSBzYW1lIGNvbXBvbmVudCB0byBiZSByZXVzZWQgYnV0IHdpdGggZGlmZmVyZW50CiAgICAvLyBjb21waWxlZCBzbG90IGNvbnRlbnQuIFRvIGF2b2lkIHRoYXQsIHdlIGdlbmVyYXRlIGEgdW5pcXVlIGtleSBiYXNlZCBvbgogICAgLy8gdGhlIGdlbmVyYXRlZCBjb2RlIG9mIGFsbCB0aGUgc2xvdCBjb250ZW50cy4KICAgIHZhciBuZWVkc0tleSA9ICEhZWwuaWY7CgogICAgLy8gT1Igd2hlbiBpdCBpcyBpbnNpZGUgYW5vdGhlciBzY29wZWQgc2xvdCBvciB2LWZvciAodGhlIHJlYWN0aXZpdHkgbWF5IGJlCiAgICAvLyBkaXNjb25uZWN0ZWQgZHVlIHRvIHRoZSBpbnRlcm1lZGlhdGUgc2NvcGUgdmFyaWFibGUpCiAgICAvLyAjOTQzOCwgIzk1MDYKICAgIC8vIFRPRE86IHRoaXMgY2FuIGJlIGZ1cnRoZXIgb3B0aW1pemVkIGJ5IHByb3Blcmx5IGFuYWx5emluZyBpbi1zY29wZSBiaW5kaW5ncwogICAgLy8gYW5kIHNraXAgZm9yY2UgdXBkYXRpbmcgb25lcyB0aGF0IGRvIG5vdCBhY3R1YWxseSB1c2Ugc2NvcGUgdmFyaWFibGVzLgogICAgaWYgKCFuZWVkc0ZvcmNlVXBkYXRlKSB7CiAgICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQ7CiAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICBpZiAoCiAgICAgICAgICAocGFyZW50LnNsb3RTY29wZSAmJiBwYXJlbnQuc2xvdFNjb3BlICE9PSBlbXB0eVNsb3RTY29wZVRva2VuKSB8fAogICAgICAgICAgcGFyZW50LmZvcgogICAgICAgICkgewogICAgICAgICAgbmVlZHNGb3JjZVVwZGF0ZSA9IHRydWU7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgICBpZiAocGFyZW50LmlmKSB7CiAgICAgICAgICBuZWVkc0tleSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgZ2VuZXJhdGVkU2xvdHMgPSBPYmplY3Qua2V5cyhzbG90cykKICAgICAgLm1hcChmdW5jdGlvbiAoa2V5KSB7IHJldHVybiBnZW5TY29wZWRTbG90KHNsb3RzW2tleV0sIHN0YXRlKTsgfSkKICAgICAgLmpvaW4oJywnKTsKCiAgICByZXR1cm4gKCJzY29wZWRTbG90czpfdShbIiArIGdlbmVyYXRlZFNsb3RzICsgIl0iICsgKG5lZWRzRm9yY2VVcGRhdGUgPyAiLG51bGwsdHJ1ZSIgOiAiIikgKyAoIW5lZWRzRm9yY2VVcGRhdGUgJiYgbmVlZHNLZXkgPyAoIixudWxsLGZhbHNlLCIgKyAoaGFzaChnZW5lcmF0ZWRTbG90cykpKSA6ICIiKSArICIpIikKICB9CgogIGZ1bmN0aW9uIGhhc2goc3RyKSB7CiAgICB2YXIgaGFzaCA9IDUzODE7CiAgICB2YXIgaSA9IHN0ci5sZW5ndGg7CiAgICB3aGlsZShpKSB7CiAgICAgIGhhc2ggPSAoaGFzaCAqIDMzKSBeIHN0ci5jaGFyQ29kZUF0KC0taSk7CiAgICB9CiAgICByZXR1cm4gaGFzaCA+Pj4gMAogIH0KCiAgZnVuY3Rpb24gY29udGFpbnNTbG90Q2hpbGQgKGVsKSB7CiAgICBpZiAoZWwudHlwZSA9PT0gMSkgewogICAgICBpZiAoZWwudGFnID09PSAnc2xvdCcpIHsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgICB9CiAgICAgIHJldHVybiBlbC5jaGlsZHJlbi5zb21lKGNvbnRhaW5zU2xvdENoaWxkKQogICAgfQogICAgcmV0dXJuIGZhbHNlCiAgfQoKICBmdW5jdGlvbiBnZW5TY29wZWRTbG90ICgKICAgIGVsLAogICAgc3RhdGUKICApIHsKICAgIHZhciBpc0xlZ2FjeVN5bnRheCA9IGVsLmF0dHJzTWFwWydzbG90LXNjb3BlJ107CiAgICBpZiAoZWwuaWYgJiYgIWVsLmlmUHJvY2Vzc2VkICYmICFpc0xlZ2FjeVN5bnRheCkgewogICAgICByZXR1cm4gZ2VuSWYoZWwsIHN0YXRlLCBnZW5TY29wZWRTbG90LCAibnVsbCIpCiAgICB9CiAgICBpZiAoZWwuZm9yICYmICFlbC5mb3JQcm9jZXNzZWQpIHsKICAgICAgcmV0dXJuIGdlbkZvcihlbCwgc3RhdGUsIGdlblNjb3BlZFNsb3QpCiAgICB9CiAgICB2YXIgc2xvdFNjb3BlID0gZWwuc2xvdFNjb3BlID09PSBlbXB0eVNsb3RTY29wZVRva2VuCiAgICAgID8gIiIKICAgICAgOiBTdHJpbmcoZWwuc2xvdFNjb3BlKTsKICAgIHZhciBmbiA9ICJmdW5jdGlvbigiICsgc2xvdFNjb3BlICsgIil7IiArCiAgICAgICJyZXR1cm4gIiArIChlbC50YWcgPT09ICd0ZW1wbGF0ZScKICAgICAgICA/IGVsLmlmICYmIGlzTGVnYWN5U3ludGF4CiAgICAgICAgICA/ICgiKCIgKyAoZWwuaWYpICsgIik/IiArIChnZW5DaGlsZHJlbihlbCwgc3RhdGUpIHx8ICd1bmRlZmluZWQnKSArICI6dW5kZWZpbmVkIikKICAgICAgICAgIDogZ2VuQ2hpbGRyZW4oZWwsIHN0YXRlKSB8fCAndW5kZWZpbmVkJwogICAgICAgIDogZ2VuRWxlbWVudChlbCwgc3RhdGUpKSArICJ9IjsKICAgIC8vIHJldmVyc2UgcHJveHkgdi1zbG90IHdpdGhvdXQgc2NvcGUgb24gdGhpcy4kc2xvdHMKICAgIHZhciByZXZlcnNlUHJveHkgPSBzbG90U2NvcGUgPyAiIiA6ICIscHJveHk6dHJ1ZSI7CiAgICByZXR1cm4gKCJ7a2V5OiIgKyAoZWwuc2xvdFRhcmdldCB8fCAiXCJkZWZhdWx0XCIiKSArICIsZm46IiArIGZuICsgcmV2ZXJzZVByb3h5ICsgIn0iKQogIH0KCiAgZnVuY3Rpb24gZ2VuQ2hpbGRyZW4gKAogICAgZWwsCiAgICBzdGF0ZSwKICAgIGNoZWNrU2tpcCwKICAgIGFsdEdlbkVsZW1lbnQsCiAgICBhbHRHZW5Ob2RlCiAgKSB7CiAgICB2YXIgY2hpbGRyZW4gPSBlbC5jaGlsZHJlbjsKICAgIGlmIChjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgdmFyIGVsJDEgPSBjaGlsZHJlblswXTsKICAgICAgLy8gb3B0aW1pemUgc2luZ2xlIHYtZm9yCiAgICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPT09IDEgJiYKICAgICAgICBlbCQxLmZvciAmJgogICAgICAgIGVsJDEudGFnICE9PSAndGVtcGxhdGUnICYmCiAgICAgICAgZWwkMS50YWcgIT09ICdzbG90JwogICAgICApIHsKICAgICAgICB2YXIgbm9ybWFsaXphdGlvblR5cGUgPSBjaGVja1NraXAKICAgICAgICAgID8gc3RhdGUubWF5YmVDb21wb25lbnQoZWwkMSkgPyAiLDEiIDogIiwwIgogICAgICAgICAgOiAiIjsKICAgICAgICByZXR1cm4gKCIiICsgKChhbHRHZW5FbGVtZW50IHx8IGdlbkVsZW1lbnQpKGVsJDEsIHN0YXRlKSkgKyBub3JtYWxpemF0aW9uVHlwZSkKICAgICAgfQogICAgICB2YXIgbm9ybWFsaXphdGlvblR5cGUkMSA9IGNoZWNrU2tpcAogICAgICAgID8gZ2V0Tm9ybWFsaXphdGlvblR5cGUoY2hpbGRyZW4sIHN0YXRlLm1heWJlQ29tcG9uZW50KQogICAgICAgIDogMDsKICAgICAgdmFyIGdlbiA9IGFsdEdlbk5vZGUgfHwgZ2VuTm9kZTsKICAgICAgcmV0dXJuICgiWyIgKyAoY2hpbGRyZW4ubWFwKGZ1bmN0aW9uIChjKSB7IHJldHVybiBnZW4oYywgc3RhdGUpOyB9KS5qb2luKCcsJykpICsgIl0iICsgKG5vcm1hbGl6YXRpb25UeXBlJDEgPyAoIiwiICsgbm9ybWFsaXphdGlvblR5cGUkMSkgOiAnJykpCiAgICB9CiAgfQoKICAvLyBkZXRlcm1pbmUgdGhlIG5vcm1hbGl6YXRpb24gbmVlZGVkIGZvciB0aGUgY2hpbGRyZW4gYXJyYXkuCiAgLy8gMDogbm8gbm9ybWFsaXphdGlvbiBuZWVkZWQKICAvLyAxOiBzaW1wbGUgbm9ybWFsaXphdGlvbiBuZWVkZWQgKHBvc3NpYmxlIDEtbGV2ZWwgZGVlcCBuZXN0ZWQgYXJyYXkpCiAgLy8gMjogZnVsbCBub3JtYWxpemF0aW9uIG5lZWRlZAogIGZ1bmN0aW9uIGdldE5vcm1hbGl6YXRpb25UeXBlICgKICAgIGNoaWxkcmVuLAogICAgbWF5YmVDb21wb25lbnQKICApIHsKICAgIHZhciByZXMgPSAwOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICB2YXIgZWwgPSBjaGlsZHJlbltpXTsKICAgICAgaWYgKGVsLnR5cGUgIT09IDEpIHsKICAgICAgICBjb250aW51ZQogICAgICB9CiAgICAgIGlmIChuZWVkc05vcm1hbGl6YXRpb24oZWwpIHx8CiAgICAgICAgICAoZWwuaWZDb25kaXRpb25zICYmIGVsLmlmQ29uZGl0aW9ucy5zb21lKGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZWVkc05vcm1hbGl6YXRpb24oYy5ibG9jayk7IH0pKSkgewogICAgICAgIHJlcyA9IDI7CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgICBpZiAobWF5YmVDb21wb25lbnQoZWwpIHx8CiAgICAgICAgICAoZWwuaWZDb25kaXRpb25zICYmIGVsLmlmQ29uZGl0aW9ucy5zb21lKGZ1bmN0aW9uIChjKSB7IHJldHVybiBtYXliZUNvbXBvbmVudChjLmJsb2NrKTsgfSkpKSB7CiAgICAgICAgcmVzID0gMTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gbmVlZHNOb3JtYWxpemF0aW9uIChlbCkgewogICAgcmV0dXJuIGVsLmZvciAhPT0gdW5kZWZpbmVkIHx8IGVsLnRhZyA9PT0gJ3RlbXBsYXRlJyB8fCBlbC50YWcgPT09ICdzbG90JwogIH0KCiAgZnVuY3Rpb24gZ2VuTm9kZSAobm9kZSwgc3RhdGUpIHsKICAgIGlmIChub2RlLnR5cGUgPT09IDEpIHsKICAgICAgcmV0dXJuIGdlbkVsZW1lbnQobm9kZSwgc3RhdGUpCiAgICB9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gMyAmJiBub2RlLmlzQ29tbWVudCkgewogICAgICByZXR1cm4gZ2VuQ29tbWVudChub2RlKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGdlblRleHQobm9kZSkKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlblRleHQgKHRleHQpIHsKICAgIHJldHVybiAoIl92KCIgKyAodGV4dC50eXBlID09PSAyCiAgICAgID8gdGV4dC5leHByZXNzaW9uIC8vIG5vIG5lZWQgZm9yICgpIGJlY2F1c2UgYWxyZWFkeSB3cmFwcGVkIGluIF9zKCkKICAgICAgOiB0cmFuc2Zvcm1TcGVjaWFsTmV3bGluZXMoSlNPTi5zdHJpbmdpZnkodGV4dC50ZXh0KSkpICsgIikiKQogIH0KCiAgZnVuY3Rpb24gZ2VuQ29tbWVudCAoY29tbWVudCkgewogICAgcmV0dXJuICgiX2UoIiArIChKU09OLnN0cmluZ2lmeShjb21tZW50LnRleHQpKSArICIpIikKICB9CgogIGZ1bmN0aW9uIGdlblNsb3QgKGVsLCBzdGF0ZSkgewogICAgdmFyIHNsb3ROYW1lID0gZWwuc2xvdE5hbWUgfHwgJyJkZWZhdWx0Iic7CiAgICB2YXIgY2hpbGRyZW4gPSBnZW5DaGlsZHJlbihlbCwgc3RhdGUpOwogICAgdmFyIHJlcyA9ICJfdCgiICsgc2xvdE5hbWUgKyAoY2hpbGRyZW4gPyAoIiwiICsgY2hpbGRyZW4pIDogJycpOwogICAgdmFyIGF0dHJzID0gZWwuYXR0cnMgfHwgZWwuZHluYW1pY0F0dHJzCiAgICAgID8gZ2VuUHJvcHMoKGVsLmF0dHJzIHx8IFtdKS5jb25jYXQoZWwuZHluYW1pY0F0dHJzIHx8IFtdKS5tYXAoZnVuY3Rpb24gKGF0dHIpIHsgcmV0dXJuICh7CiAgICAgICAgICAvLyBzbG90IHByb3BzIGFyZSBjYW1lbGl6ZWQKICAgICAgICAgIG5hbWU6IGNhbWVsaXplKGF0dHIubmFtZSksCiAgICAgICAgICB2YWx1ZTogYXR0ci52YWx1ZSwKICAgICAgICAgIGR5bmFtaWM6IGF0dHIuZHluYW1pYwogICAgICAgIH0pOyB9KSkKICAgICAgOiBudWxsOwogICAgdmFyIGJpbmQkJDEgPSBlbC5hdHRyc01hcFsndi1iaW5kJ107CiAgICBpZiAoKGF0dHJzIHx8IGJpbmQkJDEpICYmICFjaGlsZHJlbikgewogICAgICByZXMgKz0gIixudWxsIjsKICAgIH0KICAgIGlmIChhdHRycykgewogICAgICByZXMgKz0gIiwiICsgYXR0cnM7CiAgICB9CiAgICBpZiAoYmluZCQkMSkgewogICAgICByZXMgKz0gKGF0dHJzID8gJycgOiAnLG51bGwnKSArICIsIiArIGJpbmQkJDE7CiAgICB9CiAgICByZXR1cm4gcmVzICsgJyknCiAgfQoKICAvLyBjb21wb25lbnROYW1lIGlzIGVsLmNvbXBvbmVudCwgdGFrZSBpdCBhcyBhcmd1bWVudCB0byBzaHVuIGZsb3cncyBwZXNzaW1pc3RpYyByZWZpbmVtZW50CiAgZnVuY3Rpb24gZ2VuQ29tcG9uZW50ICgKICAgIGNvbXBvbmVudE5hbWUsCiAgICBlbCwKICAgIHN0YXRlCiAgKSB7CiAgICB2YXIgY2hpbGRyZW4gPSBlbC5pbmxpbmVUZW1wbGF0ZSA/IG51bGwgOiBnZW5DaGlsZHJlbihlbCwgc3RhdGUsIHRydWUpOwogICAgcmV0dXJuICgiX2MoIiArIGNvbXBvbmVudE5hbWUgKyAiLCIgKyAoZ2VuRGF0YSQyKGVsLCBzdGF0ZSkpICsgKGNoaWxkcmVuID8gKCIsIiArIGNoaWxkcmVuKSA6ICcnKSArICIpIikKICB9CgogIGZ1bmN0aW9uIGdlblByb3BzIChwcm9wcykgewogICAgdmFyIHN0YXRpY1Byb3BzID0gIiI7CiAgICB2YXIgZHluYW1pY1Byb3BzID0gIiI7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBwcm9wID0gcHJvcHNbaV07CiAgICAgIHZhciB2YWx1ZSA9IHRyYW5zZm9ybVNwZWNpYWxOZXdsaW5lcyhwcm9wLnZhbHVlKTsKICAgICAgaWYgKHByb3AuZHluYW1pYykgewogICAgICAgIGR5bmFtaWNQcm9wcyArPSAocHJvcC5uYW1lKSArICIsIiArIHZhbHVlICsgIiwiOwogICAgICB9IGVsc2UgewogICAgICAgIHN0YXRpY1Byb3BzICs9ICJcIiIgKyAocHJvcC5uYW1lKSArICJcIjoiICsgdmFsdWUgKyAiLCI7CiAgICAgIH0KICAgIH0KICAgIHN0YXRpY1Byb3BzID0gInsiICsgKHN0YXRpY1Byb3BzLnNsaWNlKDAsIC0xKSkgKyAifSI7CiAgICBpZiAoZHluYW1pY1Byb3BzKSB7CiAgICAgIHJldHVybiAoIl9kKCIgKyBzdGF0aWNQcm9wcyArICIsWyIgKyAoZHluYW1pY1Byb3BzLnNsaWNlKDAsIC0xKSkgKyAiXSkiKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHN0YXRpY1Byb3BzCiAgICB9CiAgfQoKICAvLyAjMzg5NSwgIzQyNjgKICBmdW5jdGlvbiB0cmFuc2Zvcm1TcGVjaWFsTmV3bGluZXMgKHRleHQpIHsKICAgIHJldHVybiB0ZXh0CiAgICAgIC5yZXBsYWNlKC9cdTIwMjgvZywgJ1xcdTIwMjgnKQogICAgICAucmVwbGFjZSgvXHUyMDI5L2csICdcXHUyMDI5JykKICB9CgogIC8qICAqLwoKCgogIC8vIHRoZXNlIGtleXdvcmRzIHNob3VsZCBub3QgYXBwZWFyIGluc2lkZSBleHByZXNzaW9ucywgYnV0IG9wZXJhdG9ycyBsaWtlCiAgLy8gdHlwZW9mLCBpbnN0YW5jZW9mIGFuZCBpbiBhcmUgYWxsb3dlZAogIHZhciBwcm9oaWJpdGVkS2V5d29yZFJFID0gbmV3IFJlZ0V4cCgnXFxiJyArICgKICAgICdkbyxpZixmb3IsbGV0LG5ldyx0cnksdmFyLGNhc2UsZWxzZSx3aXRoLGF3YWl0LGJyZWFrLGNhdGNoLGNsYXNzLGNvbnN0LCcgKwogICAgJ3N1cGVyLHRocm93LHdoaWxlLHlpZWxkLGRlbGV0ZSxleHBvcnQsaW1wb3J0LHJldHVybixzd2l0Y2gsZGVmYXVsdCwnICsKICAgICdleHRlbmRzLGZpbmFsbHksY29udGludWUsZGVidWdnZXIsZnVuY3Rpb24sYXJndW1lbnRzJwogICkuc3BsaXQoJywnKS5qb2luKCdcXGJ8XFxiJykgKyAnXFxiJyk7CgogIC8vIHRoZXNlIHVuYXJ5IG9wZXJhdG9ycyBzaG91bGQgbm90IGJlIHVzZWQgYXMgcHJvcGVydHkvbWV0aG9kIG5hbWVzCiAgdmFyIHVuYXJ5T3BlcmF0b3JzUkUgPSBuZXcgUmVnRXhwKCdcXGInICsgKAogICAgJ2RlbGV0ZSx0eXBlb2Ysdm9pZCcKICApLnNwbGl0KCcsJykuam9pbignXFxzKlxcKFteXFwpXSpcXCl8XFxiJykgKyAnXFxzKlxcKFteXFwpXSpcXCknKTsKCiAgLy8gc3RyaXAgc3RyaW5ncyBpbiBleHByZXNzaW9ucwogIHZhciBzdHJpcFN0cmluZ1JFID0gLycoPzpbXidcXF18XFwuKSonfCIoPzpbXiJcXF18XFwuKSoifGAoPzpbXmBcXF18XFwuKSpcJFx7fFx9KD86W15gXFxdfFxcLikqYHxgKD86W15gXFxdfFxcLikqYC9nOwoKICAvLyBkZXRlY3QgcHJvYmxlbWF0aWMgZXhwcmVzc2lvbnMgaW4gYSB0ZW1wbGF0ZQogIGZ1bmN0aW9uIGRldGVjdEVycm9ycyAoYXN0LCB3YXJuKSB7CiAgICBpZiAoYXN0KSB7CiAgICAgIGNoZWNrTm9kZShhc3QsIHdhcm4pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hlY2tOb2RlIChub2RlLCB3YXJuKSB7CiAgICBpZiAobm9kZS50eXBlID09PSAxKSB7CiAgICAgIGZvciAodmFyIG5hbWUgaW4gbm9kZS5hdHRyc01hcCkgewogICAgICAgIGlmIChkaXJSRS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBub2RlLmF0dHJzTWFwW25hbWVdOwogICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgIHZhciByYW5nZSA9IG5vZGUucmF3QXR0cnNNYXBbbmFtZV07CiAgICAgICAgICAgIGlmIChuYW1lID09PSAndi1mb3InKSB7CiAgICAgICAgICAgICAgY2hlY2tGb3Iobm9kZSwgKCJ2LWZvcj1cIiIgKyB2YWx1ZSArICJcIiIpLCB3YXJuLCByYW5nZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZSA9PT0gJ3Ytc2xvdCcgfHwgbmFtZVswXSA9PT0gJyMnKSB7CiAgICAgICAgICAgICAgY2hlY2tGdW5jdGlvblBhcmFtZXRlckV4cHJlc3Npb24odmFsdWUsIChuYW1lICsgIj1cIiIgKyB2YWx1ZSArICJcIiIpLCB3YXJuLCByYW5nZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob25SRS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICAgICAgY2hlY2tFdmVudCh2YWx1ZSwgKG5hbWUgKyAiPVwiIiArIHZhbHVlICsgIlwiIiksIHdhcm4sIHJhbmdlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjaGVja0V4cHJlc3Npb24odmFsdWUsIChuYW1lICsgIj1cIiIgKyB2YWx1ZSArICJcIiIpLCB3YXJuLCByYW5nZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG5vZGUuY2hpbGRyZW4pIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNoZWNrTm9kZShub2RlLmNoaWxkcmVuW2ldLCB3YXJuKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAyKSB7CiAgICAgIGNoZWNrRXhwcmVzc2lvbihub2RlLmV4cHJlc3Npb24sIG5vZGUudGV4dCwgd2Fybiwgbm9kZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjaGVja0V2ZW50IChleHAsIHRleHQsIHdhcm4sIHJhbmdlKSB7CiAgICB2YXIgc3RyaXBwZWQgPSBleHAucmVwbGFjZShzdHJpcFN0cmluZ1JFLCAnJyk7CiAgICB2YXIga2V5d29yZE1hdGNoID0gc3RyaXBwZWQubWF0Y2godW5hcnlPcGVyYXRvcnNSRSk7CiAgICBpZiAoa2V5d29yZE1hdGNoICYmIHN0cmlwcGVkLmNoYXJBdChrZXl3b3JkTWF0Y2guaW5kZXggLSAxKSAhPT0gJyQnKSB7CiAgICAgIHdhcm4oCiAgICAgICAgImF2b2lkIHVzaW5nIEphdmFTY3JpcHQgdW5hcnkgb3BlcmF0b3IgYXMgcHJvcGVydHkgbmFtZTogIiArCiAgICAgICAgIlwiIiArIChrZXl3b3JkTWF0Y2hbMF0pICsgIlwiIGluIGV4cHJlc3Npb24gIiArICh0ZXh0LnRyaW0oKSksCiAgICAgICAgcmFuZ2UKICAgICAgKTsKICAgIH0KICAgIGNoZWNrRXhwcmVzc2lvbihleHAsIHRleHQsIHdhcm4sIHJhbmdlKTsKICB9CgogIGZ1bmN0aW9uIGNoZWNrRm9yIChub2RlLCB0ZXh0LCB3YXJuLCByYW5nZSkgewogICAgY2hlY2tFeHByZXNzaW9uKG5vZGUuZm9yIHx8ICcnLCB0ZXh0LCB3YXJuLCByYW5nZSk7CiAgICBjaGVja0lkZW50aWZpZXIobm9kZS5hbGlhcywgJ3YtZm9yIGFsaWFzJywgdGV4dCwgd2FybiwgcmFuZ2UpOwogICAgY2hlY2tJZGVudGlmaWVyKG5vZGUuaXRlcmF0b3IxLCAndi1mb3IgaXRlcmF0b3InLCB0ZXh0LCB3YXJuLCByYW5nZSk7CiAgICBjaGVja0lkZW50aWZpZXIobm9kZS5pdGVyYXRvcjIsICd2LWZvciBpdGVyYXRvcicsIHRleHQsIHdhcm4sIHJhbmdlKTsKICB9CgogIGZ1bmN0aW9uIGNoZWNrSWRlbnRpZmllciAoCiAgICBpZGVudCwKICAgIHR5cGUsCiAgICB0ZXh0LAogICAgd2FybiwKICAgIHJhbmdlCiAgKSB7CiAgICBpZiAodHlwZW9mIGlkZW50ID09PSAnc3RyaW5nJykgewogICAgICB0cnkgewogICAgICAgIG5ldyBGdW5jdGlvbigoInZhciAiICsgaWRlbnQgKyAiPV8iKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB3YXJuKCgiaW52YWxpZCAiICsgdHlwZSArICIgXCIiICsgaWRlbnQgKyAiXCIgaW4gZXhwcmVzc2lvbjogIiArICh0ZXh0LnRyaW0oKSkpLCByYW5nZSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGNoZWNrRXhwcmVzc2lvbiAoZXhwLCB0ZXh0LCB3YXJuLCByYW5nZSkgewogICAgdHJ5IHsKICAgICAgbmV3IEZ1bmN0aW9uKCgicmV0dXJuICIgKyBleHApKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgdmFyIGtleXdvcmRNYXRjaCA9IGV4cC5yZXBsYWNlKHN0cmlwU3RyaW5nUkUsICcnKS5tYXRjaChwcm9oaWJpdGVkS2V5d29yZFJFKTsKICAgICAgaWYgKGtleXdvcmRNYXRjaCkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAiYXZvaWQgdXNpbmcgSmF2YVNjcmlwdCBrZXl3b3JkIGFzIHByb3BlcnR5IG5hbWU6ICIgKwogICAgICAgICAgIlwiIiArIChrZXl3b3JkTWF0Y2hbMF0pICsgIlwiXG4gIFJhdyBleHByZXNzaW9uOiAiICsgKHRleHQudHJpbSgpKSwKICAgICAgICAgIHJhbmdlCiAgICAgICAgKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKAogICAgICAgICAgImludmFsaWQgZXhwcmVzc2lvbjogIiArIChlLm1lc3NhZ2UpICsgIiBpblxuXG4iICsKICAgICAgICAgICIgICAgIiArIGV4cCArICJcblxuIiArCiAgICAgICAgICAiICBSYXcgZXhwcmVzc2lvbjogIiArICh0ZXh0LnRyaW0oKSkgKyAiXG4iLAogICAgICAgICAgcmFuZ2UKICAgICAgICApOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjaGVja0Z1bmN0aW9uUGFyYW1ldGVyRXhwcmVzc2lvbiAoZXhwLCB0ZXh0LCB3YXJuLCByYW5nZSkgewogICAgdHJ5IHsKICAgICAgbmV3IEZ1bmN0aW9uKGV4cCwgJycpOwogICAgfSBjYXRjaCAoZSkgewogICAgICB3YXJuKAogICAgICAgICJpbnZhbGlkIGZ1bmN0aW9uIHBhcmFtZXRlciBleHByZXNzaW9uOiAiICsgKGUubWVzc2FnZSkgKyAiIGluXG5cbiIgKwogICAgICAgICIgICAgIiArIGV4cCArICJcblxuIiArCiAgICAgICAgIiAgUmF3IGV4cHJlc3Npb246ICIgKyAodGV4dC50cmltKCkpICsgIlxuIiwKICAgICAgICByYW5nZQogICAgICApOwogICAgfQogIH0KCiAgLyogICovCgogIHZhciByYW5nZSA9IDI7CgogIGZ1bmN0aW9uIGdlbmVyYXRlQ29kZUZyYW1lICgKICAgIHNvdXJjZSwKICAgIHN0YXJ0LAogICAgZW5kCiAgKSB7CiAgICBpZiAoIHN0YXJ0ID09PSB2b2lkIDAgKSBzdGFydCA9IDA7CiAgICBpZiAoIGVuZCA9PT0gdm9pZCAwICkgZW5kID0gc291cmNlLmxlbmd0aDsKCiAgICB2YXIgbGluZXMgPSBzb3VyY2Uuc3BsaXQoL1xyP1xuLyk7CiAgICB2YXIgY291bnQgPSAwOwogICAgdmFyIHJlcyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykgewogICAgICBjb3VudCArPSBsaW5lc1tpXS5sZW5ndGggKyAxOwogICAgICBpZiAoY291bnQgPj0gc3RhcnQpIHsKICAgICAgICBmb3IgKHZhciBqID0gaSAtIHJhbmdlOyBqIDw9IGkgKyByYW5nZSB8fCBlbmQgPiBjb3VudDsgaisrKSB7CiAgICAgICAgICBpZiAoaiA8IDAgfHwgaiA+PSBsaW5lcy5sZW5ndGgpIHsgY29udGludWUgfQogICAgICAgICAgcmVzLnB1c2goKCIiICsgKGogKyAxKSArIChyZXBlYXQkMSgiICIsIDMgLSBTdHJpbmcoaiArIDEpLmxlbmd0aCkpICsgInwgICIgKyAobGluZXNbal0pKSk7CiAgICAgICAgICB2YXIgbGluZUxlbmd0aCA9IGxpbmVzW2pdLmxlbmd0aDsKICAgICAgICAgIGlmIChqID09PSBpKSB7CiAgICAgICAgICAgIC8vIHB1c2ggdW5kZXJsaW5lCiAgICAgICAgICAgIHZhciBwYWQgPSBzdGFydCAtIChjb3VudCAtIGxpbmVMZW5ndGgpICsgMTsKICAgICAgICAgICAgdmFyIGxlbmd0aCA9IGVuZCA+IGNvdW50ID8gbGluZUxlbmd0aCAtIHBhZCA6IGVuZCAtIHN0YXJ0OwogICAgICAgICAgICByZXMucHVzaCgiICAgfCAgIiArIHJlcGVhdCQxKCIgIiwgcGFkKSArIHJlcGVhdCQxKCJeIiwgbGVuZ3RoKSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGogPiBpKSB7CiAgICAgICAgICAgIGlmIChlbmQgPiBjb3VudCkgewogICAgICAgICAgICAgIHZhciBsZW5ndGgkMSA9IE1hdGgubWluKGVuZCAtIGNvdW50LCBsaW5lTGVuZ3RoKTsKICAgICAgICAgICAgICByZXMucHVzaCgiICAgfCAgIiArIHJlcGVhdCQxKCJeIiwgbGVuZ3RoJDEpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb3VudCArPSBsaW5lTGVuZ3RoICsgMTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcy5qb2luKCdcbicpCiAgfQoKICBmdW5jdGlvbiByZXBlYXQkMSAoc3RyLCBuKSB7CiAgICB2YXIgcmVzdWx0ID0gJyc7CiAgICBpZiAobiA+IDApIHsKICAgICAgd2hpbGUgKHRydWUpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZQogICAgICAgIGlmIChuICYgMSkgeyByZXN1bHQgKz0gc3RyOyB9CiAgICAgICAgbiA+Pj49IDE7CiAgICAgICAgaWYgKG4gPD0gMCkgeyBicmVhayB9CiAgICAgICAgc3RyICs9IHN0cjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdAogIH0KCiAgLyogICovCgoKCiAgZnVuY3Rpb24gY3JlYXRlRnVuY3Rpb24gKGNvZGUsIGVycm9ycykgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbihjb2RlKQogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGVycm9ycy5wdXNoKHsgZXJyOiBlcnIsIGNvZGU6IGNvZGUgfSk7CiAgICAgIHJldHVybiBub29wCiAgICB9CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVDb21waWxlVG9GdW5jdGlvbkZuIChjb21waWxlKSB7CiAgICB2YXIgY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgIHJldHVybiBmdW5jdGlvbiBjb21waWxlVG9GdW5jdGlvbnMgKAogICAgICB0ZW1wbGF0ZSwKICAgICAgb3B0aW9ucywKICAgICAgdm0KICAgICkgewogICAgICBvcHRpb25zID0gZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgdmFyIHdhcm4kJDEgPSBvcHRpb25zLndhcm4gfHwgd2FybjsKICAgICAgZGVsZXRlIG9wdGlvbnMud2FybjsKCiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICB7CiAgICAgICAgLy8gZGV0ZWN0IHBvc3NpYmxlIENTUCByZXN0cmljdGlvbgogICAgICAgIHRyeSB7CiAgICAgICAgICBuZXcgRnVuY3Rpb24oJ3JldHVybiAxJyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgaWYgKGUudG9TdHJpbmcoKS5tYXRjaCgvdW5zYWZlLWV2YWx8Q1NQLykpIHsKICAgICAgICAgICAgd2FybiQkMSgKICAgICAgICAgICAgICAnSXQgc2VlbXMgeW91IGFyZSB1c2luZyB0aGUgc3RhbmRhbG9uZSBidWlsZCBvZiBWdWUuanMgaW4gYW4gJyArCiAgICAgICAgICAgICAgJ2Vudmlyb25tZW50IHdpdGggQ29udGVudCBTZWN1cml0eSBQb2xpY3kgdGhhdCBwcm9oaWJpdHMgdW5zYWZlLWV2YWwuICcgKwogICAgICAgICAgICAgICdUaGUgdGVtcGxhdGUgY29tcGlsZXIgY2Fubm90IHdvcmsgaW4gdGhpcyBlbnZpcm9ubWVudC4gQ29uc2lkZXIgJyArCiAgICAgICAgICAgICAgJ3JlbGF4aW5nIHRoZSBwb2xpY3kgdG8gYWxsb3cgdW5zYWZlLWV2YWwgb3IgcHJlLWNvbXBpbGluZyB5b3VyICcgKwogICAgICAgICAgICAgICd0ZW1wbGF0ZXMgaW50byByZW5kZXIgZnVuY3Rpb25zLicKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGNoZWNrIGNhY2hlCiAgICAgIHZhciBrZXkgPSBvcHRpb25zLmRlbGltaXRlcnMKICAgICAgICA/IFN0cmluZyhvcHRpb25zLmRlbGltaXRlcnMpICsgdGVtcGxhdGUKICAgICAgICA6IHRlbXBsYXRlOwogICAgICBpZiAoY2FjaGVba2V5XSkgewogICAgICAgIHJldHVybiBjYWNoZVtrZXldCiAgICAgIH0KCiAgICAgIC8vIGNvbXBpbGUKICAgICAgdmFyIGNvbXBpbGVkID0gY29tcGlsZSh0ZW1wbGF0ZSwgb3B0aW9ucyk7CgogICAgICAvLyBjaGVjayBjb21waWxhdGlvbiBlcnJvcnMvdGlwcwogICAgICB7CiAgICAgICAgaWYgKGNvbXBpbGVkLmVycm9ycyAmJiBjb21waWxlZC5lcnJvcnMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICBjb21waWxlZC5lcnJvcnMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgIHdhcm4kJDEoCiAgICAgICAgICAgICAgICAiRXJyb3IgY29tcGlsaW5nIHRlbXBsYXRlOlxuXG4iICsgKGUubXNnKSArICJcblxuIiArCiAgICAgICAgICAgICAgICBnZW5lcmF0ZUNvZGVGcmFtZSh0ZW1wbGF0ZSwgZS5zdGFydCwgZS5lbmQpLAogICAgICAgICAgICAgICAgdm0KICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdhcm4kJDEoCiAgICAgICAgICAgICAgIkVycm9yIGNvbXBpbGluZyB0ZW1wbGF0ZTpcblxuIiArIHRlbXBsYXRlICsgIlxuXG4iICsKICAgICAgICAgICAgICBjb21waWxlZC5lcnJvcnMubWFwKGZ1bmN0aW9uIChlKSB7IHJldHVybiAoIi0gIiArIGUpOyB9KS5qb2luKCdcbicpICsgJ1xuJywKICAgICAgICAgICAgICB2bQogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY29tcGlsZWQudGlwcyAmJiBjb21waWxlZC50aXBzLmxlbmd0aCkgewogICAgICAgICAgaWYgKG9wdGlvbnMub3V0cHV0U291cmNlUmFuZ2UpIHsKICAgICAgICAgICAgY29tcGlsZWQudGlwcy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aXAoZS5tc2csIHZtKTsgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb21waWxlZC50aXBzLmZvckVhY2goZnVuY3Rpb24gKG1zZykgeyByZXR1cm4gdGlwKG1zZywgdm0pOyB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIHR1cm4gY29kZSBpbnRvIGZ1bmN0aW9ucwogICAgICB2YXIgcmVzID0ge307CiAgICAgIHZhciBmbkdlbkVycm9ycyA9IFtdOwogICAgICByZXMucmVuZGVyID0gY3JlYXRlRnVuY3Rpb24oY29tcGlsZWQucmVuZGVyLCBmbkdlbkVycm9ycyk7CiAgICAgIHJlcy5zdGF0aWNSZW5kZXJGbnMgPSBjb21waWxlZC5zdGF0aWNSZW5kZXJGbnMubWFwKGZ1bmN0aW9uIChjb2RlKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUZ1bmN0aW9uKGNvZGUsIGZuR2VuRXJyb3JzKQogICAgICB9KTsKCiAgICAgIC8vIGNoZWNrIGZ1bmN0aW9uIGdlbmVyYXRpb24gZXJyb3JzLgogICAgICAvLyB0aGlzIHNob3VsZCBvbmx5IGhhcHBlbiBpZiB0aGVyZSBpcyBhIGJ1ZyBpbiB0aGUgY29tcGlsZXIgaXRzZWxmLgogICAgICAvLyBtb3N0bHkgZm9yIGNvZGVnZW4gZGV2ZWxvcG1lbnQgdXNlCiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICB7CiAgICAgICAgaWYgKCghY29tcGlsZWQuZXJyb3JzIHx8ICFjb21waWxlZC5lcnJvcnMubGVuZ3RoKSAmJiBmbkdlbkVycm9ycy5sZW5ndGgpIHsKICAgICAgICAgIHdhcm4kJDEoCiAgICAgICAgICAgICJGYWlsZWQgdG8gZ2VuZXJhdGUgcmVuZGVyIGZ1bmN0aW9uOlxuXG4iICsKICAgICAgICAgICAgZm5HZW5FcnJvcnMubWFwKGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgICB2YXIgZXJyID0gcmVmLmVycjsKICAgICAgICAgICAgICB2YXIgY29kZSA9IHJlZi5jb2RlOwoKICAgICAgICAgICAgICByZXR1cm4gKChlcnIudG9TdHJpbmcoKSkgKyAiIGluXG5cbiIgKyBjb2RlICsgIlxuIik7CiAgICAgICAgICB9KS5qb2luKCdcbicpLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiAoY2FjaGVba2V5XSA9IHJlcykKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBjcmVhdGVDb21waWxlckNyZWF0b3IgKGJhc2VDb21waWxlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gY3JlYXRlQ29tcGlsZXIgKGJhc2VPcHRpb25zKSB7CiAgICAgIGZ1bmN0aW9uIGNvbXBpbGUgKAogICAgICAgIHRlbXBsYXRlLAogICAgICAgIG9wdGlvbnMKICAgICAgKSB7CiAgICAgICAgdmFyIGZpbmFsT3B0aW9ucyA9IE9iamVjdC5jcmVhdGUoYmFzZU9wdGlvbnMpOwogICAgICAgIHZhciBlcnJvcnMgPSBbXTsKICAgICAgICB2YXIgdGlwcyA9IFtdOwoKICAgICAgICB2YXIgd2FybiA9IGZ1bmN0aW9uIChtc2csIHJhbmdlLCB0aXApIHsKICAgICAgICAgICh0aXAgPyB0aXBzIDogZXJyb3JzKS5wdXNoKG1zZyk7CiAgICAgICAgfTsKCiAgICAgICAgaWYgKG9wdGlvbnMpIHsKICAgICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICAgICAgICB2YXIgbGVhZGluZ1NwYWNlTGVuZ3RoID0gdGVtcGxhdGUubWF0Y2goL15ccyovKVswXS5sZW5ndGg7CgogICAgICAgICAgICB3YXJuID0gZnVuY3Rpb24gKG1zZywgcmFuZ2UsIHRpcCkgewogICAgICAgICAgICAgIHZhciBkYXRhID0geyBtc2c6IG1zZyB9OwogICAgICAgICAgICAgIGlmIChyYW5nZSkgewogICAgICAgICAgICAgICAgaWYgKHJhbmdlLnN0YXJ0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZGF0YS5zdGFydCA9IHJhbmdlLnN0YXJ0ICsgbGVhZGluZ1NwYWNlTGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHJhbmdlLmVuZCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGRhdGEuZW5kID0gcmFuZ2UuZW5kICsgbGVhZGluZ1NwYWNlTGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAodGlwID8gdGlwcyA6IGVycm9ycykucHVzaChkYXRhKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIG1lcmdlIGN1c3RvbSBtb2R1bGVzCiAgICAgICAgICBpZiAob3B0aW9ucy5tb2R1bGVzKSB7CiAgICAgICAgICAgIGZpbmFsT3B0aW9ucy5tb2R1bGVzID0KICAgICAgICAgICAgICAoYmFzZU9wdGlvbnMubW9kdWxlcyB8fCBbXSkuY29uY2F0KG9wdGlvbnMubW9kdWxlcyk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBtZXJnZSBjdXN0b20gZGlyZWN0aXZlcwogICAgICAgICAgaWYgKG9wdGlvbnMuZGlyZWN0aXZlcykgewogICAgICAgICAgICBmaW5hbE9wdGlvbnMuZGlyZWN0aXZlcyA9IGV4dGVuZCgKICAgICAgICAgICAgICBPYmplY3QuY3JlYXRlKGJhc2VPcHRpb25zLmRpcmVjdGl2ZXMgfHwgbnVsbCksCiAgICAgICAgICAgICAgb3B0aW9ucy5kaXJlY3RpdmVzCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBjb3B5IG90aGVyIG9wdGlvbnMKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChrZXkgIT09ICdtb2R1bGVzJyAmJiBrZXkgIT09ICdkaXJlY3RpdmVzJykgewogICAgICAgICAgICAgIGZpbmFsT3B0aW9uc1trZXldID0gb3B0aW9uc1trZXldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmaW5hbE9wdGlvbnMud2FybiA9IHdhcm47CgogICAgICAgIHZhciBjb21waWxlZCA9IGJhc2VDb21waWxlKHRlbXBsYXRlLnRyaW0oKSwgZmluYWxPcHRpb25zKTsKICAgICAgICB7CiAgICAgICAgICBkZXRlY3RFcnJvcnMoY29tcGlsZWQuYXN0LCB3YXJuKTsKICAgICAgICB9CiAgICAgICAgY29tcGlsZWQuZXJyb3JzID0gZXJyb3JzOwogICAgICAgIGNvbXBpbGVkLnRpcHMgPSB0aXBzOwogICAgICAgIHJldHVybiBjb21waWxlZAogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGNvbXBpbGU6IGNvbXBpbGUsCiAgICAgICAgY29tcGlsZVRvRnVuY3Rpb25zOiBjcmVhdGVDb21waWxlVG9GdW5jdGlvbkZuKGNvbXBpbGUpCiAgICAgIH0KICAgIH0KICB9CgogIC8qICAqLwoKICAvLyBgY3JlYXRlQ29tcGlsZXJDcmVhdG9yYCBhbGxvd3MgY3JlYXRpbmcgY29tcGlsZXJzIHRoYXQgdXNlIGFsdGVybmF0aXZlCiAgLy8gcGFyc2VyL29wdGltaXplci9jb2RlZ2VuLCBlLmcgdGhlIFNTUiBvcHRpbWl6aW5nIGNvbXBpbGVyLgogIC8vIEhlcmUgd2UganVzdCBleHBvcnQgYSBkZWZhdWx0IGNvbXBpbGVyIHVzaW5nIHRoZSBkZWZhdWx0IHBhcnRzLgogIHZhciBjcmVhdGVDb21waWxlciA9IGNyZWF0ZUNvbXBpbGVyQ3JlYXRvcihmdW5jdGlvbiBiYXNlQ29tcGlsZSAoCiAgICB0ZW1wbGF0ZSwKICAgIG9wdGlvbnMKICApIHsKICAgIHZhciBhc3QgPSBwYXJzZSh0ZW1wbGF0ZS50cmltKCksIG9wdGlvbnMpOwogICAgaWYgKG9wdGlvbnMub3B0aW1pemUgIT09IGZhbHNlKSB7CiAgICAgIG9wdGltaXplKGFzdCwgb3B0aW9ucyk7CiAgICB9CiAgICB2YXIgY29kZSA9IGdlbmVyYXRlKGFzdCwgb3B0aW9ucyk7CiAgICByZXR1cm4gewogICAgICBhc3Q6IGFzdCwKICAgICAgcmVuZGVyOiBjb2RlLnJlbmRlciwKICAgICAgc3RhdGljUmVuZGVyRm5zOiBjb2RlLnN0YXRpY1JlbmRlckZucwogICAgfQogIH0pOwoKICAvKiAgKi8KCiAgdmFyIHJlZiQxID0gY3JlYXRlQ29tcGlsZXIoYmFzZU9wdGlvbnMpOwogIHZhciBjb21waWxlID0gcmVmJDEuY29tcGlsZTsKICB2YXIgY29tcGlsZVRvRnVuY3Rpb25zID0gcmVmJDEuY29tcGlsZVRvRnVuY3Rpb25zOwoKICAvKiAgKi8KCiAgLy8gY2hlY2sgd2hldGhlciBjdXJyZW50IGJyb3dzZXIgZW5jb2RlcyBhIGNoYXIgaW5zaWRlIGF0dHJpYnV0ZSB2YWx1ZXMKICB2YXIgZGl2OwogIGZ1bmN0aW9uIGdldFNob3VsZERlY29kZSAoaHJlZikgewogICAgZGl2ID0gZGl2IHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZGl2LmlubmVySFRNTCA9IGhyZWYgPyAiPGEgaHJlZj1cIlxuXCIvPiIgOiAiPGRpdiBhPVwiXG5cIi8+IjsKICAgIHJldHVybiBkaXYuaW5uZXJIVE1MLmluZGV4T2YoJyYjMTA7JykgPiAwCiAgfQoKICAvLyAjMzY2MzogSUUgZW5jb2RlcyBuZXdsaW5lcyBpbnNpZGUgYXR0cmlidXRlIHZhbHVlcyB3aGlsZSBvdGhlciBicm93c2VycyBkb24ndAogIHZhciBzaG91bGREZWNvZGVOZXdsaW5lcyA9IGluQnJvd3NlciA/IGdldFNob3VsZERlY29kZShmYWxzZSkgOiBmYWxzZTsKICAvLyAjNjgyODogY2hyb21lIGVuY29kZXMgY29udGVudCBpbiBhW2hyZWZdCiAgdmFyIHNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZiA9IGluQnJvd3NlciA/IGdldFNob3VsZERlY29kZSh0cnVlKSA6IGZhbHNlOwoKICAvKiAgKi8KCiAgdmFyIGlkVG9UZW1wbGF0ZSA9IGNhY2hlZChmdW5jdGlvbiAoaWQpIHsKICAgIHZhciBlbCA9IHF1ZXJ5KGlkKTsKICAgIHJldHVybiBlbCAmJiBlbC5pbm5lckhUTUwKICB9KTsKCiAgdmFyIG1vdW50ID0gVnVlLnByb3RvdHlwZS4kbW91bnQ7CiAgVnVlLnByb3RvdHlwZS4kbW91bnQgPSBmdW5jdGlvbiAoCiAgICBlbCwKICAgIGh5ZHJhdGluZwogICkgewogICAgZWwgPSBlbCAmJiBxdWVyeShlbCk7CgogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoZWwgPT09IGRvY3VtZW50LmJvZHkgfHwgZWwgPT09IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkgewogICAgICB3YXJuKAogICAgICAgICJEbyBub3QgbW91bnQgVnVlIHRvIDxodG1sPiBvciA8Ym9keT4gLSBtb3VudCB0byBub3JtYWwgZWxlbWVudHMgaW5zdGVhZC4iCiAgICAgICk7CiAgICAgIHJldHVybiB0aGlzCiAgICB9CgogICAgdmFyIG9wdGlvbnMgPSB0aGlzLiRvcHRpb25zOwogICAgLy8gcmVzb2x2ZSB0ZW1wbGF0ZS9lbCBhbmQgY29udmVydCB0byByZW5kZXIgZnVuY3Rpb24KICAgIGlmICghb3B0aW9ucy5yZW5kZXIpIHsKICAgICAgdmFyIHRlbXBsYXRlID0gb3B0aW9ucy50ZW1wbGF0ZTsKICAgICAgaWYgKHRlbXBsYXRlKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wbGF0ZSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIGlmICh0ZW1wbGF0ZS5jaGFyQXQoMCkgPT09ICcjJykgewogICAgICAgICAgICB0ZW1wbGF0ZSA9IGlkVG9UZW1wbGF0ZSh0ZW1wbGF0ZSk7CiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgICAgICBpZiAoIXRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgd2FybigKICAgICAgICAgICAgICAgICgiVGVtcGxhdGUgZWxlbWVudCBub3QgZm91bmQgb3IgaXMgZW1wdHk6ICIgKyAob3B0aW9ucy50ZW1wbGF0ZSkpLAogICAgICAgICAgICAgICAgdGhpcwogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRlbXBsYXRlLm5vZGVUeXBlKSB7CiAgICAgICAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLmlubmVySFRNTDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgewogICAgICAgICAgICB3YXJuKCdpbnZhbGlkIHRlbXBsYXRlIG9wdGlvbjonICsgdGVtcGxhdGUsIHRoaXMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZWwpIHsKICAgICAgICB0ZW1wbGF0ZSA9IGdldE91dGVySFRNTChlbCk7CiAgICAgIH0KICAgICAgaWYgKHRlbXBsYXRlKSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgaWYgKGNvbmZpZy5wZXJmb3JtYW5jZSAmJiBtYXJrKSB7CiAgICAgICAgICBtYXJrKCdjb21waWxlJyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVmID0gY29tcGlsZVRvRnVuY3Rpb25zKHRlbXBsYXRlLCB7CiAgICAgICAgICBvdXRwdXRTb3VyY2VSYW5nZTogImRldmVsb3BtZW50IiAhPT0gJ3Byb2R1Y3Rpb24nLAogICAgICAgICAgc2hvdWxkRGVjb2RlTmV3bGluZXM6IHNob3VsZERlY29kZU5ld2xpbmVzLAogICAgICAgICAgc2hvdWxkRGVjb2RlTmV3bGluZXNGb3JIcmVmOiBzaG91bGREZWNvZGVOZXdsaW5lc0ZvckhyZWYsCiAgICAgICAgICBkZWxpbWl0ZXJzOiBvcHRpb25zLmRlbGltaXRlcnMsCiAgICAgICAgICBjb21tZW50czogb3B0aW9ucy5jb21tZW50cwogICAgICAgIH0sIHRoaXMpOwogICAgICAgIHZhciByZW5kZXIgPSByZWYucmVuZGVyOwogICAgICAgIHZhciBzdGF0aWNSZW5kZXJGbnMgPSByZWYuc3RhdGljUmVuZGVyRm5zOwogICAgICAgIG9wdGlvbnMucmVuZGVyID0gcmVuZGVyOwogICAgICAgIG9wdGlvbnMuc3RhdGljUmVuZGVyRm5zID0gc3RhdGljUmVuZGVyRm5zOwoKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoY29uZmlnLnBlcmZvcm1hbmNlICYmIG1hcmspIHsKICAgICAgICAgIG1hcmsoJ2NvbXBpbGUgZW5kJyk7CiAgICAgICAgICBtZWFzdXJlKCgidnVlICIgKyAodGhpcy5fbmFtZSkgKyAiIGNvbXBpbGUiKSwgJ2NvbXBpbGUnLCAnY29tcGlsZSBlbmQnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtb3VudC5jYWxsKHRoaXMsIGVsLCBoeWRyYXRpbmcpCiAgfTsKCiAgLyoqCiAgICogR2V0IG91dGVySFRNTCBvZiBlbGVtZW50cywgdGFraW5nIGNhcmUKICAgKiBvZiBTVkcgZWxlbWVudHMgaW4gSUUgYXMgd2VsbC4KICAgKi8KICBmdW5jdGlvbiBnZXRPdXRlckhUTUwgKGVsKSB7CiAgICBpZiAoZWwub3V0ZXJIVE1MKSB7CiAgICAgIHJldHVybiBlbC5vdXRlckhUTUwKICAgIH0gZWxzZSB7CiAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGVsLmNsb25lTm9kZSh0cnVlKSk7CiAgICAgIHJldHVybiBjb250YWluZXIuaW5uZXJIVE1MCiAgICB9CiAgfQoKICBWdWUuY29tcGlsZSA9IGNvbXBpbGVUb0Z1bmN0aW9uczsKCiAgcmV0dXJuIFZ1ZTsKCn0pKTsK"}]},{"name":"Greasyfork Search with Sleazyfork Results include","options":{"awareOfChrome":false,"check_for_updates":true,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["greasyfork.org","sleazyfork.org"],"orig_excludes":[],"orig_includes":["http*://greasyfork.org/*","http*://www.greasyfork.org/*","http*://sleazyfork.org/*","http*://www.sleazyfork.org/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1598513653481,"data":{}},"enabled":true,"position":2,"file_url":"https://greasyfork.org/scripts/23840-greasyfork-search-with-sleazyfork-results-include/code/Greasyfork%20Search%20with%20Sleazyfork%20Results%20include.user.js","uuid":"b8173e42-ceb0-4b8b-858c-0c5fa2877992","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBHcmVhc3lmb3JrIFNlYXJjaCB3aXRoIFNsZWF6eWZvcmsgUmVzdWx0cyBpbmNsdWRlCi8vIEBuYW1lOnpoLUNOICAg5aSn5Lq655qER3JlYXN5Zm9yawovLyBAbmFtZTp6aC1UVyAgIOWkp+S6uueahEdyZWFzeWZvcmsKLy8gQG5hbWU6amEgICAgICDlpKfkurrjga5HcmVhc3lmb3JrCi8vIEBuYW1lc3BhY2UgICAgaG9vdGhpbgovLyBAdmVyc2lvbiAgICAgIDAuODYKLy8gQGRlc2NyaXB0aW9uICBNZXJnZSBhZHVsdCByZXN1bHRzIG9mIHNsZWF6eWZvcmsgaW50byBncmVhc3lmb3JrIHdoZW4gdGhlIHNjcmlwdCBpcyBubyBsb25nZXIgYW5vbnltb3VzbHkgYXZhaWxhYmxlLCBhZGQgcmF0aW5nIHNjb3JlIGFuZCB2ZXJzaW9uIGZvciBzY3JpcHRzIHRoZW4KLy8gQGRlc2NyaXB0aW9uOnpoLUNOIOWcqEdyZWFzeWZvcmvnmoTmkJzntKLnu5PmnpzkuK3mt7vliqBTbGVhenlmb3Jr5LiK55qE5oiQ5Lq66ISa5pys77yM5aKe5Yqg6K+E5YiG5LiO54mI5pys5Y+377yM5bm25Zyo6K6/6Zeu5Yy/5ZCN5LiN5Y+v55So6ISa5pys5pe26Lez6L2s6IezU2xlYXp5Zm9yawovLyBAZGVzY3JpcHRpb246emgtVFcg5ZyoR3JlYXN5Zm9ya+eahOaQnOe0oue1kOaenOS4rea3u+WKoFNsZWF6eWZvcmvkuIrnmoTmiJDkurrohbPmnKzvvIzlop7liqDoqZXliIboiIfniYjmnKzomZ/vvIzkuKblnKjoqKrllY/ljL/lkI3kuI3lj6/nlKjohbPmnKzmmYLot7PovYnoh7NTbGVhenlmb3JrCi8vIEBkZXNjcmlwdGlvbjpqYSAgICDohJrmnKzku5jjgZHjgotTbGVhenlmb3Jr5LiK44Gu5oiQ5Lq66ISa5pys5qSc57Si57WQ5p6c44GL44KJR3JlYXN5Zm9ya+OAgeiEmuacrOS7mOOBkeOCi+aOoeeCueOBqOODkOODvOOCuOODp+ODs+eVquWPt+OCkuioquWVj+WMv+WQjeWIqeeUqOOBp+OBjeOBquOBhOiEmuacrOOBq+OCuOODo+ODs+ODl+OBi+OCiVNsZWF6eWZvcmsKLy8gQGF1dGhvciAgICAgICBob290aGluCi8vIEBpbmNsdWRlICAgICAgaHR0cCo6Ly9ncmVhc3lmb3JrLm9yZy8qCi8vIEBpbmNsdWRlICAgICAgaHR0cCo6Ly93d3cuZ3JlYXN5Zm9yay5vcmcvKgovLyBAaW5jbHVkZSAgICAgIGh0dHAqOi8vc2xlYXp5Zm9yay5vcmcvKgovLyBAaW5jbHVkZSAgICAgIGh0dHAqOi8vd3d3LnNsZWF6eWZvcmsub3JnLyoKLy8gQGdyYW50ICAgICAgICBHTV94bWxodHRwUmVxdWVzdAovLyBAZ3JhbnQgICAgICAgIEdNX3NldFZhbHVlCi8vIEBncmFudCAgICAgICAgR01fZ2V0VmFsdWUKLy8gQGNvbm5lY3QgICAgICBncmVhc3lmb3JrLm9yZwovLyBAY29ubmVjdCAgICAgIHNsZWF6eWZvcmsub3JnCi8vIEBjb250cmlidXRpb25VUkwgaHR0cHM6Ly93d3cucGF5cGFsLmNvbS9jZ2ktYmluL3dlYnNjcj9jbWQ9X2RvbmF0aW9ucyZidXNpbmVzcz1yaXhpeGlAc2luYS5jb20maXRlbV9uYW1lPUdyZWFzeStGb3JrK2RvbmF0aW9uCi8vIEBjb250cmlidXRpb25BbW91bnQgMQovLyA9PS9Vc2VyU2NyaXB0PT0KCihmdW5jdGlvbigpIHsKICAgICd1c2Ugc3RyaWN0JzsKICAgIGlmKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NwYW4uc2lnbi1pbi1saW5rJykpewogICAgICAgIHZhciBvdGhlclNpdGU9L2dyZWFzeWZvcmtcLm9yZy8udGVzdChsb2NhdGlvbi5ob3N0bmFtZSk/InNsZWF6eWZvcmsiOiJncmVhc3lmb3JrIjsKICAgICAgICBpZigvc2NyaXB0c1wvXGQrLy50ZXN0KGxvY2F0aW9uLmhyZWYpKXsKICAgICAgICAgICAgaWYoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzY3JpcHQtaW5mbyIpICYmIChvdGhlclNpdGUgPT0gImdyZWFzeWZvcmsiIHx8IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImRpdi53aWR0aC1jb25zdHJhaW50PnNlY3Rpb24+cD5hIikpKXsKICAgICAgICAgICAgICAgIGxvY2F0aW9uLmhyZWY9bG9jYXRpb24uaHJlZi5yZXBsYWNlKC9cL1wvKFteXC5dK1wuKT8oZ3JlYXN5Zm9ya3xzbGVhenlmb3JrKVwub3JnLywiLy8kMSIrb3RoZXJTaXRlKyJcLm9yZyIpOwogICAgICAgICAgICB9CiAgICAgICAgfWVsc2UgaWYoL1wvKHNjcmlwdHN8dXNlcnMpKFwvfC4qKFw/fCYpcT18LipcP3NldD0pLy50ZXN0KGxvY2F0aW9uLmhyZWYpKXsKICAgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QoewogICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICAgIHVybDogbG9jYXRpb24uaHJlZi5yZXBsYWNlKC9cL1wvKFteXC5dK1wuKT8oZ3JlYXN5Zm9ya3xzbGVhenlmb3JrKVwub3JnLywiLy8kMSIrb3RoZXJTaXRlKyJcLm9yZyIpLAogICAgICAgICAgICAgICAgb25sb2FkOiBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZG9jID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBkb2MgPSBkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVIVE1MRG9jdW1lbnQoJycpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2MuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTCA9IHJlc3VsdC5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwYXJzZSBlcnJvcicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWRvYykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBsID0gZG9jLnF1ZXJ5U2VsZWN0b3IoJ29sLnNjcmlwdC1saXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignb2wuc2NyaXB0LWxpc3QnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW1sKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1sPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9sIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtbC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwic2NyaXB0LWxpc3QiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaXN0PWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaWRlYmFycmVkLW1haW4tY29udGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBzPWxpc3QucXVlcnlTZWxlY3RvckFsbCgicCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7aTxwcy5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcD1wc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LnJlbW92ZUNoaWxkKHApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5hcHBlbmRDaGlsZChtbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjcz1sLnF1ZXJ5U2VsZWN0b3JBbGwoImxpIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNjcyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDtpPHNjcy5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2M9c2NzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFtbC5xdWVyeVNlbGVjdG9yKCJsaVtkYXRhLXNjcmlwdC1pZD0nIitzYy5nZXRBdHRyaWJ1dGUoImRhdGEtc2NyaXB0LWlkIikrIiddIikpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRTY29yZShzYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1sLmFwcGVuZENoaWxkKHNjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25lcnJvcjogZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBhZGRTY29yZShzY3JpcHQpewogICAgICAgIHZhciBzZXBhcmF0b3I9c2NyaXB0LnF1ZXJ5U2VsZWN0b3IoJ2gyPnNwYW4ubmFtZS1kZXNjcmlwdGlvbi1zZXBhcmF0b3InKTsKICAgICAgICB2YXIgZGVzY3JpcHRpb249c2NyaXB0LnF1ZXJ5U2VsZWN0b3IoJ2gyPnNwYW4uZGVzY3JpcHRpb24nKTsKICAgICAgICBpZihzZXBhcmF0b3IpewogICAgICAgICAgICB2YXIgc2NvcmU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3Ryb25nIik7CiAgICAgICAgICAgIHNjb3JlLnN0eWxlLmNvbG9yPSIjZTA5MDE1IjsKICAgICAgICAgICAgc2NvcmUuaW5uZXJIVE1MPXNjcmlwdC5nZXRBdHRyaWJ1dGUoImRhdGEtc2NyaXB0LXJhdGluZy1zY29yZSIpOwogICAgICAgICAgICBzZXBhcmF0b3IucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2NvcmUsc2VwYXJhdG9yKTsKICAgICAgICB9CiAgICAgICAgaWYoZGVzY3JpcHRpb24pZGVzY3JpcHRpb24uaW5uZXJIVE1MKz0iPHN0cm9uZz5WZXIuIitzY3JpcHQuZ2V0QXR0cmlidXRlKCJkYXRhLXNjcmlwdC12ZXJzaW9uIikrIjwvc3Ryb25nPiIrJzxkaXYgaWQ9Imluc3RhbGwtYXJlYSIgc3R5bGU9ImRpc3BsYXk6bm9uZTtmbG9hdDogcmlnaHQ7cG9zaXRpb246IHJlbGF0aXZlOyI+PGEgY2xhc3M9Imluc3RhbGwtbGluayIgaHJlZj0iJytzY3JpcHQucXVlcnlTZWxlY3RvcignaDI+YScpLmhyZWYucmVwbGFjZSgvKFxkKS0uKi8sIiQxIikrJy9jb2RlL3NjcmlwdC51c2VyLmpzIj5JbnN0YWxsPC9hPjwvZGl2Pic7CiAgICAgICAgdmFyIGluc3RhbGxBcmVhPXNjcmlwdC5xdWVyeVNlbGVjdG9yKCIjaW5zdGFsbC1hcmVhIik7CiAgICAgICAgaWYoaW5zdGFsbEFyZWEpewogICAgICAgICAgICBzY3JpcHQub25tb3VzZW92ZXI9ZnVuY3Rpb24oZSl7CiAgICAgICAgICAgICAgICBpbnN0YWxsQXJlYS5zdHlsZS5kaXNwbGF5PSJibG9jayI7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHNjcmlwdC5vbm1vdXNlb3V0PWZ1bmN0aW9uKGUpewogICAgICAgICAgICAgICAgaW5zdGFsbEFyZWEuc3R5bGUuZGlzcGxheT0ibm9uZSI7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgdmFyIHNvcnREaXY9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI3NjcmlwdC1saXN0LXNvcnQiKTsKICAgIGlmKHNvcnREaXYpewogICAgICAgIHZhciBzd2l0Y2hGaWx0ZXI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksZW5hYmxlRmlsdGVyPSFHTV9nZXRWYWx1ZSgiZGlzYWJsZUZpbHRlciIpOwogICAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93Lk1vek11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24ocmVjb3Jkcyl7CiAgICAgICAgICAgIHJlY29yZHMubWFwKGZ1bmN0aW9uKHJlY29yZCkgewogICAgICAgICAgICAgICAgZm9yKHZhciBpPTA7aTxyZWNvcmQuYWRkZWROb2Rlcy5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgICAgICAgICB2YXIgY3VyTm9kZT1yZWNvcmQuYWRkZWROb2Rlc1tpXTsKICAgICAgICAgICAgICAgICAgICBpZihjdXJOb2RlLmNsYXNzTmFtZT09InNjcmlwdC1saXN0Iil7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JpcHRzPWN1ck5vZGUucXVlcnlTZWxlY3RvckFsbCgnbGknKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7aTxzY3JpcHRzLmxlbmd0aDtpKyspewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNjcmlwdD1zY3JpcHRzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkU2NvcmUoc2NyaXB0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZihlbmFibGVGaWx0ZXIpZmlsdGVyKGN1ck5vZGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyIG9wdGlvbiA9IHsKICAgICAgICAgICAgJ2NoaWxkTGlzdCc6IHRydWUKICAgICAgICB9OwogICAgICAgIG9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYm9keT4ud2lkdGgtY29uc3RyYWludCAuc2lkZWJhcnJlZC1tYWluLWNvbnRlbnQiKSwgb3B0aW9uKTsKICAgICAgICB2YXIgc2NyaXB0cz1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdvbC5zY3JpcHQtbGlzdD5saScpOwogICAgICAgIGZvcihsZXQgaT0wO2k8c2NyaXB0cy5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgbGV0IHNjcmlwdD1zY3JpcHRzW2ldOwogICAgICAgICAgICBhZGRTY29yZShzY3JpcHQpOwogICAgICAgIH0KICAgICAgICAvL01vZGlmeSBmcm9tIEdyZWFzeUZvcmsgQnVsbHNoaXQgRmlsdGVyLFRoYW5rcyB0byBkYXJrcmVkCiAgICAgICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICBzdHlsZS50ZXh0Q29udGVudCA9ICdsaS5maWx0ZXJlZCB7IGRpc3BsYXk6bm9uZSAhaW1wb3J0YW50OyB9JzsKICAgICAgICBzdHlsZS50eXBlID0gJ3RleHQvY3NzJzsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkJykuYXBwZW5kQ2hpbGQoc3R5bGUpOwogICAgICAgIHZhciBidWxsc2hpdD0idmlwLirop4bpopF855m+5bqmKOS6kXznvZHnm5gpfEFudGlHYW1lfHNwbGl0fEFnYXJ8YWdhclwuaW98YWxpc1wuaW98YW5nZWxcLmlvfEV4dGVuY2lvblJpcFhDaGV0b01hbG98QXBvc0JvdHxERnhMaXRlfFpUeC1MaXRlfEFwb3NGZWVkaW5nQm90fEFwb3NMb2FkZXJ8QmxhaCBCbGFofE9yYyBDbGFuIFNjcmlwdHxBc3Ryb1xzKkVtcGlyZXN8XlxzKkF0dGFja3xeXHMqQmF0dGxlfEJpdGVGaWdodHxCbG9vZFxzKldhcnN8Qm90c3xCb3RzNHxCcmF3bGVyfFxiQnZTXGJ8QnVzaW5lc3NccypUeWNvb258Q2FzdGxlXHMqQWdlfENpdHlccypWaWxsZXxjaG9wY29pblwuaW98Q29tdW5pb3xDb25xdWVyXHMqQ2x1YnxDb3Ntb1B1bHNlfGN1cnNvcnNcLmlvfERhcmtccypPcmJpdHxEZWFkXHMqRnJvbnRpZXJ8RGllcFwuaW98XGJET0FcYnxkb2Jsb25zXC5pb3xEb3REfERvc3NlcmdhbWV8RHJhZ29uc1xzKm9mXHMqQXRsYW50aXN8ZHJpZnRpblwuaW98RHVnb3V0fFxiRFNbYS16XStcbnxlbGl0ZXNcLmlvfEVtcGlyZVxzKkJvYXJkfGVSZXAodWJsaWspP3xFcGljLipXYXJ8RXhvUGxhbmV0fEZhbGNvbiBUb29sc3xGZXVlcndhY2hlfEZhcm1pbmd8RmFybVZpbGxlfEZpZ2h0aW5mb3xGcm9udGllclxzKlZpbGxlfEdob3N0XHMqVHJhcHBlcnxHbGFkaWF0dXN8R29hbGxpbmV8R29uZGFsfGdvdGFcLmlvfEdyZXBvbGlzfEhvYm9wb2xpc3xcYmh3bShcYnxfKXxJa2FyaWFtfFxiSVQyXGJ8SmVsbHluZW98S2FwaVxzKkhvc3BpdGFsfEtpbmdzXHMqQWdlfEtpbmdkb21zP1xzKm9mfGtuYXN0dijDtnxvZSlnZWx8S25pZ2h0XHMqRmlnaHR8XGIoUG93ZXIpP0tvQyhBdHRhP2NrKT9cYnxcYktPTFxifEtvbmdyZWdhdGV8TGFzdFxzKkVtcGVyb3J8TGVnZW5kcz9ccypvZnxMaWdodFxzKlJpc2luZ3xsaXRlXC5leHRcLmlvfExvY2tlcnp8XGJMb1VcYnxNYWZpYVxzKihXYXJzfE1vZm8pfE1lbmVsZ2FtZXxNb2JccypXYXJzfE1vdXNlXHMqSHVudHxNb2xlaGlsbFxzKkVtcGlyZXxOZW9RdWVzdHxNeUZyZWVGYXJtfG5hcndoYWxlXC5pb3xOZW9wZXRzfE5lbWV4aWF8XGJPR2FtZVxifE9nYXIoaW8pP3xQYXJkdXN8UGVubmVyZ2FtZXxQaWdza2luXHMqRW1waXJlfFBsYXllclNjcmlwdHN8cG9rZXJhZGFyXC5pb3xQb3BtdW5kb3xQbz93ZT9yXHMqKEJvdHxUb29scyl8UHNpY29UU0l8UmF2ZW53b29kfFNjaHVsdGVyZ2xhdHplfHNsaXRoZXJcLmlvfHNsaXRoZXJwbHVzXC5pb3xzbGl0aGVyaW9nYW1lcGxheXxTcGFjZVdhcnN8c3BsaXhcLmlvfFxiU1dfW2Etel0rXG58XGJTblBcYnxUaGVccypDcmltc3xUaGVccypXZXN0fHRvcnRvXC5pb3xUcmF2aWFufFRyZWFzdXJlXHMqSXNsKGFuZHxlKXxUcmliYWxccypXYXJzfFRXLj9QUk98VmFtcGlyZVxzKldhcnN8dmVydGl4XC5pb3xXYXJccypvZlxzKk5pbmphfFdlc3RccypXYXJzfHdpbmdzXC5pb3xcYldvRFxifFdvcmxkXHMqb2ZccypEdW5nZW9uc3x3dGZccypiYXR0bGVzfFd1cnplbGltcGVyaXVtIjsKICAgICAgICB2YXIgZmlsdGVyTmFtZT0iRW5hYmxlIEZpbHRlciIsZmlsdGVyZWROdW09MDsKICAgICAgICB2YXIgZmlsdGVyPWZ1bmN0aW9uKHQpewogICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwodC5xdWVyeVNlbGVjdG9yQWxsKCdhcnRpY2xlPmgyJyksIGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmKG5ldyBSZWdFeHAoYnVsbHNoaXQsImkiKS50ZXN0KGl0ZW0uaW5uZXJUZXh0KSl7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnZmlsdGVyZWQnKTsKICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZE51bSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIGlmKGVuYWJsZUZpbHRlcilmaWx0ZXIoZG9jdW1lbnQpOwogICAgICAgIHN3aXRjaEZpbHRlci5pbm5lckhUTUw9JzxpbnB1dCB0eXBlPSJjaGVja0JveCIgbmFtZT0ic3dpdGNoRmlsdGVyIiBpZD0ic3dpdGNoRmlsdGVyIi8+PGxhYmVsIGZvcj0ic3dpdGNoRmlsdGVyIj4nK2ZpbHRlck5hbWUrKGZpbHRlcmVkTnVtPycgKCcrZmlsdGVyZWROdW0rJyBmaWx0ZXJlZCknOicnKSsnPC9sYWJlbD4nOwogICAgICAgIHZhciBzd2l0Y2hGaWx0ZXJDaGVja2JveD1zd2l0Y2hGaWx0ZXIucXVlcnlTZWxlY3RvcignI3N3aXRjaEZpbHRlcicpOwogICAgICAgIHZhciBzd2l0Y2hGaWx0ZXJMYWJlbD1zd2l0Y2hGaWx0ZXJDaGVja2JveC5uZXh0U2libGluZzsKICAgICAgICBzd2l0Y2hGaWx0ZXJDaGVja2JveC5jaGVja2VkPWVuYWJsZUZpbHRlcjsKICAgICAgICBzd2l0Y2hGaWx0ZXJDaGVja2JveC5vbmNsaWNrPWZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGlmKGVuYWJsZUZpbHRlcil7CiAgICAgICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnbGkuZmlsdGVyZWQnKSwgZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnZmlsdGVyZWQnKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc3dpdGNoRmlsdGVyTGFiZWwuaW5uZXJIVE1MPWZpbHRlck5hbWU7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgZmlsdGVyZWROdW09MDsKICAgICAgICAgICAgICAgIGZpbHRlcihkb2N1bWVudCk7CiAgICAgICAgICAgICAgICBzd2l0Y2hGaWx0ZXJMYWJlbC5pbm5lckhUTUw9ZmlsdGVyTmFtZSsnICgnK2ZpbHRlcmVkTnVtKycgZmlsdGVyZWQpJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBHTV9zZXRWYWx1ZSgiZGlzYWJsZUZpbHRlciIsZW5hYmxlRmlsdGVyKTsKICAgICAgICAgICAgZW5hYmxlRmlsdGVyPSFlbmFibGVGaWx0ZXI7CiAgICAgICAgfTsKICAgICAgICBzb3J0RGl2Lmluc2VydEJlZm9yZShzd2l0Y2hGaWx0ZXIsc29ydERpdi5maXJzdENoaWxkKTsKICAgIH0KfSkoKTs="},{"name":"🔥持续更新🔥 CSDN广告完全过滤、人性化脚本优化：🆕 不用再登录了！让你体验令人惊喜的崭新CSDN。","options":{"awareOfChrome":false,"check_for_updates":true,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["www.csdn.net"],"orig_excludes":[],"orig_includes":["*://*.csdn.net/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1598513668513,"data":{}},"enabled":true,"position":3,"file_url":"https://greasyfork.org/zh-CN/scripts/378351/code/script.user.js","uuid":"9186a8d5-53a7-4bb3-bc5c-2de95ebf8450","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICDwn5Sl5oyB57ut5pu05paw8J+UpSBDU0RO5bm/5ZGK5a6M5YWo6L+H5ruk44CB5Lq65oCn5YyW6ISa5pys5LyY5YyW77ya8J+GlSDkuI3nlKjlho3nmbvlvZXkuobvvIHorqnkvaDkvZPpqozku6Tkurrmg4rllpznmoTltK3mlrBDU0RO44CCCi8vIEBuYW1lc3BhY2UgICAgaHR0cHM6Ly9naXRodWIuY29tL2FkbGVyZWQKLy8gQHZlcnNpb24gICAgICAzLjQuMwovLyBAZGVzY3JpcHRpb24gIOKaoe+4j+aLpeacieaVsOmhueeLrOWutuWKn+iDveeahOacgOW8ukNTRE7ohJrmnKzvvIzkuI3mnI3mr5TkuIDmr5TimqHvuI988J+VtuaXoOmcgOeZu+W9lUNTRE7vvIzojrflvpfmr5TkvJrlkZjmm7TkvbPnmoTkvZPpqox88J+WpeWIhui+qOeOh+iHqumAgumFje+8jOWIhuWxj+S4jeeUqOa7muWKqHzwn5K+6LaF57qn6aKE5LyY5YyWfPCflJbni6zlrrbotoXnuqflhY3kvJrlkZh88J+Pt+eLrOWutuWOn+WIm+aWh+eroOWFjeeZu+W9leWxleW8gHzwn5SM54us5a625o6o6I2Q5YaF5a656Ieq55Sx5byA5YWzfPCfk6Dni6zlrrblhY3nmbvlvZXlpI3liLZ88J+Ul+eLrOWutumYsuWklumTvumHjeWumuWQkXzwn5Od54us5a626K665Z2b5pyq55m75b2V6Ieq5Yqo5bGV5byA5paH56ug44CB6K+E6K66fPCfjLXlhajpnaLlh4DljJZ88J+TiOayiea1uOmYheivu3zwn6e05YeA5YyW5Ymq6LS05p2/fPCfk5XkvZzogIXkv6Hmga/mlofnq6Dpobbpg6jlsZXnpLoKLy8gQGF1dGhvciAgICAgICBBZGxlcgovLyBAY29ubmVjdCAgICAgIHd3dy5jc2RuLm5ldAovLyBAaW5jbHVkZSAgICAgICo6Ly8qLmNzZG4ubmV0LyoKLy8gQHJlcXVpcmUgICAgICBodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2pxdWVyeS5jb29raWUvanF1ZXJ5LmNvb2tpZS5qcwovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbnByb2dyZXNzQDAuMi4wL25wcm9ncmVzcy5qcwovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vY2xpcGJvYXJkQDIuMC42L2Rpc3QvY2xpcGJvYXJkLm1pbi5qcwovLyBAc3VwcG9ydFVSTCAgIGh0dHBzOi8vZ2l0aHViLmNvbS9hZGxlcmVkL0NTRE5HcmVlbmVyL2lzc3Vlcy9uZXc/YXNzaWduZWVzPWFkbGVyZWQmbGFiZWxzPWhlbHArd2FudGVkJnRlbXBsYXRlPUlTU1VFX1RFTVBMQVRFLm1kJnRpdGxlPQovLyBAY29udHJpYnV0aW9uVVJMIGh0dHBzOi8vZG9jLnN0YWNrb3ZlcmZsb3cud2lraS93ZWIvIy8yMT9wYWdlX2lkPTEzOAovLyBAZ3JhbnQgICAgICAgIEdNX2FkZFN0eWxlCi8vIEBub3RlICAgICAgICAgMjAtMTAtMjMgMy40LjMg6YCC5bqU5paw54mIQ1NETu+8jOWOu+mZpOS4u+mhteWSjOeZu+W9lemhteW5v+WRiu+8jOS7peWPiueZu+W9leaPkOekuu+8jOW5tuenu+mZpOW6lemDqOS/oeaBrwovLyBAbm90ZSAgICAgICAgIDIwLTEwLTIwIDMuNC4yIOWIoOmZpOWPs+S+p+W5v+WRigovLyBAbm90ZSAgICAgICAgIDIwLTA5LTI2IDMuNC4xIOS/ruaUueaOkueJiOiuvuWumu+8jOS/ruWkjeeZu+W9leahhuW8ueWHuueahOmXrumimAovLyBAbm90ZSAgICAgICAgIDIwLTA5LTI0IDMuNC4wIOe0p+aApeS/ruWkjeeUseS6jkNTRE7liY3nq6/moLflvI/kv67mlLnlr7zoh7Torr7lrprlvIDlhbPkuKLlpLHnmoTpl67popgKLy8gQG5vdGUgICAgICAgICAyMC0wOC0yNyAzLjMuOSDntKfmgKXkv67lpI3nlLHkuo5DU0RO5YmN56uv5qC35byP5L+u5pS55a+86Ie06ISa5pys5aSx5pWI55qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMjAtMDgtMjYgMy4zLjgg5ZCI5rOV6ISa5pys5o+Q56S6Ci8vIEBub3RlICAgICAgICAgMjAtMDctMjAgMy4zLjcg5L+u5aSN6I+c5Y2V5qCP5Zyo5Yib5L2c5Lit5b+D5pi+56S65byC5bi455qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMjAtMDctMTggMy4zLjYg5bel5YW3566x5oyJ6ZKu5LyY5YyWCi8vIEBub3RlICAgICAgICAgMjAtMDctMDUgMy4zLjUg6K+E6K665aSN5Yi25Yqf6IO95Lqk5LqS5LyY5YyWCi8vIEBub3RlICAgICAgICAgMjAtMDctMDQgMy4zLjQg5L+u5aSN5Y+z5L6n5qCP5raI5aSx55qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMjAtMDctMDMgMy4zLjMg5paw5aKe5aSN5Yi26K+E6K665Yqf6IO977yB5Yig6Zmk6aG26YOo5bm/5ZGKCi8vIEBub3RlICAgICAgICAgMjAtMDYtMjggMy4zLjIg5o+Q56S65L+u5pS5Ci8vIEBub3RlICAgICAgICAgMjAtMDYtMjcgMy4zLjEg5by556qX5o+Q56S66YC76L6R5L+u5pS55Li65LuF5o+Q56S65LiA5qyh44CCCi8vIEBub3RlICAgICAgICAgMjAtMDYtMjcgMy4zLjAg572R56uZ5qCH6aKY5paw5raI5oGv5o+Q6YaS5Y676ZmkCi8vIEBub3RlICAgICAgICAgMjAtMDYtMjYgMy4yLjkg5oGi5aSNR3JlYXN5Rm9ya+W5s+WPsOiEmuacrOaUr+aMgQovLyBAbm90ZSAgICAgICAgIDIwLTA2LTIxIDMuMi4wIOiEmuacrOi/geenu+mAmuefpQovLyBAbm90ZSAgICAgICAgIDIwLTA2LTIxIDMuMS45IOWinuWKoOiHquWKqOmakOiXj+W6leagj+WKn+iDvQovLyBAbm90ZSAgICAgICAgIDIwLTA2LTIxIDMuMS44IOWinuWKoOiHquWKqOmakOiXj+mhtuagj+WKn+iDve+8jOS/ruWkjemAiemhueeql+WPo+iiq+eCuei1numVv+adoeaMoeS9j+eahEJ1Z++8jOmAiemhueeql+WPo+W4g+WxgOS/ruaUuQovLyBAbm90ZSAgICAgICAgIDIwLTA2LTIwIDMuMS43IOiuvue9rueql+WPo+Wkp+Wwj+WbuuWumu+8jOWinuWKoOaJk+i1j+WFpeWPowovLyBAbm90ZSAgICAgICAgIDIwLTA2LTE5IDMuMS42IOaYvuekuuaOqOiNkOWGheWuueaMiemSruWbnuW9ku+8jOaWsOW4g+WxgOe0p+aApeS/ruWkjQovLyBAbm90ZSAgICAgICAgIDIwLTA2LTE4IDMuMS41IOiHquWumuS5ieWKn+iDveabtOaWsAovLyBAbm90ZSAgICAgICAgIDIwLTA2LTE2IDMuMS40IOaUr+aMgeWkp+mDqOWIhuWKn+iDveaooeWdl+WMluaYvuekugovLyBAbm90ZSAgICAgICAgIDIwLTA2LTE0IDMuMS4zIOe7v+WMluiuvuWumuS8mOWMlgovLyBAbm90ZSAgICAgICAgIDIwLTA2LTE0IDMuMS4yIElTU1VF5qih5p2/6LCD5pW0U3VwcG9ydCBVUkwKLy8gQG5vdGUgICAgICAgICAyMC0wNi0xNCAzLjEuMSDlop7liqDmkJzljZrkuLvmlofnq6DmqKHlnZcKLy8gQG5vdGUgICAgICAgICAyMC0wNi0xMyAzLjEuMCDkv67lpI3orr7nva7ov4fmnJ/nmoTpl67popgKLy8gQG5vdGUgICAgICAgICAyMC0wNi0xMiAzLjAuOSDmoIfpopjlm57mu5oKLy8gQG5vdGUgICAgICAgICAyMC0wNi0xMiAzLjAuOCDkuLvpobXlub/lkYrliKDpmaTvvIznu7/ljJborr7nva7ku4XmmL7npLrlnKjmlofnq6DpobXpnaLvvIzliKDpmaTpobXohJrvvIzpobbpg6jkvJjljJbvvIzoi6XlubLnu4boioLkvJjljJYKLy8gQG5vdGUgICAgICAgICAyMC0wNi0xMSAzLjAuNyDlop7liqDlrpjmlrlRUeS6pOa1gee+pO+8jOWinuWKoOWFs+mXreW8uuWItueZveiJsuS4u+mimOWKn+iDvQovLyBAbm90ZSAgICAgICAgIDIwLTA2LTExIDMuMC42IOeUqOaIt+WQjeeJh+WKn+iDveS8mOWMlgovLyBAbm90ZSAgICAgICAgIDIwLTA2LTExIDMuMC41IOS8mOWMluWKoOi9vemAn+W6pgovLyBAbm90ZSAgICAgICAgIDIwLTA2LTEwIDMuMC40IOS/ruWkjeiuvue9rueVjOmdoumBruaMoeeahOmXrumimO+8jOaYvuekuuWNmuS4u+WktOWDjwovLyBAbm90ZSAgICAgICAgIDIwLTA2LTA5IDMuMC4zIOm7mOiupOiuvuWumuS/ruaUuQovLyBAbm90ZSAgICAgICAgIDIwLTA2LTA5IDMuMC4yIOS/ruWkjeaOqOiNkOWGheWuueaMiemSruWIt+aWsOS4jeeUn+aViOeahOmXrumimO+8jOWinuWKoOW3peWFt+euseaPkOekuuahhgovLyBAbm90ZSAgICAgICAgIDIwLTA2LTA4IDMuMC4xIOiuvue9ruS4reW/g+aOqOWHuu+8geWinuWKoOa1j+iniOaViOaenOmAiemhuSAmJiBHcmVlbiBCb29rIEljb24gVXBkYXRlCi8vIEBub3RlICAgICAgICAgMjAtMDYtMDggMy4wLjAg6K6+572u5Lit5b+D5o6o5Ye677yB5aKe5Yqg5rWP6KeI5pWI5p6c6YCJ6aG5Ci8vIEBub3RlICAgICAgICAgMjAtMDYtMDcgMi40LjIg6K6+572u6Kej6ICm77yM5LiL5Liq54mI5pys5pCe6YWN572u5Lit5b+DCi8vIEBub3RlICAgICAgICAgMjAtMDYtMDYgMi40LjEg5L+u5aSN5paH56ug5YaF5a655raI5aSx55qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMjAtMDYtMDQgMi40LjAg5L+u5aSN5o6o6I2Q5oyJ6ZKu6ZSZ5L2N55qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMjAtMDYtMDQgMi4zLjkg56qE5bGP6YCC6YWN5LyY5YyWCi8vIEBub3RlICAgICAgICAgMjAtMDYtMDQgMi4zLjgg6buR5aSc5qih5byP5Ye6546w6Zeu6aKY77yM57Sn5oCl5Zue5qGj5YiwIDIuMy42Ci8vIEBub3RlICAgICAgICAgMjAtMDYtMDMgMi4zLjcg5oSf6LCiIEBBbGV4TFdUIOWinuWKoOm7keaal+aooeW8jwovLyBAbm90ZSAgICAgICAgIDIwLTA2LTAyIDIuMy42IEFkc0J5R29vZ2xlIOWIoOmZpAovLyBAbm90ZSAgICAgICAgIDIwLTA1LTI1IDIuMy41IOaEn+iwoiBAUnlhbklQTyDkv67lpI0gQ2Fubm90IHJlYWQgcHJvcGVydHkgJ3JlcGxhY2UnIG9mIHVuZGVmaW5lZCDmiqXplJnnmoTpl67popgKLy8gQG5vdGUgICAgICAgICAyMC0wNS0yNCAyLjMuNCDkv67lpI3lhY3nmbvlvZXlpI3liLblip/og70KLy8gQG5vdGUgICAgICAgICAyMC0wNS0yMiAyLjMuMyBMb2dv5LiO6IOM5pmv5ZCM5q2lCi8vIEBub3RlICAgICAgICAgMjAtMDUtMjIgMi4zLjIg5rex5bqm5Yig6Zmk6IOM5pmvCi8vIEBub3RlICAgICAgICAgMjAtMDUtMjAgMi4zLjEg6YCa6L+HcmVxdWlyZeS9v+eUqE5Qcm9ncmVzcwovLyBAbm90ZSAgICAgICAgIDIwLTA1LTIwIDIuMy4wIOaYvuekuuaOqOiNkOWGheWuueaMiemSruagt+W8j+WGhee9ru+8jOWJlOmZpENETgovLyBAbm90ZSAgICAgICAgIDIwLTA1LTE3IDIuMi45IOi/m+W6puadoeagt+W8j+abtOaWsO+8jOaXtumXtOW7tuaXtuS8mOWMlgovLyBAbm90ZSAgICAgICAgIDIwLTA1LTE3IDIuMi44IOabtOaWsOiEmuacrOaPj+i/sO+8jOWxleW8gOivhOiuuueahOaJgOacieWbnuWkje+8jOWIoOmZpOWIm+S9nOS4reW/g+aMiemSru+8jOWKoOi9vei/m+W6puadoQovLyBAbm90ZSAgICAgICAgIDIwLTA1LTE3IDIuMi43IOabtOaWsOiEmuacrOaPj+i/sAovLyBAbm90ZSAgICAgICAgIDIwLTA1LTE2IDIuMi42IOS/ruWkjeesrOS4gOasoeeCueWHu+aYvuekuuaOqOiNkOWGheWuueaXoOWPjeW6lOeahOmXrumimAovLyBAbm90ZSAgICAgICAgIDIwLTA1LTE2IDIuMi41IOWIoOmZpOaKouaymeWPkeinkuagh++8jOS/ruaUueaYvuekuuaOqOiNkOWGheWuueaMiemSruagt+W8jwovLyBAbm90ZSAgICAgICAgIDIwLTA1LTE2IDIuMi40IOaEn+iwouadpeiHqkdpdEh1YueahOaci+WPi+KAnEhlcm9uWmhhbmfigJ3nmoRJc3N1ZeW7uuiuru+8jOWIoOmZpOaJgOacieWNmuWuouiKsemHjOiDoeWTqOeahOiDjOaZr++8jOS4u+mhteWIhuexu+S4reW5v+WRiua4hemZpO+8jENTU+agt+W8j+aOp+WItuWuveW6pumAgumFjeS7o+eggeS8mOWMlgovLyBAbm90ZSAgICAgICAgIDIwLTA1LTE2IDIuMi4zIOaEn+iwouadpeiHqkdpdEh1YueahOaci+WPi+KAnFJldGlyZWRXb3JsZOKAneeahOS7o+eggei0oeeMru+8jOS9v+eUqENTU+adpeaOp+WItuagt+W8j++8jOiAjOS4jeaYr0pT77yM5aKe5aSn54G15rS75oCn44CCCi8vIEBub3RlICAgICAgICAgMjAtMDUtMTMgMi4yLjIg5bGP6JS95oKo55qE57yp5pS+5LiN5pivMTAwJeeahOaPkOekugovLyBAbm90ZSAgICAgICAgIDIwLTA0LTI5IDIuMi4xIOaEn+iwouWkp+WutueahOaUr+aMge+8jOWinuWKoOebruW9leaYvuekuu+8jOiHquWKqOWIpOaWreaYr+WQpuWtmOWcqOebruW9leiwg+aVtOmhtemdouWuveW6pu+8jOWxj+iUveaWsOWinuW5v+WRiu+8jOasoui/juWkp+WutuS9k+mqjOW5tuaPkOWHuuaEj+inge+8gQovLyBAbm90ZSAgICAgICAgIDIwLTA0LTE1IDIuMi4wIOS4gOS6m+W5v+WRiuiiq+WFtuS7luaPkuS7tuWxj+iUveWvvOiHtOeahOW8guW4uOaXoOinhuS5iwovLyBAbm90ZSAgICAgICAgIDIwLTAzLTMwIDIuMS45IOW5suaOieKAnOiusOW9leS9oOeahOWIm+S9nOWOhueoi+KAne+8jOW5suaOieacqueZu+W9leaDheWGteS4i+eahOinkuagh+aPkOmGkgovLyBAbm90ZSAgICAgICAgIDIwLTAzLTEzIDIuMS44IOeqhOWxj+mAgumFjeWKoOW8ugovLyBAbm90ZSAgICAgICAgIDIwLTAzLTEzIDIuMS43IOabtOaWsOeugOS7iwovLyBAbm90ZSAgICAgICAgIDIwLTAzLTEyIDIuMS42IOWuveW6puiHqumAguW6lO+8iOaEn+iwouadpeiHqkdpdEh1YueahOaci+WPi0xlb25HN+eahOW7uuiuru+8ie+8geS/ruWkjeWJqui0tOadv+WHgOWMluaXoOaViOeahOmXrumimOOAggovLyBAbm90ZSAgICAgICAgIDIwLTAzLTA0IDIuMS41IOmAgumFjUFkR3VhcmQKLy8gQG5vdGUgICAgICAgICAyMC0wMi0yNyAyLjEuNCDkvJjljJblhY3nmbvlvZXlpI3liLYKLy8gQG5vdGUgICAgICAgICAyMC0wMi0yNSAyLjEuMyDlhY3nmbvlvZXlpI3liLbmm7TmlrDvvIznjrDlt7Llj6/nlKgKLy8gQG5vdGUgICAgICAgICAyMC0wMi0yNCAyLjEuMiBCeSBHaXRodWJASmFsaW5XYW5nIOabtOaUueWOu+mZpOWJqui0tOadv+WKq+aMgeeahOaWueW8j++8jOS9v+W+l+WOn+aWh+agvOW8j+WcqOWkjeWItuaXtuiDveWkn+S/neeVmQovLyBAbm90ZSAgICAgICAgIDIwLTAyLTIyIDIuMS4xIOe0p+aApeS/ruWkjeeUseS6jiBDU0ROIOS/ruaUueWJjeerr+e7k+aehOWvvOiHtOeahOaWh+eroOmUmeS9jQovLyBAbm90ZSAgICAgICAgIDIwLTAyLTExIDIuMS4wIOiLpeW5suWKqOeUu+S8mOWMlu+8jOinhuinieS9k+mqjOabtOa1geeVhQovLyBAbm90ZSAgICAgICAgIDIwLTAyLTA2IDIuMC45IOatpuaxieWKoOayue+8geS/ruaUueaOqOiNkOWGheWuueWIh+aNouW8gOWFs+S9jee9ru+8jOWHj+Wwkei/neWSjOaEnwovLyBAbm90ZSAgICAgICAgIDIwLTAxLTE3IDIuMC44IOWOu+mZpOWPs+S+p+W5v+WRigovLyBAbm90ZSAgICAgICAgIDIwLTAxLTE3IDIuMC43IOaEn+iwouadpeiHqkdpdEh1YueahOaci+WPi+KAnGdsZWFuc+KAneeahOW7uuiuru+8jOWOu+aOiemhteWktOW5v+WRigovLyBAbm90ZSAgICAgICAgIDE5LTEyLTEyIDIuMC42IOaEn+iwouadpeiHqkdpdEh1YueahOaci+WPi+KAnHlleHVlc29uZ+KAneeahOW7uuiuru+8jOWwhuS9nOiAheS/oeaBr+WcqOaWh+eroOmhtumDqOWxleekugovLyBAbm90ZSAgICAgICAgIDE5LTEwLTMwIDIuMC41IOe+juWMlumakOiXj+aMiemSru+8jOWinuWKoOeCueWHu+WKqOeUuwovLyBAbm90ZSAgICAgICAgIDE5LTEwLTMwIDIuMC40IOWIoOmZpENTRE7lrpjmlrnlnKjkuLvpobXmjqjpgIHnmoTmlofnq6DvvIjlpKflpJrmmK/lub/lkYrvvIkKLy8gQG5vdGUgICAgICAgICAxOS0xMC0zMCAyLjAuMyDmt7vliqDmm7TlpJrlsY/olL3ohJrmnKwKLy8gQG5vdGUgICAgICAgICAxOS0xMC0zMCAyLjAuMCDnpZ3oh6rlt7HnlJ/ml6Xlv6vkuZB+5a6M5YWo6YeN5YaZQ1NETkdyZWVuZXLvvIznu5/kuIDkvb/nlKhKUXVlcnnvvIzmlYjnjofmm7Tpq5gKLy8gQG5vdGUgICAgICAgICAxOS0xMC0yNyAxLjUuMiDliKDpmaTliIbkuqvmtbfmiqXmj5DnpLomJuaEn+iwokdpdEh1YueahOaci+WPi+KAnENITi1TVFVERU5U4oCd55qE5Y+N6aaI77yM5Y676Zmk5bqV6YOo6K++56iL5o6o6I2QCi8vIEBub3RlICAgICAgICAgMTktMTAtMjcgMS41LjEg5oSf6LCi5p2l6IeqR2l0SHVi55qE5pyL5Y+L4oCcQ0hOLVNUVURFTlTigJ3nmoTnu4boh7TlpI3njrDlj43ppojvvIzljrvpmaTkuoblupXpg6jnmoTor77nqIvmjqjojZDlub/lkYoKLy8gQG5vdGUgICAgICAgICAxOS0xMC0wNCAxLjUuMCDnp7vpmaTkuoblupXpg6jkuLvpopjkv6Hmga/lkozmiZPotY8KLy8gQG5vdGUgICAgICAgICAxOS0wOS0xMCAxLjQuOSDmhJ/osKLmnaXoh6pHaXRIdWLnmoTmnIvlj4vigJxwcm9ncmFtbWVyWmXigJ3nmoTnu4boh7TlpI3njrDlj43ppojvvIzkv67lpI3kuobor4TorrrljLrngrnlh7vmn6XnnIvlm57lpI3lkI7vvIzlt7Lnu4/lsZXlvIDnmoTor4TorrrkvJrmlLbotbfnmoTpl67popgKLy8gQG5vdGUgICAgICAgICAxOS0wOS0wNCAxLjQuOCDmhJ/osKLmnaXoh6pHaXRIdWLnmoTmnIvlj4vigJxkd2RjdGjigJ3nmoTnu4boh7TlpI3njrDlj43ppojvvIznjrDlnKjmn6XnnIvljp/liJvmlofnq6DkuI3kvJrml6DpmZDlvLnnmbvlvZXnqpflj6PkuobvvIzkuJTliqDlvLrkuoboh6rliqjlsZXlvIDlip/og70KLy8gQG5vdGUgICAgICAgICAxOS0wOC0yMCAxLjQuNyDmhJ/osKLmsrnlj4nnlKjmiLfigJxTdXByZW1lU2ly4oCd55qE5Y+N6aaI77yM5L+u5aSN5LqG5Y+z5L6n5oKs5rWu5qCP6YGu5oyh5paH56ug55qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMTktMDgtMTQgMS40LjYg5peg6K+t44CC5Yia5pu05paw55qE5YWN55m75b2V5aSN5Yi277yM5Y+I5pS55LqG44CC5L+u5aSN77yBCi8vIEBub3RlICAgICAgICAgMTktMDgtMTMgMS40LjUg5pu05paw5LqG54us5a625Yqf6IO977ya5YWN55m75b2V5aSN5Yi2Ci8vIEBub3RlICAgICAgICAgMTktMDgtMTMgMS40LjQg5oSf6LCi5p2l6IeqR2l0SHVi55qE5pyL5Y+L4oCcaWFtc3VueGluZ+KAneeahOWPjemmiO+8jOS/ruWkjeS6humhtumDqOS4jei0tOi+ueeahOmXrumimAovLyBAbm90ZSAgICAgICAgIDE5LTA4LTAxIDEuNC4zIOaEn+iwouayueWPieeUqOaIt+KAnGRkZGR54oCd55qE5Y+N6aaI77yM5Y676Zmk5LqG5pu05aSa5o6o5bm/5bm/5ZGKCi8vIEBub3RlICAgICAgICAgMTktMDctMzAgMS40LjIg5oSf6LCi5rK55Y+J55So5oi34oCc5ZGo5LmJ5p2w4oCd55qE5Y+N6aaI77yM5aKe5Yqg5LqG6ZiyQ1NETuWklumTvumHjeWumuWQkeeahOWKn+iDve+8iENTRE7oh63mtYHmsJPvvIkKLy8gQG5vdGUgICAgICAgICAxOS0wNy0yMCAxLjQuMSDkv67lpI3kuobmjqjojZDlhoXlrrnlvIDlhbPot6jmlofnq6Dml6DmlYjpl67popjvvIjlv5jkuobphY3nva5Db29raWXkvZznlKjln5/vvIkKLy8gQG5vdGUgICAgICAgICAxOS0wNy0xOSAxLjQuMCAxLiDmnoTmnrblpKfmm7TmlrAgMi4g5oSf6LCi5p2l6IeqR2l0SHVi55qE5pyL5Y+LImx1a2VtaW4i55qE5Y+N6aaI77yM5Yqg5YWl5LqG5LiL5pa55o6o6I2Q5YaF5a655piv5ZCm6ZqQ6JeP5byA5YWz77yI5a6e55So77yJCi8vIEBub3RlICAgICAgICAgMTktMDctMTMgMS4zLjAg5oSf6LCi5p2l6IeqR2l0SHVi55qE5pyL5Y+L4oCcSG9sYXBsYWNl4oCd55qE5Y+N6aaI77yM5L+u5aSN5LqG5paH56ug5peg5rOV6Ieq5Yqo5bGV5byA55qE6Zeu6aKY77yIQ1NETuaAu+aUuei/meS4qu+8jOS7pOS6uuWktOeWvO+8iQovLyBAbm90ZSAgICAgICAgIDE5LTA2LTA4IDEuMi42IOaEn+iwouayueWPieeUqOaIt+KAnERlc2t5QWtp4oCd55qE5Y+N6aaI77yM5L+u5aSN5LqG5paH56ug5peg5rOV6Ieq5Yqo5bGV5byA55qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMTktMDYtMDcgMS4yLjQg5L+u5aSN5LqG55m75b2V5ZCO6K+E6K665peg5rOV5q2j5bi45omT5byA55qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMTktMDYtMDcgMS4yLjMg5oSf6LCi5rK55Y+J55So5oi3IuawuOi/nOeahOauv+S4iyLnmoTlj43ppojvvIzlnKjkuIDkuIrljYjnmoTliqrlipvmlLvlhYvkuIvvvIznu4jkuo7lrp7njrDkuobmnKrnmbvlvZXlsZXlvIDor4TorrrnmoTor63lj6UKLy8gQG5vdGUgICAgICAgICAxOS0wNi0wNSAxLjIuMCDkv67lpI3kuobor4Torrrml6Dms5Xoh6rliqjlsZXlvIDnmoRCVUcKLy8gQG5vdGUgICAgICAgICAxOS0wNi0wNCAxLjEuOSDkv67lpI3kuobml6Dms5Xoh6rliqjlsZXlvIDnmoRCVUfvvIjoh6rpl63kuobvvIkKLy8gQG5vdGUgICAgICAgICAxOS0wNi0wNCAxLjEuNiBDU0RO5aSq5Z2P5LqG77yM5oqK4oCc5raI5oGv4oCd5oyJ6ZKu55qEQ2xhc3Porr7nva7miJDkuobigJxHaXRDaGF04oCd77yM5omA5Lul5L+u5aSN5LqG4oCc5raI5oGv4oCd5oyJ6ZKu5raI5aSx55qE6Zeu6aKYCi8vIEBub3RlICAgICAgICAgMTktMDYtMDQgMS4xLjUgMS4g5LyY5YyW5LqG6K665Z2b5L2T6aqMIDIu576O5YyW44CB5LyY5YyW5Luj56CB57uT5p6ECi8vIEBub3RlICAgICAgICAgMTktMDYtMDQgMS4xLjQg5oSf6LCi5p2l6IeqR2l0SHVi55qE5pyL5Y+L4oCcaWFtc3VueGluZ+KAneeahOWPjemmiO+8jOWinuWKoOS6huiuuuWdm+W5v+WRiuWMuemFjeinhOWImQovLyBAbm90ZSAgICAgICAgIDE5LTA2LTAzIDEuMS4zIOaEn+iwouadpeiHqkdpdEh1YueahOaci+WPi+KAnHdhbmd3ZWkxMzXigJ3nmoTlj43ppojvvIzljrvpmaTkuobor4TorrrljLrkuIrmlrnnmoTlub/lkYoKLy8gQG5vdGUgICAgICAgICAxOS0wNS0yNyAxLjEuMiDmhJ/osKLmsrnlj4nnlKjmiLfigJzlpI/kvJ/mnbDigJ3nmoTlj43ppojvvIzkv67lpI3kuoblr4zmlofmnKznvJbovpHlmajml6Dms5Xkvb/nlKjnmoTpl67popgKLy8gQG5vdGUgICAgICAgICAxOS0wNS0yNSAxLjEuMCAxLiDkv67lpI3kuobkuLvpobXlub/lkYrnmoTpl67popggMi4g6K665Z2b6Ieq5Yqo5bGV5byAIDMuIOiuuuWdm+W5v+WRiua2iOmZpAovLyBAbm90ZSAgICAgICAgIDE5LTA1LTI1IDEuMC45IOaEn+iwouayueWPieeUqOaIt+KAnOa4o+a4o+S4jeWHhuivtOivneKAneeahOWPjemmiO+8jOS/ruWkjeS6huaUtuiXj+aMiemSrua2iOWkseeahOmXrumimAovLyBAbm90ZSAgICAgICAgIDE5LTAzLTAxIDEuMC4zIOa3u+WKoOmhtemdoumAieaLqeaAp+i/h+a7pOinhOWImQovLyBAbm90ZSAgICAgICAgIDE5LTAzLTAxIDEuMC4yIOWinuWKoOS6huWHgOWMluWJqui0tOadv+WKn+iDvQovLyBAbm90ZSAgICAgICAgIDE5LTAzLTAxIDEuMC4xIOS/ruWkjeS6huaOkueJiOmXrumimCwg5LyY5YyW5LqG5Luj56CB57uT5p6ECi8vIEBub3RlICAgICAgICAgMTktMDItMjYgMS4wLjAg5Yid54mI5Y+R5biDCi8vID09L1VzZXJTY3JpcHQ9PQp2YXIgdmVyc2lvbiA9ICIzLjQuMyI7CnZhciBjdXJyZW50VVJMID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CnZhciBsaXN0Owp2YXIgd2luZG93VG9wID0gMDsKCi8vIOiHquWumuS5iSBDU1MKLy8g6L+b5bqm5p2hCiQoJ2hlYWQnKS5hcHBlbmQoIjxzdHlsZT4jbnByb2dyZXNze3BvaW50ZXItZXZlbnRzOm5vbmV9I25wcm9ncmVzcyAuYmFye2JhY2tncm91bmQ6I2Y0NDQ0NDtwb3NpdGlvbjpmaXhlZDt6LWluZGV4OjEwMzE7dG9wOjA7bGVmdDowO3dpZHRoOjEwMCU7aGVpZ2h0OjJweH0jbnByb2dyZXNzIC5wZWd7ZGlzcGxheTpibG9jaztwb3NpdGlvbjphYnNvbHV0ZTtyaWdodDowO3dpZHRoOjEwMHB4O2hlaWdodDoxMDAlO2JveC1zaGFkb3c6MCAwIDEwcHggI2Y0NDQ0NCwwIDAgNXB4ICNmNDQ0NDQ7b3BhY2l0eToxOy13ZWJraXQtdHJhbnNmb3JtOnJvdGF0ZSgzZGVnKSB0cmFuc2xhdGUoMCwtNHB4KTstbXMtdHJhbnNmb3JtOnJvdGF0ZSgzZGVnKSB0cmFuc2xhdGUoMCwtNHB4KTt0cmFuc2Zvcm06cm90YXRlKDNkZWcpIHRyYW5zbGF0ZSgwLC00cHgpfSNucHJvZ3Jlc3MgLnNwaW5uZXJ7ZGlzcGxheTpibG9jaztwb3NpdGlvbjpmaXhlZDt6LWluZGV4OjEwMzE7dG9wOjE1cHg7cmlnaHQ6MTVweH0jbnByb2dyZXNzIC5zcGlubmVyLWljb257d2lkdGg6MThweDtoZWlnaHQ6MThweDtib3gtc2l6aW5nOmJvcmRlci1ib3g7Ym9yZGVyOnNvbGlkIDJweCB0cmFuc3BhcmVudDtib3JkZXItdG9wLWNvbG9yOiNmNDQ0NDQ7Ym9yZGVyLWxlZnQtY29sb3I6I2Y0NDQ0NDtib3JkZXItcmFkaXVzOjUwJTstd2Via2l0LWFuaW1hdGlvbjpucHJvZ3Jlc3Mtc3Bpbm5lciAuNHMgbGluZWFyIGluZmluaXRlO2FuaW1hdGlvbjpucHJvZ3Jlc3Mtc3Bpbm5lciAuNHMgbGluZWFyIGluZmluaXRlfS5ucHJvZ3Jlc3MtY3VzdG9tLXBhcmVudHtvdmVyZmxvdzpoaWRkZW47cG9zaXRpb246cmVsYXRpdmV9Lm5wcm9ncmVzcy1jdXN0b20tcGFyZW50ICNucHJvZ3Jlc3MgLmJhciwubnByb2dyZXNzLWN1c3RvbS1wYXJlbnQgI25wcm9ncmVzcyAuc3Bpbm5lcntwb3NpdGlvbjphYnNvbHV0ZX1ALXdlYmtpdC1rZXlmcmFtZXMgbnByb2dyZXNzLXNwaW5uZXJ7MCV7LXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDApfTEwMCV7LXdlYmtpdC10cmFuc2Zvcm06cm90YXRlKDM2MGRlZyl9fUBrZXlmcmFtZXMgbnByb2dyZXNzLXNwaW5uZXJ7MCV7dHJhbnNmb3JtOnJvdGF0ZSgwKX0xMDAle3RyYW5zZm9ybTpyb3RhdGUoMzYwZGVnKX19PC9zdHlsZT4iKTsKLy8g5by55Ye656qX5Y+jCiQoJ2hlYWQnKS5hcHBlbmQoIjxzdHlsZT4uYmxhY2tfb3ZlcmxheXt0b3A6MCU7bGVmdDowJTt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO2JhY2tncm91bmQtY29sb3I6IzAwMDt6LWluZGV4OjEwMDE7LW1vei1vcGFjaXR5OjAuODtvcGFjaXR5Oi4xMDtmaWx0ZXI6YWxwaGEob3BhY2l0eT04OCl9LmJsYWNrX292ZXJsYXksLndoaXRlX2NvbnRlbnR7ZGlzcGxheTpub25lO3Bvc2l0aW9uOmFic29sdXRlfS53aGl0ZV9jb250ZW50e3otaW5kZXg6OTk5OSFpbXBvcnRhbnQ7dG9wOjI1JTtsZWZ0OjI1JTt3aWR0aDo2NTBweDtoZWlnaHQ6NjAlO3BhZGRpbmc6MjBweDtib3JkZXI6MHB4O2JhY2tncm91bmQtY29sb3I6I2ZmZjt6LWluZGV4OjEwMDI7b3ZlcmZsb3c6YXV0b308L3N0eWxlPiIpOwovLyDmj5DnpLrmnaEKJCgnaGVhZCcpLmFwcGVuZCgiPHN0eWxlPi50cmlwc2NvbntwYWRkaW5nOjEwcHh9PC9zdHlsZT4iKTsKLy8g5oyJ6ZKu77yI5pen77yJCiQoJ2hlYWQnKS5hcHBlbmQoIjxzdHlsZT4jdG9nZ2xlLWJ1dHRvbntkaXNwbGF5Om5vbmV9LmJ1dHRvbi1sYWJlbHtwb3NpdGlvbjpyZWxhdGl2ZTtkaXNwbGF5OmlubGluZS1ibG9jazt3aWR0aDo4MnB4O2JhY2tncm91bmQtY29sb3I6I2NjYztib3JkZXI6MXB4IHNvbGlkICNjY2M7Ym9yZGVyLXJhZGl1czozMHB4O2N1cnNvcjpwb2ludGVyfS5jaXJjbGV7cG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3dpZHRoOjMwcHg7aGVpZ2h0OjMwcHg7Ym9yZGVyLXJhZGl1czo1MCU7YmFja2dyb3VuZC1jb2xvcjojZmZmfS5idXR0b24tbGFiZWwgLnRleHR7bGluZS1oZWlnaHQ6MzBweDtmb250LXNpemU6MThweDstd2Via2l0LXVzZXItc2VsZWN0Om5vbmU7dXNlci1zZWxlY3Q6bm9uZX0ub257Y29sb3I6I2ZmZjtkaXNwbGF5Om5vbmU7dGV4dC1pbmRlbnQ6MTBweH0ub2Zme2NvbG9yOiNmZmY7ZGlzcGxheTppbmxpbmUtYmxvY2s7dGV4dC1pbmRlbnQ6NTNweH0uYnV0dG9uLWxhYmVsIC5jaXJjbGV7bGVmdDowO3RyYW5zaXRpb246YWxsIC4zc30jdG9nZ2xlLWJ1dHRvbjpjaGVja2VkK2xhYmVsLmJ1dHRvbi1sYWJlbCAuY2lyY2xle2xlZnQ6NTBweH0jdG9nZ2xlLWJ1dHRvbjpjaGVja2VkK2xhYmVsLmJ1dHRvbi1sYWJlbCAub257ZGlzcGxheTppbmxpbmUtYmxvY2t9I3RvZ2dsZS1idXR0b246Y2hlY2tlZCtsYWJlbC5idXR0b24tbGFiZWwgLm9mZntkaXNwbGF5Om5vbmV9I3RvZ2dsZS1idXR0b246Y2hlY2tlZCtsYWJlbC5idXR0b24tbGFiZWx7YmFja2dyb3VuZC1jb2xvcjojNzhkNjkwfTwvc3R5bGU+Iik7Ci8vIOS/neWtmOaMiemSrgokKCdoZWFkJykuYXBwZW5kKCI8c3R5bGU+I3NhdmV7YmFja2dyb3VuZC1jb2xvcjojMTlhNGVkO2JvcmRlcjpub25lO2NvbG9yOiNmZmY7cGFkZGluZzo1cHggMTVweDt0ZXh0LWFsaWduOmNlbnRlcjt0ZXh0LWRlY29yYXRpb246bm9uZTtkaXNwbGF5OmlubGluZS1ibG9jaztmb250LXNpemU6MTJweDtjdXJzb3I6cG9pbnRlcn08L3N0eWxlPiIpOwovLyBTdGFyIOagt+W8jwokKCdoZWFkJykuYXBwZW5kKCI8c3R5bGU+LmdpdmVNZU9uZVN0YXI6aG92ZXJ7Y29sb3I6I0ZGNjlCNDt9PC9zdHlsZT4iKTsKCi8vIFNWRwp2YXIgc2F2ZV9zdmcgPSAnPHN2ZyB0PSIxNTk1MDgyNjUwMTczIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwNzUgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjIwNzgiIHdpZHRoPSIxNDAiIGhlaWdodD0iMTQwIj48cGF0aCBkPSJNNzUzLjc2MzkwMiA2ODUuODMwMjQ0YTQ4Ljk1MjE5NSA0OC45NTIxOTUgMCAwIDEgNDkuMTUyLTQ4LjcwMjQzOWM4MS40MjA0ODggMCAxNDEuMTYyMTQ2LTY1LjM4NjE0NiAxNDEuMTYyMTQ3LTE0Ni4wNTczNjYgMC00My41MDc1MTItMTMuMDM3MjY4LTgyLjQxOTUxMi00My40NTc1NjEtMTA5LjI0MzMxN2ExNDIuMzYwOTc2IDE0Mi4zNjA5NzYgMCAwIDAtMjAuMjgwMTk1LTE0LjkzNTQxNSAxNTguMDQ1NjU5IDE1OC4wNDU2NTkgMCAwIDAtMTEuMjM5MDI1LTYuMjQzOTAybC0yLjc0NzMxNy0xLjI5ODczMmExNTUuODQ3ODA1IDE1NS44NDc4MDUgMCAwIDAtOS4xOTEwMjQtMy45OTYwOTdjLTEuMzQ4NjgzLTAuNTQ5NDYzLTIuNjk3MzY2LTAuOTk5MDI0LTQuMDk2LTEuNDk4NTM3YTE1Mi4zNTEyMiAxNTIuMzUxMjIgMCAwIDAtOC40OTE3MDctMi44NDcyMTljLTEuOTQ4MDk4LTAuNTk5NDE1LTMuODk2MTk1LTAuOTk5MDI0LTUuODQ0MjkzLTEuNDk4NTM3LTIuNDk3NTYxLTAuNTk5NDE1LTQuOTQ1MTcxLTEuMjQ4NzgtNy40OTI2ODMtMS43NDgyOTMtMi41OTc0NjMtMC40OTk1MTItNS4zNDQ3OC0wLjg5OTEyMi04LjA0MjE0Ni0xLjI0ODc4LTEuOTQ4MDk4LTAuMjQ5NzU2LTMuODQ2MjQ0LTAuNTk5NDE1LTUuODQ0MjkzLTAuNzk5MjJhMTUzLjE1MDQzOSAxNTMuMTUwNDM5IDAgMCAwLTE0LjQzNTkwMy0wLjc0OTI2OGMtMS40OTg1MzcgMC0yLjk5NzA3MyAwLjE5OTgwNS00LjU0NTU2MSAwLjI0OTc1NmEyNjUuMzkwODI5IDI2NS4zOTA4MjkgMCAwIDAtNS41OTQ1MzYtMjQuNTI2MDQ5Yy0wLjQ5OTUxMi0xLjk5ODA0OS0xLjI5ODczMi0zLjg0NjI0NC0xLjg5ODE0Ni01Ljg0NDI5MmEyNjcuNDM4ODI5IDI2Ny40Mzg4MjkgMCAwIDAtNS45NDQxOTYtMTcuOTgyNDM5Yy0wLjY0OTM2Ni0xLjc5ODI0NC0xLjQ5ODUzNy0zLjQ5NjU4NS0yLjE5Nzg1My01LjI5NDgzYTI4My4xMjM1MTIgMjgzLjEyMzUxMiAwIDAgMC03Ljc0MjQzOS0xNy43MzI2ODNMNzcyLjc0NTM2NiAyNjkuNzM2NTg1YTI4Mi45NzM2NTkgMjgyLjk3MzY1OSAwIDAgMC05Ljc5MDQzOS0xNy44MzI1ODVDNzE0LjMwMjQzOSAxNzEuNTgyNDM5IDYyNS44ODg3OCAxMjQuODc4MDQ5IDUyNC40ODc4MDUgMTI0Ljg3ODA0OWMtMTAxLjQwMDk3NiAwLTE4OS45MTQ1MzcgNDYuNjU0NDM5LTIzOC41MTcwNzMgMTI2Ljk3Ni0zLjQ5NjU4NSA1Ljc5NDM0MS02LjY5MzQ2MyAxMS43ODg0ODgtOS43OTA0MzkgMTcuODMyNTg1bC0yLjE5Nzg1NCA0LjA5NmEyODMuNTIzMTIyIDI4My41MjMxMjIgMCAwIDAtNy43NDI0MzkgMTcuNzMyNjgzbC0yLjE5Nzg1NCA1LjI0NDg3OGMtMi4yNDc4MDUgNS44OTQyNDQtNC4xNDU5NTEgMTEuOTg4MjkzLTUuOTk0MTQ2IDE4LjAzMjM5LTAuNTQ5NDYzIDEuOTk4MDQ5LTEuMjk4NzMyIDMuODQ2MjQ0LTEuODQ4MTk1IDUuODQ0MjkzYTI2Ni43Mzk1MTIgMjY2LjczOTUxMiAwIDAgMC01LjU5NDUzNyAyNC40NzYwOThjLTEuNDk4NTM3IDAtMi45OTcwNzMtMC4xOTk4MDUtNC41NDU1NjEtMC4xOTk4MDUtNC44OTUyMiAwLTkuNjkwNTM3IDAuMjk5NzA3LTE0LjQ4NTg1MyAwLjc0OTI2OC0xLjk5ODA0OSAwLjE5OTgwNS0zLjg0NjI0NCAwLjQ5OTUxMi01Ljc5NDM0MiAwLjc5OTIyLTIuNjk3MzY2IDAuMzQ5NjU5LTUuNDQ0NjgzIDAuNjk5MzE3LTguMDkyMDk3IDEuMjQ4NzgtMi40OTc1NjEgMC40OTk1MTItNC45OTUxMjIgMS4xNDg4NzgtNy40OTI2ODMgMS43NDgyOTMtMS44OTgxNDYgMC40OTk1MTItMy44NDYyNDQgMC44OTkxMjItNS43OTQzNDIgMS40OTg1MzZhMTUzLjY0OTk1MSAxNTMuNjQ5OTUxIDAgMCAwLTguNDkxNzA3IDIuNzk3MjY5bC00LjA5NiAxLjQ5ODUzNmExNjQuMjg5NTYxIDE2NC4yODk1NjEgMCAwIDAtOS4yNDA5NzYgMy45OTYwOThsLTIuNjk3MzY2IDEuMzQ4NjgzYTE0NS41NTc4NTQgMTQ1LjU1Nzg1NCAwIDAgMC0zMS40NjkyNjggMjEuMTc5MzE3QzExNy44ODQ4NzggNDA4LjYwMDk3NiAxMDQuODk3NTYxIDQ0Ny41NjI5MjcgMTA0Ljg5NzU2MSA0OTEuMDcwNDM5YzAgODAuNjcxMjIgNTkuNzQxNjU5IDE0Ni4wNTczNjYgMTQxLjE2MjE0NiAxNDYuMDU3MzY2YTQ4Ljk1MjE5NSA0OC45NTIxOTUgMCAwIDEgNDkuMTUyIDQ4LjcwMjQzOSA0OC45NTIxOTUgNDguOTUyMTk1IDAgMCAxLTQ5LjE1MiA0OC43MDI0MzljLTEzNS43MTc0NjMgMC0yNDUuNzEwMDQ5LTEwOC45OTM1NjEtMjQ1LjcxMDA0OC0yNDMuNDYyMjQ0IDAtMTA5LjY5Mjg3OCA3My4yMjg0ODgtMjAyLjQwMjM0MSAxNzMuODMwMjQzLTIzMi44NzI1ODVBMzc1LjgzMjk3NiAzNzUuODMyOTc2IDAgMCAxIDUyNC40ODc4MDUgMjAuMzMwMTQ2YTM3NS44ODI5MjcgMzc1Ljg4MjkyNyAwIDAgMSAzNTAuMzA3OTAyIDIzNy44Njc3MDhjMTAwLjYwMTc1NiAzMC40NzAyNDQgMTczLjgzMDI0NCAxMjMuMTc5NzA3IDE3My44MzAyNDQgMjMyLjg3MjU4NSAwIDEzNC40Njg2ODMtMTA5Ljk5MjU4NSAyNDMuNDYyMjQ0LTI0NS43MTAwNDkgMjQzLjQ2MjI0NGE0OC45NTIxOTUgNDguOTUyMTk1IDAgMCAxLTQ5LjEwMjA0OC00OC43MDI0Mzl6IiBwLWlkPSIyMDc5Ij48L3BhdGg+PHBhdGggZD0iTTQ4Ny45NzM0NjMgMzg2LjEyMjkyN2E0OS4xMDIwNDkgNDkuMTAyMDQ5IDAgMCAxIDcyLjkyODc4MSAwLjA5OTkwMmwxNDcuMzU2MDk3IDE2Mi4wNDE3NTZjNi45OTMxNzEgNy43NDI0MzkgMTEuNDg4NzggMTkuNDMxMDI0IDEyLjUzNzc1NyAzMC4xMjA1ODZsMC4yNDk3NTYgMTIuOTM3MzY2YzAgMTkuNDgwOTc2LTIwLjQ4IDM5LjY2MTI2OC0zOS4yMTE3MDggMzkuNjYxMjY4aC0xMDQuODk3NTYxdjI2Mi45OTMxNzFhNTIuNDQ4NzggNTIuNDQ4NzggMCAxIDEtMTA0Ljg5NzU2MSAwdi0yNjIuOTkzMTcxaC0xMDQuODk3NTYxYy0xMy44ODY0MzkgMC0zOS4yMTE3MDctMjEuNzI4NzgtMzkuMjExNzA3LTM5LjY2MTI2OHYtMTIuOTg3MzE3YzAtMTIuNDg3ODA1IDQuNzk1MzE3LTIxLjI3OTIyIDEyLjYzNzY1OS0yOS45MjA3ODFsMTQ3LjM1NjA5Ny0xNjIuMjkxNTEyeiIgcC1pZD0iMjA4MCI+PC9wYXRoPjwvc3ZnPic7CnZhciBzdGFyX3N2Z18xID0gJzxzdmcgdD0iMTU5NTA4MzYzMTY4NSIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDUxIDEwMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBwLWlkPSIyMTczIiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCI+PHBhdGggZD0iTTUyNS44Mzc4MzggODUyLjQxMDgxMUwxOTkuMjY0ODY1IDEwMDEuODU5NDU5bDQxLjUxMzUxMy0zNTcuMDE2MjE2TDAgMzgxLjkyNDMyNGwzNTEuNDgxMDgxLTY5LjE4OTE4OUw1MjUuODM3ODM4IDBsMTc0LjM1Njc1NyAzMTIuNzM1MTM1TDEwNTEuNjc1Njc2IDM4MS45MjQzMjRsLTI0MC43NzgzNzkgMjYyLjkxODkxOSA0MS41MTM1MTQgMzU3LjAxNjIxNnoiIGZpbGw9IiNGRkQ1NjYiIHAtaWQ9IjIxNzQiPjwvcGF0aD48L3N2Zz4nOwp2YXIgc3Rhcl9zdmdfMiA9ICcgPHN2ZyB0PSIxNTk1MDgzNzE1MzEyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9Ijc4NDgiIHdpZHRoPSIxNDAiIGhlaWdodD0iMTQwIj48cGF0aCBkPSJNMTAxNC4wMDEzNDcgODY2LjA5MDIzNkw4MTAuMjM1NjkgNjYyLjMyNDU3OWwxNDUuNDk3NjQzLTg0LjEyNjU5OWMxMS4zNzc3NzgtNi41NTA4NDIgMTcuOTI4NjItMTguOTYyOTYzIDE2Ljg5NDI3Ni0zMi4wNjQ2NDctMS4wMzQzNDMtMTMuMTAxNjg0LTkuMzA5MDkxLTI0LjQ3OTQ2MS0yMS4zNzY0MzEtMjkuMzA2Mzk3bC02NDguMTg4NTUyLTI1OC41ODU4NTljLTEyLjc1NjkwMi01LjE3MTcxNy0yNy4yMzc3MS0yLjA2ODY4Ny0zNi44OTE1ODIgNy41ODUxODYtOS42NTM4NzIgOS42NTM4NzItMTIuNzU2OTAyIDI0LjEzNDY4LTcuNTg1MTg1IDM2Ljg5MTU4MmwyNTguNTg1ODU4IDY0OC41MzMzMzNjNC44MjY5MzYgMTIuMDY3MzQgMTYuMjA0NzE0IDIwLjY4Njg2OSAyOS4zMDYzOTcgMjEuMzc2NDMxIDEzLjEwMTY4NCAxLjAzNDM0MyAyNS41MTM4MDUtNS41MTY0OTggMzIuMDY0NjQ3LTE2Ljg5NDI3Nmw4NC4xMjY1OTktMTQ1LjQ5NzY0MyAyMDMuNzY1NjU3IDIwMy43NjU2NTdjNi41NTA4NDIgNi41NTA4NDIgMTUuMTcwMzcgOS45OTg2NTMgMjQuMTM0NjggOS45OTg2NTMgOC45NjQzMSAwIDE3LjkyODYyLTMuNDQ3ODExIDI0LjEzNDY4LTkuOTk4NjUzbDk5LjI5Njk3LTk5LjI5Njk3YzEzLjQ0NjQ2NS0xMy40NDY0NjUgMTMuNDQ2NDY1LTM1LjE2NzY3NyAwLTQ4LjYxNDE0MXpNMTUwLjMyNDU3OSAxMDIuMDU1MjE5Yy0xMy40NDY0NjUtMTMuNDQ2NDY1LTM1LjE2NzY3Ny0xMy40NDY0NjUtNDguMjY5MzYgMC0xMy40NDY0NjUgMTMuNDQ2NDY1LTEzLjQ0NjQ2NSAzNS4xNjc2NzcgMCA0OC4yNjkzNmw3Ni4xOTY2MzMgNzYuMTk2NjMzYzYuNTUwODQyIDYuNTUwODQyIDE1LjUxNTE1MiA5Ljk5ODY1MyAyNC4xMzQ2OCA5Ljk5ODY1M3MxNy41ODM4MzgtMy40NDc4MTEgMjQuMTM0NjgtOS45OTg2NTNjMTMuNDQ2NDY1LTEzLjQ0NjQ2NSAxMy40NDY0NjUtMzUuMTY3Njc3IDAtNDguMjY5MzZMMTUwLjMyNDU3OSAxMDIuMDU1MjE5ek0xNzYuMTgzMTY1IDMzOC41NzUwODRjMC0xOC45NjI5NjMtMTUuMTcwMzctMzQuMTMzMzMzLTM0LjEzMzMzMy0zNC4xMzMzMzNIMzQuMTMzMzMzYy0xOC45NjI5NjMgMC0zNC4xMzMzMzMgMTUuMTcwMzctMzQuMTMzMzMzIDM0LjEzMzMzM3MxNS4xNzAzNyAzNC4xMzMzMzMgMzQuMTMzMzMzIDM0LjEzMzMzNGgxMDcuNTcxNzE4YzE4Ljk2Mjk2MyAwIDM0LjQ3ODExNC0xNS4xNzAzNyAzNC40NzgxMTQtMzQuMTMzMzM0ek0xNjIuMzkxOTE5IDQ0NC40MjI4OTZsLTc2LjE5NjYzMyA3NS44NTE4NTFjLTEzLjQ0NjQ2NSAxMy40NDY0NjUtMTMuNDQ2NDY1IDM1LjE2NzY3NyAwIDQ4LjI2OTM2MSA2LjU1MDg0MiA2LjU1MDg0MiAxNS41MTUxNTIgOS45OTg2NTMgMjQuMTM0NjggOS45OTg2NTNzMTcuNTgzODM4LTMuNDQ3ODExIDI0LjEzNDY4LTkuOTk4NjUzbDc2LjE5NjYzMy03Ni4xOTY2MzNjMTMuNDQ2NDY1LTEzLjQ0NjQ2NSAxMy40NDY0NjUtMzUuMTY3Njc3IDAtNDguMjY5MzYxLTEzLjQ0NjQ2NS0xMy4xMDE2ODQtMzUuMTY3Njc3LTEzLjEwMTY4NC00OC4yNjkzNiAwLjM0NDc4MnpNMzM4LjU3NTA4NCAxNzYuMTgzMTY1YzE4Ljk2Mjk2MyAwIDM0LjEzMzMzMy0xNS4xNzAzNyAzNC4xMzMzMzQtMzQuMTMzMzMzVjM0LjEzMzMzM2MwLTE4Ljk2Mjk2My0xNS4xNzAzNy0zNC4xMzMzMzMtMzQuMTMzMzM0LTM0LjEzMzMzM3MtMzQuMTMzMzMzIDE1LjE3MDM3LTM0LjEzMzMzMyAzNC4xMzMzMzN2MTA3LjU3MTcxOGMwIDE4Ljk2Mjk2MyAxNS4xNzAzNyAzNC40NzgxMTQgMzQuMTMzMzMzIDM0LjQ3ODExNHpNNDY4LjU1NzU3NiAyMjAuNjU5OTMzYzguNjE5NTI5IDAgMTcuNTgzODM4LTMuNDQ3ODExIDI0LjEzNDY4LTkuOTk4NjU0TDU2OC44ODg4ODkgMTM0LjQ2NDY0NmMxMy40NDY0NjUtMTMuNDQ2NDY1IDEzLjQ0NjQ2NS0zNS4xNjc2NzcgMC00OC4yNjkzNi0xMy40NDY0NjUtMTMuNDQ2NDY1LTM1LjE2NzY3Ny0xMy40NDY0NjUtNDguMjY5MzYgMGwtNzYuMTk2NjMzIDc2LjE5NjYzM2MtMTMuNDQ2NDY1IDEzLjQ0NjQ2NS0xMy40NDY0NjUgMzUuMTY3Njc3IDAgNDguMjY5MzYgNi41NTA4NDIgNi41NTA4NDIgMTUuNTE1MTUyIDkuOTk4NjUzIDI0LjEzNDY4IDkuOTk4NjU0eiIgZmlsbD0iIzJjMmMyYyIgcC1pZD0iNzg0OSI+PC9wYXRoPjwvc3ZnPic7CnZhciBzdGFyX3N2Z18zID0gJyA8c3ZnIHQ9IjE1OTUwODM5MjU0MzgiIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTIwNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iNDgwOSIgd2lkdGg9IjE0MCIgaGVpZ2h0PSIxNDAiPjxwYXRoIGQ9Ik0xMDg4Ljg2NDM0OCA2MTguMTM3MDFhMTU1NS4wMDkzODQgMTU1NS4wMDkzODQgMCAwIDEtMTUwLjI3MzAwNCAxNjcuMTM3MzA4Yy01Mi44ODE2NDIgNTEuMTk1MjEyLTEwNy45MzE1NTIgMTAxLjE4NTgzLTE2My42NDM5ODkgMTQ3LjI2MTUyMS0zMy44NDkwNjkgMjcuNTI0OTU1LTYwLjIyOTY2MSA0OC42NjU1NjYtNzYuMTkwNTIxIDYwLjIyOTY2MWExNjIuOTgxNDYyIDE2Mi45ODE0NjIgMCAwIDEtMTkxLjg5MTY5OSAwYy0xNS41MzkyNTMtMTIuMDQ1OTMyLTQyLjE2MDc2My0zMi42NDQ0NzYtNzYuMTkwNTIxLTYwLjgzMTk1N2EyNjM4LjQ4MDc1NCAyNjM4LjQ4MDc1NCAwIDAgMS0xNjQuMzY2NzQ1LTE0Ny4yNjE1MjEgMTU3OS4xMDEyNDkgMTU3OS4xMDEyNDkgMCAwIDEtMTUwLjI3MzAwNC0xNjUuODEyMjU3QTQ2OC4xMDQ5MjQgNDY4LjEwNDkyNCAwIDAgMSAwLjE1Mjk5OCAzNDQuNzU0NTc5IDMxNS41NDMxOTMgMzE1LjU0MzE5MyAwIDAgMSAxMDkuMDQ4MjI1IDk2LjM2NzQ1N2EzOTkuNDQzMTExIDM5OS40NDMxMTEgMCAwIDEgNDkzLjg4MzIxOS0yMC40NzgwODQgMzk4LjY2MDEyNSAzOTguNjYwMTI1IDAgMCAxIDQ5My44ODMyMTkgMjAuNDc4MDg0QTMxNS40ODI5NjQgMzE1LjQ4Mjk2NCAwIDAgMSAxMjA0Ljc0NjIxNSAzNDMuMzA5MDY3YTQ2Ni44NDAxMDEgNDY2Ljg0MDEwMSAwIDAgMS0xMTUuNzAxMTc4IDI3NC42NDcyNTR6IiBmaWxsPSIjRkU0QjgzIiBwLWlkPSI0ODEwIj48L3BhdGg+PC9zdmc+JzsKdmFyIHN0YXJfc3ZnXzQgPSAnIDxzdmcgdD0iMTU5NTA4NDA4OTExNSIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBwLWlkPSI4MDA4IiB3aWR0aD0iMTQwIiBoZWlnaHQ9IjE0MCI+PHBhdGggZD0iTTUxMiA0Ni41NDU0NTVDMjU2IDQ2LjU0NTQ1NSA0Ni41NDU0NTUgMjU2IDQ2LjU0NTQ1NSA1MTJzMjA5LjQ1NDU0NSA0NjUuNDU0NTQ1IDQ2NS40NTQ1NDUgNDY1LjQ1NDU0NSA0NjUuNDU0NTQ1LTIwOS40NTQ1NDUgNDY1LjQ1NDU0NS00NjUuNDU0NTQ1Uzc2OCA0Ni41NDU0NTUgNTEyIDQ2LjU0NTQ1NXogbTAgODM3LjgxODE4MWMtMjA0LjggMC0zNzIuMzYzNjM2LTE2Ny41NjM2MzYtMzcyLjM2MzYzNi0zNzIuMzYzNjM2czE2Ny41NjM2MzYtMzcyLjM2MzYzNiAzNzIuMzYzNjM2LTM3Mi4zNjM2MzYgMzcyLjM2MzYzNiAxNjcuNTYzNjM2IDM3Mi4zNjM2MzYgMzcyLjM2MzYzNi0xNjcuNTYzNjM2IDM3Mi4zNjM2MzYtMzcyLjM2MzYzNiAzNzIuMzYzNjM2eiIgZmlsbD0iIzAwQzVDNSIgcC1pZD0iODAwOSI+PC9wYXRoPjxwYXRoIGQ9Ik02NTYuMjkwOTA5IDU4Ni40NzI3MjdjLTc5LjEyNzI3MyA2OS44MTgxODItMjA5LjQ1NDU0NSA2OS44MTgxODItMjg4LjU4MTgxOCAwLTE4LjYxODE4Mi0xMy45NjM2MzYtNDEuODkwOTA5LTEzLjk2MzYzNi02MC41MDkwOTEgNC42NTQ1NDYtMTMuOTYzNjM2IDEzLjk2MzYzNi0xMy45NjM2MzYgNDEuODkwOTA5IDQuNjU0NTQ1IDYwLjUwOTA5MSA1NS44NTQ1NDUgNTEuMiAxMjUuNjcyNzI3IDc0LjQ3MjcyNyAyMDAuMTQ1NDU1IDc0LjQ3MjcyN3MxNDQuMjkwOTA5LTI3LjkyNzI3MyAyMDAuMTQ1NDU1LTc0LjQ3MjcyN2MxOC42MTgxODItMTMuOTYzNjM2IDE4LjYxODE4Mi00MS44OTA5MDkgNC42NTQ1NDUtNjAuNTA5MDkxcy00MS44OTA5MDktMTguNjE4MTgyLTYwLjUwOTA5MS00LjY1NDU0NnpNMzU4LjQgNDYwLjhjMjcuOTI3MjczIDAgNTEuMi0yMy4yNzI3MjcgNTEuMi01MS4ycy0yMy4yNzI3MjctNTUuODU0NTQ1LTUxLjItNTUuODU0NTQ1Yy0yNy45MjcyNzMgMC01MS4yIDIzLjI3MjcyNy01MS4yIDUxLjJzMjMuMjcyNzI3IDU1Ljg1NDU0NSA1MS4yIDU1Ljg1NDU0NXpNNjY1LjYgNDYwLjhjMjcuOTI3MjczIDAgNTEuMi0yMy4yNzI3MjcgNTEuMi01MS4ycy0yMy4yNzI3MjctNTEuMi01MS4yLTUxLjItNTEuMiAyMy4yNzI3MjctNTEuMiA1MS4yIDIzLjI3MjcyNyA1MS4yIDUxLjIgNTEuMnoiIGZpbGw9IiMwMEM1QzUiIHAtaWQ9IjgwMTAiPjwvcGF0aD48L3N2Zz4nOwp2YXIgc3Rhcl9zdmcgPSBzdGFyX3N2Z18xICsgc3Rhcl9zdmdfMiArIHN0YXJfc3ZnXzMgKyBzdGFyX3N2Z180Owp2YXIgZG9uYXRlX3N2ZyA9ICc8c3ZnIHQ9IjE1OTI5ODI1MDgyNTgiIGNsYXNzPSJpY29uIiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgcC1pZD0iNDIwNyIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIj48cGF0aCBkPSJNNjY0LjQ4IDIzNC40MzJhMzIgMzIgMCAwIDAtNDUuMjQ4LTAuOGwtNzYuMjU2IDczLjYtNzMuMzQ0LTczLjIxNmEzMiAzMiAwIDEgMC00NS4yNDggNDUuMzEybDcyLjM4NCA3Mi4yNTZoLTQ5LjI4YTMyIDMyIDAgMCAwIDAgNjRoNjMuNzc2djMyaC02My43NzZhMzIgMzIgMCAwIDAgMCA2NGg2My43NzZ2NjUuNjY0YTMyIDMyIDAgMSAwIDY0IDB2LTY1LjY2NGg2NC4yODhhMzIgMzIgMCAxIDAgMC02NGgtNjQuMjg4di0zMmg2NC4yODhhMzIgMzIgMCAxIDAgMC02NGgtNTAuMzY4bDc0LjQ2NC03MS44NzJhMzIuMDMyIDMyLjAzMiAwIDAgMCAwLjgzMi00NS4yOHogbTI3NS4yIDUwMy41NTJhOTAxNy41NjggOTAxNy41NjggMCAwIDAtMTQxLjY2NC01Ni43MzYgMzY4LjUxMiAzNjguNTEyIDAgMCAwIDk3LjU2OC0yNDguNjA4YzAtMjAyLjkxMi0xNjUuMTItMzY4LTM2OC4wNjQtMzY4cy0zNjggMTY1LjA4OC0zNjggMzY4YzAgMTYuMjI0IDEuMDI0IDMyLjM1MiAzLjA3MiA0Ny45NjggMi4zMDQgMTcuNTA0IDE4LjQ5NiAyOS42NjQgMzUuOTA0IDI3LjU4NGEzMiAzMiAwIDAgMCAyNy41ODQtMzUuOTA0IDMwNC41MTIgMzA0LjUxMiAwIDAgMS0yLjU2LTM5LjY0OGMwLTE2Ny42MTYgMTM2LjM4NC0zMDQgMzA0LTMwNCAxNjcuNjQ4IDAgMzA0LjA2NCAxMzYuMzg0IDMwNC4wNjQgMzA0YTMwMC41NDQgMzAwLjU0NCAwIDAgMS05Ni4xMjggMjIxLjQ3MmMtMC43NjggMC43MzYtMS4wODggMS43Ni0xLjgyNCAyLjUyOC00Mi44NDgtMTUuOTM2LTc5LjMyOC0yOC40OC05My43Ni0zMC42NTYtMjQuODk2LTMuOTA0LTQ4LjY3MiA3LjYxNi02My4xMDQgMjguODk2LTEyLjAzMiAxNy43OTItMTUuMDcyIDM4LjgxNi04LjA5NiA1Ni4yNTYgNC4yODggMTAuNjU2IDIwLjUxMiAzMi44OTYgMzkuNzc2IDU3LjI4LTQ2LjQzMi0wLjA2NC0xMTcuMzEyLTYuMzM2LTE5Mi44MzItMzUuNDg4LTMxLjI2NC0xMi4wNjQtNjkuNDQtNTIuNjQtMTAzLjEzNi04OC40MTYtNDcuOTY4LTUwLjk3Ni05My4yOC05OS4xMDQtMTQyLjU2LTk5LjEwNC0xOC4zMzYgMC0zNS43NDQgNi44NDgtNTAuMzM2IDE5Ljc3Ni0xOC4yNCAxNi4yMjQtMzUuMTM2IDQ4LjMyLTEyIDEwOS4yNDggNDIuNjI0IDExMi4xNiAyMDguNTQ0IDI4NS4xMiAzNDEuNzI4IDI4NS4xMmg0NzguMTQ0YTMyIDMyIDAgMCAwIDMyLTMydi0xNjBhMzEuODQgMzEuODQgMCAwIDAtMTkuNzc2LTI5LjU2OHogbS00NC4xNiAxNTcuNmgtNDQ1LjEybC0xLjAyNCAzMnYtMzJjLTk3LjYgMC0yNDcuMDcyLTE1Mi4xMjgtMjgxLjkyLTI0My44NzItMTAuMTEyLTI2LjY1Ni02LjcyLTM3LjQwOC01LjM0NC0zOC42MjQgNC4xMjgtMy42NDggNi41MjgtMy42NDggNy44NC0zLjY0OCAyMS42MzIgMCA2NC42MDggNDUuNjMyIDk1Ljk2OCA3OC45NDQgNDAuMjI0IDQyLjc1MiA4MS44NTYgODYuOTQ0IDEyNi42NTYgMTA0LjI1NiA4NS4yMTYgMzIuODk2IDE2NC44OTYgMzkuODA4IDIxNi43MzYgMzkuODA4IDQxLjM3NiAwIDY3LjU4NC00LjM1MiA2OC42NzItNC41NDRhMzIgMzIgMCAwIDAgMTkuMTM2LTUyLjE2Yy0yNy4wMDgtMzIuMDk2LTU4LjU5Mi03MS44MDgtNjcuMjk2LTg1LjM0NCAwLjI4OC0wLjU3NiAwLjUxMi0xLjAyNCAwLjM1Mi0xLjE1MiAyMi44NDggMy40ODggMTYyLjQzMiA1Ny45NTIgMjY1LjI4IDk5Ljg0djEwNi40OTZ6IiBwLWlkPSI0MjA4Ij48L3BhdGg+PC9zdmc+JzsKdmFyIHNldF9zdmcgPSAnPHN2ZyB0PSIxNTkyOTgyOTcwMzc1IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjEwMTEyIiB3aWR0aD0iNDgiIGhlaWdodD0iNDgiPjxwYXRoIGQ9Ik0yNTYgMTAyLjRoNTEybDI1NiAyNTYtNTEyIDU2My4yTDAgMzU4LjR6IiBmaWxsPSIjMjZDRDYzIiBwLWlkPSIxMDExMyI+PC9wYXRoPjxwYXRoIGQ9Ik0yNTYgMTAyLjRsMjU2IDI1Nkgwek03NjggMTAyLjRsMjU2IDI1Nkg1MTJ6TTUxMiA5MjEuNmwyMDQuOC01NjMuMkgzMDcuMnoiIGZpbGw9IiMxNEEzNDUiIHAtaWQ9IjEwMTE0Ij48L3BhdGg+PC9zdmc+JzsKCi8vIGpxdWVyeS5zaG93dGlwcy5qcwooZnVuY3Rpb24oalF1ZXJ5KSB7CglqUXVlcnkuZm4uc2hvd1RpcHMgPSBmdW5jdGlvbihvcHRpb25zLGVsZW0pewoJCXZhciBjb25maWcgPSB7CgkJCXNraW46InRyaXBzIiwKCQkJY29udGVudDokKHRoaXMpLmF0dHIoInRpcHMiKXx8IuW8ueWHuuexu+Wei+eahOawlOazoeaPkOekuu+8gSIsICAvL+awlOazoeaPkOekuuWGheWuuemHjOmdouWPr+S7peaYr0hUTUzvvIzpu5jorqTmmL7npLroh6rlrprkuYnnmoTmj5DnpLrlhoXlrrkKCQkJd2lkdGg6ImF1dG8iLCAgLy/pu5jorqTkuLphdXRv77yM5Y+v5Lul5YaZ5YW35L2T5bC65a+45aaC77yaMjAwCgkJCWFsaWduVG86WyJyaWdodCIsImNlbnRlciJdLCAgLy/nrq3lpLTmlrnlkJEKCQkJY29sb3I6WyJyZ2IoMjQ3LCAyMDYsIDU3KSIsIiNGRkZFRjQiXSwgIC8v6L+Z6YeM5piv5o+Q56S65bGC55qE6aOO5qC877yM56ys5LiA5Liq5Y+C5pWw5Li65o+Q56S66L655qGG6aKc6Imy77yM56ys5LqM5Liq5Y+C5pWw5Li65o+Q56S66IOM5pmv6aKc6ImyCgkJCXR5cGU6Imh0bWwiLCAgIC8v5pi+56S65YaF5a6557G75Z6LCgkJCXRyaWdnZXI6ImNsaWNrIiwgICAgLy/pu5jorqTkuLrngrnlh7vmmL7npLrvvIxzaG935Li65Yid5aeL5YyW5bCx5pi+56S677yMaG92ZXLkuLrnu4/ov4fmmL7npLrvvIxmb2N1c+eEpueCueaYvuekuu+8jG1vdXNl6Lef6ZqP6byg5qCH5pi+56S66ZqQ6JePCgkJCXNwYWNpbmc6MTAsICAvL+m7mOiupOS4uueureWktOi3neemu+WvueixoeeahOWwuuWvuAoJCQljdXN0b21pZDoiIiwgIC8v6Ieq5a6a5LmJSUQKCQkJaXNjbG9zZTpmYWxzZSwgICAvL+aYr+WQpuaYvuekuuWFs+mXreaMiemSrgoJCQlzdWNjZXNzIDogbnVsbCAgICAvL+aIkOWKn+WQjueahOWbnuiwg+WHveaVsAoJCX07CgkJdmFyIG9wdHMgPSBqUXVlcnkuZXh0ZW5kKGNvbmZpZywgb3B0aW9ucyk7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpewoJCQl2YXIgdGhhdCA9IGpRdWVyeSh0aGlzKSx0aXBCb3gsdGlwSWQsc2VsZkgsc2VsZlcsY29uSWQsZG9jVywgc3BhID0gb3B0cy5zcGFjaW5nLCBza2luPW9wdHMuc2tpbjsKCQkJdmFyIE1hdGhyYW5kb20gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5OTk5OTk5KTsKICAgICAgICAgICAgdmFyIHBtciA9IChvcHRzLmN1c3RvbWlkPT0iIikgPyBNYXRocmFuZG9tIDpvcHRzLmN1c3RvbWlkLnJlcGxhY2UoL1sjLl0vLCAiIik7CgkJCXZhciBwb2ludGVyPW9wdHMuYWxpZ25Uby5sZW5ndGg9PT0xID8gJycrb3B0cy5hbGlnblRvWzBdKycnIDogJycrb3B0cy5hbGlnblRvWzBdKyctJytvcHRzLmFsaWduVG9bMV0rJyc7CgoJCQlpZih0eXBlb2YgZWxlbSA9PSAnc3RyaW5nJykgewoJCQkJaWYoZWxlbSA9PSJzaG93Iil7CgkJCQkJalF1ZXJ5KCcjdGlwJytwbXIpLnNob3coKTsgIGpRdWVyeSgiI2NvbiIrcG1yKS5odG1sKG9wdHMuY29udGVudCk7CgkJCQkJc2hvd1Bvc2l0aW9uKHBvaW50ZXIsalF1ZXJ5KCcjdGlwJytwbXIpKTsKCQkJCQl9OwoJCQkJaWYoZWxlbSA9PSJoaWRlIil7alF1ZXJ5KCcjdGlwJytwbXIpLmhpZGUoKX07CgkJCX07CgkJCWlmKHR5cGVvZiBlbGVtID09ICcnIHx8IHR5cGVvZiBlbGVtID09IHVuZGVmaW5lZCl7cmV0dXJuIHRydWV9OwoJCQlpZihqUXVlcnkoJyN0aXAnK3BtcikubGVuZ3RoPT0xKXtyZXR1cm4gZmFsc2U7fQoJCQl0aXBCb3g9alF1ZXJ5KCc8ZGl2IGNsYXNzPSInK3NraW4rJyAnK3NraW4rJy0nK3BvaW50ZXIrJyIgaWQ9InRpcCcrcG1yKyciPjxpPjwvaT48ZW0+PC9lbT48ZGl2IGNsYXNzPSInK3NraW4rJ2NvbiIgaWQ9ImNvbicrcG1yKyciPjwvZGl2PjwvZGl2PicpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpOwoJCQl0aXBJZCA9IGpRdWVyeSgiI3RpcCIrcG1yKTsKCQkJY29uSWQgPSBqUXVlcnkoIiNjb24iK3Btcik7CgoJCQl2YXIgZWRnZWNvbG9yPSdib3JkZXItJytvcHRzLmFsaWduVG9bMF0rJy1jb2xvcicsIHRmaT10aXBJZC5maW5kKCJpIiksIHRmZW09dGlwSWQuZmluZCgiZW0iKSwgdGZpZW09dGlwSWQuZmluZCgiaSxlbSIpOwoJCQl0aXBJZC5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJyxib3JkZXI6JzFweCBzb2xpZCcsJ2JvcmRlci1jb2xvcic6b3B0cy5jb2xvclswXSwnYmFja2dyb3VuZC1jb2xvcic6b3B0cy5jb2xvclsxXX0pOwoJCQlpZihvcHRzLmFsaWduVG9bMV09PSdjZW50ZXInKXsgdmFyIG9mZnBvcz01MCxwZXJjZW49IiUiOyB9ZWxzZXsgdmFyIG9mZnBvcz01LHBlcmNlbj0icHgiOyB9OwoJCQl0ZmllbS5jc3Moe3dpZHRoOjAsaGVpZ2h0OjAsY29udGVudDonJywncG9zaXRpb24nOidhYnNvbHV0ZSd9KQoJCQl0ZmkuY3NzKHtib3JkZXI6JzhweCBzb2xpZCB0cmFuc3BhcmVudCcsJ3otaW5kZXgnOjV9KTsKCQkJdGZlbS5jc3Moe2JvcmRlcjonN3B4IHNvbGlkIHRyYW5zcGFyZW50Jywnei1pbmRleCc6MTB9KTsKCQkJc3dpdGNoIChwb2ludGVyKSB7CgkJCQljYXNlICd0b3AtY2VudGVyJzoKCQkJCWNhc2UgJ2JvdHRvbS1jZW50ZXInOgoJCQkJY2FzZSAndG9wLWxlZnQnOgoJCQkJY2FzZSAnYm90dG9tLWxlZnQnOgoJCQkJCXZhciBwb2k9ImxlZnQiOwoJCQkJCWlmKHBvaW50ZXI9PSd0b3AtY2VudGVyJyB8fCBwb2ludGVyPT0nYm90dG9tLWNlbnRlcicpewoJCQkJCQl0ZmkuY3NzKHsibWFyZ2luLWxlZnQiOiItOHB4In0pOwoJCQkJCQl0ZmVtLmNzcyh7Im1hcmdpbi1sZWZ0IjoiLTdweCJ9KTsKCQkJCQl9CgkJCQkgICAgYnJlYWs7CgkJCQljYXNlICdsZWZ0LWNlbnRlcic6CgkJCQljYXNlICdyaWdodC1jZW50ZXInOgoJCQkJY2FzZSAnbGVmdC10b3AnOgoJCQkJY2FzZSAncmlnaHQtdG9wJzoKCQkJCQl2YXIgcG9pPSJ0b3AiOwoJCQkJCWlmKHBvaW50ZXI9PSdsZWZ0LWNlbnRlcicgfHwgcG9pbnRlcj09J3JpZ2h0LWNlbnRlcicpewoJCQkJCQl0ZmkuY3NzKHsibWFyZ2luLXRvcCI6Ii04cHgifSk7CgkJCQkJCXRmZW0uY3NzKHsibWFyZ2luLXRvcCI6Ii03cHgifSk7CgkJCQkJfQoJCQkJICAgIGJyZWFrOwoJCQkJZGVmYXVsdDoKCQkJCQl2YXIgcG9pPSJyaWdodCI7CgkJCQkgICAgYnJlYWs7CgkJCX07CgoJCQlpZihwb2ludGVyPT0nZm9sbG93Jyl7CgkJCQl0ZmkuY3NzKHsnYm9yZGVyLWJvdHRvbS1jb2xvcic6b3B0cy5jb2xvclswXSxsZWZ0OicnK29mZnBvcytwZXJjZW4rJycsYm90dG9tOicxMDAlJ30pOwoJCQkJdGZlbS5jc3Moeydib3JkZXItYm90dG9tLWNvbG9yJzpvcHRzLmNvbG9yWzFdLGxlZnQ6JycrKG9mZnBvcysob3B0cy5hbGlnblRvWzFdPT0nY2VudGVyJz8wOjEpKStwZXJjZW4rJycsYm90dG9tOicxMDAlJ30pOwoJCQl9ZWxzZXsKCQkJCXRmaS5jc3MoZWRnZWNvbG9yLG9wdHMuY29sb3JbMF0pLmNzcyhwb2ksJycrb2ZmcG9zK3BlcmNlbisnJyk7CgkJCQl0ZmVtLmNzcyhlZGdlY29sb3Isb3B0cy5jb2xvclsxXSkuY3NzKHBvaSwnJysob2ZmcG9zKyhvcHRzLmFsaWduVG9bMV09PSdjZW50ZXInPzA6MSkpK3BlcmNlbisnJyk7CgkJCQl0ZmllbS5jc3Mob3B0cy5hbGlnblRvWzBdLCcxMDAlJyk7CgkJCX07CgoJCQlzd2l0Y2ggKG9wdHMudHlwZSkgewoJCQkJY2FzZSAnaHRtbCc6Y29uSWQuaHRtbChvcHRzLmNvbnRlbnQpOyBicmVhazsKCQkJCWNhc2UgJ2lkJyAgOgoJCQkJICAgIHZhciB0ZW1waWQ9alF1ZXJ5KG9wdHMuY29udGVudCkgLHdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCQkJCQlpZih0ZW1waWQuY3NzKCJkaXNwbGF5IikgPT0gIm5vbmUiKXsgIHRlbXBpZC5jc3Moe2Rpc3BsYXk6ImJsb2NrIn0pOyB9CgkJCQkJY29uSWQuYXBwZW5kKHRlbXBpZCk7CgkJCQkgICAgYnJlYWs7CgkJCX07CgkJCWlmKG9wdHMuaXNjbG9zZSl7CgkJCQlqUXVlcnkoJzxzcGFuIGNsYXNzPSInK3NraW4rJ2Nsb3NlIiBpZD0iY2xvc2UnK3BtcisnIj4mdGltZXM7PC9zcGFuPicpLmFwcGVuZFRvKHRpcElkKTsKCQkJCXRpcElkLmZpbmQoIiNjbG9zZSIrcG1yKyIiKS5vbigiY2xpY2siLGZ1bmN0aW9uKCl7dGlwSWQuaGlkZSgpO30pOwoJCQl9CgoJCQlpZih0eXBlb2Ygb3B0cy53aWR0aCA9PT0gJ3N0cmluZycpewoJCQkJZG9jVyA9IHBhcnNlSW50KGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGgqKG9wdHMud2lkdGgucmVwbGFjZSgnJScsJycpLzEwMCkpOwoJCQkJKHR5cGVvZiBvcHRzLndpZHRoID09ICdhdXRvJyB8fCB0eXBlb2Ygb3B0cy53aWR0aCA9PSAnJykgPyB0aXBCb3guY3NzKHt3aWR0aDonYXV0byd9KSA6IHRpcEJveC5jc3Moe3dpZHRoOmRvY1d9KTsKCQkJCXRpcEJveC5oZWlnaHQoKTsKCQkJfWVsc2V7CgkJCQl0aXBCb3gud2lkdGgob3B0cy53aWR0aCkuaGVpZ2h0KCk7CgkJCX0KICAgICAgICAgICAgZnVuY3Rpb24gc2hvd1Bvc2l0aW9uKHBvaW50ZXIsY2VsbCl7CgkJCQl2YXIgc2VsZkggPSB0aGF0Lm91dGVySGVpZ2h0KHRydWUpLCBzZWxmVyA9IHRoYXQub3V0ZXJXaWR0aCh0cnVlKTsKCQkJCXZhciBwb3N0PXRoYXQub2Zmc2V0KCkudG9wLCBwb3NsPXRoYXQub2Zmc2V0KCkubGVmdDsKCQkJCXZhciB0aXBDZWxsPShjZWxsPT0iIiB8fCBjZWxsPT11bmRlZmluZWQpID8gdGlwSWQgOiBjZWxsOwoJCQkgICAgdmFyIHRpcEg9dGlwQ2VsbC5vdXRlckhlaWdodCh0cnVlKSwgdGlwVz10aXBDZWxsLm91dGVyV2lkdGgodHJ1ZSk7CgoJCQkJc3dpdGNoIChwb2ludGVyKSB7CgkJCQkJY2FzZSAndG9wLWxlZnQnOiB0aXBDZWxsLmNzcyh7dG9wOnBvc3QtdGlwSC1zcGEsbGVmdDpwb3NsfSk7IGJyZWFrOwoJCQkJCWNhc2UgJ3RvcC1jZW50ZXInOiB0aXBDZWxsLmNzcyh7dG9wOnBvc3QtdGlwSC1zcGEsbGVmdDpwb3NsLSh0aXBXLzIpKyhzZWxmVy8yKX0pOyBicmVhazsKCQkJCQljYXNlICd0b3AtcmlnaHQnOiB0aXBDZWxsLmNzcyh7dG9wOnBvc3QtdGlwSC1zcGEsbGVmdDpwb3NsLSh0aXBXLXNlbGZXKX0pOyBicmVhazsKCQkJCQljYXNlICdib3R0b20tbGVmdCc6IHRpcENlbGwuY3NzKHt0b3A6cG9zdCtzZWxmSCtzcGEsbGVmdDpwb3NsfSk7IGJyZWFrOwoJCQkJCWNhc2UgJ2JvdHRvbS1jZW50ZXInOiB0aXBDZWxsLmNzcyh7dG9wOnBvc3Qrc2VsZkgrc3BhLGxlZnQ6cG9zbC0odGlwVy8yKSsoc2VsZlcvMil9KTsgYnJlYWs7CgkJCQkJY2FzZSAnYm90dG9tLXJpZ2h0JzogdGlwQ2VsbC5jc3Moe3RvcDpwb3N0K3NlbGZIK3NwYSxsZWZ0OnBvc2wtKHRpcFctc2VsZlcpfSk7IGJyZWFrOwoJCQkJCWNhc2UgJ2xlZnQtdG9wJzogdGlwQ2VsbC5jc3Moe3RvcDpwb3N0LGxlZnQ6cG9zbC10aXBXLXNwYX0pOyBicmVhazsKCQkJCQljYXNlICdsZWZ0LWNlbnRlcic6IHRpcENlbGwuY3NzKHt0b3A6cG9zdC0odGlwSC8yKSsoc2VsZkgvMiksbGVmdDpwb3NsLXRpcFctc3BhfSk7IGJyZWFrOwoJCQkJCWNhc2UgJ3JpZ2h0LXRvcCc6IHRpcENlbGwuY3NzKHt0b3A6cG9zdCxsZWZ0OnBvc2wrc2VsZlcrc3BhfSk7IGJyZWFrOwoJCQkJCWNhc2UgJ3JpZ2h0LWNlbnRlcic6IHRpcENlbGwuY3NzKHt0b3A6cG9zdC0odGlwSC8yKSsoc2VsZkgvMiksbGVmdDpwb3NsK3NlbGZXK3NwYX0pOyBicmVhazsKCQkJCQljYXNlICdmb2xsb3cnOiB0aGF0Lm1vdXNlbW92ZShmdW5jdGlvbihlKSB7IHRpcENlbGwuY3NzKHt0b3A6ZS5wYWdlWSArIDMwLGxlZnQ6ZS5wYWdlWCAtIDZ9KTsgfSk7IGJyZWFrOwoJCQkJfTsKCQkJfQoJCQl0aXBCb3guaGlkZSgpOwoJCQlzd2l0Y2ggKG9wdHMudHJpZ2dlcil7CgkJCQljYXNlICdzaG93JzpzaG93UG9zaXRpb24ocG9pbnRlcik7dGlwQm94LnNob3coKTticmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ2NsaWNrJzp0aGF0LmNsaWNrKGZ1bmN0aW9uKCl7c2hvd1Bvc2l0aW9uKHBvaW50ZXIpO3RpcEJveC5zaG93KCk7fSk7YnJlYWs7CgkJCQljYXNlICdob3Zlcic6dGhhdC5ob3ZlcihmdW5jdGlvbigpe3Nob3dQb3NpdGlvbihwb2ludGVyKTt0aXBCb3guc2hvdygpOyB0aXBCb3gub24oIm1vdXNlb3ZlciIsZnVuY3Rpb24oKXtqUXVlcnkodGhpcykuc2hvdygpfSkub24oIm1vdXNlb3V0IixmdW5jdGlvbigpe2pRdWVyeSh0aGlzKS5oaWRlKCl9KX0sZnVuY3Rpb24oKXt0aXBCb3guaGlkZSgpO30pO2JyZWFrOwoJCQkJY2FzZSAnZm9jdXMnOnRoYXQuZm9jdXMoZnVuY3Rpb24oKXtzaG93UG9zaXRpb24ocG9pbnRlcik7dGlwQm94LnNob3coKTt9KTsgIHRoYXQuYmx1cihmdW5jdGlvbigpe3RpcEJveC5oaWRlKCk7fSk7YnJlYWs7CgkJCQljYXNlICdtb3VzZSc6dGhhdC5ob3ZlcihmdW5jdGlvbigpe3Nob3dQb3NpdGlvbihwb2ludGVyKTt0aXBCb3guc2hvdygpO30sZnVuY3Rpb24oKXt0aXBCb3guaGlkZSgpO30pO2JyZWFrOwoJCQl9OwoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7b3B0cy5zdWNjZXNzICYmIG9wdHMuc3VjY2VzcygpO30sIDEpOwoJCX0pOwoJfQp9KShqUXVlcnkpOwoKKGZ1bmN0aW9uICgpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICBsKCJDU0ROR3JlZW5lciBWIiArIHZlcnNpb24pOwogICAgTlByb2dyZXNzLnN0YXJ0KCk7CgogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYmxvY2tVUkwgPSBjdXJyZW50VVJMLnNwbGl0KCIvIikubGVuZ3RoOwogICAgICAgIHZhciBtYWluID0gLyh3d3dcLmNzZG5cLm5ldFwvKSQvOwogICAgICAgIHZhciBtYWluTmF2ID0gL25hdi87CiAgICAgICAgdmFyIGFydGljbGUgPSAvYXJ0aWNsZS87CiAgICAgICAgdmFyIGJicyA9IC9iYnNcLmNzZG5cLm5ldC87CiAgICAgICAgdmFyIGJsb2cgPSAvYmxvZ1wuY3NkblwubmV0LzsKICAgICAgICB2YXIgYmxvZzIgPSAvXC9hcnRpY2xlXC9saXN0XC8vOwogICAgICAgIHZhciBkb3dubG9hZCA9IC9kb3dubG9hZFwuY3NkblwubmV0LzsKICAgICAgICB2YXIgbG9naW4gPSAvcGFzc3BvcnRcLmNzZG5cLm5ldC87CiAgICAgICAgdmFyIHpvbmUgPSAvbWVcLmNzZG5cLm5ldC87CiAgICAgICAgdmFyIG90aGVyID0gLyh3d3dcLmNzZG5cLm5ldFwvKS87CiAgICAgICAgdmFyIG1wID0gL21wXC5jc2RuXC5uZXQvOwoKICAgICAgICAvLyDmlbDnu4TliJ3lp4vljJYKICAgICAgICBsaXN0ID0gW107CiAgICAgICAgLy8g5aS06YOo5YiGCiAgICAgICAgLy8gQVBQCiAgICAgICAgLy8gcHV0KCIuYXBwLWFwcCIpOwogICAgICAgIC8vIFZJUAogICAgICAgIHB1dCgiLnZpcC1jYWlzZSIpOwogICAgICAgIC8vIOiusOW9leS9oOeahOaIkOmVv+WOhueoi++8iOiusOS4quavm++8iQogICAgICAgIHB1dCgiI3dyaXRlR3VpZGUiKTsKICAgICAgICAvLyDmlrDpgJrnn6XlsI/lnIbngrnvvIjmnKrnmbvlvZXmiY3mtojmjonvvIkKICAgICAgICBpZiAoJCgiLnVzZXJpbmZvIGEiKS50ZXh0KCkgPT09ICfnmbvlvZUv5rOo5YaMJykgewogICAgICAgICAgICBwdXQoIiNtc2ctY2lyY2xlIik7CiAgICAgICAgfQogICAgICAgIC8vIOmhtumDqOiwt+atjOW5v+WRigogICAgICAgIHB1dCgiLmFkc2J5Z29vZ2xlIik7CiAgICAgICAgLy8g5oKs5rWu5Zyo6aG25qCP5oyJ6ZKu5LiK5Ye6546w55qE5LqM57u056CBCiAgICAgICAgcHV0KCIuYXBwQ29udHJvbCIpOwogICAgICAgIC8vIOmhtumDqOW5v+WRigogICAgICAgIHB1dCgiLmFkdmVydC1iZyIpOwoKICAgICAgICBpZiAobWFpbi50ZXN0KGN1cnJlbnRVUkwpIHx8IG1haW5OYXYudGVzdChjdXJyZW50VVJMKSkgewogICAgICAgICAgICBsKCLmraPlnKjkvJjljJbkuLvpobXkvZPpqowuLi4iKTsKICAgICAgICAgICAgLy8g5bi46KeECiAgICAgICAgICAgIC8vIOWktOmDqOW5v+WRigogICAgICAgICAgICBwdXQoIi5iYW5uZXItYWQtYm94Iik7CiAgICAgICAgICAgIC8vIOW1jOWFpeW5v+WRigogICAgICAgICAgICBwdXQoIiNrcF9ib3hfMjExIik7CiAgICAgICAgICAgIC8vIOWPs+S+p+W5v+WRigogICAgICAgICAgICBwdXQoIi5zbGlkZS1vdXRlciIpOwogICAgICAgICAgICAvLyDlj7Pkvqfor6bmg4UKICAgICAgICAgICAgcHV0KCIucGVyc2lvbl9hcnRpY2xlIik7CiAgICAgICAgICAgIC8vIOWPs+S+p+aOqOiNkAogICAgICAgICAgICAkKCIuZmVlZF9jb21wYW55IikucGFyZW50KCkucmVtb3ZlKCk7CiAgICAgICAgICAgIC8vIOW5v+WRiui9ruaSrQogICAgICAgICAgICBwdXQoIi5lbC1jYXJvdXNlbF9fY29udGFpbmVyIik7CiAgICAgICAgICAgIC8vIOmhtumDqOaoquW5hQogICAgICAgICAgICBwdXQoIi50b29sYmFyLWFkdmVydCIpOwogICAgICAgICAgICAvLyDpobbmoI9WSVDpgInpobkKICAgICAgICAgICAgJCgnLnRvb2xiYXItc3ViTWVudS1ib3gnKS5maW5kKCJbaHJlZj0naHR0cHM6Ly9tYWxsLmNzZG4ubmV0L3ZpcCddIikucGFyZW50KCkucmVtb3ZlKCk7CiAgICAgICAgICAgIGNsZWFuKDEwKTsKICAgICAgICAgICAgLy8gY29tbW9uKDUsIDEwKTsKICAgICAgICAgICAgbG9vcCgzKTsKICAgICAgICAgICAgbG9vcCgxKTsKICAgICAgICB9IGVsc2UgaWYgKChibG9nLnRlc3QoY3VycmVudFVSTCkgJiYgYmxvY2tVUkwgPT09IDQpIHx8IGJsb2cyLnRlc3QoY3VycmVudFVSTCkpIHsKICAgICAgICAgICAgbCgi5q2j5Zyo5LyY5YyW5Liq5Lq65Y2a5a6i5Li76aG15L2T6aqMLi4uIik7CiAgICAgICAgICAgIC8vIOW4uOinhAogICAgICAgICAgICAvLyDlpLTpg6jlub/lkYoKICAgICAgICAgICAgcHV0KCIuYmFubmVyLWFkLWJveCIpOwogICAgICAgICAgICAvLyDlj7Pkvqflub/lkYoKICAgICAgICAgICAgcHV0KCIuc2xpZGUtb3V0ZXIiKTsKICAgICAgICAgICAgLy8g5Y+z5L6n6K+m5oOFCiAgICAgICAgICAgIHB1dCgiLnBlcnNpb25fYXJ0aWNsZSIpOwogICAgICAgICAgICAvLyDlt6bkvqflub/lkYoKICAgICAgICAgICAgcHV0KCIubWI4Iik7CiAgICAgICAgICAgIHB1dCgiI2twX2JveF81MDMiKTsKICAgICAgICAgICAgcHV0KCIja3BfYm94XzIxNCIpOwogICAgICAgICAgICBjbGVhbigxMCk7CiAgICAgICAgICAgIC8vIGNvbW1vbig1LCAxMCk7CiAgICAgICAgICAgIGxvb3AoMyk7CiAgICAgICAgICAgIGxvb3AoMSk7CiAgICAgICAgfSBlbHNlIGlmIChhcnRpY2xlLnRlc3QoY3VycmVudFVSTCkgJiYgIW1wLnRlc3QoY3VycmVudFVSTCkpIHsKICAgICAgICAgICAgbCgi5q2j5Zyo5LyY5YyW6ZiF6K+75L2T6aqMLi4uIik7CiAgICAgICAgICAgIC8vIOW4uOinhAogICAgICAgICAgICAvLyDlj7Pkvqflub/lkYrvvIzmlL7liLDnrKzkuIDkuKrmuIXpmaQKICAgICAgICAgICAgLy8gcHV0KCIucmVjb21tZW5kLXJpZ2h0Iik7CiAgICAgICAgICAgIHB1dCgiI2FkZEFkQm94Iik7CiAgICAgICAgICAgIC8vIHB1dCgiLmFzaWRlLWJveC5raW5kX3BlcnNvbi5kLWZsZXguZmxleC1jb2x1bW4iKTsKICAgICAgICAgICAgcHV0KCIucmVjb21tZW5kLXRvcC1hZGJveCIpOwogICAgICAgICAgICAvLyBwdXQoIi5yZWNvbW1lbmQtbGlzdC1ib3guZC1mbGV4LmZsZXgtY29sdW1uLmFzaWRlLWJveCIpOwogICAgICAgICAgICAvLyDlt6bkvqflub/lkYoKICAgICAgICAgICAgLy8gcHV0KCIjY29udGFpbmVyIik7CiAgICAgICAgICAgIC8vIOW/q+adpeWGmeWNmuWuouWQpwogICAgICAgICAgICBwdXQoIi5ibG9nX3RpcF9ib3giKTsKICAgICAgICAgICAgLy8g5o6o6I2Q5YWz5rOo55So5oi3CiAgICAgICAgICAgIHB1dCgiLmJsb2ctZXhwZXJ0LXJlY29tbWVuZC1ib3giKTsKICAgICAgICAgICAgLy8g5Y+z5LiL6KeSVklQCiAgICAgICAgICAgIHB1dCgiLm1lYXUtZ290b3AtYm94Iik7CiAgICAgICAgICAgIC8vIOW5v+WRigogICAgICAgICAgICBwdXQoIi5tZWRpYXZfYWQiKTsKICAgICAgICAgICAgcHV0KCIucHVsbGxvZy1ib3giKTsKICAgICAgICAgICAgcHV0KCIucmVjb21tZW5kLWFkLWJveCIpOwogICAgICAgICAgICBwdXQoIi5ib3gtc2hhZG93Iik7CiAgICAgICAgICAgIHB1dCgiLnR5cGVfaG90X3dvcmQiKTsKICAgICAgICAgICAgcHV0KCIuZm91cnRoX2NvbHVtbiIpOwogICAgICAgICAgICAvLyDpq5jliIbovqjnjofml7blj7Pkvqfmlofnq6DmjqjojZAKICAgICAgICAgICAgLy8gcHV0KCIucmlnaHQtaXRlbSIpOwogICAgICAgICAgICAvLyDlub/lkYoKICAgICAgICAgICAgcHV0KCIjYXNpZGVGb290ZXIiKTsKICAgICAgICAgICAgcHV0KCIjYWQtZGl2Iik7CiAgICAgICAgICAgIHB1dCgiIzQ3OSIpOwogICAgICAgICAgICBwdXQoIiM0ODAiKTsKICAgICAgICAgICAgLy8g5omT6LWPCiAgICAgICAgICAgIHB1dCgiLnBvc3RUaW1lIik7CiAgICAgICAgICAgIC8vIOivvueoi+aOqOiNkAogICAgICAgICAgICBwdXQoIi50MCIpOwogICAgICAgICAgICAvLyDliIbkuqvmtbfmiqUKICAgICAgICAgICAgcHV0KCIuc2hhcmVTdWdnZXN0Iik7CiAgICAgICAgICAgIC8vIOW6lemDqOS4u+mimAogICAgICAgICAgICBwdXQoIi50ZW1wbGF0ZS1ib3giKTsKICAgICAgICAgICAgLy8g6K+E6K665Yy65bm/5ZGKCiAgICAgICAgICAgIHB1dCgiZGl2I2RtcF9hZF81OCIpOwogICAgICAgICAgICAvLyDmiZPotY8KICAgICAgICAgICAgcHV0KCIucmV3YXJkLXVzZXItYm94Iik7CiAgICAgICAgICAgIC8vIOWPs+S+p+aJk+i1j+aMiemSrgogICAgICAgICAgICBwdXQoIi50by1yZXdhcmQiKTsKICAgICAgICAgICAgLy8g5o6o6I2Q5YaF5a655bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLnJlY29tbWVuZC1yZWNvbW1lbmQtYm94Iik7CiAgICAgICAgICAgIC8vIOWPs+S+p+W5v+WRigogICAgICAgICAgICBwdXQoIi5pbmRleFN1cGVyaXNlIik7CiAgICAgICAgICAgIC8vIOaKouaymeWPkeinkuaghwogICAgICAgICAgICBwdXQoIi5jb21tZW50LXNvZmEtZmxhZyIpOwogICAgICAgICAgICAvLyDpobVqaW8KICAgICAgICAgICAgcHV0KCIuYm90dG9tLXB1Yi1mb290ZXIiKTsKICAgICAgICAgICAgLy8g55m75b2V5p+l55yL5pyq6K+75raI5oGvCiAgICAgICAgICAgIHB1dCgiLnRvb2xiYXItbm90aWNlLWJ1YmJsZSIpOwogICAgICAgICAgICAvLyDlj7Pkvqflub/lkYoKICAgICAgICAgICAgcHV0KCIucmVjb21tZW5kLXRvcC1hZGJveCIpOwogICAgICAgICAgICAvLyDlj7Pkvqflm5vkuKrlub/lkYoKICAgICAgICAgICAgcHV0KCIucHJvZ3JhbW1lcjFCb3giKTsKICAgICAgICAgICAgcHV0KCIucHJvZ3JhbW1lcjJCb3giKTsKICAgICAgICAgICAgcHV0KCIucHJvZ3JhbW1lcjNCb3giKTsKICAgICAgICAgICAgcHV0KCIucHJvZ3JhbW1lcjRCb3giKTsKICAgICAgICAgICAgLy8g54K56LWe5rCU5rOhCiAgICAgICAgICAgIHB1dCgiLnRyaXBsZXQtcHJvbXB0Iik7CiAgICAgICAgICAgIC8vIOmhtumDqOaoquW5hQogICAgICAgICAgICBwdXQoIi50b29sYmFyLWFkdmVydCIpOwogICAgICAgICAgICAvLyDlupXpg6jkv6Hmga8KICAgICAgICAgICAgcHV0KCIuYmxvZy1mb290ZXItYm90dG9tIik7CiAgICAgICAgICAgIGNsZWFuKDEwKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgLy8g5bGV5byA6K+E6K6655qE5omA5pyJ5Zue5aSNCiAgICAgICAgICAgICAgICQoJy5idG4tcmVhZC1yZXBseScpLmNsaWNrKCk7CiAgICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgICAvLyDkuLvliqjliqDlhaXlj7PkvqfmoI8KICAgICAgICAgICAgaWYgKCQoIi5yZWNvbW1lbmQtcmlnaHQiKS5sZW5ndGggPT09IDApIHskKCIjbWFpbkJveCIpLmFmdGVyKCc8ZGl2IGNsYXNzPSJyZWNvbW1lbmQtcmlnaHQgIGFsaWduLWl0ZW1zLXN0cmV0Y2ggY2xlYXJmaXgiIGlkPSJyaWdodEFzaWRlIj48YXNpZGUgY2xhc3M9InJlY29tbWVuZC1yaWdodF9hc2lkZSI+PGRpdiBpZD0icmVjb21tZW5kLXJpZ2h0IiBzdHlsZT0iaGVpZ2h0OiAxMDAlOyBwb3NpdGlvbjogZml4ZWQ7IHRvcDogNTJweDsgb3ZlcmZsb3c6IHNjcm9sbDsiPjwvZGl2PjwvYXNpZGU+PC9kaXY+Jyk7fQogICAgICAgICAgICAvLyDnu7/ljJborr7nva4KICAgICAgICAgICAgY29tbW9uKDYsIDEpOwogICAgICAgICAgICAvLyDlsY/luZXpgILphY0KICAgICAgICAgICAgY29tbW9uKDQsIDEpOwogICAgICAgICAgICAvLyDor4TorroKICAgICAgICAgICAgY29tbW9uKDEsIDMwKTsKICAgICAgICAgICAgLy8g5YW25a6DCiAgICAgICAgICAgIGNvbW1vbigyLCAyMCk7CiAgICAgICAgICAgIC8vIOmhtumDqOaYvuekuuS9nOiAheS/oeaBrwogICAgICAgICAgICBjb21tb24oOCwgMSk7CiAgICAgICAgICAgIC8vIOW+queOr+e6v+eoi+W8gOWniwogICAgICAgICAgICBsb29wKDIpOwogICAgICAgICAgICBsb29wKDMpOwogICAgICAgIH0gZWxzZSBpZiAoYmJzLnRlc3QoY3VycmVudFVSTCkpIHsKICAgICAgICAgICAgbCgi5q2j5Zyo5LyY5YyW6K665Z2b5L2T6aqMLi4uIik7CiAgICAgICAgICAgIC8vIOW4uOinhAogICAgICAgICAgICAvLyDor4TorrrltYzlhaXlsI/lub/lkYoKICAgICAgICAgICAgcHV0KCIucG9zdF9yZWNvbW1lbmQiKTsKICAgICAgICAgICAgLy8g5bqV6YOo5o6o6I2QCiAgICAgICAgICAgIHB1dCgiI3Bvc3RfZmVlZF93cmFwIik7CiAgICAgICAgICAgIC8vIOW6lemDqOebuOWFs+aWh+eroOmHjOmdoueahOW5v+WRigogICAgICAgICAgICBwdXQoIi5iYnNfZmVlZF9hZF9ib3giKTsKICAgICAgICAgICAgcHV0KCIucmVjb21tZW5kLWFkLWJveCIpOwogICAgICAgICAgICAvLyDlupXpg6jnm7jlhbPmloflrZfph4zpnaLnmoTng63or43mj5DnpLoKICAgICAgICAgICAgcHV0KCIudHlwZV9ob3Rfd29yZCIpOwogICAgICAgICAgICAvLyDlupXpg6jok53oibJmbGV45bGe5oCn55qE5bm/5ZGK5qCPK+eZu+W9leazqOWGjOahhgogICAgICAgICAgICBwdXQoIi5wdWxsbG9nLWJveCIpOwogICAgICAgICAgICAvLyDnjJzkvaDllpzmrKIKICAgICAgICAgICAgcHV0KCIucGVyc29uYWxpemVkLXJlY29tbWVuZC1ib3giKTsKICAgICAgICAgICAgLy8g5Y+R5biW5YeP5Y2K5o+Q56S6CiAgICAgICAgICAgIHB1dCgiLnRvdGFzdC1ib3giKTsKICAgICAgICAgICAgLy8g6aG26YOo5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLnJlY29tbWVuZC1yaWdodCIpOwogICAgICAgICAgICAvLyDpobbpg6jlub/lkYoKICAgICAgICAgICAgcHV0KCIuYWRfdG9wIik7CiAgICAgICAgICAgIGNsZWFuKDEwKTsKICAgICAgICAgICAgLy8g5bGV5byACiAgICAgICAgICAgIGNvbW1vbigzLCA1MCk7CiAgICAgICAgICAgIC8vIGNvbW1vbig1LCAxMCk7CiAgICAgICAgICAgIGxvb3AoMyk7CiAgICAgICAgfSBlbHNlIGlmIChkb3dubG9hZC50ZXN0KGN1cnJlbnRVUkwpKSB7CiAgICAgICAgICAgIGwoIuato+WcqOS8mOWMluS4i+i9vemhteS9k+mqjC4uLiIpOwogICAgICAgICAgICAvLyDluLjop4QKICAgICAgICAgICAgcHV0KCIuZml4ZWRfZGwiKTsKICAgICAgICAgICAgcHV0KCJpbmRleFN1cGVyaXNlIik7CiAgICAgICAgICAgIC8vIOWPs+S+p+aOqOiNkAogICAgICAgICAgICBwdXQoIi5jb250ZW50X3JlY29tIik7CiAgICAgICAgICAgIGNsZWFuKDEwKTsKICAgICAgICAgICAgLy8gY29tbW9uKDUsIDEwKTsKICAgICAgICAgICAgbG9vcCgzKTsKICAgICAgICB9IGVsc2UgaWYgKGxvZ2luLnRlc3QoY3VycmVudFVSTCkpIHsKICAgICAgICAgICAgbCgi5q2j5Zyo5LyY5YyW55m75b2V6aG15L2T6aqMLi4uIik7CiAgICAgICAgICAgIC8vIOW4uOinhAogICAgICAgICAgICAvLyDnmbvlvZXnlYzpnaLlpKflm77lub/lkYoKICAgICAgICAgICAgcHV0KCIubWFpbi10dSIpOwogICAgICAgICAgICBjbGVhbigxMCk7CiAgICAgICAgICAgIC8vIGNvbW1vbig1LCAxMCk7CiAgICAgICAgICAgIGxvb3AoMyk7CiAgICAgICAgfSBlbHNlIGlmICh6b25lLnRlc3QoY3VycmVudFVSTCkpIHsKICAgICAgICAgICAgbCgi5q2j5Zyo5LyY5YyW5Liq5Lq656m66Ze05L2T6aqMLi4uIik7CiAgICAgICAgICAgIC8vIOW4uOinhAogICAgICAgICAgICBjbGVhbigxMCk7CiAgICAgICAgICAgIGNvbW1vbig3LCAxMCk7CiAgICAgICAgICAgIC8vIGNvbW1vbig1LCAxMCk7CiAgICAgICAgICAgIGxvb3AoMyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbCgi5ZOm6LGB77yM5aW95YGP6Zeo55qE6aG16Z2i77yM5oiR5p2l6K+V552A5LyY5YyW5LiA5LiL5ZOmLi4uIik7CiAgICAgICAgICAgIC8vIOW4uOinhAogICAgICAgICAgICAvLyDlsZXlvIDlhajmlocKICAgICAgICAgICAgJCgnLnJlYWRtb3JlX2J0bicpLmNsaWNrKCk7CiAgICAgICAgICAgIC8vICoqKiBpbmRleCAqKioKICAgICAgICAgICAgLy8g5aS06YOo5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLmJhbm5lci1hZC1ib3giKTsKICAgICAgICAgICAgLy8g5bWM5YWl5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiI2twX2JveF8yMTEiKTsKICAgICAgICAgICAgLy8g5Y+z5L6n5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLnNsaWRlLW91dGVyIik7CiAgICAgICAgICAgIC8vIOWPs+S+p+ivpuaDhQogICAgICAgICAgICBwdXQoIi5wZXJzaW9uX2FydGljbGUiKTsKICAgICAgICAgICAgLy8g5Y+z5L6n5o6o6I2QCiAgICAgICAgICAgICQoIi5mZWVkX2NvbXBhbnkiKS5wYXJlbnQoKS5yZW1vdmUoKTsKICAgICAgICAgICAgLy8gKioqIGFydGljbGUgKioqCiAgICAgICAgICAgIC8vIOW4uOinhAogICAgICAgICAgICAvLyDlj7Pkvqflub/lkYrvvIzmlL7liLDnrKzkuIDkuKrmuIXpmaQKICAgICAgICAgICAgcHV0KCIjYWRkQWRCb3giKTsKICAgICAgICAgICAgcHV0KCIucmVjb21tZW5kLXRvcC1hZGJveCIpOwogICAgICAgICAgICAvLyDlv6vmnaXlhpnljZrlrqLlkKcKICAgICAgICAgICAgcHV0KCIuYmxvZ190aXBfYm94Iik7CiAgICAgICAgICAgIC8vIOaOqOiNkOWFs+azqOeUqOaItwogICAgICAgICAgICBwdXQoIi5ibG9nLWV4cGVydC1yZWNvbW1lbmQtYm94Iik7CiAgICAgICAgICAgIC8vIOWPs+S4i+inklZJUAogICAgICAgICAgICBwdXQoIi5tZWF1LWdvdG9wLWJveCIpOwogICAgICAgICAgICAvLyDlub/lkYoKICAgICAgICAgICAgcHV0KCIubWVkaWF2X2FkIik7CiAgICAgICAgICAgIHB1dCgiLnB1bGxsb2ctYm94Iik7CiAgICAgICAgICAgIHB1dCgiLnJlY29tbWVuZC1hZC1ib3giKTsKICAgICAgICAgICAgcHV0KCIuYm94LXNoYWRvdyIpOwogICAgICAgICAgICBwdXQoIi50eXBlX2hvdF93b3JkIik7CiAgICAgICAgICAgIHB1dCgiLmZvdXJ0aF9jb2x1bW4iKTsKICAgICAgICAgICAgLy8g5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiI2FzaWRlRm9vdGVyIik7CiAgICAgICAgICAgIHB1dCgiI2FkLWRpdiIpOwogICAgICAgICAgICBwdXQoIiM0NzkiKTsKICAgICAgICAgICAgcHV0KCIjNDgwIik7CiAgICAgICAgICAgIC8vIOaJk+i1jwogICAgICAgICAgICBwdXQoIi5wb3N0VGltZSIpOwogICAgICAgICAgICAvLyDor77nqIvmjqjojZAKICAgICAgICAgICAgcHV0KCIudDAiKTsKICAgICAgICAgICAgLy8g5YiG5Lqr5rW35oqlCiAgICAgICAgICAgIHB1dCgiLnNoYXJlU3VnZ2VzdCIpOwogICAgICAgICAgICAvLyDlupXpg6jkuLvpopgKICAgICAgICAgICAgcHV0KCIudGVtcGxhdGUtYm94Iik7CiAgICAgICAgICAgIC8vIOivhOiuuuWMuuW5v+WRigogICAgICAgICAgICBwdXQoImRpdiNkbXBfYWRfNTgiKTsKICAgICAgICAgICAgLy8g5omT6LWPCiAgICAgICAgICAgIHB1dCgiLnJld2FyZC11c2VyLWJveCIpOwogICAgICAgICAgICAvLyDlj7PkvqfmiZPotY/mjInpkq4KICAgICAgICAgICAgcHV0KCIudG8tcmV3YXJkIik7CiAgICAgICAgICAgIC8vIOaOqOiNkOWGheWuueW5v+WRigogICAgICAgICAgICBwdXQoIi5yZWNvbW1lbmQtcmVjb21tZW5kLWJveCIpOwogICAgICAgICAgICAvLyDlj7Pkvqflub/lkYoKICAgICAgICAgICAgcHV0KCIuaW5kZXhTdXBlcmlzZSIpOwogICAgICAgICAgICAvLyDmiqLmspnlj5Hop5LmoIcKICAgICAgICAgICAgcHV0KCIuY29tbWVudC1zb2ZhLWZsYWciKTsKICAgICAgICAgICAgLy8g6aG1amlvCiAgICAgICAgICAgIHB1dCgiLmJvdHRvbS1wdWItZm9vdGVyIik7CiAgICAgICAgICAgIC8vIOeZu+W9leafpeeci+acquivu+a2iOaBrwogICAgICAgICAgICBwdXQoIi50b29sYmFyLW5vdGljZS1idWJibGUiKTsKICAgICAgICAgICAgLy8g5Y+z5L6n5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLnJlY29tbWVuZC10b3AtYWRib3giKTsKICAgICAgICAgICAgLy8g5a2m6Zmi5by55Ye65bm/5ZGKCiAgICAgICAgICAgICQoIi5mb3VjZV9jbG9zZV9idG4iKS5jbGljaygpOwogICAgICAgICAgICAvLyDlhbblroMKICAgICAgICAgICAgLy8g5aS06YOo5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLmJhbm5lci1hZC1ib3giKTsKICAgICAgICAgICAgLy8g5Y+z5L6n5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLnNsaWRlLW91dGVyIik7CiAgICAgICAgICAgIC8vIOWPs+S+p+ivpuaDhQogICAgICAgICAgICBwdXQoIi5wZXJzaW9uX2FydGljbGUiKTsKICAgICAgICAgICAgLy8g5bem5L6n5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLm1iOCIpOwogICAgICAgICAgICBwdXQoIiNrcF9ib3hfNTAzIik7CiAgICAgICAgICAgIHB1dCgiI2twX2JveF8yMTQiKTsKICAgICAgICAgICAgLy8gKioqIGJicyAqKioKICAgICAgICAgICAgLy8g6K+E6K665bWM5YWl5bCP5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLnBvc3RfcmVjb21tZW5kIik7CiAgICAgICAgICAgIC8vIOW6lemDqOaOqOiNkAogICAgICAgICAgICBwdXQoIiNwb3N0X2ZlZWRfd3JhcCIpOwogICAgICAgICAgICAvLyDlupXpg6jnm7jlhbPmlofnq6Dph4zpnaLnmoTlub/lkYoKICAgICAgICAgICAgcHV0KCIuYmJzX2ZlZWRfYWRfYm94Iik7CiAgICAgICAgICAgIHB1dCgiLnJlY29tbWVuZC1hZC1ib3giKTsKICAgICAgICAgICAgLy8g5bqV6YOo55u45YWz5paH5a2X6YeM6Z2i55qE54Ot6K+N5o+Q56S6CiAgICAgICAgICAgIHB1dCgiLnR5cGVfaG90X3dvcmQiKTsKICAgICAgICAgICAgLy8g5bqV6YOo6JOd6ImyZmxleOWxnuaAp+eahOW5v+WRiuagjyvnmbvlvZXms6jlhozmoYYKICAgICAgICAgICAgcHV0KCIucHVsbGxvZy1ib3giKTsKICAgICAgICAgICAgLy8g54yc5L2g5Zac5qyiCiAgICAgICAgICAgIHB1dCgiLnBlcnNvbmFsaXplZC1yZWNvbW1lbmQtYm94Iik7CiAgICAgICAgICAgIC8vIOWPkeW4luWHj+WNiuaPkOekugogICAgICAgICAgICBwdXQoIi50b3Rhc3QtYm94Iik7CiAgICAgICAgICAgIC8vIOmhtumDqOW5v+WRigogICAgICAgICAgICBwdXQoIi5yZWNvbW1lbmQtcmlnaHQiKTsKICAgICAgICAgICAgLy8g6aG26YOo5bm/5ZGKCiAgICAgICAgICAgIHB1dCgiLmFkX3RvcCIpOwogICAgICAgICAgICAvLyAqKiogZG93bmxvYWQgKioqCiAgICAgICAgICAgIHB1dCgiLmZpeGVkX2RsIik7CiAgICAgICAgICAgIHB1dCgiaW5kZXhTdXBlcmlzZSIpOwogICAgICAgICAgICAvLyDlj7PkvqfmjqjojZAKICAgICAgICAgICAgcHV0KCIuY29udGVudF9yZWNvbSIpOwogICAgICAgICAgICBjbGVhbigxMCk7CiAgICAgICAgfQogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICAgICAgfSwgMCk7CiAgICAgICAgbCgi5LyY5YyW5a6M5q+VISIpOwogICAgfSwgMCk7Cn0pKCk7CgpmdW5jdGlvbiBsKGxvZykgewogICAgY29uc29sZS5sb2coIltDU0ROR3JlZW5lcl0gIiArIGxvZyk7Cn0KCmZ1bmN0aW9uIGUoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoIltDU0ROR3JlZW5lcl0gIiArIGVycm9yKTsKfQoKZnVuY3Rpb24gY2xlYXIoKSB7CiAgICBsaXN0ID0gW107Cn0KCmZ1bmN0aW9uIHB1dCh0YWcpIHsKICAgIGxpc3QucHVzaCh0YWcpOwp9CgpmdW5jdGlvbiBjbGVhbih0aW1lcykgewogICAgdmFyIGxvb3AgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgLS10aW1lczsKICAgICAgICBpZiAodGltZXMgPD0gMCkgewogICAgICAgICAgICBjbGVhckludGVydmFsKGxvb3ApOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGxpc3QubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgJChsaXN0W2tdKS5yZW1vdmUoKTsKICAgICAgICB9CiAgICB9LCAxMDApOwogICAgTlByb2dyZXNzLmluYygpOwp9CgpmdW5jdGlvbiBsb29wKG51bSkgewogICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChudW0gPT09IDEpIHsKICAgICAgICAgICAgLy8g5Li76aG15Lit6Ze055qE5bm/5ZGKCiAgICAgICAgICAgICQoIi5KX2FkdiIpLnJlbW92ZSgpOwogICAgICAgICAgICAvLyDkuLvpobXmnInmlrDnmoTlhoXlrrnmqKrmnaEKICAgICAgICAgICAgJCgiLmZlZWQtZml4LWJveCIpLnJlbW92ZSgpOwogICAgICAgICAgICAvLyDkuLvpobXlub/lkYogaWZyYW1lCiAgICAgICAgICAgIGlmIChjdXJyZW50VVJMID09ICJodHRwczovL3d3dy5jc2RuLm5ldC8iKSB7CiAgICAgICAgICAgICAgICAkKCJpZnJhbWUiKS5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDliKDpmaQgQ1NETiDlrpjmlrnlnKjkuLvpobXnmoTmlofnq6DvvIjlpKflpJrmmK/lub/lkYrvvIkKICAgICAgICAgICAgJCgibGkuY2xlYXJmaXgiKS5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbGUpIHsKICAgICAgICAgICAgICAgIHZhciBiYW5uZWQgPSAvY3NkbjxcL2E+LzsKICAgICAgICAgICAgICAgIHZhciBhTWFyayA9ICQoZWxlKS5maW5kKCIubmFtZSIpLmh0bWwoKTsKICAgICAgICAgICAgICAgIGlmIChiYW5uZWQudGVzdChhTWFyaykpIHsKICAgICAgICAgICAgICAgICAgICAkKGVsZSkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyDkuLvpobXlub/lkYoKICAgICAgICAgICAgJCgibGkiKS5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBsZXQgc2VsZiA9ICQodGhpcyk7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVR5cGUgPSBzZWxmLmF0dHIoJ2RhdGEtdHlwZScpOwogICAgICAgICAgICAgICAgaWYgKGRhdGFUeXBlID09PSAnYWQnKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChudW0gPT09IDIpIHsKICAgICAgICAgICAgLy8g6K+E6K665p+l55yL5pu05aSa5bGV5byA55uR5ZCsCiAgICAgICAgICAgICQoImRpdi5jb21tZW50LWxpc3QtYm94IikuY3NzKCJtYXgtaGVpZ2h0IiwgIm5vbmUiKTsKICAgICAgICAgICAgLy8g5bGP6JS95oKo55qE57yp5pS+5LiN5pivMTAwJeeahOaPkOekugogICAgICAgICAgICAkKCcubGVmdFBvcCcpLnJlbW92ZSgpOwogICAgICAgIH0gZWxzZSBpZiAobnVtID09IDMpIHsKICAgICAgICAgICAgLy8g5b6q546v5Yig6Zmk55m75b2V5o+Q56S65qGGCiAgICAgICAgICAgIC8vIOaUueWbnuiDjOaZr+minOiJsgogICAgICAgICAgICAkKCIubG9naW4tbWFyayIpLnJlbW92ZSgpOwogICAgICAgICAgICAvLyDliKDpmaTnmbvlvZXmoYYKICAgICAgICAgICAgJCgiLmxvZ2luLWJveCIpLnJlbW92ZSgpOwogICAgICAgICAgICAkKCcjcGFzc3BvcnRib3gnKS5yZW1vdmUoKTsKICAgICAgICAgICAgJCgnLmxvZ2luLW1hcmsnKS5yZW1vdmUoKTsKICAgICAgICB9CiAgICB9LCA1MDApOwp9CgpmdW5jdGlvbiBjb21tb24obnVtLCB0aW1lcykgewogICAgdmFyIGxvb3AgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgLS10aW1lczsKICAgICAgICBpZiAodGltZXMgPD0gMCkgewogICAgICAgICAgICBjbGVhckludGVydmFsKGxvb3ApOwogICAgICAgIH0KICAgICAgICBpZiAobnVtID09PSAxKSB7CiAgICAgICAgICAgIC8vIOafpeeci+abtOWkmgogICAgICAgICAgICAkKCIuYnRuLXJlYWRtb3JlIikucmVtb3ZlQ2xhc3MoIm5vLWxvZ2luIik7CiAgICAgICAgICAgICQoIi5idG4tcmVhZG1vcmUiKS5hZGRDbGFzcygiZmFucy1yZWFkLW1vcmUiKTsKICAgICAgICAgICAgJCgiLmJ0bi1yZWFkbW9yZSIpLnJlbW92ZUF0dHIoImhyZWYiKTsKICAgICAgICAgICAgJCgiLmJ0bi1yZWFkbW9yZSIpLnJlbW92ZUF0dHIoInRhcmdldCIpOwogICAgICAgICAgICAkKCIuYnRuLXJlYWRtb3JlIikucmVtb3ZlQXR0cigicmVsIik7CiAgICAgICAgICAgICQoIi5idG4tcmVhZG1vcmUiKS5jbGljaygpOwogICAgICAgICAgICAvLyDlt7LnmbvlvZXnlKjmiLflsZXlvIDor4TorroKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidG5Nb3JlQ29tbWVudCIpLmNsaWNrKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIC8vIOWIoOmZpOafpeeci+abtOWkmuaMiemSrgogICAgICAgICAgICAkKCIjYnRuTW9yZUNvbW1lbnQiKS5wYXJlbnQoImRpdi5vcHQtYm94IikucmVtb3ZlKCk7CiAgICAgICAgICAgIC8vIOWxleW8gOWGheWuuQogICAgICAgICAgICAkKCJkaXYuY29tbWVudC1saXN0LWJveCIpLmNzcygibWF4LWhlaWdodCIsICJub25lIik7CiAgICAgICAgICAgIC8vIOaUueWbnuiDjOaZr+minOiJsgogICAgICAgICAgICAkKCIubG9naW4tbWFyayIpLnJlbW92ZSgpOwogICAgICAgICAgICAvLyDliKDpmaTnmbvlvZXmoYYKICAgICAgICAgICAgJCgiLmxvZ2luLWJveCIpLnJlbW92ZSgpOwogICAgICAgIH0gZWxzZSBpZiAobnVtID09PSAyKSB7CiAgICAgICAgICAgIC8vIOaMoeS9j+ivhOiuuueahOKAnOWHuuWktOaOqOiNkOKAnQogICAgICAgICAgICBpZiAoJCgiLnJlY29tbWVuZC1ib3giKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAkKCIucmVjb21tZW5kLWJveCIpWzBdLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOWOu+WklumTvgogICAgICAgICAgICAkKCIjY29udGVudF92aWV3cyIpLm9mZigpOwogICAgICAgICAgICAvLyDljrvpmaTmjqjlub/lub/lkYoKICAgICAgICAgICAgJCgibGlbZGF0YS10eXBlPSdhZCddIikucmVtb3ZlKCk7CiAgICAgICAgICAgIC8vIOWFjeeZu+W9leWkjeWItgogICAgICAgICAgICAkKCIuaGxqcy1idXR0b24iKS5yZW1vdmVDbGFzcygic2lnbmluIik7CiAgICAgICAgICAgICQoIi5obGpzLWJ1dHRvbiIpLmFkZENsYXNzKCJ7Mn0iKTsKICAgICAgICAgICAgJCgiLmhsanMtYnV0dG9uIikuYXR0cigiZGF0YS10aXRsZSIsICLlhY3nmbvlvZXlpI3liLYiKTsKICAgICAgICAgICAgJCgiLmhsanMtYnV0dG9uIikuYXR0cigib25jbGljayIsICJobGpzLmNvcHlDb2RlKGV2ZW50KSIpOwogICAgICAgICAgICAvLyDljrvpmaTliarotLTmnb/liqvmjIEKICAgICAgICAgICAgJCgiY29kZSIpLmF0dHIoIm9uY2xpY2siLCAibWRjcC5jb3B5Q29kZShldmVudCkiKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIOWkjeWItuaXtuS/neeVmeWOn+aWh+agvOW8j++8jOWPguiAgyBodHRwczovL2dyZWFzeWZvcmsub3JnL2VuL3NjcmlwdHMvMzkwNTAyLWNzZG5yZW1vdmVjb3B5cmlnaHQvY29kZQogICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgImFydGljbGVUeXBlIiwgewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAwLAogICAgICAgICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3Nkbi5jb3B5cmlnaHQuaW5pdCgiIiwgIiIsICIiKTsKICAgICAgICAgICAgLy8g6aG15aS05bm/5ZGKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJjb2x1bW4tYWR2ZXJ0LWJveCIpWzBdLnN0eWxlLmRpc3BsYXk9Im5vbmUiOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICAvLyDoh6rliqjmo4DmtYvmmK/lkKbmnInnm67lvZXvvIzlpoLmnpzmsqHmnInliJnliKDpmaTlj7PovrnmoI/vvIzmlofnq6DlsYXkuK0KICAgICAgICAgICAgaWYgKCQoIi5yZWNvbW1lbmQtcmlnaHRfYXNpZGUiKS5odG1sKCkgJiYgJCgiLnJlY29tbWVuZC1yaWdodF9hc2lkZSIpLmh0bWwoKS5yZXBsYWNlKC9bXHJcbl0vZywgIiIpLnJlcGxhY2UoLyhccykvZywgIiIpID09PSAiIikgewogICAgICAgICAgICAgICAgJCgiI3JpZ2h0QXNpZGUiKS5yZW1vdmUoKTsKICAgICAgICAgICAgfSBlbHNlIGlmICgkKCIucmVjb21tZW5kLXJpZ2h0X2FzaWRlIikuaHRtbCgpICYmICQoIiNyZWNvbW1lbmQtcmlnaHQiKS5odG1sKCkucmVwbGFjZSgvW1xyXG5dL2csICIiKS5yZXBsYWNlKC8oXHMpL2csICIiKSA9PT0gIiIpIHsKICAgICAgICAgICAgICAgICQoIiNyaWdodEFzaWRlIikucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g55m75b2V5oyJ6ZKu5paH5a2X5aSq5aSa77yM5L+u5pS5CiAgICAgICAgICAgICQoImEiKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKCQodGhpcykuYXR0cignaHJlZicpID09PSAnaHR0cHM6Ly9wYXNzcG9ydC5jc2RuLm5ldC9hY2NvdW50L2xvZ2luJykgewogICAgICAgICAgICAgICAgICAgICQodGhpcykuaHRtbCgn55m75YWlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyDpobbmoI/lub/lkYoKICAgICAgICAgICAgJCgibGkiKS5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICBsZXQgc2VsZiA9ICQodGhpcyk7CiAgICAgICAgICAgICAgICBsZXQgZGF0YVR5cGUgPSBzZWxmLmF0dHIoJ2RhdGEtc3ViLW1lbnUtdHlwZScpOwogICAgICAgICAgICAgICAgaWYgKGRhdGFUeXBlID09PSAndmlwJykgewogICAgICAgICAgICAgICAgICAgIHNlbGYucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyDpobbmoI9WSVDpgInpobkKICAgICAgICAgICAgJCgnLnRvb2xiYXItc3ViTWVudS1ib3gnKS5maW5kKCJbaHJlZj0naHR0cHM6Ly9tYWxsLmNzZG4ubmV0L3ZpcCddIikucGFyZW50KCkucmVtb3ZlKCk7CiAgICAgICAgfSBlbHNlIGlmIChudW0gPT0gMykgewogICAgICAgICAgICAvL+iuuuWdm+iHquWKqOWxleW8gAogICAgICAgICAgICAkKCIuanNfc2hvd190b3BpYyIpLmNsaWNrKCk7CiAgICAgICAgfSBlbHNlIGlmIChudW0gPT0gNCkgewogICAgICAgICAgICAvKiog6YWN572u5o6n5Yi2ICoqLwogICAgICAgICAgICBsZXQgY29uZmlnID0gbmV3IENvbmZpZygpOwogICAgICAgICAgICBsZXQgc21Db29raWUgPSBjb25maWcuZ2V0KCJzY3Itc20iLCBmYWxzZSk7CiAgICAgICAgICAgIGxldCBtZENvb2tpZSA9IGNvbmZpZy5nZXQoInNjci1tZCIsIHRydWUpOwogICAgICAgICAgICBsZXQgbGdDb29raWUgPSBjb25maWcuZ2V0KCJzY3ItbGciLCBmYWxzZSk7CgogICAgICAgICAgICAkKCIjc2NyLXNtIikucHJvcCgiY2hlY2tlZCIsIHNtQ29va2llKTsKICAgICAgICAgICAgJCgiI3Njci1tZCIpLnByb3AoImNoZWNrZWQiLCBtZENvb2tpZSk7CiAgICAgICAgICAgICQoIiNzY3ItbGciKS5wcm9wKCJjaGVja2VkIiwgbGdDb29raWUpOwoKICAgICAgICAgICAgaWYgKHNtQ29va2llKSB7CiAgICAgICAgICAgICAgICAvLyBTbWFsbCBTY3JlZW4gTW9kZQogICAgICAgICAgICAgICAgJCgiLm1haW5fZmF0aGVyIikucmVtb3ZlQ2xhc3MoImp1c3RpZnktY29udGVudC1jZW50ZXIiKTsKICAgICAgICAgICAgICAgICQoImNzZG4tc2lkZS10b29sYmFyIikuY3NzKCJsZWZ0IiwgImF1dG8iKQogICAgICAgICAgICAgICAgR01fYWRkU3R5bGUoYAogICAgICAgICAgICAgICAgbWFpbnsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogYXV0byFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgZmxvYXQ6IG5vbmUhaW1wb3J0YW50OwogICAgICAgICAgICAgICAgICAgIG1heC13aWR0aDogOTB2dzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG1haW4gYXJ0aWNsZSBpbWd7CiAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiAwIGF1dG87CiAgICAgICAgICAgICAgICAgICAgbWF4LXdpZHRoOiAxMDAlOwogICAgICAgICAgICAgICAgICAgIG9iamVjdC1maXQ6IGNvdmVyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWRDb29raWUpIHsKICAgICAgICAgICAgICAgIC8vIE1pZGRsZSBTY3JlZW4gTW9kZQogICAgICAgICAgICAgICAgJCgiLm1haW5fZmF0aGVyIikucmVtb3ZlQ2xhc3MoImp1c3RpZnktY29udGVudC1jZW50ZXIiKTsKICAgICAgICAgICAgICAgICQoImNzZG4tc2lkZS10b29sYmFyIikuY3NzKCJsZWZ0IiwgImF1dG8iKQogICAgICAgICAgICB9IGVsc2UgaWYgKGxnQ29va2llKSB7CiAgICAgICAgICAgICAgICAvLyBMYXJnZSBTY3JlZW4gTW9kZQogICAgICAgICAgICAgICAgJCgiLmNvbnRhaW5lciIpLmNzcygibWFyZ2luIiwgIjAgYXV0byIpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOWxj+W5leWwuuWvuOWNlemAieebkeWQrAogICAgICAgICAgICAkKCIjc2NyLXNtIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbmV3IENvbmZpZygpLnNldCgic2NyLXNtIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBuZXcgQ29uZmlnKCkuc2V0KCJzY3ItbWQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBuZXcgQ29uZmlnKCkuc2V0KCJzY3ItbGciLCBmYWxzZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKCIjc2NyLW1kIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbmV3IENvbmZpZygpLnNldCgic2NyLW1kIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBuZXcgQ29uZmlnKCkuc2V0KCJzY3Itc20iLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBuZXcgQ29uZmlnKCkuc2V0KCJzY3ItbGciLCBmYWxzZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkKCIjc2NyLWxnIikuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbmV3IENvbmZpZygpLnNldCgic2NyLWxnIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBuZXcgQ29uZmlnKCkuc2V0KCJzY3Itc20iLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBuZXcgQ29uZmlnKCkuc2V0KCJzY3ItbWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAobnVtID09IDUpIHsKICAgICAgICAgICAgLy8g5pS55Zue6IOM5pmv6aKc6ImyCiAgICAgICAgICAgICQoIi5sb2dpbi1tYXJrIikucmVtb3ZlKCk7CiAgICAgICAgICAgIC8vIOWIoOmZpOeZu+W9leahhgogICAgICAgICAgICAkKCIubG9naW4tYm94IikucmVtb3ZlKCk7CiAgICAgICAgfSBlbHNlIGlmIChudW0gPT0gNikgewogICAgICAgICAgICBsZXQgZGlkID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBjb25maWdIVE1MID0gJyc7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxkaXY+PGEgc3R5bGU9ImZvbnQtc2l6ZTogMjBweDsiIGhyZWY9Imh0dHBzOi8vb3BlbnVzZXJqcy5vcmcvc2NyaXB0cy9BZGxlckVELyVFNiU5QyU4MCVFNSVCQyVCQSVFNyU5QSU4NCVFOCU4MCU4MSVFNyU4OSU4QyVFOCU4NCU5QSVFNiU5QyVBQ0NTRE5HcmVlbmVyJUVGJUJDJTlBQ1NETiVFNSVCOSVCRiVFNSU5MSU4QSVFNSVBRSU4QyVFNSU4NSVBOCVFOCVCRiU4NyVFNiVCQiVBNCVFMyU4MCU4MSVFNCVCQSVCQSVFNiU4MCVBNyVFNSU4QyU5NiVFOCU4NCU5QSVFNiU5QyVBQyVFNCVCQyU5OCVFNSU4QyU5NiIgdGFyZ2V0PSJfYmxhbmsiPkNTRE5HcmVlbmVyPC9hPiA8c3VwPlYnICsgdmVyc2lvbiArICc8L3N1cD48L2Rpdj7lrpjmlrkgUVEg5Lqk5rWB576k77yaMTA0MjM3MDQ1MyZuYnNwOyZuYnNwOyZuYnNwOzxhIHRhcmdldD0iX2JsYW5rIiBocmVmPSIvL3NoYW5nLnFxLmNvbS93cGEvcXVud3BhP2lka2V5PWQ3YWQ2ZWFkM2Y1NzcyMmU3ZjAwYTQyODFhZTc1ZGJhYzIxMzJjNWE4Y2YzMjE5OTJkNTczMDkwMzdmY2FmNjMiPjxpbWcgYm9yZGVyPSIwIiBzcmM9Ii8vcHViLmlkcXFpbWcuY29tL3dwYS9pbWFnZXMvZ3JvdXAucG5nIiBhbHQ9IkNTRE5HcmVlbmVyIOeUqOaIt+S6pOa1gee+pCIgdGl0bGU9IkNTRE5HcmVlbmVyIOeUqOaIt+S6pOa1gee+pCI+PC9hPjxicj48YnI+JzsKCiAgICAgICAgICAgIC8vIOiuvuWumu+8muaOqOiNkOWGheWuueaMiemSrgogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8cCBzdHlsZT0ibWFyZ2luLWJvdHRvbTogNXB4Ij48Yj7moLnmja7lsY/luZXlsLrlr7jvvIzpgILphY3niYjlvI88L2I+PGJyPjxzcGFuIHN0eWxlPSJmb250LXNpemU6IDVweDsiPuW7uuiurumAkOS4quWwneivleWQjumAieaLqemAguWQiOS9oOeahOeJiOW8j++8jOWxj+W5lei/h+Wwj+aIluiAheeJiOW8j+mAieaLqeS4jeato+ehruWPs+S+p+agj+WPr+iDveayoeacieepuumXtOaYvuekuu+8iOivt+Wwneivleiwg+iKgua1j+iniOWZqOe8qeaUvu+8ieOAgjwvc3Bhbj48L3A+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGxhYmVsPjxpbnB1dCBuYW1lPSJkaXNwbGF5TW9kZSIgdHlwZT0icmFkaW8iIHZhbHVlPSIiIGlkPSJzY3Itc20iIC8+IOW5s+mTuuaooeW8jyA8L2xhYmVsPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxsYWJlbD48aW5wdXQgbmFtZT0iZGlzcGxheU1vZGUiIHR5cGU9InJhZGlvIiB2YWx1ZT0iIiBpZD0ic2NyLW1kIiAvPiDpgILlupTmqKHlvI8gPC9sYWJlbD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8bGFiZWw+PGlucHV0IG5hbWU9ImRpc3BsYXlNb2RlIiB0eXBlPSJyYWRpbyIgdmFsdWU9IiIgaWQ9InNjci1sZyIgLz4g5bGF5Lit5qih5byPPC9sYWJlbD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8aHIgc3R5bGU9ImhlaWdodDoxcHg7Ym9yZGVyOm5vbmU7Ym9yZGVyLXRvcDoxcHggc29saWQgI2NjY2NjYzttYXJnaW46IDVweCAwcHggNXB4IDBweDsiIC8+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPHAgc3R5bGU9Im1hcmdpbi1ib3R0b206IDVweCI+PGI+6YCa55So6K6+5a6aPC9iPjwvcD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJ0b2dnbGUtcmVjb21tZW5kLWJ1dHRvbiI+IDxsYWJlbCBmb3I9InRvZ2dsZS1yZWNvbW1lbmQtYnV0dG9uIiBjbGFzcz0ibW9kZUxhYmVsIj7mmL7npLrmjqjojZDlhoXlrrk8L2xhYmVsPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxicj4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJ0b2dnbGUtd2hpdGV0aGVtZS1idXR0b24iPiA8bGFiZWwgZm9yPSJ0b2dnbGUtd2hpdGV0aGVtZS1idXR0b24iIGNsYXNzPSJtb2RlTGFiZWwiPueZveiJsuS4u+mimCZEYXJrIFJlYWRlcuWFvOWuueaooeW8jzxicj48c3BhbiBzdHlsZT0iZm9udC1zaXplOiA4cHg7Y29sb3I6ICM4MDgwODA7Ij4jIOmAiemhueS9nOeUqO+8muW8gOWQr+WQjuWPr+mAmui/h0RhcmsgUmVhZGVy5o+S5Lu254G15rS75o6n5Yi255m96Imy5LiO6buR5pqX5qih5byP77yMPGEgc3R5bGU9ImNvbG9yOiBncmVlbjsiIGhyZWY9Imh0dHBzOi8vY2hyb21lLnp6em1oLmNuL2luZm8/dG9rZW49ZWltYWRwYmNiZm5tYmtvcG9vamZla2hua2hkYmllZWgiIHRhcmdldD0iX2JsYW5rIj7mj5Lku7bkuIvovb3lnLDlnYDngrnmiJE8L2E+PC9zcGFuPjwvbGFiZWw+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGJyPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZS1hdXRvc2l6ZS1idXR0b24iPiA8bGFiZWwgZm9yPSJ0b2dnbGUtYXV0b3NpemUtYnV0dG9uIiBjbGFzcz0ibW9kZUxhYmVsIj7lrr3luqboh6rliqjpgILlupQ8YnI+PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTogOHB4O2NvbG9yOiAjODA4MDgwOyI+IyDpgInpobnkvZznlKjvvJrlvIDlkK/mraTpgInpobnlj6/ku6XlnKjpobXpnaLlrr3luqbnvKnlsI/ml7boh6rliqjliIfmjaLoh7PlsI/lsY/mqKHlvI88L3NwYW4+PC9sYWJlbD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8YnI+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0idG9nZ2xlLWF1dG9oaWRldG9vbGJhci1idXR0b24iPiA8bGFiZWwgZm9yPSJ0b2dnbGUtYXV0b2hpZGV0b29sYmFyLWJ1dHRvbiIgY2xhc3M9Im1vZGVMYWJlbCI+5ZCR5LiL5rua5Yqo6Ieq5Yqo6ZqQ6JeP6aG25qCPPC9sYWJlbD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8YnI+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0idG9nZ2xlLWF1dG9oaWRlYm90dG9tYmFyLWJ1dHRvbiI+IDxsYWJlbCBmb3I9InRvZ2dsZS1hdXRvaGlkZWJvdHRvbWJhci1idXR0b24iIGNsYXNzPSJtb2RlTGFiZWwiPuiHquWKqOmakOiXj+W6leagjzwvbGFiZWw+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGJyPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZS13cml0ZWJsb2ctYnV0dG9uIj4gPGxhYmVsIGZvcj0idG9nZ2xlLXdyaXRlYmxvZy1idXR0b24iIGNsYXNzPSJtb2RlTGFiZWwiPuaYvuekuuWIm+S9nOS4reW/g+aMiemSrjwvbGFiZWw+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGJyPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxociBzdHlsZT0iaGVpZ2h0OjFweDtib3JkZXI6bm9uZTtib3JkZXItdG9wOjFweCBzb2xpZCAjY2NjY2NjO21hcmdpbjogNXB4IDBweCA1cHggMHB4OyIgLz4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8cCBzdHlsZT0ibWFyZ2luLWJvdHRvbTogNXB4Ij48Yj7lj7PkvqfmoI/lrprliLY8L2I+PC9wPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZS1hdXRob3JjYXJkLWJ1dHRvbiI+IDxsYWJlbCBmb3I9InRvZ2dsZS1hdXRob3JjYXJkLWJ1dHRvbiIgY2xhc3M9Im1vZGVMYWJlbCI+5pi+56S65L2c6ICF5ZCN54mHPC9sYWJlbD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8YnI+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0idG9nZ2xlLXNlYXJjaGJsb2ctYnV0dG9uIj4gPGxhYmVsIGZvcj0idG9nZ2xlLXNlYXJjaGJsb2ctYnV0dG9uIiBjbGFzcz0ibW9kZUxhYmVsIj7mmL7npLrmkJzljZrkuLvmlofnq6A8L2xhYmVsPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxicj4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJ0b2dnbGUtbmV3YXJ0aWNsZS1idXR0b24iPiA8bGFiZWwgZm9yPSJ0b2dnbGUtbmV3YXJ0aWNsZS1idXR0b24iIGNsYXNzPSJtb2RlTGFiZWwiPuaYvuekuuacgOaWsOaWh+eroDwvbGFiZWw+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGJyPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZS1ob3RhcnRpY2xlLWJ1dHRvbiI+IDxsYWJlbCBmb3I9InRvZ2dsZS1ob3RhcnRpY2xlLWJ1dHRvbiIgY2xhc3M9Im1vZGVMYWJlbCI+5pi+56S654Ot6Zeo5paH56ugPC9sYWJlbD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8YnI+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0idG9nZ2xlLW5ld2NvbW1lbnRzLWJ1dHRvbiI+IDxsYWJlbCBmb3I9InRvZ2dsZS1uZXdjb21tZW50cy1idXR0b24iIGNsYXNzPSJtb2RlTGFiZWwiPuaYvuekuuacgOaWsOivhOiuujwvbGFiZWw+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGJyPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZS1raW5kcGVyc29uLWJ1dHRvbiI+IDxsYWJlbCBmb3I9InRvZ2dsZS1raW5kcGVyc29uLWJ1dHRvbiIgY2xhc3M9Im1vZGVMYWJlbCI+5pi+56S65YiG57G75LiT5qCPPC9sYWJlbD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8YnI+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0idG9nZ2xlLXJlY29tbWVuZGFydGljbGUtYnV0dG9uIj4gPGxhYmVsIGZvcj0idG9nZ2xlLXJlY29tbWVuZGFydGljbGUtYnV0dG9uIiBjbGFzcz0ibW9kZUxhYmVsIj7mmL7npLrmjqjojZDmlofnq6A8L2xhYmVsPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxicj4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJ0b2dnbGUtYXJjaGl2ZS1idXR0b24iPiA8bGFiZWwgZm9yPSJ0b2dnbGUtYXJjaGl2ZS1idXR0b24iIGNsYXNzPSJtb2RlTGFiZWwiPuaYvuekuuW9kuahozwvbGFiZWw+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGJyPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZS1jb250ZW50LWJ1dHRvbiI+IDxsYWJlbCBmb3I9InRvZ2dsZS1jb250ZW50LWJ1dHRvbiIgY2xhc3M9Im1vZGVMYWJlbCI+5pi+56S655uu5b2VPC9sYWJlbD4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8YnI+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGJ1dHRvbiBpZD0ic2F2ZSIgc3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAyMHB4OyByaWdodDogMTVweDsiIG9uY2xpY2s9ImxvY2F0aW9uLnJlbG9hZCgpIj4nICsgc2F2ZV9zdmcgKyAnIOS/neWtmOW5tuW6lOeUqDwvYnV0dG9uPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxicj4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8cCBzdHlsZT0iZm9udC1zaXplOjVweCI+5bCP5o+Q56S677yaQ1NETkdyZWVuZXIg6ISa5pys5LiN5o+Q5L6b5Lu75L2V5Lya5ZGY5paH56ug56C06Kej44CB5Lya5ZGY6LWE5rqQ5LiL6L295Yqf6IO977yM5LuF6YCC55So5LqO5YmN56uv5LyY5YyW77yM6K+35Zyo5a6Y5pa55rig6YGT6LSt5Lmw5Lya5ZGY5L2T6aqM5LuY6LS55Yqf6IO944CCPC9wPic7CiAgICAgICAgICAgIGNvbmZpZ0hUTUwgKz0gJzxicj4nOwogICAgICAgICAgICBjb25maWdIVE1MICs9ICc8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vYWRsZXJlZC9DU0ROR3JlZW5lciIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJnaXZlTWVPbmVTdGFyIj4nICsgc3Rhcl9zdmcgKyAnIDxiPueCueaIkX48L2I+IOWKqOWKqOWwj+aJi+WcqCBHaXRIdWIg54K55LiqIFN0YXLvvIzmlK/mjIHmiJHnu6fnu63nu7TmiqTohJrmnKwgOik8L2E+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPGJyPic7CgogICAgICAgICAgICAvLyBjb25maWdIVE1MICs9ICc8YSBocmVmPSJodHRwczovL2RvYy5zdGFja292ZXJmbG93Lndpa2kvd2ViLyMvMjE/cGFnZV9pZD0xMzgiIHRhcmdldD0iX2JsYW5rIiBzdHlsZT0ibWFyZ2luLXRvcDogNXB4OyBkaXNwbGF5OiBibG9jazsiPicgKyBkb25hdGVfc3ZnICsgJyDmiJHmmK/ogIHmnb/vvIzmipXluIHmiZPotY88L2E+JzsKICAgICAgICAgICAgY29uZmlnSFRNTCArPSAnPC9kaXY+PGRpdiBpZD0iZmFkZSIgY2xhc3M9ImJsYWNrX292ZXJsYXkiPjwvZGl2Pic7CiAgICAgICAgICAgIC8vIOe7v+WMluWZqOiuvuWumgogICAgICAgICAgICAkKCJib2R5IikucHJlcGVuZCgnPGRpdiBpZD0ibGlnaHQiIGNsYXNzPSJ3aGl0ZV9jb250ZW50Ij4nICsgY29uZmlnSFRNTCk7CiAgICAgICAgICAgIC8vIOe7v+WMluiuvuWumgogICAgICAgICAgICBsZXQgaHRtbE9mMCA9ICc8bGk+PGEgaWQ9ImdyZWVuZXJTZXR0aW5ncyIgaHJlZj0iamF2YXNjcmlwdDp2b2lkKDApIiBzdHlsZT0iIiBvbmNsaWNrPSIkKHdpbmRvdykuc2Nyb2xsVG9wKDApO2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwnbGlnaHRcJykuc3R5bGUuZGlzcGxheT1cJ2Jsb2NrXCc7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCdmYWRlXCcpLnN0eWxlLmRpc3BsYXk9XCdibG9ja1wnOyI+JyArIHNldF9zdmcgKyAnIOe7v+WMluiuvuWumjwvYT48L2xpPic7CiAgICAgICAgICAgICQoIi50b29sYmFyLXN1Yk1lbnUtYm94IikuZXEoMSkuYmVmb3JlKGh0bWxPZjApOwoKICAgICAgICAgICAgLyoqIOmFjee9ruaOp+WItiAqKi8KICAgICAgICAgICAgbGV0IGNvbmZpZyA9IG5ldyBDb25maWcoKTsKICAgICAgICAgICAgLy8g5o6o6I2Q5YaF5a65CiAgICAgICAgICAgICQoIi5ibG9nLWNvbnRlbnQtYm94IikuYXBwZW5kKCI8YnI+PGRpdiBjbGFzcz0nYmxvZy1jb250ZW50LWJveCcgaWQ9J3JlY29tbWVuZFN3aXRjaCcgc3R5bGU9J3RleHQtYWxpZ246IHJpZ2h0Oyc+PC9kaXY+Iik7CiAgICAgICAgICAgICQoIiNyZWNvbW1lbmRTd2l0Y2g6bGFzdCIpLmFwcGVuZCgnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0idG9nZ2xlLWJ1dHRvbiI+IDxsYWJlbCBmb3I9InRvZ2dsZS1idXR0b24iIGNsYXNzPSJidXR0b24tbGFiZWwiPiA8c3BhbiBjbGFzcz0iY2lyY2xlIj48L3NwYW4+IDxzcGFuIGNsYXNzPSJ0ZXh0IG9uIj4mbmJzcDs8L3NwYW4+IDxzcGFuIGNsYXNzPSJ0ZXh0IG9mZiI+Jm5ic3A7PC9zcGFuPiA8L2xhYmVsPicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxwIHN0eWxlPSJtYXJnaW4tdG9wOiA1cHg7IGZvbnQtc2l6ZTogMTNweDsiPuaYvuekuuaOqOiNkOWGheWuuTwvcD4nKTsKICAgICAgICAgICAgbGV0IHJlY29tbWVuZENvb2tpZSA9IGNvbmZpZy5nZXQoInJlY29tbWVuZCIsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKCFyZWNvbW1lbmRDb29raWUpIHsKICAgICAgICAgICAgICAgICQoIi5yZWNvbW1lbmQtYm94IikuaGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZWNvbW1lbmRDb29raWUpIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtcmVjb21tZW5kLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1yZWNvbW1lbmQtYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25maWcubGlzdGVuQnV0dG9uKCIjdG9nZ2xlLXJlY29tbWVuZC1idXR0b24iLCAicmVjb21tZW5kIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgeyQoIi5yZWNvbW1lbmQtYm94Iikuc2xpZGVEb3duKDIwMCk7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgeyQoIi5yZWNvbW1lbmQtYm94Iikuc2xpZGVVcCgyMDApO30pOwogICAgICAgICAgICBjb25maWcubGlzdGVuQnV0dG9uQW5kQWN0aW9uKCIjdG9nZ2xlLWJ1dHRvbiIsICJyZWNvbW1lbmQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgeyQoIi5yZWNvbW1lbmQtYm94Iikuc2xpZGVEb3duKDIwMCk7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkgeyQoIi5yZWNvbW1lbmQtYm94Iikuc2xpZGVVcCgyMDApO30pOwoKICAgICAgICAgICAgLy8g5o+Q56S6CiAgICAgICAgICAgIGxldCB0aXBzQ29va2llID0gY29uZmlnLmdldCgic2hvd1RpcCIsIHRydWUpOwogICAgICAgICAgICBpZiAodGlwc0Nvb2tpZSkgewogICAgICAgICAgICAgICAgc2hvd1RpcHMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25maWcuc2V0KCJzaG93VGlwIiwgZmFsc2UpOwoKICAgICAgICAgICAgLy8g5pi+56S65L2c6ICF5ZCN54mHCiAgICAgICAgICAgIGxldCBhdXRob3JDYXJkQ29va2llID0gY29uZmlnLmdldCgiYXV0aG9yQ2FyZCIsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKGF1dGhvckNhcmRDb29raWUpIHsKICAgICAgICAgICAgICAgIC8vIOWNmuS4u+S/oeaBrwogICAgICAgICAgICAgICAgJCgnI3JlY29tbWVuZC1yaWdodCcpLmFwcGVuZCgkKCcjYXNpZGVQcm9maWxlJykucHJvcCgib3V0ZXJIVE1MIikpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjYXNpZGVQcm9maWxlJykuYXR0cigic3R5bGUiLCAibWFyZ2luLXRvcDogOHB4OyB3aWR0aDogMzAwcHg7Iik7CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhdXRob3JDYXJkQ29va2llKSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLWF1dGhvcmNhcmQtYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1hdXRob3JjYXJkLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZmlnLmxpc3RlbkJ1dHRvbigiI3RvZ2dsZS1hdXRob3JjYXJkLWJ1dHRvbiIsICJhdXRob3JDYXJkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge2xvY2F0aW9uLnJlbG9hZCgpO30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9KTsKCiAgICAgICAgICAgIC8vIOW8uuWItueZveiJsuS4u+mimAogICAgICAgICAgICBsZXQgd2hpdGVUaGVtZUNvb2tpZSA9IGNvbmZpZy5nZXQoIndoaXRlVGhlbWUiLCB0cnVlKTsKICAgICAgICAgICAgaWYgKHdoaXRlVGhlbWVDb29raWUpIHsKICAgICAgICAgICAgICAgIC8vIOiDjOaZr+WIoOmZpAogICAgICAgICAgICAgICAgJCgnLm1haW5fZmF0aGVyJykuYXR0cignc3R5bGUnLCAnYmFja2dyb3VuZC1pbWFnZTogbm9uZSAhaW1wb3J0YW50OyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmNmY3OyBiYWNrZ3JvdW5kOiAjZjVmNmY3OycpOwogICAgICAgICAgICAgICAgJCgnW2hyZWZePSJodHRwczovL2NzZG5pbWcuY24vcmVsZWFzZS9waG9lbml4L3RlbXBsYXRlL3RoZW1lc19za2luLyJdJykuYXR0cignaHJlZicsICdodHRwczovL2NzZG5pbWcuY24vcmVsZWFzZS9waG9lbml4L3RlbXBsYXRlL3RoZW1lc19za2luL3NraW4tdGVjaG5vbG9neS9za2luLXRlY2hub2xvZ3ktNjMzNjU0OTU1Ny5taW4uY3NzJyk7CiAgICAgICAgICAgICAgICAkKCcjY3Nkbi10b29sYmFyJykucmVtb3ZlQ2xhc3MoJ2NzZG4tdG9vbGJhci1za2luLWJsYWNrJyk7CiAgICAgICAgICAgICAgICAkKCcuY3Nkbi1sb2dvJykuYXR0cignc3JjJywgJy8vY3NkbmltZy5jbi9jZG4vY29udGVudC10b29sYmFyL2NzZG4tbG9nby5wbmc/dj0yMDIwMDQxNi4xJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdoaXRlVGhlbWVDb29raWUpIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtd2hpdGV0aGVtZS1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLXdoaXRldGhlbWUtYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25maWcubGlzdGVuQnV0dG9uKCIjdG9nZ2xlLXdoaXRldGhlbWUtYnV0dG9uIiwgIndoaXRlVGhlbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge2xvY2F0aW9uLnJlbG9hZCgpO30pOwoKICAgICAgICAgICAgLy8g5pCc5Y2a5Li75paH56ugCiAgICAgICAgICAgIGxldCBzZWFyY2hCbG9nQ29va2llID0gY29uZmlnLmdldCgic2VhcmNoQmxvZyIsIGZhbHNlKTsKICAgICAgICAgICAgaWYoc2VhcmNoQmxvZ0Nvb2tpZSkgewogICAgICAgICAgICAgICAgJCgnI3JlY29tbWVuZC1yaWdodCcpLmFwcGVuZCgkKCcjYXNpZGVTZWFyY2hBcnRpY2xlJykucHJvcCgib3V0ZXJIVE1MIikpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjYXNpZGVTZWFyY2hBcnRpY2xlJykuYXR0cigic3R5bGUiLCAibWFyZ2luLXRvcDogOHB4OyB3aWR0aDogMzAwcHg7Iik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAkKCIjc2VhcmNoLWJsb2ctd29yZHMiKQogICAgICAgICAgICAgICAgICAgICAgLCBuID0gJCgiLmJ0bi1zZWFyY2gtYmxvZyIpOwogICAgICAgICAgICAgICAgICAgIGkua2V5dXAoZnVuY3Rpb24odCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHQua2V5Q29kZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEzID09IG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gZW5jb2RlVVJJQ29tcG9uZW50KGkudmFsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcyA9ICIvL3NvLmNzZG4ubmV0L3NvL3NlYXJjaC9zLmRvP3E9IiArIGUgKyAiJnQ9YmxvZyZ1PSIgKyB1c2VybmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgbi5vbigiY2xpY2siLCBmdW5jdGlvbih0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gZW5jb2RlVVJJQ29tcG9uZW50KGkudmFsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGUgPSAiLy9zby5jc2RuLm5ldC9zby9zZWFyY2gvcy5kbz9xPSIgKyBuICsgIiZ0PWJsb2cmdT0iICsgdXNlcm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihlKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHQucHJldmVudERlZmF1bHQoKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2VhcmNoQmxvZ0Nvb2tpZSkgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1zZWFyY2hibG9nLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtc2VhcmNoYmxvZy1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbmZpZy5saXN0ZW5CdXR0b24oIiN0b2dnbGUtc2VhcmNoYmxvZy1idXR0b24iLCAic2VhcmNoQmxvZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSk7CgogICAgICAgICAgICAvLyDmnIDmlrDmlofnq6AKICAgICAgICAgICAgbGV0IG5ld0FydGljbGVDb29raWUgPSBjb25maWcuZ2V0KCJuZXdBcnRpY2xlIiwgZmFsc2UpOwogICAgICAgICAgICBpZiAobmV3QXJ0aWNsZUNvb2tpZSkgewogICAgICAgICAgICAgICAgJCgnI3JlY29tbWVuZC1yaWdodCcpLmFwcGVuZCgkKCcjYXNpZGVOZXdBcnRpY2xlJykucHJvcCgib3V0ZXJIVE1MIikpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjYXNpZGVOZXdBcnRpY2xlJykuYXR0cigic3R5bGUiLCAibWFyZ2luLXRvcDogOHB4OyB3aWR0aDogMzAwcHg7Iik7CiAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV3QXJ0aWNsZUNvb2tpZSkgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1uZXdhcnRpY2xlLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtbmV3YXJ0aWNsZS1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbmZpZy5saXN0ZW5CdXR0b24oIiN0b2dnbGUtbmV3YXJ0aWNsZS1idXR0b24iLCAibmV3QXJ0aWNsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSk7CgogICAgICAgICAgICAvLyDng63pl6jmlofnq6AKICAgICAgICAgICAgbGV0IGhvdEFydGljbGVDb29raWUgPSBjb25maWcuZ2V0KCJob3RBcnRpY2xlIiwgZmFsc2UpOwogICAgICAgICAgICBpZiAoaG90QXJ0aWNsZUNvb2tpZSkgewogICAgICAgICAgICAgICAgJCgnI3JlY29tbWVuZC1yaWdodCcpLmFwcGVuZCgkKCIjYXNpZGVIb3RBcnRpY2xlIikucHJvcCgib3V0ZXJIVE1MIikpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjYXNpZGVIb3RBcnRpY2xlJykuYXR0cigic3R5bGUiLCAibWFyZ2luLXRvcDogOHB4OyB3aWR0aDogMzAwcHg7Iik7CiAgICAgICAgICAgICAgICAgICAgJCgnI2FzaWRlSG90QXJ0aWNsZSBpbWcnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChob3RBcnRpY2xlQ29va2llKSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLWhvdGFydGljbGUtYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1ob3RhcnRpY2xlLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZmlnLmxpc3RlbkJ1dHRvbigiI3RvZ2dsZS1ob3RhcnRpY2xlLWJ1dHRvbiIsICJob3RBcnRpY2xlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge2xvY2F0aW9uLnJlbG9hZCgpO30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9KTsKCiAgICAgICAgICAgIC8vIOacgOaWsOivhOiuugogICAgICAgICAgICBsZXQgbmV3Q29tbWVudHNDb29raWUgPSBjb25maWcuZ2V0KCJuZXdDb21tZW50cyIsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKG5ld0NvbW1lbnRzQ29va2llKSB7CiAgICAgICAgICAgICAgICAkKCcjcmVjb21tZW5kLXJpZ2h0JykuYXBwZW5kKCQoIiNhc2lkZU5ld0NvbW1lbnRzIikucHJvcCgib3V0ZXJIVE1MIikpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjYXNpZGVOZXdDb21tZW50cycpLmF0dHIoInN0eWxlIiwgIm1hcmdpbi10b3A6IDhweDsgd2lkdGg6IDMwMHB4OyIpOwogICAgICAgICAgICAgICAgICAgICQoIi5jb21tZW50LmVsbGlwc2lzIikuYXR0cigic3R5bGUiLCAibWF4LWhlaWdodDogbm9uZTsiKTsKICAgICAgICAgICAgICAgICAgICAkKCIudGl0bGUudGV4dC10cnVuY2F0ZSIpLmF0dHIoInN0eWxlIiwgInBhZGRpbmc6IDAiKTsKICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdDb21tZW50c0Nvb2tpZSkgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1uZXdjb21tZW50cy1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLW5ld2NvbW1lbnRzLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZmlnLmxpc3RlbkJ1dHRvbigiI3RvZ2dsZS1uZXdjb21tZW50cy1idXR0b24iLCAibmV3Q29tbWVudHMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge2xvY2F0aW9uLnJlbG9hZCgpO30pOwoKICAgICAgICAgICAgLy8g5YiG57G75LiT5qCPCiAgICAgICAgICAgIGxldCBraW5kUGVyc29uQ29va2llID0gY29uZmlnLmdldCgia2luZFBlcnNvbiIsIGZhbHNlKTsKICAgICAgICAgICAgaWYgKCFraW5kUGVyc29uQ29va2llKSB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICQoJyNhc2lkZUNhdGVnb3J5JykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgJCgnLmtpbmRfcGVyc29uJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoJyNyZWNvbW1lbmQtcmlnaHQnKS5hcHBlbmQoJCgiI2FzaWRlQ2F0ZWdvcnkiKS5wcm9wKCJvdXRlckhUTUwiKSk7CiAgICAgICAgICAgICAgICBpZiAoJCgiI2FzaWRlQ2F0ZWdvcnkiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnLmtpbmRfcGVyc29uJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICQoJy5raW5kX3BlcnNvbicpLmF0dHIoInN0eWxlIiwgIm1hcmdpbi10b3A6IDhweDsgd2lkdGg6IDMwMHB4OyBoZWlnaHQ6MjU1cHg7Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICQoJyNhc2lkZUNhdGVnb3J5JykuYXR0cigic3R5bGUiLCAibWFyZ2luLXRvcDogOHB4OyB3aWR0aDogMzAwcHg7IGRpc3BsYXk6YmxvY2sgIWltcG9ydGFudDsiKTsKICAgICAgICAgICAgICAgICAgICAkKCJhLmZsZXhpYmxlLWJ0biIpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudHMoJ2Rpdi5hc2lkZS1ib3gnKS5yZW1vdmVDbGFzcygnZmxleGlibGUtYm94Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50cygicC50ZXh0LWNlbnRlciIpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChraW5kUGVyc29uQ29va2llKSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLWtpbmRwZXJzb24tYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1raW5kcGVyc29uLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZmlnLmxpc3RlbkJ1dHRvbigiI3RvZ2dsZS1raW5kcGVyc29uLWJ1dHRvbiIsICJraW5kUGVyc29uIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge2xvY2F0aW9uLnJlbG9hZCgpO30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9KTsKCiAgICAgICAgICAgIC8vIOebruW9lQogICAgICAgICAgICBsZXQgY29udGVudENvb2tpZSA9IGNvbmZpZy5nZXQoImNvbnRlbnQiLCB0cnVlKTsKICAgICAgICAgICAgaWYgKCFjb250ZW50Q29va2llKSB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICQoJy5hbGlnbi1pdGVtcy1zdHJldGNoLmdyb3VwX2l0ZW0nKS5wYXJlbnQoKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb250ZW50Q29va2llKSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLWNvbnRlbnQtYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1jb250ZW50LWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZmlnLmxpc3RlbkJ1dHRvbigiI3RvZ2dsZS1jb250ZW50LWJ1dHRvbiIsICJjb250ZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge2xvY2F0aW9uLnJlbG9hZCgpO30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9KTsKCiAgICAgICAgICAgIC8vIOaOqOiNkOaWh+eroAogICAgICAgICAgICBsZXQgcmVjb21tZW5kQXJ0aWNsZUNvb2tpZSA9IGNvbmZpZy5nZXQoInJlY29tbWVuZEFydGljbGUiLCBmYWxzZSk7CiAgICAgICAgICAgIGlmICghcmVjb21tZW5kQXJ0aWNsZUNvb2tpZSkgewogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKCcucmVjb21tZW5kLWxpc3QtYm94JykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnLnJlY29tbWVuZC1saXN0LWJveCcpLmF0dHIoInN0eWxlIiwgIm1hcmdpbi10b3A6IDhweDsgd2lkdGg6IDMwMHB4OyBoZWlnaHQ6MjU1cHg7Iik7CiAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocmVjb21tZW5kQXJ0aWNsZUNvb2tpZSkgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1yZWNvbW1lbmRhcnRpY2xlLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtcmVjb21tZW5kYXJ0aWNsZS1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbmZpZy5saXN0ZW5CdXR0b24oIiN0b2dnbGUtcmVjb21tZW5kYXJ0aWNsZS1idXR0b24iLCAicmVjb21tZW5kQXJ0aWNsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSk7CgogICAgICAgICAgICAvLyDlvZLmoaMKICAgICAgICAgICAgbGV0IGFyY2hpdmVDb29raWUgPSBjb25maWcuZ2V0KCJhcmNoaXZlIiwgZmFsc2UpOwogICAgICAgICAgICBpZiAoIWFyY2hpdmVDb29raWUpIHsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnI2FzaWRlQXJjaGl2ZScpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgfSwgMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCcjcmVjb21tZW5kLXJpZ2h0JykuYXBwZW5kKCQoIiNhc2lkZUFyY2hpdmUiKS5wcm9wKCJvdXRlckhUTUwiKSk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICQoJyNhc2lkZUFyY2hpdmUnKS5hdHRyKCJzdHlsZSIsICJtYXJnaW4tdG9wOiA4cHg7IHdpZHRoOiAzMDBweDsgZGlzcGxheTpibG9jayAhaW1wb3J0YW50OyIpOwogICAgICAgICAgICAgICAgfSwgNTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXJjaGl2ZUNvb2tpZSkgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1hcmNoaXZlLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtYXJjaGl2ZS1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbmZpZy5saXN0ZW5CdXR0b24oIiN0b2dnbGUtYXJjaGl2ZS1idXR0b24iLCAiYXJjaGl2ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSk7CgogICAgICAgICAgICAvLyDoh6rliqjpnaDlt6blubPpk7oKICAgICAgICAgICAgbGV0IGF1dG9TaXplQ29va2llID0gY29uZmlnLmdldCgiYXV0b1NpemUiLCBmYWxzZSk7CiAgICAgICAgICAgIGlmIChhdXRvU2l6ZUNvb2tpZSkgewogICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIC8vIOaWh+eroOWuveW6puiHqumAguW6lAogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IDExMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yig6Zmk5Y6f5pyJ5ZON5bqU5byP5qC35byPCiAgICAgICAgICAgICAgICAgICAgICAgICQoIi5tYWluX2ZhdGhlciIpLnJlbW92ZUNsYXNzKCJqdXN0aWZ5LWNvbnRlbnQtY2VudGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgICQoImNzZG4tc2lkZS10b29sYmFyIikuY3NzKCJsZWZ0IiwgImF1dG8iKQogICAgICAgICAgICAgICAgICAgICAgICAkKCJhcnRpY2xlIikud2lkdGgod2luZG93LmlubmVyV2lkdGggLSAxNTApOwogICAgICAgICAgICAgICAgICAgICAgICBHTV9hZGRTdHlsZShgCiAgICAgICAgICAgICAgICAgICAgICAgIG1haW57CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogYXV0byFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9hdDogbm9uZSFpbXBvcnRhbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXgtd2lkdGg6IDkwdnc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbWFpbiBhcnRpY2xlIGltZ3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4LXdpZHRoOiAxMDAlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LWZpdDogY292ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpZCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgiYXJ0aWNsZSIpLnJlbW92ZUF0dHIoInN0eWxlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGF1dG9TaXplQ29va2llKSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLWF1dG9zaXplLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtYXV0b3NpemUtYnV0dG9uIikucHJvcCgiY2hlY2tlZCIsIGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25maWcubGlzdGVuQnV0dG9uKCIjdG9nZ2xlLWF1dG9zaXplLWJ1dHRvbiIsICJhdXRvU2l6ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSk7CgogICAgICAgICAgICAvLyDoh6rliqjpmpDol4/pobbmoI8KICAgICAgICAgICAgbGV0IGF1dG9IaWRlVG9vbGJhckNvb2tpZSA9IGNvbmZpZy5nZXQoImF1dG9IaWRlVG9vbGJhciIsIHRydWUpOwogICAgICAgICAgICBpZiAoYXV0b0hpZGVUb29sYmFyQ29va2llKSB7CiAgICAgICAgICAgICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wID4gMTAwKSB7CiAgICAgICAgICAgICAgICAJICAgIGxldCBzY3JvbGxTID0gJCh0aGlzKS5zY3JvbGxUb3AoKTsKICAgICAgICAgICAgICAgIAkgICAgaWYgKHNjcm9sbFMgPj0gd2luZG93VG9wKSB7CiAgICAgICAgICAgICAgICAJICAgIAkkKCcjY3Nkbi10b29sYmFyJykuc2xpZGVVcCgxMDApOwogICAgICAgICAgICAgICAgCSAgICAJd2luZG93VG9wID0gc2Nyb2xsUzsKICAgICAgICAgICAgICAgIAkgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIAkgICAgCSQoJyNjc2RuLXRvb2xiYXInKS5zbGlkZURvd24oMTAwKTsKICAgICAgICAgICAgICAgIAkgICAgCXdpbmRvd1RvcCA9IHNjcm9sbFM7CiAgICAgICAgICAgICAgICAJICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYXV0b0hpZGVUb29sYmFyQ29va2llKSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLWF1dG9oaWRldG9vbGJhci1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLWF1dG9oaWRldG9vbGJhci1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbmZpZy5saXN0ZW5CdXR0b24oIiN0b2dnbGUtYXV0b2hpZGV0b29sYmFyLWJ1dHRvbiIsICJhdXRvSGlkZVRvb2xiYXIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge2xvY2F0aW9uLnJlbG9hZCgpO30pOwoKICAgICAgICAgICAgLy8g6Ieq5Yqo6ZqQ6JeP5bqV5qCPCiAgICAgICAgICAgIGxldCBhdXRvSGlkZUJvdHRvbUJhckNvb2tpZSA9IGNvbmZpZy5nZXQoImF1dG9IaWRlQm90dG9tQmFyIiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChhdXRvSGlkZUJvdHRvbUJhckNvb2tpZSkgewogICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgeyQoIiN0b29sQmFyQm94IC5sZWZ0LXRvb2xib3giKS5jc3MoewogICAgICAgICAgICAgICAgCXBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICAgICAgCWxlZnQ6ICIwcHgiLAogICAgICAgICAgICAgICAgCWJvdHRvbTogIjAiLAogICAgICAgICAgICAgICAgCXdpZHRoOiAkKCIjdG9vbEJhckJveCIpLndpZHRoKCkgKyAicHgiCiAgICAgICAgICAgICAgICB9KX0sIDMwMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhdXRvSGlkZUJvdHRvbUJhckNvb2tpZSkgewogICAgICAgICAgICAgICAgJCgiI3RvZ2dsZS1hdXRvaGlkZWJvdHRvbWJhci1idXR0b24iKS5wcm9wKCJjaGVja2VkIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkKCIjdG9nZ2xlLWF1dG9oaWRlYm90dG9tYmFyLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZmlnLmxpc3RlbkJ1dHRvbigiI3RvZ2dsZS1hdXRvaGlkZWJvdHRvbWJhci1idXR0b24iLCAiYXV0b0hpZGVCb3R0b21CYXIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge2xvY2F0aW9uLnJlbG9hZCgpO30pOwoKICAgICAgICAgICAgLy8g5Yib5L2c5Lit5b+D5oyJ6ZKuCiAgICAgICAgICAgIGxldCB3cml0ZUJsb2dDb29raWUgPSBjb25maWcuZ2V0KCJ3cml0ZUJsb2ciLCB0cnVlKTsKICAgICAgICAgICAgaWYgKCF3cml0ZUJsb2dDb29raWUpIHsKICAgICAgICAgICAgICAgICQoIi53cml0ZS1ib2xnLWJ0biIpLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh3cml0ZUJsb2dDb29raWUpIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtd3JpdGVibG9nLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICQoIiN0b2dnbGUtd3JpdGVibG9nLWJ1dHRvbiIpLnByb3AoImNoZWNrZWQiLCBmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZmlnLmxpc3RlbkJ1dHRvbigiI3RvZ2dsZS13cml0ZWJsb2ctYnV0dG9uIiwgIndyaXRlQmxvZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpIHtsb2NhdGlvbi5yZWxvYWQoKTt9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7bG9jYXRpb24ucmVsb2FkKCk7fSk7CgogICAgICAgICAgICAvLyDlj7Pkvqfmu5rliqjmnaEKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBsZXQgcmlnaHRTaWRlSGVpZ2h0ID0gMDsKICAgICAgICAgICAgICAgIGxldCBwYWdlSGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpOwogICAgICAgICAgICAgICAgcmlnaHRTaWRlSGVpZ2h0ICs9IGdldEhlaWdodCgkKCcuYWxpZ24taXRlbXMtc3RyZXRjaC5ncm91cF9pdGVtJykucGFyZW50KCkpOwogICAgICAgICAgICAgICAgcmlnaHRTaWRlSGVpZ2h0ICs9IGdldEhlaWdodCgkKCIjYXNpZGVQcm9maWxlIikpOwogICAgICAgICAgICAgICAgcmlnaHRTaWRlSGVpZ2h0ICs9IGdldEhlaWdodCgkKCIjYXNpZGVTZWFyY2hBcnRpY2xlIikpOwogICAgICAgICAgICAgICAgcmlnaHRTaWRlSGVpZ2h0ICs9IGdldEhlaWdodCgkKCIjYXNpZGVOZXdBcnRpY2xlIikpOwogICAgICAgICAgICAgICAgcmlnaHRTaWRlSGVpZ2h0ICs9IGdldEhlaWdodCgkKCIjYXNpZGVIb3RBcnRpY2xlIikpOwogICAgICAgICAgICAgICAgcmlnaHRTaWRlSGVpZ2h0ICs9IGdldEhlaWdodCgkKCIjYXNpZGVOZXdDb21tZW50cyIpKTsKICAgICAgICAgICAgICAgIHJpZ2h0U2lkZUhlaWdodCArPSBnZXRIZWlnaHQoJCgiI2FzaWRlQ2F0ZWdvcnkiKSk7CiAgICAgICAgICAgICAgICByaWdodFNpZGVIZWlnaHQgKz0gZ2V0SGVpZ2h0KCQoIiNhc2lkZUFyY2hpdmUiKSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnKCJSaWdodCBzaWRlIHRvdGFsIGhlaWdodDogIiArIHJpZ2h0U2lkZUhlaWdodCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnKCJQYWdlIGhlaWdodDogIiArIHBhZ2VIZWlnaHQpOwogICAgICAgICAgICAgICAgaWYgKHJpZ2h0U2lkZUhlaWdodCA+IHBhZ2VIZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgICAkKCcjcmVjb21tZW5kLXJpZ2h0JykuY3NzKCJvdmVyZmxvdyIsICJzY3JvbGwiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgfSBlbHNlIGlmIChudW0gPT09IDcpIHsKICAgICAgICAgICAgJCgiLm1lX3IiKVsxXS5yZW1vdmUoKTsKICAgICAgICB9IGVsc2UgaWYgKG51bSA9PT0gOCkgewogICAgICAgICAgICAvKiAkKCIuYXJ0aWNsZS1iYXItdG9wIikuYXBwZW5kKCI8YnI+Iik7CiAgICAgICAgICAgICQoIi5hcnRpY2xlLWJhci10b3AiKS5hcHBlbmQoJCgiLmFzaWRlLWJveC1mb290ZXJDbGFzc2lmeSIpLmNoaWxkcmVuKCJkZCIpLmh0bWwoKSk7CiAgICAgICAgICAgICQoImRsIikuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSAkKHRoaXMpLmNoaWxkcmVuKCJkdCIpOwogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gJCh0aGlzKS5jaGlsZHJlbigiZGQiKS5jaGlsZHJlbigic3BhbiIpOwogICAgICAgICAgICAgICAgaWYgKGtleS5odG1sKCkuaW5kZXhPZigi5Y6f5YibIikgIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBrZXkgPSAkKHRoaXMpLmNoaWxkcmVuKCJkdCIpLmNoaWxkcmVuKCJhIikKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICQodGhpcykuY2hpbGRyZW4oImRkIikuY2hpbGRyZW4oImEiKS5jaGlsZHJlbigic3BhbiIpOwogICAgICAgICAgICAgICAgICAgIGFkZEluZm8oa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5odG1sKCkgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkSW5mbyhrZXksIHZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSApOwogICAgICAgICAgICBmdW5jdGlvbiBhZGRJbmZvKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhciBiaW5kID0ga2V5Lmh0bWwoKSArICImbmJzcDsiICsgdmFsdWUuaHRtbCgpICsgIiZuYnNwOyZuYnNwOyI7CiAgICAgICAgICAgICAgICAkKCIuYXJ0aWNsZS1iYXItdG9wIikuYXBwZW5kKGJpbmQgKyAiICIpOwogICAgICAgICAgICB9ICovCiAgICAgICAgICAgICQoIi5ibG9nX2NvbnRhaW5lcl9hc2lkZSIpLnJlbW92ZSgpOwoKICAgICAgICAgICAgLy8g5qCH6aKY5raI5oGv5o+Q6YaS5Y676ZmkCiAgICAgICAgICAgIGxldCB0aXRsZSA9IGRvY3VtZW50LnRpdGxlLnJlcGxhY2UoL15cKC4qP1wpL2csICIiKTsKICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSB0aXRsZTsKICAgICAgICAgICAgLy8g6K+E6K665aSN5Yi25oyJ6ZKuCiAgICAgICAgICAgICQoJy5jb21tZW50LWJveCcpLnByZXBlbmQoJzxidXR0b24gY2xhc3M9ImNvbW1lbnQtaGlkZGVuLXRleHQiIHN0eWxlPSJkaXNwbGF5Om5vbmUiPkNPUFkgQlVUVE9OPC9idXR0b24+Jyk7CiAgICAgICAgICAgICQoJy5uZXctb3B0LWJveC5uZXctb3B0LWJveC1iZycpLnByZXBlbmQoJzxhIGNsYXNzPSJidG4gYnRuLXJlcG9ydCBidG4tY29weSIgb25jbGljaz0iamF2YXNjcmlwdDokKFwnLmNvbW1lbnQtaGlkZGVuLXRleHRcJykuYXR0cihcJ2RhdGEtY2xpcGJvYXJkLXRleHRcJywkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoXCcubmV3LWNvbW1lbnRcJykudGV4dCgpKSI+5aSN5Yi26K+E6K66PC9hPjxzcGFuIGNsYXNzPSJidG4tYmFyIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICQoJy5idG4tY29weScpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGNsaXBib2FyZCA9IG5ldyBDbGlwYm9hcmRKUygnLmNvbW1lbnQtaGlkZGVuLXRleHQnKTsKICAgICAgICAgICAgICAgIGNsaXBib2FyZC5vbignc3VjY2VzcycsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oJ0FjdGlvbjonLCBlLmFjdGlvbik7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdUZXh0OicsIGUudGV4dCk7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKCdUcmlnZ2VyOicsIGUudHJpZ2dlcik7CiAgICAgICAgICAgICAgICAgICAgZS5jbGVhclNlbGVjdGlvbigpOwogICAgICAgICAgICAgICAgICAgICQoJy5idG4tY29weScpLmh0bWwoJ+aIkOWKnycpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5idG4tY29weScpLmh0bWwoJ+WkjeWItuivhOiuuicpOwogICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjbGlwYm9hcmQub24oJ2Vycm9yJywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FjdGlvbjonLCBlLmFjdGlvbik7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVHJpZ2dlcjonLCBlLnRyaWdnZXIpOwogICAgICAgICAgICAgICAgICAgICQoJy5idG4tY29weScpLmh0bWwoJ+Wksei0pe+8jOivt+aJi+WKqOWkjeWIticpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5idG4tY29weScpLmh0bWwoJ+WkjeWItuivhOiuuicpOwogICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkKCIuY29tbWVudC1oaWRkZW4tdGV4dCIpLmNsaWNrKCk7CiAgICAgICAgICAgICAgICBjbGlwYm9hcmQuZGVzdHJveSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9LCAxMDApOwogICAgTlByb2dyZXNzLmluYygpOwp9CgovLyDphY3nva7mjqfliLbnsbsKY2xhc3MgQ29uZmlnIHsKICAgIGdldChrZXksIHZhbHVlKSB7CiAgICAgICAgdmFyIGNvb2tpZSA9ICQuY29va2llKGtleSk7CiAgICAgICAgaWYgKGNvb2tpZSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgbmV3IENvbmZpZygpLnNldChrZXksIHZhbHVlKTsKICAgICAgICAgICAgY29uc29sZS5kZWJ1ZygiUmVuZXcga2V5OiAiICsga2V5ICsgIiA6ICIgKyB2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5kZWJ1ZygiUmVhZCBrZXk6ICIgKyBrZXkgKyAiIDogIiArIGNvb2tpZSk7CiAgICAgICAgaWYgKGNvb2tpZSA9PT0gInRydWUiKSB7IHJldHVybiB0cnVlOyB9CiAgICAgICAgaWYgKGNvb2tpZSA9PT0gImZhbHNlIikgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICByZXR1cm4gY29va2llOwogICAgfQoKICAgIHNldChzZXRLZXksIHNldFZhbHVlKSB7CiAgICAgICAgJC5jb29raWUoc2V0S2V5LCBzZXRWYWx1ZSwgewogICAgICAgICAgICBwYXRoOiAnLycsCiAgICAgICAgICAgIGV4cGlyZXM6IDM2NQogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUuZGVidWcoIktleSBzZXQ6ICIgKyBzZXRLZXkgKyAiIDogIiArIHNldFZhbHVlKTsKICAgIH0KCiAgICBsaXN0ZW5CdXR0b24oZWxlbWVudCwgbGlzdGVuS2V5LCB0cnVlQWN0aW9uLCBmYWxzZUFjdGlvbikgewogICAgICAgICQoZWxlbWVudCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICBsZXQgc3RhdHVzID0gbmV3IENvbmZpZygpLmdldChsaXN0ZW5LZXksIHRydWUpOwogICAgICAgICAgICBjb25zb2xlLmRlYnVnKCJTdGF0dXM6ICIgKyBzdGF0dXMpOwogICAgICAgICAgICBpZiAoc3RhdHVzID09PSAidHJ1ZSIgfHwgc3RhdHVzKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmRlYnVnKCJLZXkgc2V0OiAiICsgbGlzdGVuS2V5ICsgIiA6OiAiICsgZmFsc2UpOwogICAgICAgICAgICAgICAgbmV3IENvbmZpZygpLnNldChsaXN0ZW5LZXksIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoIktleSBzZXQ6ICIgKyBsaXN0ZW5LZXkgKyAiIDo6ICIgKyB0cnVlKTsKICAgICAgICAgICAgICAgIG5ldyBDb25maWcoKS5zZXQobGlzdGVuS2V5LCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIGxpc3RlbkJ1dHRvbkFuZEFjdGlvbihlbGVtZW50LCBsaXN0ZW5LZXksIHRydWVBY3Rpb24sIGZhbHNlQWN0aW9uKSB7CiAgICAgICAgJChlbGVtZW50KS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGxldCBzdGF0dXMgPSBuZXcgQ29uZmlnKCkuZ2V0KGxpc3RlbktleSwgdHJ1ZSk7CiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoIlN0YXR1czogIiArIHN0YXR1cyk7CiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICJ0cnVlIiB8fCBzdGF0dXMpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoIktleSBzZXQ6ICIgKyBsaXN0ZW5LZXkgKyAiIDo6ICIgKyBmYWxzZSk7CiAgICAgICAgICAgICAgICBuZXcgQ29uZmlnKCkuc2V0KGxpc3RlbktleSwgZmFsc2UpOwogICAgICAgICAgICAgICAgZmFsc2VBY3Rpb24oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoIktleSBzZXQ6ICIgKyBsaXN0ZW5LZXkgKyAiIDo6ICIgKyB0cnVlKTsKICAgICAgICAgICAgICAgIG5ldyBDb25maWcoKS5zZXQobGlzdGVuS2V5LCB0cnVlKTsKICAgICAgICAgICAgICAgIHRydWVBY3Rpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9CgpmdW5jdGlvbiBzaG93VGlwcygpIHsKCXZhciBjb25maWcgPSB7CgkJY29udGVudDogIuasoui/juS9v+eUqCBDU0ROR3JlZW5lcu+8jOe7v+WMluiuvuWumuaMiemSruWcqOi/memHjO+8gTxicj48YSBocmVmPSdqYXZhc2NyaXB0OiQoXCIudHJpcHNcIikucmVtb3ZlKCk7Jz7lpb3nmoTvvIzku6XlkI7kuI3lho3mj5DnpLrmiJE8L2E+IiwKCQl0eXBlOiAiaHRtbCIsCgkJYWxpZ25UbzogWyJib3R0b20iLCAibGVmdCJdLAoJCXRyaWdnZXI6ICJzaG93IiwKCQlpc2Nsb3NlOiBmYWxzZSwKCQljb2xvcjogWyIjQjJFMjgxIiwgIiNCMkUyODEiXQoJfTsKCSQoIiNncmVlbmVyU2V0dGluZ3MiKS5zaG93VGlwcyhjb25maWcpOwp9CgpmdW5jdGlvbiBnZXRIZWlnaHQoZWxlbWVudCkgewogICAgbGV0IG91dGVySGVpZ2h0ID0gZWxlbWVudC5vdXRlckhlaWdodCgpOwogICAgaWYgKG91dGVySGVpZ2h0ID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICByZXR1cm4gb3V0ZXJIZWlnaHQ7Cn0K","requires":[{"meta":{"name":"jquery.cookie.js","url":"https://cdn.jsdelivr.net/npm/jquery.cookie/jquery.cookie.js","ts":1605519462334,"mimetype":"text/javascript"},"source":"LyohCiAqIGpRdWVyeSBDb29raWUgUGx1Z2luIHYxLjQuMQogKiBodHRwczovL2dpdGh1Yi5jb20vY2FyaGFydGwvanF1ZXJ5LWNvb2tpZQogKgogKiBDb3B5cmlnaHQgMjAxMyBLbGF1cyBIYXJ0bAogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICovCihmdW5jdGlvbiAoZmFjdG9yeSkgewoJaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewoJCS8vIEFNRAoJCWRlZmluZShbJ2pxdWVyeSddLCBmYWN0b3J5KTsKCX0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7CgkJLy8gQ29tbW9uSlMKCQlmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTsKCX0gZWxzZSB7CgkJLy8gQnJvd3NlciBnbG9iYWxzCgkJZmFjdG9yeShqUXVlcnkpOwoJfQp9KGZ1bmN0aW9uICgkKSB7CgoJdmFyIHBsdXNlcyA9IC9cKy9nOwoKCWZ1bmN0aW9uIGVuY29kZShzKSB7CgkJcmV0dXJuIGNvbmZpZy5yYXcgPyBzIDogZW5jb2RlVVJJQ29tcG9uZW50KHMpOwoJfQoKCWZ1bmN0aW9uIGRlY29kZShzKSB7CgkJcmV0dXJuIGNvbmZpZy5yYXcgPyBzIDogZGVjb2RlVVJJQ29tcG9uZW50KHMpOwoJfQoKCWZ1bmN0aW9uIHN0cmluZ2lmeUNvb2tpZVZhbHVlKHZhbHVlKSB7CgkJcmV0dXJuIGVuY29kZShjb25maWcuanNvbiA/IEpTT04uc3RyaW5naWZ5KHZhbHVlKSA6IFN0cmluZyh2YWx1ZSkpOwoJfQoKCWZ1bmN0aW9uIHBhcnNlQ29va2llVmFsdWUocykgewoJCWlmIChzLmluZGV4T2YoJyInKSA9PT0gMCkgewoJCQkvLyBUaGlzIGlzIGEgcXVvdGVkIGNvb2tpZSBhcyBhY2NvcmRpbmcgdG8gUkZDMjA2OCwgdW5lc2NhcGUuLi4KCQkJcyA9IHMuc2xpY2UoMSwgLTEpLnJlcGxhY2UoL1xcIi9nLCAnIicpLnJlcGxhY2UoL1xcXFwvZywgJ1xcJyk7CgkJfQoKCQl0cnkgewoJCQkvLyBSZXBsYWNlIHNlcnZlci1zaWRlIHdyaXR0ZW4gcGx1c2VzIHdpdGggc3BhY2VzLgoJCQkvLyBJZiB3ZSBjYW4ndCBkZWNvZGUgdGhlIGNvb2tpZSwgaWdub3JlIGl0LCBpdCdzIHVudXNhYmxlLgoJCQkvLyBJZiB3ZSBjYW4ndCBwYXJzZSB0aGUgY29va2llLCBpZ25vcmUgaXQsIGl0J3MgdW51c2FibGUuCgkJCXMgPSBkZWNvZGVVUklDb21wb25lbnQocy5yZXBsYWNlKHBsdXNlcywgJyAnKSk7CgkJCXJldHVybiBjb25maWcuanNvbiA/IEpTT04ucGFyc2UocykgOiBzOwoJCX0gY2F0Y2goZSkge30KCX0KCglmdW5jdGlvbiByZWFkKHMsIGNvbnZlcnRlcikgewoJCXZhciB2YWx1ZSA9IGNvbmZpZy5yYXcgPyBzIDogcGFyc2VDb29raWVWYWx1ZShzKTsKCQlyZXR1cm4gJC5pc0Z1bmN0aW9uKGNvbnZlcnRlcikgPyBjb252ZXJ0ZXIodmFsdWUpIDogdmFsdWU7Cgl9CgoJdmFyIGNvbmZpZyA9ICQuY29va2llID0gZnVuY3Rpb24gKGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKCgkJLy8gV3JpdGUKCgkJaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgISQuaXNGdW5jdGlvbih2YWx1ZSkpIHsKCQkJb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBjb25maWcuZGVmYXVsdHMsIG9wdGlvbnMpOwoKCQkJaWYgKHR5cGVvZiBvcHRpb25zLmV4cGlyZXMgPT09ICdudW1iZXInKSB7CgkJCQl2YXIgZGF5cyA9IG9wdGlvbnMuZXhwaXJlcywgdCA9IG9wdGlvbnMuZXhwaXJlcyA9IG5ldyBEYXRlKCk7CgkJCQl0LnNldFRpbWUoK3QgKyBkYXlzICogODY0ZSs1KTsKCQkJfQoKCQkJcmV0dXJuIChkb2N1bWVudC5jb29raWUgPSBbCgkJCQllbmNvZGUoa2V5KSwgJz0nLCBzdHJpbmdpZnlDb29raWVWYWx1ZSh2YWx1ZSksCgkJCQlvcHRpb25zLmV4cGlyZXMgPyAnOyBleHBpcmVzPScgKyBvcHRpb25zLmV4cGlyZXMudG9VVENTdHJpbmcoKSA6ICcnLCAvLyB1c2UgZXhwaXJlcyBhdHRyaWJ1dGUsIG1heC1hZ2UgaXMgbm90IHN1cHBvcnRlZCBieSBJRQoJCQkJb3B0aW9ucy5wYXRoICAgID8gJzsgcGF0aD0nICsgb3B0aW9ucy5wYXRoIDogJycsCgkJCQlvcHRpb25zLmRvbWFpbiAgPyAnOyBkb21haW49JyArIG9wdGlvbnMuZG9tYWluIDogJycsCgkJCQlvcHRpb25zLnNlY3VyZSAgPyAnOyBzZWN1cmUnIDogJycKCQkJXS5qb2luKCcnKSk7CgkJfQoKCQkvLyBSZWFkCgoJCXZhciByZXN1bHQgPSBrZXkgPyB1bmRlZmluZWQgOiB7fTsKCgkJLy8gVG8gcHJldmVudCB0aGUgZm9yIGxvb3AgaW4gdGhlIGZpcnN0IHBsYWNlIGFzc2lnbiBhbiBlbXB0eSBhcnJheQoJCS8vIGluIGNhc2UgdGhlcmUgYXJlIG5vIGNvb2tpZXMgYXQgYWxsLiBBbHNvIHByZXZlbnRzIG9kZCByZXN1bHQgd2hlbgoJCS8vIGNhbGxpbmcgJC5jb29raWUoKS4KCQl2YXIgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZSA/IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOyAnKSA6IFtdOwoKCQlmb3IgKHZhciBpID0gMCwgbCA9IGNvb2tpZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CgkJCXZhciBwYXJ0cyA9IGNvb2tpZXNbaV0uc3BsaXQoJz0nKTsKCQkJdmFyIG5hbWUgPSBkZWNvZGUocGFydHMuc2hpZnQoKSk7CgkJCXZhciBjb29raWUgPSBwYXJ0cy5qb2luKCc9Jyk7CgoJCQlpZiAoa2V5ICYmIGtleSA9PT0gbmFtZSkgewoJCQkJLy8gSWYgc2Vjb25kIGFyZ3VtZW50ICh2YWx1ZSkgaXMgYSBmdW5jdGlvbiBpdCdzIGEgY29udmVydGVyLi4uCgkJCQlyZXN1bHQgPSByZWFkKGNvb2tpZSwgdmFsdWUpOwoJCQkJYnJlYWs7CgkJCX0KCgkJCS8vIFByZXZlbnQgc3RvcmluZyBhIGNvb2tpZSB0aGF0IHdlIGNvdWxkbid0IGRlY29kZS4KCQkJaWYgKCFrZXkgJiYgKGNvb2tpZSA9IHJlYWQoY29va2llKSkgIT09IHVuZGVmaW5lZCkgewoJCQkJcmVzdWx0W25hbWVdID0gY29va2llOwoJCQl9CgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoJfTsKCgljb25maWcuZGVmYXVsdHMgPSB7fTsKCgkkLnJlbW92ZUNvb2tpZSA9IGZ1bmN0aW9uIChrZXksIG9wdGlvbnMpIHsKCQlpZiAoJC5jb29raWUoa2V5KSA9PT0gdW5kZWZpbmVkKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCS8vIE11c3Qgbm90IGFsdGVyIG9wdGlvbnMsIHRodXMgZXh0ZW5kaW5nIGEgZnJlc2ggb2JqZWN0Li4uCgkJJC5jb29raWUoa2V5LCAnJywgJC5leHRlbmQoe30sIG9wdGlvbnMsIHsgZXhwaXJlczogLTEgfSkpOwoJCXJldHVybiAhJC5jb29raWUoa2V5KTsKCX07Cgp9KSk7Cg=="},{"meta":{"name":"nprogress.js","url":"https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js","ts":1605519462227,"mimetype":"text/javascript"},"source":"LyogTlByb2dyZXNzLCAoYykgMjAxMywgMjAxNCBSaWNvIFN0YS4gQ3J1eiAtIGh0dHA6Ly9yaWNvc3RhY3J1ei5jb20vbnByb2dyZXNzCiAqIEBsaWNlbnNlIE1JVCAqLwoKOyhmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7CgogIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIGRlZmluZShmYWN0b3J5KTsKICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgfSBlbHNlIHsKICAgIHJvb3QuTlByb2dyZXNzID0gZmFjdG9yeSgpOwogIH0KCn0pKHRoaXMsIGZ1bmN0aW9uKCkgewogIHZhciBOUHJvZ3Jlc3MgPSB7fTsKCiAgTlByb2dyZXNzLnZlcnNpb24gPSAnMC4yLjAnOwoKICB2YXIgU2V0dGluZ3MgPSBOUHJvZ3Jlc3Muc2V0dGluZ3MgPSB7CiAgICBtaW5pbXVtOiAwLjA4LAogICAgZWFzaW5nOiAnZWFzZScsCiAgICBwb3NpdGlvblVzaW5nOiAnJywKICAgIHNwZWVkOiAyMDAsCiAgICB0cmlja2xlOiB0cnVlLAogICAgdHJpY2tsZVJhdGU6IDAuMDIsCiAgICB0cmlja2xlU3BlZWQ6IDgwMCwKICAgIHNob3dTcGlubmVyOiB0cnVlLAogICAgYmFyU2VsZWN0b3I6ICdbcm9sZT0iYmFyIl0nLAogICAgc3Bpbm5lclNlbGVjdG9yOiAnW3JvbGU9InNwaW5uZXIiXScsCiAgICBwYXJlbnQ6ICdib2R5JywKICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz0iYmFyIiByb2xlPSJiYXIiPjxkaXYgY2xhc3M9InBlZyI+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0ic3Bpbm5lciIgcm9sZT0ic3Bpbm5lciI+PGRpdiBjbGFzcz0ic3Bpbm5lci1pY29uIj48L2Rpdj48L2Rpdj4nCiAgfTsKCiAgLyoqCiAgICogVXBkYXRlcyBjb25maWd1cmF0aW9uLgogICAqCiAgICogICAgIE5Qcm9ncmVzcy5jb25maWd1cmUoewogICAqICAgICAgIG1pbmltdW06IDAuMQogICAqICAgICB9KTsKICAgKi8KICBOUHJvZ3Jlc3MuY29uZmlndXJlID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgdmFyIGtleSwgdmFsdWU7CiAgICBmb3IgKGtleSBpbiBvcHRpb25zKSB7CiAgICAgIHZhbHVlID0gb3B0aW9uc1trZXldOwogICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmhhc093blByb3BlcnR5KGtleSkpIFNldHRpbmdzW2tleV0gPSB2YWx1ZTsKICAgIH0KCiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvKioKICAgKiBMYXN0IG51bWJlci4KICAgKi8KCiAgTlByb2dyZXNzLnN0YXR1cyA9IG51bGw7CgogIC8qKgogICAqIFNldHMgdGhlIHByb2dyZXNzIGJhciBzdGF0dXMsIHdoZXJlIGBuYCBpcyBhIG51bWJlciBmcm9tIGAwLjBgIHRvIGAxLjBgLgogICAqCiAgICogICAgIE5Qcm9ncmVzcy5zZXQoMC40KTsKICAgKiAgICAgTlByb2dyZXNzLnNldCgxLjApOwogICAqLwoKICBOUHJvZ3Jlc3Muc2V0ID0gZnVuY3Rpb24obikgewogICAgdmFyIHN0YXJ0ZWQgPSBOUHJvZ3Jlc3MuaXNTdGFydGVkKCk7CgogICAgbiA9IGNsYW1wKG4sIFNldHRpbmdzLm1pbmltdW0sIDEpOwogICAgTlByb2dyZXNzLnN0YXR1cyA9IChuID09PSAxID8gbnVsbCA6IG4pOwoKICAgIHZhciBwcm9ncmVzcyA9IE5Qcm9ncmVzcy5yZW5kZXIoIXN0YXJ0ZWQpLAogICAgICAgIGJhciAgICAgID0gcHJvZ3Jlc3MucXVlcnlTZWxlY3RvcihTZXR0aW5ncy5iYXJTZWxlY3RvciksCiAgICAgICAgc3BlZWQgICAgPSBTZXR0aW5ncy5zcGVlZCwKICAgICAgICBlYXNlICAgICA9IFNldHRpbmdzLmVhc2luZzsKCiAgICBwcm9ncmVzcy5vZmZzZXRXaWR0aDsgLyogUmVwYWludCAqLwoKICAgIHF1ZXVlKGZ1bmN0aW9uKG5leHQpIHsKICAgICAgLy8gU2V0IHBvc2l0aW9uVXNpbmcgaWYgaXQgaGFzbid0IGFscmVhZHkgYmVlbiBzZXQKICAgICAgaWYgKFNldHRpbmdzLnBvc2l0aW9uVXNpbmcgPT09ICcnKSBTZXR0aW5ncy5wb3NpdGlvblVzaW5nID0gTlByb2dyZXNzLmdldFBvc2l0aW9uaW5nQ1NTKCk7CgogICAgICAvLyBBZGQgdHJhbnNpdGlvbgogICAgICBjc3MoYmFyLCBiYXJQb3NpdGlvbkNTUyhuLCBzcGVlZCwgZWFzZSkpOwoKICAgICAgaWYgKG4gPT09IDEpIHsKICAgICAgICAvLyBGYWRlIG91dAogICAgICAgIGNzcyhwcm9ncmVzcywgeyAKICAgICAgICAgIHRyYW5zaXRpb246ICdub25lJywgCiAgICAgICAgICBvcGFjaXR5OiAxIAogICAgICAgIH0pOwogICAgICAgIHByb2dyZXNzLm9mZnNldFdpZHRoOyAvKiBSZXBhaW50ICovCgogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICBjc3MocHJvZ3Jlc3MsIHsgCiAgICAgICAgICAgIHRyYW5zaXRpb246ICdhbGwgJyArIHNwZWVkICsgJ21zIGxpbmVhcicsIAogICAgICAgICAgICBvcGFjaXR5OiAwIAogICAgICAgICAgfSk7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBOUHJvZ3Jlc3MucmVtb3ZlKCk7CiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIH0sIHNwZWVkKTsKICAgICAgICB9LCBzcGVlZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2V0VGltZW91dChuZXh0LCBzcGVlZCk7CiAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiB0aGlzOwogIH07CgogIE5Qcm9ncmVzcy5pc1N0YXJ0ZWQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0eXBlb2YgTlByb2dyZXNzLnN0YXR1cyA9PT0gJ251bWJlcic7CiAgfTsKCiAgLyoqCiAgICogU2hvd3MgdGhlIHByb2dyZXNzIGJhci4KICAgKiBUaGlzIGlzIHRoZSBzYW1lIGFzIHNldHRpbmcgdGhlIHN0YXR1cyB0byAwJSwgZXhjZXB0IHRoYXQgaXQgZG9lc24ndCBnbyBiYWNrd2FyZHMuCiAgICoKICAgKiAgICAgTlByb2dyZXNzLnN0YXJ0KCk7CiAgICoKICAgKi8KICBOUHJvZ3Jlc3Muc3RhcnQgPSBmdW5jdGlvbigpIHsKICAgIGlmICghTlByb2dyZXNzLnN0YXR1cykgTlByb2dyZXNzLnNldCgwKTsKCiAgICB2YXIgd29yayA9IGZ1bmN0aW9uKCkgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghTlByb2dyZXNzLnN0YXR1cykgcmV0dXJuOwogICAgICAgIE5Qcm9ncmVzcy50cmlja2xlKCk7CiAgICAgICAgd29yaygpOwogICAgICB9LCBTZXR0aW5ncy50cmlja2xlU3BlZWQpOwogICAgfTsKCiAgICBpZiAoU2V0dGluZ3MudHJpY2tsZSkgd29yaygpOwoKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8qKgogICAqIEhpZGVzIHRoZSBwcm9ncmVzcyBiYXIuCiAgICogVGhpcyBpcyB0aGUgKnNvcnQgb2YqIHRoZSBzYW1lIGFzIHNldHRpbmcgdGhlIHN0YXR1cyB0byAxMDAlLCB3aXRoIHRoZQogICAqIGRpZmZlcmVuY2UgYmVpbmcgYGRvbmUoKWAgbWFrZXMgc29tZSBwbGFjZWJvIGVmZmVjdCBvZiBzb21lIHJlYWxpc3RpYyBtb3Rpb24uCiAgICoKICAgKiAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgKgogICAqIElmIGB0cnVlYCBpcyBwYXNzZWQsIGl0IHdpbGwgc2hvdyB0aGUgcHJvZ3Jlc3MgYmFyIGV2ZW4gaWYgaXRzIGhpZGRlbi4KICAgKgogICAqICAgICBOUHJvZ3Jlc3MuZG9uZSh0cnVlKTsKICAgKi8KCiAgTlByb2dyZXNzLmRvbmUgPSBmdW5jdGlvbihmb3JjZSkgewogICAgaWYgKCFmb3JjZSAmJiAhTlByb2dyZXNzLnN0YXR1cykgcmV0dXJuIHRoaXM7CgogICAgcmV0dXJuIE5Qcm9ncmVzcy5pbmMoMC4zICsgMC41ICogTWF0aC5yYW5kb20oKSkuc2V0KDEpOwogIH07CgogIC8qKgogICAqIEluY3JlbWVudHMgYnkgYSByYW5kb20gYW1vdW50LgogICAqLwoKICBOUHJvZ3Jlc3MuaW5jID0gZnVuY3Rpb24oYW1vdW50KSB7CiAgICB2YXIgbiA9IE5Qcm9ncmVzcy5zdGF0dXM7CgogICAgaWYgKCFuKSB7CiAgICAgIHJldHVybiBOUHJvZ3Jlc3Muc3RhcnQoKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICh0eXBlb2YgYW1vdW50ICE9PSAnbnVtYmVyJykgewogICAgICAgIGFtb3VudCA9ICgxIC0gbikgKiBjbGFtcChNYXRoLnJhbmRvbSgpICogbiwgMC4xLCAwLjk1KTsKICAgICAgfQoKICAgICAgbiA9IGNsYW1wKG4gKyBhbW91bnQsIDAsIDAuOTk0KTsKICAgICAgcmV0dXJuIE5Qcm9ncmVzcy5zZXQobik7CiAgICB9CiAgfTsKCiAgTlByb2dyZXNzLnRyaWNrbGUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBOUHJvZ3Jlc3MuaW5jKE1hdGgucmFuZG9tKCkgKiBTZXR0aW5ncy50cmlja2xlUmF0ZSk7CiAgfTsKCiAgLyoqCiAgICogV2FpdHMgZm9yIGFsbCBzdXBwbGllZCBqUXVlcnkgcHJvbWlzZXMgYW5kCiAgICogaW5jcmVhc2VzIHRoZSBwcm9ncmVzcyBhcyB0aGUgcHJvbWlzZXMgcmVzb2x2ZS4KICAgKgogICAqIEBwYXJhbSAkcHJvbWlzZSBqUVVlcnkgUHJvbWlzZQogICAqLwogIChmdW5jdGlvbigpIHsKICAgIHZhciBpbml0aWFsID0gMCwgY3VycmVudCA9IDA7CgogICAgTlByb2dyZXNzLnByb21pc2UgPSBmdW5jdGlvbigkcHJvbWlzZSkgewogICAgICBpZiAoISRwcm9taXNlIHx8ICRwcm9taXNlLnN0YXRlKCkgPT09ICJyZXNvbHZlZCIpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgaWYgKGN1cnJlbnQgPT09IDApIHsKICAgICAgICBOUHJvZ3Jlc3Muc3RhcnQoKTsKICAgICAgfQoKICAgICAgaW5pdGlhbCsrOwogICAgICBjdXJyZW50Kys7CgogICAgICAkcHJvbWlzZS5hbHdheXMoZnVuY3Rpb24oKSB7CiAgICAgICAgY3VycmVudC0tOwogICAgICAgIGlmIChjdXJyZW50ID09PSAwKSB7CiAgICAgICAgICAgIGluaXRpYWwgPSAwOwogICAgICAgICAgICBOUHJvZ3Jlc3MuZG9uZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIE5Qcm9ncmVzcy5zZXQoKGluaXRpYWwgLSBjdXJyZW50KSAvIGluaXRpYWwpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogIH0pKCk7CgogIC8qKgogICAqIChJbnRlcm5hbCkgcmVuZGVycyB0aGUgcHJvZ3Jlc3MgYmFyIG1hcmt1cCBiYXNlZCBvbiB0aGUgYHRlbXBsYXRlYAogICAqIHNldHRpbmcuCiAgICovCgogIE5Qcm9ncmVzcy5yZW5kZXIgPSBmdW5jdGlvbihmcm9tU3RhcnQpIHsKICAgIGlmIChOUHJvZ3Jlc3MuaXNSZW5kZXJlZCgpKSByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25wcm9ncmVzcycpOwoKICAgIGFkZENsYXNzKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgJ25wcm9ncmVzcy1idXN5Jyk7CiAgICAKICAgIHZhciBwcm9ncmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgcHJvZ3Jlc3MuaWQgPSAnbnByb2dyZXNzJzsKICAgIHByb2dyZXNzLmlubmVySFRNTCA9IFNldHRpbmdzLnRlbXBsYXRlOwoKICAgIHZhciBiYXIgICAgICA9IHByb2dyZXNzLnF1ZXJ5U2VsZWN0b3IoU2V0dGluZ3MuYmFyU2VsZWN0b3IpLAogICAgICAgIHBlcmMgICAgID0gZnJvbVN0YXJ0ID8gJy0xMDAnIDogdG9CYXJQZXJjKE5Qcm9ncmVzcy5zdGF0dXMgfHwgMCksCiAgICAgICAgcGFyZW50ICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFNldHRpbmdzLnBhcmVudCksCiAgICAgICAgc3Bpbm5lcjsKICAgIAogICAgY3NzKGJhciwgewogICAgICB0cmFuc2l0aW9uOiAnYWxsIDAgbGluZWFyJywKICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlM2QoJyArIHBlcmMgKyAnJSwwLDApJwogICAgfSk7CgogICAgaWYgKCFTZXR0aW5ncy5zaG93U3Bpbm5lcikgewogICAgICBzcGlubmVyID0gcHJvZ3Jlc3MucXVlcnlTZWxlY3RvcihTZXR0aW5ncy5zcGlubmVyU2VsZWN0b3IpOwogICAgICBzcGlubmVyICYmIHJlbW92ZUVsZW1lbnQoc3Bpbm5lcik7CiAgICB9CgogICAgaWYgKHBhcmVudCAhPSBkb2N1bWVudC5ib2R5KSB7CiAgICAgIGFkZENsYXNzKHBhcmVudCwgJ25wcm9ncmVzcy1jdXN0b20tcGFyZW50Jyk7CiAgICB9CgogICAgcGFyZW50LmFwcGVuZENoaWxkKHByb2dyZXNzKTsKICAgIHJldHVybiBwcm9ncmVzczsKICB9OwoKICAvKioKICAgKiBSZW1vdmVzIHRoZSBlbGVtZW50LiBPcHBvc2l0ZSBvZiByZW5kZXIoKS4KICAgKi8KCiAgTlByb2dyZXNzLnJlbW92ZSA9IGZ1bmN0aW9uKCkgewogICAgcmVtb3ZlQ2xhc3MoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCAnbnByb2dyZXNzLWJ1c3knKTsKICAgIHJlbW92ZUNsYXNzKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoU2V0dGluZ3MucGFyZW50KSwgJ25wcm9ncmVzcy1jdXN0b20tcGFyZW50Jyk7CiAgICB2YXIgcHJvZ3Jlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnByb2dyZXNzJyk7CiAgICBwcm9ncmVzcyAmJiByZW1vdmVFbGVtZW50KHByb2dyZXNzKTsKICB9OwoKICAvKioKICAgKiBDaGVja3MgaWYgdGhlIHByb2dyZXNzIGJhciBpcyByZW5kZXJlZC4KICAgKi8KCiAgTlByb2dyZXNzLmlzUmVuZGVyZWQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiAhIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCducHJvZ3Jlc3MnKTsKICB9OwoKICAvKioKICAgKiBEZXRlcm1pbmUgd2hpY2ggcG9zaXRpb25pbmcgQ1NTIHJ1bGUgdG8gdXNlLgogICAqLwoKICBOUHJvZ3Jlc3MuZ2V0UG9zaXRpb25pbmdDU1MgPSBmdW5jdGlvbigpIHsKICAgIC8vIFNuaWZmIG9uIGRvY3VtZW50LmJvZHkuc3R5bGUKICAgIHZhciBib2R5U3R5bGUgPSBkb2N1bWVudC5ib2R5LnN0eWxlOwoKICAgIC8vIFNuaWZmIHByZWZpeGVzCiAgICB2YXIgdmVuZG9yUHJlZml4ID0gKCdXZWJraXRUcmFuc2Zvcm0nIGluIGJvZHlTdHlsZSkgPyAnV2Via2l0JyA6CiAgICAgICAgICAgICAgICAgICAgICAgKCdNb3pUcmFuc2Zvcm0nIGluIGJvZHlTdHlsZSkgPyAnTW96JyA6CiAgICAgICAgICAgICAgICAgICAgICAgKCdtc1RyYW5zZm9ybScgaW4gYm9keVN0eWxlKSA/ICdtcycgOgogICAgICAgICAgICAgICAgICAgICAgICgnT1RyYW5zZm9ybScgaW4gYm9keVN0eWxlKSA/ICdPJyA6ICcnOwoKICAgIGlmICh2ZW5kb3JQcmVmaXggKyAnUGVyc3BlY3RpdmUnIGluIGJvZHlTdHlsZSkgewogICAgICAvLyBNb2Rlcm4gYnJvd3NlcnMgd2l0aCAzRCBzdXBwb3J0LCBlLmcuIFdlYmtpdCwgSUUxMAogICAgICByZXR1cm4gJ3RyYW5zbGF0ZTNkJzsKICAgIH0gZWxzZSBpZiAodmVuZG9yUHJlZml4ICsgJ1RyYW5zZm9ybScgaW4gYm9keVN0eWxlKSB7CiAgICAgIC8vIEJyb3dzZXJzIHdpdGhvdXQgM0Qgc3VwcG9ydCwgZS5nLiBJRTkKICAgICAgcmV0dXJuICd0cmFuc2xhdGUnOwogICAgfSBlbHNlIHsKICAgICAgLy8gQnJvd3NlcnMgd2l0aG91dCB0cmFuc2xhdGUoKSBzdXBwb3J0LCBlLmcuIElFNy04CiAgICAgIHJldHVybiAnbWFyZ2luJzsKICAgIH0KICB9OwoKICAvKioKICAgKiBIZWxwZXJzCiAgICovCgogIGZ1bmN0aW9uIGNsYW1wKG4sIG1pbiwgbWF4KSB7CiAgICBpZiAobiA8IG1pbikgcmV0dXJuIG1pbjsKICAgIGlmIChuID4gbWF4KSByZXR1cm4gbWF4OwogICAgcmV0dXJuIG47CiAgfQoKICAvKioKICAgKiAoSW50ZXJuYWwpIGNvbnZlcnRzIGEgcGVyY2VudGFnZSAoYDAuLjFgKSB0byBhIGJhciB0cmFuc2xhdGVYCiAgICogcGVyY2VudGFnZSAoYC0xMDAlLi4wJWApLgogICAqLwoKICBmdW5jdGlvbiB0b0JhclBlcmMobikgewogICAgcmV0dXJuICgtMSArIG4pICogMTAwOwogIH0KCgogIC8qKgogICAqIChJbnRlcm5hbCkgcmV0dXJucyB0aGUgY29ycmVjdCBDU1MgZm9yIGNoYW5naW5nIHRoZSBiYXIncwogICAqIHBvc2l0aW9uIGdpdmVuIGFuIG4gcGVyY2VudGFnZSwgYW5kIHNwZWVkIGFuZCBlYXNlIGZyb20gU2V0dGluZ3MKICAgKi8KCiAgZnVuY3Rpb24gYmFyUG9zaXRpb25DU1Mobiwgc3BlZWQsIGVhc2UpIHsKICAgIHZhciBiYXJDU1M7CgogICAgaWYgKFNldHRpbmdzLnBvc2l0aW9uVXNpbmcgPT09ICd0cmFuc2xhdGUzZCcpIHsKICAgICAgYmFyQ1NTID0geyB0cmFuc2Zvcm06ICd0cmFuc2xhdGUzZCgnK3RvQmFyUGVyYyhuKSsnJSwwLDApJyB9OwogICAgfSBlbHNlIGlmIChTZXR0aW5ncy5wb3NpdGlvblVzaW5nID09PSAndHJhbnNsYXRlJykgewogICAgICBiYXJDU1MgPSB7IHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgnK3RvQmFyUGVyYyhuKSsnJSwwKScgfTsKICAgIH0gZWxzZSB7CiAgICAgIGJhckNTUyA9IHsgJ21hcmdpbi1sZWZ0JzogdG9CYXJQZXJjKG4pKyclJyB9OwogICAgfQoKICAgIGJhckNTUy50cmFuc2l0aW9uID0gJ2FsbCAnK3NwZWVkKydtcyAnK2Vhc2U7CgogICAgcmV0dXJuIGJhckNTUzsKICB9CgogIC8qKgogICAqIChJbnRlcm5hbCkgUXVldWVzIGEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQuCiAgICovCgogIHZhciBxdWV1ZSA9IChmdW5jdGlvbigpIHsKICAgIHZhciBwZW5kaW5nID0gW107CiAgICAKICAgIGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgIHZhciBmbiA9IHBlbmRpbmcuc2hpZnQoKTsKICAgICAgaWYgKGZuKSB7CiAgICAgICAgZm4obmV4dCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZnVuY3Rpb24oZm4pIHsKICAgICAgcGVuZGluZy5wdXNoKGZuKTsKICAgICAgaWYgKHBlbmRpbmcubGVuZ3RoID09IDEpIG5leHQoKTsKICAgIH07CiAgfSkoKTsKCiAgLyoqCiAgICogKEludGVybmFsKSBBcHBsaWVzIGNzcyBwcm9wZXJ0aWVzIHRvIGFuIGVsZW1lbnQsIHNpbWlsYXIgdG8gdGhlIGpRdWVyeSAKICAgKiBjc3MgbWV0aG9kLgogICAqCiAgICogV2hpbGUgdGhpcyBoZWxwZXIgZG9lcyBhc3Npc3Qgd2l0aCB2ZW5kb3IgcHJlZml4ZWQgcHJvcGVydHkgbmFtZXMsIGl0IAogICAqIGRvZXMgbm90IHBlcmZvcm0gYW55IG1hbmlwdWxhdGlvbiBvZiB2YWx1ZXMgcHJpb3IgdG8gc2V0dGluZyBzdHlsZXMuCiAgICovCgogIHZhciBjc3MgPSAoZnVuY3Rpb24oKSB7CiAgICB2YXIgY3NzUHJlZml4ZXMgPSBbICdXZWJraXQnLCAnTycsICdNb3onLCAnbXMnIF0sCiAgICAgICAgY3NzUHJvcHMgICAgPSB7fTsKCiAgICBmdW5jdGlvbiBjYW1lbENhc2Uoc3RyaW5nKSB7CiAgICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgvXi1tcy0vLCAnbXMtJykucmVwbGFjZSgvLShbXGRhLXpdKS9naSwgZnVuY3Rpb24obWF0Y2gsIGxldHRlcikgewogICAgICAgIHJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VmVuZG9yUHJvcChuYW1lKSB7CiAgICAgIHZhciBzdHlsZSA9IGRvY3VtZW50LmJvZHkuc3R5bGU7CiAgICAgIGlmIChuYW1lIGluIHN0eWxlKSByZXR1cm4gbmFtZTsKCiAgICAgIHZhciBpID0gY3NzUHJlZml4ZXMubGVuZ3RoLAogICAgICAgICAgY2FwTmFtZSA9IG5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDEpLAogICAgICAgICAgdmVuZG9yTmFtZTsKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIHZlbmRvck5hbWUgPSBjc3NQcmVmaXhlc1tpXSArIGNhcE5hbWU7CiAgICAgICAgaWYgKHZlbmRvck5hbWUgaW4gc3R5bGUpIHJldHVybiB2ZW5kb3JOYW1lOwogICAgICB9CgogICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRTdHlsZVByb3AobmFtZSkgewogICAgICBuYW1lID0gY2FtZWxDYXNlKG5hbWUpOwogICAgICByZXR1cm4gY3NzUHJvcHNbbmFtZV0gfHwgKGNzc1Byb3BzW25hbWVdID0gZ2V0VmVuZG9yUHJvcChuYW1lKSk7CiAgICB9CgogICAgZnVuY3Rpb24gYXBwbHlDc3MoZWxlbWVudCwgcHJvcCwgdmFsdWUpIHsKICAgICAgcHJvcCA9IGdldFN0eWxlUHJvcChwcm9wKTsKICAgICAgZWxlbWVudC5zdHlsZVtwcm9wXSA9IHZhbHVlOwogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbihlbGVtZW50LCBwcm9wZXJ0aWVzKSB7CiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzLAogICAgICAgICAgcHJvcCwgCiAgICAgICAgICB2YWx1ZTsKCiAgICAgIGlmIChhcmdzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgZm9yIChwcm9wIGluIHByb3BlcnRpZXMpIHsKICAgICAgICAgIHZhbHVlID0gcHJvcGVydGllc1twcm9wXTsKICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcCkpIGFwcGx5Q3NzKGVsZW1lbnQsIHByb3AsIHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXBwbHlDc3MoZWxlbWVudCwgYXJnc1sxXSwgYXJnc1syXSk7CiAgICAgIH0KICAgIH0KICB9KSgpOwoKICAvKioKICAgKiAoSW50ZXJuYWwpIERldGVybWluZXMgaWYgYW4gZWxlbWVudCBvciBzcGFjZSBzZXBhcmF0ZWQgbGlzdCBvZiBjbGFzcyBuYW1lcyBjb250YWlucyBhIGNsYXNzIG5hbWUuCiAgICovCgogIGZ1bmN0aW9uIGhhc0NsYXNzKGVsZW1lbnQsIG5hbWUpIHsKICAgIHZhciBsaXN0ID0gdHlwZW9mIGVsZW1lbnQgPT0gJ3N0cmluZycgPyBlbGVtZW50IDogY2xhc3NMaXN0KGVsZW1lbnQpOwogICAgcmV0dXJuIGxpc3QuaW5kZXhPZignICcgKyBuYW1lICsgJyAnKSA+PSAwOwogIH0KCiAgLyoqCiAgICogKEludGVybmFsKSBBZGRzIGEgY2xhc3MgdG8gYW4gZWxlbWVudC4KICAgKi8KCiAgZnVuY3Rpb24gYWRkQ2xhc3MoZWxlbWVudCwgbmFtZSkgewogICAgdmFyIG9sZExpc3QgPSBjbGFzc0xpc3QoZWxlbWVudCksCiAgICAgICAgbmV3TGlzdCA9IG9sZExpc3QgKyBuYW1lOwoKICAgIGlmIChoYXNDbGFzcyhvbGRMaXN0LCBuYW1lKSkgcmV0dXJuOyAKCiAgICAvLyBUcmltIHRoZSBvcGVuaW5nIHNwYWNlLgogICAgZWxlbWVudC5jbGFzc05hbWUgPSBuZXdMaXN0LnN1YnN0cmluZygxKTsKICB9CgogIC8qKgogICAqIChJbnRlcm5hbCkgUmVtb3ZlcyBhIGNsYXNzIGZyb20gYW4gZWxlbWVudC4KICAgKi8KCiAgZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWxlbWVudCwgbmFtZSkgewogICAgdmFyIG9sZExpc3QgPSBjbGFzc0xpc3QoZWxlbWVudCksCiAgICAgICAgbmV3TGlzdDsKCiAgICBpZiAoIWhhc0NsYXNzKGVsZW1lbnQsIG5hbWUpKSByZXR1cm47CgogICAgLy8gUmVwbGFjZSB0aGUgY2xhc3MgbmFtZS4KICAgIG5ld0xpc3QgPSBvbGRMaXN0LnJlcGxhY2UoJyAnICsgbmFtZSArICcgJywgJyAnKTsKCiAgICAvLyBUcmltIHRoZSBvcGVuaW5nIGFuZCBjbG9zaW5nIHNwYWNlcy4KICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gbmV3TGlzdC5zdWJzdHJpbmcoMSwgbmV3TGlzdC5sZW5ndGggLSAxKTsKICB9CgogIC8qKgogICAqIChJbnRlcm5hbCkgR2V0cyBhIHNwYWNlIHNlcGFyYXRlZCBsaXN0IG9mIHRoZSBjbGFzcyBuYW1lcyBvbiB0aGUgZWxlbWVudC4gCiAgICogVGhlIGxpc3QgaXMgd3JhcHBlZCB3aXRoIGEgc2luZ2xlIHNwYWNlIG9uIGVhY2ggZW5kIHRvIGZhY2lsaXRhdGUgZmluZGluZyAKICAgKiBtYXRjaGVzIHdpdGhpbiB0aGUgbGlzdC4KICAgKi8KCiAgZnVuY3Rpb24gY2xhc3NMaXN0KGVsZW1lbnQpIHsKICAgIHJldHVybiAoJyAnICsgKGVsZW1lbnQuY2xhc3NOYW1lIHx8ICcnKSArICcgJykucmVwbGFjZSgvXHMrL2dpLCAnICcpOwogIH0KCiAgLyoqCiAgICogKEludGVybmFsKSBSZW1vdmVzIGFuIGVsZW1lbnQgZnJvbSB0aGUgRE9NLgogICAqLwoKICBmdW5jdGlvbiByZW1vdmVFbGVtZW50KGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgJiYgZWxlbWVudC5wYXJlbnROb2RlICYmIGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTsKICB9CgogIHJldHVybiBOUHJvZ3Jlc3M7Cn0pOwoK"},{"meta":{"name":"clipboard.min.js","url":"https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js","ts":1605519462237,"mimetype":"text/javascript"},"source":"LyohCiAqIGNsaXBib2FyZC5qcyB2Mi4wLjYKICogaHR0cHM6Ly9jbGlwYm9hcmRqcy5jb20vCiAqIAogKiBMaWNlbnNlZCBNSVQgwqkgWmVubyBSb2NoYQogKi8KIWZ1bmN0aW9uKHQsZSl7Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYib2JqZWN0Ij09dHlwZW9mIG1vZHVsZT9tb2R1bGUuZXhwb3J0cz1lKCk6ImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW10sZSk6Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzP2V4cG9ydHMuQ2xpcGJvYXJkSlM9ZSgpOnQuQ2xpcGJvYXJkSlM9ZSgpfSh0aGlzLGZ1bmN0aW9uKCl7cmV0dXJuIG89e30sci5tPW49W2Z1bmN0aW9uKHQsZSl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3ZhciBlO2lmKCJTRUxFQ1QiPT09dC5ub2RlTmFtZSl0LmZvY3VzKCksZT10LnZhbHVlO2Vsc2UgaWYoIklOUFVUIj09PXQubm9kZU5hbWV8fCJURVhUQVJFQSI9PT10Lm5vZGVOYW1lKXt2YXIgbj10Lmhhc0F0dHJpYnV0ZSgicmVhZG9ubHkiKTtufHx0LnNldEF0dHJpYnV0ZSgicmVhZG9ubHkiLCIiKSx0LnNlbGVjdCgpLHQuc2V0U2VsZWN0aW9uUmFuZ2UoMCx0LnZhbHVlLmxlbmd0aCksbnx8dC5yZW1vdmVBdHRyaWJ1dGUoInJlYWRvbmx5IiksZT10LnZhbHVlfWVsc2V7dC5oYXNBdHRyaWJ1dGUoImNvbnRlbnRlZGl0YWJsZSIpJiZ0LmZvY3VzKCk7dmFyIG89d2luZG93LmdldFNlbGVjdGlvbigpLHI9ZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtyLnNlbGVjdE5vZGVDb250ZW50cyh0KSxvLnJlbW92ZUFsbFJhbmdlcygpLG8uYWRkUmFuZ2UociksZT1vLnRvU3RyaW5nKCl9cmV0dXJuIGV9fSxmdW5jdGlvbih0LGUpe2Z1bmN0aW9uIG4oKXt9bi5wcm90b3R5cGU9e29uOmZ1bmN0aW9uKHQsZSxuKXt2YXIgbz10aGlzLmV8fCh0aGlzLmU9e30pO3JldHVybihvW3RdfHwob1t0XT1bXSkpLnB1c2goe2ZuOmUsY3R4Om59KSx0aGlzfSxvbmNlOmZ1bmN0aW9uKHQsZSxuKXt2YXIgbz10aGlzO2Z1bmN0aW9uIHIoKXtvLm9mZih0LHIpLGUuYXBwbHkobixhcmd1bWVudHMpfXJldHVybiByLl89ZSx0aGlzLm9uKHQscixuKX0sZW1pdDpmdW5jdGlvbih0KXtmb3IodmFyIGU9W10uc2xpY2UuY2FsbChhcmd1bWVudHMsMSksbj0oKHRoaXMuZXx8KHRoaXMuZT17fSkpW3RdfHxbXSkuc2xpY2UoKSxvPTAscj1uLmxlbmd0aDtvPHI7bysrKW5bb10uZm4uYXBwbHkobltvXS5jdHgsZSk7cmV0dXJuIHRoaXN9LG9mZjpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuZXx8KHRoaXMuZT17fSksbz1uW3RdLHI9W107aWYobyYmZSlmb3IodmFyIGk9MCxhPW8ubGVuZ3RoO2k8YTtpKyspb1tpXS5mbiE9PWUmJm9baV0uZm4uXyE9PWUmJnIucHVzaChvW2ldKTtyZXR1cm4gci5sZW5ndGg/blt0XT1yOmRlbGV0ZSBuW3RdLHRoaXN9fSx0LmV4cG9ydHM9bix0LmV4cG9ydHMuVGlueUVtaXR0ZXI9bn0sZnVuY3Rpb24odCxlLG4pe3ZhciBkPW4oMyksaD1uKDQpO3QuZXhwb3J0cz1mdW5jdGlvbih0LGUsbil7aWYoIXQmJiFlJiYhbil0aHJvdyBuZXcgRXJyb3IoIk1pc3NpbmcgcmVxdWlyZWQgYXJndW1lbnRzIik7aWYoIWQuc3RyaW5nKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIlNlY29uZCBhcmd1bWVudCBtdXN0IGJlIGEgU3RyaW5nIik7aWYoIWQuZm4obikpdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhpcmQgYXJndW1lbnQgbXVzdCBiZSBhIEZ1bmN0aW9uIik7aWYoZC5ub2RlKHQpKXJldHVybiBzPWUsZj1uLCh1PXQpLmFkZEV2ZW50TGlzdGVuZXIocyxmKSx7ZGVzdHJveTpmdW5jdGlvbigpe3UucmVtb3ZlRXZlbnRMaXN0ZW5lcihzLGYpfX07aWYoZC5ub2RlTGlzdCh0KSlyZXR1cm4gYT10LGM9ZSxsPW4sQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChhLGZ1bmN0aW9uKHQpe3QuYWRkRXZlbnRMaXN0ZW5lcihjLGwpfSkse2Rlc3Ryb3k6ZnVuY3Rpb24oKXtBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGEsZnVuY3Rpb24odCl7dC5yZW1vdmVFdmVudExpc3RlbmVyKGMsbCl9KX19O2lmKGQuc3RyaW5nKHQpKXJldHVybiBvPXQscj1lLGk9bixoKGRvY3VtZW50LmJvZHksbyxyLGkpO3Rocm93IG5ldyBUeXBlRXJyb3IoIkZpcnN0IGFyZ3VtZW50IG11c3QgYmUgYSBTdHJpbmcsIEhUTUxFbGVtZW50LCBIVE1MQ29sbGVjdGlvbiwgb3IgTm9kZUxpc3QiKTt2YXIgbyxyLGksYSxjLGwsdSxzLGZ9fSxmdW5jdGlvbih0LG4pe24ubm9kZT1mdW5jdGlvbih0KXtyZXR1cm4gdm9pZCAwIT09dCYmdCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50JiYxPT09dC5ub2RlVHlwZX0sbi5ub2RlTGlzdD1mdW5jdGlvbih0KXt2YXIgZT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCk7cmV0dXJuIHZvaWQgMCE9PXQmJigiW29iamVjdCBOb2RlTGlzdF0iPT09ZXx8IltvYmplY3QgSFRNTENvbGxlY3Rpb25dIj09PWUpJiYibGVuZ3RoImluIHQmJigwPT09dC5sZW5ndGh8fG4ubm9kZSh0WzBdKSl9LG4uc3RyaW5nPWZ1bmN0aW9uKHQpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdHx8dCBpbnN0YW5jZW9mIFN0cmluZ30sbi5mbj1mdW5jdGlvbih0KXtyZXR1cm4iW29iamVjdCBGdW5jdGlvbl0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpfX0sZnVuY3Rpb24odCxlLG4pe3ZhciBhPW4oNSk7ZnVuY3Rpb24gaSh0LGUsbixvLHIpe3ZhciBpPWZ1bmN0aW9uKGUsbix0LG8pe3JldHVybiBmdW5jdGlvbih0KXt0LmRlbGVnYXRlVGFyZ2V0PWEodC50YXJnZXQsbiksdC5kZWxlZ2F0ZVRhcmdldCYmby5jYWxsKGUsdCl9fS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIHQuYWRkRXZlbnRMaXN0ZW5lcihuLGkscikse2Rlc3Ryb3k6ZnVuY3Rpb24oKXt0LnJlbW92ZUV2ZW50TGlzdGVuZXIobixpLHIpfX19dC5leHBvcnRzPWZ1bmN0aW9uKHQsZSxuLG8scil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIHQuYWRkRXZlbnRMaXN0ZW5lcj9pLmFwcGx5KG51bGwsYXJndW1lbnRzKToiZnVuY3Rpb24iPT10eXBlb2Ygbj9pLmJpbmQobnVsbCxkb2N1bWVudCkuYXBwbHkobnVsbCxhcmd1bWVudHMpOigic3RyaW5nIj09dHlwZW9mIHQmJih0PWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodCkpLEFycmF5LnByb3RvdHlwZS5tYXAuY2FsbCh0LGZ1bmN0aW9uKHQpe3JldHVybiBpKHQsZSxuLG8scil9KSl9fSxmdW5jdGlvbih0LGUpe2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgRWxlbWVudCYmIUVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXMpe3ZhciBuPUVsZW1lbnQucHJvdG90eXBlO24ubWF0Y2hlcz1uLm1hdGNoZXNTZWxlY3Rvcnx8bi5tb3pNYXRjaGVzU2VsZWN0b3J8fG4ubXNNYXRjaGVzU2VsZWN0b3J8fG4ub01hdGNoZXNTZWxlY3Rvcnx8bi53ZWJraXRNYXRjaGVzU2VsZWN0b3J9dC5leHBvcnRzPWZ1bmN0aW9uKHQsZSl7Zm9yKDt0JiY5IT09dC5ub2RlVHlwZTspe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiB0Lm1hdGNoZXMmJnQubWF0Y2hlcyhlKSlyZXR1cm4gdDt0PXQucGFyZW50Tm9kZX19fSxmdW5jdGlvbih0LGUsbil7InVzZSBzdHJpY3QiO24ucihlKTt2YXIgbz1uKDApLHI9bi5uKG8pLGk9ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3I/ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0fTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmdC5jb25zdHJ1Y3Rvcj09PVN5bWJvbCYmdCE9PVN5bWJvbC5wcm90b3R5cGU/InN5bWJvbCI6dHlwZW9mIHR9O2Z1bmN0aW9uIGEodCxlKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoO24rKyl7dmFyIG89ZVtuXTtvLmVudW1lcmFibGU9by5lbnVtZXJhYmxlfHwhMSxvLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gbyYmKG8ud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LG8ua2V5LG8pfX1mdW5jdGlvbiBjKHQpeyFmdW5jdGlvbih0LGUpe2lmKCEodCBpbnN0YW5jZW9mIGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpfSh0aGlzLGMpLHRoaXMucmVzb2x2ZU9wdGlvbnModCksdGhpcy5pbml0U2VsZWN0aW9uKCl9dmFyIGw9KGZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gZSYmYSh0LnByb3RvdHlwZSxlKSxuJiZhKHQsbiksdH0oYyxbe2tleToicmVzb2x2ZU9wdGlvbnMiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPTA8YXJndW1lbnRzLmxlbmd0aCYmdm9pZCAwIT09dD90Ont9O3RoaXMuYWN0aW9uPWUuYWN0aW9uLHRoaXMuY29udGFpbmVyPWUuY29udGFpbmVyLHRoaXMuZW1pdHRlcj1lLmVtaXR0ZXIsdGhpcy50YXJnZXQ9ZS50YXJnZXQsdGhpcy50ZXh0PWUudGV4dCx0aGlzLnRyaWdnZXI9ZS50cmlnZ2VyLHRoaXMuc2VsZWN0ZWRUZXh0PSIifX0se2tleToiaW5pdFNlbGVjdGlvbiIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnRleHQ/dGhpcy5zZWxlY3RGYWtlKCk6dGhpcy50YXJnZXQmJnRoaXMuc2VsZWN0VGFyZ2V0KCl9fSx7a2V5OiJzZWxlY3RGYWtlIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMsZT0icnRsIj09ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgiZGlyIik7dGhpcy5yZW1vdmVGYWtlKCksdGhpcy5mYWtlSGFuZGxlckNhbGxiYWNrPWZ1bmN0aW9uKCl7cmV0dXJuIHQucmVtb3ZlRmFrZSgpfSx0aGlzLmZha2VIYW5kbGVyPXRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIix0aGlzLmZha2VIYW5kbGVyQ2FsbGJhY2spfHwhMCx0aGlzLmZha2VFbGVtPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIiksdGhpcy5mYWtlRWxlbS5zdHlsZS5mb250U2l6ZT0iMTJwdCIsdGhpcy5mYWtlRWxlbS5zdHlsZS5ib3JkZXI9IjAiLHRoaXMuZmFrZUVsZW0uc3R5bGUucGFkZGluZz0iMCIsdGhpcy5mYWtlRWxlbS5zdHlsZS5tYXJnaW49IjAiLHRoaXMuZmFrZUVsZW0uc3R5bGUucG9zaXRpb249ImFic29sdXRlIix0aGlzLmZha2VFbGVtLnN0eWxlW2U/InJpZ2h0IjoibGVmdCJdPSItOTk5OXB4Ijt2YXIgbj13aW5kb3cucGFnZVlPZmZzZXR8fGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7dGhpcy5mYWtlRWxlbS5zdHlsZS50b3A9bisicHgiLHRoaXMuZmFrZUVsZW0uc2V0QXR0cmlidXRlKCJyZWFkb25seSIsIiIpLHRoaXMuZmFrZUVsZW0udmFsdWU9dGhpcy50ZXh0LHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZmFrZUVsZW0pLHRoaXMuc2VsZWN0ZWRUZXh0PXIoKSh0aGlzLmZha2VFbGVtKSx0aGlzLmNvcHlUZXh0KCl9fSx7a2V5OiJyZW1vdmVGYWtlIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuZmFrZUhhbmRsZXImJih0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsdGhpcy5mYWtlSGFuZGxlckNhbGxiYWNrKSx0aGlzLmZha2VIYW5kbGVyPW51bGwsdGhpcy5mYWtlSGFuZGxlckNhbGxiYWNrPW51bGwpLHRoaXMuZmFrZUVsZW0mJih0aGlzLmNvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLmZha2VFbGVtKSx0aGlzLmZha2VFbGVtPW51bGwpfX0se2tleToic2VsZWN0VGFyZ2V0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuc2VsZWN0ZWRUZXh0PXIoKSh0aGlzLnRhcmdldCksdGhpcy5jb3B5VGV4dCgpfX0se2tleToiY29weVRleHQiLHZhbHVlOmZ1bmN0aW9uKCl7dmFyIGU9dm9pZCAwO3RyeXtlPWRvY3VtZW50LmV4ZWNDb21tYW5kKHRoaXMuYWN0aW9uKX1jYXRjaCh0KXtlPSExfXRoaXMuaGFuZGxlUmVzdWx0KGUpfX0se2tleToiaGFuZGxlUmVzdWx0Iix2YWx1ZTpmdW5jdGlvbih0KXt0aGlzLmVtaXR0ZXIuZW1pdCh0PyJzdWNjZXNzIjoiZXJyb3IiLHthY3Rpb246dGhpcy5hY3Rpb24sdGV4dDp0aGlzLnNlbGVjdGVkVGV4dCx0cmlnZ2VyOnRoaXMudHJpZ2dlcixjbGVhclNlbGVjdGlvbjp0aGlzLmNsZWFyU2VsZWN0aW9uLmJpbmQodGhpcyl9KX19LHtrZXk6ImNsZWFyU2VsZWN0aW9uIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMudHJpZ2dlciYmdGhpcy50cmlnZ2VyLmZvY3VzKCksZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5ibHVyKCksd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpfX0se2tleToiZGVzdHJveSIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnJlbW92ZUZha2UoKX19LHtrZXk6ImFjdGlvbiIsc2V0OmZ1bmN0aW9uKHQpe3ZhciBlPTA8YXJndW1lbnRzLmxlbmd0aCYmdm9pZCAwIT09dD90OiJjb3B5IjtpZih0aGlzLl9hY3Rpb249ZSwiY29weSIhPT10aGlzLl9hY3Rpb24mJiJjdXQiIT09dGhpcy5fYWN0aW9uKXRocm93IG5ldyBFcnJvcignSW52YWxpZCAiYWN0aW9uIiB2YWx1ZSwgdXNlIGVpdGhlciAiY29weSIgb3IgImN1dCInKX0sZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2FjdGlvbn19LHtrZXk6InRhcmdldCIsc2V0OmZ1bmN0aW9uKHQpe2lmKHZvaWQgMCE9PXQpe2lmKCF0fHwib2JqZWN0IiE9PSh2b2lkIDA9PT10PyJ1bmRlZmluZWQiOmkodCkpfHwxIT09dC5ub2RlVHlwZSl0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgInRhcmdldCIgdmFsdWUsIHVzZSBhIHZhbGlkIEVsZW1lbnQnKTtpZigiY29weSI9PT10aGlzLmFjdGlvbiYmdC5oYXNBdHRyaWJ1dGUoImRpc2FibGVkIikpdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkICJ0YXJnZXQiIGF0dHJpYnV0ZS4gUGxlYXNlIHVzZSAicmVhZG9ubHkiIGluc3RlYWQgb2YgImRpc2FibGVkIiBhdHRyaWJ1dGUnKTtpZigiY3V0Ij09PXRoaXMuYWN0aW9uJiYodC5oYXNBdHRyaWJ1dGUoInJlYWRvbmx5Iil8fHQuaGFzQXR0cmlidXRlKCJkaXNhYmxlZCIpKSl0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgInRhcmdldCIgYXR0cmlidXRlLiBZb3UgY2FuXCd0IGN1dCB0ZXh0IGZyb20gZWxlbWVudHMgd2l0aCAicmVhZG9ubHkiIG9yICJkaXNhYmxlZCIgYXR0cmlidXRlcycpO3RoaXMuX3RhcmdldD10fX0sZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3RhcmdldH19XSksYyksdT1uKDEpLHM9bi5uKHUpLGY9bigyKSxkPW4ubihmKSxoPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdH06ZnVuY3Rpb24odCl7cmV0dXJuIHQmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJnQuY29uc3RydWN0b3I9PT1TeW1ib2wmJnQhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiB0fSxwPWZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gZSYmeSh0LnByb3RvdHlwZSxlKSxuJiZ5KHQsbiksdH07ZnVuY3Rpb24geSh0LGUpe2Zvcih2YXIgbj0wO248ZS5sZW5ndGg7bisrKXt2YXIgbz1lW25dO28uZW51bWVyYWJsZT1vLmVudW1lcmFibGV8fCExLG8uY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiBvJiYoby53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsby5rZXksbyl9fXZhciBtPShmdW5jdGlvbih0LGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlJiZudWxsIT09ZSl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrdHlwZW9mIGUpO3QucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLGUmJihPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsZSk6dC5fX3Byb3RvX189ZSl9KHYscy5hKSxwKHYsW3trZXk6InJlc29sdmVPcHRpb25zIix2YWx1ZTpmdW5jdGlvbih0KXt2YXIgZT0wPGFyZ3VtZW50cy5sZW5ndGgmJnZvaWQgMCE9PXQ/dDp7fTt0aGlzLmFjdGlvbj0iZnVuY3Rpb24iPT10eXBlb2YgZS5hY3Rpb24/ZS5hY3Rpb246dGhpcy5kZWZhdWx0QWN0aW9uLHRoaXMudGFyZ2V0PSJmdW5jdGlvbiI9PXR5cGVvZiBlLnRhcmdldD9lLnRhcmdldDp0aGlzLmRlZmF1bHRUYXJnZXQsdGhpcy50ZXh0PSJmdW5jdGlvbiI9PXR5cGVvZiBlLnRleHQ/ZS50ZXh0OnRoaXMuZGVmYXVsdFRleHQsdGhpcy5jb250YWluZXI9Im9iamVjdCI9PT1oKGUuY29udGFpbmVyKT9lLmNvbnRhaW5lcjpkb2N1bWVudC5ib2R5fX0se2tleToibGlzdGVuQ2xpY2siLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXM7dGhpcy5saXN0ZW5lcj1kKCkodCwiY2xpY2siLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uQ2xpY2sodCl9KX19LHtrZXk6Im9uQ2xpY2siLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPXQuZGVsZWdhdGVUYXJnZXR8fHQuY3VycmVudFRhcmdldDt0aGlzLmNsaXBib2FyZEFjdGlvbiYmKHRoaXMuY2xpcGJvYXJkQWN0aW9uPW51bGwpLHRoaXMuY2xpcGJvYXJkQWN0aW9uPW5ldyBsKHthY3Rpb246dGhpcy5hY3Rpb24oZSksdGFyZ2V0OnRoaXMudGFyZ2V0KGUpLHRleHQ6dGhpcy50ZXh0KGUpLGNvbnRhaW5lcjp0aGlzLmNvbnRhaW5lcix0cmlnZ2VyOmUsZW1pdHRlcjp0aGlzfSl9fSx7a2V5OiJkZWZhdWx0QWN0aW9uIix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gYigiYWN0aW9uIix0KX19LHtrZXk6ImRlZmF1bHRUYXJnZXQiLHZhbHVlOmZ1bmN0aW9uKHQpe3ZhciBlPWIoInRhcmdldCIsdCk7aWYoZSlyZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlKX19LHtrZXk6ImRlZmF1bHRUZXh0Iix2YWx1ZTpmdW5jdGlvbih0KXtyZXR1cm4gYigidGV4dCIsdCl9fSx7a2V5OiJkZXN0cm95Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMubGlzdGVuZXIuZGVzdHJveSgpLHRoaXMuY2xpcGJvYXJkQWN0aW9uJiYodGhpcy5jbGlwYm9hcmRBY3Rpb24uZGVzdHJveSgpLHRoaXMuY2xpcGJvYXJkQWN0aW9uPW51bGwpfX1dLFt7a2V5OiJpc1N1cHBvcnRlZCIsdmFsdWU6ZnVuY3Rpb24odCl7dmFyIGU9MDxhcmd1bWVudHMubGVuZ3RoJiZ2b2lkIDAhPT10P3Q6WyJjb3B5IiwiY3V0Il0sbj0ic3RyaW5nIj09dHlwZW9mIGU/W2VdOmUsbz0hIWRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN1cHBvcnRlZDtyZXR1cm4gbi5mb3JFYWNoKGZ1bmN0aW9uKHQpe289byYmISFkb2N1bWVudC5xdWVyeUNvbW1hbmRTdXBwb3J0ZWQodCl9KSxvfX1dKSx2KTtmdW5jdGlvbiB2KHQsZSl7IWZ1bmN0aW9uKHQsZSl7aWYoISh0IGluc3RhbmNlb2YgZSkpdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIil9KHRoaXMsdik7dmFyIG49ZnVuY3Rpb24odCxlKXtpZighdCl0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO3JldHVybiFlfHwib2JqZWN0IiE9dHlwZW9mIGUmJiJmdW5jdGlvbiIhPXR5cGVvZiBlP3Q6ZX0odGhpcywodi5fX3Byb3RvX198fE9iamVjdC5nZXRQcm90b3R5cGVPZih2KSkuY2FsbCh0aGlzKSk7cmV0dXJuIG4ucmVzb2x2ZU9wdGlvbnMoZSksbi5saXN0ZW5DbGljayh0KSxufWZ1bmN0aW9uIGIodCxlKXt2YXIgbj0iZGF0YS1jbGlwYm9hcmQtIit0O2lmKGUuaGFzQXR0cmlidXRlKG4pKXJldHVybiBlLmdldEF0dHJpYnV0ZShuKX1lLmRlZmF1bHQ9bX1dLHIuYz1vLHIuZD1mdW5jdGlvbih0LGUsbil7ci5vKHQsZSl8fE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse2VudW1lcmFibGU6ITAsZ2V0Om59KX0sci5yPWZ1bmN0aW9uKHQpeyJ1bmRlZmluZWQiIT10eXBlb2YgU3ltYm9sJiZTeW1ib2wudG9TdHJpbmdUYWcmJk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LFN5bWJvbC50b1N0cmluZ1RhZyx7dmFsdWU6Ik1vZHVsZSJ9KSxPYmplY3QuZGVmaW5lUHJvcGVydHkodCwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSl9LHIudD1mdW5jdGlvbihlLHQpe2lmKDEmdCYmKGU9cihlKSksOCZ0KXJldHVybiBlO2lmKDQmdCYmIm9iamVjdCI9PXR5cGVvZiBlJiZlJiZlLl9fZXNNb2R1bGUpcmV0dXJuIGU7dmFyIG49T2JqZWN0LmNyZWF0ZShudWxsKTtpZihyLnIobiksT2JqZWN0LmRlZmluZVByb3BlcnR5KG4sImRlZmF1bHQiLHtlbnVtZXJhYmxlOiEwLHZhbHVlOmV9KSwyJnQmJiJzdHJpbmciIT10eXBlb2YgZSlmb3IodmFyIG8gaW4gZSlyLmQobixvLGZ1bmN0aW9uKHQpe3JldHVybiBlW3RdfS5iaW5kKG51bGwsbykpO3JldHVybiBufSxyLm49ZnVuY3Rpb24odCl7dmFyIGU9dCYmdC5fX2VzTW9kdWxlP2Z1bmN0aW9uKCl7cmV0dXJuIHQuZGVmYXVsdH06ZnVuY3Rpb24oKXtyZXR1cm4gdH07cmV0dXJuIHIuZChlLCJhIixlKSxlfSxyLm89ZnVuY3Rpb24odCxlKXtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsZSl9LHIucD0iIixyKHIucz02KS5kZWZhdWx0O2Z1bmN0aW9uIHIodCl7aWYob1t0XSlyZXR1cm4gb1t0XS5leHBvcnRzO3ZhciBlPW9bdF09e2k6dCxsOiExLGV4cG9ydHM6e319O3JldHVybiBuW3RdLmNhbGwoZS5leHBvcnRzLGUsZS5leHBvcnRzLHIpLGUubD0hMCxlLmV4cG9ydHN9dmFyIG4sb30pOw=="}]},{"name":"Github 镜像访问，加速下载","options":{"awareOfChrome":false,"check_for_updates":true,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":[],"orig_matches":["*://github.com/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1598935305637,"data":{}},"enabled":true,"position":4,"file_url":"https://greasyfork.org/zh-CN/scripts/398278/code/script.user.js","uuid":"f34e8243-9e62-408a-ae2d-e8d7c7bda1d2","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGljb24gICAgICAgICBodHRwczovL2dpdGh1Yi5naXRodWJhc3NldHMuY29tL2Zhdmljb24uaWNvCi8vIEBuYW1lICAgICAgICAgR2l0aHViIOmVnOWDj+iuv+mXru+8jOWKoOmAn+S4i+i9vQovLyBAbmFtZXNwYWNlICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9qYWRlemkvZ2l0aHViLWFjY2VsZXJhdG9yLwovLyBAdmVyc2lvbiAgICAgIDEuMS4zCi8vIEBkZXNjcmlwdGlvbiAgR2l0SHViIOmVnOWDj++8jGdpdGh1YiDliqDpgJ8KLy8gQGF1dGhvciAgICAgICBqYWRlemkKLy8gQGxpY2Vuc2UgICAgICBHUEwgTGljZW5zZQovLyBAbWF0Y2ggICAgICAgICo6Ly9naXRodWIuY29tLyoKLy8gQHJlcXVpcmUgICAgICBodHRwczovL2Nkbi5ib290Y3NzLmNvbS9qcXVlcnkvMy40LjEvanF1ZXJ5Lm1pbi5qcwovLyBAcmVzb3VyY2UgICAgIG15Y3NzIGh0dHBzOi8vZ2l0ZWUuY29tL2phZGV6aS9naXRodWItYWNjZWxlcmF0b3ItY3NzL3Jhdy9tYXN0ZXIvaW5kZXguY3NzCi8vIEBncmFudCAgICAgICAgR01fYWRkU3R5bGUKLy8gQGdyYW50ICAgICAgICBHTV9zZXRDbGlwYm9hcmQKLy8gQGdyYW50ICAgICAgICBHTV9nZXRSZXNvdXJjZVRleHQKLy8gPT0vVXNlclNjcmlwdD09CgooZnVuY3Rpb24oKSB7CiAgICB2YXIgY2xvbmUgPSB0cnVlOwogICAgLy8gdmFyIGNsb25lID0gZmFsc2U7CiAgICB2YXIgZGVwdGggPSB0cnVlOwogICAgLy8gdmFyIGRlcHRoID0gZmFsc2U7CiAgICB2YXIgbWlycm9yID0gdHJ1ZTsKICAgIC8vIHZhciBtaXJyb3IgPSBmYWxzZTsKICAgIHZhciBoaWRlID0gZmFsc2U7CgogICAgdmFyIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICB2YXIgbWlycm9yX3VybDEgPSAiaHR0cHM6Ly8iICsgImdpdGh1Yi5jb20uY25wbWpzLm9yZyI7CiAgICB2YXIgbWlycm9yX3VybDIgPSAiaHR0cHM6Ly8iICsgImh1Yi5mYXN0Z2l0Lm9yZyI7CiAgICB2YXIgbWlycm9yX3VybDMgPSAiaHR0cHM6Ly8iICsgImdpdGh1Yi53dXlhbnpoZXNodWkud29ya2Vycy5kZXYiOwogICAgdmFyIGRvd25sb2FkX3VybDEgPSAiaHR0cHM6Ly9kb3dubG9hZC5mYXN0Z2l0Lm9yZyI7CiAgICB2YXIgc3RyMSA9ICIiOwoKICAgIGlmIChjbG9uZSkgewogICAgICAgIHN0cjEgKz0gImdpdCBjbG9uZSAiOwogICAgICAgIGlmIChkZXB0aCkgewogICAgICAgICAgICBzdHIxICs9ICItLWRlcHRoPTEgIjsKICAgICAgICB9CiAgICB9CgogICAgdmFyIGEgPSBsb2NhdGlvbi5zcGxpdCgiLyIpOwogICAgdmFyIGIgPSBhWzVdID09PSAid2lraSIgPyAiLndpa2kiIDogIiI7CiAgICB2YXIgc3RyMiA9ICIvIiArIGFbM10gKyAiLyIgKyBhWzRdICsgYiArICIuZ2l0IjsKICAgIHZhciBjbG9uZV91dGwxID0gc3RyMSArIG1pcnJvcl91cmwxICsgc3RyMjsKICAgIHZhciBjbG9uZV91dGwyID0gc3RyMSArIG1pcnJvcl91cmwyICsgc3RyMjsKICAgIHZhciBzdHIzID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lOwogICAgdmFyIHdlYl91cmwxID0gbWlycm9yX3VybDEgKyBzdHIzOwogICAgdmFyIHdlYl91cmwyID0gbWlycm9yX3VybDIgKyBzdHIzOwogICAgdmFyIHdlYl91cmwzID0gbWlycm9yX3VybDMgKyBzdHIzOwogICAgdmFyIGluZm8gPSBgCiAgICA8ZGl2IGNsYXNzPSJ1c2VyLW1lbnQiPgogICAgPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiB0eXBlPSJidXR0b24iIGlkPSJtaXJyb3ItYnRuIj7plZzlg4/nvZHlnYA8L2J1dHRvbj4KICAgIDxkaXYgY2xhc3M9ImNvbGxhcHNlIG11bHRpLWNvbGxhcHNlIiBpZD0iY29sbGFwc2UiPgogICAgPGRpdiBjbGFzcz0idXNlci1jYXJkIHVzZXItY2FyZC1ib2R5Ij4KICAgIDxkaXYgY2xhc3M9InVzZXItYWxlcnQgdXNlci1hbGVydC13YXJuaW5nIiByb2xlPSJhbGVydCI+Y2xvbmXjgIFkZXB0aOWRveS7pOeahOaPkuWFpeWPr+aJi+WKqOe8lui+keS7o+eggeWFs+mXrTwvZGl2PgogICAgPGRpdiBjbGFzcz0idXNlci1hbGVydCB1c2VyLWFsZXJ0LWRhbmdlciIgc3R5bGU9ImNvbG9yOiAjNzIxYzI0O2JhY2tncm91bmQtY29sb3I6ICNmOGQ3ZGE7Ym9yZGVyLWNvbG9yOiAjZjVjNmNiOyIgcm9sZT0iYWxlcnQiPumVnOWDj+WcsOWdgOivt+S4jeimgeeZu+mZhuiHquW3seeahOi0puaIt++8jOmAoOaIkOaNn+WkseacrOS6uuamguS4jei0n+i0ozwvZGl2PgogICAgPGRpdiBjbGFzcz0idXNlci1pbnB1dC1ncm91cCB1c2VyLW1iLTMiPgogICAgPGRpdiBjbGFzcz0idXNlci1pbnB1dC1ncm91cC1wcmVwZW5kIj48c3BhbiBjbGFzcz0idXNlci1pbnB1dC1ncm91cC10ZXh0IiBpZD0iaW5wdXRHcm91cC1zaXppbmctZGVmYXVsdCI+5b+r6YCf5YWL6ZqGMTo8L3NwYW4+PC9kaXY+CiAgICA8aW5wdXQgaWQ9ImNsb25lX2Nhc2VfMSIgdHlwZT0idGV4dCIgdmFsdWU9IiR7Y2xvbmVfdXRsMX0iIGRhdGEtYXV0b3NlbGVjdD0iIiBjbGFzcz0idXNlci1mb3JtLWNvbnRyb2wiIGFyaWEtbGFiZWw9IuWwhuatpOWtmOWCqOW6k+WFi+mahuWIsCAke2Nsb25lX3V0bDF9IiByZWFkb25seSBhcmlhLWRlc2NyaWJlZGJ5PSJpbnB1dEdyb3VwLXNpemluZy1kZWZhdWx0Ij4KICAgIDxkaXYgY2xhc3M9InVzZXItaW5wdXQtZ3JvdXAtYXBwZW5kIj4KICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHR5cGU9ImJ1dHRvbiIgaWQ9ImJ1dHRvbi1jb3B5MSIgIGRhdGEtY29udGFpbmVyPSJib2R5IiBkYXRhLXRvZ2dsZT0icG9wb3ZlciIgZGF0YS1wbGFjZW1lbnQ9ImJvdHRvbSIgZGF0YS1jb250ZW50PSLlpI3liLbmiJDlip8iPuWkjeWItjwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0eXBlPSJidXR0b24iIGlkPSJxdWlja1ZpZXdPbmUiIGhyZWY9IiR7d2ViX3VybDF9IiBjbGFzcz0iYnRuIj7lv6vpgJ/mtY/op4gxPC9idXR0b24+CiAgICA8L2Rpdj4KICAgIDxkaXYgY2xhc3M9InVzZXItaW5wdXQtZ3JvdXAgdXNlci1tYi0zIj4KICAgIDxkaXYgY2xhc3M9InVzZXItaW5wdXQtZ3JvdXAtcHJlcGVuZCI+CiAgICA8c3BhbiBjbGFzcz0idXNlci1pbnB1dC1ncm91cC10ZXh0IiBpZD0iaW5wdXRHcm91cC1zaXppbmctZGVmYXVsdCI+5b+r6YCf5YWL6ZqGMjo8L3NwYW4+CiAgICA8L2Rpdj4KICAgIDxpbnB1dCBpZD0iY2xvbmVfY2FzZV8yIiB0eXBlPSJ0ZXh0IiB2YWx1ZT0iJHtjbG9uZV91dGwyfSIgZGF0YS1hdXRvc2VsZWN0PSIiIGNsYXNzPSJ1c2VyLWZvcm0tY29udHJvbCIgYXJpYS1sYWJlbD0i5bCG5q2k5a2Y5YKo5bqT5YWL6ZqG5YiwICR7Y2xvbmVfdXRsMn0iIHJlYWRvbmx5IGFyaWEtZGVzY3JpYmVkYnk9ImlucHV0R3JvdXAtc2l6aW5nLWRlZmF1bHQiID4KICAgIDxkaXYgY2xhc3M9InVzZXItaW5wdXQtZ3JvdXAtYXBwZW5kIj4KICAgIDxidXR0b24gY2xhc3M9ImJ0biBidG4tb3V0bGluZS1zZWNvbmRhcnkiIHR5cGU9ImJ1dHRvbiIgaWQ9ImJ1dHRvbi1jb3B5MiIgIGRhdGEtY29udGFpbmVyPSJib2R5IiBkYXRhLXRvZ2dsZT0icG9wb3ZlciIgZGF0YS1wbGFjZW1lbnQ9ImJvdHRvbSIgZGF0YS1jb250ZW50PSLlpI3liLbmiJDlip8iPuWkjeWItjwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtc2Vjb25kYXJ5IiB0eXBlPSJidXR0b24iIGlkPSJxdWlja1ZpZXdPdGhlciIgY2xhc3M9ImJ0biI+5b+r6YCf5rWP6KeIMjwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJ1c2VyLWlucHV0LWdyb3VwIHVzZXItbWItMyI+CiAgICA8ZGl2IGNsYXNzPSJ1c2VyLWlucHV0LWdyb3VwLXByZXBlbmQiPgogICAgPHNwYW4gY2xhc3M9InVzZXItaW5wdXQtZ3JvdXAtdGV4dCIgaWQ9ImlucHV0R3JvdXAtc2l6aW5nLWRlZmF1bHQiPuW/q+mAn+WFi+mahjM6PC9zcGFuPgogICAgPC9kaXY+CiAgICA8aW5wdXQgdHlwZT0idGV4dCIgZGF0YS1hdXRvc2VsZWN0PSIiIGNsYXNzPSJ1c2VyLWZvcm0tY29udHJvbCIgYXJpYS1kZXNjcmliZWRieT0iaW5wdXRHcm91cC1zaXppbmctZGVmYXVsdCIgdmFsdWU9IuS4jeaUr+aMgWNsb25lLOebtOaOpei3s+i9rC0tLT4iIGFyaWEtbGFiZWw9IiIgcmVhZG9ubHk9IiIgPgogICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGlkPSJxdWlja1ZpZXdBbnRob3IiIGNsYXNzPSJidG4iPuW/q+mAn+a1j+iniDM8L2J1dHRvbj4KICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDwvZGl2PmA7CgogICAgJCgiLnJlcG9zaXRvcnktY29udGVudCIpLnByZXBlbmQoaW5mbyk7CiAgICAkKCIuQm94LkJveC0tY29uZGVuc2VkIikuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgJCh0aGlzKS5maW5kKCIuZC1mbGV4LkJveC1ib2R5PmEiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGhyZWYgPSAkKHRoaXMpLmF0dHIoImhyZWYiKTsKICAgICAgICAgICAgdmFyIHVybDEgPSBkb3dubG9hZF91cmwxICsgaHJlZjsKICAgICAgICAgICAgdmFyIHVybDIgPSBtaXJyb3JfdXJsMyArIGhyZWY7CiAgICAgICAgICAgIHZhciBkaXYxID0gYDxkaXYgY2xhc3M9InVzZXJfZG93bmxvYWQiIHN0eWxlPSJkaXNwbGF5OiBmbGV4O2p1c3RpZnktY29udGVudDogZmxleC1lbmQ7ZmxleC1ncm93OiAxOyI+PGRpdj48YSBzdHlsZT0icGFkZGluZzo0cHg7IiAgY2xhc3M9ImJ0biB1c2VyLWJ0bi1saW5rIiAgaHJlZj0iJHt1cmwxfSIgcmVsPSJub2ZvbGxvdyI+5b+r6YCf5LiL6L29MTwvYT48L2Rpdj48ZGl2PjxhIHN0eWxlPSJwYWRkaW5nOjRweCIgICBjbGFzcz0iYnRuIHVzZXItYnRuLWxpbmsiIGhyZWY9IiR7dXJsMn0iIHJlbD0ibm9mb2xsb3ciPuW/q+mAn+S4i+i9vTIo5o6o6I2QKTwvYT48L2Rpdj48L2Rpdj5gCgogICAgICAgICAgICAkKHRoaXMpLmFmdGVyKGRpdjEpOwogICAgICAgIH0pOwogICAgICAgICQodGhpcykuZmluZCgiLmQtYmxvY2suQm94LWJvZHk+YSIpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaHJlZiA9ICQodGhpcykuYXR0cigiaHJlZiIpOwogICAgICAgICAgICB2YXIgdXJsMSA9IGRvd25sb2FkX3VybDEgKyBocmVmOwogICAgICAgICAgICB2YXIgdXJsMiA9IG1pcnJvcl91cmwzICsgaHJlZjsKICAgICAgICAgICAgdmFyIGRpdjEgPSBgPGRpdiBjbGFzcz0idXNlcl9kb3dubG9hZCIgc3R5bGU9ImRpc3BsYXk6IGZsZXg7Ij48ZGl2PjxhIHN0eWxlPSJwYWRkaW5nOjRweDsiICBjbGFzcz0iYnRuIHVzZXItYnRuLWxpbmsiICBocmVmPSIke3VybDF9IiByZWw9Im5vZm9sbG93Ij7lv6vpgJ/kuIvovb0xPC9hPjwvZGl2PjxkaXY+PGEgc3R5bGU9InBhZGRpbmc6NHB4IiAgIGNsYXNzPSJidG4gdXNlci1idG4tbGluayIgaHJlZj0iJHt1cmwyfSIgcmVsPSJub2ZvbGxvdyI+5b+r6YCf5LiL6L29MijmjqjojZApPC9hPjwvZGl2PjwvZGl2PmAKCiAgICAgICAgICAgICQodGhpcykuYWZ0ZXIoZGl2MSk7CiAgICAgICAgfSk7CiAgICB9KTsKICAgICQoIi5nZXQtcmVwby1tb2RhbC5kcm9wZG93bi1tZW51IHVsIGxpOmxhc3QiKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdXJsMSA9IG1pcnJvcl91cmwzICsiLyIrYVszXSsiLyIrYVs0XSsgIi9hcmNoaXZlL21hc3Rlci56aXAiOwogICAgICAgIHZhciBzcGFuMSA9IGA8bGkgY2xhc3M9IkJveC1yb3cgQm94LXJvdy0taG92ZXItZ3JheSBwLTAiPjxhIGNsYXNzPSJkLWZsZXggZmxleC1pdGVtcy1jZW50ZXIgdGV4dC1ncmF5LWRhcmsgdGV4dC1ib2xkIG5vLXVuZGVybGluZSBwLTMiIHJlbD0ibm9mb2xsb3ciIGhyZWY9IiR7dXJsMX0iPkZhc3QgRG93bmxvYWQgWklQPC9hPjwvbGk+YDsKCiAgICAgICAgJCh0aGlzKS5hZnRlcihzcGFuMSk7CiAgICB9KTsKICAgIC8vIOWkjeWItuaMiemSrgogICAgJCgiI2J1dHRvbi1jb3B5MSIpLm9uKCJjbGljayIsZnVuY3Rpb24oKXsKICAgICAgICBHTV9zZXRDbGlwYm9hcmQoJCgiI2Nsb25lX2Nhc2VfMSIpLnZhbCgpKQogICAgICAgIGFsZXJ0KCLlpI3liLbmiJDlip8iKQogICAgfSkKICAgICQoIiNidXR0b24tY29weTIiKS5vbigiY2xpY2siLGZ1bmN0aW9uKCl7CiAgICAgICAgR01fc2V0Q2xpcGJvYXJkKCQoIiNjbG9uZV9jYXNlXzIiKS52YWwoKSkKICAgICAgICBhbGVydCgi5aSN5Yi25oiQ5YqfIikKICAgIH0pCiAgICAvL+mhtemdoui3s+i9rAogICAgJCgiI3F1aWNrVmlld09uZSIpLm9uKCJjbGljayIsZnVuY3Rpb24oKXsKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdlYl91cmwxCiAgICB9KTsKICAgICQoIiNxdWlja1ZpZXdPdGhlciIpLm9uKCJjbGljayIsZnVuY3Rpb24oKXsKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdlYl91cmwyCiAgICB9KQogICAgJCgiI3F1aWNrVmlld0FudGhvciIpLm9uKCJjbGljayIsZnVuY3Rpb24oKXsKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHdlYl91cmwzCiAgICB9KQogICAgLy8g6ZqQ6JeP6Z2i5p2/CiAgICAkKCIjbWlycm9yLWJ0biIpLm9uKCJjbGljayIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIWhpZGUpIHsKICAgICAgICAgICAgJCgiI2NvbGxhcHNlIikuaGlkZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICQoIiNjb2xsYXBzZSIpLnNob3coKTsKICAgICAgICB9CiAgICAgICAgaGlkZSA9ICFoaWRlOwogICAgfSkKICAgIGZ1bmN0aW9uIGluaXQoKXsKICAgICAgICBpZiAoIW1pcnJvcikgewogICAgICAgICAgICAkKCIjY29sbGFwc2UiKS5oaWRlKCkKICAgICAgICB9CiAgICB9CiAgICAvLyDliJ3lp4vljJbpnaLmnb8KICAgIGluaXQoKQogICAgR01fYWRkU3R5bGUoR01fZ2V0UmVzb3VyY2VUZXh0KCJteWNzcyIpKTsKfSkoKTsK","resources":[],"requires":[{"meta":{"name":"jquery.min.js","url":"https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js","ts":1605621962281,"mimetype":"text/javascript"},"source":"LyohIGpRdWVyeSB2My40LjEgfCAoYykgSlMgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzIHwganF1ZXJ5Lm9yZy9saWNlbnNlICovCiFmdW5jdGlvbihlLHQpeyJ1c2Ugc3RyaWN0Ijsib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmIm9iamVjdCI9PXR5cGVvZiBtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1lLmRvY3VtZW50P3QoZSwhMCk6ZnVuY3Rpb24oZSl7aWYoIWUuZG9jdW1lbnQpdGhyb3cgbmV3IEVycm9yKCJqUXVlcnkgcmVxdWlyZXMgYSB3aW5kb3cgd2l0aCBhIGRvY3VtZW50Iik7cmV0dXJuIHQoZSl9OnQoZSl9KCJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzp0aGlzLGZ1bmN0aW9uKEMsZSl7InVzZSBzdHJpY3QiO3ZhciB0PVtdLEU9Qy5kb2N1bWVudCxyPU9iamVjdC5nZXRQcm90b3R5cGVPZixzPXQuc2xpY2UsZz10LmNvbmNhdCx1PXQucHVzaCxpPXQuaW5kZXhPZixuPXt9LG89bi50b1N0cmluZyx2PW4uaGFzT3duUHJvcGVydHksYT12LnRvU3RyaW5nLGw9YS5jYWxsKE9iamVjdCkseT17fSxtPWZ1bmN0aW9uKGUpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBlJiYibnVtYmVyIiE9dHlwZW9mIGUubm9kZVR5cGV9LHg9ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGwhPWUmJmU9PT1lLndpbmRvd30sYz17dHlwZTohMCxzcmM6ITAsbm9uY2U6ITAsbm9Nb2R1bGU6ITB9O2Z1bmN0aW9uIGIoZSx0LG4pe3ZhciByLGksbz0obj1ufHxFKS5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTtpZihvLnRleHQ9ZSx0KWZvcihyIGluIGMpKGk9dFtyXXx8dC5nZXRBdHRyaWJ1dGUmJnQuZ2V0QXR0cmlidXRlKHIpKSYmby5zZXRBdHRyaWJ1dGUocixpKTtuLmhlYWQuYXBwZW5kQ2hpbGQobykucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvKX1mdW5jdGlvbiB3KGUpe3JldHVybiBudWxsPT1lP2UrIiI6Im9iamVjdCI9PXR5cGVvZiBlfHwiZnVuY3Rpb24iPT10eXBlb2YgZT9uW28uY2FsbChlKV18fCJvYmplY3QiOnR5cGVvZiBlfXZhciBmPSIzLjQuMSIsaz1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgay5mbi5pbml0KGUsdCl9LHA9L15bXHNcdUZFRkZceEEwXSt8W1xzXHVGRUZGXHhBMF0rJC9nO2Z1bmN0aW9uIGQoZSl7dmFyIHQ9ISFlJiYibGVuZ3RoImluIGUmJmUubGVuZ3RoLG49dyhlKTtyZXR1cm4hbShlKSYmIXgoZSkmJigiYXJyYXkiPT09bnx8MD09PXR8fCJudW1iZXIiPT10eXBlb2YgdCYmMDx0JiZ0LTEgaW4gZSl9ay5mbj1rLnByb3RvdHlwZT17anF1ZXJ5OmYsY29uc3RydWN0b3I6ayxsZW5ndGg6MCx0b0FycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIHMuY2FsbCh0aGlzKX0sZ2V0OmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lP3MuY2FsbCh0aGlzKTplPDA/dGhpc1tlK3RoaXMubGVuZ3RoXTp0aGlzW2VdfSxwdXNoU3RhY2s6ZnVuY3Rpb24oZSl7dmFyIHQ9ay5tZXJnZSh0aGlzLmNvbnN0cnVjdG9yKCksZSk7cmV0dXJuIHQucHJldk9iamVjdD10aGlzLHR9LGVhY2g6ZnVuY3Rpb24oZSl7cmV0dXJuIGsuZWFjaCh0aGlzLGUpfSxtYXA6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGsubWFwKHRoaXMsZnVuY3Rpb24oZSx0KXtyZXR1cm4gbi5jYWxsKGUsdCxlKX0pKX0sc2xpY2U6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2socy5hcHBseSh0aGlzLGFyZ3VtZW50cykpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKDApfSxsYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXEoLTEpfSxlcTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLmxlbmd0aCxuPStlKyhlPDA/dDowKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soMDw9biYmbjx0P1t0aGlzW25dXTpbXSl9LGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnByZXZPYmplY3R8fHRoaXMuY29uc3RydWN0b3IoKX0scHVzaDp1LHNvcnQ6dC5zb3J0LHNwbGljZTp0LnNwbGljZX0say5leHRlbmQ9ay5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgZSx0LG4scixpLG8sYT1hcmd1bWVudHNbMF18fHt9LHM9MSx1PWFyZ3VtZW50cy5sZW5ndGgsbD0hMTtmb3IoImJvb2xlYW4iPT10eXBlb2YgYSYmKGw9YSxhPWFyZ3VtZW50c1tzXXx8e30scysrKSwib2JqZWN0Ij09dHlwZW9mIGF8fG0oYSl8fChhPXt9KSxzPT09dSYmKGE9dGhpcyxzLS0pO3M8dTtzKyspaWYobnVsbCE9KGU9YXJndW1lbnRzW3NdKSlmb3IodCBpbiBlKXI9ZVt0XSwiX19wcm90b19fIiE9PXQmJmEhPT1yJiYobCYmciYmKGsuaXNQbGFpbk9iamVjdChyKXx8KGk9QXJyYXkuaXNBcnJheShyKSkpPyhuPWFbdF0sbz1pJiYhQXJyYXkuaXNBcnJheShuKT9bXTppfHxrLmlzUGxhaW5PYmplY3Qobik/bjp7fSxpPSExLGFbdF09ay5leHRlbmQobCxvLHIpKTp2b2lkIDAhPT1yJiYoYVt0XT1yKSk7cmV0dXJuIGF9LGsuZXh0ZW5kKHtleHBhbmRvOiJqUXVlcnkiKyhmK01hdGgucmFuZG9tKCkpLnJlcGxhY2UoL1xEL2csIiIpLGlzUmVhZHk6ITAsZXJyb3I6ZnVuY3Rpb24oZSl7dGhyb3cgbmV3IEVycm9yKGUpfSxub29wOmZ1bmN0aW9uKCl7fSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKGUpe3ZhciB0LG47cmV0dXJuISghZXx8IltvYmplY3QgT2JqZWN0XSIhPT1vLmNhbGwoZSkpJiYoISh0PXIoZSkpfHwiZnVuY3Rpb24iPT10eXBlb2Yobj12LmNhbGwodCwiY29uc3RydWN0b3IiKSYmdC5jb25zdHJ1Y3RvcikmJmEuY2FsbChuKT09PWwpfSxpc0VtcHR5T2JqZWN0OmZ1bmN0aW9uKGUpe3ZhciB0O2Zvcih0IGluIGUpcmV0dXJuITE7cmV0dXJuITB9LGdsb2JhbEV2YWw6ZnVuY3Rpb24oZSx0KXtiKGUse25vbmNlOnQmJnQubm9uY2V9KX0sZWFjaDpmdW5jdGlvbihlLHQpe3ZhciBuLHI9MDtpZihkKGUpKXtmb3Iobj1lLmxlbmd0aDtyPG47cisrKWlmKCExPT09dC5jYWxsKGVbcl0scixlW3JdKSlicmVha31lbHNlIGZvcihyIGluIGUpaWYoITE9PT10LmNhbGwoZVtyXSxyLGVbcl0pKWJyZWFrO3JldHVybiBlfSx0cmltOmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lPyIiOihlKyIiKS5yZXBsYWNlKHAsIiIpfSxtYWtlQXJyYXk6ZnVuY3Rpb24oZSx0KXt2YXIgbj10fHxbXTtyZXR1cm4gbnVsbCE9ZSYmKGQoT2JqZWN0KGUpKT9rLm1lcmdlKG4sInN0cmluZyI9PXR5cGVvZiBlP1tlXTplKTp1LmNhbGwobixlKSksbn0saW5BcnJheTpmdW5jdGlvbihlLHQsbil7cmV0dXJuIG51bGw9PXQ/LTE6aS5jYWxsKHQsZSxuKX0sbWVyZ2U6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49K3QubGVuZ3RoLHI9MCxpPWUubGVuZ3RoO3I8bjtyKyspZVtpKytdPXRbcl07cmV0dXJuIGUubGVuZ3RoPWksZX0sZ3JlcDpmdW5jdGlvbihlLHQsbil7Zm9yKHZhciByPVtdLGk9MCxvPWUubGVuZ3RoLGE9IW47aTxvO2krKykhdChlW2ldLGkpIT09YSYmci5wdXNoKGVbaV0pO3JldHVybiByfSxtYXA6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbz0wLGE9W107aWYoZChlKSlmb3Iocj1lLmxlbmd0aDtvPHI7bysrKW51bGwhPShpPXQoZVtvXSxvLG4pKSYmYS5wdXNoKGkpO2Vsc2UgZm9yKG8gaW4gZSludWxsIT0oaT10KGVbb10sbyxuKSkmJmEucHVzaChpKTtyZXR1cm4gZy5hcHBseShbXSxhKX0sZ3VpZDoxLHN1cHBvcnQ6eX0pLCJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJihrLmZuW1N5bWJvbC5pdGVyYXRvcl09dFtTeW1ib2wuaXRlcmF0b3JdKSxrLmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IgU3ltYm9sIi5zcGxpdCgiICIpLGZ1bmN0aW9uKGUsdCl7blsiW29iamVjdCAiK3QrIl0iXT10LnRvTG93ZXJDYXNlKCl9KTt2YXIgaD1mdW5jdGlvbihuKXt2YXIgZSxkLGIsbyxpLGgsZixnLHcsdSxsLFQsQyxhLEUsdixzLGMseSxrPSJzaXp6bGUiKzEqbmV3IERhdGUsbT1uLmRvY3VtZW50LFM9MCxyPTAscD11ZSgpLHg9dWUoKSxOPXVlKCksQT11ZSgpLEQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZT09PXQmJihsPSEwKSwwfSxqPXt9Lmhhc093blByb3BlcnR5LHQ9W10scT10LnBvcCxMPXQucHVzaCxIPXQucHVzaCxPPXQuc2xpY2UsUD1mdW5jdGlvbihlLHQpe2Zvcih2YXIgbj0wLHI9ZS5sZW5ndGg7bjxyO24rKylpZihlW25dPT09dClyZXR1cm4gbjtyZXR1cm4tMX0sUj0iY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQiLE09IltcXHgyMFxcdFxcclxcblxcZl0iLEk9Iig/OlxcXFwufFtcXHctXXxbXlwwLVxceGEwXSkrIixXPSJcXFsiK00rIiooIitJKyIpKD86IitNKyIqKFsqXiR8IX5dPz0pIitNKyIqKD86JygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCJ8KCIrSSsiKSl8KSIrTSsiKlxcXSIsJD0iOigiK0krIikoPzpcXCgoKCcoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwiKXwoKD86XFxcXC58W15cXFxcKClbXFxdXXwiK1crIikqKXwuKilcXCl8KSIsRj1uZXcgUmVnRXhwKE0rIisiLCJnIiksQj1uZXcgUmVnRXhwKCJeIitNKyIrfCgoPzpefFteXFxcXF0pKD86XFxcXC4pKikiK00rIiskIiwiZyIpLF89bmV3IFJlZ0V4cCgiXiIrTSsiKiwiK00rIioiKSx6PW5ldyBSZWdFeHAoIl4iK00rIiooWz4rfl18IitNKyIpIitNKyIqIiksVT1uZXcgUmVnRXhwKE0rInw+IiksWD1uZXcgUmVnRXhwKCQpLFY9bmV3IFJlZ0V4cCgiXiIrSSsiJCIpLEc9e0lEOm5ldyBSZWdFeHAoIl4jKCIrSSsiKSIpLENMQVNTOm5ldyBSZWdFeHAoIl5cXC4oIitJKyIpIiksVEFHOm5ldyBSZWdFeHAoIl4oIitJKyJ8WypdKSIpLEFUVFI6bmV3IFJlZ0V4cCgiXiIrVyksUFNFVURPOm5ldyBSZWdFeHAoIl4iKyQpLENISUxEOm5ldyBSZWdFeHAoIl46KG9ubHl8Zmlyc3R8bGFzdHxudGh8bnRoLWxhc3QpLShjaGlsZHxvZi10eXBlKSg/OlxcKCIrTSsiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIrTSsiKig/OihbKy1dfCkiK00rIiooXFxkKyl8KSkiK00rIipcXCl8KSIsImkiKSxib29sOm5ldyBSZWdFeHAoIl4oPzoiK1IrIikkIiwiaSIpLG5lZWRzQ29udGV4dDpuZXcgUmVnRXhwKCJeIitNKyIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXCgiK00rIiooKD86LVxcZCk/XFxkKikiK00rIipcXCl8KSg/PVteLV18JCkiLCJpIil9LFk9L0hUTUwkL2ksUT0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLEo9L15oXGQkL2ksSz0vXltee10rXHtccypcW25hdGl2ZSBcdy8sWj0vXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLGVlPS9bK35dLyx0ZT1uZXcgUmVnRXhwKCJcXFxcKFtcXGRhLWZdezEsNn0iK00rIj98KCIrTSsiKXwuKSIsImlnIiksbmU9ZnVuY3Rpb24oZSx0LG4pe3ZhciByPSIweCIrdC02NTUzNjtyZXR1cm4gciE9cnx8bj90OnI8MD9TdHJpbmcuZnJvbUNoYXJDb2RlKHIrNjU1MzYpOlN0cmluZy5mcm9tQ2hhckNvZGUocj4+MTB8NTUyOTYsMTAyMyZyfDU2MzIwKX0scmU9LyhbXDAtXHgxZlx4N2ZdfF4tP1xkKXxeLSR8W15cMC1ceDFmXHg3Zi1cdUZGRkZcdy1dL2csaWU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdD8iXDAiPT09ZT8iXHVmZmZkIjplLnNsaWNlKDAsLTEpKyJcXCIrZS5jaGFyQ29kZUF0KGUubGVuZ3RoLTEpLnRvU3RyaW5nKDE2KSsiICI6IlxcIitlfSxvZT1mdW5jdGlvbigpe1QoKX0sYWU9YmUoZnVuY3Rpb24oZSl7cmV0dXJuITA9PT1lLmRpc2FibGVkJiYiZmllbGRzZXQiPT09ZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpfSx7ZGlyOiJwYXJlbnROb2RlIixuZXh0OiJsZWdlbmQifSk7dHJ5e0guYXBwbHkodD1PLmNhbGwobS5jaGlsZE5vZGVzKSxtLmNoaWxkTm9kZXMpLHRbbS5jaGlsZE5vZGVzLmxlbmd0aF0ubm9kZVR5cGV9Y2F0Y2goZSl7SD17YXBwbHk6dC5sZW5ndGg/ZnVuY3Rpb24oZSx0KXtMLmFwcGx5KGUsTy5jYWxsKHQpKX06ZnVuY3Rpb24oZSx0KXt2YXIgbj1lLmxlbmd0aCxyPTA7d2hpbGUoZVtuKytdPXRbcisrXSk7ZS5sZW5ndGg9bi0xfX19ZnVuY3Rpb24gc2UodCxlLG4scil7dmFyIGksbyxhLHMsdSxsLGMsZj1lJiZlLm93bmVyRG9jdW1lbnQscD1lP2Uubm9kZVR5cGU6OTtpZihuPW58fFtdLCJzdHJpbmciIT10eXBlb2YgdHx8IXR8fDEhPT1wJiY5IT09cCYmMTEhPT1wKXJldHVybiBuO2lmKCFyJiYoKGU/ZS5vd25lckRvY3VtZW50fHxlOm0pIT09QyYmVChlKSxlPWV8fEMsRSkpe2lmKDExIT09cCYmKHU9Wi5leGVjKHQpKSlpZihpPXVbMV0pe2lmKDk9PT1wKXtpZighKGE9ZS5nZXRFbGVtZW50QnlJZChpKSkpcmV0dXJuIG47aWYoYS5pZD09PWkpcmV0dXJuIG4ucHVzaChhKSxufWVsc2UgaWYoZiYmKGE9Zi5nZXRFbGVtZW50QnlJZChpKSkmJnkoZSxhKSYmYS5pZD09PWkpcmV0dXJuIG4ucHVzaChhKSxufWVsc2V7aWYodVsyXSlyZXR1cm4gSC5hcHBseShuLGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUodCkpLG47aWYoKGk9dVszXSkmJmQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKXJldHVybiBILmFwcGx5KG4sZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGkpKSxufWlmKGQucXNhJiYhQVt0KyIgIl0mJighdnx8IXYudGVzdCh0KSkmJigxIT09cHx8Im9iamVjdCIhPT1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpKXtpZihjPXQsZj1lLDE9PT1wJiZVLnRlc3QodCkpeyhzPWUuZ2V0QXR0cmlidXRlKCJpZCIpKT9zPXMucmVwbGFjZShyZSxpZSk6ZS5zZXRBdHRyaWJ1dGUoImlkIixzPWspLG89KGw9aCh0KSkubGVuZ3RoO3doaWxlKG8tLSlsW29dPSIjIitzKyIgIit4ZShsW29dKTtjPWwuam9pbigiLCIpLGY9ZWUudGVzdCh0KSYmeWUoZS5wYXJlbnROb2RlKXx8ZX10cnl7cmV0dXJuIEguYXBwbHkobixmLnF1ZXJ5U2VsZWN0b3JBbGwoYykpLG59Y2F0Y2goZSl7QSh0LCEwKX1maW5hbGx5e3M9PT1rJiZlLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKX19fXJldHVybiBnKHQucmVwbGFjZShCLCIkMSIpLGUsbixyKX1mdW5jdGlvbiB1ZSgpe3ZhciByPVtdO3JldHVybiBmdW5jdGlvbiBlKHQsbil7cmV0dXJuIHIucHVzaCh0KyIgIik+Yi5jYWNoZUxlbmd0aCYmZGVsZXRlIGVbci5zaGlmdCgpXSxlW3QrIiAiXT1ufX1mdW5jdGlvbiBsZShlKXtyZXR1cm4gZVtrXT0hMCxlfWZ1bmN0aW9uIGNlKGUpe3ZhciB0PUMuY3JlYXRlRWxlbWVudCgiZmllbGRzZXQiKTt0cnl7cmV0dXJuISFlKHQpfWNhdGNoKGUpe3JldHVybiExfWZpbmFsbHl7dC5wYXJlbnROb2RlJiZ0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodCksdD1udWxsfX1mdW5jdGlvbiBmZShlLHQpe3ZhciBuPWUuc3BsaXQoInwiKSxyPW4ubGVuZ3RoO3doaWxlKHItLSliLmF0dHJIYW5kbGVbbltyXV09dH1mdW5jdGlvbiBwZShlLHQpe3ZhciBuPXQmJmUscj1uJiYxPT09ZS5ub2RlVHlwZSYmMT09PXQubm9kZVR5cGUmJmUuc291cmNlSW5kZXgtdC5zb3VyY2VJbmRleDtpZihyKXJldHVybiByO2lmKG4pd2hpbGUobj1uLm5leHRTaWJsaW5nKWlmKG49PT10KXJldHVybi0xO3JldHVybiBlPzE6LTF9ZnVuY3Rpb24gZGUodCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiJpbnB1dCI9PT1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkmJmUudHlwZT09PXR9fWZ1bmN0aW9uIGhlKG4pe3JldHVybiBmdW5jdGlvbihlKXt2YXIgdD1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuKCJpbnB1dCI9PT10fHwiYnV0dG9uIj09PXQpJiZlLnR5cGU9PT1ufX1mdW5jdGlvbiBnZSh0KXtyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuImZvcm0iaW4gZT9lLnBhcmVudE5vZGUmJiExPT09ZS5kaXNhYmxlZD8ibGFiZWwiaW4gZT8ibGFiZWwiaW4gZS5wYXJlbnROb2RlP2UucGFyZW50Tm9kZS5kaXNhYmxlZD09PXQ6ZS5kaXNhYmxlZD09PXQ6ZS5pc0Rpc2FibGVkPT09dHx8ZS5pc0Rpc2FibGVkIT09IXQmJmFlKGUpPT09dDplLmRpc2FibGVkPT09dDoibGFiZWwiaW4gZSYmZS5kaXNhYmxlZD09PXR9fWZ1bmN0aW9uIHZlKGEpe3JldHVybiBsZShmdW5jdGlvbihvKXtyZXR1cm4gbz0rbyxsZShmdW5jdGlvbihlLHQpe3ZhciBuLHI9YShbXSxlLmxlbmd0aCxvKSxpPXIubGVuZ3RoO3doaWxlKGktLSllW249cltpXV0mJihlW25dPSEodFtuXT1lW25dKSl9KX0pfWZ1bmN0aW9uIHllKGUpe3JldHVybiBlJiYidW5kZWZpbmVkIiE9dHlwZW9mIGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUmJmV9Zm9yKGUgaW4gZD1zZS5zdXBwb3J0PXt9LGk9c2UuaXNYTUw9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5uYW1lc3BhY2VVUkksbj0oZS5vd25lckRvY3VtZW50fHxlKS5kb2N1bWVudEVsZW1lbnQ7cmV0dXJuIVkudGVzdCh0fHxuJiZuLm5vZGVOYW1lfHwiSFRNTCIpfSxUPXNlLnNldERvY3VtZW50PWZ1bmN0aW9uKGUpe3ZhciB0LG4scj1lP2Uub3duZXJEb2N1bWVudHx8ZTptO3JldHVybiByIT09QyYmOT09PXIubm9kZVR5cGUmJnIuZG9jdW1lbnRFbGVtZW50JiYoYT0oQz1yKS5kb2N1bWVudEVsZW1lbnQsRT0haShDKSxtIT09QyYmKG49Qy5kZWZhdWx0VmlldykmJm4udG9wIT09biYmKG4uYWRkRXZlbnRMaXN0ZW5lcj9uLmFkZEV2ZW50TGlzdGVuZXIoInVubG9hZCIsb2UsITEpOm4uYXR0YWNoRXZlbnQmJm4uYXR0YWNoRXZlbnQoIm9udW5sb2FkIixvZSkpLGQuYXR0cmlidXRlcz1jZShmdW5jdGlvbihlKXtyZXR1cm4gZS5jbGFzc05hbWU9ImkiLCFlLmdldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIil9KSxkLmdldEVsZW1lbnRzQnlUYWdOYW1lPWNlKGZ1bmN0aW9uKGUpe3JldHVybiBlLmFwcGVuZENoaWxkKEMuY3JlYXRlQ29tbWVudCgiIikpLCFlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RofSksZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lPUsudGVzdChDLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpLGQuZ2V0QnlJZD1jZShmdW5jdGlvbihlKXtyZXR1cm4gYS5hcHBlbmRDaGlsZChlKS5pZD1rLCFDLmdldEVsZW1lbnRzQnlOYW1lfHwhQy5nZXRFbGVtZW50c0J5TmFtZShrKS5sZW5ndGh9KSxkLmdldEJ5SWQ/KGIuZmlsdGVyLklEPWZ1bmN0aW9uKGUpe3ZhciB0PWUucmVwbGFjZSh0ZSxuZSk7cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiBlLmdldEF0dHJpYnV0ZSgiaWQiKT09PXR9fSxiLmZpbmQuSUQ9ZnVuY3Rpb24oZSx0KXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHQuZ2V0RWxlbWVudEJ5SWQmJkUpe3ZhciBuPXQuZ2V0RWxlbWVudEJ5SWQoZSk7cmV0dXJuIG4/W25dOltdfX0pOihiLmZpbHRlci5JRD1mdW5jdGlvbihlKXt2YXIgbj1lLnJlcGxhY2UodGUsbmUpO3JldHVybiBmdW5jdGlvbihlKXt2YXIgdD0idW5kZWZpbmVkIiE9dHlwZW9mIGUuZ2V0QXR0cmlidXRlTm9kZSYmZS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpO3JldHVybiB0JiZ0LnZhbHVlPT09bn19LGIuZmluZC5JRD1mdW5jdGlvbihlLHQpe2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgdC5nZXRFbGVtZW50QnlJZCYmRSl7dmFyIG4scixpLG89dC5nZXRFbGVtZW50QnlJZChlKTtpZihvKXtpZigobj1vLmdldEF0dHJpYnV0ZU5vZGUoImlkIikpJiZuLnZhbHVlPT09ZSlyZXR1cm5bb107aT10LmdldEVsZW1lbnRzQnlOYW1lKGUpLHI9MDt3aGlsZShvPWlbcisrXSlpZigobj1vLmdldEF0dHJpYnV0ZU5vZGUoImlkIikpJiZuLnZhbHVlPT09ZSlyZXR1cm5bb119cmV0dXJuW119fSksYi5maW5kLlRBRz1kLmdldEVsZW1lbnRzQnlUYWdOYW1lP2Z1bmN0aW9uKGUsdCl7cmV0dXJuInVuZGVmaW5lZCIhPXR5cGVvZiB0LmdldEVsZW1lbnRzQnlUYWdOYW1lP3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSk6ZC5xc2E/dC5xdWVyeVNlbGVjdG9yQWxsKGUpOnZvaWQgMH06ZnVuY3Rpb24oZSx0KXt2YXIgbixyPVtdLGk9MCxvPXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSk7aWYoIioiPT09ZSl7d2hpbGUobj1vW2krK10pMT09PW4ubm9kZVR5cGUmJnIucHVzaChuKTtyZXR1cm4gcn1yZXR1cm4gb30sYi5maW5kLkNMQVNTPWQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmZnVuY3Rpb24oZSx0KXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmRSlyZXR1cm4gdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGUpfSxzPVtdLHY9W10sKGQucXNhPUsudGVzdChDLnF1ZXJ5U2VsZWN0b3JBbGwpKSYmKGNlKGZ1bmN0aW9uKGUpe2EuYXBwZW5kQ2hpbGQoZSkuaW5uZXJIVE1MPSI8YSBpZD0nIitrKyInPjwvYT48c2VsZWN0IGlkPSciK2srIi1cclxcJyBtc2FsbG93Y2FwdHVyZT0nJz48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PiIsZS5xdWVyeVNlbGVjdG9yQWxsKCJbbXNhbGxvd2NhcHR1cmVePScnXSIpLmxlbmd0aCYmdi5wdXNoKCJbKl4kXT0iK00rIiooPzonJ3xcIlwiKSIpLGUucXVlcnlTZWxlY3RvckFsbCgiW3NlbGVjdGVkXSIpLmxlbmd0aHx8di5wdXNoKCJcXFsiK00rIiooPzp2YWx1ZXwiK1IrIikiKSxlLnF1ZXJ5U2VsZWN0b3JBbGwoIltpZH49IitrKyItXSIpLmxlbmd0aHx8di5wdXNoKCJ+PSIpLGUucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGh8fHYucHVzaCgiOmNoZWNrZWQiKSxlLnF1ZXJ5U2VsZWN0b3JBbGwoImEjIitrKyIrKiIpLmxlbmd0aHx8di5wdXNoKCIuIy4rWyt+XSIpfSksY2UoZnVuY3Rpb24oZSl7ZS5pbm5lckhUTUw9IjxhIGhyZWY9JycgZGlzYWJsZWQ9J2Rpc2FibGVkJz48L2E+PHNlbGVjdCBkaXNhYmxlZD0nZGlzYWJsZWQnPjxvcHRpb24vPjwvc2VsZWN0PiI7dmFyIHQ9Qy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpO3Quc2V0QXR0cmlidXRlKCJ0eXBlIiwiaGlkZGVuIiksZS5hcHBlbmRDaGlsZCh0KS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCJEIiksZS5xdWVyeVNlbGVjdG9yQWxsKCJbbmFtZT1kXSIpLmxlbmd0aCYmdi5wdXNoKCJuYW1lIitNKyIqWypeJHwhfl0/PSIpLDIhPT1lLnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoJiZ2LnB1c2goIjplbmFibGVkIiwiOmRpc2FibGVkIiksYS5hcHBlbmRDaGlsZChlKS5kaXNhYmxlZD0hMCwyIT09ZS5xdWVyeVNlbGVjdG9yQWxsKCI6ZGlzYWJsZWQiKS5sZW5ndGgmJnYucHVzaCgiOmVuYWJsZWQiLCI6ZGlzYWJsZWQiKSxlLnF1ZXJ5U2VsZWN0b3JBbGwoIiosOngiKSx2LnB1c2goIiwuKjoiKX0pKSwoZC5tYXRjaGVzU2VsZWN0b3I9Sy50ZXN0KGM9YS5tYXRjaGVzfHxhLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8YS5tb3pNYXRjaGVzU2VsZWN0b3J8fGEub01hdGNoZXNTZWxlY3Rvcnx8YS5tc01hdGNoZXNTZWxlY3RvcikpJiZjZShmdW5jdGlvbihlKXtkLmRpc2Nvbm5lY3RlZE1hdGNoPWMuY2FsbChlLCIqIiksYy5jYWxsKGUsIltzIT0nJ106eCIpLHMucHVzaCgiIT0iLCQpfSksdj12Lmxlbmd0aCYmbmV3IFJlZ0V4cCh2LmpvaW4oInwiKSkscz1zLmxlbmd0aCYmbmV3IFJlZ0V4cChzLmpvaW4oInwiKSksdD1LLnRlc3QoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbikseT10fHxLLnRlc3QoYS5jb250YWlucyk/ZnVuY3Rpb24oZSx0KXt2YXIgbj05PT09ZS5ub2RlVHlwZT9lLmRvY3VtZW50RWxlbWVudDplLHI9dCYmdC5wYXJlbnROb2RlO3JldHVybiBlPT09cnx8ISghcnx8MSE9PXIubm9kZVR5cGV8fCEobi5jb250YWlucz9uLmNvbnRhaW5zKHIpOmUuY29tcGFyZURvY3VtZW50UG9zaXRpb24mJjE2JmUuY29tcGFyZURvY3VtZW50UG9zaXRpb24ocikpKX06ZnVuY3Rpb24oZSx0KXtpZih0KXdoaWxlKHQ9dC5wYXJlbnROb2RlKWlmKHQ9PT1lKXJldHVybiEwO3JldHVybiExfSxEPXQ/ZnVuY3Rpb24oZSx0KXtpZihlPT09dClyZXR1cm4gbD0hMCwwO3ZhciBuPSFlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uLSF0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uO3JldHVybiBufHwoMSYobj0oZS5vd25lckRvY3VtZW50fHxlKT09PSh0Lm93bmVyRG9jdW1lbnR8fHQpP2UuY29tcGFyZURvY3VtZW50UG9zaXRpb24odCk6MSl8fCFkLnNvcnREZXRhY2hlZCYmdC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihlKT09PW4/ZT09PUN8fGUub3duZXJEb2N1bWVudD09PW0mJnkobSxlKT8tMTp0PT09Q3x8dC5vd25lckRvY3VtZW50PT09bSYmeShtLHQpPzE6dT9QKHUsZSktUCh1LHQpOjA6NCZuPy0xOjEpfTpmdW5jdGlvbihlLHQpe2lmKGU9PT10KXJldHVybiBsPSEwLDA7dmFyIG4scj0wLGk9ZS5wYXJlbnROb2RlLG89dC5wYXJlbnROb2RlLGE9W2VdLHM9W3RdO2lmKCFpfHwhbylyZXR1cm4gZT09PUM/LTE6dD09PUM/MTppPy0xOm8/MTp1P1AodSxlKS1QKHUsdCk6MDtpZihpPT09bylyZXR1cm4gcGUoZSx0KTtuPWU7d2hpbGUobj1uLnBhcmVudE5vZGUpYS51bnNoaWZ0KG4pO249dDt3aGlsZShuPW4ucGFyZW50Tm9kZSlzLnVuc2hpZnQobik7d2hpbGUoYVtyXT09PXNbcl0pcisrO3JldHVybiByP3BlKGFbcl0sc1tyXSk6YVtyXT09PW0/LTE6c1tyXT09PW0/MTowfSksQ30sc2UubWF0Y2hlcz1mdW5jdGlvbihlLHQpe3JldHVybiBzZShlLG51bGwsbnVsbCx0KX0sc2UubWF0Y2hlc1NlbGVjdG9yPWZ1bmN0aW9uKGUsdCl7aWYoKGUub3duZXJEb2N1bWVudHx8ZSkhPT1DJiZUKGUpLGQubWF0Y2hlc1NlbGVjdG9yJiZFJiYhQVt0KyIgIl0mJighc3x8IXMudGVzdCh0KSkmJighdnx8IXYudGVzdCh0KSkpdHJ5e3ZhciBuPWMuY2FsbChlLHQpO2lmKG58fGQuZGlzY29ubmVjdGVkTWF0Y2h8fGUuZG9jdW1lbnQmJjExIT09ZS5kb2N1bWVudC5ub2RlVHlwZSlyZXR1cm4gbn1jYXRjaChlKXtBKHQsITApfXJldHVybiAwPHNlKHQsQyxudWxsLFtlXSkubGVuZ3RofSxzZS5jb250YWlucz1mdW5jdGlvbihlLHQpe3JldHVybihlLm93bmVyRG9jdW1lbnR8fGUpIT09QyYmVChlKSx5KGUsdCl9LHNlLmF0dHI9ZnVuY3Rpb24oZSx0KXsoZS5vd25lckRvY3VtZW50fHxlKSE9PUMmJlQoZSk7dmFyIG49Yi5hdHRySGFuZGxlW3QudG9Mb3dlckNhc2UoKV0scj1uJiZqLmNhbGwoYi5hdHRySGFuZGxlLHQudG9Mb3dlckNhc2UoKSk/bihlLHQsIUUpOnZvaWQgMDtyZXR1cm4gdm9pZCAwIT09cj9yOmQuYXR0cmlidXRlc3x8IUU/ZS5nZXRBdHRyaWJ1dGUodCk6KHI9ZS5nZXRBdHRyaWJ1dGVOb2RlKHQpKSYmci5zcGVjaWZpZWQ/ci52YWx1ZTpudWxsfSxzZS5lc2NhcGU9ZnVuY3Rpb24oZSl7cmV0dXJuKGUrIiIpLnJlcGxhY2UocmUsaWUpfSxzZS5lcnJvcj1mdW5jdGlvbihlKXt0aHJvdyBuZXcgRXJyb3IoIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIrZSl9LHNlLnVuaXF1ZVNvcnQ9ZnVuY3Rpb24oZSl7dmFyIHQsbj1bXSxyPTAsaT0wO2lmKGw9IWQuZGV0ZWN0RHVwbGljYXRlcyx1PSFkLnNvcnRTdGFibGUmJmUuc2xpY2UoMCksZS5zb3J0KEQpLGwpe3doaWxlKHQ9ZVtpKytdKXQ9PT1lW2ldJiYocj1uLnB1c2goaSkpO3doaWxlKHItLSllLnNwbGljZShuW3JdLDEpfXJldHVybiB1PW51bGwsZX0sbz1zZS5nZXRUZXh0PWZ1bmN0aW9uKGUpe3ZhciB0LG49IiIscj0wLGk9ZS5ub2RlVHlwZTtpZihpKXtpZigxPT09aXx8OT09PWl8fDExPT09aSl7aWYoInN0cmluZyI9PXR5cGVvZiBlLnRleHRDb250ZW50KXJldHVybiBlLnRleHRDb250ZW50O2ZvcihlPWUuZmlyc3RDaGlsZDtlO2U9ZS5uZXh0U2libGluZyluKz1vKGUpfWVsc2UgaWYoMz09PWl8fDQ9PT1pKXJldHVybiBlLm5vZGVWYWx1ZX1lbHNlIHdoaWxlKHQ9ZVtyKytdKW4rPW8odCk7cmV0dXJuIG59LChiPXNlLnNlbGVjdG9ycz17Y2FjaGVMZW5ndGg6NTAsY3JlYXRlUHNldWRvOmxlLG1hdGNoOkcsYXR0ckhhbmRsZTp7fSxmaW5kOnt9LHJlbGF0aXZlOnsiPiI6e2RpcjoicGFyZW50Tm9kZSIsZmlyc3Q6ITB9LCIgIjp7ZGlyOiJwYXJlbnROb2RlIn0sIisiOntkaXI6InByZXZpb3VzU2libGluZyIsZmlyc3Q6ITB9LCJ+Ijp7ZGlyOiJwcmV2aW91c1NpYmxpbmcifX0scHJlRmlsdGVyOntBVFRSOmZ1bmN0aW9uKGUpe3JldHVybiBlWzFdPWVbMV0ucmVwbGFjZSh0ZSxuZSksZVszXT0oZVszXXx8ZVs0XXx8ZVs1XXx8IiIpLnJlcGxhY2UodGUsbmUpLCJ+PSI9PT1lWzJdJiYoZVszXT0iICIrZVszXSsiICIpLGUuc2xpY2UoMCw0KX0sQ0hJTEQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGVbMV09ZVsxXS50b0xvd2VyQ2FzZSgpLCJudGgiPT09ZVsxXS5zbGljZSgwLDMpPyhlWzNdfHxzZS5lcnJvcihlWzBdKSxlWzRdPSsoZVs0XT9lWzVdKyhlWzZdfHwxKToyKigiZXZlbiI9PT1lWzNdfHwib2RkIj09PWVbM10pKSxlWzVdPSsoZVs3XStlWzhdfHwib2RkIj09PWVbM10pKTplWzNdJiZzZS5lcnJvcihlWzBdKSxlfSxQU0VVRE86ZnVuY3Rpb24oZSl7dmFyIHQsbj0hZVs2XSYmZVsyXTtyZXR1cm4gRy5DSElMRC50ZXN0KGVbMF0pP251bGw6KGVbM10/ZVsyXT1lWzRdfHxlWzVdfHwiIjpuJiZYLnRlc3QobikmJih0PWgobiwhMCkpJiYodD1uLmluZGV4T2YoIikiLG4ubGVuZ3RoLXQpLW4ubGVuZ3RoKSYmKGVbMF09ZVswXS5zbGljZSgwLHQpLGVbMl09bi5zbGljZSgwLHQpKSxlLnNsaWNlKDAsMykpfX0sZmlsdGVyOntUQUc6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5yZXBsYWNlKHRlLG5lKS50b0xvd2VyQ2FzZSgpO3JldHVybiIqIj09PWU/ZnVuY3Rpb24oKXtyZXR1cm4hMH06ZnVuY3Rpb24oZSl7cmV0dXJuIGUubm9kZU5hbWUmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PXR9fSxDTEFTUzpmdW5jdGlvbihlKXt2YXIgdD1wW2UrIiAiXTtyZXR1cm4gdHx8KHQ9bmV3IFJlZ0V4cCgiKF58IitNKyIpIitlKyIoIitNKyJ8JCkiKSkmJnAoZSxmdW5jdGlvbihlKXtyZXR1cm4gdC50ZXN0KCJzdHJpbmciPT10eXBlb2YgZS5jbGFzc05hbWUmJmUuY2xhc3NOYW1lfHwidW5kZWZpbmVkIiE9dHlwZW9mIGUuZ2V0QXR0cmlidXRlJiZlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiIpfSl9LEFUVFI6ZnVuY3Rpb24obixyLGkpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgdD1zZS5hdHRyKGUsbik7cmV0dXJuIG51bGw9PXQ/IiE9Ij09PXI6IXJ8fCh0Kz0iIiwiPSI9PT1yP3Q9PT1pOiIhPSI9PT1yP3QhPT1pOiJePSI9PT1yP2kmJjA9PT10LmluZGV4T2YoaSk6Iio9Ij09PXI/aSYmLTE8dC5pbmRleE9mKGkpOiIkPSI9PT1yP2kmJnQuc2xpY2UoLWkubGVuZ3RoKT09PWk6In49Ij09PXI/LTE8KCIgIit0LnJlcGxhY2UoRiwiICIpKyIgIikuaW5kZXhPZihpKToifD0iPT09ciYmKHQ9PT1pfHx0LnNsaWNlKDAsaS5sZW5ndGgrMSk9PT1pKyItIikpfX0sQ0hJTEQ6ZnVuY3Rpb24oaCxlLHQsZyx2KXt2YXIgeT0ibnRoIiE9PWguc2xpY2UoMCwzKSxtPSJsYXN0IiE9PWguc2xpY2UoLTQpLHg9Im9mLXR5cGUiPT09ZTtyZXR1cm4gMT09PWcmJjA9PT12P2Z1bmN0aW9uKGUpe3JldHVybiEhZS5wYXJlbnROb2RlfTpmdW5jdGlvbihlLHQsbil7dmFyIHIsaSxvLGEscyx1LGw9eSE9PW0/Im5leHRTaWJsaW5nIjoicHJldmlvdXNTaWJsaW5nIixjPWUucGFyZW50Tm9kZSxmPXgmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSxwPSFuJiYheCxkPSExO2lmKGMpe2lmKHkpe3doaWxlKGwpe2E9ZTt3aGlsZShhPWFbbF0paWYoeD9hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1mOjE9PT1hLm5vZGVUeXBlKXJldHVybiExO3U9bD0ib25seSI9PT1oJiYhdSYmIm5leHRTaWJsaW5nIn1yZXR1cm4hMH1pZih1PVttP2MuZmlyc3RDaGlsZDpjLmxhc3RDaGlsZF0sbSYmcCl7ZD0ocz0ocj0oaT0obz0oYT1jKVtrXXx8KGFba109e30pKVthLnVuaXF1ZUlEXXx8KG9bYS51bmlxdWVJRF09e30pKVtoXXx8W10pWzBdPT09UyYmclsxXSkmJnJbMl0sYT1zJiZjLmNoaWxkTm9kZXNbc107d2hpbGUoYT0rK3MmJmEmJmFbbF18fChkPXM9MCl8fHUucG9wKCkpaWYoMT09PWEubm9kZVR5cGUmJisrZCYmYT09PWUpe2lbaF09W1MscyxkXTticmVha319ZWxzZSBpZihwJiYoZD1zPShyPShpPShvPShhPWUpW2tdfHwoYVtrXT17fSkpW2EudW5pcXVlSURdfHwob1thLnVuaXF1ZUlEXT17fSkpW2hdfHxbXSlbMF09PT1TJiZyWzFdKSwhMT09PWQpd2hpbGUoYT0rK3MmJmEmJmFbbF18fChkPXM9MCl8fHUucG9wKCkpaWYoKHg/YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ZjoxPT09YS5ub2RlVHlwZSkmJisrZCYmKHAmJigoaT0obz1hW2tdfHwoYVtrXT17fSkpW2EudW5pcXVlSURdfHwob1thLnVuaXF1ZUlEXT17fSkpW2hdPVtTLGRdKSxhPT09ZSkpYnJlYWs7cmV0dXJuKGQtPXYpPT09Z3x8ZCVnPT0wJiYwPD1kL2d9fX0sUFNFVURPOmZ1bmN0aW9uKGUsbyl7dmFyIHQsYT1iLnBzZXVkb3NbZV18fGIuc2V0RmlsdGVyc1tlLnRvTG93ZXJDYXNlKCldfHxzZS5lcnJvcigidW5zdXBwb3J0ZWQgcHNldWRvOiAiK2UpO3JldHVybiBhW2tdP2Eobyk6MTxhLmxlbmd0aD8odD1bZSxlLCIiLG9dLGIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eShlLnRvTG93ZXJDYXNlKCkpP2xlKGZ1bmN0aW9uKGUsdCl7dmFyIG4scj1hKGUsbyksaT1yLmxlbmd0aDt3aGlsZShpLS0pZVtuPVAoZSxyW2ldKV09ISh0W25dPXJbaV0pfSk6ZnVuY3Rpb24oZSl7cmV0dXJuIGEoZSwwLHQpfSk6YX19LHBzZXVkb3M6e25vdDpsZShmdW5jdGlvbihlKXt2YXIgcj1bXSxpPVtdLHM9ZihlLnJlcGxhY2UoQiwiJDEiKSk7cmV0dXJuIHNba10/bGUoZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbz1zKGUsbnVsbCxyLFtdKSxhPWUubGVuZ3RoO3doaWxlKGEtLSkoaT1vW2FdKSYmKGVbYV09ISh0W2FdPWkpKX0pOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gclswXT1lLHMocixudWxsLG4saSksclswXT1udWxsLCFpLnBvcCgpfX0pLGhhczpsZShmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIDA8c2UodCxlKS5sZW5ndGh9fSksY29udGFpbnM6bGUoZnVuY3Rpb24odCl7cmV0dXJuIHQ9dC5yZXBsYWNlKHRlLG5lKSxmdW5jdGlvbihlKXtyZXR1cm4tMTwoZS50ZXh0Q29udGVudHx8byhlKSkuaW5kZXhPZih0KX19KSxsYW5nOmxlKGZ1bmN0aW9uKG4pe3JldHVybiBWLnRlc3Qobnx8IiIpfHxzZS5lcnJvcigidW5zdXBwb3J0ZWQgbGFuZzogIituKSxuPW4ucmVwbGFjZSh0ZSxuZSkudG9Mb3dlckNhc2UoKSxmdW5jdGlvbihlKXt2YXIgdDtkb3tpZih0PUU/ZS5sYW5nOmUuZ2V0QXR0cmlidXRlKCJ4bWw6bGFuZyIpfHxlLmdldEF0dHJpYnV0ZSgibGFuZyIpKXJldHVybih0PXQudG9Mb3dlckNhc2UoKSk9PT1ufHwwPT09dC5pbmRleE9mKG4rIi0iKX13aGlsZSgoZT1lLnBhcmVudE5vZGUpJiYxPT09ZS5ub2RlVHlwZSk7cmV0dXJuITF9fSksdGFyZ2V0OmZ1bmN0aW9uKGUpe3ZhciB0PW4ubG9jYXRpb24mJm4ubG9jYXRpb24uaGFzaDtyZXR1cm4gdCYmdC5zbGljZSgxKT09PWUuaWR9LHJvb3Q6ZnVuY3Rpb24oZSl7cmV0dXJuIGU9PT1hfSxmb2N1czpmdW5jdGlvbihlKXtyZXR1cm4gZT09PUMuYWN0aXZlRWxlbWVudCYmKCFDLmhhc0ZvY3VzfHxDLmhhc0ZvY3VzKCkpJiYhIShlLnR5cGV8fGUuaHJlZnx8fmUudGFiSW5kZXgpfSxlbmFibGVkOmdlKCExKSxkaXNhYmxlZDpnZSghMCksY2hlY2tlZDpmdW5jdGlvbihlKXt2YXIgdD1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuImlucHV0Ij09PXQmJiEhZS5jaGVja2VkfHwib3B0aW9uIj09PXQmJiEhZS5zZWxlY3RlZH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGUucGFyZW50Tm9kZSYmZS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsITA9PT1lLnNlbGVjdGVkfSxlbXB0eTpmdW5jdGlvbihlKXtmb3IoZT1lLmZpcnN0Q2hpbGQ7ZTtlPWUubmV4dFNpYmxpbmcpaWYoZS5ub2RlVHlwZTw2KXJldHVybiExO3JldHVybiEwfSxwYXJlbnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIWIucHNldWRvcy5lbXB0eShlKX0saGVhZGVyOmZ1bmN0aW9uKGUpe3JldHVybiBKLnRlc3QoZS5ub2RlTmFtZSl9LGlucHV0OmZ1bmN0aW9uKGUpe3JldHVybiBRLnRlc3QoZS5ub2RlTmFtZSl9LGJ1dHRvbjpmdW5jdGlvbihlKXt2YXIgdD1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuImlucHV0Ij09PXQmJiJidXR0b24iPT09ZS50eXBlfHwiYnV0dG9uIj09PXR9LHRleHQ6ZnVuY3Rpb24oZSl7dmFyIHQ7cmV0dXJuImlucHV0Ij09PWUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmInRleHQiPT09ZS50eXBlJiYobnVsbD09KHQ9ZS5nZXRBdHRyaWJ1dGUoInR5cGUiKSl8fCJ0ZXh0Ij09PXQudG9Mb3dlckNhc2UoKSl9LGZpcnN0OnZlKGZ1bmN0aW9uKCl7cmV0dXJuWzBdfSksbGFzdDp2ZShmdW5jdGlvbihlLHQpe3JldHVyblt0LTFdfSksZXE6dmUoZnVuY3Rpb24oZSx0LG4pe3JldHVybltuPDA/bit0Om5dfSksZXZlbjp2ZShmdW5jdGlvbihlLHQpe2Zvcih2YXIgbj0wO248dDtuKz0yKWUucHVzaChuKTtyZXR1cm4gZX0pLG9kZDp2ZShmdW5jdGlvbihlLHQpe2Zvcih2YXIgbj0xO248dDtuKz0yKWUucHVzaChuKTtyZXR1cm4gZX0pLGx0OnZlKGZ1bmN0aW9uKGUsdCxuKXtmb3IodmFyIHI9bjwwP24rdDp0PG4/dDpuOzA8PS0tcjspZS5wdXNoKHIpO3JldHVybiBlfSksZ3Q6dmUoZnVuY3Rpb24oZSx0LG4pe2Zvcih2YXIgcj1uPDA/bit0Om47KytyPHQ7KWUucHVzaChyKTtyZXR1cm4gZX0pfX0pLnBzZXVkb3MubnRoPWIucHNldWRvcy5lcSx7cmFkaW86ITAsY2hlY2tib3g6ITAsZmlsZTohMCxwYXNzd29yZDohMCxpbWFnZTohMH0pYi5wc2V1ZG9zW2VdPWRlKGUpO2ZvcihlIGlue3N1Ym1pdDohMCxyZXNldDohMH0pYi5wc2V1ZG9zW2VdPWhlKGUpO2Z1bmN0aW9uIG1lKCl7fWZ1bmN0aW9uIHhlKGUpe2Zvcih2YXIgdD0wLG49ZS5sZW5ndGgscj0iIjt0PG47dCsrKXIrPWVbdF0udmFsdWU7cmV0dXJuIHJ9ZnVuY3Rpb24gYmUocyxlLHQpe3ZhciB1PWUuZGlyLGw9ZS5uZXh0LGM9bHx8dSxmPXQmJiJwYXJlbnROb2RlIj09PWMscD1yKys7cmV0dXJuIGUuZmlyc3Q/ZnVuY3Rpb24oZSx0LG4pe3doaWxlKGU9ZVt1XSlpZigxPT09ZS5ub2RlVHlwZXx8ZilyZXR1cm4gcyhlLHQsbik7cmV0dXJuITF9OmZ1bmN0aW9uKGUsdCxuKXt2YXIgcixpLG8sYT1bUyxwXTtpZihuKXt3aGlsZShlPWVbdV0paWYoKDE9PT1lLm5vZGVUeXBlfHxmKSYmcyhlLHQsbikpcmV0dXJuITB9ZWxzZSB3aGlsZShlPWVbdV0paWYoMT09PWUubm9kZVR5cGV8fGYpaWYoaT0obz1lW2tdfHwoZVtrXT17fSkpW2UudW5pcXVlSURdfHwob1tlLnVuaXF1ZUlEXT17fSksbCYmbD09PWUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSllPWVbdV18fGU7ZWxzZXtpZigocj1pW2NdKSYmclswXT09PVMmJnJbMV09PT1wKXJldHVybiBhWzJdPXJbMl07aWYoKGlbY109YSlbMl09cyhlLHQsbikpcmV0dXJuITB9cmV0dXJuITF9fWZ1bmN0aW9uIHdlKGkpe3JldHVybiAxPGkubGVuZ3RoP2Z1bmN0aW9uKGUsdCxuKXt2YXIgcj1pLmxlbmd0aDt3aGlsZShyLS0paWYoIWlbcl0oZSx0LG4pKXJldHVybiExO3JldHVybiEwfTppWzBdfWZ1bmN0aW9uIFRlKGUsdCxuLHIsaSl7Zm9yKHZhciBvLGE9W10scz0wLHU9ZS5sZW5ndGgsbD1udWxsIT10O3M8dTtzKyspKG89ZVtzXSkmJihuJiYhbihvLHIsaSl8fChhLnB1c2gobyksbCYmdC5wdXNoKHMpKSk7cmV0dXJuIGF9ZnVuY3Rpb24gQ2UoZCxoLGcsdix5LGUpe3JldHVybiB2JiYhdltrXSYmKHY9Q2UodikpLHkmJiF5W2tdJiYoeT1DZSh5LGUpKSxsZShmdW5jdGlvbihlLHQsbixyKXt2YXIgaSxvLGEscz1bXSx1PVtdLGw9dC5sZW5ndGgsYz1lfHxmdW5jdGlvbihlLHQsbil7Zm9yKHZhciByPTAsaT10Lmxlbmd0aDtyPGk7cisrKXNlKGUsdFtyXSxuKTtyZXR1cm4gbn0oaHx8IioiLG4ubm9kZVR5cGU/W25dOm4sW10pLGY9IWR8fCFlJiZoP2M6VGUoYyxzLGQsbixyKSxwPWc/eXx8KGU/ZDpsfHx2KT9bXTp0OmY7aWYoZyYmZyhmLHAsbixyKSx2KXtpPVRlKHAsdSksdihpLFtdLG4sciksbz1pLmxlbmd0aDt3aGlsZShvLS0pKGE9aVtvXSkmJihwW3Vbb11dPSEoZlt1W29dXT1hKSl9aWYoZSl7aWYoeXx8ZCl7aWYoeSl7aT1bXSxvPXAubGVuZ3RoO3doaWxlKG8tLSkoYT1wW29dKSYmaS5wdXNoKGZbb109YSk7eShudWxsLHA9W10saSxyKX1vPXAubGVuZ3RoO3doaWxlKG8tLSkoYT1wW29dKSYmLTE8KGk9eT9QKGUsYSk6c1tvXSkmJihlW2ldPSEodFtpXT1hKSl9fWVsc2UgcD1UZShwPT09dD9wLnNwbGljZShsLHAubGVuZ3RoKTpwKSx5P3kobnVsbCx0LHAscik6SC5hcHBseSh0LHApfSl9ZnVuY3Rpb24gRWUoZSl7Zm9yKHZhciBpLHQsbixyPWUubGVuZ3RoLG89Yi5yZWxhdGl2ZVtlWzBdLnR5cGVdLGE9b3x8Yi5yZWxhdGl2ZVsiICJdLHM9bz8xOjAsdT1iZShmdW5jdGlvbihlKXtyZXR1cm4gZT09PWl9LGEsITApLGw9YmUoZnVuY3Rpb24oZSl7cmV0dXJuLTE8UChpLGUpfSxhLCEwKSxjPVtmdW5jdGlvbihlLHQsbil7dmFyIHI9IW8mJihufHx0IT09dyl8fCgoaT10KS5ub2RlVHlwZT91KGUsdCxuKTpsKGUsdCxuKSk7cmV0dXJuIGk9bnVsbCxyfV07czxyO3MrKylpZih0PWIucmVsYXRpdmVbZVtzXS50eXBlXSljPVtiZSh3ZShjKSx0KV07ZWxzZXtpZigodD1iLmZpbHRlcltlW3NdLnR5cGVdLmFwcGx5KG51bGwsZVtzXS5tYXRjaGVzKSlba10pe2ZvcihuPSsrcztuPHI7bisrKWlmKGIucmVsYXRpdmVbZVtuXS50eXBlXSlicmVhaztyZXR1cm4gQ2UoMTxzJiZ3ZShjKSwxPHMmJnhlKGUuc2xpY2UoMCxzLTEpLmNvbmNhdCh7dmFsdWU6IiAiPT09ZVtzLTJdLnR5cGU/IioiOiIifSkpLnJlcGxhY2UoQiwiJDEiKSx0LHM8biYmRWUoZS5zbGljZShzLG4pKSxuPHImJkVlKGU9ZS5zbGljZShuKSksbjxyJiZ4ZShlKSl9Yy5wdXNoKHQpfXJldHVybiB3ZShjKX1yZXR1cm4gbWUucHJvdG90eXBlPWIuZmlsdGVycz1iLnBzZXVkb3MsYi5zZXRGaWx0ZXJzPW5ldyBtZSxoPXNlLnRva2VuaXplPWZ1bmN0aW9uKGUsdCl7dmFyIG4scixpLG8sYSxzLHUsbD14W2UrIiAiXTtpZihsKXJldHVybiB0PzA6bC5zbGljZSgwKTthPWUscz1bXSx1PWIucHJlRmlsdGVyO3doaWxlKGEpe2ZvcihvIGluIG4mJiEocj1fLmV4ZWMoYSkpfHwociYmKGE9YS5zbGljZShyWzBdLmxlbmd0aCl8fGEpLHMucHVzaChpPVtdKSksbj0hMSwocj16LmV4ZWMoYSkpJiYobj1yLnNoaWZ0KCksaS5wdXNoKHt2YWx1ZTpuLHR5cGU6clswXS5yZXBsYWNlKEIsIiAiKX0pLGE9YS5zbGljZShuLmxlbmd0aCkpLGIuZmlsdGVyKSEocj1HW29dLmV4ZWMoYSkpfHx1W29dJiYhKHI9dVtvXShyKSl8fChuPXIuc2hpZnQoKSxpLnB1c2goe3ZhbHVlOm4sdHlwZTpvLG1hdGNoZXM6cn0pLGE9YS5zbGljZShuLmxlbmd0aCkpO2lmKCFuKWJyZWFrfXJldHVybiB0P2EubGVuZ3RoOmE/c2UuZXJyb3IoZSk6eChlLHMpLnNsaWNlKDApfSxmPXNlLmNvbXBpbGU9ZnVuY3Rpb24oZSx0KXt2YXIgbix2LHksbSx4LHIsaT1bXSxvPVtdLGE9TltlKyIgIl07aWYoIWEpe3R8fCh0PWgoZSkpLG49dC5sZW5ndGg7d2hpbGUobi0tKShhPUVlKHRbbl0pKVtrXT9pLnB1c2goYSk6by5wdXNoKGEpOyhhPU4oZSwodj1vLG09MDwoeT1pKS5sZW5ndGgseD0wPHYubGVuZ3RoLHI9ZnVuY3Rpb24oZSx0LG4scixpKXt2YXIgbyxhLHMsdT0wLGw9IjAiLGM9ZSYmW10sZj1bXSxwPXcsZD1lfHx4JiZiLmZpbmQuVEFHKCIqIixpKSxoPVMrPW51bGw9PXA/MTpNYXRoLnJhbmRvbSgpfHwuMSxnPWQubGVuZ3RoO2ZvcihpJiYodz10PT09Q3x8dHx8aSk7bCE9PWcmJm51bGwhPShvPWRbbF0pO2wrKyl7aWYoeCYmbyl7YT0wLHR8fG8ub3duZXJEb2N1bWVudD09PUN8fChUKG8pLG49IUUpO3doaWxlKHM9dlthKytdKWlmKHMobyx0fHxDLG4pKXtyLnB1c2gobyk7YnJlYWt9aSYmKFM9aCl9bSYmKChvPSFzJiZvKSYmdS0tLGUmJmMucHVzaChvKSl9aWYodSs9bCxtJiZsIT09dSl7YT0wO3doaWxlKHM9eVthKytdKXMoYyxmLHQsbik7aWYoZSl7aWYoMDx1KXdoaWxlKGwtLSljW2xdfHxmW2xdfHwoZltsXT1xLmNhbGwocikpO2Y9VGUoZil9SC5hcHBseShyLGYpLGkmJiFlJiYwPGYubGVuZ3RoJiYxPHUreS5sZW5ndGgmJnNlLnVuaXF1ZVNvcnQocil9cmV0dXJuIGkmJihTPWgsdz1wKSxjfSxtP2xlKHIpOnIpKSkuc2VsZWN0b3I9ZX1yZXR1cm4gYX0sZz1zZS5zZWxlY3Q9ZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbyxhLHMsdSxsPSJmdW5jdGlvbiI9PXR5cGVvZiBlJiZlLGM9IXImJmgoZT1sLnNlbGVjdG9yfHxlKTtpZihuPW58fFtdLDE9PT1jLmxlbmd0aCl7aWYoMjwobz1jWzBdPWNbMF0uc2xpY2UoMCkpLmxlbmd0aCYmIklEIj09PShhPW9bMF0pLnR5cGUmJjk9PT10Lm5vZGVUeXBlJiZFJiZiLnJlbGF0aXZlW29bMV0udHlwZV0pe2lmKCEodD0oYi5maW5kLklEKGEubWF0Y2hlc1swXS5yZXBsYWNlKHRlLG5lKSx0KXx8W10pWzBdKSlyZXR1cm4gbjtsJiYodD10LnBhcmVudE5vZGUpLGU9ZS5zbGljZShvLnNoaWZ0KCkudmFsdWUubGVuZ3RoKX1pPUcubmVlZHNDb250ZXh0LnRlc3QoZSk/MDpvLmxlbmd0aDt3aGlsZShpLS0pe2lmKGE9b1tpXSxiLnJlbGF0aXZlW3M9YS50eXBlXSlicmVhaztpZigodT1iLmZpbmRbc10pJiYocj11KGEubWF0Y2hlc1swXS5yZXBsYWNlKHRlLG5lKSxlZS50ZXN0KG9bMF0udHlwZSkmJnllKHQucGFyZW50Tm9kZSl8fHQpKSl7aWYoby5zcGxpY2UoaSwxKSwhKGU9ci5sZW5ndGgmJnhlKG8pKSlyZXR1cm4gSC5hcHBseShuLHIpLG47YnJlYWt9fX1yZXR1cm4obHx8ZihlLGMpKShyLHQsIUUsbiwhdHx8ZWUudGVzdChlKSYmeWUodC5wYXJlbnROb2RlKXx8dCksbn0sZC5zb3J0U3RhYmxlPWsuc3BsaXQoIiIpLnNvcnQoRCkuam9pbigiIik9PT1rLGQuZGV0ZWN0RHVwbGljYXRlcz0hIWwsVCgpLGQuc29ydERldGFjaGVkPWNlKGZ1bmN0aW9uKGUpe3JldHVybiAxJmUuY29tcGFyZURvY3VtZW50UG9zaXRpb24oQy5jcmVhdGVFbGVtZW50KCJmaWVsZHNldCIpKX0pLGNlKGZ1bmN0aW9uKGUpe3JldHVybiBlLmlubmVySFRNTD0iPGEgaHJlZj0nIyc+PC9hPiIsIiMiPT09ZS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpfSl8fGZlKCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoIixmdW5jdGlvbihlLHQsbil7aWYoIW4pcmV0dXJuIGUuZ2V0QXR0cmlidXRlKHQsInR5cGUiPT09dC50b0xvd2VyQ2FzZSgpPzE6Mil9KSxkLmF0dHJpYnV0ZXMmJmNlKGZ1bmN0aW9uKGUpe3JldHVybiBlLmlubmVySFRNTD0iPGlucHV0Lz4iLGUuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoInZhbHVlIiwiIiksIiI9PT1lLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpfSl8fGZlKCJ2YWx1ZSIsZnVuY3Rpb24oZSx0LG4pe2lmKCFuJiYiaW5wdXQiPT09ZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKXJldHVybiBlLmRlZmF1bHRWYWx1ZX0pLGNlKGZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKX0pfHxmZShSLGZ1bmN0aW9uKGUsdCxuKXt2YXIgcjtpZighbilyZXR1cm4hMD09PWVbdF0/dC50b0xvd2VyQ2FzZSgpOihyPWUuZ2V0QXR0cmlidXRlTm9kZSh0KSkmJnIuc3BlY2lmaWVkP3IudmFsdWU6bnVsbH0pLHNlfShDKTtrLmZpbmQ9aCxrLmV4cHI9aC5zZWxlY3RvcnMsay5leHByWyI6Il09ay5leHByLnBzZXVkb3Msay51bmlxdWVTb3J0PWsudW5pcXVlPWgudW5pcXVlU29ydCxrLnRleHQ9aC5nZXRUZXh0LGsuaXNYTUxEb2M9aC5pc1hNTCxrLmNvbnRhaW5zPWguY29udGFpbnMsay5lc2NhcGVTZWxlY3Rvcj1oLmVzY2FwZTt2YXIgVD1mdW5jdGlvbihlLHQsbil7dmFyIHI9W10saT12b2lkIDAhPT1uO3doaWxlKChlPWVbdF0pJiY5IT09ZS5ub2RlVHlwZSlpZigxPT09ZS5ub2RlVHlwZSl7aWYoaSYmayhlKS5pcyhuKSlicmVhaztyLnB1c2goZSl9cmV0dXJuIHJ9LFM9ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49W107ZTtlPWUubmV4dFNpYmxpbmcpMT09PWUubm9kZVR5cGUmJmUhPT10JiZuLnB1c2goZSk7cmV0dXJuIG59LE49ay5leHByLm1hdGNoLm5lZWRzQ29udGV4dDtmdW5jdGlvbiBBKGUsdCl7cmV0dXJuIGUubm9kZU5hbWUmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PXQudG9Mb3dlckNhc2UoKX12YXIgRD0vXjwoW2Etel1bXlwvXDA+Olx4MjBcdFxyXG5cZl0qKVtceDIwXHRcclxuXGZdKlwvPz4oPzo8XC9cMT58KSQvaTtmdW5jdGlvbiBqKGUsbixyKXtyZXR1cm4gbShuKT9rLmdyZXAoZSxmdW5jdGlvbihlLHQpe3JldHVybiEhbi5jYWxsKGUsdCxlKSE9PXJ9KTpuLm5vZGVUeXBlP2suZ3JlcChlLGZ1bmN0aW9uKGUpe3JldHVybiBlPT09biE9PXJ9KToic3RyaW5nIiE9dHlwZW9mIG4/ay5ncmVwKGUsZnVuY3Rpb24oZSl7cmV0dXJuLTE8aS5jYWxsKG4sZSkhPT1yfSk6ay5maWx0ZXIobixlLHIpfWsuZmlsdGVyPWZ1bmN0aW9uKGUsdCxuKXt2YXIgcj10WzBdO3JldHVybiBuJiYoZT0iOm5vdCgiK2UrIikiKSwxPT09dC5sZW5ndGgmJjE9PT1yLm5vZGVUeXBlP2suZmluZC5tYXRjaGVzU2VsZWN0b3IocixlKT9bcl06W106ay5maW5kLm1hdGNoZXMoZSxrLmdyZXAodCxmdW5jdGlvbihlKXtyZXR1cm4gMT09PWUubm9kZVR5cGV9KSl9LGsuZm4uZXh0ZW5kKHtmaW5kOmZ1bmN0aW9uKGUpe3ZhciB0LG4scj10aGlzLmxlbmd0aCxpPXRoaXM7aWYoInN0cmluZyIhPXR5cGVvZiBlKXJldHVybiB0aGlzLnB1c2hTdGFjayhrKGUpLmZpbHRlcihmdW5jdGlvbigpe2Zvcih0PTA7dDxyO3QrKylpZihrLmNvbnRhaW5zKGlbdF0sdGhpcykpcmV0dXJuITB9KSk7Zm9yKG49dGhpcy5wdXNoU3RhY2soW10pLHQ9MDt0PHI7dCsrKWsuZmluZChlLGlbdF0sbik7cmV0dXJuIDE8cj9rLnVuaXF1ZVNvcnQobik6bn0sZmlsdGVyOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsZXx8W10sITEpKX0sbm90OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsZXx8W10sITApKX0saXM6ZnVuY3Rpb24oZSl7cmV0dXJuISFqKHRoaXMsInN0cmluZyI9PXR5cGVvZiBlJiZOLnRlc3QoZSk/ayhlKTplfHxbXSwhMSkubGVuZ3RofX0pO3ZhciBxLEw9L14oPzpccyooPFtcd1xXXSs+KVtePl0qfCMoW1x3LV0rKSkkLzsoay5mbi5pbml0PWZ1bmN0aW9uKGUsdCxuKXt2YXIgcixpO2lmKCFlKXJldHVybiB0aGlzO2lmKG49bnx8cSwic3RyaW5nIj09dHlwZW9mIGUpe2lmKCEocj0iPCI9PT1lWzBdJiYiPiI9PT1lW2UubGVuZ3RoLTFdJiYzPD1lLmxlbmd0aD9bbnVsbCxlLG51bGxdOkwuZXhlYyhlKSl8fCFyWzFdJiZ0KXJldHVybiF0fHx0LmpxdWVyeT8odHx8bikuZmluZChlKTp0aGlzLmNvbnN0cnVjdG9yKHQpLmZpbmQoZSk7aWYoclsxXSl7aWYodD10IGluc3RhbmNlb2Ygaz90WzBdOnQsay5tZXJnZSh0aGlzLGsucGFyc2VIVE1MKHJbMV0sdCYmdC5ub2RlVHlwZT90Lm93bmVyRG9jdW1lbnR8fHQ6RSwhMCkpLEQudGVzdChyWzFdKSYmay5pc1BsYWluT2JqZWN0KHQpKWZvcihyIGluIHQpbSh0aGlzW3JdKT90aGlzW3JdKHRbcl0pOnRoaXMuYXR0cihyLHRbcl0pO3JldHVybiB0aGlzfXJldHVybihpPUUuZ2V0RWxlbWVudEJ5SWQoclsyXSkpJiYodGhpc1swXT1pLHRoaXMubGVuZ3RoPTEpLHRoaXN9cmV0dXJuIGUubm9kZVR5cGU/KHRoaXNbMF09ZSx0aGlzLmxlbmd0aD0xLHRoaXMpOm0oZSk/dm9pZCAwIT09bi5yZWFkeT9uLnJlYWR5KGUpOmUoayk6ay5tYWtlQXJyYXkoZSx0aGlzKX0pLnByb3RvdHlwZT1rLmZuLHE9ayhFKTt2YXIgSD0vXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLyxPPXtjaGlsZHJlbjohMCxjb250ZW50czohMCxuZXh0OiEwLHByZXY6ITB9O2Z1bmN0aW9uIFAoZSx0KXt3aGlsZSgoZT1lW3RdKSYmMSE9PWUubm9kZVR5cGUpO3JldHVybiBlfWsuZm4uZXh0ZW5kKHtoYXM6ZnVuY3Rpb24oZSl7dmFyIHQ9ayhlLHRoaXMpLG49dC5sZW5ndGg7cmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKHZhciBlPTA7ZTxuO2UrKylpZihrLmNvbnRhaW5zKHRoaXMsdFtlXSkpcmV0dXJuITB9KX0sY2xvc2VzdDpmdW5jdGlvbihlLHQpe3ZhciBuLHI9MCxpPXRoaXMubGVuZ3RoLG89W10sYT0ic3RyaW5nIiE9dHlwZW9mIGUmJmsoZSk7aWYoIU4udGVzdChlKSlmb3IoO3I8aTtyKyspZm9yKG49dGhpc1tyXTtuJiZuIT09dDtuPW4ucGFyZW50Tm9kZSlpZihuLm5vZGVUeXBlPDExJiYoYT8tMTxhLmluZGV4KG4pOjE9PT1uLm5vZGVUeXBlJiZrLmZpbmQubWF0Y2hlc1NlbGVjdG9yKG4sZSkpKXtvLnB1c2gobik7YnJlYWt9cmV0dXJuIHRoaXMucHVzaFN0YWNrKDE8by5sZW5ndGg/ay51bmlxdWVTb3J0KG8pOm8pfSxpbmRleDpmdW5jdGlvbihlKXtyZXR1cm4gZT8ic3RyaW5nIj09dHlwZW9mIGU/aS5jYWxsKGsoZSksdGhpc1swXSk6aS5jYWxsKHRoaXMsZS5qcXVlcnk/ZVswXTplKTp0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGU/dGhpcy5maXJzdCgpLnByZXZBbGwoKS5sZW5ndGg6LTF9LGFkZDpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLnB1c2hTdGFjayhrLnVuaXF1ZVNvcnQoay5tZXJnZSh0aGlzLmdldCgpLGsoZSx0KSkpKX0sYWRkQmFjazpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5hZGQobnVsbD09ZT90aGlzLnByZXZPYmplY3Q6dGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSl9fSksay5lYWNoKHtwYXJlbnQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wYXJlbnROb2RlO3JldHVybiB0JiYxMSE9PXQubm9kZVR5cGU/dDpudWxsfSxwYXJlbnRzOmZ1bmN0aW9uKGUpe3JldHVybiBUKGUsInBhcmVudE5vZGUiKX0scGFyZW50c1VudGlsOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gVChlLCJwYXJlbnROb2RlIixuKX0sbmV4dDpmdW5jdGlvbihlKXtyZXR1cm4gUChlLCJuZXh0U2libGluZyIpfSxwcmV2OmZ1bmN0aW9uKGUpe3JldHVybiBQKGUsInByZXZpb3VzU2libGluZyIpfSxuZXh0QWxsOmZ1bmN0aW9uKGUpe3JldHVybiBUKGUsIm5leHRTaWJsaW5nIil9LHByZXZBbGw6ZnVuY3Rpb24oZSl7cmV0dXJuIFQoZSwicHJldmlvdXNTaWJsaW5nIil9LG5leHRVbnRpbDpmdW5jdGlvbihlLHQsbil7cmV0dXJuIFQoZSwibmV4dFNpYmxpbmciLG4pfSxwcmV2VW50aWw6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBUKGUsInByZXZpb3VzU2libGluZyIsbil9LHNpYmxpbmdzOmZ1bmN0aW9uKGUpe3JldHVybiBTKChlLnBhcmVudE5vZGV8fHt9KS5maXJzdENoaWxkLGUpfSxjaGlsZHJlbjpmdW5jdGlvbihlKXtyZXR1cm4gUyhlLmZpcnN0Q2hpbGQpfSxjb250ZW50czpmdW5jdGlvbihlKXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIGUuY29udGVudERvY3VtZW50P2UuY29udGVudERvY3VtZW50OihBKGUsInRlbXBsYXRlIikmJihlPWUuY29udGVudHx8ZSksay5tZXJnZShbXSxlLmNoaWxkTm9kZXMpKX19LGZ1bmN0aW9uKHIsaSl7ay5mbltyXT1mdW5jdGlvbihlLHQpe3ZhciBuPWsubWFwKHRoaXMsaSxlKTtyZXR1cm4iVW50aWwiIT09ci5zbGljZSgtNSkmJih0PWUpLHQmJiJzdHJpbmciPT10eXBlb2YgdCYmKG49ay5maWx0ZXIodCxuKSksMTx0aGlzLmxlbmd0aCYmKE9bcl18fGsudW5pcXVlU29ydChuKSxILnRlc3QocikmJm4ucmV2ZXJzZSgpKSx0aGlzLnB1c2hTdGFjayhuKX19KTt2YXIgUj0vW15ceDIwXHRcclxuXGZdKy9nO2Z1bmN0aW9uIE0oZSl7cmV0dXJuIGV9ZnVuY3Rpb24gSShlKXt0aHJvdyBlfWZ1bmN0aW9uIFcoZSx0LG4scil7dmFyIGk7dHJ5e2UmJm0oaT1lLnByb21pc2UpP2kuY2FsbChlKS5kb25lKHQpLmZhaWwobik6ZSYmbShpPWUudGhlbik/aS5jYWxsKGUsdCxuKTp0LmFwcGx5KHZvaWQgMCxbZV0uc2xpY2UocikpfWNhdGNoKGUpe24uYXBwbHkodm9pZCAwLFtlXSl9fWsuQ2FsbGJhY2tzPWZ1bmN0aW9uKHIpe3ZhciBlLG47cj0ic3RyaW5nIj09dHlwZW9mIHI/KGU9cixuPXt9LGsuZWFjaChlLm1hdGNoKFIpfHxbXSxmdW5jdGlvbihlLHQpe25bdF09ITB9KSxuKTprLmV4dGVuZCh7fSxyKTt2YXIgaSx0LG8sYSxzPVtdLHU9W10sbD0tMSxjPWZ1bmN0aW9uKCl7Zm9yKGE9YXx8ci5vbmNlLG89aT0hMDt1Lmxlbmd0aDtsPS0xKXt0PXUuc2hpZnQoKTt3aGlsZSgrK2w8cy5sZW5ndGgpITE9PT1zW2xdLmFwcGx5KHRbMF0sdFsxXSkmJnIuc3RvcE9uRmFsc2UmJihsPXMubGVuZ3RoLHQ9ITEpfXIubWVtb3J5fHwodD0hMSksaT0hMSxhJiYocz10P1tdOiIiKX0sZj17YWRkOmZ1bmN0aW9uKCl7cmV0dXJuIHMmJih0JiYhaSYmKGw9cy5sZW5ndGgtMSx1LnB1c2godCkpLGZ1bmN0aW9uIG4oZSl7ay5lYWNoKGUsZnVuY3Rpb24oZSx0KXttKHQpP3IudW5pcXVlJiZmLmhhcyh0KXx8cy5wdXNoKHQpOnQmJnQubGVuZ3RoJiYic3RyaW5nIiE9PXcodCkmJm4odCl9KX0oYXJndW1lbnRzKSx0JiYhaSYmYygpKSx0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oKXtyZXR1cm4gay5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbihlLHQpe3ZhciBuO3doaWxlKC0xPChuPWsuaW5BcnJheSh0LHMsbikpKXMuc3BsaWNlKG4sMSksbjw9bCYmbC0tfSksdGhpc30saGFzOmZ1bmN0aW9uKGUpe3JldHVybiBlPy0xPGsuaW5BcnJheShlLHMpOjA8cy5sZW5ndGh9LGVtcHR5OmZ1bmN0aW9uKCl7cmV0dXJuIHMmJihzPVtdKSx0aGlzfSxkaXNhYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIGE9dT1bXSxzPXQ9IiIsdGhpc30sZGlzYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hc30sbG9jazpmdW5jdGlvbigpe3JldHVybiBhPXU9W10sdHx8aXx8KHM9dD0iIiksdGhpc30sbG9ja2VkOmZ1bmN0aW9uKCl7cmV0dXJuISFhfSxmaXJlV2l0aDpmdW5jdGlvbihlLHQpe3JldHVybiBhfHwodD1bZSwodD10fHxbXSkuc2xpY2U/dC5zbGljZSgpOnRdLHUucHVzaCh0KSxpfHxjKCkpLHRoaXN9LGZpcmU6ZnVuY3Rpb24oKXtyZXR1cm4gZi5maXJlV2l0aCh0aGlzLGFyZ3VtZW50cyksdGhpc30sZmlyZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIW99fTtyZXR1cm4gZn0say5leHRlbmQoe0RlZmVycmVkOmZ1bmN0aW9uKGUpe3ZhciBvPVtbIm5vdGlmeSIsInByb2dyZXNzIixrLkNhbGxiYWNrcygibWVtb3J5Iiksay5DYWxsYmFja3MoIm1lbW9yeSIpLDJdLFsicmVzb2x2ZSIsImRvbmUiLGsuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLGsuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLDAsInJlc29sdmVkIl0sWyJyZWplY3QiLCJmYWlsIixrLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSxrLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwxLCJyZWplY3RlZCJdXSxpPSJwZW5kaW5nIixhPXtzdGF0ZTpmdW5jdGlvbigpe3JldHVybiBpfSxhbHdheXM6ZnVuY3Rpb24oKXtyZXR1cm4gcy5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLHRoaXN9LCJjYXRjaCI6ZnVuY3Rpb24oZSl7cmV0dXJuIGEudGhlbihudWxsLGUpfSxwaXBlOmZ1bmN0aW9uKCl7dmFyIGk9YXJndW1lbnRzO3JldHVybiBrLkRlZmVycmVkKGZ1bmN0aW9uKHIpe2suZWFjaChvLGZ1bmN0aW9uKGUsdCl7dmFyIG49bShpW3RbNF1dKSYmaVt0WzRdXTtzW3RbMV1dKGZ1bmN0aW9uKCl7dmFyIGU9biYmbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7ZSYmbShlLnByb21pc2UpP2UucHJvbWlzZSgpLnByb2dyZXNzKHIubm90aWZ5KS5kb25lKHIucmVzb2x2ZSkuZmFpbChyLnJlamVjdCk6clt0WzBdKyJXaXRoIl0odGhpcyxuP1tlXTphcmd1bWVudHMpfSl9KSxpPW51bGx9KS5wcm9taXNlKCl9LHRoZW46ZnVuY3Rpb24odCxuLHIpe3ZhciB1PTA7ZnVuY3Rpb24gbChpLG8sYSxzKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgbj10aGlzLHI9YXJndW1lbnRzLGU9ZnVuY3Rpb24oKXt2YXIgZSx0O2lmKCEoaTx1KSl7aWYoKGU9YS5hcHBseShuLHIpKT09PW8ucHJvbWlzZSgpKXRocm93IG5ldyBUeXBlRXJyb3IoIlRoZW5hYmxlIHNlbGYtcmVzb2x1dGlvbiIpO3Q9ZSYmKCJvYmplY3QiPT10eXBlb2YgZXx8ImZ1bmN0aW9uIj09dHlwZW9mIGUpJiZlLnRoZW4sbSh0KT9zP3QuY2FsbChlLGwodSxvLE0scyksbCh1LG8sSSxzKSk6KHUrKyx0LmNhbGwoZSxsKHUsbyxNLHMpLGwodSxvLEkscyksbCh1LG8sTSxvLm5vdGlmeVdpdGgpKSk6KGEhPT1NJiYobj12b2lkIDAscj1bZV0pLChzfHxvLnJlc29sdmVXaXRoKShuLHIpKX19LHQ9cz9lOmZ1bmN0aW9uKCl7dHJ5e2UoKX1jYXRjaChlKXtrLkRlZmVycmVkLmV4Y2VwdGlvbkhvb2smJmsuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayhlLHQuc3RhY2tUcmFjZSksdTw9aSsxJiYoYSE9PUkmJihuPXZvaWQgMCxyPVtlXSksby5yZWplY3RXaXRoKG4scikpfX07aT90KCk6KGsuRGVmZXJyZWQuZ2V0U3RhY2tIb29rJiYodC5zdGFja1RyYWNlPWsuRGVmZXJyZWQuZ2V0U3RhY2tIb29rKCkpLEMuc2V0VGltZW91dCh0KSl9fXJldHVybiBrLkRlZmVycmVkKGZ1bmN0aW9uKGUpe29bMF1bM10uYWRkKGwoMCxlLG0ocik/cjpNLGUubm90aWZ5V2l0aCkpLG9bMV1bM10uYWRkKGwoMCxlLG0odCk/dDpNKSksb1syXVszXS5hZGQobCgwLGUsbShuKT9uOkkpKX0pLnByb21pc2UoKX0scHJvbWlzZTpmdW5jdGlvbihlKXtyZXR1cm4gbnVsbCE9ZT9rLmV4dGVuZChlLGEpOmF9fSxzPXt9O3JldHVybiBrLmVhY2gobyxmdW5jdGlvbihlLHQpe3ZhciBuPXRbMl0scj10WzVdO2FbdFsxXV09bi5hZGQsciYmbi5hZGQoZnVuY3Rpb24oKXtpPXJ9LG9bMy1lXVsyXS5kaXNhYmxlLG9bMy1lXVszXS5kaXNhYmxlLG9bMF1bMl0ubG9jayxvWzBdWzNdLmxvY2spLG4uYWRkKHRbM10uZmlyZSksc1t0WzBdXT1mdW5jdGlvbigpe3JldHVybiBzW3RbMF0rIldpdGgiXSh0aGlzPT09cz92b2lkIDA6dGhpcyxhcmd1bWVudHMpLHRoaXN9LHNbdFswXSsiV2l0aCJdPW4uZmlyZVdpdGh9KSxhLnByb21pc2UocyksZSYmZS5jYWxsKHMscyksc30sd2hlbjpmdW5jdGlvbihlKXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoLHQ9bixyPUFycmF5KHQpLGk9cy5jYWxsKGFyZ3VtZW50cyksbz1rLkRlZmVycmVkKCksYT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7clt0XT10aGlzLGlbdF09MTxhcmd1bWVudHMubGVuZ3RoP3MuY2FsbChhcmd1bWVudHMpOmUsLS1ufHxvLnJlc29sdmVXaXRoKHIsaSl9fTtpZihuPD0xJiYoVyhlLG8uZG9uZShhKHQpKS5yZXNvbHZlLG8ucmVqZWN0LCFuKSwicGVuZGluZyI9PT1vLnN0YXRlKCl8fG0oaVt0XSYmaVt0XS50aGVuKSkpcmV0dXJuIG8udGhlbigpO3doaWxlKHQtLSlXKGlbdF0sYSh0KSxvLnJlamVjdCk7cmV0dXJuIG8ucHJvbWlzZSgpfX0pO3ZhciAkPS9eKEV2YWx8SW50ZXJuYWx8UmFuZ2V8UmVmZXJlbmNlfFN5bnRheHxUeXBlfFVSSSlFcnJvciQvO2suRGVmZXJyZWQuZXhjZXB0aW9uSG9vaz1mdW5jdGlvbihlLHQpe0MuY29uc29sZSYmQy5jb25zb2xlLndhcm4mJmUmJiQudGVzdChlLm5hbWUpJiZDLmNvbnNvbGUud2FybigialF1ZXJ5LkRlZmVycmVkIGV4Y2VwdGlvbjogIitlLm1lc3NhZ2UsZS5zdGFjayx0KX0say5yZWFkeUV4Y2VwdGlvbj1mdW5jdGlvbihlKXtDLnNldFRpbWVvdXQoZnVuY3Rpb24oKXt0aHJvdyBlfSl9O3ZhciBGPWsuRGVmZXJyZWQoKTtmdW5jdGlvbiBCKCl7RS5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCKSxDLnJlbW92ZUV2ZW50TGlzdGVuZXIoImxvYWQiLEIpLGsucmVhZHkoKX1rLmZuLnJlYWR5PWZ1bmN0aW9uKGUpe3JldHVybiBGLnRoZW4oZSlbImNhdGNoIl0oZnVuY3Rpb24oZSl7ay5yZWFkeUV4Y2VwdGlvbihlKX0pLHRoaXN9LGsuZXh0ZW5kKHtpc1JlYWR5OiExLHJlYWR5V2FpdDoxLHJlYWR5OmZ1bmN0aW9uKGUpeyghMD09PWU/LS1rLnJlYWR5V2FpdDprLmlzUmVhZHkpfHwoay5pc1JlYWR5PSEwKSE9PWUmJjA8LS1rLnJlYWR5V2FpdHx8Ri5yZXNvbHZlV2l0aChFLFtrXSl9fSksay5yZWFkeS50aGVuPUYudGhlbiwiY29tcGxldGUiPT09RS5yZWFkeVN0YXRlfHwibG9hZGluZyIhPT1FLnJlYWR5U3RhdGUmJiFFLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbD9DLnNldFRpbWVvdXQoay5yZWFkeSk6KEUuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsQiksQy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIixCKSk7dmFyIF89ZnVuY3Rpb24oZSx0LG4scixpLG8sYSl7dmFyIHM9MCx1PWUubGVuZ3RoLGw9bnVsbD09bjtpZigib2JqZWN0Ij09PXcobikpZm9yKHMgaW4gaT0hMCxuKV8oZSx0LHMsbltzXSwhMCxvLGEpO2Vsc2UgaWYodm9pZCAwIT09ciYmKGk9ITAsbShyKXx8KGE9ITApLGwmJihhPyh0LmNhbGwoZSxyKSx0PW51bGwpOihsPXQsdD1mdW5jdGlvbihlLHQsbil7cmV0dXJuIGwuY2FsbChrKGUpLG4pfSkpLHQpKWZvcig7czx1O3MrKyl0KGVbc10sbixhP3I6ci5jYWxsKGVbc10scyx0KGVbc10sbikpKTtyZXR1cm4gaT9lOmw/dC5jYWxsKGUpOnU/dChlWzBdLG4pOm99LHo9L14tbXMtLyxVPS8tKFthLXpdKS9nO2Z1bmN0aW9uIFgoZSx0KXtyZXR1cm4gdC50b1VwcGVyQ2FzZSgpfWZ1bmN0aW9uIFYoZSl7cmV0dXJuIGUucmVwbGFjZSh6LCJtcy0iKS5yZXBsYWNlKFUsWCl9dmFyIEc9ZnVuY3Rpb24oZSl7cmV0dXJuIDE9PT1lLm5vZGVUeXBlfHw5PT09ZS5ub2RlVHlwZXx8IStlLm5vZGVUeXBlfTtmdW5jdGlvbiBZKCl7dGhpcy5leHBhbmRvPWsuZXhwYW5kbytZLnVpZCsrfVkudWlkPTEsWS5wcm90b3R5cGU9e2NhY2hlOmZ1bmN0aW9uKGUpe3ZhciB0PWVbdGhpcy5leHBhbmRvXTtyZXR1cm4gdHx8KHQ9e30sRyhlKSYmKGUubm9kZVR5cGU/ZVt0aGlzLmV4cGFuZG9dPXQ6T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdGhpcy5leHBhbmRvLHt2YWx1ZTp0LGNvbmZpZ3VyYWJsZTohMH0pKSksdH0sc2V0OmZ1bmN0aW9uKGUsdCxuKXt2YXIgcixpPXRoaXMuY2FjaGUoZSk7aWYoInN0cmluZyI9PXR5cGVvZiB0KWlbVih0KV09bjtlbHNlIGZvcihyIGluIHQpaVtWKHIpXT10W3JdO3JldHVybiBpfSxnZXQ6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdm9pZCAwPT09dD90aGlzLmNhY2hlKGUpOmVbdGhpcy5leHBhbmRvXSYmZVt0aGlzLmV4cGFuZG9dW1YodCldfSxhY2Nlc3M6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiB2b2lkIDA9PT10fHx0JiYic3RyaW5nIj09dHlwZW9mIHQmJnZvaWQgMD09PW4/dGhpcy5nZXQoZSx0KToodGhpcy5zZXQoZSx0LG4pLHZvaWQgMCE9PW4/bjp0KX0scmVtb3ZlOmZ1bmN0aW9uKGUsdCl7dmFyIG4scj1lW3RoaXMuZXhwYW5kb107aWYodm9pZCAwIT09cil7aWYodm9pZCAwIT09dCl7bj0odD1BcnJheS5pc0FycmF5KHQpP3QubWFwKFYpOih0PVYodCkpaW4gcj9bdF06dC5tYXRjaChSKXx8W10pLmxlbmd0aDt3aGlsZShuLS0pZGVsZXRlIHJbdFtuXV19KHZvaWQgMD09PXR8fGsuaXNFbXB0eU9iamVjdChyKSkmJihlLm5vZGVUeXBlP2VbdGhpcy5leHBhbmRvXT12b2lkIDA6ZGVsZXRlIGVbdGhpcy5leHBhbmRvXSl9fSxoYXNEYXRhOmZ1bmN0aW9uKGUpe3ZhciB0PWVbdGhpcy5leHBhbmRvXTtyZXR1cm4gdm9pZCAwIT09dCYmIWsuaXNFbXB0eU9iamVjdCh0KX19O3ZhciBRPW5ldyBZLEo9bmV3IFksSz0vXig/Olx7W1x3XFddKlx9fFxbW1x3XFddKlxdKSQvLFo9L1tBLVpdL2c7ZnVuY3Rpb24gZWUoZSx0LG4pe3ZhciByLGk7aWYodm9pZCAwPT09biYmMT09PWUubm9kZVR5cGUpaWYocj0iZGF0YS0iK3QucmVwbGFjZShaLCItJCYiKS50b0xvd2VyQ2FzZSgpLCJzdHJpbmciPT10eXBlb2Yobj1lLmdldEF0dHJpYnV0ZShyKSkpe3RyeXtuPSJ0cnVlIj09PShpPW4pfHwiZmFsc2UiIT09aSYmKCJudWxsIj09PWk/bnVsbDppPT09K2krIiI/K2k6Sy50ZXN0KGkpP0pTT04ucGFyc2UoaSk6aSl9Y2F0Y2goZSl7fUouc2V0KGUsdCxuKX1lbHNlIG49dm9pZCAwO3JldHVybiBufWsuZXh0ZW5kKHtoYXNEYXRhOmZ1bmN0aW9uKGUpe3JldHVybiBKLmhhc0RhdGEoZSl8fFEuaGFzRGF0YShlKX0sZGF0YTpmdW5jdGlvbihlLHQsbil7cmV0dXJuIEouYWNjZXNzKGUsdCxuKX0scmVtb3ZlRGF0YTpmdW5jdGlvbihlLHQpe0oucmVtb3ZlKGUsdCl9LF9kYXRhOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gUS5hY2Nlc3MoZSx0LG4pfSxfcmVtb3ZlRGF0YTpmdW5jdGlvbihlLHQpe1EucmVtb3ZlKGUsdCl9fSksay5mbi5leHRlbmQoe2RhdGE6ZnVuY3Rpb24obixlKXt2YXIgdCxyLGksbz10aGlzWzBdLGE9byYmby5hdHRyaWJ1dGVzO2lmKHZvaWQgMD09PW4pe2lmKHRoaXMubGVuZ3RoJiYoaT1KLmdldChvKSwxPT09by5ub2RlVHlwZSYmIVEuZ2V0KG8sImhhc0RhdGFBdHRycyIpKSl7dD1hLmxlbmd0aDt3aGlsZSh0LS0pYVt0XSYmMD09PShyPWFbdF0ubmFtZSkuaW5kZXhPZigiZGF0YS0iKSYmKHI9VihyLnNsaWNlKDUpKSxlZShvLHIsaVtyXSkpO1Euc2V0KG8sImhhc0RhdGFBdHRycyIsITApfXJldHVybiBpfXJldHVybiJvYmplY3QiPT10eXBlb2Ygbj90aGlzLmVhY2goZnVuY3Rpb24oKXtKLnNldCh0aGlzLG4pfSk6Xyh0aGlzLGZ1bmN0aW9uKGUpe3ZhciB0O2lmKG8mJnZvaWQgMD09PWUpcmV0dXJuIHZvaWQgMCE9PSh0PUouZ2V0KG8sbikpP3Q6dm9pZCAwIT09KHQ9ZWUobyxuKSk/dDp2b2lkIDA7dGhpcy5lYWNoKGZ1bmN0aW9uKCl7Si5zZXQodGhpcyxuLGUpfSl9LG51bGwsZSwxPGFyZ3VtZW50cy5sZW5ndGgsbnVsbCwhMCl9LHJlbW92ZURhdGE6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe0oucmVtb3ZlKHRoaXMsZSl9KX19KSxrLmV4dGVuZCh7cXVldWU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByO2lmKGUpcmV0dXJuIHQ9KHR8fCJmeCIpKyJxdWV1ZSIscj1RLmdldChlLHQpLG4mJighcnx8QXJyYXkuaXNBcnJheShuKT9yPVEuYWNjZXNzKGUsdCxrLm1ha2VBcnJheShuKSk6ci5wdXNoKG4pKSxyfHxbXX0sZGVxdWV1ZTpmdW5jdGlvbihlLHQpe3Q9dHx8ImZ4Ijt2YXIgbj1rLnF1ZXVlKGUsdCkscj1uLmxlbmd0aCxpPW4uc2hpZnQoKSxvPWsuX3F1ZXVlSG9va3MoZSx0KTsiaW5wcm9ncmVzcyI9PT1pJiYoaT1uLnNoaWZ0KCksci0tKSxpJiYoImZ4Ij09PXQmJm4udW5zaGlmdCgiaW5wcm9ncmVzcyIpLGRlbGV0ZSBvLnN0b3AsaS5jYWxsKGUsZnVuY3Rpb24oKXtrLmRlcXVldWUoZSx0KX0sbykpLCFyJiZvJiZvLmVtcHR5LmZpcmUoKX0sX3F1ZXVlSG9va3M6ZnVuY3Rpb24oZSx0KXt2YXIgbj10KyJxdWV1ZUhvb2tzIjtyZXR1cm4gUS5nZXQoZSxuKXx8US5hY2Nlc3MoZSxuLHtlbXB0eTprLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKS5hZGQoZnVuY3Rpb24oKXtRLnJlbW92ZShlLFt0KyJxdWV1ZSIsbl0pfSl9KX19KSxrLmZuLmV4dGVuZCh7cXVldWU6ZnVuY3Rpb24odCxuKXt2YXIgZT0yO3JldHVybiJzdHJpbmciIT10eXBlb2YgdCYmKG49dCx0PSJmeCIsZS0tKSxhcmd1bWVudHMubGVuZ3RoPGU/ay5xdWV1ZSh0aGlzWzBdLHQpOnZvaWQgMD09PW4/dGhpczp0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1rLnF1ZXVlKHRoaXMsdCxuKTtrLl9xdWV1ZUhvb2tzKHRoaXMsdCksImZ4Ij09PXQmJiJpbnByb2dyZXNzIiE9PWVbMF0mJmsuZGVxdWV1ZSh0aGlzLHQpfSl9LGRlcXVldWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2suZGVxdWV1ZSh0aGlzLGUpfSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucXVldWUoZXx8ImZ4IixbXSl9LHByb21pc2U6ZnVuY3Rpb24oZSx0KXt2YXIgbixyPTEsaT1rLkRlZmVycmVkKCksbz10aGlzLGE9dGhpcy5sZW5ndGgscz1mdW5jdGlvbigpey0tcnx8aS5yZXNvbHZlV2l0aChvLFtvXSl9OyJzdHJpbmciIT10eXBlb2YgZSYmKHQ9ZSxlPXZvaWQgMCksZT1lfHwiZngiO3doaWxlKGEtLSkobj1RLmdldChvW2FdLGUrInF1ZXVlSG9va3MiKSkmJm4uZW1wdHkmJihyKyssbi5lbXB0eS5hZGQocykpO3JldHVybiBzKCksaS5wcm9taXNlKHQpfX0pO3ZhciB0ZT0vWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSxuZT1uZXcgUmVnRXhwKCJeKD86KFsrLV0pPXwpKCIrdGUrIikoW2EteiVdKikkIiwiaSIpLHJlPVsiVG9wIiwiUmlnaHQiLCJCb3R0b20iLCJMZWZ0Il0saWU9RS5kb2N1bWVudEVsZW1lbnQsb2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGsuY29udGFpbnMoZS5vd25lckRvY3VtZW50LGUpfSxhZT17Y29tcG9zZWQ6ITB9O2llLmdldFJvb3ROb2RlJiYob2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGsuY29udGFpbnMoZS5vd25lckRvY3VtZW50LGUpfHxlLmdldFJvb3ROb2RlKGFlKT09PWUub3duZXJEb2N1bWVudH0pO3ZhciBzZT1mdW5jdGlvbihlLHQpe3JldHVybiJub25lIj09PShlPXR8fGUpLnN0eWxlLmRpc3BsYXl8fCIiPT09ZS5zdHlsZS5kaXNwbGF5JiZvZShlKSYmIm5vbmUiPT09ay5jc3MoZSwiZGlzcGxheSIpfSx1ZT1mdW5jdGlvbihlLHQsbixyKXt2YXIgaSxvLGE9e307Zm9yKG8gaW4gdClhW29dPWUuc3R5bGVbb10sZS5zdHlsZVtvXT10W29dO2ZvcihvIGluIGk9bi5hcHBseShlLHJ8fFtdKSx0KWUuc3R5bGVbb109YVtvXTtyZXR1cm4gaX07ZnVuY3Rpb24gbGUoZSx0LG4scil7dmFyIGksbyxhPTIwLHM9cj9mdW5jdGlvbigpe3JldHVybiByLmN1cigpfTpmdW5jdGlvbigpe3JldHVybiBrLmNzcyhlLHQsIiIpfSx1PXMoKSxsPW4mJm5bM118fChrLmNzc051bWJlclt0XT8iIjoicHgiKSxjPWUubm9kZVR5cGUmJihrLmNzc051bWJlclt0XXx8InB4IiE9PWwmJit1KSYmbmUuZXhlYyhrLmNzcyhlLHQpKTtpZihjJiZjWzNdIT09bCl7dS89MixsPWx8fGNbM10sYz0rdXx8MTt3aGlsZShhLS0pay5zdHlsZShlLHQsYytsKSwoMS1vKSooMS0obz1zKCkvdXx8LjUpKTw9MCYmKGE9MCksYy89bztjKj0yLGsuc3R5bGUoZSx0LGMrbCksbj1ufHxbXX1yZXR1cm4gbiYmKGM9K2N8fCt1fHwwLGk9blsxXT9jKyhuWzFdKzEpKm5bMl06K25bMl0sciYmKHIudW5pdD1sLHIuc3RhcnQ9YyxyLmVuZD1pKSksaX12YXIgY2U9e307ZnVuY3Rpb24gZmUoZSx0KXtmb3IodmFyIG4scixpLG8sYSxzLHUsbD1bXSxjPTAsZj1lLmxlbmd0aDtjPGY7YysrKShyPWVbY10pLnN0eWxlJiYobj1yLnN0eWxlLmRpc3BsYXksdD8oIm5vbmUiPT09biYmKGxbY109US5nZXQociwiZGlzcGxheSIpfHxudWxsLGxbY118fChyLnN0eWxlLmRpc3BsYXk9IiIpKSwiIj09PXIuc3R5bGUuZGlzcGxheSYmc2UocikmJihsW2NdPSh1PWE9bz12b2lkIDAsYT0oaT1yKS5vd25lckRvY3VtZW50LHM9aS5ub2RlTmFtZSwodT1jZVtzXSl8fChvPWEuYm9keS5hcHBlbmRDaGlsZChhLmNyZWF0ZUVsZW1lbnQocykpLHU9ay5jc3MobywiZGlzcGxheSIpLG8ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvKSwibm9uZSI9PT11JiYodT0iYmxvY2siKSxjZVtzXT11KSkpKToibm9uZSIhPT1uJiYobFtjXT0ibm9uZSIsUS5zZXQociwiZGlzcGxheSIsbikpKTtmb3IoYz0wO2M8ZjtjKyspbnVsbCE9bFtjXSYmKGVbY10uc3R5bGUuZGlzcGxheT1sW2NdKTtyZXR1cm4gZX1rLmZuLmV4dGVuZCh7c2hvdzpmdW5jdGlvbigpe3JldHVybiBmZSh0aGlzLCEwKX0saGlkZTpmdW5jdGlvbigpe3JldHVybiBmZSh0aGlzKX0sdG9nZ2xlOmZ1bmN0aW9uKGUpe3JldHVybiJib29sZWFuIj09dHlwZW9mIGU/ZT90aGlzLnNob3coKTp0aGlzLmhpZGUoKTp0aGlzLmVhY2goZnVuY3Rpb24oKXtzZSh0aGlzKT9rKHRoaXMpLnNob3coKTprKHRoaXMpLmhpZGUoKX0pfX0pO3ZhciBwZT0vXig/OmNoZWNrYm94fHJhZGlvKSQvaSxkZT0vPChbYS16XVteXC9cMD5ceDIwXHRcclxuXGZdKikvaSxoZT0vXiR8Xm1vZHVsZSR8XC8oPzpqYXZhfGVjbWEpc2NyaXB0L2ksZ2U9e29wdGlvbjpbMSwiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsIjwvc2VsZWN0PiJdLHRoZWFkOlsxLCI8dGFibGU+IiwiPC90YWJsZT4iXSxjb2w6WzIsIjx0YWJsZT48Y29sZ3JvdXA+IiwiPC9jb2xncm91cD48L3RhYmxlPiJdLHRyOlsyLCI8dGFibGU+PHRib2R5PiIsIjwvdGJvZHk+PC90YWJsZT4iXSx0ZDpbMywiPHRhYmxlPjx0Ym9keT48dHI+IiwiPC90cj48L3Rib2R5PjwvdGFibGU+Il0sX2RlZmF1bHQ6WzAsIiIsIiJdfTtmdW5jdGlvbiB2ZShlLHQpe3ZhciBuO3JldHVybiBuPSJ1bmRlZmluZWQiIT10eXBlb2YgZS5nZXRFbGVtZW50c0J5VGFnTmFtZT9lLmdldEVsZW1lbnRzQnlUYWdOYW1lKHR8fCIqIik6InVuZGVmaW5lZCIhPXR5cGVvZiBlLnF1ZXJ5U2VsZWN0b3JBbGw/ZS5xdWVyeVNlbGVjdG9yQWxsKHR8fCIqIik6W10sdm9pZCAwPT09dHx8dCYmQShlLHQpP2subWVyZ2UoW2VdLG4pOm59ZnVuY3Rpb24geWUoZSx0KXtmb3IodmFyIG49MCxyPWUubGVuZ3RoO248cjtuKyspUS5zZXQoZVtuXSwiZ2xvYmFsRXZhbCIsIXR8fFEuZ2V0KHRbbl0sImdsb2JhbEV2YWwiKSl9Z2Uub3B0Z3JvdXA9Z2Uub3B0aW9uLGdlLnRib2R5PWdlLnRmb290PWdlLmNvbGdyb3VwPWdlLmNhcHRpb249Z2UudGhlYWQsZ2UudGg9Z2UudGQ7dmFyIG1lLHhlLGJlPS88fCYjP1x3KzsvO2Z1bmN0aW9uIHdlKGUsdCxuLHIsaSl7Zm9yKHZhciBvLGEscyx1LGwsYyxmPXQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLHA9W10sZD0wLGg9ZS5sZW5ndGg7ZDxoO2QrKylpZigobz1lW2RdKXx8MD09PW8paWYoIm9iamVjdCI9PT13KG8pKWsubWVyZ2UocCxvLm5vZGVUeXBlP1tvXTpvKTtlbHNlIGlmKGJlLnRlc3Qobykpe2E9YXx8Zi5hcHBlbmRDaGlsZCh0LmNyZWF0ZUVsZW1lbnQoImRpdiIpKSxzPShkZS5leGVjKG8pfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpLHU9Z2Vbc118fGdlLl9kZWZhdWx0LGEuaW5uZXJIVE1MPXVbMV0ray5odG1sUHJlZmlsdGVyKG8pK3VbMl0sYz11WzBdO3doaWxlKGMtLSlhPWEubGFzdENoaWxkO2subWVyZ2UocCxhLmNoaWxkTm9kZXMpLChhPWYuZmlyc3RDaGlsZCkudGV4dENvbnRlbnQ9IiJ9ZWxzZSBwLnB1c2godC5jcmVhdGVUZXh0Tm9kZShvKSk7Zi50ZXh0Q29udGVudD0iIixkPTA7d2hpbGUobz1wW2QrK10paWYociYmLTE8ay5pbkFycmF5KG8scikpaSYmaS5wdXNoKG8pO2Vsc2UgaWYobD1vZShvKSxhPXZlKGYuYXBwZW5kQ2hpbGQobyksInNjcmlwdCIpLGwmJnllKGEpLG4pe2M9MDt3aGlsZShvPWFbYysrXSloZS50ZXN0KG8udHlwZXx8IiIpJiZuLnB1c2gobyl9cmV0dXJuIGZ9bWU9RS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkuYXBwZW5kQ2hpbGQoRS5jcmVhdGVFbGVtZW50KCJkaXYiKSksKHhlPUUuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSkuc2V0QXR0cmlidXRlKCJ0eXBlIiwicmFkaW8iKSx4ZS5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJjaGVja2VkIikseGUuc2V0QXR0cmlidXRlKCJuYW1lIiwidCIpLG1lLmFwcGVuZENoaWxkKHhlKSx5LmNoZWNrQ2xvbmU9bWUuY2xvbmVOb2RlKCEwKS5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5jaGVja2VkLG1lLmlubmVySFRNTD0iPHRleHRhcmVhPng8L3RleHRhcmVhPiIseS5ub0Nsb25lQ2hlY2tlZD0hIW1lLmNsb25lTm9kZSghMCkubGFzdENoaWxkLmRlZmF1bHRWYWx1ZTt2YXIgVGU9L15rZXkvLENlPS9eKD86bW91c2V8cG9pbnRlcnxjb250ZXh0bWVudXxkcmFnfGRyb3ApfGNsaWNrLyxFZT0vXihbXi5dKikoPzpcLiguKyl8KS87ZnVuY3Rpb24ga2UoKXtyZXR1cm4hMH1mdW5jdGlvbiBTZSgpe3JldHVybiExfWZ1bmN0aW9uIE5lKGUsdCl7cmV0dXJuIGU9PT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gRS5hY3RpdmVFbGVtZW50fWNhdGNoKGUpe319KCk9PSgiZm9jdXMiPT09dCl9ZnVuY3Rpb24gQWUoZSx0LG4scixpLG8pe3ZhciBhLHM7aWYoIm9iamVjdCI9PXR5cGVvZiB0KXtmb3IocyBpbiJzdHJpbmciIT10eXBlb2YgbiYmKHI9cnx8bixuPXZvaWQgMCksdClBZShlLHMsbixyLHRbc10sbyk7cmV0dXJuIGV9aWYobnVsbD09ciYmbnVsbD09aT8oaT1uLHI9bj12b2lkIDApOm51bGw9PWkmJigic3RyaW5nIj09dHlwZW9mIG4/KGk9cixyPXZvaWQgMCk6KGk9cixyPW4sbj12b2lkIDApKSwhMT09PWkpaT1TZTtlbHNlIGlmKCFpKXJldHVybiBlO3JldHVybiAxPT09byYmKGE9aSwoaT1mdW5jdGlvbihlKXtyZXR1cm4gaygpLm9mZihlKSxhLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLmd1aWQ9YS5ndWlkfHwoYS5ndWlkPWsuZ3VpZCsrKSksZS5lYWNoKGZ1bmN0aW9uKCl7ay5ldmVudC5hZGQodGhpcyx0LGkscixuKX0pfWZ1bmN0aW9uIERlKGUsaSxvKXtvPyhRLnNldChlLGksITEpLGsuZXZlbnQuYWRkKGUsaSx7bmFtZXNwYWNlOiExLGhhbmRsZXI6ZnVuY3Rpb24oZSl7dmFyIHQsbixyPVEuZ2V0KHRoaXMsaSk7aWYoMSZlLmlzVHJpZ2dlciYmdGhpc1tpXSl7aWYoci5sZW5ndGgpKGsuZXZlbnQuc3BlY2lhbFtpXXx8e30pLmRlbGVnYXRlVHlwZSYmZS5zdG9wUHJvcGFnYXRpb24oKTtlbHNlIGlmKHI9cy5jYWxsKGFyZ3VtZW50cyksUS5zZXQodGhpcyxpLHIpLHQ9byh0aGlzLGkpLHRoaXNbaV0oKSxyIT09KG49US5nZXQodGhpcyxpKSl8fHQ/US5zZXQodGhpcyxpLCExKTpuPXt9LHIhPT1uKXJldHVybiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGUucHJldmVudERlZmF1bHQoKSxuLnZhbHVlfWVsc2Ugci5sZW5ndGgmJihRLnNldCh0aGlzLGkse3ZhbHVlOmsuZXZlbnQudHJpZ2dlcihrLmV4dGVuZChyWzBdLGsuRXZlbnQucHJvdG90eXBlKSxyLnNsaWNlKDEpLHRoaXMpfSksZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSl9fSkpOnZvaWQgMD09PVEuZ2V0KGUsaSkmJmsuZXZlbnQuYWRkKGUsaSxrZSl9ay5ldmVudD17Z2xvYmFsOnt9LGFkZDpmdW5jdGlvbih0LGUsbixyLGkpe3ZhciBvLGEscyx1LGwsYyxmLHAsZCxoLGcsdj1RLmdldCh0KTtpZih2KXtuLmhhbmRsZXImJihuPShvPW4pLmhhbmRsZXIsaT1vLnNlbGVjdG9yKSxpJiZrLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGllLGkpLG4uZ3VpZHx8KG4uZ3VpZD1rLmd1aWQrKyksKHU9di5ldmVudHMpfHwodT12LmV2ZW50cz17fSksKGE9di5oYW5kbGUpfHwoYT12LmhhbmRsZT1mdW5jdGlvbihlKXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIGsmJmsuZXZlbnQudHJpZ2dlcmVkIT09ZS50eXBlP2suZXZlbnQuZGlzcGF0Y2guYXBwbHkodCxhcmd1bWVudHMpOnZvaWQgMH0pLGw9KGU9KGV8fCIiKS5tYXRjaChSKXx8WyIiXSkubGVuZ3RoO3doaWxlKGwtLSlkPWc9KHM9RWUuZXhlYyhlW2xdKXx8W10pWzFdLGg9KHNbMl18fCIiKS5zcGxpdCgiLiIpLnNvcnQoKSxkJiYoZj1rLmV2ZW50LnNwZWNpYWxbZF18fHt9LGQ9KGk/Zi5kZWxlZ2F0ZVR5cGU6Zi5iaW5kVHlwZSl8fGQsZj1rLmV2ZW50LnNwZWNpYWxbZF18fHt9LGM9ay5leHRlbmQoe3R5cGU6ZCxvcmlnVHlwZTpnLGRhdGE6cixoYW5kbGVyOm4sZ3VpZDpuLmd1aWQsc2VsZWN0b3I6aSxuZWVkc0NvbnRleHQ6aSYmay5leHByLm1hdGNoLm5lZWRzQ29udGV4dC50ZXN0KGkpLG5hbWVzcGFjZTpoLmpvaW4oIi4iKX0sbyksKHA9dVtkXSl8fCgocD11W2RdPVtdKS5kZWxlZ2F0ZUNvdW50PTAsZi5zZXR1cCYmITEhPT1mLnNldHVwLmNhbGwodCxyLGgsYSl8fHQuYWRkRXZlbnRMaXN0ZW5lciYmdC5hZGRFdmVudExpc3RlbmVyKGQsYSkpLGYuYWRkJiYoZi5hZGQuY2FsbCh0LGMpLGMuaGFuZGxlci5ndWlkfHwoYy5oYW5kbGVyLmd1aWQ9bi5ndWlkKSksaT9wLnNwbGljZShwLmRlbGVnYXRlQ291bnQrKywwLGMpOnAucHVzaChjKSxrLmV2ZW50Lmdsb2JhbFtkXT0hMCl9fSxyZW1vdmU6ZnVuY3Rpb24oZSx0LG4scixpKXt2YXIgbyxhLHMsdSxsLGMsZixwLGQsaCxnLHY9US5oYXNEYXRhKGUpJiZRLmdldChlKTtpZih2JiYodT12LmV2ZW50cykpe2w9KHQ9KHR8fCIiKS5tYXRjaChSKXx8WyIiXSkubGVuZ3RoO3doaWxlKGwtLSlpZihkPWc9KHM9RWUuZXhlYyh0W2xdKXx8W10pWzFdLGg9KHNbMl18fCIiKS5zcGxpdCgiLiIpLnNvcnQoKSxkKXtmPWsuZXZlbnQuc3BlY2lhbFtkXXx8e30scD11W2Q9KHI/Zi5kZWxlZ2F0ZVR5cGU6Zi5iaW5kVHlwZSl8fGRdfHxbXSxzPXNbMl0mJm5ldyBSZWdFeHAoIihefFxcLikiK2guam9pbigiXFwuKD86LipcXC58KSIpKyIoXFwufCQpIiksYT1vPXAubGVuZ3RoO3doaWxlKG8tLSljPXBbb10sIWkmJmchPT1jLm9yaWdUeXBlfHxuJiZuLmd1aWQhPT1jLmd1aWR8fHMmJiFzLnRlc3QoYy5uYW1lc3BhY2UpfHxyJiZyIT09Yy5zZWxlY3RvciYmKCIqKiIhPT1yfHwhYy5zZWxlY3Rvcil8fChwLnNwbGljZShvLDEpLGMuc2VsZWN0b3ImJnAuZGVsZWdhdGVDb3VudC0tLGYucmVtb3ZlJiZmLnJlbW92ZS5jYWxsKGUsYykpO2EmJiFwLmxlbmd0aCYmKGYudGVhcmRvd24mJiExIT09Zi50ZWFyZG93bi5jYWxsKGUsaCx2LmhhbmRsZSl8fGsucmVtb3ZlRXZlbnQoZSxkLHYuaGFuZGxlKSxkZWxldGUgdVtkXSl9ZWxzZSBmb3IoZCBpbiB1KWsuZXZlbnQucmVtb3ZlKGUsZCt0W2xdLG4sciwhMCk7ay5pc0VtcHR5T2JqZWN0KHUpJiZRLnJlbW92ZShlLCJoYW5kbGUgZXZlbnRzIil9fSxkaXNwYXRjaDpmdW5jdGlvbihlKXt2YXIgdCxuLHIsaSxvLGEscz1rLmV2ZW50LmZpeChlKSx1PW5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoKSxsPShRLmdldCh0aGlzLCJldmVudHMiKXx8e30pW3MudHlwZV18fFtdLGM9ay5ldmVudC5zcGVjaWFsW3MudHlwZV18fHt9O2Zvcih1WzBdPXMsdD0xO3Q8YXJndW1lbnRzLmxlbmd0aDt0KyspdVt0XT1hcmd1bWVudHNbdF07aWYocy5kZWxlZ2F0ZVRhcmdldD10aGlzLCFjLnByZURpc3BhdGNofHwhMSE9PWMucHJlRGlzcGF0Y2guY2FsbCh0aGlzLHMpKXthPWsuZXZlbnQuaGFuZGxlcnMuY2FsbCh0aGlzLHMsbCksdD0wO3doaWxlKChpPWFbdCsrXSkmJiFzLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpe3MuY3VycmVudFRhcmdldD1pLmVsZW0sbj0wO3doaWxlKChvPWkuaGFuZGxlcnNbbisrXSkmJiFzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCkpcy5ybmFtZXNwYWNlJiYhMSE9PW8ubmFtZXNwYWNlJiYhcy5ybmFtZXNwYWNlLnRlc3Qoby5uYW1lc3BhY2UpfHwocy5oYW5kbGVPYmo9byxzLmRhdGE9by5kYXRhLHZvaWQgMCE9PShyPSgoay5ldmVudC5zcGVjaWFsW28ub3JpZ1R5cGVdfHx7fSkuaGFuZGxlfHxvLmhhbmRsZXIpLmFwcGx5KGkuZWxlbSx1KSkmJiExPT09KHMucmVzdWx0PXIpJiYocy5wcmV2ZW50RGVmYXVsdCgpLHMuc3RvcFByb3BhZ2F0aW9uKCkpKX1yZXR1cm4gYy5wb3N0RGlzcGF0Y2gmJmMucG9zdERpc3BhdGNoLmNhbGwodGhpcyxzKSxzLnJlc3VsdH19LGhhbmRsZXJzOmZ1bmN0aW9uKGUsdCl7dmFyIG4scixpLG8sYSxzPVtdLHU9dC5kZWxlZ2F0ZUNvdW50LGw9ZS50YXJnZXQ7aWYodSYmbC5ub2RlVHlwZSYmISgiY2xpY2siPT09ZS50eXBlJiYxPD1lLmJ1dHRvbikpZm9yKDtsIT09dGhpcztsPWwucGFyZW50Tm9kZXx8dGhpcylpZigxPT09bC5ub2RlVHlwZSYmKCJjbGljayIhPT1lLnR5cGV8fCEwIT09bC5kaXNhYmxlZCkpe2ZvcihvPVtdLGE9e30sbj0wO248dTtuKyspdm9pZCAwPT09YVtpPShyPXRbbl0pLnNlbGVjdG9yKyIgIl0mJihhW2ldPXIubmVlZHNDb250ZXh0Py0xPGsoaSx0aGlzKS5pbmRleChsKTprLmZpbmQoaSx0aGlzLG51bGwsW2xdKS5sZW5ndGgpLGFbaV0mJm8ucHVzaChyKTtvLmxlbmd0aCYmcy5wdXNoKHtlbGVtOmwsaGFuZGxlcnM6b30pfXJldHVybiBsPXRoaXMsdTx0Lmxlbmd0aCYmcy5wdXNoKHtlbGVtOmwsaGFuZGxlcnM6dC5zbGljZSh1KX0pLHN9LGFkZFByb3A6ZnVuY3Rpb24odCxlKXtPYmplY3QuZGVmaW5lUHJvcGVydHkoay5FdmVudC5wcm90b3R5cGUsdCx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsZ2V0Om0oZSk/ZnVuY3Rpb24oKXtpZih0aGlzLm9yaWdpbmFsRXZlbnQpcmV0dXJuIGUodGhpcy5vcmlnaW5hbEV2ZW50KX06ZnVuY3Rpb24oKXtpZih0aGlzLm9yaWdpbmFsRXZlbnQpcmV0dXJuIHRoaXMub3JpZ2luYWxFdmVudFt0XX0sc2V0OmZ1bmN0aW9uKGUpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLHQse2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOmV9KX19KX0sZml4OmZ1bmN0aW9uKGUpe3JldHVybiBlW2suZXhwYW5kb10/ZTpuZXcgay5FdmVudChlKX0sc3BlY2lhbDp7bG9hZDp7bm9CdWJibGU6ITB9LGNsaWNrOntzZXR1cDpmdW5jdGlvbihlKXt2YXIgdD10aGlzfHxlO3JldHVybiBwZS50ZXN0KHQudHlwZSkmJnQuY2xpY2smJkEodCwiaW5wdXQiKSYmRGUodCwiY2xpY2siLGtlKSwhMX0sdHJpZ2dlcjpmdW5jdGlvbihlKXt2YXIgdD10aGlzfHxlO3JldHVybiBwZS50ZXN0KHQudHlwZSkmJnQuY2xpY2smJkEodCwiaW5wdXQiKSYmRGUodCwiY2xpY2siKSwhMH0sX2RlZmF1bHQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50YXJnZXQ7cmV0dXJuIHBlLnRlc3QodC50eXBlKSYmdC5jbGljayYmQSh0LCJpbnB1dCIpJiZRLmdldCh0LCJjbGljayIpfHxBKHQsImEiKX19LGJlZm9yZXVubG9hZDp7cG9zdERpc3BhdGNoOmZ1bmN0aW9uKGUpe3ZvaWQgMCE9PWUucmVzdWx0JiZlLm9yaWdpbmFsRXZlbnQmJihlLm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWU9ZS5yZXN1bHQpfX19fSxrLnJlbW92ZUV2ZW50PWZ1bmN0aW9uKGUsdCxuKXtlLnJlbW92ZUV2ZW50TGlzdGVuZXImJmUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0LG4pfSxrLkV2ZW50PWZ1bmN0aW9uKGUsdCl7aWYoISh0aGlzIGluc3RhbmNlb2Ygay5FdmVudCkpcmV0dXJuIG5ldyBrLkV2ZW50KGUsdCk7ZSYmZS50eXBlPyh0aGlzLm9yaWdpbmFsRXZlbnQ9ZSx0aGlzLnR5cGU9ZS50eXBlLHRoaXMuaXNEZWZhdWx0UHJldmVudGVkPWUuZGVmYXVsdFByZXZlbnRlZHx8dm9pZCAwPT09ZS5kZWZhdWx0UHJldmVudGVkJiYhMT09PWUucmV0dXJuVmFsdWU/a2U6U2UsdGhpcy50YXJnZXQ9ZS50YXJnZXQmJjM9PT1lLnRhcmdldC5ub2RlVHlwZT9lLnRhcmdldC5wYXJlbnROb2RlOmUudGFyZ2V0LHRoaXMuY3VycmVudFRhcmdldD1lLmN1cnJlbnRUYXJnZXQsdGhpcy5yZWxhdGVkVGFyZ2V0PWUucmVsYXRlZFRhcmdldCk6dGhpcy50eXBlPWUsdCYmay5leHRlbmQodGhpcyx0KSx0aGlzLnRpbWVTdGFtcD1lJiZlLnRpbWVTdGFtcHx8RGF0ZS5ub3coKSx0aGlzW2suZXhwYW5kb109ITB9LGsuRXZlbnQucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjprLkV2ZW50LGlzRGVmYXVsdFByZXZlbnRlZDpTZSxpc1Byb3BhZ2F0aW9uU3RvcHBlZDpTZSxpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDpTZSxpc1NpbXVsYXRlZDohMSxwcmV2ZW50RGVmYXVsdDpmdW5jdGlvbigpe3ZhciBlPXRoaXMub3JpZ2luYWxFdmVudDt0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1rZSxlJiYhdGhpcy5pc1NpbXVsYXRlZCYmZS5wcmV2ZW50RGVmYXVsdCgpfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt2YXIgZT10aGlzLm9yaWdpbmFsRXZlbnQ7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD1rZSxlJiYhdGhpcy5pc1NpbXVsYXRlZCYmZS5zdG9wUHJvcGFnYXRpb24oKX0sc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vcmlnaW5hbEV2ZW50O3RoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9a2UsZSYmIXRoaXMuaXNTaW11bGF0ZWQmJmUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksdGhpcy5zdG9wUHJvcGFnYXRpb24oKX19LGsuZWFjaCh7YWx0S2V5OiEwLGJ1YmJsZXM6ITAsY2FuY2VsYWJsZTohMCxjaGFuZ2VkVG91Y2hlczohMCxjdHJsS2V5OiEwLGRldGFpbDohMCxldmVudFBoYXNlOiEwLG1ldGFLZXk6ITAscGFnZVg6ITAscGFnZVk6ITAsc2hpZnRLZXk6ITAsdmlldzohMCwiY2hhciI6ITAsY29kZTohMCxjaGFyQ29kZTohMCxrZXk6ITAsa2V5Q29kZTohMCxidXR0b246ITAsYnV0dG9uczohMCxjbGllbnRYOiEwLGNsaWVudFk6ITAsb2Zmc2V0WDohMCxvZmZzZXRZOiEwLHBvaW50ZXJJZDohMCxwb2ludGVyVHlwZTohMCxzY3JlZW5YOiEwLHNjcmVlblk6ITAsdGFyZ2V0VG91Y2hlczohMCx0b0VsZW1lbnQ6ITAsdG91Y2hlczohMCx3aGljaDpmdW5jdGlvbihlKXt2YXIgdD1lLmJ1dHRvbjtyZXR1cm4gbnVsbD09ZS53aGljaCYmVGUudGVzdChlLnR5cGUpP251bGwhPWUuY2hhckNvZGU/ZS5jaGFyQ29kZTplLmtleUNvZGU6IWUud2hpY2gmJnZvaWQgMCE9PXQmJkNlLnRlc3QoZS50eXBlKT8xJnQ/MToyJnQ/Mzo0JnQ/MjowOmUud2hpY2h9fSxrLmV2ZW50LmFkZFByb3ApLGsuZWFjaCh7Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0In0sZnVuY3Rpb24oZSx0KXtrLmV2ZW50LnNwZWNpYWxbZV09e3NldHVwOmZ1bmN0aW9uKCl7cmV0dXJuIERlKHRoaXMsZSxOZSksITF9LHRyaWdnZXI6ZnVuY3Rpb24oKXtyZXR1cm4gRGUodGhpcyxlKSwhMH0sZGVsZWdhdGVUeXBlOnR9fSksay5lYWNoKHttb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0Iixwb2ludGVyZW50ZXI6InBvaW50ZXJvdmVyIixwb2ludGVybGVhdmU6InBvaW50ZXJvdXQifSxmdW5jdGlvbihlLGkpe2suZXZlbnQuc3BlY2lhbFtlXT17ZGVsZWdhdGVUeXBlOmksYmluZFR5cGU6aSxoYW5kbGU6ZnVuY3Rpb24oZSl7dmFyIHQsbj1lLnJlbGF0ZWRUYXJnZXQscj1lLmhhbmRsZU9iajtyZXR1cm4gbiYmKG49PT10aGlzfHxrLmNvbnRhaW5zKHRoaXMsbikpfHwoZS50eXBlPXIub3JpZ1R5cGUsdD1yLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpLGUudHlwZT1pKSx0fX19KSxrLmZuLmV4dGVuZCh7b246ZnVuY3Rpb24oZSx0LG4scil7cmV0dXJuIEFlKHRoaXMsZSx0LG4scil9LG9uZTpmdW5jdGlvbihlLHQsbixyKXtyZXR1cm4gQWUodGhpcyxlLHQsbixyLDEpfSxvZmY6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGk7aWYoZSYmZS5wcmV2ZW50RGVmYXVsdCYmZS5oYW5kbGVPYmopcmV0dXJuIHI9ZS5oYW5kbGVPYmosayhlLmRlbGVnYXRlVGFyZ2V0KS5vZmYoci5uYW1lc3BhY2U/ci5vcmlnVHlwZSsiLiIrci5uYW1lc3BhY2U6ci5vcmlnVHlwZSxyLnNlbGVjdG9yLHIuaGFuZGxlciksdGhpcztpZigib2JqZWN0Ij09dHlwZW9mIGUpe2ZvcihpIGluIGUpdGhpcy5vZmYoaSx0LGVbaV0pO3JldHVybiB0aGlzfXJldHVybiExIT09dCYmImZ1bmN0aW9uIiE9dHlwZW9mIHR8fChuPXQsdD12b2lkIDApLCExPT09biYmKG49U2UpLHRoaXMuZWFjaChmdW5jdGlvbigpe2suZXZlbnQucmVtb3ZlKHRoaXMsZSxuLHQpfSl9fSk7dmFyIGplPS88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFthLXpdW15cL1wwPlx4MjBcdFxyXG5cZl0qKVtePl0qKVwvPi9naSxxZT0vPHNjcmlwdHw8c3R5bGV8PGxpbmsvaSxMZT0vY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSxIZT0vXlxzKjwhKD86XFtDREFUQVxbfC0tKXwoPzpcXVxdfC0tKT5ccyokL2c7ZnVuY3Rpb24gT2UoZSx0KXtyZXR1cm4gQShlLCJ0YWJsZSIpJiZBKDExIT09dC5ub2RlVHlwZT90OnQuZmlyc3RDaGlsZCwidHIiKSYmayhlKS5jaGlsZHJlbigidGJvZHkiKVswXXx8ZX1mdW5jdGlvbiBQZShlKXtyZXR1cm4gZS50eXBlPShudWxsIT09ZS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkrIi8iK2UudHlwZSxlfWZ1bmN0aW9uIFJlKGUpe3JldHVybiJ0cnVlLyI9PT0oZS50eXBlfHwiIikuc2xpY2UoMCw1KT9lLnR5cGU9ZS50eXBlLnNsaWNlKDUpOmUucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIiksZX1mdW5jdGlvbiBNZShlLHQpe3ZhciBuLHIsaSxvLGEscyx1LGw7aWYoMT09PXQubm9kZVR5cGUpe2lmKFEuaGFzRGF0YShlKSYmKG89US5hY2Nlc3MoZSksYT1RLnNldCh0LG8pLGw9by5ldmVudHMpKWZvcihpIGluIGRlbGV0ZSBhLmhhbmRsZSxhLmV2ZW50cz17fSxsKWZvcihuPTAscj1sW2ldLmxlbmd0aDtuPHI7bisrKWsuZXZlbnQuYWRkKHQsaSxsW2ldW25dKTtKLmhhc0RhdGEoZSkmJihzPUouYWNjZXNzKGUpLHU9ay5leHRlbmQoe30scyksSi5zZXQodCx1KSl9fWZ1bmN0aW9uIEllKG4scixpLG8pe3I9Zy5hcHBseShbXSxyKTt2YXIgZSx0LGEscyx1LGwsYz0wLGY9bi5sZW5ndGgscD1mLTEsZD1yWzBdLGg9bShkKTtpZihofHwxPGYmJiJzdHJpbmciPT10eXBlb2YgZCYmIXkuY2hlY2tDbG9uZSYmTGUudGVzdChkKSlyZXR1cm4gbi5lYWNoKGZ1bmN0aW9uKGUpe3ZhciB0PW4uZXEoZSk7aCYmKHJbMF09ZC5jYWxsKHRoaXMsZSx0Lmh0bWwoKSkpLEllKHQscixpLG8pfSk7aWYoZiYmKHQ9KGU9d2UocixuWzBdLm93bmVyRG9jdW1lbnQsITEsbixvKSkuZmlyc3RDaGlsZCwxPT09ZS5jaGlsZE5vZGVzLmxlbmd0aCYmKGU9dCksdHx8bykpe2ZvcihzPShhPWsubWFwKHZlKGUsInNjcmlwdCIpLFBlKSkubGVuZ3RoO2M8ZjtjKyspdT1lLGMhPT1wJiYodT1rLmNsb25lKHUsITAsITApLHMmJmsubWVyZ2UoYSx2ZSh1LCJzY3JpcHQiKSkpLGkuY2FsbChuW2NdLHUsYyk7aWYocylmb3IobD1hW2EubGVuZ3RoLTFdLm93bmVyRG9jdW1lbnQsay5tYXAoYSxSZSksYz0wO2M8cztjKyspdT1hW2NdLGhlLnRlc3QodS50eXBlfHwiIikmJiFRLmFjY2Vzcyh1LCJnbG9iYWxFdmFsIikmJmsuY29udGFpbnMobCx1KSYmKHUuc3JjJiYibW9kdWxlIiE9PSh1LnR5cGV8fCIiKS50b0xvd2VyQ2FzZSgpP2suX2V2YWxVcmwmJiF1Lm5vTW9kdWxlJiZrLl9ldmFsVXJsKHUuc3JjLHtub25jZTp1Lm5vbmNlfHx1LmdldEF0dHJpYnV0ZSgibm9uY2UiKX0pOmIodS50ZXh0Q29udGVudC5yZXBsYWNlKEhlLCIiKSx1LGwpKX1yZXR1cm4gbn1mdW5jdGlvbiBXZShlLHQsbil7Zm9yKHZhciByLGk9dD9rLmZpbHRlcih0LGUpOmUsbz0wO251bGwhPShyPWlbb10pO28rKylufHwxIT09ci5ub2RlVHlwZXx8ay5jbGVhbkRhdGEodmUocikpLHIucGFyZW50Tm9kZSYmKG4mJm9lKHIpJiZ5ZSh2ZShyLCJzY3JpcHQiKSksci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHIpKTtyZXR1cm4gZX1rLmV4dGVuZCh7aHRtbFByZWZpbHRlcjpmdW5jdGlvbihlKXtyZXR1cm4gZS5yZXBsYWNlKGplLCI8JDE+PC8kMj4iKX0sY2xvbmU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhLHMsdSxsLGM9ZS5jbG9uZU5vZGUoITApLGY9b2UoZSk7aWYoISh5Lm5vQ2xvbmVDaGVja2VkfHwxIT09ZS5ub2RlVHlwZSYmMTEhPT1lLm5vZGVUeXBlfHxrLmlzWE1MRG9jKGUpKSlmb3IoYT12ZShjKSxyPTAsaT0obz12ZShlKSkubGVuZ3RoO3I8aTtyKyspcz1vW3JdLHU9YVtyXSx2b2lkIDAsImlucHV0Ij09PShsPXUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkmJnBlLnRlc3Qocy50eXBlKT91LmNoZWNrZWQ9cy5jaGVja2VkOiJpbnB1dCIhPT1sJiYidGV4dGFyZWEiIT09bHx8KHUuZGVmYXVsdFZhbHVlPXMuZGVmYXVsdFZhbHVlKTtpZih0KWlmKG4pZm9yKG89b3x8dmUoZSksYT1hfHx2ZShjKSxyPTAsaT1vLmxlbmd0aDtyPGk7cisrKU1lKG9bcl0sYVtyXSk7ZWxzZSBNZShlLGMpO3JldHVybiAwPChhPXZlKGMsInNjcmlwdCIpKS5sZW5ndGgmJnllKGEsIWYmJnZlKGUsInNjcmlwdCIpKSxjfSxjbGVhbkRhdGE6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0LG4scixpPWsuZXZlbnQuc3BlY2lhbCxvPTA7dm9pZCAwIT09KG49ZVtvXSk7bysrKWlmKEcobikpe2lmKHQ9bltRLmV4cGFuZG9dKXtpZih0LmV2ZW50cylmb3IociBpbiB0LmV2ZW50cylpW3JdP2suZXZlbnQucmVtb3ZlKG4scik6ay5yZW1vdmVFdmVudChuLHIsdC5oYW5kbGUpO25bUS5leHBhbmRvXT12b2lkIDB9bltKLmV4cGFuZG9dJiYobltKLmV4cGFuZG9dPXZvaWQgMCl9fX0pLGsuZm4uZXh0ZW5kKHtkZXRhY2g6ZnVuY3Rpb24oZSl7cmV0dXJuIFdlKHRoaXMsZSwhMCl9LHJlbW92ZTpmdW5jdGlvbihlKXtyZXR1cm4gV2UodGhpcyxlKX0sdGV4dDpmdW5jdGlvbihlKXtyZXR1cm4gXyh0aGlzLGZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lP2sudGV4dCh0aGlzKTp0aGlzLmVtcHR5KCkuZWFjaChmdW5jdGlvbigpezEhPT10aGlzLm5vZGVUeXBlJiYxMSE9PXRoaXMubm9kZVR5cGUmJjkhPT10aGlzLm5vZGVUeXBlfHwodGhpcy50ZXh0Q29udGVudD1lKX0pfSxudWxsLGUsYXJndW1lbnRzLmxlbmd0aCl9LGFwcGVuZDpmdW5jdGlvbigpe3JldHVybiBJZSh0aGlzLGFyZ3VtZW50cyxmdW5jdGlvbihlKXsxIT09dGhpcy5ub2RlVHlwZSYmMTEhPT10aGlzLm5vZGVUeXBlJiY5IT09dGhpcy5ub2RlVHlwZXx8T2UodGhpcyxlKS5hcHBlbmRDaGlsZChlKX0pfSxwcmVwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIEllKHRoaXMsYXJndW1lbnRzLGZ1bmN0aW9uKGUpe2lmKDE9PT10aGlzLm5vZGVUeXBlfHwxMT09PXRoaXMubm9kZVR5cGV8fDk9PT10aGlzLm5vZGVUeXBlKXt2YXIgdD1PZSh0aGlzLGUpO3QuaW5zZXJ0QmVmb3JlKGUsdC5maXJzdENoaWxkKX19KX0sYmVmb3JlOmZ1bmN0aW9uKCl7cmV0dXJuIEllKHRoaXMsYXJndW1lbnRzLGZ1bmN0aW9uKGUpe3RoaXMucGFyZW50Tm9kZSYmdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLHRoaXMpfSl9LGFmdGVyOmZ1bmN0aW9uKCl7cmV0dXJuIEllKHRoaXMsYXJndW1lbnRzLGZ1bmN0aW9uKGUpe3RoaXMucGFyZW50Tm9kZSYmdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLHRoaXMubmV4dFNpYmxpbmcpfSl9LGVtcHR5OmZ1bmN0aW9uKCl7Zm9yKHZhciBlLHQ9MDtudWxsIT0oZT10aGlzW3RdKTt0KyspMT09PWUubm9kZVR5cGUmJihrLmNsZWFuRGF0YSh2ZShlLCExKSksZS50ZXh0Q29udGVudD0iIik7cmV0dXJuIHRoaXN9LGNsb25lOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU9bnVsbCE9ZSYmZSx0PW51bGw9PXQ/ZTp0LHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGsuY2xvbmUodGhpcyxlLHQpfSl9LGh0bWw6ZnVuY3Rpb24oZSl7cmV0dXJuIF8odGhpcyxmdW5jdGlvbihlKXt2YXIgdD10aGlzWzBdfHx7fSxuPTAscj10aGlzLmxlbmd0aDtpZih2b2lkIDA9PT1lJiYxPT09dC5ub2RlVHlwZSlyZXR1cm4gdC5pbm5lckhUTUw7aWYoInN0cmluZyI9PXR5cGVvZiBlJiYhcWUudGVzdChlKSYmIWdlWyhkZS5leGVjKGUpfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpXSl7ZT1rLmh0bWxQcmVmaWx0ZXIoZSk7dHJ5e2Zvcig7bjxyO24rKykxPT09KHQ9dGhpc1tuXXx8e30pLm5vZGVUeXBlJiYoay5jbGVhbkRhdGEodmUodCwhMSkpLHQuaW5uZXJIVE1MPWUpO3Q9MH1jYXRjaChlKXt9fXQmJnRoaXMuZW1wdHkoKS5hcHBlbmQoZSl9LG51bGwsZSxhcmd1bWVudHMubGVuZ3RoKX0scmVwbGFjZVdpdGg6ZnVuY3Rpb24oKXt2YXIgbj1bXTtyZXR1cm4gSWUodGhpcyxhcmd1bWVudHMsZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5wYXJlbnROb2RlO2suaW5BcnJheSh0aGlzLG4pPDAmJihrLmNsZWFuRGF0YSh2ZSh0aGlzKSksdCYmdC5yZXBsYWNlQ2hpbGQoZSx0aGlzKSl9LG4pfX0pLGsuZWFjaCh7YXBwZW5kVG86ImFwcGVuZCIscHJlcGVuZFRvOiJwcmVwZW5kIixpbnNlcnRCZWZvcmU6ImJlZm9yZSIsaW5zZXJ0QWZ0ZXI6ImFmdGVyIixyZXBsYWNlQWxsOiJyZXBsYWNlV2l0aCJ9LGZ1bmN0aW9uKGUsYSl7ay5mbltlXT1mdW5jdGlvbihlKXtmb3IodmFyIHQsbj1bXSxyPWsoZSksaT1yLmxlbmd0aC0xLG89MDtvPD1pO28rKyl0PW89PT1pP3RoaXM6dGhpcy5jbG9uZSghMCksayhyW29dKVthXSh0KSx1LmFwcGx5KG4sdC5nZXQoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKG4pfX0pO3ZhciAkZT1uZXcgUmVnRXhwKCJeKCIrdGUrIikoPyFweClbYS16JV0rJCIsImkiKSxGZT1mdW5jdGlvbihlKXt2YXIgdD1lLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7cmV0dXJuIHQmJnQub3BlbmVyfHwodD1DKSx0LmdldENvbXB1dGVkU3R5bGUoZSl9LEJlPW5ldyBSZWdFeHAocmUuam9pbigifCIpLCJpIik7ZnVuY3Rpb24gX2UoZSx0LG4pe3ZhciByLGksbyxhLHM9ZS5zdHlsZTtyZXR1cm4obj1ufHxGZShlKSkmJigiIiE9PShhPW4uZ2V0UHJvcGVydHlWYWx1ZSh0KXx8blt0XSl8fG9lKGUpfHwoYT1rLnN0eWxlKGUsdCkpLCF5LnBpeGVsQm94U3R5bGVzKCkmJiRlLnRlc3QoYSkmJkJlLnRlc3QodCkmJihyPXMud2lkdGgsaT1zLm1pbldpZHRoLG89cy5tYXhXaWR0aCxzLm1pbldpZHRoPXMubWF4V2lkdGg9cy53aWR0aD1hLGE9bi53aWR0aCxzLndpZHRoPXIscy5taW5XaWR0aD1pLHMubWF4V2lkdGg9bykpLHZvaWQgMCE9PWE/YSsiIjphfWZ1bmN0aW9uIHplKGUsdCl7cmV0dXJue2dldDpmdW5jdGlvbigpe2lmKCFlKCkpcmV0dXJuKHRoaXMuZ2V0PXQpLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtkZWxldGUgdGhpcy5nZXR9fX0hZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7aWYodSl7cy5zdHlsZS5jc3NUZXh0PSJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4O3dpZHRoOjYwcHg7bWFyZ2luLXRvcDoxcHg7cGFkZGluZzowO2JvcmRlcjowIix1LnN0eWxlLmNzc1RleHQ9InBvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O292ZXJmbG93OnNjcm9sbDttYXJnaW46YXV0bztib3JkZXI6MXB4O3BhZGRpbmc6MXB4O3dpZHRoOjYwJTt0b3A6MSUiLGllLmFwcGVuZENoaWxkKHMpLmFwcGVuZENoaWxkKHUpO3ZhciBlPUMuZ2V0Q29tcHV0ZWRTdHlsZSh1KTtuPSIxJSIhPT1lLnRvcCxhPTEyPT09dChlLm1hcmdpbkxlZnQpLHUuc3R5bGUucmlnaHQ9IjYwJSIsbz0zNj09PXQoZS5yaWdodCkscj0zNj09PXQoZS53aWR0aCksdS5zdHlsZS5wb3NpdGlvbj0iYWJzb2x1dGUiLGk9MTI9PT10KHUub2Zmc2V0V2lkdGgvMyksaWUucmVtb3ZlQ2hpbGQocyksdT1udWxsfX1mdW5jdGlvbiB0KGUpe3JldHVybiBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoZSkpfXZhciBuLHIsaSxvLGEscz1FLmNyZWF0ZUVsZW1lbnQoImRpdiIpLHU9RS5jcmVhdGVFbGVtZW50KCJkaXYiKTt1LnN0eWxlJiYodS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcD0iY29udGVudC1ib3giLHUuY2xvbmVOb2RlKCEwKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcD0iIix5LmNsZWFyQ2xvbmVTdHlsZT0iY29udGVudC1ib3giPT09dS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCxrLmV4dGVuZCh5LHtib3hTaXppbmdSZWxpYWJsZTpmdW5jdGlvbigpe3JldHVybiBlKCkscn0scGl4ZWxCb3hTdHlsZXM6ZnVuY3Rpb24oKXtyZXR1cm4gZSgpLG99LHBpeGVsUG9zaXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gZSgpLG59LHJlbGlhYmxlTWFyZ2luTGVmdDpmdW5jdGlvbigpe3JldHVybiBlKCksYX0sc2Nyb2xsYm94U2l6ZTpmdW5jdGlvbigpe3JldHVybiBlKCksaX19KSl9KCk7dmFyIFVlPVsiV2Via2l0IiwiTW96IiwibXMiXSxYZT1FLmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLFZlPXt9O2Z1bmN0aW9uIEdlKGUpe3ZhciB0PWsuY3NzUHJvcHNbZV18fFZlW2VdO3JldHVybiB0fHwoZSBpbiBYZT9lOlZlW2VdPWZ1bmN0aW9uKGUpe3ZhciB0PWVbMF0udG9VcHBlckNhc2UoKStlLnNsaWNlKDEpLG49VWUubGVuZ3RoO3doaWxlKG4tLSlpZigoZT1VZVtuXSt0KWluIFhlKXJldHVybiBlfShlKXx8ZSl9dmFyIFllPS9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLyxRZT0vXi0tLyxKZT17cG9zaXRpb246ImFic29sdXRlIix2aXNpYmlsaXR5OiJoaWRkZW4iLGRpc3BsYXk6ImJsb2NrIn0sS2U9e2xldHRlclNwYWNpbmc6IjAiLGZvbnRXZWlnaHQ6IjQwMCJ9O2Z1bmN0aW9uIFplKGUsdCxuKXt2YXIgcj1uZS5leGVjKHQpO3JldHVybiByP01hdGgubWF4KDAsclsyXS0obnx8MCkpKyhyWzNdfHwicHgiKTp0fWZ1bmN0aW9uIGV0KGUsdCxuLHIsaSxvKXt2YXIgYT0id2lkdGgiPT09dD8xOjAscz0wLHU9MDtpZihuPT09KHI/ImJvcmRlciI6ImNvbnRlbnQiKSlyZXR1cm4gMDtmb3IoO2E8NDthKz0yKSJtYXJnaW4iPT09biYmKHUrPWsuY3NzKGUsbityZVthXSwhMCxpKSkscj8oImNvbnRlbnQiPT09biYmKHUtPWsuY3NzKGUsInBhZGRpbmciK3JlW2FdLCEwLGkpKSwibWFyZ2luIiE9PW4mJih1LT1rLmNzcyhlLCJib3JkZXIiK3JlW2FdKyJXaWR0aCIsITAsaSkpKToodSs9ay5jc3MoZSwicGFkZGluZyIrcmVbYV0sITAsaSksInBhZGRpbmciIT09bj91Kz1rLmNzcyhlLCJib3JkZXIiK3JlW2FdKyJXaWR0aCIsITAsaSk6cys9ay5jc3MoZSwiYm9yZGVyIityZVthXSsiV2lkdGgiLCEwLGkpKTtyZXR1cm4hciYmMDw9byYmKHUrPU1hdGgubWF4KDAsTWF0aC5jZWlsKGVbIm9mZnNldCIrdFswXS50b1VwcGVyQ2FzZSgpK3Quc2xpY2UoMSldLW8tdS1zLS41KSl8fDApLHV9ZnVuY3Rpb24gdHQoZSx0LG4pe3ZhciByPUZlKGUpLGk9KCF5LmJveFNpemluZ1JlbGlhYmxlKCl8fG4pJiYiYm9yZGVyLWJveCI9PT1rLmNzcyhlLCJib3hTaXppbmciLCExLHIpLG89aSxhPV9lKGUsdCxyKSxzPSJvZmZzZXQiK3RbMF0udG9VcHBlckNhc2UoKSt0LnNsaWNlKDEpO2lmKCRlLnRlc3QoYSkpe2lmKCFuKXJldHVybiBhO2E9ImF1dG8ifXJldHVybigheS5ib3hTaXppbmdSZWxpYWJsZSgpJiZpfHwiYXV0byI9PT1hfHwhcGFyc2VGbG9hdChhKSYmImlubGluZSI9PT1rLmNzcyhlLCJkaXNwbGF5IiwhMSxyKSkmJmUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgmJihpPSJib3JkZXItYm94Ij09PWsuY3NzKGUsImJveFNpemluZyIsITEsciksKG89cyBpbiBlKSYmKGE9ZVtzXSkpLChhPXBhcnNlRmxvYXQoYSl8fDApK2V0KGUsdCxufHwoaT8iYm9yZGVyIjoiY29udGVudCIpLG8scixhKSsicHgifWZ1bmN0aW9uIG50KGUsdCxuLHIsaSl7cmV0dXJuIG5ldyBudC5wcm90b3R5cGUuaW5pdChlLHQsbixyLGkpfWsuZXh0ZW5kKHtjc3NIb29rczp7b3BhY2l0eTp7Z2V0OmZ1bmN0aW9uKGUsdCl7aWYodCl7dmFyIG49X2UoZSwib3BhY2l0eSIpO3JldHVybiIiPT09bj8iMSI6bn19fX0sY3NzTnVtYmVyOnthbmltYXRpb25JdGVyYXRpb25Db3VudDohMCxjb2x1bW5Db3VudDohMCxmaWxsT3BhY2l0eTohMCxmbGV4R3JvdzohMCxmbGV4U2hyaW5rOiEwLGZvbnRXZWlnaHQ6ITAsZ3JpZEFyZWE6ITAsZ3JpZENvbHVtbjohMCxncmlkQ29sdW1uRW5kOiEwLGdyaWRDb2x1bW5TdGFydDohMCxncmlkUm93OiEwLGdyaWRSb3dFbmQ6ITAsZ3JpZFJvd1N0YXJ0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcmRlcjohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6e30sc3R5bGU6ZnVuY3Rpb24oZSx0LG4scil7aWYoZSYmMyE9PWUubm9kZVR5cGUmJjghPT1lLm5vZGVUeXBlJiZlLnN0eWxlKXt2YXIgaSxvLGEscz1WKHQpLHU9UWUudGVzdCh0KSxsPWUuc3R5bGU7aWYodXx8KHQ9R2UocykpLGE9ay5jc3NIb29rc1t0XXx8ay5jc3NIb29rc1tzXSx2b2lkIDA9PT1uKXJldHVybiBhJiYiZ2V0ImluIGEmJnZvaWQgMCE9PShpPWEuZ2V0KGUsITEscikpP2k6bFt0XTsic3RyaW5nIj09PShvPXR5cGVvZiBuKSYmKGk9bmUuZXhlYyhuKSkmJmlbMV0mJihuPWxlKGUsdCxpKSxvPSJudW1iZXIiKSxudWxsIT1uJiZuPT1uJiYoIm51bWJlciIhPT1vfHx1fHwobis9aSYmaVszXXx8KGsuY3NzTnVtYmVyW3NdPyIiOiJweCIpKSx5LmNsZWFyQ2xvbmVTdHlsZXx8IiIhPT1ufHwwIT09dC5pbmRleE9mKCJiYWNrZ3JvdW5kIil8fChsW3RdPSJpbmhlcml0IiksYSYmInNldCJpbiBhJiZ2b2lkIDA9PT0obj1hLnNldChlLG4scikpfHwodT9sLnNldFByb3BlcnR5KHQsbik6bFt0XT1uKSl9fSxjc3M6ZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbyxhLHM9Vih0KTtyZXR1cm4gUWUudGVzdCh0KXx8KHQ9R2UocykpLChhPWsuY3NzSG9va3NbdF18fGsuY3NzSG9va3Nbc10pJiYiZ2V0ImluIGEmJihpPWEuZ2V0KGUsITAsbikpLHZvaWQgMD09PWkmJihpPV9lKGUsdCxyKSksIm5vcm1hbCI9PT1pJiZ0IGluIEtlJiYoaT1LZVt0XSksIiI9PT1ufHxuPyhvPXBhcnNlRmxvYXQoaSksITA9PT1ufHxpc0Zpbml0ZShvKT9vfHwwOmkpOml9fSksay5lYWNoKFsiaGVpZ2h0Iiwid2lkdGgiXSxmdW5jdGlvbihlLHUpe2suY3NzSG9va3NbdV09e2dldDpmdW5jdGlvbihlLHQsbil7aWYodClyZXR1cm4hWWUudGVzdChrLmNzcyhlLCJkaXNwbGF5IikpfHxlLmdldENsaWVudFJlY3RzKCkubGVuZ3RoJiZlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoP3R0KGUsdSxuKTp1ZShlLEplLGZ1bmN0aW9uKCl7cmV0dXJuIHR0KGUsdSxuKX0pfSxzZXQ6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGk9RmUoZSksbz0heS5zY3JvbGxib3hTaXplKCkmJiJhYnNvbHV0ZSI9PT1pLnBvc2l0aW9uLGE9KG98fG4pJiYiYm9yZGVyLWJveCI9PT1rLmNzcyhlLCJib3hTaXppbmciLCExLGkpLHM9bj9ldChlLHUsbixhLGkpOjA7cmV0dXJuIGEmJm8mJihzLT1NYXRoLmNlaWwoZVsib2Zmc2V0Iit1WzBdLnRvVXBwZXJDYXNlKCkrdS5zbGljZSgxKV0tcGFyc2VGbG9hdChpW3VdKS1ldChlLHUsImJvcmRlciIsITEsaSktLjUpKSxzJiYocj1uZS5leGVjKHQpKSYmInB4IiE9PShyWzNdfHwicHgiKSYmKGUuc3R5bGVbdV09dCx0PWsuY3NzKGUsdSkpLFplKDAsdCxzKX19fSksay5jc3NIb29rcy5tYXJnaW5MZWZ0PXplKHkucmVsaWFibGVNYXJnaW5MZWZ0LGZ1bmN0aW9uKGUsdCl7aWYodClyZXR1cm4ocGFyc2VGbG9hdChfZShlLCJtYXJnaW5MZWZ0IikpfHxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQtdWUoZSx7bWFyZ2luTGVmdDowfSxmdW5jdGlvbigpe3JldHVybiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnR9KSkrInB4In0pLGsuZWFjaCh7bWFyZ2luOiIiLHBhZGRpbmc6IiIsYm9yZGVyOiJXaWR0aCJ9LGZ1bmN0aW9uKGksbyl7ay5jc3NIb29rc1tpK29dPXtleHBhbmQ6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTAsbj17fSxyPSJzdHJpbmciPT10eXBlb2YgZT9lLnNwbGl0KCIgIik6W2VdO3Q8NDt0KyspbltpK3JlW3RdK29dPXJbdF18fHJbdC0yXXx8clswXTtyZXR1cm4gbn19LCJtYXJnaW4iIT09aSYmKGsuY3NzSG9va3NbaStvXS5zZXQ9WmUpfSksay5mbi5leHRlbmQoe2NzczpmdW5jdGlvbihlLHQpe3JldHVybiBfKHRoaXMsZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbz17fSxhPTA7aWYoQXJyYXkuaXNBcnJheSh0KSl7Zm9yKHI9RmUoZSksaT10Lmxlbmd0aDthPGk7YSsrKW9bdFthXV09ay5jc3MoZSx0W2FdLCExLHIpO3JldHVybiBvfXJldHVybiB2b2lkIDAhPT1uP2suc3R5bGUoZSx0LG4pOmsuY3NzKGUsdCl9LGUsdCwxPGFyZ3VtZW50cy5sZW5ndGgpfX0pLCgoay5Ud2Vlbj1udCkucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpudCxpbml0OmZ1bmN0aW9uKGUsdCxuLHIsaSxvKXt0aGlzLmVsZW09ZSx0aGlzLnByb3A9bix0aGlzLmVhc2luZz1pfHxrLmVhc2luZy5fZGVmYXVsdCx0aGlzLm9wdGlvbnM9dCx0aGlzLnN0YXJ0PXRoaXMubm93PXRoaXMuY3VyKCksdGhpcy5lbmQ9cix0aGlzLnVuaXQ9b3x8KGsuY3NzTnVtYmVyW25dPyIiOiJweCIpfSxjdXI6ZnVuY3Rpb24oKXt2YXIgZT1udC5wcm9wSG9va3NbdGhpcy5wcm9wXTtyZXR1cm4gZSYmZS5nZXQ/ZS5nZXQodGhpcyk6bnQucHJvcEhvb2tzLl9kZWZhdWx0LmdldCh0aGlzKX0scnVuOmZ1bmN0aW9uKGUpe3ZhciB0LG49bnQucHJvcEhvb2tzW3RoaXMucHJvcF07cmV0dXJuIHRoaXMub3B0aW9ucy5kdXJhdGlvbj90aGlzLnBvcz10PWsuZWFzaW5nW3RoaXMuZWFzaW5nXShlLHRoaXMub3B0aW9ucy5kdXJhdGlvbiplLDAsMSx0aGlzLm9wdGlvbnMuZHVyYXRpb24pOnRoaXMucG9zPXQ9ZSx0aGlzLm5vdz0odGhpcy5lbmQtdGhpcy5zdGFydCkqdCt0aGlzLnN0YXJ0LHRoaXMub3B0aW9ucy5zdGVwJiZ0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKHRoaXMuZWxlbSx0aGlzLm5vdyx0aGlzKSxuJiZuLnNldD9uLnNldCh0aGlzKTpudC5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KHRoaXMpLHRoaXN9fSkuaW5pdC5wcm90b3R5cGU9bnQucHJvdG90eXBlLChudC5wcm9wSG9va3M9e19kZWZhdWx0OntnZXQ6ZnVuY3Rpb24oZSl7dmFyIHQ7cmV0dXJuIDEhPT1lLmVsZW0ubm9kZVR5cGV8fG51bGwhPWUuZWxlbVtlLnByb3BdJiZudWxsPT1lLmVsZW0uc3R5bGVbZS5wcm9wXT9lLmVsZW1bZS5wcm9wXToodD1rLmNzcyhlLmVsZW0sZS5wcm9wLCIiKSkmJiJhdXRvIiE9PXQ/dDowfSxzZXQ6ZnVuY3Rpb24oZSl7ay5meC5zdGVwW2UucHJvcF0/ay5meC5zdGVwW2UucHJvcF0oZSk6MSE9PWUuZWxlbS5ub2RlVHlwZXx8IWsuY3NzSG9va3NbZS5wcm9wXSYmbnVsbD09ZS5lbGVtLnN0eWxlW0dlKGUucHJvcCldP2UuZWxlbVtlLnByb3BdPWUubm93Omsuc3R5bGUoZS5lbGVtLGUucHJvcCxlLm5vdytlLnVuaXQpfX19KS5zY3JvbGxUb3A9bnQucHJvcEhvb2tzLnNjcm9sbExlZnQ9e3NldDpmdW5jdGlvbihlKXtlLmVsZW0ubm9kZVR5cGUmJmUuZWxlbS5wYXJlbnROb2RlJiYoZS5lbGVtW2UucHJvcF09ZS5ub3cpfX0say5lYXNpbmc9e2xpbmVhcjpmdW5jdGlvbihlKXtyZXR1cm4gZX0sc3dpbmc6ZnVuY3Rpb24oZSl7cmV0dXJuLjUtTWF0aC5jb3MoZSpNYXRoLlBJKS8yfSxfZGVmYXVsdDoic3dpbmcifSxrLmZ4PW50LnByb3RvdHlwZS5pbml0LGsuZnguc3RlcD17fTt2YXIgcnQsaXQsb3QsYXQsc3Q9L14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLHV0PS9xdWV1ZUhvb2tzJC87ZnVuY3Rpb24gbHQoKXtpdCYmKCExPT09RS5oaWRkZW4mJkMucmVxdWVzdEFuaW1hdGlvbkZyYW1lP0MucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGx0KTpDLnNldFRpbWVvdXQobHQsay5meC5pbnRlcnZhbCksay5meC50aWNrKCkpfWZ1bmN0aW9uIGN0KCl7cmV0dXJuIEMuc2V0VGltZW91dChmdW5jdGlvbigpe3J0PXZvaWQgMH0pLHJ0PURhdGUubm93KCl9ZnVuY3Rpb24gZnQoZSx0KXt2YXIgbixyPTAsaT17aGVpZ2h0OmV9O2Zvcih0PXQ/MTowO3I8NDtyKz0yLXQpaVsibWFyZ2luIisobj1yZVtyXSldPWlbInBhZGRpbmciK25dPWU7cmV0dXJuIHQmJihpLm9wYWNpdHk9aS53aWR0aD1lKSxpfWZ1bmN0aW9uIHB0KGUsdCxuKXtmb3IodmFyIHIsaT0oZHQudHdlZW5lcnNbdF18fFtdKS5jb25jYXQoZHQudHdlZW5lcnNbIioiXSksbz0wLGE9aS5sZW5ndGg7bzxhO28rKylpZihyPWlbb10uY2FsbChuLHQsZSkpcmV0dXJuIHJ9ZnVuY3Rpb24gZHQobyxlLHQpe3ZhciBuLGEscj0wLGk9ZHQucHJlZmlsdGVycy5sZW5ndGgscz1rLkRlZmVycmVkKCkuYWx3YXlzKGZ1bmN0aW9uKCl7ZGVsZXRlIHUuZWxlbX0pLHU9ZnVuY3Rpb24oKXtpZihhKXJldHVybiExO2Zvcih2YXIgZT1ydHx8Y3QoKSx0PU1hdGgubWF4KDAsbC5zdGFydFRpbWUrbC5kdXJhdGlvbi1lKSxuPTEtKHQvbC5kdXJhdGlvbnx8MCkscj0wLGk9bC50d2VlbnMubGVuZ3RoO3I8aTtyKyspbC50d2VlbnNbcl0ucnVuKG4pO3JldHVybiBzLm5vdGlmeVdpdGgobyxbbCxuLHRdKSxuPDEmJmk/dDooaXx8cy5ub3RpZnlXaXRoKG8sW2wsMSwwXSkscy5yZXNvbHZlV2l0aChvLFtsXSksITEpfSxsPXMucHJvbWlzZSh7ZWxlbTpvLHByb3BzOmsuZXh0ZW5kKHt9LGUpLG9wdHM6ay5leHRlbmQoITAse3NwZWNpYWxFYXNpbmc6e30sZWFzaW5nOmsuZWFzaW5nLl9kZWZhdWx0fSx0KSxvcmlnaW5hbFByb3BlcnRpZXM6ZSxvcmlnaW5hbE9wdGlvbnM6dCxzdGFydFRpbWU6cnR8fGN0KCksZHVyYXRpb246dC5kdXJhdGlvbix0d2VlbnM6W10sY3JlYXRlVHdlZW46ZnVuY3Rpb24oZSx0KXt2YXIgbj1rLlR3ZWVuKG8sbC5vcHRzLGUsdCxsLm9wdHMuc3BlY2lhbEVhc2luZ1tlXXx8bC5vcHRzLmVhc2luZyk7cmV0dXJuIGwudHdlZW5zLnB1c2gobiksbn0sc3RvcDpmdW5jdGlvbihlKXt2YXIgdD0wLG49ZT9sLnR3ZWVucy5sZW5ndGg6MDtpZihhKXJldHVybiB0aGlzO2ZvcihhPSEwO3Q8bjt0KyspbC50d2VlbnNbdF0ucnVuKDEpO3JldHVybiBlPyhzLm5vdGlmeVdpdGgobyxbbCwxLDBdKSxzLnJlc29sdmVXaXRoKG8sW2wsZV0pKTpzLnJlamVjdFdpdGgobyxbbCxlXSksdGhpc319KSxjPWwucHJvcHM7Zm9yKCFmdW5jdGlvbihlLHQpe3ZhciBuLHIsaSxvLGE7Zm9yKG4gaW4gZSlpZihpPXRbcj1WKG4pXSxvPWVbbl0sQXJyYXkuaXNBcnJheShvKSYmKGk9b1sxXSxvPWVbbl09b1swXSksbiE9PXImJihlW3JdPW8sZGVsZXRlIGVbbl0pLChhPWsuY3NzSG9va3Nbcl0pJiYiZXhwYW5kImluIGEpZm9yKG4gaW4gbz1hLmV4cGFuZChvKSxkZWxldGUgZVtyXSxvKW4gaW4gZXx8KGVbbl09b1tuXSx0W25dPWkpO2Vsc2UgdFtyXT1pfShjLGwub3B0cy5zcGVjaWFsRWFzaW5nKTtyPGk7cisrKWlmKG49ZHQucHJlZmlsdGVyc1tyXS5jYWxsKGwsbyxjLGwub3B0cykpcmV0dXJuIG0obi5zdG9wKSYmKGsuX3F1ZXVlSG9va3MobC5lbGVtLGwub3B0cy5xdWV1ZSkuc3RvcD1uLnN0b3AuYmluZChuKSksbjtyZXR1cm4gay5tYXAoYyxwdCxsKSxtKGwub3B0cy5zdGFydCkmJmwub3B0cy5zdGFydC5jYWxsKG8sbCksbC5wcm9ncmVzcyhsLm9wdHMucHJvZ3Jlc3MpLmRvbmUobC5vcHRzLmRvbmUsbC5vcHRzLmNvbXBsZXRlKS5mYWlsKGwub3B0cy5mYWlsKS5hbHdheXMobC5vcHRzLmFsd2F5cyksay5meC50aW1lcihrLmV4dGVuZCh1LHtlbGVtOm8sYW5pbTpsLHF1ZXVlOmwub3B0cy5xdWV1ZX0pKSxsfWsuQW5pbWF0aW9uPWsuZXh0ZW5kKGR0LHt0d2VlbmVyczp7IioiOltmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXMuY3JlYXRlVHdlZW4oZSx0KTtyZXR1cm4gbGUobi5lbGVtLGUsbmUuZXhlYyh0KSxuKSxufV19LHR3ZWVuZXI6ZnVuY3Rpb24oZSx0KXttKGUpPyh0PWUsZT1bIioiXSk6ZT1lLm1hdGNoKFIpO2Zvcih2YXIgbixyPTAsaT1lLmxlbmd0aDtyPGk7cisrKW49ZVtyXSxkdC50d2VlbmVyc1tuXT1kdC50d2VlbmVyc1tuXXx8W10sZHQudHdlZW5lcnNbbl0udW5zaGlmdCh0KX0scHJlZmlsdGVyczpbZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhLHMsdSxsLGMsZj0id2lkdGgiaW4gdHx8ImhlaWdodCJpbiB0LHA9dGhpcyxkPXt9LGg9ZS5zdHlsZSxnPWUubm9kZVR5cGUmJnNlKGUpLHY9US5nZXQoZSwiZnhzaG93Iik7Zm9yKHIgaW4gbi5xdWV1ZXx8KG51bGw9PShhPWsuX3F1ZXVlSG9va3MoZSwiZngiKSkudW5xdWV1ZWQmJihhLnVucXVldWVkPTAscz1hLmVtcHR5LmZpcmUsYS5lbXB0eS5maXJlPWZ1bmN0aW9uKCl7YS51bnF1ZXVlZHx8cygpfSksYS51bnF1ZXVlZCsrLHAuYWx3YXlzKGZ1bmN0aW9uKCl7cC5hbHdheXMoZnVuY3Rpb24oKXthLnVucXVldWVkLS0say5xdWV1ZShlLCJmeCIpLmxlbmd0aHx8YS5lbXB0eS5maXJlKCl9KX0pKSx0KWlmKGk9dFtyXSxzdC50ZXN0KGkpKXtpZihkZWxldGUgdFtyXSxvPW98fCJ0b2dnbGUiPT09aSxpPT09KGc/ImhpZGUiOiJzaG93Iikpe2lmKCJzaG93IiE9PWl8fCF2fHx2b2lkIDA9PT12W3JdKWNvbnRpbnVlO2c9ITB9ZFtyXT12JiZ2W3JdfHxrLnN0eWxlKGUscil9aWYoKHU9IWsuaXNFbXB0eU9iamVjdCh0KSl8fCFrLmlzRW1wdHlPYmplY3QoZCkpZm9yKHIgaW4gZiYmMT09PWUubm9kZVR5cGUmJihuLm92ZXJmbG93PVtoLm92ZXJmbG93LGgub3ZlcmZsb3dYLGgub3ZlcmZsb3dZXSxudWxsPT0obD12JiZ2LmRpc3BsYXkpJiYobD1RLmdldChlLCJkaXNwbGF5IikpLCJub25lIj09PShjPWsuY3NzKGUsImRpc3BsYXkiKSkmJihsP2M9bDooZmUoW2VdLCEwKSxsPWUuc3R5bGUuZGlzcGxheXx8bCxjPWsuY3NzKGUsImRpc3BsYXkiKSxmZShbZV0pKSksKCJpbmxpbmUiPT09Y3x8ImlubGluZS1ibG9jayI9PT1jJiZudWxsIT1sKSYmIm5vbmUiPT09ay5jc3MoZSwiZmxvYXQiKSYmKHV8fChwLmRvbmUoZnVuY3Rpb24oKXtoLmRpc3BsYXk9bH0pLG51bGw9PWwmJihjPWguZGlzcGxheSxsPSJub25lIj09PWM/IiI6YykpLGguZGlzcGxheT0iaW5saW5lLWJsb2NrIikpLG4ub3ZlcmZsb3cmJihoLm92ZXJmbG93PSJoaWRkZW4iLHAuYWx3YXlzKGZ1bmN0aW9uKCl7aC5vdmVyZmxvdz1uLm92ZXJmbG93WzBdLGgub3ZlcmZsb3dYPW4ub3ZlcmZsb3dbMV0saC5vdmVyZmxvd1k9bi5vdmVyZmxvd1syXX0pKSx1PSExLGQpdXx8KHY/ImhpZGRlbiJpbiB2JiYoZz12LmhpZGRlbik6dj1RLmFjY2VzcyhlLCJmeHNob3ciLHtkaXNwbGF5Omx9KSxvJiYodi5oaWRkZW49IWcpLGcmJmZlKFtlXSwhMCkscC5kb25lKGZ1bmN0aW9uKCl7Zm9yKHIgaW4gZ3x8ZmUoW2VdKSxRLnJlbW92ZShlLCJmeHNob3ciKSxkKWsuc3R5bGUoZSxyLGRbcl0pfSkpLHU9cHQoZz92W3JdOjAscixwKSxyIGluIHZ8fCh2W3JdPXUuc3RhcnQsZyYmKHUuZW5kPXUuc3RhcnQsdS5zdGFydD0wKSl9XSxwcmVmaWx0ZXI6ZnVuY3Rpb24oZSx0KXt0P2R0LnByZWZpbHRlcnMudW5zaGlmdChlKTpkdC5wcmVmaWx0ZXJzLnB1c2goZSl9fSksay5zcGVlZD1mdW5jdGlvbihlLHQsbil7dmFyIHI9ZSYmIm9iamVjdCI9PXR5cGVvZiBlP2suZXh0ZW5kKHt9LGUpOntjb21wbGV0ZTpufHwhbiYmdHx8bShlKSYmZSxkdXJhdGlvbjplLGVhc2luZzpuJiZ0fHx0JiYhbSh0KSYmdH07cmV0dXJuIGsuZngub2ZmP3IuZHVyYXRpb249MDoibnVtYmVyIiE9dHlwZW9mIHIuZHVyYXRpb24mJihyLmR1cmF0aW9uIGluIGsuZnguc3BlZWRzP3IuZHVyYXRpb249ay5meC5zcGVlZHNbci5kdXJhdGlvbl06ci5kdXJhdGlvbj1rLmZ4LnNwZWVkcy5fZGVmYXVsdCksbnVsbCE9ci5xdWV1ZSYmITAhPT1yLnF1ZXVlfHwoci5xdWV1ZT0iZngiKSxyLm9sZD1yLmNvbXBsZXRlLHIuY29tcGxldGU9ZnVuY3Rpb24oKXttKHIub2xkKSYmci5vbGQuY2FsbCh0aGlzKSxyLnF1ZXVlJiZrLmRlcXVldWUodGhpcyxyLnF1ZXVlKX0scn0say5mbi5leHRlbmQoe2ZhZGVUbzpmdW5jdGlvbihlLHQsbixyKXtyZXR1cm4gdGhpcy5maWx0ZXIoc2UpLmNzcygib3BhY2l0eSIsMCkuc2hvdygpLmVuZCgpLmFuaW1hdGUoe29wYWNpdHk6dH0sZSxuLHIpfSxhbmltYXRlOmZ1bmN0aW9uKHQsZSxuLHIpe3ZhciBpPWsuaXNFbXB0eU9iamVjdCh0KSxvPWsuc3BlZWQoZSxuLHIpLGE9ZnVuY3Rpb24oKXt2YXIgZT1kdCh0aGlzLGsuZXh0ZW5kKHt9LHQpLG8pOyhpfHxRLmdldCh0aGlzLCJmaW5pc2giKSkmJmUuc3RvcCghMCl9O3JldHVybiBhLmZpbmlzaD1hLGl8fCExPT09by5xdWV1ZT90aGlzLmVhY2goYSk6dGhpcy5xdWV1ZShvLnF1ZXVlLGEpfSxzdG9wOmZ1bmN0aW9uKGksZSxvKXt2YXIgYT1mdW5jdGlvbihlKXt2YXIgdD1lLnN0b3A7ZGVsZXRlIGUuc3RvcCx0KG8pfTtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGkmJihvPWUsZT1pLGk9dm9pZCAwKSxlJiYhMSE9PWkmJnRoaXMucXVldWUoaXx8ImZ4IixbXSksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9ITAsdD1udWxsIT1pJiZpKyJxdWV1ZUhvb2tzIixuPWsudGltZXJzLHI9US5nZXQodGhpcyk7aWYodClyW3RdJiZyW3RdLnN0b3AmJmEoclt0XSk7ZWxzZSBmb3IodCBpbiByKXJbdF0mJnJbdF0uc3RvcCYmdXQudGVzdCh0KSYmYShyW3RdKTtmb3IodD1uLmxlbmd0aDt0LS07KW5bdF0uZWxlbSE9PXRoaXN8fG51bGwhPWkmJm5bdF0ucXVldWUhPT1pfHwoblt0XS5hbmltLnN0b3AobyksZT0hMSxuLnNwbGljZSh0LDEpKTshZSYmb3x8ay5kZXF1ZXVlKHRoaXMsaSl9KX0sZmluaXNoOmZ1bmN0aW9uKGEpe3JldHVybiExIT09YSYmKGE9YXx8ImZ4IiksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGUsdD1RLmdldCh0aGlzKSxuPXRbYSsicXVldWUiXSxyPXRbYSsicXVldWVIb29rcyJdLGk9ay50aW1lcnMsbz1uP24ubGVuZ3RoOjA7Zm9yKHQuZmluaXNoPSEwLGsucXVldWUodGhpcyxhLFtdKSxyJiZyLnN0b3AmJnIuc3RvcC5jYWxsKHRoaXMsITApLGU9aS5sZW5ndGg7ZS0tOylpW2VdLmVsZW09PT10aGlzJiZpW2VdLnF1ZXVlPT09YSYmKGlbZV0uYW5pbS5zdG9wKCEwKSxpLnNwbGljZShlLDEpKTtmb3IoZT0wO2U8bztlKyspbltlXSYmbltlXS5maW5pc2gmJm5bZV0uZmluaXNoLmNhbGwodGhpcyk7ZGVsZXRlIHQuZmluaXNofSl9fSksay5lYWNoKFsidG9nZ2xlIiwic2hvdyIsImhpZGUiXSxmdW5jdGlvbihlLHIpe3ZhciBpPWsuZm5bcl07ay5mbltyXT1mdW5jdGlvbihlLHQsbil7cmV0dXJuIG51bGw9PWV8fCJib29sZWFuIj09dHlwZW9mIGU/aS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dGhpcy5hbmltYXRlKGZ0KHIsITApLGUsdCxuKX19KSxrLmVhY2goe3NsaWRlRG93bjpmdCgic2hvdyIpLHNsaWRlVXA6ZnQoImhpZGUiKSxzbGlkZVRvZ2dsZTpmdCgidG9nZ2xlIiksZmFkZUluOntvcGFjaXR5OiJzaG93In0sZmFkZU91dDp7b3BhY2l0eToiaGlkZSJ9LGZhZGVUb2dnbGU6e29wYWNpdHk6InRvZ2dsZSJ9fSxmdW5jdGlvbihlLHIpe2suZm5bZV09ZnVuY3Rpb24oZSx0LG4pe3JldHVybiB0aGlzLmFuaW1hdGUocixlLHQsbil9fSksay50aW1lcnM9W10say5meC50aWNrPWZ1bmN0aW9uKCl7dmFyIGUsdD0wLG49ay50aW1lcnM7Zm9yKHJ0PURhdGUubm93KCk7dDxuLmxlbmd0aDt0KyspKGU9blt0XSkoKXx8blt0XSE9PWV8fG4uc3BsaWNlKHQtLSwxKTtuLmxlbmd0aHx8ay5meC5zdG9wKCkscnQ9dm9pZCAwfSxrLmZ4LnRpbWVyPWZ1bmN0aW9uKGUpe2sudGltZXJzLnB1c2goZSksay5meC5zdGFydCgpfSxrLmZ4LmludGVydmFsPTEzLGsuZnguc3RhcnQ9ZnVuY3Rpb24oKXtpdHx8KGl0PSEwLGx0KCkpfSxrLmZ4LnN0b3A9ZnVuY3Rpb24oKXtpdD1udWxsfSxrLmZ4LnNwZWVkcz17c2xvdzo2MDAsZmFzdDoyMDAsX2RlZmF1bHQ6NDAwfSxrLmZuLmRlbGF5PWZ1bmN0aW9uKHIsZSl7cmV0dXJuIHI9ay5meCYmay5meC5zcGVlZHNbcl18fHIsZT1lfHwiZngiLHRoaXMucXVldWUoZSxmdW5jdGlvbihlLHQpe3ZhciBuPUMuc2V0VGltZW91dChlLHIpO3Quc3RvcD1mdW5jdGlvbigpe0MuY2xlYXJUaW1lb3V0KG4pfX0pfSxvdD1FLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksYXQ9RS5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKS5hcHBlbmRDaGlsZChFLmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKSxvdC50eXBlPSJjaGVja2JveCIseS5jaGVja09uPSIiIT09b3QudmFsdWUseS5vcHRTZWxlY3RlZD1hdC5zZWxlY3RlZCwob3Q9RS5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKS52YWx1ZT0idCIsb3QudHlwZT0icmFkaW8iLHkucmFkaW9WYWx1ZT0idCI9PT1vdC52YWx1ZTt2YXIgaHQsZ3Q9ay5leHByLmF0dHJIYW5kbGU7ay5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gXyh0aGlzLGsuYXR0cixlLHQsMTxhcmd1bWVudHMubGVuZ3RoKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ay5yZW1vdmVBdHRyKHRoaXMsZSl9KX19KSxrLmV4dGVuZCh7YXR0cjpmdW5jdGlvbihlLHQsbil7dmFyIHIsaSxvPWUubm9kZVR5cGU7aWYoMyE9PW8mJjghPT1vJiYyIT09bylyZXR1cm4idW5kZWZpbmVkIj09dHlwZW9mIGUuZ2V0QXR0cmlidXRlP2sucHJvcChlLHQsbik6KDE9PT1vJiZrLmlzWE1MRG9jKGUpfHwoaT1rLmF0dHJIb29rc1t0LnRvTG93ZXJDYXNlKCldfHwoay5leHByLm1hdGNoLmJvb2wudGVzdCh0KT9odDp2b2lkIDApKSx2b2lkIDAhPT1uP251bGw9PT1uP3ZvaWQgay5yZW1vdmVBdHRyKGUsdCk6aSYmInNldCJpbiBpJiZ2b2lkIDAhPT0ocj1pLnNldChlLG4sdCkpP3I6KGUuc2V0QXR0cmlidXRlKHQsbisiIiksbik6aSYmImdldCJpbiBpJiZudWxsIT09KHI9aS5nZXQoZSx0KSk/cjpudWxsPT0ocj1rLmZpbmQuYXR0cihlLHQpKT92b2lkIDA6cil9LGF0dHJIb29rczp7dHlwZTp7c2V0OmZ1bmN0aW9uKGUsdCl7aWYoIXkucmFkaW9WYWx1ZSYmInJhZGlvIj09PXQmJkEoZSwiaW5wdXQiKSl7dmFyIG49ZS52YWx1ZTtyZXR1cm4gZS5zZXRBdHRyaWJ1dGUoInR5cGUiLHQpLG4mJihlLnZhbHVlPW4pLHR9fX19LHJlbW92ZUF0dHI6ZnVuY3Rpb24oZSx0KXt2YXIgbixyPTAsaT10JiZ0Lm1hdGNoKFIpO2lmKGkmJjE9PT1lLm5vZGVUeXBlKXdoaWxlKG49aVtyKytdKWUucmVtb3ZlQXR0cmlidXRlKG4pfX0pLGh0PXtzZXQ6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiExPT09dD9rLnJlbW92ZUF0dHIoZSxuKTplLnNldEF0dHJpYnV0ZShuLG4pLG59fSxrLmVhY2goay5leHByLm1hdGNoLmJvb2wuc291cmNlLm1hdGNoKC9cdysvZyksZnVuY3Rpb24oZSx0KXt2YXIgYT1ndFt0XXx8ay5maW5kLmF0dHI7Z3RbdF09ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbz10LnRvTG93ZXJDYXNlKCk7cmV0dXJuIG58fChpPWd0W29dLGd0W29dPXIscj1udWxsIT1hKGUsdCxuKT9vOm51bGwsZ3Rbb109aSkscn19KTt2YXIgdnQ9L14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSx5dD0vXig/OmF8YXJlYSkkL2k7ZnVuY3Rpb24gbXQoZSl7cmV0dXJuKGUubWF0Y2goUil8fFtdKS5qb2luKCIgIil9ZnVuY3Rpb24geHQoZSl7cmV0dXJuIGUuZ2V0QXR0cmlidXRlJiZlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiJ9ZnVuY3Rpb24gYnQoZSl7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSk/ZToic3RyaW5nIj09dHlwZW9mIGUmJmUubWF0Y2goUil8fFtdfWsuZm4uZXh0ZW5kKHtwcm9wOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIF8odGhpcyxrLnByb3AsZSx0LDE8YXJndW1lbnRzLmxlbmd0aCl9LHJlbW92ZVByb3A6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2RlbGV0ZSB0aGlzW2sucHJvcEZpeFtlXXx8ZV19KX19KSxrLmV4dGVuZCh7cHJvcDpmdW5jdGlvbihlLHQsbil7dmFyIHIsaSxvPWUubm9kZVR5cGU7aWYoMyE9PW8mJjghPT1vJiYyIT09bylyZXR1cm4gMT09PW8mJmsuaXNYTUxEb2MoZSl8fCh0PWsucHJvcEZpeFt0XXx8dCxpPWsucHJvcEhvb2tzW3RdKSx2b2lkIDAhPT1uP2kmJiJzZXQiaW4gaSYmdm9pZCAwIT09KHI9aS5zZXQoZSxuLHQpKT9yOmVbdF09bjppJiYiZ2V0ImluIGkmJm51bGwhPT0ocj1pLmdldChlLHQpKT9yOmVbdF19LHByb3BIb29rczp7dGFiSW5kZXg6e2dldDpmdW5jdGlvbihlKXt2YXIgdD1rLmZpbmQuYXR0cihlLCJ0YWJpbmRleCIpO3JldHVybiB0P3BhcnNlSW50KHQsMTApOnZ0LnRlc3QoZS5ub2RlTmFtZSl8fHl0LnRlc3QoZS5ub2RlTmFtZSkmJmUuaHJlZj8wOi0xfX19LHByb3BGaXg6eyJmb3IiOiJodG1sRm9yIiwiY2xhc3MiOiJjbGFzc05hbWUifX0pLHkub3B0U2VsZWN0ZWR8fChrLnByb3BIb29rcy5zZWxlY3RlZD17Z2V0OmZ1bmN0aW9uKGUpe3ZhciB0PWUucGFyZW50Tm9kZTtyZXR1cm4gdCYmdC5wYXJlbnROb2RlJiZ0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCxudWxsfSxzZXQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wYXJlbnROb2RlO3QmJih0LnNlbGVjdGVkSW5kZXgsdC5wYXJlbnROb2RlJiZ0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCl9fSksay5lYWNoKFsidGFiSW5kZXgiLCJyZWFkT25seSIsIm1heExlbmd0aCIsImNlbGxTcGFjaW5nIiwiY2VsbFBhZGRpbmciLCJyb3dTcGFuIiwiY29sU3BhbiIsInVzZU1hcCIsImZyYW1lQm9yZGVyIiwiY29udGVudEVkaXRhYmxlIl0sZnVuY3Rpb24oKXtrLnByb3BGaXhbdGhpcy50b0xvd2VyQ2FzZSgpXT10aGlzfSksay5mbi5leHRlbmQoe2FkZENsYXNzOmZ1bmN0aW9uKHQpe3ZhciBlLG4scixpLG8sYSxzLHU9MDtpZihtKHQpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZSl7ayh0aGlzKS5hZGRDbGFzcyh0LmNhbGwodGhpcyxlLHh0KHRoaXMpKSl9KTtpZigoZT1idCh0KSkubGVuZ3RoKXdoaWxlKG49dGhpc1t1KytdKWlmKGk9eHQobikscj0xPT09bi5ub2RlVHlwZSYmIiAiK210KGkpKyIgIil7YT0wO3doaWxlKG89ZVthKytdKXIuaW5kZXhPZigiICIrbysiICIpPDAmJihyKz1vKyIgIik7aSE9PShzPW10KHIpKSYmbi5zZXRBdHRyaWJ1dGUoImNsYXNzIixzKX1yZXR1cm4gdGhpc30scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24odCl7dmFyIGUsbixyLGksbyxhLHMsdT0wO2lmKG0odCkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihlKXtrKHRoaXMpLnJlbW92ZUNsYXNzKHQuY2FsbCh0aGlzLGUseHQodGhpcykpKX0pO2lmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiB0aGlzLmF0dHIoImNsYXNzIiwiIik7aWYoKGU9YnQodCkpLmxlbmd0aCl3aGlsZShuPXRoaXNbdSsrXSlpZihpPXh0KG4pLHI9MT09PW4ubm9kZVR5cGUmJiIgIittdChpKSsiICIpe2E9MDt3aGlsZShvPWVbYSsrXSl3aGlsZSgtMTxyLmluZGV4T2YoIiAiK28rIiAiKSlyPXIucmVwbGFjZSgiICIrbysiICIsIiAiKTtpIT09KHM9bXQocikpJiZuLnNldEF0dHJpYnV0ZSgiY2xhc3MiLHMpfXJldHVybiB0aGlzfSx0b2dnbGVDbGFzczpmdW5jdGlvbihpLHQpe3ZhciBvPXR5cGVvZiBpLGE9InN0cmluZyI9PT1vfHxBcnJheS5pc0FycmF5KGkpO3JldHVybiJib29sZWFuIj09dHlwZW9mIHQmJmE/dD90aGlzLmFkZENsYXNzKGkpOnRoaXMucmVtb3ZlQ2xhc3MoaSk6bShpKT90aGlzLmVhY2goZnVuY3Rpb24oZSl7ayh0aGlzKS50b2dnbGVDbGFzcyhpLmNhbGwodGhpcyxlLHh0KHRoaXMpLHQpLHQpfSk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGUsdCxuLHI7aWYoYSl7dD0wLG49ayh0aGlzKSxyPWJ0KGkpO3doaWxlKGU9clt0KytdKW4uaGFzQ2xhc3MoZSk/bi5yZW1vdmVDbGFzcyhlKTpuLmFkZENsYXNzKGUpfWVsc2Ugdm9pZCAwIT09aSYmImJvb2xlYW4iIT09b3x8KChlPXh0KHRoaXMpKSYmUS5zZXQodGhpcywiX19jbGFzc05hbWVfXyIsZSksdGhpcy5zZXRBdHRyaWJ1dGUmJnRoaXMuc2V0QXR0cmlidXRlKCJjbGFzcyIsZXx8ITE9PT1pPyIiOlEuZ2V0KHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiIpKX0pfSxoYXNDbGFzczpmdW5jdGlvbihlKXt2YXIgdCxuLHI9MDt0PSIgIitlKyIgIjt3aGlsZShuPXRoaXNbcisrXSlpZigxPT09bi5ub2RlVHlwZSYmLTE8KCIgIittdCh4dChuKSkrIiAiKS5pbmRleE9mKHQpKXJldHVybiEwO3JldHVybiExfX0pO3ZhciB3dD0vXHIvZztrLmZuLmV4dGVuZCh7dmFsOmZ1bmN0aW9uKG4pe3ZhciByLGUsaSx0PXRoaXNbMF07cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9bShuKSx0aGlzLmVhY2goZnVuY3Rpb24oZSl7dmFyIHQ7MT09PXRoaXMubm9kZVR5cGUmJihudWxsPT0odD1pP24uY2FsbCh0aGlzLGUsayh0aGlzKS52YWwoKSk6bik/dD0iIjoibnVtYmVyIj09dHlwZW9mIHQ/dCs9IiI6QXJyYXkuaXNBcnJheSh0KSYmKHQ9ay5tYXAodCxmdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09ZT8iIjplKyIifSkpLChyPWsudmFsSG9va3NbdGhpcy50eXBlXXx8ay52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSYmInNldCJpbiByJiZ2b2lkIDAhPT1yLnNldCh0aGlzLHQsInZhbHVlIil8fCh0aGlzLnZhbHVlPXQpKX0pKTp0PyhyPWsudmFsSG9va3NbdC50eXBlXXx8ay52YWxIb29rc1t0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSYmImdldCJpbiByJiZ2b2lkIDAhPT0oZT1yLmdldCh0LCJ2YWx1ZSIpKT9lOiJzdHJpbmciPT10eXBlb2YoZT10LnZhbHVlKT9lLnJlcGxhY2Uod3QsIiIpOm51bGw9PWU/IiI6ZTp2b2lkIDB9fSksay5leHRlbmQoe3ZhbEhvb2tzOntvcHRpb246e2dldDpmdW5jdGlvbihlKXt2YXIgdD1rLmZpbmQuYXR0cihlLCJ2YWx1ZSIpO3JldHVybiBudWxsIT10P3Q6bXQoay50ZXh0KGUpKX19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKGUpe3ZhciB0LG4scixpPWUub3B0aW9ucyxvPWUuc2VsZWN0ZWRJbmRleCxhPSJzZWxlY3Qtb25lIj09PWUudHlwZSxzPWE/bnVsbDpbXSx1PWE/bysxOmkubGVuZ3RoO2ZvcihyPW88MD91OmE/bzowO3I8dTtyKyspaWYoKChuPWlbcl0pLnNlbGVjdGVkfHxyPT09bykmJiFuLmRpc2FibGVkJiYoIW4ucGFyZW50Tm9kZS5kaXNhYmxlZHx8IUEobi5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7aWYodD1rKG4pLnZhbCgpLGEpcmV0dXJuIHQ7cy5wdXNoKHQpfXJldHVybiBzfSxzZXQ6ZnVuY3Rpb24oZSx0KXt2YXIgbixyLGk9ZS5vcHRpb25zLG89ay5tYWtlQXJyYXkodCksYT1pLmxlbmd0aDt3aGlsZShhLS0pKChyPWlbYV0pLnNlbGVjdGVkPS0xPGsuaW5BcnJheShrLnZhbEhvb2tzLm9wdGlvbi5nZXQociksbykpJiYobj0hMCk7cmV0dXJuIG58fChlLnNlbGVjdGVkSW5kZXg9LTEpLG99fX19KSxrLmVhY2goWyJyYWRpbyIsImNoZWNrYm94Il0sZnVuY3Rpb24oKXtrLnZhbEhvb2tzW3RoaXNdPXtzZXQ6ZnVuY3Rpb24oZSx0KXtpZihBcnJheS5pc0FycmF5KHQpKXJldHVybiBlLmNoZWNrZWQ9LTE8ay5pbkFycmF5KGsoZSkudmFsKCksdCl9fSx5LmNoZWNrT258fChrLnZhbEhvb2tzW3RoaXNdLmdldD1mdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09PWUuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpPyJvbiI6ZS52YWx1ZX0pfSkseS5mb2N1c2luPSJvbmZvY3VzaW4iaW4gQzt2YXIgVHQ9L14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLEN0PWZ1bmN0aW9uKGUpe2Uuc3RvcFByb3BhZ2F0aW9uKCl9O2suZXh0ZW5kKGsuZXZlbnQse3RyaWdnZXI6ZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbyxhLHMsdSxsLGMsZixwPVtufHxFXSxkPXYuY2FsbChlLCJ0eXBlIik/ZS50eXBlOmUsaD12LmNhbGwoZSwibmFtZXNwYWNlIik/ZS5uYW1lc3BhY2Uuc3BsaXQoIi4iKTpbXTtpZihvPWY9YT1uPW58fEUsMyE9PW4ubm9kZVR5cGUmJjghPT1uLm5vZGVUeXBlJiYhVHQudGVzdChkK2suZXZlbnQudHJpZ2dlcmVkKSYmKC0xPGQuaW5kZXhPZigiLiIpJiYoZD0oaD1kLnNwbGl0KCIuIikpLnNoaWZ0KCksaC5zb3J0KCkpLHU9ZC5pbmRleE9mKCI6Iik8MCYmIm9uIitkLChlPWVbay5leHBhbmRvXT9lOm5ldyBrLkV2ZW50KGQsIm9iamVjdCI9PXR5cGVvZiBlJiZlKSkuaXNUcmlnZ2VyPXI/MjozLGUubmFtZXNwYWNlPWguam9pbigiLiIpLGUucm5hbWVzcGFjZT1lLm5hbWVzcGFjZT9uZXcgUmVnRXhwKCIoXnxcXC4pIitoLmpvaW4oIlxcLig/Oi4qXFwufCkiKSsiKFxcLnwkKSIpOm51bGwsZS5yZXN1bHQ9dm9pZCAwLGUudGFyZ2V0fHwoZS50YXJnZXQ9biksdD1udWxsPT10P1tlXTprLm1ha2VBcnJheSh0LFtlXSksYz1rLmV2ZW50LnNwZWNpYWxbZF18fHt9LHJ8fCFjLnRyaWdnZXJ8fCExIT09Yy50cmlnZ2VyLmFwcGx5KG4sdCkpKXtpZighciYmIWMubm9CdWJibGUmJiF4KG4pKXtmb3Iocz1jLmRlbGVnYXRlVHlwZXx8ZCxUdC50ZXN0KHMrZCl8fChvPW8ucGFyZW50Tm9kZSk7bztvPW8ucGFyZW50Tm9kZSlwLnB1c2gobyksYT1vO2E9PT0obi5vd25lckRvY3VtZW50fHxFKSYmcC5wdXNoKGEuZGVmYXVsdFZpZXd8fGEucGFyZW50V2luZG93fHxDKX1pPTA7d2hpbGUoKG89cFtpKytdKSYmIWUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSlmPW8sZS50eXBlPTE8aT9zOmMuYmluZFR5cGV8fGQsKGw9KFEuZ2V0KG8sImV2ZW50cyIpfHx7fSlbZS50eXBlXSYmUS5nZXQobywiaGFuZGxlIikpJiZsLmFwcGx5KG8sdCksKGw9dSYmb1t1XSkmJmwuYXBwbHkmJkcobykmJihlLnJlc3VsdD1sLmFwcGx5KG8sdCksITE9PT1lLnJlc3VsdCYmZS5wcmV2ZW50RGVmYXVsdCgpKTtyZXR1cm4gZS50eXBlPWQscnx8ZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8Yy5fZGVmYXVsdCYmITEhPT1jLl9kZWZhdWx0LmFwcGx5KHAucG9wKCksdCl8fCFHKG4pfHx1JiZtKG5bZF0pJiYheChuKSYmKChhPW5bdV0pJiYoblt1XT1udWxsKSxrLmV2ZW50LnRyaWdnZXJlZD1kLGUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSYmZi5hZGRFdmVudExpc3RlbmVyKGQsQ3QpLG5bZF0oKSxlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkmJmYucmVtb3ZlRXZlbnRMaXN0ZW5lcihkLEN0KSxrLmV2ZW50LnRyaWdnZXJlZD12b2lkIDAsYSYmKG5bdV09YSkpLGUucmVzdWx0fX0sc2ltdWxhdGU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByPWsuZXh0ZW5kKG5ldyBrLkV2ZW50LG4se3R5cGU6ZSxpc1NpbXVsYXRlZDohMH0pO2suZXZlbnQudHJpZ2dlcihyLG51bGwsdCl9fSksay5mbi5leHRlbmQoe3RyaWdnZXI6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ay5ldmVudC50cmlnZ2VyKGUsdCx0aGlzKX0pfSx0cmlnZ2VySGFuZGxlcjpmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXNbMF07aWYobilyZXR1cm4gay5ldmVudC50cmlnZ2VyKGUsdCxuLCEwKX19KSx5LmZvY3VzaW58fGsuZWFjaCh7Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0In0sZnVuY3Rpb24obixyKXt2YXIgaT1mdW5jdGlvbihlKXtrLmV2ZW50LnNpbXVsYXRlKHIsZS50YXJnZXQsay5ldmVudC5maXgoZSkpfTtrLmV2ZW50LnNwZWNpYWxbcl09e3NldHVwOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vd25lckRvY3VtZW50fHx0aGlzLHQ9US5hY2Nlc3MoZSxyKTt0fHxlLmFkZEV2ZW50TGlzdGVuZXIobixpLCEwKSxRLmFjY2VzcyhlLHIsKHR8fDApKzEpfSx0ZWFyZG93bjpmdW5jdGlvbigpe3ZhciBlPXRoaXMub3duZXJEb2N1bWVudHx8dGhpcyx0PVEuYWNjZXNzKGUsciktMTt0P1EuYWNjZXNzKGUscix0KTooZS5yZW1vdmVFdmVudExpc3RlbmVyKG4saSwhMCksUS5yZW1vdmUoZSxyKSl9fX0pO3ZhciBFdD1DLmxvY2F0aW9uLGt0PURhdGUubm93KCksU3Q9L1w/LztrLnBhcnNlWE1MPWZ1bmN0aW9uKGUpe3ZhciB0O2lmKCFlfHwic3RyaW5nIiE9dHlwZW9mIGUpcmV0dXJuIG51bGw7dHJ5e3Q9KG5ldyBDLkRPTVBhcnNlcikucGFyc2VGcm9tU3RyaW5nKGUsInRleHQveG1sIil9Y2F0Y2goZSl7dD12b2lkIDB9cmV0dXJuIHQmJiF0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpLmxlbmd0aHx8ay5lcnJvcigiSW52YWxpZCBYTUw6ICIrZSksdH07dmFyIE50PS9cW1xdJC8sQXQ9L1xyP1xuL2csRHQ9L14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLGp0PS9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGtleWdlbikvaTtmdW5jdGlvbiBxdChuLGUscixpKXt2YXIgdDtpZihBcnJheS5pc0FycmF5KGUpKWsuZWFjaChlLGZ1bmN0aW9uKGUsdCl7cnx8TnQudGVzdChuKT9pKG4sdCk6cXQobisiWyIrKCJvYmplY3QiPT10eXBlb2YgdCYmbnVsbCE9dD9lOiIiKSsiXSIsdCxyLGkpfSk7ZWxzZSBpZihyfHwib2JqZWN0IiE9PXcoZSkpaShuLGUpO2Vsc2UgZm9yKHQgaW4gZSlxdChuKyJbIit0KyJdIixlW3RdLHIsaSl9ay5wYXJhbT1mdW5jdGlvbihlLHQpe3ZhciBuLHI9W10saT1mdW5jdGlvbihlLHQpe3ZhciBuPW0odCk/dCgpOnQ7cltyLmxlbmd0aF09ZW5jb2RlVVJJQ29tcG9uZW50KGUpKyI9IitlbmNvZGVVUklDb21wb25lbnQobnVsbD09bj8iIjpuKX07aWYobnVsbD09ZSlyZXR1cm4iIjtpZihBcnJheS5pc0FycmF5KGUpfHxlLmpxdWVyeSYmIWsuaXNQbGFpbk9iamVjdChlKSlrLmVhY2goZSxmdW5jdGlvbigpe2kodGhpcy5uYW1lLHRoaXMudmFsdWUpfSk7ZWxzZSBmb3IobiBpbiBlKXF0KG4sZVtuXSx0LGkpO3JldHVybiByLmpvaW4oIiYiKX0say5mbi5leHRlbmQoe3NlcmlhbGl6ZTpmdW5jdGlvbigpe3JldHVybiBrLnBhcmFtKHRoaXMuc2VyaWFsaXplQXJyYXkoKSl9LHNlcmlhbGl6ZUFycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7dmFyIGU9ay5wcm9wKHRoaXMsImVsZW1lbnRzIik7cmV0dXJuIGU/ay5tYWtlQXJyYXkoZSk6dGhpc30pLmZpbHRlcihmdW5jdGlvbigpe3ZhciBlPXRoaXMudHlwZTtyZXR1cm4gdGhpcy5uYW1lJiYhayh0aGlzKS5pcygiOmRpc2FibGVkIikmJmp0LnRlc3QodGhpcy5ub2RlTmFtZSkmJiFEdC50ZXN0KGUpJiYodGhpcy5jaGVja2VkfHwhcGUudGVzdChlKSl9KS5tYXAoZnVuY3Rpb24oZSx0KXt2YXIgbj1rKHRoaXMpLnZhbCgpO3JldHVybiBudWxsPT1uP251bGw6QXJyYXkuaXNBcnJheShuKT9rLm1hcChuLGZ1bmN0aW9uKGUpe3JldHVybntuYW1lOnQubmFtZSx2YWx1ZTplLnJlcGxhY2UoQXQsIlxyXG4iKX19KTp7bmFtZTp0Lm5hbWUsdmFsdWU6bi5yZXBsYWNlKEF0LCJcclxuIil9fSkuZ2V0KCl9fSk7dmFyIEx0PS8lMjAvZyxIdD0vIy4qJC8sT3Q9LyhbPyZdKV89W14mXSovLFB0PS9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKSQvZ20sUnQ9L14oPzpHRVR8SEVBRCkkLyxNdD0vXlwvXC8vLEl0PXt9LFd0PXt9LCR0PSIqLyIuY29uY2F0KCIqIiksRnQ9RS5jcmVhdGVFbGVtZW50KCJhIik7ZnVuY3Rpb24gQnQobyl7cmV0dXJuIGZ1bmN0aW9uKGUsdCl7InN0cmluZyIhPXR5cGVvZiBlJiYodD1lLGU9IioiKTt2YXIgbixyPTAsaT1lLnRvTG93ZXJDYXNlKCkubWF0Y2goUil8fFtdO2lmKG0odCkpd2hpbGUobj1pW3IrK10pIisiPT09blswXT8obj1uLnNsaWNlKDEpfHwiKiIsKG9bbl09b1tuXXx8W10pLnVuc2hpZnQodCkpOihvW25dPW9bbl18fFtdKS5wdXNoKHQpfX1mdW5jdGlvbiBfdCh0LGksbyxhKXt2YXIgcz17fSx1PXQ9PT1XdDtmdW5jdGlvbiBsKGUpe3ZhciByO3JldHVybiBzW2VdPSEwLGsuZWFjaCh0W2VdfHxbXSxmdW5jdGlvbihlLHQpe3ZhciBuPXQoaSxvLGEpO3JldHVybiJzdHJpbmciIT10eXBlb2Ygbnx8dXx8c1tuXT91PyEocj1uKTp2b2lkIDA6KGkuZGF0YVR5cGVzLnVuc2hpZnQobiksbChuKSwhMSl9KSxyfXJldHVybiBsKGkuZGF0YVR5cGVzWzBdKXx8IXNbIioiXSYmbCgiKiIpfWZ1bmN0aW9uIHp0KGUsdCl7dmFyIG4scixpPWsuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zfHx7fTtmb3IobiBpbiB0KXZvaWQgMCE9PXRbbl0mJigoaVtuXT9lOnJ8fChyPXt9KSlbbl09dFtuXSk7cmV0dXJuIHImJmsuZXh0ZW5kKCEwLGUsciksZX1GdC5ocmVmPUV0LmhyZWYsay5leHRlbmQoe2FjdGl2ZTowLGxhc3RNb2RpZmllZDp7fSxldGFnOnt9LGFqYXhTZXR0aW5nczp7dXJsOkV0LmhyZWYsdHlwZToiR0VUIixpc0xvY2FsOi9eKD86YWJvdXR8YXBwfGFwcC1zdG9yYWdlfC4rLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLnRlc3QoRXQucHJvdG9jb2wpLGdsb2JhbDohMCxwcm9jZXNzRGF0YTohMCxhc3luYzohMCxjb250ZW50VHlwZToiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IixhY2NlcHRzOnsiKiI6JHQsdGV4dDoidGV4dC9wbGFpbiIsaHRtbDoidGV4dC9odG1sIix4bWw6ImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLGpzb246ImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCJ9LGNvbnRlbnRzOnt4bWw6L1xieG1sXGIvLGh0bWw6L1xiaHRtbC8sanNvbjovXGJqc29uXGIvfSxyZXNwb25zZUZpZWxkczp7eG1sOiJyZXNwb25zZVhNTCIsdGV4dDoicmVzcG9uc2VUZXh0Iixqc29uOiJyZXNwb25zZUpTT04ifSxjb252ZXJ0ZXJzOnsiKiB0ZXh0IjpTdHJpbmcsInRleHQgaHRtbCI6ITAsInRleHQganNvbiI6SlNPTi5wYXJzZSwidGV4dCB4bWwiOmsucGFyc2VYTUx9LGZsYXRPcHRpb25zOnt1cmw6ITAsY29udGV4dDohMH19LGFqYXhTZXR1cDpmdW5jdGlvbihlLHQpe3JldHVybiB0P3p0KHp0KGUsay5hamF4U2V0dGluZ3MpLHQpOnp0KGsuYWpheFNldHRpbmdzLGUpfSxhamF4UHJlZmlsdGVyOkJ0KEl0KSxhamF4VHJhbnNwb3J0OkJ0KFd0KSxhamF4OmZ1bmN0aW9uKGUsdCl7Im9iamVjdCI9PXR5cGVvZiBlJiYodD1lLGU9dm9pZCAwKSx0PXR8fHt9O3ZhciBjLGYscCxuLGQscixoLGcsaSxvLHY9ay5hamF4U2V0dXAoe30sdCkseT12LmNvbnRleHR8fHYsbT12LmNvbnRleHQmJih5Lm5vZGVUeXBlfHx5LmpxdWVyeSk/ayh5KTprLmV2ZW50LHg9ay5EZWZlcnJlZCgpLGI9ay5DYWxsYmFja3MoIm9uY2UgbWVtb3J5Iiksdz12LnN0YXR1c0NvZGV8fHt9LGE9e30scz17fSx1PSJjYW5jZWxlZCIsVD17cmVhZHlTdGF0ZTowLGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGUpe3ZhciB0O2lmKGgpe2lmKCFuKXtuPXt9O3doaWxlKHQ9UHQuZXhlYyhwKSluW3RbMV0udG9Mb3dlckNhc2UoKSsiICJdPShuW3RbMV0udG9Mb3dlckNhc2UoKSsiICJdfHxbXSkuY29uY2F0KHRbMl0pfXQ9bltlLnRvTG93ZXJDYXNlKCkrIiAiXX1yZXR1cm4gbnVsbD09dD9udWxsOnQuam9pbigiLCAiKX0sZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOmZ1bmN0aW9uKCl7cmV0dXJuIGg/cDpudWxsfSxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIG51bGw9PWgmJihlPXNbZS50b0xvd2VyQ2FzZSgpXT1zW2UudG9Mb3dlckNhc2UoKV18fGUsYVtlXT10KSx0aGlzfSxvdmVycmlkZU1pbWVUeXBlOmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1oJiYodi5taW1lVHlwZT1lKSx0aGlzfSxzdGF0dXNDb2RlOmZ1bmN0aW9uKGUpe3ZhciB0O2lmKGUpaWYoaClULmFsd2F5cyhlW1Quc3RhdHVzXSk7ZWxzZSBmb3IodCBpbiBlKXdbdF09W3dbdF0sZVt0XV07cmV0dXJuIHRoaXN9LGFib3J0OmZ1bmN0aW9uKGUpe3ZhciB0PWV8fHU7cmV0dXJuIGMmJmMuYWJvcnQodCksbCgwLHQpLHRoaXN9fTtpZih4LnByb21pc2UoVCksdi51cmw9KChlfHx2LnVybHx8RXQuaHJlZikrIiIpLnJlcGxhY2UoTXQsRXQucHJvdG9jb2wrIi8vIiksdi50eXBlPXQubWV0aG9kfHx0LnR5cGV8fHYubWV0aG9kfHx2LnR5cGUsdi5kYXRhVHlwZXM9KHYuZGF0YVR5cGV8fCIqIikudG9Mb3dlckNhc2UoKS5tYXRjaChSKXx8WyIiXSxudWxsPT12LmNyb3NzRG9tYWluKXtyPUUuY3JlYXRlRWxlbWVudCgiYSIpO3RyeXtyLmhyZWY9di51cmwsci5ocmVmPXIuaHJlZix2LmNyb3NzRG9tYWluPUZ0LnByb3RvY29sKyIvLyIrRnQuaG9zdCE9ci5wcm90b2NvbCsiLy8iK3IuaG9zdH1jYXRjaChlKXt2LmNyb3NzRG9tYWluPSEwfX1pZih2LmRhdGEmJnYucHJvY2Vzc0RhdGEmJiJzdHJpbmciIT10eXBlb2Ygdi5kYXRhJiYodi5kYXRhPWsucGFyYW0odi5kYXRhLHYudHJhZGl0aW9uYWwpKSxfdChJdCx2LHQsVCksaClyZXR1cm4gVDtmb3IoaSBpbihnPWsuZXZlbnQmJnYuZ2xvYmFsKSYmMD09ay5hY3RpdmUrKyYmay5ldmVudC50cmlnZ2VyKCJhamF4U3RhcnQiKSx2LnR5cGU9di50eXBlLnRvVXBwZXJDYXNlKCksdi5oYXNDb250ZW50PSFSdC50ZXN0KHYudHlwZSksZj12LnVybC5yZXBsYWNlKEh0LCIiKSx2Lmhhc0NvbnRlbnQ/di5kYXRhJiZ2LnByb2Nlc3NEYXRhJiYwPT09KHYuY29udGVudFR5cGV8fCIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSYmKHYuZGF0YT12LmRhdGEucmVwbGFjZShMdCwiKyIpKToobz12LnVybC5zbGljZShmLmxlbmd0aCksdi5kYXRhJiYodi5wcm9jZXNzRGF0YXx8InN0cmluZyI9PXR5cGVvZiB2LmRhdGEpJiYoZis9KFN0LnRlc3QoZik/IiYiOiI/Iikrdi5kYXRhLGRlbGV0ZSB2LmRhdGEpLCExPT09di5jYWNoZSYmKGY9Zi5yZXBsYWNlKE90LCIkMSIpLG89KFN0LnRlc3QoZik/IiYiOiI/IikrIl89IitrdCsrK28pLHYudXJsPWYrbyksdi5pZk1vZGlmaWVkJiYoay5sYXN0TW9kaWZpZWRbZl0mJlQuc2V0UmVxdWVzdEhlYWRlcigiSWYtTW9kaWZpZWQtU2luY2UiLGsubGFzdE1vZGlmaWVkW2ZdKSxrLmV0YWdbZl0mJlQuc2V0UmVxdWVzdEhlYWRlcigiSWYtTm9uZS1NYXRjaCIsay5ldGFnW2ZdKSksKHYuZGF0YSYmdi5oYXNDb250ZW50JiYhMSE9PXYuY29udGVudFR5cGV8fHQuY29udGVudFR5cGUpJiZULnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsdi5jb250ZW50VHlwZSksVC5zZXRSZXF1ZXN0SGVhZGVyKCJBY2NlcHQiLHYuZGF0YVR5cGVzWzBdJiZ2LmFjY2VwdHNbdi5kYXRhVHlwZXNbMF1dP3YuYWNjZXB0c1t2LmRhdGFUeXBlc1swXV0rKCIqIiE9PXYuZGF0YVR5cGVzWzBdPyIsICIrJHQrIjsgcT0wLjAxIjoiIik6di5hY2NlcHRzWyIqIl0pLHYuaGVhZGVycylULnNldFJlcXVlc3RIZWFkZXIoaSx2LmhlYWRlcnNbaV0pO2lmKHYuYmVmb3JlU2VuZCYmKCExPT09di5iZWZvcmVTZW5kLmNhbGwoeSxULHYpfHxoKSlyZXR1cm4gVC5hYm9ydCgpO2lmKHU9ImFib3J0IixiLmFkZCh2LmNvbXBsZXRlKSxULmRvbmUodi5zdWNjZXNzKSxULmZhaWwodi5lcnJvciksYz1fdChXdCx2LHQsVCkpe2lmKFQucmVhZHlTdGF0ZT0xLGcmJm0udHJpZ2dlcigiYWpheFNlbmQiLFtULHZdKSxoKXJldHVybiBUO3YuYXN5bmMmJjA8di50aW1lb3V0JiYoZD1DLnNldFRpbWVvdXQoZnVuY3Rpb24oKXtULmFib3J0KCJ0aW1lb3V0Iil9LHYudGltZW91dCkpO3RyeXtoPSExLGMuc2VuZChhLGwpfWNhdGNoKGUpe2lmKGgpdGhyb3cgZTtsKC0xLGUpfX1lbHNlIGwoLTEsIk5vIFRyYW5zcG9ydCIpO2Z1bmN0aW9uIGwoZSx0LG4scil7dmFyIGksbyxhLHMsdSxsPXQ7aHx8KGg9ITAsZCYmQy5jbGVhclRpbWVvdXQoZCksYz12b2lkIDAscD1yfHwiIixULnJlYWR5U3RhdGU9MDxlPzQ6MCxpPTIwMDw9ZSYmZTwzMDB8fDMwND09PWUsbiYmKHM9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhLHM9ZS5jb250ZW50cyx1PWUuZGF0YVR5cGVzO3doaWxlKCIqIj09PXVbMF0pdS5zaGlmdCgpLHZvaWQgMD09PXImJihyPWUubWltZVR5cGV8fHQuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpKTtpZihyKWZvcihpIGluIHMpaWYoc1tpXSYmc1tpXS50ZXN0KHIpKXt1LnVuc2hpZnQoaSk7YnJlYWt9aWYodVswXWluIG4pbz11WzBdO2Vsc2V7Zm9yKGkgaW4gbil7aWYoIXVbMF18fGUuY29udmVydGVyc1tpKyIgIit1WzBdXSl7bz1pO2JyZWFrfWF8fChhPWkpfW89b3x8YX1pZihvKXJldHVybiBvIT09dVswXSYmdS51bnNoaWZ0KG8pLG5bb119KHYsVCxuKSkscz1mdW5jdGlvbihlLHQsbixyKXt2YXIgaSxvLGEscyx1LGw9e30sYz1lLmRhdGFUeXBlcy5zbGljZSgpO2lmKGNbMV0pZm9yKGEgaW4gZS5jb252ZXJ0ZXJzKWxbYS50b0xvd2VyQ2FzZSgpXT1lLmNvbnZlcnRlcnNbYV07bz1jLnNoaWZ0KCk7d2hpbGUobylpZihlLnJlc3BvbnNlRmllbGRzW29dJiYobltlLnJlc3BvbnNlRmllbGRzW29dXT10KSwhdSYmciYmZS5kYXRhRmlsdGVyJiYodD1lLmRhdGFGaWx0ZXIodCxlLmRhdGFUeXBlKSksdT1vLG89Yy5zaGlmdCgpKWlmKCIqIj09PW8pbz11O2Vsc2UgaWYoIioiIT09dSYmdSE9PW8pe2lmKCEoYT1sW3UrIiAiK29dfHxsWyIqICIrb10pKWZvcihpIGluIGwpaWYoKHM9aS5zcGxpdCgiICIpKVsxXT09PW8mJihhPWxbdSsiICIrc1swXV18fGxbIiogIitzWzBdXSkpeyEwPT09YT9hPWxbaV06ITAhPT1sW2ldJiYobz1zWzBdLGMudW5zaGlmdChzWzFdKSk7YnJlYWt9aWYoITAhPT1hKWlmKGEmJmVbInRocm93cyJdKXQ9YSh0KTtlbHNlIHRyeXt0PWEodCl9Y2F0Y2goZSl7cmV0dXJue3N0YXRlOiJwYXJzZXJlcnJvciIsZXJyb3I6YT9lOiJObyBjb252ZXJzaW9uIGZyb20gIit1KyIgdG8gIitvfX19cmV0dXJue3N0YXRlOiJzdWNjZXNzIixkYXRhOnR9fSh2LHMsVCxpKSxpPyh2LmlmTW9kaWZpZWQmJigodT1ULmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIikpJiYoay5sYXN0TW9kaWZpZWRbZl09dSksKHU9VC5nZXRSZXNwb25zZUhlYWRlcigiZXRhZyIpKSYmKGsuZXRhZ1tmXT11KSksMjA0PT09ZXx8IkhFQUQiPT09di50eXBlP2w9Im5vY29udGVudCI6MzA0PT09ZT9sPSJub3Rtb2RpZmllZCI6KGw9cy5zdGF0ZSxvPXMuZGF0YSxpPSEoYT1zLmVycm9yKSkpOihhPWwsIWUmJmx8fChsPSJlcnJvciIsZTwwJiYoZT0wKSkpLFQuc3RhdHVzPWUsVC5zdGF0dXNUZXh0PSh0fHxsKSsiIixpP3gucmVzb2x2ZVdpdGgoeSxbbyxsLFRdKTp4LnJlamVjdFdpdGgoeSxbVCxsLGFdKSxULnN0YXR1c0NvZGUodyksdz12b2lkIDAsZyYmbS50cmlnZ2VyKGk/ImFqYXhTdWNjZXNzIjoiYWpheEVycm9yIixbVCx2LGk/bzphXSksYi5maXJlV2l0aCh5LFtULGxdKSxnJiYobS50cmlnZ2VyKCJhamF4Q29tcGxldGUiLFtULHZdKSwtLWsuYWN0aXZlfHxrLmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIikpKX1yZXR1cm4gVH0sZ2V0SlNPTjpmdW5jdGlvbihlLHQsbil7cmV0dXJuIGsuZ2V0KGUsdCxuLCJqc29uIil9LGdldFNjcmlwdDpmdW5jdGlvbihlLHQpe3JldHVybiBrLmdldChlLHZvaWQgMCx0LCJzY3JpcHQiKX19KSxrLmVhY2goWyJnZXQiLCJwb3N0Il0sZnVuY3Rpb24oZSxpKXtrW2ldPWZ1bmN0aW9uKGUsdCxuLHIpe3JldHVybiBtKHQpJiYocj1yfHxuLG49dCx0PXZvaWQgMCksay5hamF4KGsuZXh0ZW5kKHt1cmw6ZSx0eXBlOmksZGF0YVR5cGU6cixkYXRhOnQsc3VjY2VzczpufSxrLmlzUGxhaW5PYmplY3QoZSkmJmUpKX19KSxrLl9ldmFsVXJsPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGsuYWpheCh7dXJsOmUsdHlwZToiR0VUIixkYXRhVHlwZToic2NyaXB0IixjYWNoZTohMCxhc3luYzohMSxnbG9iYWw6ITEsY29udmVydGVyczp7InRleHQgc2NyaXB0IjpmdW5jdGlvbigpe319LGRhdGFGaWx0ZXI6ZnVuY3Rpb24oZSl7ay5nbG9iYWxFdmFsKGUsdCl9fSl9LGsuZm4uZXh0ZW5kKHt3cmFwQWxsOmZ1bmN0aW9uKGUpe3ZhciB0O3JldHVybiB0aGlzWzBdJiYobShlKSYmKGU9ZS5jYWxsKHRoaXNbMF0pKSx0PWsoZSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKSx0aGlzWzBdLnBhcmVudE5vZGUmJnQuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLHQubWFwKGZ1bmN0aW9uKCl7dmFyIGU9dGhpczt3aGlsZShlLmZpcnN0RWxlbWVudENoaWxkKWU9ZS5maXJzdEVsZW1lbnRDaGlsZDtyZXR1cm4gZX0pLmFwcGVuZCh0aGlzKSksdGhpc30sd3JhcElubmVyOmZ1bmN0aW9uKG4pe3JldHVybiBtKG4pP3RoaXMuZWFjaChmdW5jdGlvbihlKXtrKHRoaXMpLndyYXBJbm5lcihuLmNhbGwodGhpcyxlKSl9KTp0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1rKHRoaXMpLHQ9ZS5jb250ZW50cygpO3QubGVuZ3RoP3Qud3JhcEFsbChuKTplLmFwcGVuZChuKX0pfSx3cmFwOmZ1bmN0aW9uKHQpe3ZhciBuPW0odCk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihlKXtrKHRoaXMpLndyYXBBbGwobj90LmNhbGwodGhpcyxlKTp0KX0pfSx1bndyYXA6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucGFyZW50KGUpLm5vdCgiYm9keSIpLmVhY2goZnVuY3Rpb24oKXtrKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyl9KSx0aGlzfX0pLGsuZXhwci5wc2V1ZG9zLmhpZGRlbj1mdW5jdGlvbihlKXtyZXR1cm4hay5leHByLnBzZXVkb3MudmlzaWJsZShlKX0say5leHByLnBzZXVkb3MudmlzaWJsZT1mdW5jdGlvbihlKXtyZXR1cm4hIShlLm9mZnNldFdpZHRofHxlLm9mZnNldEhlaWdodHx8ZS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCl9LGsuYWpheFNldHRpbmdzLnhocj1mdW5jdGlvbigpe3RyeXtyZXR1cm4gbmV3IEMuWE1MSHR0cFJlcXVlc3R9Y2F0Y2goZSl7fX07dmFyIFV0PXswOjIwMCwxMjIzOjIwNH0sWHQ9ay5hamF4U2V0dGluZ3MueGhyKCk7eS5jb3JzPSEhWHQmJiJ3aXRoQ3JlZGVudGlhbHMiaW4gWHQseS5hamF4PVh0PSEhWHQsay5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uKGkpe3ZhciBvLGE7aWYoeS5jb3JzfHxYdCYmIWkuY3Jvc3NEb21haW4pcmV0dXJue3NlbmQ6ZnVuY3Rpb24oZSx0KXt2YXIgbixyPWkueGhyKCk7aWYoci5vcGVuKGkudHlwZSxpLnVybCxpLmFzeW5jLGkudXNlcm5hbWUsaS5wYXNzd29yZCksaS54aHJGaWVsZHMpZm9yKG4gaW4gaS54aHJGaWVsZHMpcltuXT1pLnhockZpZWxkc1tuXTtmb3IobiBpbiBpLm1pbWVUeXBlJiZyLm92ZXJyaWRlTWltZVR5cGUmJnIub3ZlcnJpZGVNaW1lVHlwZShpLm1pbWVUeXBlKSxpLmNyb3NzRG9tYWlufHxlWyJYLVJlcXVlc3RlZC1XaXRoIl18fChlWyJYLVJlcXVlc3RlZC1XaXRoIl09IlhNTEh0dHBSZXF1ZXN0IiksZSlyLnNldFJlcXVlc3RIZWFkZXIobixlW25dKTtvPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbigpe28mJihvPWE9ci5vbmxvYWQ9ci5vbmVycm9yPXIub25hYm9ydD1yLm9udGltZW91dD1yLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLCJhYm9ydCI9PT1lP3IuYWJvcnQoKToiZXJyb3IiPT09ZT8ibnVtYmVyIiE9dHlwZW9mIHIuc3RhdHVzP3QoMCwiZXJyb3IiKTp0KHIuc3RhdHVzLHIuc3RhdHVzVGV4dCk6dChVdFtyLnN0YXR1c118fHIuc3RhdHVzLHIuc3RhdHVzVGV4dCwidGV4dCIhPT0oci5yZXNwb25zZVR5cGV8fCJ0ZXh0Iil8fCJzdHJpbmciIT10eXBlb2Ygci5yZXNwb25zZVRleHQ/e2JpbmFyeTpyLnJlc3BvbnNlfTp7dGV4dDpyLnJlc3BvbnNlVGV4dH0sci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSkpfX0sci5vbmxvYWQ9bygpLGE9ci5vbmVycm9yPXIub250aW1lb3V0PW8oImVycm9yIiksdm9pZCAwIT09ci5vbmFib3J0P3Iub25hYm9ydD1hOnIub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7ND09PXIucmVhZHlTdGF0ZSYmQy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7byYmYSgpfSl9LG89bygiYWJvcnQiKTt0cnl7ci5zZW5kKGkuaGFzQ29udGVudCYmaS5kYXRhfHxudWxsKX1jYXRjaChlKXtpZihvKXRocm93IGV9fSxhYm9ydDpmdW5jdGlvbigpe28mJm8oKX19fSksay5hamF4UHJlZmlsdGVyKGZ1bmN0aW9uKGUpe2UuY3Jvc3NEb21haW4mJihlLmNvbnRlbnRzLnNjcmlwdD0hMSl9KSxrLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCJ9LGNvbnRlbnRzOntzY3JpcHQ6L1xiKD86amF2YXxlY21hKXNjcmlwdFxiL30sY29udmVydGVyczp7InRleHQgc2NyaXB0IjpmdW5jdGlvbihlKXtyZXR1cm4gay5nbG9iYWxFdmFsKGUpLGV9fX0pLGsuYWpheFByZWZpbHRlcigic2NyaXB0IixmdW5jdGlvbihlKXt2b2lkIDA9PT1lLmNhY2hlJiYoZS5jYWNoZT0hMSksZS5jcm9zc0RvbWFpbiYmKGUudHlwZT0iR0VUIil9KSxrLmFqYXhUcmFuc3BvcnQoInNjcmlwdCIsZnVuY3Rpb24obil7dmFyIHIsaTtpZihuLmNyb3NzRG9tYWlufHxuLnNjcmlwdEF0dHJzKXJldHVybntzZW5kOmZ1bmN0aW9uKGUsdCl7cj1rKCI8c2NyaXB0PiIpLmF0dHIobi5zY3JpcHRBdHRyc3x8e30pLnByb3Aoe2NoYXJzZXQ6bi5zY3JpcHRDaGFyc2V0LHNyYzpuLnVybH0pLm9uKCJsb2FkIGVycm9yIixpPWZ1bmN0aW9uKGUpe3IucmVtb3ZlKCksaT1udWxsLGUmJnQoImVycm9yIj09PWUudHlwZT80MDQ6MjAwLGUudHlwZSl9KSxFLmhlYWQuYXBwZW5kQ2hpbGQoclswXSl9LGFib3J0OmZ1bmN0aW9uKCl7aSYmaSgpfX19KTt2YXIgVnQsR3Q9W10sWXQ9Lyg9KVw/KD89JnwkKXxcP1w/LztrLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGU9R3QucG9wKCl8fGsuZXhwYW5kbysiXyIra3QrKztyZXR1cm4gdGhpc1tlXT0hMCxlfX0pLGsuYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhPSExIT09ZS5qc29ucCYmKFl0LnRlc3QoZS51cmwpPyJ1cmwiOiJzdHJpbmciPT10eXBlb2YgZS5kYXRhJiYwPT09KGUuY29udGVudFR5cGV8fCIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSYmWXQudGVzdChlLmRhdGEpJiYiZGF0YSIpO2lmKGF8fCJqc29ucCI9PT1lLmRhdGFUeXBlc1swXSlyZXR1cm4gcj1lLmpzb25wQ2FsbGJhY2s9bShlLmpzb25wQ2FsbGJhY2spP2UuanNvbnBDYWxsYmFjaygpOmUuanNvbnBDYWxsYmFjayxhP2VbYV09ZVthXS5yZXBsYWNlKFl0LCIkMSIrcik6ITEhPT1lLmpzb25wJiYoZS51cmwrPShTdC50ZXN0KGUudXJsKT8iJiI6Ij8iKStlLmpzb25wKyI9IityKSxlLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl09ZnVuY3Rpb24oKXtyZXR1cm4gb3x8ay5lcnJvcihyKyIgd2FzIG5vdCBjYWxsZWQiKSxvWzBdfSxlLmRhdGFUeXBlc1swXT0ianNvbiIsaT1DW3JdLENbcl09ZnVuY3Rpb24oKXtvPWFyZ3VtZW50c30sbi5hbHdheXMoZnVuY3Rpb24oKXt2b2lkIDA9PT1pP2soQykucmVtb3ZlUHJvcChyKTpDW3JdPWksZVtyXSYmKGUuanNvbnBDYWxsYmFjaz10Lmpzb25wQ2FsbGJhY2ssR3QucHVzaChyKSksbyYmbShpKSYmaShvWzBdKSxvPWk9dm9pZCAwfSksInNjcmlwdCJ9KSx5LmNyZWF0ZUhUTUxEb2N1bWVudD0oKFZ0PUUuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKS5ib2R5KS5pbm5lckhUTUw9Ijxmb3JtPjwvZm9ybT48Zm9ybT48L2Zvcm0+IiwyPT09VnQuY2hpbGROb2Rlcy5sZW5ndGgpLGsucGFyc2VIVE1MPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGU/W106KCJib29sZWFuIj09dHlwZW9mIHQmJihuPXQsdD0hMSksdHx8KHkuY3JlYXRlSFRNTERvY3VtZW50Pygocj0odD1FLmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudCgiIikpLmNyZWF0ZUVsZW1lbnQoImJhc2UiKSkuaHJlZj1FLmxvY2F0aW9uLmhyZWYsdC5oZWFkLmFwcGVuZENoaWxkKHIpKTp0PUUpLG89IW4mJltdLChpPUQuZXhlYyhlKSk/W3QuY3JlYXRlRWxlbWVudChpWzFdKV06KGk9d2UoW2VdLHQsbyksbyYmby5sZW5ndGgmJmsobykucmVtb3ZlKCksay5tZXJnZShbXSxpLmNoaWxkTm9kZXMpKSk7dmFyIHIsaSxvfSxrLmZuLmxvYWQ9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhPXRoaXMscz1lLmluZGV4T2YoIiAiKTtyZXR1cm4tMTxzJiYocj1tdChlLnNsaWNlKHMpKSxlPWUuc2xpY2UoMCxzKSksbSh0KT8obj10LHQ9dm9pZCAwKTp0JiYib2JqZWN0Ij09dHlwZW9mIHQmJihpPSJQT1NUIiksMDxhLmxlbmd0aCYmay5hamF4KHt1cmw6ZSx0eXBlOml8fCJHRVQiLGRhdGFUeXBlOiJodG1sIixkYXRhOnR9KS5kb25lKGZ1bmN0aW9uKGUpe289YXJndW1lbnRzLGEuaHRtbChyP2soIjxkaXY+IikuYXBwZW5kKGsucGFyc2VIVE1MKGUpKS5maW5kKHIpOmUpfSkuYWx3YXlzKG4mJmZ1bmN0aW9uKGUsdCl7YS5lYWNoKGZ1bmN0aW9uKCl7bi5hcHBseSh0aGlzLG98fFtlLnJlc3BvbnNlVGV4dCx0LGVdKX0pfSksdGhpc30say5lYWNoKFsiYWpheFN0YXJ0IiwiYWpheFN0b3AiLCJhamF4Q29tcGxldGUiLCJhamF4RXJyb3IiLCJhamF4U3VjY2VzcyIsImFqYXhTZW5kIl0sZnVuY3Rpb24oZSx0KXtrLmZuW3RdPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLm9uKHQsZSl9fSksay5leHByLnBzZXVkb3MuYW5pbWF0ZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIGsuZ3JlcChrLnRpbWVycyxmdW5jdGlvbihlKXtyZXR1cm4gdD09PWUuZWxlbX0pLmxlbmd0aH0say5vZmZzZXQ9e3NldE9mZnNldDpmdW5jdGlvbihlLHQsbil7dmFyIHIsaSxvLGEscyx1LGw9ay5jc3MoZSwicG9zaXRpb24iKSxjPWsoZSksZj17fTsic3RhdGljIj09PWwmJihlLnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSIpLHM9Yy5vZmZzZXQoKSxvPWsuY3NzKGUsInRvcCIpLHU9ay5jc3MoZSwibGVmdCIpLCgiYWJzb2x1dGUiPT09bHx8ImZpeGVkIj09PWwpJiYtMTwobyt1KS5pbmRleE9mKCJhdXRvIik/KGE9KHI9Yy5wb3NpdGlvbigpKS50b3AsaT1yLmxlZnQpOihhPXBhcnNlRmxvYXQobyl8fDAsaT1wYXJzZUZsb2F0KHUpfHwwKSxtKHQpJiYodD10LmNhbGwoZSxuLGsuZXh0ZW5kKHt9LHMpKSksbnVsbCE9dC50b3AmJihmLnRvcD10LnRvcC1zLnRvcCthKSxudWxsIT10LmxlZnQmJihmLmxlZnQ9dC5sZWZ0LXMubGVmdCtpKSwidXNpbmciaW4gdD90LnVzaW5nLmNhbGwoZSxmKTpjLmNzcyhmKX19LGsuZm4uZXh0ZW5kKHtvZmZzZXQ6ZnVuY3Rpb24odCl7aWYoYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gdm9pZCAwPT09dD90aGlzOnRoaXMuZWFjaChmdW5jdGlvbihlKXtrLm9mZnNldC5zZXRPZmZzZXQodGhpcyx0LGUpfSk7dmFyIGUsbixyPXRoaXNbMF07cmV0dXJuIHI/ci5nZXRDbGllbnRSZWN0cygpLmxlbmd0aD8oZT1yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLG49ci5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LHt0b3A6ZS50b3Arbi5wYWdlWU9mZnNldCxsZWZ0OmUubGVmdCtuLnBhZ2VYT2Zmc2V0fSk6e3RvcDowLGxlZnQ6MH06dm9pZCAwfSxwb3NpdGlvbjpmdW5jdGlvbigpe2lmKHRoaXNbMF0pe3ZhciBlLHQsbixyPXRoaXNbMF0saT17dG9wOjAsbGVmdDowfTtpZigiZml4ZWQiPT09ay5jc3MociwicG9zaXRpb24iKSl0PXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7ZWxzZXt0PXRoaXMub2Zmc2V0KCksbj1yLm93bmVyRG9jdW1lbnQsZT1yLm9mZnNldFBhcmVudHx8bi5kb2N1bWVudEVsZW1lbnQ7d2hpbGUoZSYmKGU9PT1uLmJvZHl8fGU9PT1uLmRvY3VtZW50RWxlbWVudCkmJiJzdGF0aWMiPT09ay5jc3MoZSwicG9zaXRpb24iKSllPWUucGFyZW50Tm9kZTtlJiZlIT09ciYmMT09PWUubm9kZVR5cGUmJigoaT1rKGUpLm9mZnNldCgpKS50b3ArPWsuY3NzKGUsImJvcmRlclRvcFdpZHRoIiwhMCksaS5sZWZ0Kz1rLmNzcyhlLCJib3JkZXJMZWZ0V2lkdGgiLCEwKSl9cmV0dXJue3RvcDp0LnRvcC1pLnRvcC1rLmNzcyhyLCJtYXJnaW5Ub3AiLCEwKSxsZWZ0OnQubGVmdC1pLmxlZnQtay5jc3MociwibWFyZ2luTGVmdCIsITApfX19LG9mZnNldFBhcmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3ZhciBlPXRoaXMub2Zmc2V0UGFyZW50O3doaWxlKGUmJiJzdGF0aWMiPT09ay5jc3MoZSwicG9zaXRpb24iKSllPWUub2Zmc2V0UGFyZW50O3JldHVybiBlfHxpZX0pfX0pLGsuZWFjaCh7c2Nyb2xsTGVmdDoicGFnZVhPZmZzZXQiLHNjcm9sbFRvcDoicGFnZVlPZmZzZXQifSxmdW5jdGlvbih0LGkpe3ZhciBvPSJwYWdlWU9mZnNldCI9PT1pO2suZm5bdF09ZnVuY3Rpb24oZSl7cmV0dXJuIF8odGhpcyxmdW5jdGlvbihlLHQsbil7dmFyIHI7aWYoeChlKT9yPWU6OT09PWUubm9kZVR5cGUmJihyPWUuZGVmYXVsdFZpZXcpLHZvaWQgMD09PW4pcmV0dXJuIHI/cltpXTplW3RdO3I/ci5zY3JvbGxUbyhvP3IucGFnZVhPZmZzZXQ6bixvP246ci5wYWdlWU9mZnNldCk6ZVt0XT1ufSx0LGUsYXJndW1lbnRzLmxlbmd0aCl9fSksay5lYWNoKFsidG9wIiwibGVmdCJdLGZ1bmN0aW9uKGUsbil7ay5jc3NIb29rc1tuXT16ZSh5LnBpeGVsUG9zaXRpb24sZnVuY3Rpb24oZSx0KXtpZih0KXJldHVybiB0PV9lKGUsbiksJGUudGVzdCh0KT9rKGUpLnBvc2l0aW9uKClbbl0rInB4Ijp0fSl9KSxrLmVhY2goe0hlaWdodDoiaGVpZ2h0IixXaWR0aDoid2lkdGgifSxmdW5jdGlvbihhLHMpe2suZWFjaCh7cGFkZGluZzoiaW5uZXIiK2EsY29udGVudDpzLCIiOiJvdXRlciIrYX0sZnVuY3Rpb24ocixvKXtrLmZuW29dPWZ1bmN0aW9uKGUsdCl7dmFyIG49YXJndW1lbnRzLmxlbmd0aCYmKHJ8fCJib29sZWFuIiE9dHlwZW9mIGUpLGk9cnx8KCEwPT09ZXx8ITA9PT10PyJtYXJnaW4iOiJib3JkZXIiKTtyZXR1cm4gXyh0aGlzLGZ1bmN0aW9uKGUsdCxuKXt2YXIgcjtyZXR1cm4geChlKT8wPT09by5pbmRleE9mKCJvdXRlciIpP2VbImlubmVyIithXTplLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsiY2xpZW50IithXTo5PT09ZS5ub2RlVHlwZT8ocj1lLmRvY3VtZW50RWxlbWVudCxNYXRoLm1heChlLmJvZHlbInNjcm9sbCIrYV0sclsic2Nyb2xsIithXSxlLmJvZHlbIm9mZnNldCIrYV0sclsib2Zmc2V0IithXSxyWyJjbGllbnQiK2FdKSk6dm9pZCAwPT09bj9rLmNzcyhlLHQsaSk6ay5zdHlsZShlLHQsbixpKX0scyxuP2U6dm9pZCAwLG4pfX0pfSksay5lYWNoKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgcmVzaXplIHNjcm9sbCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGNvbnRleHRtZW51Ii5zcGxpdCgiICIpLGZ1bmN0aW9uKGUsbil7ay5mbltuXT1mdW5jdGlvbihlLHQpe3JldHVybiAwPGFyZ3VtZW50cy5sZW5ndGg/dGhpcy5vbihuLG51bGwsZSx0KTp0aGlzLnRyaWdnZXIobil9fSksay5mbi5leHRlbmQoe2hvdmVyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMubW91c2VlbnRlcihlKS5tb3VzZWxlYXZlKHR8fGUpfX0pLGsuZm4uZXh0ZW5kKHtiaW5kOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gdGhpcy5vbihlLG51bGwsdCxuKX0sdW5iaW5kOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMub2ZmKGUsbnVsbCx0KX0sZGVsZWdhdGU6ZnVuY3Rpb24oZSx0LG4scil7cmV0dXJuIHRoaXMub24odCxlLG4scil9LHVuZGVsZWdhdGU6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD90aGlzLm9mZihlLCIqKiIpOnRoaXMub2ZmKHQsZXx8IioqIixuKX19KSxrLnByb3h5PWZ1bmN0aW9uKGUsdCl7dmFyIG4scixpO2lmKCJzdHJpbmciPT10eXBlb2YgdCYmKG49ZVt0XSx0PWUsZT1uKSxtKGUpKXJldHVybiByPXMuY2FsbChhcmd1bWVudHMsMiksKGk9ZnVuY3Rpb24oKXtyZXR1cm4gZS5hcHBseSh0fHx0aGlzLHIuY29uY2F0KHMuY2FsbChhcmd1bWVudHMpKSl9KS5ndWlkPWUuZ3VpZD1lLmd1aWR8fGsuZ3VpZCsrLGl9LGsuaG9sZFJlYWR5PWZ1bmN0aW9uKGUpe2U/ay5yZWFkeVdhaXQrKzprLnJlYWR5KCEwKX0say5pc0FycmF5PUFycmF5LmlzQXJyYXksay5wYXJzZUpTT049SlNPTi5wYXJzZSxrLm5vZGVOYW1lPUEsay5pc0Z1bmN0aW9uPW0say5pc1dpbmRvdz14LGsuY2FtZWxDYXNlPVYsay50eXBlPXcsay5ub3c9RGF0ZS5ub3csay5pc051bWVyaWM9ZnVuY3Rpb24oZSl7dmFyIHQ9ay50eXBlKGUpO3JldHVybigibnVtYmVyIj09PXR8fCJzdHJpbmciPT09dCkmJiFpc05hTihlLXBhcnNlRmxvYXQoZSkpfSwiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kJiZkZWZpbmUoImpxdWVyeSIsW10sZnVuY3Rpb24oKXtyZXR1cm4ga30pO3ZhciBRdD1DLmpRdWVyeSxKdD1DLiQ7cmV0dXJuIGsubm9Db25mbGljdD1mdW5jdGlvbihlKXtyZXR1cm4gQy4kPT09ayYmKEMuJD1KdCksZSYmQy5qUXVlcnk9PT1rJiYoQy5qUXVlcnk9UXQpLGt9LGV8fChDLmpRdWVyeT1DLiQ9ayksa30pOwo="}]}]}